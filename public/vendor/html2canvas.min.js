/**
 * html2canvas v1.4.1
 * Copyright (c) 2021 Niklas von Hertzen <https://hertzen.com>
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t="undefined"!=typeof globalThis?globalThis:t||self).html2canvas=e())}(this,function(){"use strict";const t=/([a-z0-9]|(?=[A-Z]))([A-Z])/g;const e=t=>t.replace(t,(t,e,r)=>e+"-"+r.toLowerCase());const r={};const n=t=>void 0!==r[t]?r[t]:null;const o=t=>{for(var e=[],r=t.length,n=0;n<r;n++){var o=t[n];if(o.isPseudoElement)continue;var i=o.style;if(i){var a=i.content;"string"==typeof a&&"none"!==a&&e.push(a)}for(var s=o.childNodes.length,c=0;c<s;c++)e.push.apply(e,o.childNodes[c].childNodes.length?o.childNodes[c].textNodes:o.childNodes[c].text.length?o.childNodes[c].text:"")}return e.join("")};const i=(t,e,r)=>{const n=parseInt(t.substring(e,r),16);return n>=55296&&n<=57343?"":n>=65534?"":65533===n||n>=1114111?"":n};const a={};const s=(t,e)=>{let r="";if(a[t])return a[t];for(let n=0;n<t.length;n++){const o=t.charCodeAt(n);o>=55296&&o<=56319&&n<t.length-1?r+=t.substring(n,n+=2):r+=t[n]}return e&&"string"==typeof e.punycode&&(r=e.punycode.ucs2.decode(r)),a[t]=r,r};const c=t=>"string"==typeof t&&t.length>0;const l=t=>null===t;const u=t=>"function"==typeof t;const h=t=>"number"==typeof t;const f=t=>"undefined"!=typeof window&&t instanceof window.Element;const d=t=>"undefined"!=typeof window&&t instanceof window.Text;const p=(t,e,r)=>{e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.parent=t.prototype,r&&Object.assign(e.prototype,r)};const g=/^data:image\/.*;base64,/i;const m=t=>g.test(t);const y=t=>t.replace(g,"");const b=/^data:image\/svg\+xml,/;const w=t=>b.test(t);const S=1024;const P=t=>t.width*t.height>22118400;const v=t=>t?"string"==typeof t?t.toLowerCase():"unknown":"unknown";var E;!function(t){t.NORMAL="normal",t.NONE="none",t.PRE="pre",t.PRE_WRAP="pre-wrap",t.PRE_LINE="pre-line",t.INHERIT="inherit",t.INITIAL="initial",t.UNSET="unset"}(E||(E={}));const A=/^\s*$/;var C;!function(t){t.MIN_CONTENT="min-content",t.MAX_CONTENT="max-content",t.FIT_CONTENT="fit-content",t.FILL_AVAILABLE="fill-available",t.AUTO="auto",t.INHERIT="inherit",t.INITIAL="initial",t.UNSET="unset"}(C||(C={}));const k=t=>{switch(t){case"min-content":case C.MIN_CONTENT:return 0;case"max-content":case C.MAX_CONTENT:return Number.MAX_VALUE}return 0};var T;!function(t){t.ABSOLUTE="absolute",t.FIXED="fixed",t.RELATIVE="relative",t.STATIC="static",t.STICKY="sticky",t.INHERIT="inherit",t.INITIAL="initial",t.UNSET="unset"}(T||(T={}));var L;!function(t){t.INSET="inset",t.BLOCK="block",t.INLINE="inline",t.RUN_IN="run-in",t.FLOW="flow",t.FLOW_ROOT="flow-root",t.TABLE="table",t.FLEX="flex",t.GRID="grid",t.RUBY="ruby",t.SUBGRID="subgrid",t.LIST_ITEM="list-item",t.TABLE_ROW_GROUP="table-row-group",t.TABLE_HEADER_GROUP="table-header-group",t.TABLE_FOOTER_GROUP="table-footer-group",t.TABLE_ROW="table-row",t.TABLE_CELL="table-cell",t.TABLE_COLUMN_GROUP="table-column-group",t.TABLE_COLUMN="table-column",t.TABLE_CAPTION="table-caption",t.RUBY_BASE="ruby-base",t.RUBY_TEXT="ruby-text",t.RUBY_BASE_CONTAINER="ruby-base-container",t.RUBY_TEXT_CONTAINER="ruby-text-container",t.CONTENTS="contents",t.NONE="none",t.INLINE_BLOCK="inline-block",t.INLINE_TABLE="inline-table",t.INLINE_FLEX="inline-flex",t.INLINE_GRID="inline-grid"}(L||(L={}));var I;!function(t){t.VISIBLE="visible",t.HIDDEN="hidden",t.COLLAPSE="collapse",t.INHERIT="inherit",t.INITIAL="initial",t.UNSET="unset"}(I||(I={}));var x;!function(t){t[t.NONE=0]="NONE",t[t.AUTO=1]="AUTO",t[t.CONTAIN=2]="CONTAIN",t[t.COVER=3]="COVER",t[t.INITIAL=4]="INITIAL",t[t.INHERIT=5]="INHERIT",t[t.UNSET=6]="UNSET",t[t.FILL=7]="FILL",t[t.SCALE_DOWN=8]="SCALE_DOWN"}(x||(x={}));const O={};const R=t=>void 0!==O[t]?O[t]:null;var M;!function(t){t.NORMAL="normal",t.NONE="none",t.INHERIT="inherit",t.INITIAL="initial",t.UNSET="unset"}(M||(M={}));const N=t=>M.NONE!==t;var D;!function(t){t[t.NONE=0]="NONE",t[t.LUMINANCE=1]="LUMINANCE",t[t.ALPHA=2]="ALPHA"}(D||(D={}));const B={};const F=t=>void 0!==B[t]?B[t]:null;var U;!function(t){t.SPACE="space",t.ROUND="round",t.STRETCH="stretch",t.REPEAT="repeat",t.INHERIT="inherit",t.INITIAL="initial",t.UNSET="unset"}(U||(U={}));var G;!function(t){t.BORDER_BOX="border-box",t.PADDING_BOX="padding-box",t.CONTENT_BOX="content-box",t.TEXT="text"}(G||(G={}));var V;!function(t){t.NO_CLIP="no-clip",t.INHERIT="inherit",t.INITIAL="initial",t.UNSET="unset"}(V||(V={}));var z;!function(t){t.SCROLL="scroll",t.NO_SCROLL="no-scroll",t.INHERIT="inherit",t.INITIAL="initial",t.UNSET="unset"}(z||(z={}));var H;!function(t){t[t.NONE=0]="NONE",t[t.SOLID=1]="SOLID",t[t.DOUBLE=2]="DOUBLE",t[t.DOTTED=3]="DOTTED",t[t.DASHED=4]="DASHED",t[t.HIDDEN=5]="HIDDEN",t[t.GROOVE=6]="GROOVE",t[t.RIDGE=7]="RIDGE",t[t.INSET=8]="INSET",t[t.OUTSET=9]="OUTSET"}(H||(H={}));const W=t=>H.NONE!==t&&H.HIDDEN!==t;var Y;!function(t){t.NONE="none",t.AUTO="auto",t.ALWAYS="always",t.AVOID="avoid",t.AVOID_PAGE="avoid-page",t.PAGE="page",t.LEFT="left",t.RIGHT="right",t.RECTO="recto",t.VERSO="verso",t.AVOID_COLUMN="avoid-column",t.COLUMN="column",t.AVOID_REGION="avoid-region",t.REGION="region"}(Y||(Y={}));var j;!function(t){t.NONE="none",t.AUTO="auto",t.CONTAIN="contain",t.INHERIT="inherit",t.INITIAL="initial",t.UNSET="unset"}(j||(j={}));var X;!function(t){t[t.NONE=0]="NONE",t[t.FORWARD=1]="FORWARD",t[t.BACKWARD=2]="BACKWARD"}(X||(X={}));var Z;!function(t){t[t.VISIBLE=0]="VISIBLE",t[t[ "HIDDEN"]=1]="HIDDEN",t[t.SCROLL=2]="SCROLL",t[t.AUTO=3]="AUTO"}(Z||(Z={}));const q=t=>Z.VISIBLE!==t;var J;!function(t){t[t.NORMAL=0]="NORMAL",t[t.BREAK_WORD=1]="BREAK_WORD"}(J||(J={}));var K;!function(t){t[t.NONE=0]="NONE",t[t.UNDERLINE=1]="UNDERLINE",t[t.OVERLINE=2]="OVERLINE",t[t.LINE_THROUGH=3]="LINE_THROUGH",t[t.BLINK=4]="BLINK",t[t.INHERIT=5]="INHERIT",t[t.INITIAL=6]="INITIAL",t[t.UNSET=7]="UNSET"}(K||(K={}));const Q=t=>t.length>0;class $ {constructor(t){this.value=t}static fromString(t){return new $(t)}static fromArray(t){return new $(t)}}class tt {constructor(t){this.tokens=t}static fromString(t){const e=[];let r="";let n=null;for(let o=0;o<t.length;o++){const i=t[o];if(null===n){if("("===i||")"===i||","===i){r.length&&e.push($.fromString(r.trim())),e.push($.fromString(i)),r=""}else"'"==i||'"'==i?(n=i,r+=i):r+=i}else i===n?(n=null,r+=i):r+=i}return r.length&&e.push($.fromString(r.trim())),new tt(e.filter(t=>""!==t.value))}get(t){return this.tokens[t]||null}slice(t,e){return new tt(this.tokens.slice(t,e))}length(){return this.tokens.length}join(t){return this.tokens.map(e=>e.value).join(t)}}class et {constructor(t,e,r){this._value=t,this._type=e,this._args=r}static create(t,e,r=[]){return new et(t,e,r)}static parse(t,e){const r=et.CREATE_PREDICATE(e),n=et.parseFn(t,e),o=n?et.create(e,et.FUNCTION,n):et.create(e,et.IDENT_TOKEN,[]);return o.type,o.args.push(r.prefix),o.args.push(r.value),o}static parseFn(t,e){let r=0,n=0;const o=[];for(let i=0;i-1!==(n=e.indexOf("(",n));)r>0&&(r++,o.push(e.substring(i,n)),i=n),n++;for(let a=e.length;-1!==(n=e.indexOf(")",n));)r>0&&o.push(e.substring(i,n)),i=n,n++;return o.length>0&&o[0]?o:null}static CREATE_PREDICATE(t){let e={prefix:null,value:null};const r=t.match(/^(-[a-z]-|--)?([a-z-]*)/i);return r&&(e.prefix=r[1],e.value=r[2]),e}}et.IDENT_TOKEN=0,et.FUNCTION=1,et.SLOT=2;const rt=(t,e)=>{const r=(e=>({type:et.SLOT,name:e}))(t);if("url"===r.name){let t;t=e.length()>=3&&"("===e.get(1).value&&")"===e.get(e.length()-1).value?e.slice(2,e.length()-1).join(""):e.slice(1).join(""),"string"==typeof t&&(('"'===t[0]||"'"===t[0])&&(t=t.substring(1,t.length-1)));const n=m(t)||w(t)?"":"about:blank"===t?"":t;return n?{type:"url",url:n}:null}return r};const nt=(t,e,r)=>{let n=null;const o=[];let i=!1;const a=()=>{n&&o.push(new $(n)),n=null},s=()=>{const t=o.length,s=o[t-2],c=o[t-1];u(s.value)&&a(),!s||!c||u(s.value)||u(c.value)||(s.value+=c.value,o.pop())};for(let c=0;c<t.length;c++){const l=t[c];if(" "===l)i||(a(),i=!0);else{const t=e[l];if(u(t)){a(),o.push(new $(t)),i=!1;continue}n=n?n+l:l,i=!1}}a();const c=[];let l=!1;const h=()=>{l&&s(),l=!1};for(let t=0;t<o.length;t++){const e=o[t].value;if(u(e)){if(l)if("/"===e.name||","===e.name)h();else{if(e.name===o[t-1].value.name)continue;if(o.length>t+1&&e.name===o[t+1].value.name)continue;if(e.name===r)continue;h()}c.push(new $(e))}else{const r=parseFloat(e);if(isNaN(r))c.push(new $("string"===typeof e?rt(e,tt.fromString(e)):e));else if(l){const t=c[c.length-1];t.value+=e}else c.push(new $(r));l="number"==typeof(c[c.length-1].value||0)}}return h(),c};const ot=(t,e,r)=>{if(0===e.length)return null;const n=e.map(e=>{if("number"==typeof e.value)return function(t,e){return{type:"angle"==t||"time"==t?{type:t,value:e}:/^[a-z%]+$/.test(t)?{type:"dimension",value:e,unit:t}:null}(r,e.value);if("function"==typeof e.value)return function(t,e){if(!u(e))return null;const r=e;if(r.parse){const e=r.parse(t);if(e)return e}return null}(t,e.value);if("object"==typeof e.value&&null!==e.value)return function(t){const e=rt(t.name,tt.fromString(t.name));if(e)return"url"===e.type?{type:"url",url:e.url}:null;return null}(e.value);if("string"==typeof e.value)return function(t,e){const r=rt(e,tt.fromString(e));if(r)return"url"===r.type?{type:"url",url:e}:null;const n=it(e,t);if(n)return n;return null}(t,e.value);return null});return 1===n.length?n[0]:n};class it {constructor(t){this.id=t,this.type="color"}static fromString(t){if("#"===t.substring(0,1))return function(t){if(t.length>7)return new it(4294967295);if(t.length>4){const e=[parseInt(t.substring(1,3),16),parseInt(t.substring(3,5),16),parseInt(t.substring(5,7),16),255];return new it(e[0]<<24|e[1]<<16|e[2]<<8|e[3])}const e=[parseInt(t.substring(1,2),16),parseInt(t.substring(2,3),16),parseInt(t.substring(3,4),16),15];return new it(17*e[0]<<24|17*e[1]<<16|17*e[2]<<8|17*e[3])}(t);if(t.substring(0,3).toLowerCase()==="rgb")return function(t){const e=tt.fromString(t);if(e){const t=e.tokens[0],r=t.value.substring(0,t.value.length-1).split(",").map(parseFloat),n="a"===t.value.substring(3,4).toLowerCase()?r.length>3?r[3]:1:1,o=Math.round(255*n);return new it(r[0]<<24|r[1]<<16|r[2]<<8|o)}};const e=function(t){switch(t.toLowerCase()){case"transparent":return 0;case"black":return 4278190335;case"silver":return 4290822336;case"gray":return 4286611584;case"white":return 4294967295;case"maroon":return 4286578943;case"red":return 4294901760;case"purple":return 4286578816;case"fuchsia":return 4294902015;case"green":return 4278222848;case"lime":return 4278255360;case"olive":return 4286611456;case"yellow":return 4294967040;case"navy":return 4278190208;case"blue":return 4278190335;case"teal":return 4278222976;case"aqua":return 4278255615}return null}(t);return l(e)?null:new it(e)}get r(){return this.id>>24&255}get g(){return this.id>>16&255}get b(){return this.id>>8&255}get a(){return 255&this.id}}const at=4278190080;const st=t=>t instanceof it?t.id:at;const ct=t=>new it(t);const lt=t=>st(t)>0;const ut=t=>(255&t)/255;const ht=t=>{if(void 0===t.r)return null;const e=t.r/255,r=t.g/255,n=t.b/255,o=Math.max(e,r,n),i=Math.min(e,r,n);let a,s,c=o,l=o-i;if(s=0===o?0:l/o,o===i)a=0;else{switch(o){case e:a=(r-n)/l+(r<n?6:0);break;case r:a=(n-e)/l+2;break;case n:a=(e-r)/l+4}a/=6}return{h:a,s:s,v:c}};const ft=(t,e,r)=>{let n,o,i;r*=255;const a=~~(t*=6),s=t-a,c=r*(1-e),l=r*(1-s*e),u=r*(1-(1-s)*e);switch(a%6){case 0:n=r,o=u,i=c;break;case 1:n=l,o=r,i=c;break;case 2:n=c,o=r,i=u;break;case 3:n=c,o=l,i=r;break;case 4:n=u,o=c,i=r;break;case 5:n=r,o=c,i=l}return{r:n,g:o,b:i}};const dt=t=>{const e={};return Object.keys(t).forEach(r=>{const n=parseFloat(r);isNaN(n)||(e[n]=t[r])}),e};const pt=t=>{if(null===t)return[];if(t.length)return t;const e=dt(t),r=Object.keys(e).map(parseFloat).sort();if(!r.length)return[];const n=[];if(0!==r[0])n.push(gt(0,e[r[0]]));for(let t=0;t<r.length;t++)n.push(gt(r[t],e[r[t]]));return 1!==r[r.length-1]&&n.push(gt(1,e[r[r.length-1]])),n};const gt=(t,e)=>{const r="string"==typeof e?it.fromString(e):ct(e);return{stop:t,color:r}};class mt {constructor(t){this.type="complex",this.values=t}static parse(t){const e=nt(t.value,[Object.assign(Object.assign({"/":{name:"/",parse:!1}},mt.COLORS),mt.TRANSFORMS)]," ");const r=ot(t.value,e,"");return r?new mt(Array.isArray(r)?r:[r]):null}}mt.COLORS=R("color"),mt.TRANSFORMS=R("transform-function");const yt=(t,e,r,n)=>{let o,i=t[r].stop,a=t[r+1].stop,s=t[r].color,c=t[r+1].color;return o=(e-i)/ (a-i),{r:(1-o)*s.r+o*c.r,g:(1-o)*s.g+o*c.g,b:(1-o)*s.b+o*c.b,a:(1-o)*s.a+o*c.a}};const bt=(t,e,r)=>{let n,o,i,a;o=Math.max(0,Math.min(1,e));for(let e=0;e<r.length;e++){if(o>=r[e].stop&&o<=r[e+1].stop){n=r[e];break}if(o<r[e].stop){n=r[0];break}if(o>r[e].stop&&e===r.length-1){n=r[e];break}}if(!n)return null;const s=ht(n.color);if(!s)return null;return i=Object.assign(Object.assign({},s),{s:s.s*t,v:s.v/t}),a=ft(i.h,i.s,i.v),a.a=n.color.a,ct(a.r<<24|a.g<<16|a.b<<8|255*a.a)};const wt=(t,e,r)=>{let n,o,i;for(let a=0;a<r.length;a++)r[a].stop>=e&&(n=r[a],o=r[a-1]||r[a],i=yt(r,e,a-1),t(n,o,i));return i};const St=(t,e,r,n,o,i)=>{const a=Math.ceil(o/2),s=Math.ceil(i/2),c=[];for(let l=0;l<i;l++)for(let u=0;u<o;u++){const h=u-a,f=l-s,d=Math.sqrt(h*h+f*f),p=d/Math.sqrt(a*a+s*s),g=bt(t,p,n);if(g){const t=st(g),e=wt(r,p,n);const a=e?st(e):st(g);c[4*(l*o+u)+0]=t>>24&255,c[4*(l*o+u)+1]=t>>16&255,c[4*(l*o+u)+2]=t>>8&255,c[4*(l*o+u)+3]=255&a}}return c};class vt {constructor(t){this.type=1,this.values=t}static parse(t){const e=/^((?:-moz-|-webkit-|-o-)?linear-gradient)\((.+)\)$/i.exec(t);if(e){const t=e[1],r=e[2].split(","),n=r.shift(),o=vt.parseAngle(n,t),i=pt(r);return o&&i.length?new vt({angle:o,colorStops:i,type:t}):null}return null}static parseAngle(t,e){if(/-webkit-/.test(e)){const e=t.match(/\d+(deg|grad|rad|turn)/);if(e)return{type:"angle",value:parseFloat(e[0]),unit:e[1]}}const r=t.toLowerCase().split(/\s+/).filter(t=>t.length>0);if("top"===r[0]){if(r.length>1){if("left"===r[1])return 1.25*Math.PI;if("right"===r[1])return .75*Math.PI}return Math.PI}if("bottom"===r[0]){if(r.length>1){if("left"===r[1])return 1.75*Math.PI;if("right"===r[1])return .25*Math.PI}return 0}if("left"===r[0])return 1.5*Math.PI;if("right"===r[0])return .5*Math.PI;const n=parseFloat(t);return isNaN(n)?null:n}}class Et {constructor(t){this.type=0,this.values=t}static parse(t){const e=/^((?:-moz-|-webkit-|-o-)?radial-gradient)\((.+)\)$/i.exec(t);if(e){const t=e[1],r=e[2].split(","),n=r.shift(),o=Et.parseShape(n),i=pt(r);return o&&i.length?new Et({shape:o,colorStops:i,type:t}):null}return null}static parseShape(t){const e=t.toLowerCase().split(/\s+/);let r={type:"circle",at:"center"},n=!1;for(let t=0;t<e.length;t++){const o=e[t];if("at"===o)n=!0;else if(n){const t=ot(null,[new $(o)],"position");t&&(r.at=t)}else{const t=parseFloat(o);isNaN(t)?r.type=o:r.size=t}}return r}}class Ct {constructor(t,e,r){this._context=t,this._node=e,this._options=r}render(){const t=this._node,e=t.values.colorStops;let r=0;return t.values.angle?r=function(t){switch(t.unit){case"rad":return t.value;case"grad":return Math.PI*t.value/200;case"turn":return 2*Math.PI*t.value}return t.value*Math.PI/180}(t.values.angle):0,function(t,e,r){const n=Math.cos(e),o=Math.sin(e),i=Math.abs(n),a=Math.abs(o);const s=t.width,c=t.height;const l=Math.floor(s/2*i+c/2*a),u=Math.floor(s/2*a+c/2*i);const h=new Uint8ClampedArray(4*s*c);for(let f=0;f<c;f++){for(let d=0;d<s;d++){const i=d-s/2,a=f-c/2,p=i*n+a*o,g=.5+(p/l+p/u)/2,m=wt((t,e,r)=>{t.color,e.color,r},g,r);m&&(h[4*(f*s+d)+0]=m.r,h[4*(f*s+d)+1]=m.g,h[4*(f*s+d)+2]=m.b,h[4*(f*s+d)+3]=255*m.a)}}return h}(this._context,r,e)}}class Lt {constructor(t,e,r){this._context=t,this._node=e,this._options=r}render(){const t=this._node.values.shape,e=this._node.values.colorStops;return St(.5,(t,e,r)=>{r?r.r:255},e,this._context.width,this._context.height)}}const It=t=>{const e=t.trim();switch(e){case"transparent":return new it(0);default:return it.fromString(e)}return null};const xt=t=>{const e=Et.parse(t)||vt.parse(t);return e?{type:"gradient",gradient:e}:null};const Ot=(t,e)=>{const r=t.trim(),n=r.match(/^(?:(rgba?)\(([^)]+)\)|(#[0-9a-f]+)|([a-z]+))$/i);if(n)return n[1]?function(t,e){const r=e.split(",").map(t=>t.trim());let n=255;if(4===r.length){const t=parseFloat(r.pop());isNaN(t)||(n=Math.round(255*t))}return new it(parseInt(r[0],10)<<24|parseInt(r[1],10)<<16|parseInt(r[2],10)<<8|n)}(0,n[2]):n[3]?it.fromString(n[3]):n[4]?it.fromString(n[4]):null;const o=e.document.createElement("a");return o.href=r,function(t){const e=parseInt(t.substr(1),16);return isNaN(e)?null:it.fromString(t)}(o.href)};const Rt=(t,e)=>{if(null===t)return null;if(t instanceof it)return t;const r=t.match(/^(?:(rgba?)\(([^)]+)\)|(#[0-9a-f]+)|([a-z]+))$/i);return r?r[1]?function(t,e){const r=e.split(",").map(t=>t.trim());let n=255;if(4===r.length){const t=parseFloat(r.pop());isNaN(t)||(n=Math.round(255*t))}return new it(parseInt(r[0],10)<<24|parseInt(r[1],10)<<16|parseInt(r[2],10)<<8|n)}(0,r[2]):r[3]?it.fromString(r[3]):r[4]?it.fromString(r[4]):null:xt(t)||Ot(t,e)};const Mt=t=>{const e=tt.fromString(t).tokens.filter((t,e,r)=>{const n=t.value;if("object"!=typeof n)return!0;const o=n;return!("url"===o.name||o.name.endsWith("gradient"))||(0===e||"object"!=typeof r[e-1].value||r[e-1].value.name!==o.name)});if(0===e.length)return null;const r=e.map(e=>{if("object"!=typeof e.value)return e;const r=e.value;return new $(rt(r.name,tt.fromString(r.name)))});let n=null;const o=[];for(let t=0;t<r.length;t++){const e=r[t].value;"object"==typeof e&&null!==e?(n&&o.push(new $(n)),n=null,o.push(new $(e))):n?n+=" "+e:(n=e,o.push(new $(n)),n=null)}return n&&o.push(new $(n)),o};const Dt=(t,e,r,n)=>{const o=r?It(t):null;return o?{type:n||"color",color:o}:xt(t)};const qt=(t,e)=>{const r=Mt(t);if(!r)return[];const n=[];for(let t=0;t<r.length;t++){const o=r[t].value;if("object"==typeof o&&"url"===o.type){const t=o.url;t&&(n.push({type:"url",url:t,bounds:null}))}else{const t=Dt(o,e,!0);t&&(n.push({type:"color",color:t.color}))}}return n};const Zt=(t,e)=>{const r=t.split(",").map(t=>t.trim());return r.length>1&&"auto"===r[1].toLocaleLowerCase()&&r.shift(),r.map(t=>{const r=t.split(" ");return 1===r.length?parseFloat(r[0]):{x:parseFloat(r[0]),y:parseFloat(r[1])}})};const Yt=(t,e,r)=>{const n=r?e:Zt(t);return Array.isArray(n)?n.map(t=>("number"==typeof t?{x:t,y:t}:t).x):n?("number"==typeof n?{x:n,y:n}:n).x:0};const Kt=(t,e,r)=>{const n=r?e:Zt(t);return Array.isArray(n)?n.map(t=>("number"==typeof t?{x:t,y:t}:t).y):n?("number"==typeof n?{x:n,y:n}:n).y:0};const Xt=t=>{const e=parseFloat(t);return isNaN(e)?1:e};const $t=t=>{const e=parseFloat(t);return isNaN(e)?0:e};const Jt=t=>{const e=t.toLowerCase();switch(e){case"auto":return 1;case"content":case"element":return 2;case"contain":return 3;case"none":return 4;case"text":case"all":case"elements":return 5;default:return 0}};const Vt=t=>{const e=t.toLowerCase();switch(e){case"border":return 1;case"padding":return 2;default:return 0}};const Wt=t=>"string"==typeof t?{top:t,right:t,bottom:t,left:t}:t;const zt=t=>{const e=t.split(" ").map(t=>parseFloat(t));switch(e.length){case 1:return{top:e[0],right:e[0],bottom:e[0],left:e[0]};case 2:return{top:e[0],right:e[1],bottom:e[0],left:e[1]};case 3:return{top:e[0],right:e[1],bottom:e[2],left:e[1]};case 4:return{top:e[0],right:e[1],bottom:e[2],left:e[3]}}return{top:0,right:0,bottom:0,left:0}};const Ht={};const Gt=t=>{const e=Ht[t];if(e)return e;const r=zt(t);return Ht[t]=r,r};const Qt={};const te=t=>{const e=Qt[t];if(e)return e;const r={top:0,right:0,bottom:0,left:0};if(t){const e=t.split(" ");if(e[0]){r.top=parseFloat(e[0]);const t=parseFloat(e[1])||r.top,n=parseFloat(e[2])||r.top;r.right=t,r.bottom=n,r.left=parseFloat(e[3])||t}}return Qt[t]=r,r};const ee={};const re=t=>{const e=ee[t];if(e)return e;const r={top:0,right:0,bottom:0,left:0};if(t){const e=t.split(" ").map(t=>t.trim());1===e.length?r.top=r.right=r.bottom=r.left=parseFloat(e[0]):2===e.length?(r.top=r.bottom=parseFloat(e[0]),r.left=r.right=parseFloat(e[1])):(r.top=parseFloat(e[0]),r.right=parseFloat(e[1]),r.bottom=parseFloat(e[2]),e[3]&&(r.left=parseFloat(e[3])))}return ee[t]=r,r};const ne={};const ie=t=>{const e=ne[t];if(e)return e;const r={top:0,right:0,bottom:0,left:0};if(t){const e=t.split(" ").map(t=>t.trim());1===e.length?r.top=r.right=r.bottom=r.left=parseFloat(e[0]):2===e.length?(r.top=r.bottom=parseFloat(e[0]),r.left=r.right=parseFloat(e[1])):(r.top=parseFloat(e[0]),r.right=parseFloat(e[1]),r.bottom=parseFloat(e[2]),e[3]&&(r.left=parseFloat(e[3])))}return ne[t]=r,r};const ae=t=>{const e=/^((?:-moz-)?repeating-linear-gradient)\((.+)\)$/i.exec(t);if(e){const t=e[1],r=e[2].split(","),n=r.shift(),o=vt.parseAngle(n,t),i=pt(r);return o&&i.length?{type:"repeating-linear-gradient",value:{angle:o,colorStops:i,type:t}}:null}return null};const oe=t=>{const e=/^((?:-moz-)?repeating-radial-gradient)\((.+)\)$/i.exec(t);if(e){const t=e[1],r=e[2].split(","),n=r.shift(),o=Et.parseShape(n),i=pt(r);return o&&i.length?{type:"repeating-radial-gradient",value:{shape:o,colorStops:i,type:t}}:null}return null};const se=(t,e,r)=>{const n=parseInt(t.substring(0,e),r);return isNaN(n)?0:n};const ce=t=>t.length>0?t.map(t=>t.replace(/'|"/g,"")):[]
;class le {constructor(t){this.value=t}toCSS(){return this.value.length>0?`"${this.value.join('", "')}"`:"none"}}const ue=(t,e,r)=>{const n=t.split(" "),o=n.length>1?r(n[1]):e;return{style:r(n[0]),color:o}};class he {constructor(t){this.value=t}}const fe=t=>new he(t.split(" ").map(e));class de {constructor(t){this.value=t}static fromString(t){const e=tt.fromString(t);let r=0,n=0;const o=e.tokens.filter(t=>"string"==typeof t.value).map(t=>t.value);if(o.length>1&&(r=parseFloat(o[0]),n=parseFloat(o[1]),isNaN(r)||isNaN(n)))throw new Error("Invalid box-shadow definition");return new de([r,n,parseFloat(o[2]||"0"),parseFloat(o[3]||"0"),it.fromString(o[4]||"black"),"inset"===o[5]])}}const pe=t=>{const e=tt.fromString(t);let r,n=null;for(let o=0;o<e.length();o++){const i=e.get(o);if(i){const e=i.value;switch(e){case"none":return[];case",":n&&((r=r||[]).push(n),n=null);break;default:n=n?n+" "+e:e}}}return n&&((r=r||[]).push(n)),r?r.map(de.fromString):[]};class ge {constructor(t,e){this.target=t,this.options=e}}class me {constructor(t){this.id=t}static create(t,e){return"none"===t?me.NONE:new me(se(t,e,10))}static fromString(t){return me.create(t,t.length)}}me.NONE=new me(0);const ye=(t,e,r)=>{const n="string"==typeof t?t.split(/\s+/).map(t=>t.trim()):t;return n.map((t,n)=>{let o,i,a;const s=t.split("/");if(s.length>1)o=s[0],i=s[1],a=s[2];else{const t=parseFloat(s[0]);isNaN(t)||(o=t)}const c=e&&e[n]||"normal",l=r&&r[n]||"normal";return{fontStyle:l,fontWeight:c,fontSize:o,fontFamily:i,fontVariant:a}})};const be=t=>{const e=t.trim().split(" ");if(2!==e.length)return null;const r=e.map(t=>parseFloat(t));return isNaN(r[0])||isNaN(r[1])?null:r};const we={};const Se=t=>{if(null===we[t])return null;if(we[t])return we[t];let e,r=t,n=null;if(-1!==t.indexOf("matrix3d(")){const e=t.match(/matrix3d\((.+)\)/);if(e){const t=e[1].split(",").map(parseFloat);r=`matrix(${t.slice(0,2).concat(t.slice(4,6),t.slice(12,14)).join(",")})`}}const o=r.match(/matrix\(([^)]+)\)/);if(o){n=o[1].split(",").map(parseFloat);const t=[[n[0],n[2],n[4]],[n[1],n[3],n[5]],[0,0,1]];e={matrix:t,inverse:()=>{const e=t,r=e[0][0],n=e[0][1],o=e[0][2],i=e[1][0],a=e[1][1],s=e[1][2],c=e[2][0],l=e[2][1],u=e[2][2];let h=r*a*u-r*s*l-n*i*u+n*s*c+o*i*l-o*a*c;if(!h)return null;h=1/h;const f=[[0,0,0],[0,0,0],[0,0,0]];return f[0][0]=(a*u-s*l)*h,f[0][1]=(o*l-n*u)*h,f[0][2]=(n*s-o*a)*h,f[1][0]=(s*c-i*u)*h,f[1][1]=(r*u-o*c)*h,f[1][2]=(o*i-r*s)*h,f[2][0]=(i*l-a*c)*h,f[2][1]=(n*c-r*l)*h,f[2][2]=(r*a-n*i)*h,{matrix:f}}}}}return we[t]=e,e};const Pe=t=>{if(!t||"none"===t)return null;const e=[];const r=tt.fromString(t);let n=0;for(;n<r.length();){const t=r.get(n).value,o=t.indexOf("(");if(-1!==o){const i=t.substring(0,o);const a=function(t){let e=t.indexOf("(")+1,r=e,n=1;for(;e<t.length;){const o=t[e];")"===o?n--:n>0&&"("===o&&n++,0===n&&(r=e)}return t.substring(t.indexOf("(")+1,r)}(t);e.push({name:i,value:a})}n++}return e};const ve=t=>Pe(t)?t:null;const Ee=t=>{if(!t)return null;const e=t.toLowerCase();return"auto"===e?1.5:"number"==typeof t?t:e.endsWith("px")?parseFloat(e.substring(0,e.length-2)):e.endsWith("pt")?parseFloat(e.substring(0,e.length-2))/.75:e.endsWith("pc")?parseFloat(e.substring(0,e.length-2))*16:e.endsWith("cm")?parseFloat(e.substring(0,e.length-2))*96/2.54:e.endsWith("mm")?parseFloat(e.substring(0,e.length-2))*96/25.4:e.endsWith("in")?parseFloat(e.substring(0,e.length-2))*96:1.5*parseFloat(e)};const Ae=t=>"string"==typeof t?t.split(" ")[0]:"";const Ce=t=>"string"==typeof t?t.split(" ").slice(1):[];const ke={};const Ie=t=>{if(ke[t])return ke[t];const e={};const r=t.match(/(p-)?(x|y)-([a-z]+)/);if(r)switch(r[3]){case"start":e[r[2]]="top"===r[2]?"top":"left";break;case"end":e[r[2]]="top"===r[2]?"bottom":"right"}return ke[t]=e,e};const xe={};const Te=t=>{if(xe[t])return xe[t];const e=t.trim().split(" ");const r=e[0],n=e.slice(1).join(" "),o={};return o.color=Rt(r,document),o.style=ue(n,H.SOLID,t=>H[t.toUpperCase()]).style,o.width=function(t){const e=parseFloat(t);return isNaN(e)?1:e}(n),o};class Ne {constructor(t){this.text=t}static fromText(t){return new Ne(t)}}Ne.EMPTY=new Ne("");class De {constructor(){this._items=[]}add(t){this._items.push(t)}addList(t){this._items.push(...t)}last(){return this._items[this.length-1]}length(){return this._items.length}get(t){return this._items[t]}get items(){return this._items}}class Fe {constructor(t,e){this.baseline=t,this.top=e}}class _e extends De {constructor(t,e,r){super(),this.text=t,this.textBounds=r,this._parent=e,this.bounds=e.bounds,this.textStart=e.textStart,this.textEnd=e.textEnd}static fromText(t,e,r,n){const o=new _e(t,e,r);return n.add(o),o}}class je extends De {constructor(t,e){super(),this._parent=t,this._text=e,this.bounds=t.bounds.clone(),this.textStart=t.textStart}add(t){const e=super.add(t);return e instanceof Re&&this.addText(e.text),e}addLine(t){const e=this.last();if(e instanceof _e&&0===e.text.length)return e;const r=t.substring(this.textStart+this.text.length,t.length);return _e.fromText(r,this,[],this)}}class Oe extends De {constructor(){super(),this._parent=null,this.bounds=new He(0,0,0,0)}add(t){const e=super.add(t);if(e instanceof Re&&this.addText(e.text),e instanceof Be)return e;this.bounds.add(e.bounds)}}class Re extends De {constructor(t){super(),this.text=t}get(t){return this._items[t]}}class Be extends Oe {constructor(t){super(),this.text=""}add(t){return t instanceof Be?this.addList(t.items):t instanceof Oe?this.addList(t.items):void super.add(t)}addText(t){this.text+=t}}const Ue=new class {constructor(){this.data=new WeakMap,this.nextId=0}async get(t){const e=this.data.get(t);if(e)return e;const r=this.nextId++;return this.data.set(t,r),r}}();const qe=(t,e,r)=>{if(e){const n=Math.round(e.width),o=Math.round(e.height),i=r.backgroundColor;i&&(t.fillStyle=i.toString(),t.fillRect(0,0,n,o));const a=r.backgroundImage;if(a)for(const i of a){if("url"===i.type){const a=i;if(a.url){const i=await r.context.cache.match(a.url);if(i){try{const a=function(t,e,r,o,i,a){let s,c;if(r.width>0&&r.height>0){if(i&&P(r))s=r.width/2,c=r.height/2,o.drawImage(r,0,0,s,c,t.left,t.top,s,c),o.drawImage(r,s,0,s,c,t.left+s,t.top,s,c),o.drawImage(r,0,c,s,c,t.left,t.top+c,s,c),o.drawImage(r,s,c,s,c,t.left+s,t.top+c,s,c);else{if(e.backgroundSize.length>1&&a>0)return;const[l,u]=function(t,e,r){let n,o;if("cover"===t){const t=e.width/e.height,i=r.width/r.height;n=t<i?r.width:r.height*t,o=t<i?r.width/t:r.height}else if("contain"===t){const t=e.width/e.height,i=r.width/r.height;n=t>i?r.width:r.height*t,o=t>i?r.width/t:r.height}else n="auto"===t[0]?e.width:t[0].value,o="auto"===t[1]?e.height:t[1].value;return[n,o]}(e.backgroundSize[a],r,t);let h;const f=e.backgroundPosition[a];"string"==typeof f?(h="left"===f?0:"right"===f?t.width-l:"center"===f?t.width/2-l/2:t.left):h=f.value,s=t.left+h;let d;const p=e.backgroundPosition[a+1];"string"==typeof p?(d="top"===p?0:"bottom"===p?t.height-u:"center"===p?t.height/2-u/2:t.top):d=p.value,c=t.top+d;const g=e.backgroundRepeat[a].toLowerCase();/^(repeat-x|repeat)$/.test(g)&&(o.fillStyle=o.createPattern(r,"repeat-x"),o.translate(s,c),o.fillRect(0,0,t.width,u),o.translate(-s,-c)),/^(repeat-y|repeat)$/.test(g)&&(o.fillStyle=o.createPattern(r,"repeat-y"),o.translate(s,c),o.fillRect(0,0,l,t.height),o.translate(-s,-c)),/^(no-repeat)$/.test(g)&&(o.translate(s,c),o.drawImage(r,0,0,l,u),o.translate(-s,-c))}}}catch(t){r.context.logger.error("Error loading background-image",t)}}}}}}}};class Me {constructor(t){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.options=t.options}async render(t){await this.renderNode(t)}async renderNode(t){await this.renderNodeBackground(t),await this.renderNodeContent(t)}async renderNodeBackground(t){const e=t.bounds.clone();if(lt(t.style.backgroundColor))this.ctx.fillStyle=st(t.style.backgroundColor).toString(),this.ctx.fillRect(e.left,e.top,e.width,e.height);const r=t.style.backgroundImage;if(r){for(const e of r){if("url"===e.type){const r=await this.options.cache.match(e.url);if(r){this.ctx.drawImage(r,0,0)}}}return}}async renderNodeContent(t){const e=t.bounds.clone();let r=0,n=null,o="";for(const i of t.textNodes){const a=i.text.split(" ").map(e=>{const r=this.ctx.measureText(o+" "+e);return r.width>t.bounds.width&&(n=o,o=""),o=o+" "+e,r.width});if(n){this.ctx.font=`${t.style.fontSize}px ${t.style.fontFamily}`,this.ctx.fillStyle=st(t.style.color).toString(),this.ctx.fillText(n,e.left,e.top+16*r)}r++}this.ctx.font=`${t.style.fontSize}px ${t.style.fontFamily}`,this.ctx.fillStyle=st(t.style.color).toString(),this.ctx.fillText(o,e.left,e.top+16*r)}}const We=t=>{const e=t.options,r=new Me(function(t,e){const r=t.createElement("canvas");return r.width=Math.floor(e.width*t.defaultView.devicePixelRatio),r.height=Math.floor(e.height*t.defaultView.devicePixelRatio),r.style.width=`${e.width}px`,r.style.height=`${e.height}px`,r.options=e,r}(e.ownerDocument,e));return r.render(t).then(()=>r.canvas)};class ze {constructor(t,e,r){this._document=t,this._documentElement=e,this._options=r}parse(){return new Ge(this._document.defaultView.getComputedStyle(this._documentElement,null),this._options,this._documentElement).parse()}}class Ve {constructor(t,e,r,n){this._value=t,this._type=e,this._styles=r,this._owner=n}static create(t,e,r,n){return new Ve(t,e,r,n)}get type(){return this._type}get value(){return this._value}get styles(){return this._styles}get owner(){return this._owner}}const He=class {constructor(t,e,r,n){this.left=t,this.top=e,this.width=r,this.height=n}add(t){this.left=Math.min(this.left,t.left),this.top=Math.min(this.top,t.top),this.width=Math.max(this.left+this.width,t.left+t.width)-this.left,this.height=Math.max(this.top+this.height,t.top+t.height)-this.top}clone(){return new He(this.left,this.top,this.width,this.height)}static fromClientRect(t){return new He(t.left,t.top,t.width,t.height)}};class Ge {constructor(t,e,r,n){this.style=t,this.options=e,this.node=r,this.parent=n,this.I=this.style.position}parse(){const t=[];if(f(this.node)){this.node.childNodes.forEach(e=>{t.push(...new Ge(this.style,this.options,e,this).parse())})}const e=this.node,r=this.options;if(d(e)&&e.data.length>0){const n=this.parent?this.parent.style:this.style;t.push(new Ke(e.data,{fontSize:parseFloat(n.fontSize),fontFamily:Ae(n.fontFamily),fontVariant:Ce(n.fontFamily).join(" "),color:Rt(n.color,this.options.ownerDocument)}))}const n=new Be(this.I);return n.add(t),this.options.logger.info("Parsed node",n),n}}class Je {constructor(t,e,r){this._text=t,this._bounds=e,this._styles=r}static fromText(t,e){return new Je(t,He.fromClientRect(e.getBoundingClientRect()),{fontSize:parseFloat(e.style.fontSize),fontFamily:Ae(e.style.fontFamily)})}}class Ke {constructor(t,e){this.text=t,this.styles=e}}const Xe=t=>f(t)?t