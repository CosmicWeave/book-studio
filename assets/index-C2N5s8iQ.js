var i$=Object.defineProperty;var _z=n=>{throw TypeError(n)};var r$=(n,e,t)=>e in n?i$(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var We=(n,e,t)=>r$(n,typeof e!="symbol"?e+"":e,t),uA=(n,e,t)=>e.has(n)||_z("Cannot "+t);var y=(n,e,t)=>(uA(n,e,"read from private field"),t?t.call(n):e.get(n)),L=(n,e,t)=>e.has(n)?_z("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),z=(n,e,t,s)=>(uA(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),O=(n,e,t)=>(uA(n,e,"access private method"),t);var Ni=(n,e,t,s)=>({set _(i){z(n,e,i,t)},get _(){return y(n,e,s)}});function o$(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in n)){const r=Object.getOwnPropertyDescriptor(s,i);r&&Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function JT(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var hA={exports:{}},Bg={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mz;function a$(){if(Mz)return Bg;Mz=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,i,r){var o=null;if(r!==void 0&&(o=""+r),i.key!==void 0&&(o=""+i.key),"key"in i){r={};for(var a in i)a!=="key"&&(r[a]=i[a])}else r=i;return i=r.ref,{$$typeof:n,type:s,key:o,ref:i!==void 0?i:null,props:r}}return Bg.Fragment=e,Bg.jsx=t,Bg.jsxs=t,Bg}var Rz;function l$(){return Rz||(Rz=1,hA.exports=a$()),hA.exports}var d=l$(),fA={exports:{}},bt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Iz;function c$(){if(Iz)return bt;Iz=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),g=Symbol.iterator;function b(F){return F===null||typeof F!="object"?null:(F=g&&F[g]||F["@@iterator"],typeof F=="function"?F:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,N={};function C(F,J,ie){this.props=F,this.context=J,this.refs=N,this.updater=ie||w}C.prototype.isReactComponent={},C.prototype.setState=function(F,J){if(typeof F!="object"&&typeof F!="function"&&F!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,F,J,"setState")},C.prototype.forceUpdate=function(F){this.updater.enqueueForceUpdate(this,F,"forceUpdate")};function M(){}M.prototype=C.prototype;function R(F,J,ie){this.props=F,this.context=J,this.refs=N,this.updater=ie||w}var _=R.prototype=new M;_.constructor=R,S(_,C.prototype),_.isPureReactComponent=!0;var j=Array.isArray;function P(){}var D={H:null,A:null,T:null,S:null},U=Object.prototype.hasOwnProperty;function V(F,J,ie){var pe=ie.ref;return{$$typeof:n,type:F,key:J,ref:pe!==void 0?pe:null,props:ie}}function q(F,J){return V(F.type,J,F.props)}function G(F){return typeof F=="object"&&F!==null&&F.$$typeof===n}function ee(F){var J={"=":"=0",":":"=2"};return"$"+F.replace(/[=:]/g,function(ie){return J[ie]})}var W=/\/+/g;function Q(F,J){return typeof F=="object"&&F!==null&&F.key!=null?ee(""+F.key):J.toString(36)}function Z(F){switch(F.status){case"fulfilled":return F.value;case"rejected":throw F.reason;default:switch(typeof F.status=="string"?F.then(P,P):(F.status="pending",F.then(function(J){F.status==="pending"&&(F.status="fulfilled",F.value=J)},function(J){F.status==="pending"&&(F.status="rejected",F.reason=J)})),F.status){case"fulfilled":return F.value;case"rejected":throw F.reason}}throw F}function $(F,J,ie,pe,ue){var ke=typeof F;(ke==="undefined"||ke==="boolean")&&(F=null);var re=!1;if(F===null)re=!0;else switch(ke){case"bigint":case"string":case"number":re=!0;break;case"object":switch(F.$$typeof){case n:case e:re=!0;break;case f:return re=F._init,$(re(F._payload),J,ie,pe,ue)}}if(re)return ue=ue(F),re=pe===""?"."+Q(F,0):pe,j(ue)?(ie="",re!=null&&(ie=re.replace(W,"$&/")+"/"),$(ue,J,ie,"",function(Qe){return Qe})):ue!=null&&(G(ue)&&(ue=q(ue,ie+(ue.key==null||F&&F.key===ue.key?"":(""+ue.key).replace(W,"$&/")+"/")+re)),J.push(ue)),1;re=0;var Ge=pe===""?".":pe+":";if(j(F))for(var Je=0;Je<F.length;Je++)pe=F[Je],ke=Ge+Q(pe,Je),re+=$(pe,J,ie,ke,ue);else if(Je=b(F),typeof Je=="function")for(F=Je.call(F),Je=0;!(pe=F.next()).done;)pe=pe.value,ke=Ge+Q(pe,Je++),re+=$(pe,J,ie,ke,ue);else if(ke==="object"){if(typeof F.then=="function")return $(Z(F),J,ie,pe,ue);throw J=String(F),Error("Objects are not valid as a React child (found: "+(J==="[object Object]"?"object with keys {"+Object.keys(F).join(", ")+"}":J)+"). If you meant to render a collection of children, use an array instead.")}return re}function Y(F,J,ie){if(F==null)return F;var pe=[],ue=0;return $(F,pe,"","",function(ke){return J.call(ie,ke,ue++)}),pe}function he(F){if(F._status===-1){var J=F._result;J=J(),J.then(function(ie){(F._status===0||F._status===-1)&&(F._status=1,F._result=ie)},function(ie){(F._status===0||F._status===-1)&&(F._status=2,F._result=ie)}),F._status===-1&&(F._status=0,F._result=J)}if(F._status===1)return F._result.default;throw F._result}var Re=typeof reportError=="function"?reportError:function(F){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var J=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof F=="object"&&F!==null&&typeof F.message=="string"?String(F.message):String(F),error:F});if(!window.dispatchEvent(J))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",F);return}console.error(F)},ze={map:Y,forEach:function(F,J,ie){Y(F,function(){J.apply(this,arguments)},ie)},count:function(F){var J=0;return Y(F,function(){J++}),J},toArray:function(F){return Y(F,function(J){return J})||[]},only:function(F){if(!G(F))throw Error("React.Children.only expected to receive a single React element child.");return F}};return bt.Activity=p,bt.Children=ze,bt.Component=C,bt.Fragment=t,bt.Profiler=i,bt.PureComponent=R,bt.StrictMode=s,bt.Suspense=l,bt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,bt.__COMPILER_RUNTIME={__proto__:null,c:function(F){return D.H.useMemoCache(F)}},bt.cache=function(F){return function(){return F.apply(null,arguments)}},bt.cacheSignal=function(){return null},bt.cloneElement=function(F,J,ie){if(F==null)throw Error("The argument must be a React element, but you passed "+F+".");var pe=S({},F.props),ue=F.key;if(J!=null)for(ke in J.key!==void 0&&(ue=""+J.key),J)!U.call(J,ke)||ke==="key"||ke==="__self"||ke==="__source"||ke==="ref"&&J.ref===void 0||(pe[ke]=J[ke]);var ke=arguments.length-2;if(ke===1)pe.children=ie;else if(1<ke){for(var re=Array(ke),Ge=0;Ge<ke;Ge++)re[Ge]=arguments[Ge+2];pe.children=re}return V(F.type,ue,pe)},bt.createContext=function(F){return F={$$typeof:o,_currentValue:F,_currentValue2:F,_threadCount:0,Provider:null,Consumer:null},F.Provider=F,F.Consumer={$$typeof:r,_context:F},F},bt.createElement=function(F,J,ie){var pe,ue={},ke=null;if(J!=null)for(pe in J.key!==void 0&&(ke=""+J.key),J)U.call(J,pe)&&pe!=="key"&&pe!=="__self"&&pe!=="__source"&&(ue[pe]=J[pe]);var re=arguments.length-2;if(re===1)ue.children=ie;else if(1<re){for(var Ge=Array(re),Je=0;Je<re;Je++)Ge[Je]=arguments[Je+2];ue.children=Ge}if(F&&F.defaultProps)for(pe in re=F.defaultProps,re)ue[pe]===void 0&&(ue[pe]=re[pe]);return V(F,ke,ue)},bt.createRef=function(){return{current:null}},bt.forwardRef=function(F){return{$$typeof:a,render:F}},bt.isValidElement=G,bt.lazy=function(F){return{$$typeof:f,_payload:{_status:-1,_result:F},_init:he}},bt.memo=function(F,J){return{$$typeof:u,type:F,compare:J===void 0?null:J}},bt.startTransition=function(F){var J=D.T,ie={};D.T=ie;try{var pe=F(),ue=D.S;ue!==null&&ue(ie,pe),typeof pe=="object"&&pe!==null&&typeof pe.then=="function"&&pe.then(P,Re)}catch(ke){Re(ke)}finally{J!==null&&ie.types!==null&&(J.types=ie.types),D.T=J}},bt.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},bt.use=function(F){return D.H.use(F)},bt.useActionState=function(F,J,ie){return D.H.useActionState(F,J,ie)},bt.useCallback=function(F,J){return D.H.useCallback(F,J)},bt.useContext=function(F){return D.H.useContext(F)},bt.useDebugValue=function(){},bt.useDeferredValue=function(F,J){return D.H.useDeferredValue(F,J)},bt.useEffect=function(F,J){return D.H.useEffect(F,J)},bt.useEffectEvent=function(F){return D.H.useEffectEvent(F)},bt.useId=function(){return D.H.useId()},bt.useImperativeHandle=function(F,J,ie){return D.H.useImperativeHandle(F,J,ie)},bt.useInsertionEffect=function(F,J){return D.H.useInsertionEffect(F,J)},bt.useLayoutEffect=function(F,J){return D.H.useLayoutEffect(F,J)},bt.useMemo=function(F,J){return D.H.useMemo(F,J)},bt.useOptimistic=function(F,J){return D.H.useOptimistic(F,J)},bt.useReducer=function(F,J,ie){return D.H.useReducer(F,J,ie)},bt.useRef=function(F){return D.H.useRef(F)},bt.useState=function(F){return D.H.useState(F)},bt.useSyncExternalStore=function(F,J,ie){return D.H.useSyncExternalStore(F,J,ie)},bt.useTransition=function(){return D.H.useTransition()},bt.version="19.2.3",bt}var zz;function XT(){return zz||(zz=1,fA.exports=c$()),fA.exports}var T=XT();const Kn=JT(T),d$=o$({__proto__:null,default:Kn},[T]);var pA={exports:{}},Fg={},mA={exports:{}},gA={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dz;function u$(){return Dz||(Dz=1,(function(n){function e($,Y){var he=$.length;$.push(Y);e:for(;0<he;){var Re=he-1>>>1,ze=$[Re];if(0<i(ze,Y))$[Re]=Y,$[he]=ze,he=Re;else break e}}function t($){return $.length===0?null:$[0]}function s($){if($.length===0)return null;var Y=$[0],he=$.pop();if(he!==Y){$[0]=he;e:for(var Re=0,ze=$.length,F=ze>>>1;Re<F;){var J=2*(Re+1)-1,ie=$[J],pe=J+1,ue=$[pe];if(0>i(ie,he))pe<ze&&0>i(ue,ie)?($[Re]=ue,$[pe]=he,Re=pe):($[Re]=ie,$[J]=he,Re=J);else if(pe<ze&&0>i(ue,he))$[Re]=ue,$[pe]=he,Re=pe;else break e}}return Y}function i($,Y){var he=$.sortIndex-Y.sortIndex;return he!==0?he:$.id-Y.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;n.unstable_now=function(){return r.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],f=1,p=null,g=3,b=!1,w=!1,S=!1,N=!1,C=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function _($){for(var Y=t(u);Y!==null;){if(Y.callback===null)s(u);else if(Y.startTime<=$)s(u),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=t(u)}}function j($){if(S=!1,_($),!w)if(t(l)!==null)w=!0,P||(P=!0,ee());else{var Y=t(u);Y!==null&&Z(j,Y.startTime-$)}}var P=!1,D=-1,U=5,V=-1;function q(){return N?!0:!(n.unstable_now()-V<U)}function G(){if(N=!1,P){var $=n.unstable_now();V=$;var Y=!0;try{e:{w=!1,S&&(S=!1,M(D),D=-1),b=!0;var he=g;try{t:{for(_($),p=t(l);p!==null&&!(p.expirationTime>$&&q());){var Re=p.callback;if(typeof Re=="function"){p.callback=null,g=p.priorityLevel;var ze=Re(p.expirationTime<=$);if($=n.unstable_now(),typeof ze=="function"){p.callback=ze,_($),Y=!0;break t}p===t(l)&&s(l),_($)}else s(l);p=t(l)}if(p!==null)Y=!0;else{var F=t(u);F!==null&&Z(j,F.startTime-$),Y=!1}}break e}finally{p=null,g=he,b=!1}Y=void 0}}finally{Y?ee():P=!1}}}var ee;if(typeof R=="function")ee=function(){R(G)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,Q=W.port2;W.port1.onmessage=G,ee=function(){Q.postMessage(null)}}else ee=function(){C(G,0)};function Z($,Y){D=C(function(){$(n.unstable_now())},Y)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function($){$.callback=null},n.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<$?Math.floor(1e3/$):5},n.unstable_getCurrentPriorityLevel=function(){return g},n.unstable_next=function($){switch(g){case 1:case 2:case 3:var Y=3;break;default:Y=g}var he=g;g=Y;try{return $()}finally{g=he}},n.unstable_requestPaint=function(){N=!0},n.unstable_runWithPriority=function($,Y){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var he=g;g=$;try{return Y()}finally{g=he}},n.unstable_scheduleCallback=function($,Y,he){var Re=n.unstable_now();switch(typeof he=="object"&&he!==null?(he=he.delay,he=typeof he=="number"&&0<he?Re+he:Re):he=Re,$){case 1:var ze=-1;break;case 2:ze=250;break;case 5:ze=1073741823;break;case 4:ze=1e4;break;default:ze=5e3}return ze=he+ze,$={id:f++,callback:Y,priorityLevel:$,startTime:he,expirationTime:ze,sortIndex:-1},he>Re?($.sortIndex=he,e(u,$),t(l)===null&&$===t(u)&&(S?(M(D),D=-1):S=!0,Z(j,he-Re))):($.sortIndex=ze,e(l,$),w||b||(w=!0,P||(P=!0,ee()))),$},n.unstable_shouldYield=q,n.unstable_wrapCallback=function($){var Y=g;return function(){var he=g;g=Y;try{return $.apply(this,arguments)}finally{g=he}}}})(gA)),gA}var jz;function h$(){return jz||(jz=1,mA.exports=u$()),mA.exports}var xA={exports:{}},ai={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pz;function f$(){if(Pz)return ai;Pz=1;var n=XT();function e(l){var u="https://react.dev/errors/"+l;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)u+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+l+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function r(l,u,f){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:p==null?null:""+p,children:l,containerInfo:u,implementation:f}}var o=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(l,u){if(l==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return ai.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,ai.createPortal=function(l,u){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return r(l,u,null,f)},ai.flushSync=function(l){var u=o.T,f=s.p;try{if(o.T=null,s.p=2,l)return l()}finally{o.T=u,s.p=f,s.d.f()}},ai.preconnect=function(l,u){typeof l=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,s.d.C(l,u))},ai.prefetchDNS=function(l){typeof l=="string"&&s.d.D(l)},ai.preinit=function(l,u){if(typeof l=="string"&&u&&typeof u.as=="string"){var f=u.as,p=a(f,u.crossOrigin),g=typeof u.integrity=="string"?u.integrity:void 0,b=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;f==="style"?s.d.S(l,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:p,integrity:g,fetchPriority:b}):f==="script"&&s.d.X(l,{crossOrigin:p,integrity:g,fetchPriority:b,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},ai.preinitModule=function(l,u){if(typeof l=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var f=a(u.as,u.crossOrigin);s.d.M(l,{crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&s.d.M(l)},ai.preload=function(l,u){if(typeof l=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var f=u.as,p=a(f,u.crossOrigin);s.d.L(l,f,{crossOrigin:p,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},ai.preloadModule=function(l,u){if(typeof l=="string")if(u){var f=a(u.as,u.crossOrigin);s.d.m(l,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else s.d.m(l)},ai.requestFormReset=function(l){s.d.r(l)},ai.unstable_batchedUpdates=function(l,u){return l(u)},ai.useFormState=function(l,u,f){return o.H.useFormState(l,u,f)},ai.useFormStatus=function(){return o.H.useHostTransitionStatus()},ai.version="19.2.3",ai}var Lz;function SO(){if(Lz)return xA.exports;Lz=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),xA.exports=f$(),xA.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oz;function p$(){if(Oz)return Fg;Oz=1;var n=h$(),e=XT(),t=SO();function s(c){var h="https://react.dev/errors/"+c;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)h+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+c+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function r(c){var h=c,m=c;if(c.alternate)for(;h.return;)h=h.return;else{c=h;do h=c,(h.flags&4098)!==0&&(m=h.return),c=h.return;while(c)}return h.tag===3?m:null}function o(c){if(c.tag===13){var h=c.memoizedState;if(h===null&&(c=c.alternate,c!==null&&(h=c.memoizedState)),h!==null)return h.dehydrated}return null}function a(c){if(c.tag===31){var h=c.memoizedState;if(h===null&&(c=c.alternate,c!==null&&(h=c.memoizedState)),h!==null)return h.dehydrated}return null}function l(c){if(r(c)!==c)throw Error(s(188))}function u(c){var h=c.alternate;if(!h){if(h=r(c),h===null)throw Error(s(188));return h!==c?null:c}for(var m=c,x=h;;){var A=m.return;if(A===null)break;var E=A.alternate;if(E===null){if(x=A.return,x!==null){m=x;continue}break}if(A.child===E.child){for(E=A.child;E;){if(E===m)return l(A),c;if(E===x)return l(A),h;E=E.sibling}throw Error(s(188))}if(m.return!==x.return)m=A,x=E;else{for(var I=!1,B=A.child;B;){if(B===m){I=!0,m=A,x=E;break}if(B===x){I=!0,x=A,m=E;break}B=B.sibling}if(!I){for(B=E.child;B;){if(B===m){I=!0,m=E,x=A;break}if(B===x){I=!0,x=E,m=A;break}B=B.sibling}if(!I)throw Error(s(189))}}if(m.alternate!==x)throw Error(s(190))}if(m.tag!==3)throw Error(s(188));return m.stateNode.current===m?c:h}function f(c){var h=c.tag;if(h===5||h===26||h===27||h===6)return c;for(c=c.child;c!==null;){if(h=f(c),h!==null)return h;c=c.sibling}return null}var p=Object.assign,g=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),M=Symbol.for("react.consumer"),R=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),j=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),U=Symbol.for("react.lazy"),V=Symbol.for("react.activity"),q=Symbol.for("react.memo_cache_sentinel"),G=Symbol.iterator;function ee(c){return c===null||typeof c!="object"?null:(c=G&&c[G]||c["@@iterator"],typeof c=="function"?c:null)}var W=Symbol.for("react.client.reference");function Q(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===W?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case S:return"Fragment";case C:return"Profiler";case N:return"StrictMode";case j:return"Suspense";case P:return"SuspenseList";case V:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case w:return"Portal";case R:return c.displayName||"Context";case M:return(c._context.displayName||"Context")+".Consumer";case _:var h=c.render;return c=c.displayName,c||(c=h.displayName||h.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case D:return h=c.displayName||null,h!==null?h:Q(c.type)||"Memo";case U:h=c._payload,c=c._init;try{return Q(c(h))}catch{}}return null}var Z=Array.isArray,$=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,he={pending:!1,data:null,method:null,action:null},Re=[],ze=-1;function F(c){return{current:c}}function J(c){0>ze||(c.current=Re[ze],Re[ze]=null,ze--)}function ie(c,h){ze++,Re[ze]=c.current,c.current=h}var pe=F(null),ue=F(null),ke=F(null),re=F(null);function Ge(c,h){switch(ie(ke,h),ie(ue,c),ie(pe,null),h.nodeType){case 9:case 11:c=(c=h.documentElement)&&(c=c.namespaceURI)?QI(c):0;break;default:if(c=h.tagName,h=h.namespaceURI)h=QI(h),c=ZI(h,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}J(pe),ie(pe,c)}function Je(){J(pe),J(ue),J(ke)}function Qe(c){c.memoizedState!==null&&ie(re,c);var h=pe.current,m=ZI(h,c.type);h!==m&&(ie(ue,c),ie(pe,m))}function je(c){ue.current===c&&(J(pe),J(ue)),re.current===c&&(J(re),jg._currentValue=he)}var ye,Fe;function Ne(c){if(ye===void 0)try{throw Error()}catch(m){var h=m.stack.trim().match(/\n( *(at )?)/);ye=h&&h[1]||"",Fe=-1<m.stack.indexOf(`
    at`)?" (<anonymous>)":-1<m.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ye+c+Fe}var ve=!1;function Pe(c,h){if(!c||ve)return"";ve=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var x={DetermineComponentFrameRoot:function(){try{if(h){var Ee=function(){throw Error()};if(Object.defineProperty(Ee.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ee,[])}catch(ge){var fe=ge}Reflect.construct(c,[],Ee)}else{try{Ee.call()}catch(ge){fe=ge}c.call(Ee.prototype)}}else{try{throw Error()}catch(ge){fe=ge}(Ee=c())&&typeof Ee.catch=="function"&&Ee.catch(function(){})}}catch(ge){if(ge&&fe&&typeof ge.stack=="string")return[ge.stack,fe.stack]}return[null,null]}};x.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var A=Object.getOwnPropertyDescriptor(x.DetermineComponentFrameRoot,"name");A&&A.configurable&&Object.defineProperty(x.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var E=x.DetermineComponentFrameRoot(),I=E[0],B=E[1];if(I&&B){var X=I.split(`
`),de=B.split(`
`);for(A=x=0;x<X.length&&!X[x].includes("DetermineComponentFrameRoot");)x++;for(;A<de.length&&!de[A].includes("DetermineComponentFrameRoot");)A++;if(x===X.length||A===de.length)for(x=X.length-1,A=de.length-1;1<=x&&0<=A&&X[x]!==de[A];)A--;for(;1<=x&&0<=A;x--,A--)if(X[x]!==de[A]){if(x!==1||A!==1)do if(x--,A--,0>A||X[x]!==de[A]){var we=`
`+X[x].replace(" at new "," at ");return c.displayName&&we.includes("<anonymous>")&&(we=we.replace("<anonymous>",c.displayName)),we}while(1<=x&&0<=A);break}}}finally{ve=!1,Error.prepareStackTrace=m}return(m=c?c.displayName||c.name:"")?Ne(m):""}function ot(c,h){switch(c.tag){case 26:case 27:case 5:return Ne(c.type);case 16:return Ne("Lazy");case 13:return c.child!==h&&h!==null?Ne("Suspense Fallback"):Ne("Suspense");case 19:return Ne("SuspenseList");case 0:case 15:return Pe(c.type,!1);case 11:return Pe(c.type.render,!1);case 1:return Pe(c.type,!0);case 31:return Ne("Activity");default:return""}}function Gt(c){try{var h="",m=null;do h+=ot(c,m),m=c,c=c.return;while(c);return h}catch(x){return`
Error generating stack: `+x.message+`
`+x.stack}}var bn=Object.prototype.hasOwnProperty,qt=n.unstable_scheduleCallback,jt=n.unstable_cancelCallback,yn=n.unstable_shouldYield,_t=n.unstable_requestPaint,Qt=n.unstable_now,_s=n.unstable_getCurrentPriorityLevel,Se=n.unstable_ImmediatePriority,Me=n.unstable_UserBlockingPriority,He=n.unstable_NormalPriority,Pt=n.unstable_LowPriority,Sn=n.unstable_IdlePriority,as=n.log,Xn=n.unstable_setDisableYieldValue,De=null,se=null;function Oe(c){if(typeof as=="function"&&Xn(c),se&&typeof se.setStrictMode=="function")try{se.setStrictMode(De,c)}catch{}}var Ke=Math.clz32?Math.clz32:Le,me=Math.log,xe=Math.LN2;function Le(c){return c>>>=0,c===0?32:31-(me(c)/xe|0)|0}var Ue=256,lt=262144,Mt=4194304;function Ht(c){var h=c&42;if(h!==0)return h;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return c&261888;case 262144:case 524288:case 1048576:case 2097152:return c&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function Cn(c,h,m){var x=c.pendingLanes;if(x===0)return 0;var A=0,E=c.suspendedLanes,I=c.pingedLanes;c=c.warmLanes;var B=x&134217727;return B!==0?(x=B&~E,x!==0?A=Ht(x):(I&=B,I!==0?A=Ht(I):m||(m=B&~c,m!==0&&(A=Ht(m))))):(B=x&~E,B!==0?A=Ht(B):I!==0?A=Ht(I):m||(m=x&~c,m!==0&&(A=Ht(m)))),A===0?0:h!==0&&h!==A&&(h&E)===0&&(E=A&-A,m=h&-h,E>=m||E===32&&(m&4194048)!==0)?h:A}function Zt(c,h){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&h)===0}function Pn(c,h){switch(c){case 1:case 2:case 4:case 8:case 64:return h+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Hn(){var c=Mt;return Mt<<=1,(Mt&62914560)===0&&(Mt=4194304),c}function Bi(c){for(var h=[],m=0;31>m;m++)h.push(c);return h}function ys(c,h){c.pendingLanes|=h,h!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function of(c,h,m,x,A,E){var I=c.pendingLanes;c.pendingLanes=m,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=m,c.entangledLanes&=m,c.errorRecoveryDisabledLanes&=m,c.shellSuspendCounter=0;var B=c.entanglements,X=c.expirationTimes,de=c.hiddenUpdates;for(m=I&~m;0<m;){var we=31-Ke(m),Ee=1<<we;B[we]=0,X[we]=-1;var fe=de[we];if(fe!==null)for(de[we]=null,we=0;we<fe.length;we++){var ge=fe[we];ge!==null&&(ge.lane&=-536870913)}m&=~Ee}x!==0&&ls(c,x,0),E!==0&&A===0&&c.tag!==0&&(c.suspendedLanes|=E&~(I&~h))}function ls(c,h,m){c.pendingLanes|=h,c.suspendedLanes&=~h;var x=31-Ke(h);c.entangledLanes|=h,c.entanglements[x]=c.entanglements[x]|1073741824|m&261930}function rr(c,h){var m=c.entangledLanes|=h;for(c=c.entanglements;m;){var x=31-Ke(m),A=1<<x;A&h|c[x]&h&&(c[x]|=h),m&=~A}}function qo(c,h){var m=h&-h;return m=(m&42)!==0?1:Wo(m),(m&(c.suspendedLanes|h))!==0?0:m}function Wo(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function Fa(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function af(){var c=Y.p;return c!==0?c:(c=window.event,c===void 0?32:kz(c.type))}function ic(c,h){var m=Y.p;try{return Y.p=c,h()}finally{Y.p=m}}var ri=Math.random().toString(36).slice(2),Un="__reactFiber$"+ri,at="__reactProps$"+ri,vn="__reactContainer$"+ri,Ko="__reactEvents$"+ri,nC="__reactListeners$"+ri,Yb="__reactHandles$"+ri,sC="__reactResources$"+ri,Kd="__reactMarker$"+ri;function rc(c){delete c[Un],delete c[at],delete c[Ko],delete c[nC],delete c[Yb]}function oc(c){var h=c[Un];if(h)return h;for(var m=c.parentNode;m;){if(h=m[vn]||m[Un]){if(m=h.alternate,h.child!==null||m!==null&&m.child!==null)for(c=oz(c);c!==null;){if(m=c[Un])return m;c=oz(c)}return h}c=m,m=c.parentNode}return null}function Ha(c){if(c=c[Un]||c[vn]){var h=c.tag;if(h===5||h===6||h===13||h===31||h===26||h===27||h===3)return c}return null}function Ua(c){var h=c.tag;if(h===5||h===26||h===27||h===6)return c.stateNode;throw Error(s(33))}function Yo(c){var h=c[sC];return h||(h=c[sC]={hoistableStyles:new Map,hoistableScripts:new Map}),h}function cs(c){c[Kd]=!0}var lf=new Set,Jb={};function Jo(c,h){ac(c,h),ac(c+"Capture",h)}function ac(c,h){for(Jb[c]=h,c=0;c<h.length;c++)lf.add(h[c])}var Xb=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Qb={},Wm={};function iC(c){return bn.call(Wm,c)?!0:bn.call(Qb,c)?!1:Xb.test(c)?Wm[c]=!0:(Qb[c]=!0,!1)}function lc(c,h,m){if(iC(h))if(m===null)c.removeAttribute(h);else{switch(typeof m){case"undefined":case"function":case"symbol":c.removeAttribute(h);return;case"boolean":var x=h.toLowerCase().slice(0,5);if(x!=="data-"&&x!=="aria-"){c.removeAttribute(h);return}}c.setAttribute(h,""+m)}}function cf(c,h,m){if(m===null)c.removeAttribute(h);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(h);return}c.setAttribute(h,""+m)}}function Pr(c,h,m,x){if(x===null)c.removeAttribute(m);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(m);return}c.setAttributeNS(h,m,""+x)}}function vs(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function cc(c){var h=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function rC(c,h,m){var x=Object.getOwnPropertyDescriptor(c.constructor.prototype,h);if(!c.hasOwnProperty(h)&&typeof x<"u"&&typeof x.get=="function"&&typeof x.set=="function"){var A=x.get,E=x.set;return Object.defineProperty(c,h,{configurable:!0,get:function(){return A.call(this)},set:function(I){m=""+I,E.call(this,I)}}),Object.defineProperty(c,h,{enumerable:x.enumerable}),{getValue:function(){return m},setValue:function(I){m=""+I},stopTracking:function(){c._valueTracker=null,delete c[h]}}}}function df(c){if(!c._valueTracker){var h=cc(c)?"checked":"value";c._valueTracker=rC(c,h,""+c[h])}}function Zb(c){if(!c)return!1;var h=c._valueTracker;if(!h)return!0;var m=h.getValue(),x="";return c&&(x=cc(c)?c.checked?"true":"false":c.value),c=x,c!==m?(h.setValue(c),!0):!1}function Yd(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var oC=/[\n"\\]/g;function Ci(c){return c.replace(oC,function(h){return"\\"+h.charCodeAt(0).toString(16)+" "})}function Km(c,h,m,x,A,E,I,B){c.name="",I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"?c.type=I:c.removeAttribute("type"),h!=null?I==="number"?(h===0&&c.value===""||c.value!=h)&&(c.value=""+vs(h)):c.value!==""+vs(h)&&(c.value=""+vs(h)):I!=="submit"&&I!=="reset"||c.removeAttribute("value"),h!=null?Jm(c,I,vs(h)):m!=null?Jm(c,I,vs(m)):x!=null&&c.removeAttribute("value"),A==null&&E!=null&&(c.defaultChecked=!!E),A!=null&&(c.checked=A&&typeof A!="function"&&typeof A!="symbol"),B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?c.name=""+vs(B):c.removeAttribute("name")}function Ym(c,h,m,x,A,E,I,B){if(E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(c.type=E),h!=null||m!=null){if(!(E!=="submit"&&E!=="reset"||h!=null)){df(c);return}m=m!=null?""+vs(m):"",h=h!=null?""+vs(h):m,B||h===c.value||(c.value=h),c.defaultValue=h}x=x??A,x=typeof x!="function"&&typeof x!="symbol"&&!!x,c.checked=B?c.checked:!!x,c.defaultChecked=!!x,I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"&&(c.name=I),df(c)}function Jm(c,h,m){h==="number"&&Yd(c.ownerDocument)===c||c.defaultValue===""+m||(c.defaultValue=""+m)}function dc(c,h,m,x){if(c=c.options,h){h={};for(var A=0;A<m.length;A++)h["$"+m[A]]=!0;for(m=0;m<c.length;m++)A=h.hasOwnProperty("$"+c[m].value),c[m].selected!==A&&(c[m].selected=A),A&&x&&(c[m].defaultSelected=!0)}else{for(m=""+vs(m),h=null,A=0;A<c.length;A++){if(c[A].value===m){c[A].selected=!0,x&&(c[A].defaultSelected=!0);return}h!==null||c[A].disabled||(h=c[A])}h!==null&&(h.selected=!0)}}function uc(c,h,m){if(h!=null&&(h=""+vs(h),h!==c.value&&(c.value=h),m==null)){c.defaultValue!==h&&(c.defaultValue=h);return}c.defaultValue=m!=null?""+vs(m):""}function uf(c,h,m,x){if(h==null){if(x!=null){if(m!=null)throw Error(s(92));if(Z(x)){if(1<x.length)throw Error(s(93));x=x[0]}m=x}m==null&&(m=""),h=m}m=vs(h),c.defaultValue=m,x=c.textContent,x===m&&x!==""&&x!==null&&(c.value=x),df(c)}function hc(c,h){if(h){var m=c.firstChild;if(m&&m===c.lastChild&&m.nodeType===3){m.nodeValue=h;return}}c.textContent=h}var Rn=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function hf(c,h,m){var x=h.indexOf("--")===0;m==null||typeof m=="boolean"||m===""?x?c.setProperty(h,""):h==="float"?c.cssFloat="":c[h]="":x?c.setProperty(h,m):typeof m!="number"||m===0||Rn.has(h)?h==="float"?c.cssFloat=m:c[h]=(""+m).trim():c[h]=m+"px"}function ey(c,h,m){if(h!=null&&typeof h!="object")throw Error(s(62));if(c=c.style,m!=null){for(var x in m)!m.hasOwnProperty(x)||h!=null&&h.hasOwnProperty(x)||(x.indexOf("--")===0?c.setProperty(x,""):x==="float"?c.cssFloat="":c[x]="");for(var A in h)x=h[A],h.hasOwnProperty(A)&&m[A]!==x&&hf(c,A,x)}else for(var E in h)h.hasOwnProperty(E)&&hf(c,E,h[E])}function Xm(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var aC=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),lC=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ff(c){return lC.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}function go(){}var Qm=null;function Zm(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var fc=null,Qn=null;function ty(c){var h=Ha(c);if(h&&(c=h.stateNode)){var m=c[at]||null;e:switch(c=h.stateNode,h.type){case"input":if(Km(c,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name),h=m.name,m.type==="radio"&&h!=null){for(m=c;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll('input[name="'+Ci(""+h)+'"][type="radio"]'),h=0;h<m.length;h++){var x=m[h];if(x!==c&&x.form===c.form){var A=x[at]||null;if(!A)throw Error(s(90));Km(x,A.value,A.defaultValue,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name)}}for(h=0;h<m.length;h++)x=m[h],x.form===c.form&&Zb(x)}break e;case"textarea":uc(c,m.value,m.defaultValue);break e;case"select":h=m.value,h!=null&&dc(c,!!m.multiple,h,!1)}}}var eg=!1;function ny(c,h,m){if(eg)return c(h,m);eg=!0;try{var x=c(h);return x}finally{if(eg=!1,(fc!==null||Qn!==null)&&(Vy(),fc&&(h=fc,c=Qn,Qn=fc=null,ty(h),c)))for(h=0;h<c.length;h++)ty(c[h])}}function xo(c,h){var m=c.stateNode;if(m===null)return null;var x=m[at]||null;if(x===null)return null;m=x[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(c=c.type,x=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!x;break e;default:c=!1}if(c)return null;if(m&&typeof m!="function")throw Error(s(231,h,typeof m));return m}var bo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),tg=!1;if(bo)try{var pc={};Object.defineProperty(pc,"passive",{get:function(){tg=!0}}),window.addEventListener("test",pc,pc),window.removeEventListener("test",pc,pc)}catch{tg=!1}var Xo=null,ng=null,Jd=null;function sy(){if(Jd)return Jd;var c,h=ng,m=h.length,x,A="value"in Xo?Xo.value:Xo.textContent,E=A.length;for(c=0;c<m&&h[c]===A[c];c++);var I=m-c;for(x=1;x<=I&&h[m-x]===A[E-x];x++);return Jd=A.slice(c,1<x?1-x:void 0)}function pf(c){var h=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&h===13&&(c=13)):c=h,c===10&&(c=13),32<=c||c===13?c:0}function mf(){return!0}function iy(){return!1}function oi(c){function h(m,x,A,E,I){this._reactName=m,this._targetInst=A,this.type=x,this.nativeEvent=E,this.target=I,this.currentTarget=null;for(var B in c)c.hasOwnProperty(B)&&(m=c[B],this[B]=m?m(E):E[B]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?mf:iy,this.isPropagationStopped=iy,this}return p(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=mf)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=mf)},persist:function(){},isPersistent:mf}),h}var $a={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gf=oi($a),Xd=p({},$a,{view:0,detail:0}),cC=oi(Xd),sg,ig,Qd,mc=p({},Xd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ay,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==Qd&&(Qd&&c.type==="mousemove"?(sg=c.screenX-Qd.screenX,ig=c.screenY-Qd.screenY):ig=sg=0,Qd=c),sg)},movementY:function(c){return"movementY"in c?c.movementY:ig}}),ry=oi(mc),dC=p({},mc,{dataTransfer:0}),uC=oi(dC),V2=p({},Xd,{relatedTarget:0}),oy=oi(V2),q2=p({},$a,{animationName:0,elapsedTime:0,pseudoElement:0}),W2=oi(q2),K2=p({},$a,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),Y2=oi(K2),J2=p({},$a,{data:0}),hC=oi(J2),X2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Q2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Z2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function eM(c){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(c):(c=Z2[c])?!!h[c]:!1}function ay(){return eM}var tM=p({},Xd,{key:function(c){if(c.key){var h=X2[c.key]||c.key;if(h!=="Unidentified")return h}return c.type==="keypress"?(c=pf(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?Q2[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ay,charCode:function(c){return c.type==="keypress"?pf(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?pf(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),nM=oi(tM),sM=p({},mc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fC=oi(sM),iM=p({},Xd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ay}),rM=oi(iM),oM=p({},$a,{propertyName:0,elapsedTime:0,pseudoElement:0}),aM=oi(oM),lM=p({},mc,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),cM=oi(lM),dM=p({},$a,{newState:0,oldState:0}),uM=oi(dM),hM=[9,13,27,32],ly=bo&&"CompositionEvent"in window,xf=null;bo&&"documentMode"in document&&(xf=document.documentMode);var fM=bo&&"TextEvent"in window&&!xf,pC=bo&&(!ly||xf&&8<xf&&11>=xf),mC=" ",gC=!1;function xC(c,h){switch(c){case"keyup":return hM.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function bC(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var Zd=!1;function pM(c,h){switch(c){case"compositionend":return bC(h);case"keypress":return h.which!==32?null:(gC=!0,mC);case"textInput":return c=h.data,c===mC&&gC?null:c;default:return null}}function mM(c,h){if(Zd)return c==="compositionend"||!ly&&xC(c,h)?(c=sy(),Jd=ng=Xo=null,Zd=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return pC&&h.locale!=="ko"?null:h.data;default:return null}}var yC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function K(c){var h=c&&c.nodeName&&c.nodeName.toLowerCase();return h==="input"?!!yC[c.type]:h==="textarea"}function ae(c,h,m,x){fc?Qn?Qn.push(x):Qn=[x]:fc=x,h=Qy(h,"onChange"),0<h.length&&(m=new gf("onChange","change",null,m,x),c.push({event:m,listeners:h}))}var be=null,le=null;function Ae(c){qI(c,0)}function $e(c){var h=Ua(c);if(Zb(h))return c}function ht(c,h){if(c==="change")return h}var yt=!1;if(bo){var kt;if(bo){var ln="oninput"in document;if(!ln){var Ms=document.createElement("div");Ms.setAttribute("oninput","return;"),ln=typeof Ms.oninput=="function"}kt=ln}else kt=!1;yt=kt&&(!document.documentMode||9<document.documentMode)}function bf(){be&&(be.detachEvent("onpropertychange",cy),le=be=null)}function cy(c){if(c.propertyName==="value"&&$e(le)){var h=[];ae(h,le,c,Zm(c)),ny(Ae,h)}}function dy(c,h,m){c==="focusin"?(bf(),be=h,le=m,be.attachEvent("onpropertychange",cy)):c==="focusout"&&bf()}function zH(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return $e(le)}function DH(c,h){if(c==="click")return $e(h)}function jH(c,h){if(c==="input"||c==="change")return $e(h)}function PH(c,h){return c===h&&(c!==0||1/c===1/h)||c!==c&&h!==h}var or=typeof Object.is=="function"?Object.is:PH;function rg(c,h){if(or(c,h))return!0;if(typeof c!="object"||c===null||typeof h!="object"||h===null)return!1;var m=Object.keys(c),x=Object.keys(h);if(m.length!==x.length)return!1;for(x=0;x<m.length;x++){var A=m[x];if(!bn.call(h,A)||!or(c[A],h[A]))return!1}return!0}function gM(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function xM(c,h){var m=gM(c);c=0;for(var x;m;){if(m.nodeType===3){if(x=c+m.textContent.length,c<=h&&x>=h)return{node:m,offset:h-c};c=x}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=gM(m)}}function bM(c,h){return c&&h?c===h?!0:c&&c.nodeType===3?!1:h&&h.nodeType===3?bM(c,h.parentNode):"contains"in c?c.contains(h):c.compareDocumentPosition?!!(c.compareDocumentPosition(h)&16):!1:!1}function yM(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var h=Yd(c.document);h instanceof c.HTMLIFrameElement;){try{var m=typeof h.contentWindow.location.href=="string"}catch{m=!1}if(m)c=h.contentWindow;else break;h=Yd(c.document)}return h}function vC(c){var h=c&&c.nodeName&&c.nodeName.toLowerCase();return h&&(h==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||h==="textarea"||c.contentEditable==="true")}var LH=bo&&"documentMode"in document&&11>=document.documentMode,yf=null,wC=null,og=null,kC=!1;function vM(c,h,m){var x=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;kC||yf==null||yf!==Yd(x)||(x=yf,"selectionStart"in x&&vC(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),og&&rg(og,x)||(og=x,x=Qy(wC,"onSelect"),0<x.length&&(h=new gf("onSelect","select",null,h,m),c.push({event:h,listeners:x}),h.target=yf)))}function eu(c,h){var m={};return m[c.toLowerCase()]=h.toLowerCase(),m["Webkit"+c]="webkit"+h,m["Moz"+c]="moz"+h,m}var vf={animationend:eu("Animation","AnimationEnd"),animationiteration:eu("Animation","AnimationIteration"),animationstart:eu("Animation","AnimationStart"),transitionrun:eu("Transition","TransitionRun"),transitionstart:eu("Transition","TransitionStart"),transitioncancel:eu("Transition","TransitionCancel"),transitionend:eu("Transition","TransitionEnd")},SC={},wM={};bo&&(wM=document.createElement("div").style,"AnimationEvent"in window||(delete vf.animationend.animation,delete vf.animationiteration.animation,delete vf.animationstart.animation),"TransitionEvent"in window||delete vf.transitionend.transition);function tu(c){if(SC[c])return SC[c];if(!vf[c])return c;var h=vf[c],m;for(m in h)if(h.hasOwnProperty(m)&&m in wM)return SC[c]=h[m];return c}var kM=tu("animationend"),SM=tu("animationiteration"),CM=tu("animationstart"),OH=tu("transitionrun"),BH=tu("transitionstart"),FH=tu("transitioncancel"),AM=tu("transitionend"),NM=new Map,CC="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");CC.push("scrollEnd");function yo(c,h){NM.set(c,h),Jo(h,[c])}var uy=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var h=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(h))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)},Lr=[],wf=0,AC=0;function hy(){for(var c=wf,h=AC=wf=0;h<c;){var m=Lr[h];Lr[h++]=null;var x=Lr[h];Lr[h++]=null;var A=Lr[h];Lr[h++]=null;var E=Lr[h];if(Lr[h++]=null,x!==null&&A!==null){var I=x.pending;I===null?A.next=A:(A.next=I.next,I.next=A),x.pending=A}E!==0&&EM(m,A,E)}}function fy(c,h,m,x){Lr[wf++]=c,Lr[wf++]=h,Lr[wf++]=m,Lr[wf++]=x,AC|=x,c.lanes|=x,c=c.alternate,c!==null&&(c.lanes|=x)}function NC(c,h,m,x){return fy(c,h,m,x),py(c)}function nu(c,h){return fy(c,null,null,h),py(c)}function EM(c,h,m){c.lanes|=m;var x=c.alternate;x!==null&&(x.lanes|=m);for(var A=!1,E=c.return;E!==null;)E.childLanes|=m,x=E.alternate,x!==null&&(x.childLanes|=m),E.tag===22&&(c=E.stateNode,c===null||c._visibility&1||(A=!0)),c=E,E=E.return;return c.tag===3?(E=c.stateNode,A&&h!==null&&(A=31-Ke(m),c=E.hiddenUpdates,x=c[A],x===null?c[A]=[h]:x.push(h),h.lane=m|536870912),E):null}function py(c){if(50<Tg)throw Tg=0,j1=null,Error(s(185));for(var h=c.return;h!==null;)c=h,h=c.return;return c.tag===3?c.stateNode:null}var kf={};function HH(c,h,m,x){this.tag=c,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ar(c,h,m,x){return new HH(c,h,m,x)}function EC(c){return c=c.prototype,!(!c||!c.isReactComponent)}function Ga(c,h){var m=c.alternate;return m===null?(m=ar(c.tag,h,c.key,c.mode),m.elementType=c.elementType,m.type=c.type,m.stateNode=c.stateNode,m.alternate=c,c.alternate=m):(m.pendingProps=h,m.type=c.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=c.flags&65011712,m.childLanes=c.childLanes,m.lanes=c.lanes,m.child=c.child,m.memoizedProps=c.memoizedProps,m.memoizedState=c.memoizedState,m.updateQueue=c.updateQueue,h=c.dependencies,m.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},m.sibling=c.sibling,m.index=c.index,m.ref=c.ref,m.refCleanup=c.refCleanup,m}function TM(c,h){c.flags&=65011714;var m=c.alternate;return m===null?(c.childLanes=0,c.lanes=h,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=m.childLanes,c.lanes=m.lanes,c.child=m.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=m.memoizedProps,c.memoizedState=m.memoizedState,c.updateQueue=m.updateQueue,c.type=m.type,h=m.dependencies,c.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),c}function my(c,h,m,x,A,E){var I=0;if(x=c,typeof c=="function")EC(c)&&(I=1);else if(typeof c=="string")I=qU(c,m,pe.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case V:return c=ar(31,m,h,A),c.elementType=V,c.lanes=E,c;case S:return su(m.children,A,E,h);case N:I=8,A|=24;break;case C:return c=ar(12,m,h,A|2),c.elementType=C,c.lanes=E,c;case j:return c=ar(13,m,h,A),c.elementType=j,c.lanes=E,c;case P:return c=ar(19,m,h,A),c.elementType=P,c.lanes=E,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case R:I=10;break e;case M:I=9;break e;case _:I=11;break e;case D:I=14;break e;case U:I=16,x=null;break e}I=29,m=Error(s(130,c===null?"null":typeof c,"")),x=null}return h=ar(I,m,h,A),h.elementType=c,h.type=x,h.lanes=E,h}function su(c,h,m,x){return c=ar(7,c,x,h),c.lanes=m,c}function TC(c,h,m){return c=ar(6,c,null,h),c.lanes=m,c}function _M(c){var h=ar(18,null,null,0);return h.stateNode=c,h}function _C(c,h,m){return h=ar(4,c.children!==null?c.children:[],c.key,h),h.lanes=m,h.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},h}var MM=new WeakMap;function Or(c,h){if(typeof c=="object"&&c!==null){var m=MM.get(c);return m!==void 0?m:(h={value:c,source:h,stack:Gt(h)},MM.set(c,h),h)}return{value:c,source:h,stack:Gt(h)}}var Sf=[],Cf=0,gy=null,ag=0,Br=[],Fr=0,gc=null,Qo=1,Zo="";function Va(c,h){Sf[Cf++]=ag,Sf[Cf++]=gy,gy=c,ag=h}function RM(c,h,m){Br[Fr++]=Qo,Br[Fr++]=Zo,Br[Fr++]=gc,gc=c;var x=Qo;c=Zo;var A=32-Ke(x)-1;x&=~(1<<A),m+=1;var E=32-Ke(h)+A;if(30<E){var I=A-A%5;E=(x&(1<<I)-1).toString(32),x>>=I,A-=I,Qo=1<<32-Ke(h)+A|m<<A|x,Zo=E+c}else Qo=1<<E|m<<A|x,Zo=c}function MC(c){c.return!==null&&(Va(c,1),RM(c,1,0))}function RC(c){for(;c===gy;)gy=Sf[--Cf],Sf[Cf]=null,ag=Sf[--Cf],Sf[Cf]=null;for(;c===gc;)gc=Br[--Fr],Br[Fr]=null,Zo=Br[--Fr],Br[Fr]=null,Qo=Br[--Fr],Br[Fr]=null}function IM(c,h){Br[Fr++]=Qo,Br[Fr++]=Zo,Br[Fr++]=gc,Qo=h.id,Zo=h.overflow,gc=c}var qs=null,An=null,Ut=!1,xc=null,Hr=!1,IC=Error(s(519));function bc(c){var h=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw lg(Or(h,c)),IC}function zM(c){var h=c.stateNode,m=c.type,x=c.memoizedProps;switch(h[Un]=c,h[at]=x,m){case"dialog":Dt("cancel",h),Dt("close",h);break;case"iframe":case"object":case"embed":Dt("load",h);break;case"video":case"audio":for(m=0;m<Mg.length;m++)Dt(Mg[m],h);break;case"source":Dt("error",h);break;case"img":case"image":case"link":Dt("error",h),Dt("load",h);break;case"details":Dt("toggle",h);break;case"input":Dt("invalid",h),Ym(h,x.value,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name,!0);break;case"select":Dt("invalid",h);break;case"textarea":Dt("invalid",h),uf(h,x.value,x.defaultValue,x.children)}m=x.children,typeof m!="string"&&typeof m!="number"&&typeof m!="bigint"||h.textContent===""+m||x.suppressHydrationWarning===!0||JI(h.textContent,m)?(x.popover!=null&&(Dt("beforetoggle",h),Dt("toggle",h)),x.onScroll!=null&&Dt("scroll",h),x.onScrollEnd!=null&&Dt("scrollend",h),x.onClick!=null&&(h.onclick=go),h=!0):h=!1,h||bc(c,!0)}function DM(c){for(qs=c.return;qs;)switch(qs.tag){case 5:case 31:case 13:Hr=!1;return;case 27:case 3:Hr=!0;return;default:qs=qs.return}}function Af(c){if(c!==qs)return!1;if(!Ut)return DM(c),Ut=!0,!1;var h=c.tag,m;if((m=h!==3&&h!==27)&&((m=h===5)&&(m=c.type,m=!(m!=="form"&&m!=="button")||J1(c.type,c.memoizedProps)),m=!m),m&&An&&bc(c),DM(c),h===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(s(317));An=rz(c)}else if(h===31){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(s(317));An=rz(c)}else h===27?(h=An,Ic(c.type)?(c=tA,tA=null,An=c):An=h):An=qs?$r(c.stateNode.nextSibling):null;return!0}function iu(){An=qs=null,Ut=!1}function zC(){var c=xc;return c!==null&&($i===null?$i=c:$i.push.apply($i,c),xc=null),c}function lg(c){xc===null?xc=[c]:xc.push(c)}var DC=F(null),ru=null,qa=null;function yc(c,h,m){ie(DC,h._currentValue),h._currentValue=m}function Wa(c){c._currentValue=DC.current,J(DC)}function jC(c,h,m){for(;c!==null;){var x=c.alternate;if((c.childLanes&h)!==h?(c.childLanes|=h,x!==null&&(x.childLanes|=h)):x!==null&&(x.childLanes&h)!==h&&(x.childLanes|=h),c===m)break;c=c.return}}function PC(c,h,m,x){var A=c.child;for(A!==null&&(A.return=c);A!==null;){var E=A.dependencies;if(E!==null){var I=A.child;E=E.firstContext;e:for(;E!==null;){var B=E;E=A;for(var X=0;X<h.length;X++)if(B.context===h[X]){E.lanes|=m,B=E.alternate,B!==null&&(B.lanes|=m),jC(E.return,m,c),x||(I=null);break e}E=B.next}}else if(A.tag===18){if(I=A.return,I===null)throw Error(s(341));I.lanes|=m,E=I.alternate,E!==null&&(E.lanes|=m),jC(I,m,c),I=null}else I=A.child;if(I!==null)I.return=A;else for(I=A;I!==null;){if(I===c){I=null;break}if(A=I.sibling,A!==null){A.return=I.return,I=A;break}I=I.return}A=I}}function Nf(c,h,m,x){c=null;for(var A=h,E=!1;A!==null;){if(!E){if((A.flags&524288)!==0)E=!0;else if((A.flags&262144)!==0)break}if(A.tag===10){var I=A.alternate;if(I===null)throw Error(s(387));if(I=I.memoizedProps,I!==null){var B=A.type;or(A.pendingProps.value,I.value)||(c!==null?c.push(B):c=[B])}}else if(A===re.current){if(I=A.alternate,I===null)throw Error(s(387));I.memoizedState.memoizedState!==A.memoizedState.memoizedState&&(c!==null?c.push(jg):c=[jg])}A=A.return}c!==null&&PC(h,c,m,x),h.flags|=262144}function xy(c){for(c=c.firstContext;c!==null;){if(!or(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function ou(c){ru=c,qa=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function Ws(c){return jM(ru,c)}function by(c,h){return ru===null&&ou(c),jM(c,h)}function jM(c,h){var m=h._currentValue;if(h={context:h,memoizedValue:m,next:null},qa===null){if(c===null)throw Error(s(308));qa=h,c.dependencies={lanes:0,firstContext:h},c.flags|=524288}else qa=qa.next=h;return m}var UH=typeof AbortController<"u"?AbortController:function(){var c=[],h=this.signal={aborted:!1,addEventListener:function(m,x){c.push(x)}};this.abort=function(){h.aborted=!0,c.forEach(function(m){return m()})}},$H=n.unstable_scheduleCallback,GH=n.unstable_NormalPriority,ds={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function LC(){return{controller:new UH,data:new Map,refCount:0}}function cg(c){c.refCount--,c.refCount===0&&$H(GH,function(){c.controller.abort()})}var dg=null,OC=0,Ef=0,Tf=null;function VH(c,h){if(dg===null){var m=dg=[];OC=0,Ef=H1(),Tf={status:"pending",value:void 0,then:function(x){m.push(x)}}}return OC++,h.then(PM,PM),h}function PM(){if(--OC===0&&dg!==null){Tf!==null&&(Tf.status="fulfilled");var c=dg;dg=null,Ef=0,Tf=null;for(var h=0;h<c.length;h++)(0,c[h])()}}function qH(c,h){var m=[],x={status:"pending",value:null,reason:null,then:function(A){m.push(A)}};return c.then(function(){x.status="fulfilled",x.value=h;for(var A=0;A<m.length;A++)(0,m[A])(h)},function(A){for(x.status="rejected",x.reason=A,A=0;A<m.length;A++)(0,m[A])(void 0)}),x}var LM=$.S;$.S=function(c,h){vI=Qt(),typeof h=="object"&&h!==null&&typeof h.then=="function"&&VH(c,h),LM!==null&&LM(c,h)};var au=F(null);function BC(){var c=au.current;return c!==null?c:mn.pooledCache}function yy(c,h){h===null?ie(au,au.current):ie(au,h.pool)}function OM(){var c=BC();return c===null?null:{parent:ds._currentValue,pool:c}}var _f=Error(s(460)),FC=Error(s(474)),vy=Error(s(542)),wy={then:function(){}};function BM(c){return c=c.status,c==="fulfilled"||c==="rejected"}function FM(c,h,m){switch(m=c[m],m===void 0?c.push(h):m!==h&&(h.then(go,go),h=m),h.status){case"fulfilled":return h.value;case"rejected":throw c=h.reason,UM(c),c;default:if(typeof h.status=="string")h.then(go,go);else{if(c=mn,c!==null&&100<c.shellSuspendCounter)throw Error(s(482));c=h,c.status="pending",c.then(function(x){if(h.status==="pending"){var A=h;A.status="fulfilled",A.value=x}},function(x){if(h.status==="pending"){var A=h;A.status="rejected",A.reason=x}})}switch(h.status){case"fulfilled":return h.value;case"rejected":throw c=h.reason,UM(c),c}throw cu=h,_f}}function lu(c){try{var h=c._init;return h(c._payload)}catch(m){throw m!==null&&typeof m=="object"&&typeof m.then=="function"?(cu=m,_f):m}}var cu=null;function HM(){if(cu===null)throw Error(s(459));var c=cu;return cu=null,c}function UM(c){if(c===_f||c===vy)throw Error(s(483))}var Mf=null,ug=0;function ky(c){var h=ug;return ug+=1,Mf===null&&(Mf=[]),FM(Mf,c,h)}function hg(c,h){h=h.props.ref,c.ref=h!==void 0?h:null}function Sy(c,h){throw h.$$typeof===g?Error(s(525)):(c=Object.prototype.toString.call(h),Error(s(31,c==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":c)))}function $M(c){function h(oe,ne){if(c){var ce=oe.deletions;ce===null?(oe.deletions=[ne],oe.flags|=16):ce.push(ne)}}function m(oe,ne){if(!c)return null;for(;ne!==null;)h(oe,ne),ne=ne.sibling;return null}function x(oe){for(var ne=new Map;oe!==null;)oe.key!==null?ne.set(oe.key,oe):ne.set(oe.index,oe),oe=oe.sibling;return ne}function A(oe,ne){return oe=Ga(oe,ne),oe.index=0,oe.sibling=null,oe}function E(oe,ne,ce){return oe.index=ce,c?(ce=oe.alternate,ce!==null?(ce=ce.index,ce<ne?(oe.flags|=67108866,ne):ce):(oe.flags|=67108866,ne)):(oe.flags|=1048576,ne)}function I(oe){return c&&oe.alternate===null&&(oe.flags|=67108866),oe}function B(oe,ne,ce,Ce){return ne===null||ne.tag!==6?(ne=TC(ce,oe.mode,Ce),ne.return=oe,ne):(ne=A(ne,ce),ne.return=oe,ne)}function X(oe,ne,ce,Ce){var ct=ce.type;return ct===S?we(oe,ne,ce.props.children,Ce,ce.key):ne!==null&&(ne.elementType===ct||typeof ct=="object"&&ct!==null&&ct.$$typeof===U&&lu(ct)===ne.type)?(ne=A(ne,ce.props),hg(ne,ce),ne.return=oe,ne):(ne=my(ce.type,ce.key,ce.props,null,oe.mode,Ce),hg(ne,ce),ne.return=oe,ne)}function de(oe,ne,ce,Ce){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==ce.containerInfo||ne.stateNode.implementation!==ce.implementation?(ne=_C(ce,oe.mode,Ce),ne.return=oe,ne):(ne=A(ne,ce.children||[]),ne.return=oe,ne)}function we(oe,ne,ce,Ce,ct){return ne===null||ne.tag!==7?(ne=su(ce,oe.mode,Ce,ct),ne.return=oe,ne):(ne=A(ne,ce),ne.return=oe,ne)}function Ee(oe,ne,ce){if(typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint")return ne=TC(""+ne,oe.mode,ce),ne.return=oe,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case b:return ce=my(ne.type,ne.key,ne.props,null,oe.mode,ce),hg(ce,ne),ce.return=oe,ce;case w:return ne=_C(ne,oe.mode,ce),ne.return=oe,ne;case U:return ne=lu(ne),Ee(oe,ne,ce)}if(Z(ne)||ee(ne))return ne=su(ne,oe.mode,ce,null),ne.return=oe,ne;if(typeof ne.then=="function")return Ee(oe,ky(ne),ce);if(ne.$$typeof===R)return Ee(oe,by(oe,ne),ce);Sy(oe,ne)}return null}function fe(oe,ne,ce,Ce){var ct=ne!==null?ne.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return ct!==null?null:B(oe,ne,""+ce,Ce);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case b:return ce.key===ct?X(oe,ne,ce,Ce):null;case w:return ce.key===ct?de(oe,ne,ce,Ce):null;case U:return ce=lu(ce),fe(oe,ne,ce,Ce)}if(Z(ce)||ee(ce))return ct!==null?null:we(oe,ne,ce,Ce,null);if(typeof ce.then=="function")return fe(oe,ne,ky(ce),Ce);if(ce.$$typeof===R)return fe(oe,ne,by(oe,ce),Ce);Sy(oe,ce)}return null}function ge(oe,ne,ce,Ce,ct){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return oe=oe.get(ce)||null,B(ne,oe,""+Ce,ct);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case b:return oe=oe.get(Ce.key===null?ce:Ce.key)||null,X(ne,oe,Ce,ct);case w:return oe=oe.get(Ce.key===null?ce:Ce.key)||null,de(ne,oe,Ce,ct);case U:return Ce=lu(Ce),ge(oe,ne,ce,Ce,ct)}if(Z(Ce)||ee(Ce))return oe=oe.get(ce)||null,we(ne,oe,Ce,ct,null);if(typeof Ce.then=="function")return ge(oe,ne,ce,ky(Ce),ct);if(Ce.$$typeof===R)return ge(oe,ne,ce,by(ne,Ce),ct);Sy(ne,Ce)}return null}function et(oe,ne,ce,Ce){for(var ct=null,Wt=null,st=ne,St=ne=0,Ot=null;st!==null&&St<ce.length;St++){st.index>St?(Ot=st,st=null):Ot=st.sibling;var Kt=fe(oe,st,ce[St],Ce);if(Kt===null){st===null&&(st=Ot);break}c&&st&&Kt.alternate===null&&h(oe,st),ne=E(Kt,ne,St),Wt===null?ct=Kt:Wt.sibling=Kt,Wt=Kt,st=Ot}if(St===ce.length)return m(oe,st),Ut&&Va(oe,St),ct;if(st===null){for(;St<ce.length;St++)st=Ee(oe,ce[St],Ce),st!==null&&(ne=E(st,ne,St),Wt===null?ct=st:Wt.sibling=st,Wt=st);return Ut&&Va(oe,St),ct}for(st=x(st);St<ce.length;St++)Ot=ge(st,oe,St,ce[St],Ce),Ot!==null&&(c&&Ot.alternate!==null&&st.delete(Ot.key===null?St:Ot.key),ne=E(Ot,ne,St),Wt===null?ct=Ot:Wt.sibling=Ot,Wt=Ot);return c&&st.forEach(function(Lc){return h(oe,Lc)}),Ut&&Va(oe,St),ct}function ft(oe,ne,ce,Ce){if(ce==null)throw Error(s(151));for(var ct=null,Wt=null,st=ne,St=ne=0,Ot=null,Kt=ce.next();st!==null&&!Kt.done;St++,Kt=ce.next()){st.index>St?(Ot=st,st=null):Ot=st.sibling;var Lc=fe(oe,st,Kt.value,Ce);if(Lc===null){st===null&&(st=Ot);break}c&&st&&Lc.alternate===null&&h(oe,st),ne=E(Lc,ne,St),Wt===null?ct=Lc:Wt.sibling=Lc,Wt=Lc,st=Ot}if(Kt.done)return m(oe,st),Ut&&Va(oe,St),ct;if(st===null){for(;!Kt.done;St++,Kt=ce.next())Kt=Ee(oe,Kt.value,Ce),Kt!==null&&(ne=E(Kt,ne,St),Wt===null?ct=Kt:Wt.sibling=Kt,Wt=Kt);return Ut&&Va(oe,St),ct}for(st=x(st);!Kt.done;St++,Kt=ce.next())Kt=ge(st,oe,St,Kt.value,Ce),Kt!==null&&(c&&Kt.alternate!==null&&st.delete(Kt.key===null?St:Kt.key),ne=E(Kt,ne,St),Wt===null?ct=Kt:Wt.sibling=Kt,Wt=Kt);return c&&st.forEach(function(s$){return h(oe,s$)}),Ut&&Va(oe,St),ct}function un(oe,ne,ce,Ce){if(typeof ce=="object"&&ce!==null&&ce.type===S&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case b:e:{for(var ct=ce.key;ne!==null;){if(ne.key===ct){if(ct=ce.type,ct===S){if(ne.tag===7){m(oe,ne.sibling),Ce=A(ne,ce.props.children),Ce.return=oe,oe=Ce;break e}}else if(ne.elementType===ct||typeof ct=="object"&&ct!==null&&ct.$$typeof===U&&lu(ct)===ne.type){m(oe,ne.sibling),Ce=A(ne,ce.props),hg(Ce,ce),Ce.return=oe,oe=Ce;break e}m(oe,ne);break}else h(oe,ne);ne=ne.sibling}ce.type===S?(Ce=su(ce.props.children,oe.mode,Ce,ce.key),Ce.return=oe,oe=Ce):(Ce=my(ce.type,ce.key,ce.props,null,oe.mode,Ce),hg(Ce,ce),Ce.return=oe,oe=Ce)}return I(oe);case w:e:{for(ct=ce.key;ne!==null;){if(ne.key===ct)if(ne.tag===4&&ne.stateNode.containerInfo===ce.containerInfo&&ne.stateNode.implementation===ce.implementation){m(oe,ne.sibling),Ce=A(ne,ce.children||[]),Ce.return=oe,oe=Ce;break e}else{m(oe,ne);break}else h(oe,ne);ne=ne.sibling}Ce=_C(ce,oe.mode,Ce),Ce.return=oe,oe=Ce}return I(oe);case U:return ce=lu(ce),un(oe,ne,ce,Ce)}if(Z(ce))return et(oe,ne,ce,Ce);if(ee(ce)){if(ct=ee(ce),typeof ct!="function")throw Error(s(150));return ce=ct.call(ce),ft(oe,ne,ce,Ce)}if(typeof ce.then=="function")return un(oe,ne,ky(ce),Ce);if(ce.$$typeof===R)return un(oe,ne,by(oe,ce),Ce);Sy(oe,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint"?(ce=""+ce,ne!==null&&ne.tag===6?(m(oe,ne.sibling),Ce=A(ne,ce),Ce.return=oe,oe=Ce):(m(oe,ne),Ce=TC(ce,oe.mode,Ce),Ce.return=oe,oe=Ce),I(oe)):m(oe,ne)}return function(oe,ne,ce,Ce){try{ug=0;var ct=un(oe,ne,ce,Ce);return Mf=null,ct}catch(st){if(st===_f||st===vy)throw st;var Wt=ar(29,st,null,oe.mode);return Wt.lanes=Ce,Wt.return=oe,Wt}finally{}}}var du=$M(!0),GM=$M(!1),vc=!1;function HC(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function UC(c,h){c=c.updateQueue,h.updateQueue===c&&(h.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function wc(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function kc(c,h,m){var x=c.updateQueue;if(x===null)return null;if(x=x.shared,(en&2)!==0){var A=x.pending;return A===null?h.next=h:(h.next=A.next,A.next=h),x.pending=h,h=py(c),EM(c,null,m),h}return fy(c,x,h,m),py(c)}function fg(c,h,m){if(h=h.updateQueue,h!==null&&(h=h.shared,(m&4194048)!==0)){var x=h.lanes;x&=c.pendingLanes,m|=x,h.lanes=m,rr(c,m)}}function $C(c,h){var m=c.updateQueue,x=c.alternate;if(x!==null&&(x=x.updateQueue,m===x)){var A=null,E=null;if(m=m.firstBaseUpdate,m!==null){do{var I={lane:m.lane,tag:m.tag,payload:m.payload,callback:null,next:null};E===null?A=E=I:E=E.next=I,m=m.next}while(m!==null);E===null?A=E=h:E=E.next=h}else A=E=h;m={baseState:x.baseState,firstBaseUpdate:A,lastBaseUpdate:E,shared:x.shared,callbacks:x.callbacks},c.updateQueue=m;return}c=m.lastBaseUpdate,c===null?m.firstBaseUpdate=h:c.next=h,m.lastBaseUpdate=h}var GC=!1;function pg(){if(GC){var c=Tf;if(c!==null)throw c}}function mg(c,h,m,x){GC=!1;var A=c.updateQueue;vc=!1;var E=A.firstBaseUpdate,I=A.lastBaseUpdate,B=A.shared.pending;if(B!==null){A.shared.pending=null;var X=B,de=X.next;X.next=null,I===null?E=de:I.next=de,I=X;var we=c.alternate;we!==null&&(we=we.updateQueue,B=we.lastBaseUpdate,B!==I&&(B===null?we.firstBaseUpdate=de:B.next=de,we.lastBaseUpdate=X))}if(E!==null){var Ee=A.baseState;I=0,we=de=X=null,B=E;do{var fe=B.lane&-536870913,ge=fe!==B.lane;if(ge?(Lt&fe)===fe:(x&fe)===fe){fe!==0&&fe===Ef&&(GC=!0),we!==null&&(we=we.next={lane:0,tag:B.tag,payload:B.payload,callback:null,next:null});e:{var et=c,ft=B;fe=h;var un=m;switch(ft.tag){case 1:if(et=ft.payload,typeof et=="function"){Ee=et.call(un,Ee,fe);break e}Ee=et;break e;case 3:et.flags=et.flags&-65537|128;case 0:if(et=ft.payload,fe=typeof et=="function"?et.call(un,Ee,fe):et,fe==null)break e;Ee=p({},Ee,fe);break e;case 2:vc=!0}}fe=B.callback,fe!==null&&(c.flags|=64,ge&&(c.flags|=8192),ge=A.callbacks,ge===null?A.callbacks=[fe]:ge.push(fe))}else ge={lane:fe,tag:B.tag,payload:B.payload,callback:B.callback,next:null},we===null?(de=we=ge,X=Ee):we=we.next=ge,I|=fe;if(B=B.next,B===null){if(B=A.shared.pending,B===null)break;ge=B,B=ge.next,ge.next=null,A.lastBaseUpdate=ge,A.shared.pending=null}}while(!0);we===null&&(X=Ee),A.baseState=X,A.firstBaseUpdate=de,A.lastBaseUpdate=we,E===null&&(A.shared.lanes=0),Ec|=I,c.lanes=I,c.memoizedState=Ee}}function VM(c,h){if(typeof c!="function")throw Error(s(191,c));c.call(h)}function qM(c,h){var m=c.callbacks;if(m!==null)for(c.callbacks=null,c=0;c<m.length;c++)VM(m[c],h)}var Rf=F(null),Cy=F(0);function WM(c,h){c=nl,ie(Cy,c),ie(Rf,h),nl=c|h.baseLanes}function VC(){ie(Cy,nl),ie(Rf,Rf.current)}function qC(){nl=Cy.current,J(Rf),J(Cy)}var lr=F(null),Ur=null;function Sc(c){var h=c.alternate;ie(Zn,Zn.current&1),ie(lr,c),Ur===null&&(h===null||Rf.current!==null||h.memoizedState!==null)&&(Ur=c)}function WC(c){ie(Zn,Zn.current),ie(lr,c),Ur===null&&(Ur=c)}function KM(c){c.tag===22?(ie(Zn,Zn.current),ie(lr,c),Ur===null&&(Ur=c)):Cc()}function Cc(){ie(Zn,Zn.current),ie(lr,lr.current)}function cr(c){J(lr),Ur===c&&(Ur=null),J(Zn)}var Zn=F(0);function Ay(c){for(var h=c;h!==null;){if(h.tag===13){var m=h.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||Z1(m)||eA(m)))return h}else if(h.tag===19&&(h.memoizedProps.revealOrder==="forwards"||h.memoizedProps.revealOrder==="backwards"||h.memoizedProps.revealOrder==="unstable_legacy-backwards"||h.memoizedProps.revealOrder==="together")){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===c)break;for(;h.sibling===null;){if(h.return===null||h.return===c)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var Ka=0,vt=null,cn=null,us=null,Ny=!1,If=!1,uu=!1,Ey=0,gg=0,zf=null,WH=0;function $n(){throw Error(s(321))}function KC(c,h){if(h===null)return!1;for(var m=0;m<h.length&&m<c.length;m++)if(!or(c[m],h[m]))return!1;return!0}function YC(c,h,m,x,A,E){return Ka=E,vt=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,$.H=c===null||c.memoizedState===null?RR:d1,uu=!1,E=m(x,A),uu=!1,If&&(E=JM(h,m,x,A)),YM(c),E}function YM(c){$.H=yg;var h=cn!==null&&cn.next!==null;if(Ka=0,us=cn=vt=null,Ny=!1,gg=0,zf=null,h)throw Error(s(300));c===null||hs||(c=c.dependencies,c!==null&&xy(c)&&(hs=!0))}function JM(c,h,m,x){vt=c;var A=0;do{if(If&&(zf=null),gg=0,If=!1,25<=A)throw Error(s(301));if(A+=1,us=cn=null,c.updateQueue!=null){var E=c.updateQueue;E.lastEffect=null,E.events=null,E.stores=null,E.memoCache!=null&&(E.memoCache.index=0)}$.H=IR,E=h(m,x)}while(If);return E}function KH(){var c=$.H,h=c.useState()[0];return h=typeof h.then=="function"?xg(h):h,c=c.useState()[0],(cn!==null?cn.memoizedState:null)!==c&&(vt.flags|=1024),h}function JC(){var c=Ey!==0;return Ey=0,c}function XC(c,h,m){h.updateQueue=c.updateQueue,h.flags&=-2053,c.lanes&=~m}function QC(c){if(Ny){for(c=c.memoizedState;c!==null;){var h=c.queue;h!==null&&(h.pending=null),c=c.next}Ny=!1}Ka=0,us=cn=vt=null,If=!1,gg=Ey=0,zf=null}function Ai(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return us===null?vt.memoizedState=us=c:us=us.next=c,us}function es(){if(cn===null){var c=vt.alternate;c=c!==null?c.memoizedState:null}else c=cn.next;var h=us===null?vt.memoizedState:us.next;if(h!==null)us=h,cn=c;else{if(c===null)throw vt.alternate===null?Error(s(467)):Error(s(310));cn=c,c={memoizedState:cn.memoizedState,baseState:cn.baseState,baseQueue:cn.baseQueue,queue:cn.queue,next:null},us===null?vt.memoizedState=us=c:us=us.next=c}return us}function Ty(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function xg(c){var h=gg;return gg+=1,zf===null&&(zf=[]),c=FM(zf,c,h),h=vt,(us===null?h.memoizedState:us.next)===null&&(h=h.alternate,$.H=h===null||h.memoizedState===null?RR:d1),c}function _y(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return xg(c);if(c.$$typeof===R)return Ws(c)}throw Error(s(438,String(c)))}function ZC(c){var h=null,m=vt.updateQueue;if(m!==null&&(h=m.memoCache),h==null){var x=vt.alternate;x!==null&&(x=x.updateQueue,x!==null&&(x=x.memoCache,x!=null&&(h={data:x.data.map(function(A){return A.slice()}),index:0})))}if(h==null&&(h={data:[],index:0}),m===null&&(m=Ty(),vt.updateQueue=m),m.memoCache=h,m=h.data[h.index],m===void 0)for(m=h.data[h.index]=Array(c),x=0;x<c;x++)m[x]=q;return h.index++,m}function Ya(c,h){return typeof h=="function"?h(c):h}function My(c){var h=es();return e1(h,cn,c)}function e1(c,h,m){var x=c.queue;if(x===null)throw Error(s(311));x.lastRenderedReducer=m;var A=c.baseQueue,E=x.pending;if(E!==null){if(A!==null){var I=A.next;A.next=E.next,E.next=I}h.baseQueue=A=E,x.pending=null}if(E=c.baseState,A===null)c.memoizedState=E;else{h=A.next;var B=I=null,X=null,de=h,we=!1;do{var Ee=de.lane&-536870913;if(Ee!==de.lane?(Lt&Ee)===Ee:(Ka&Ee)===Ee){var fe=de.revertLane;if(fe===0)X!==null&&(X=X.next={lane:0,revertLane:0,gesture:null,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null}),Ee===Ef&&(we=!0);else if((Ka&fe)===fe){de=de.next,fe===Ef&&(we=!0);continue}else Ee={lane:0,revertLane:de.revertLane,gesture:null,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null},X===null?(B=X=Ee,I=E):X=X.next=Ee,vt.lanes|=fe,Ec|=fe;Ee=de.action,uu&&m(E,Ee),E=de.hasEagerState?de.eagerState:m(E,Ee)}else fe={lane:Ee,revertLane:de.revertLane,gesture:de.gesture,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null},X===null?(B=X=fe,I=E):X=X.next=fe,vt.lanes|=Ee,Ec|=Ee;de=de.next}while(de!==null&&de!==h);if(X===null?I=E:X.next=B,!or(E,c.memoizedState)&&(hs=!0,we&&(m=Tf,m!==null)))throw m;c.memoizedState=E,c.baseState=I,c.baseQueue=X,x.lastRenderedState=E}return A===null&&(x.lanes=0),[c.memoizedState,x.dispatch]}function t1(c){var h=es(),m=h.queue;if(m===null)throw Error(s(311));m.lastRenderedReducer=c;var x=m.dispatch,A=m.pending,E=h.memoizedState;if(A!==null){m.pending=null;var I=A=A.next;do E=c(E,I.action),I=I.next;while(I!==A);or(E,h.memoizedState)||(hs=!0),h.memoizedState=E,h.baseQueue===null&&(h.baseState=E),m.lastRenderedState=E}return[E,x]}function XM(c,h,m){var x=vt,A=es(),E=Ut;if(E){if(m===void 0)throw Error(s(407));m=m()}else m=h();var I=!or((cn||A).memoizedState,m);if(I&&(A.memoizedState=m,hs=!0),A=A.queue,i1(eR.bind(null,x,A,c),[c]),A.getSnapshot!==h||I||us!==null&&us.memoizedState.tag&1){if(x.flags|=2048,Df(9,{destroy:void 0},ZM.bind(null,x,A,m,h),null),mn===null)throw Error(s(349));E||(Ka&127)!==0||QM(x,h,m)}return m}function QM(c,h,m){c.flags|=16384,c={getSnapshot:h,value:m},h=vt.updateQueue,h===null?(h=Ty(),vt.updateQueue=h,h.stores=[c]):(m=h.stores,m===null?h.stores=[c]:m.push(c))}function ZM(c,h,m,x){h.value=m,h.getSnapshot=x,tR(h)&&nR(c)}function eR(c,h,m){return m(function(){tR(h)&&nR(c)})}function tR(c){var h=c.getSnapshot;c=c.value;try{var m=h();return!or(c,m)}catch{return!0}}function nR(c){var h=nu(c,2);h!==null&&Gi(h,c,2)}function n1(c){var h=Ai();if(typeof c=="function"){var m=c;if(c=m(),uu){Oe(!0);try{m()}finally{Oe(!1)}}}return h.memoizedState=h.baseState=c,h.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ya,lastRenderedState:c},h}function sR(c,h,m,x){return c.baseState=m,e1(c,cn,typeof x=="function"?x:Ya)}function YH(c,h,m,x,A){if(zy(c))throw Error(s(485));if(c=h.action,c!==null){var E={payload:A,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(I){E.listeners.push(I)}};$.T!==null?m(!0):E.isTransition=!1,x(E),m=h.pending,m===null?(E.next=h.pending=E,iR(h,E)):(E.next=m.next,h.pending=m.next=E)}}function iR(c,h){var m=h.action,x=h.payload,A=c.state;if(h.isTransition){var E=$.T,I={};$.T=I;try{var B=m(A,x),X=$.S;X!==null&&X(I,B),rR(c,h,B)}catch(de){s1(c,h,de)}finally{E!==null&&I.types!==null&&(E.types=I.types),$.T=E}}else try{E=m(A,x),rR(c,h,E)}catch(de){s1(c,h,de)}}function rR(c,h,m){m!==null&&typeof m=="object"&&typeof m.then=="function"?m.then(function(x){oR(c,h,x)},function(x){return s1(c,h,x)}):oR(c,h,m)}function oR(c,h,m){h.status="fulfilled",h.value=m,aR(h),c.state=m,h=c.pending,h!==null&&(m=h.next,m===h?c.pending=null:(m=m.next,h.next=m,iR(c,m)))}function s1(c,h,m){var x=c.pending;if(c.pending=null,x!==null){x=x.next;do h.status="rejected",h.reason=m,aR(h),h=h.next;while(h!==x)}c.action=null}function aR(c){c=c.listeners;for(var h=0;h<c.length;h++)(0,c[h])()}function lR(c,h){return h}function cR(c,h){if(Ut){var m=mn.formState;if(m!==null){e:{var x=vt;if(Ut){if(An){t:{for(var A=An,E=Hr;A.nodeType!==8;){if(!E){A=null;break t}if(A=$r(A.nextSibling),A===null){A=null;break t}}E=A.data,A=E==="F!"||E==="F"?A:null}if(A){An=$r(A.nextSibling),x=A.data==="F!";break e}}bc(x)}x=!1}x&&(h=m[0])}}return m=Ai(),m.memoizedState=m.baseState=h,x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:lR,lastRenderedState:h},m.queue=x,m=TR.bind(null,vt,x),x.dispatch=m,x=n1(!1),E=c1.bind(null,vt,!1,x.queue),x=Ai(),A={state:h,dispatch:null,action:c,pending:null},x.queue=A,m=YH.bind(null,vt,A,E,m),A.dispatch=m,x.memoizedState=c,[h,m,!1]}function dR(c){var h=es();return uR(h,cn,c)}function uR(c,h,m){if(h=e1(c,h,lR)[0],c=My(Ya)[0],typeof h=="object"&&h!==null&&typeof h.then=="function")try{var x=xg(h)}catch(I){throw I===_f?vy:I}else x=h;h=es();var A=h.queue,E=A.dispatch;return m!==h.memoizedState&&(vt.flags|=2048,Df(9,{destroy:void 0},JH.bind(null,A,m),null)),[x,E,c]}function JH(c,h){c.action=h}function hR(c){var h=es(),m=cn;if(m!==null)return uR(h,m,c);es(),h=h.memoizedState,m=es();var x=m.queue.dispatch;return m.memoizedState=c,[h,x,!1]}function Df(c,h,m,x){return c={tag:c,create:m,deps:x,inst:h,next:null},h=vt.updateQueue,h===null&&(h=Ty(),vt.updateQueue=h),m=h.lastEffect,m===null?h.lastEffect=c.next=c:(x=m.next,m.next=c,c.next=x,h.lastEffect=c),c}function fR(){return es().memoizedState}function Ry(c,h,m,x){var A=Ai();vt.flags|=c,A.memoizedState=Df(1|h,{destroy:void 0},m,x===void 0?null:x)}function Iy(c,h,m,x){var A=es();x=x===void 0?null:x;var E=A.memoizedState.inst;cn!==null&&x!==null&&KC(x,cn.memoizedState.deps)?A.memoizedState=Df(h,E,m,x):(vt.flags|=c,A.memoizedState=Df(1|h,E,m,x))}function pR(c,h){Ry(8390656,8,c,h)}function i1(c,h){Iy(2048,8,c,h)}function XH(c){vt.flags|=4;var h=vt.updateQueue;if(h===null)h=Ty(),vt.updateQueue=h,h.events=[c];else{var m=h.events;m===null?h.events=[c]:m.push(c)}}function mR(c){var h=es().memoizedState;return XH({ref:h,nextImpl:c}),function(){if((en&2)!==0)throw Error(s(440));return h.impl.apply(void 0,arguments)}}function gR(c,h){return Iy(4,2,c,h)}function xR(c,h){return Iy(4,4,c,h)}function bR(c,h){if(typeof h=="function"){c=c();var m=h(c);return function(){typeof m=="function"?m():h(null)}}if(h!=null)return c=c(),h.current=c,function(){h.current=null}}function yR(c,h,m){m=m!=null?m.concat([c]):null,Iy(4,4,bR.bind(null,h,c),m)}function r1(){}function vR(c,h){var m=es();h=h===void 0?null:h;var x=m.memoizedState;return h!==null&&KC(h,x[1])?x[0]:(m.memoizedState=[c,h],c)}function wR(c,h){var m=es();h=h===void 0?null:h;var x=m.memoizedState;if(h!==null&&KC(h,x[1]))return x[0];if(x=c(),uu){Oe(!0);try{c()}finally{Oe(!1)}}return m.memoizedState=[x,h],x}function o1(c,h,m){return m===void 0||(Ka&1073741824)!==0&&(Lt&261930)===0?c.memoizedState=h:(c.memoizedState=m,c=kI(),vt.lanes|=c,Ec|=c,m)}function kR(c,h,m,x){return or(m,h)?m:Rf.current!==null?(c=o1(c,m,x),or(c,h)||(hs=!0),c):(Ka&42)===0||(Ka&1073741824)!==0&&(Lt&261930)===0?(hs=!0,c.memoizedState=m):(c=kI(),vt.lanes|=c,Ec|=c,h)}function SR(c,h,m,x,A){var E=Y.p;Y.p=E!==0&&8>E?E:8;var I=$.T,B={};$.T=B,c1(c,!1,h,m);try{var X=A(),de=$.S;if(de!==null&&de(B,X),X!==null&&typeof X=="object"&&typeof X.then=="function"){var we=qH(X,x);bg(c,h,we,hr(c))}else bg(c,h,x,hr(c))}catch(Ee){bg(c,h,{then:function(){},status:"rejected",reason:Ee},hr())}finally{Y.p=E,I!==null&&B.types!==null&&(I.types=B.types),$.T=I}}function QH(){}function a1(c,h,m,x){if(c.tag!==5)throw Error(s(476));var A=CR(c).queue;SR(c,A,h,he,m===null?QH:function(){return AR(c),m(x)})}function CR(c){var h=c.memoizedState;if(h!==null)return h;h={memoizedState:he,baseState:he,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ya,lastRenderedState:he},next:null};var m={};return h.next={memoizedState:m,baseState:m,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ya,lastRenderedState:m},next:null},c.memoizedState=h,c=c.alternate,c!==null&&(c.memoizedState=h),h}function AR(c){var h=CR(c);h.next===null&&(h=c.alternate.memoizedState),bg(c,h.next.queue,{},hr())}function l1(){return Ws(jg)}function NR(){return es().memoizedState}function ER(){return es().memoizedState}function ZH(c){for(var h=c.return;h!==null;){switch(h.tag){case 24:case 3:var m=hr();c=wc(m);var x=kc(h,c,m);x!==null&&(Gi(x,h,m),fg(x,h,m)),h={cache:LC()},c.payload=h;return}h=h.return}}function eU(c,h,m){var x=hr();m={lane:x,revertLane:0,gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},zy(c)?_R(h,m):(m=NC(c,h,m,x),m!==null&&(Gi(m,c,x),MR(m,h,x)))}function TR(c,h,m){var x=hr();bg(c,h,m,x)}function bg(c,h,m,x){var A={lane:x,revertLane:0,gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null};if(zy(c))_R(h,A);else{var E=c.alternate;if(c.lanes===0&&(E===null||E.lanes===0)&&(E=h.lastRenderedReducer,E!==null))try{var I=h.lastRenderedState,B=E(I,m);if(A.hasEagerState=!0,A.eagerState=B,or(B,I))return fy(c,h,A,0),mn===null&&hy(),!1}catch{}finally{}if(m=NC(c,h,A,x),m!==null)return Gi(m,c,x),MR(m,h,x),!0}return!1}function c1(c,h,m,x){if(x={lane:2,revertLane:H1(),gesture:null,action:x,hasEagerState:!1,eagerState:null,next:null},zy(c)){if(h)throw Error(s(479))}else h=NC(c,m,x,2),h!==null&&Gi(h,c,2)}function zy(c){var h=c.alternate;return c===vt||h!==null&&h===vt}function _R(c,h){If=Ny=!0;var m=c.pending;m===null?h.next=h:(h.next=m.next,m.next=h),c.pending=h}function MR(c,h,m){if((m&4194048)!==0){var x=h.lanes;x&=c.pendingLanes,m|=x,h.lanes=m,rr(c,m)}}var yg={readContext:Ws,use:_y,useCallback:$n,useContext:$n,useEffect:$n,useImperativeHandle:$n,useLayoutEffect:$n,useInsertionEffect:$n,useMemo:$n,useReducer:$n,useRef:$n,useState:$n,useDebugValue:$n,useDeferredValue:$n,useTransition:$n,useSyncExternalStore:$n,useId:$n,useHostTransitionStatus:$n,useFormState:$n,useActionState:$n,useOptimistic:$n,useMemoCache:$n,useCacheRefresh:$n};yg.useEffectEvent=$n;var RR={readContext:Ws,use:_y,useCallback:function(c,h){return Ai().memoizedState=[c,h===void 0?null:h],c},useContext:Ws,useEffect:pR,useImperativeHandle:function(c,h,m){m=m!=null?m.concat([c]):null,Ry(4194308,4,bR.bind(null,h,c),m)},useLayoutEffect:function(c,h){return Ry(4194308,4,c,h)},useInsertionEffect:function(c,h){Ry(4,2,c,h)},useMemo:function(c,h){var m=Ai();h=h===void 0?null:h;var x=c();if(uu){Oe(!0);try{c()}finally{Oe(!1)}}return m.memoizedState=[x,h],x},useReducer:function(c,h,m){var x=Ai();if(m!==void 0){var A=m(h);if(uu){Oe(!0);try{m(h)}finally{Oe(!1)}}}else A=h;return x.memoizedState=x.baseState=A,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:A},x.queue=c,c=c.dispatch=eU.bind(null,vt,c),[x.memoizedState,c]},useRef:function(c){var h=Ai();return c={current:c},h.memoizedState=c},useState:function(c){c=n1(c);var h=c.queue,m=TR.bind(null,vt,h);return h.dispatch=m,[c.memoizedState,m]},useDebugValue:r1,useDeferredValue:function(c,h){var m=Ai();return o1(m,c,h)},useTransition:function(){var c=n1(!1);return c=SR.bind(null,vt,c.queue,!0,!1),Ai().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,h,m){var x=vt,A=Ai();if(Ut){if(m===void 0)throw Error(s(407));m=m()}else{if(m=h(),mn===null)throw Error(s(349));(Lt&127)!==0||QM(x,h,m)}A.memoizedState=m;var E={value:m,getSnapshot:h};return A.queue=E,pR(eR.bind(null,x,E,c),[c]),x.flags|=2048,Df(9,{destroy:void 0},ZM.bind(null,x,E,m,h),null),m},useId:function(){var c=Ai(),h=mn.identifierPrefix;if(Ut){var m=Zo,x=Qo;m=(x&~(1<<32-Ke(x)-1)).toString(32)+m,h="_"+h+"R_"+m,m=Ey++,0<m&&(h+="H"+m.toString(32)),h+="_"}else m=WH++,h="_"+h+"r_"+m.toString(32)+"_";return c.memoizedState=h},useHostTransitionStatus:l1,useFormState:cR,useActionState:cR,useOptimistic:function(c){var h=Ai();h.memoizedState=h.baseState=c;var m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return h.queue=m,h=c1.bind(null,vt,!0,m),m.dispatch=h,[c,h]},useMemoCache:ZC,useCacheRefresh:function(){return Ai().memoizedState=ZH.bind(null,vt)},useEffectEvent:function(c){var h=Ai(),m={impl:c};return h.memoizedState=m,function(){if((en&2)!==0)throw Error(s(440));return m.impl.apply(void 0,arguments)}}},d1={readContext:Ws,use:_y,useCallback:vR,useContext:Ws,useEffect:i1,useImperativeHandle:yR,useInsertionEffect:gR,useLayoutEffect:xR,useMemo:wR,useReducer:My,useRef:fR,useState:function(){return My(Ya)},useDebugValue:r1,useDeferredValue:function(c,h){var m=es();return kR(m,cn.memoizedState,c,h)},useTransition:function(){var c=My(Ya)[0],h=es().memoizedState;return[typeof c=="boolean"?c:xg(c),h]},useSyncExternalStore:XM,useId:NR,useHostTransitionStatus:l1,useFormState:dR,useActionState:dR,useOptimistic:function(c,h){var m=es();return sR(m,cn,c,h)},useMemoCache:ZC,useCacheRefresh:ER};d1.useEffectEvent=mR;var IR={readContext:Ws,use:_y,useCallback:vR,useContext:Ws,useEffect:i1,useImperativeHandle:yR,useInsertionEffect:gR,useLayoutEffect:xR,useMemo:wR,useReducer:t1,useRef:fR,useState:function(){return t1(Ya)},useDebugValue:r1,useDeferredValue:function(c,h){var m=es();return cn===null?o1(m,c,h):kR(m,cn.memoizedState,c,h)},useTransition:function(){var c=t1(Ya)[0],h=es().memoizedState;return[typeof c=="boolean"?c:xg(c),h]},useSyncExternalStore:XM,useId:NR,useHostTransitionStatus:l1,useFormState:hR,useActionState:hR,useOptimistic:function(c,h){var m=es();return cn!==null?sR(m,cn,c,h):(m.baseState=c,[c,m.queue.dispatch])},useMemoCache:ZC,useCacheRefresh:ER};IR.useEffectEvent=mR;function u1(c,h,m,x){h=c.memoizedState,m=m(x,h),m=m==null?h:p({},h,m),c.memoizedState=m,c.lanes===0&&(c.updateQueue.baseState=m)}var h1={enqueueSetState:function(c,h,m){c=c._reactInternals;var x=hr(),A=wc(x);A.payload=h,m!=null&&(A.callback=m),h=kc(c,A,x),h!==null&&(Gi(h,c,x),fg(h,c,x))},enqueueReplaceState:function(c,h,m){c=c._reactInternals;var x=hr(),A=wc(x);A.tag=1,A.payload=h,m!=null&&(A.callback=m),h=kc(c,A,x),h!==null&&(Gi(h,c,x),fg(h,c,x))},enqueueForceUpdate:function(c,h){c=c._reactInternals;var m=hr(),x=wc(m);x.tag=2,h!=null&&(x.callback=h),h=kc(c,x,m),h!==null&&(Gi(h,c,m),fg(h,c,m))}};function zR(c,h,m,x,A,E,I){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(x,E,I):h.prototype&&h.prototype.isPureReactComponent?!rg(m,x)||!rg(A,E):!0}function DR(c,h,m,x){c=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(m,x),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(m,x),h.state!==c&&h1.enqueueReplaceState(h,h.state,null)}function hu(c,h){var m=h;if("ref"in h){m={};for(var x in h)x!=="ref"&&(m[x]=h[x])}if(c=c.defaultProps){m===h&&(m=p({},m));for(var A in c)m[A]===void 0&&(m[A]=c[A])}return m}function jR(c){uy(c)}function PR(c){console.error(c)}function LR(c){uy(c)}function Dy(c,h){try{var m=c.onUncaughtError;m(h.value,{componentStack:h.stack})}catch(x){setTimeout(function(){throw x})}}function OR(c,h,m){try{var x=c.onCaughtError;x(m.value,{componentStack:m.stack,errorBoundary:h.tag===1?h.stateNode:null})}catch(A){setTimeout(function(){throw A})}}function f1(c,h,m){return m=wc(m),m.tag=3,m.payload={element:null},m.callback=function(){Dy(c,h)},m}function BR(c){return c=wc(c),c.tag=3,c}function FR(c,h,m,x){var A=m.type.getDerivedStateFromError;if(typeof A=="function"){var E=x.value;c.payload=function(){return A(E)},c.callback=function(){OR(h,m,x)}}var I=m.stateNode;I!==null&&typeof I.componentDidCatch=="function"&&(c.callback=function(){OR(h,m,x),typeof A!="function"&&(Tc===null?Tc=new Set([this]):Tc.add(this));var B=x.stack;this.componentDidCatch(x.value,{componentStack:B!==null?B:""})})}function tU(c,h,m,x,A){if(m.flags|=32768,x!==null&&typeof x=="object"&&typeof x.then=="function"){if(h=m.alternate,h!==null&&Nf(h,m,A,!0),m=lr.current,m!==null){switch(m.tag){case 31:case 13:return Ur===null?qy():m.alternate===null&&Gn===0&&(Gn=3),m.flags&=-257,m.flags|=65536,m.lanes=A,x===wy?m.flags|=16384:(h=m.updateQueue,h===null?m.updateQueue=new Set([x]):h.add(x),O1(c,x,A)),!1;case 22:return m.flags|=65536,x===wy?m.flags|=16384:(h=m.updateQueue,h===null?(h={transitions:null,markerInstances:null,retryQueue:new Set([x])},m.updateQueue=h):(m=h.retryQueue,m===null?h.retryQueue=new Set([x]):m.add(x)),O1(c,x,A)),!1}throw Error(s(435,m.tag))}return O1(c,x,A),qy(),!1}if(Ut)return h=lr.current,h!==null?((h.flags&65536)===0&&(h.flags|=256),h.flags|=65536,h.lanes=A,x!==IC&&(c=Error(s(422),{cause:x}),lg(Or(c,m)))):(x!==IC&&(h=Error(s(423),{cause:x}),lg(Or(h,m))),c=c.current.alternate,c.flags|=65536,A&=-A,c.lanes|=A,x=Or(x,m),A=f1(c.stateNode,x,A),$C(c,A),Gn!==4&&(Gn=2)),!1;var E=Error(s(520),{cause:x});if(E=Or(E,m),Eg===null?Eg=[E]:Eg.push(E),Gn!==4&&(Gn=2),h===null)return!0;x=Or(x,m),m=h;do{switch(m.tag){case 3:return m.flags|=65536,c=A&-A,m.lanes|=c,c=f1(m.stateNode,x,c),$C(m,c),!1;case 1:if(h=m.type,E=m.stateNode,(m.flags&128)===0&&(typeof h.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(Tc===null||!Tc.has(E))))return m.flags|=65536,A&=-A,m.lanes|=A,A=BR(A),FR(A,c,m,x),$C(m,A),!1}m=m.return}while(m!==null);return!1}var p1=Error(s(461)),hs=!1;function Ks(c,h,m,x){h.child=c===null?GM(h,null,m,x):du(h,c.child,m,x)}function HR(c,h,m,x,A){m=m.render;var E=h.ref;if("ref"in x){var I={};for(var B in x)B!=="ref"&&(I[B]=x[B])}else I=x;return ou(h),x=YC(c,h,m,I,E,A),B=JC(),c!==null&&!hs?(XC(c,h,A),Ja(c,h,A)):(Ut&&B&&MC(h),h.flags|=1,Ks(c,h,x,A),h.child)}function UR(c,h,m,x,A){if(c===null){var E=m.type;return typeof E=="function"&&!EC(E)&&E.defaultProps===void 0&&m.compare===null?(h.tag=15,h.type=E,$R(c,h,E,x,A)):(c=my(m.type,null,x,h,h.mode,A),c.ref=h.ref,c.return=h,h.child=c)}if(E=c.child,!k1(c,A)){var I=E.memoizedProps;if(m=m.compare,m=m!==null?m:rg,m(I,x)&&c.ref===h.ref)return Ja(c,h,A)}return h.flags|=1,c=Ga(E,x),c.ref=h.ref,c.return=h,h.child=c}function $R(c,h,m,x,A){if(c!==null){var E=c.memoizedProps;if(rg(E,x)&&c.ref===h.ref)if(hs=!1,h.pendingProps=x=E,k1(c,A))(c.flags&131072)!==0&&(hs=!0);else return h.lanes=c.lanes,Ja(c,h,A)}return m1(c,h,m,x,A)}function GR(c,h,m,x){var A=x.children,E=c!==null?c.memoizedState:null;if(c===null&&h.stateNode===null&&(h.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),x.mode==="hidden"){if((h.flags&128)!==0){if(E=E!==null?E.baseLanes|m:m,c!==null){for(x=h.child=c.child,A=0;x!==null;)A=A|x.lanes|x.childLanes,x=x.sibling;x=A&~E}else x=0,h.child=null;return VR(c,h,E,m,x)}if((m&536870912)!==0)h.memoizedState={baseLanes:0,cachePool:null},c!==null&&yy(h,E!==null?E.cachePool:null),E!==null?WM(h,E):VC(),KM(h);else return x=h.lanes=536870912,VR(c,h,E!==null?E.baseLanes|m:m,m,x)}else E!==null?(yy(h,E.cachePool),WM(h,E),Cc(),h.memoizedState=null):(c!==null&&yy(h,null),VC(),Cc());return Ks(c,h,A,m),h.child}function vg(c,h){return c!==null&&c.tag===22||h.stateNode!==null||(h.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),h.sibling}function VR(c,h,m,x,A){var E=BC();return E=E===null?null:{parent:ds._currentValue,pool:E},h.memoizedState={baseLanes:m,cachePool:E},c!==null&&yy(h,null),VC(),KM(h),c!==null&&Nf(c,h,x,!0),h.childLanes=A,null}function jy(c,h){return h=Ly({mode:h.mode,children:h.children},c.mode),h.ref=c.ref,c.child=h,h.return=c,h}function qR(c,h,m){return du(h,c.child,null,m),c=jy(h,h.pendingProps),c.flags|=2,cr(h),h.memoizedState=null,c}function nU(c,h,m){var x=h.pendingProps,A=(h.flags&128)!==0;if(h.flags&=-129,c===null){if(Ut){if(x.mode==="hidden")return c=jy(h,x),h.lanes=536870912,vg(null,c);if(WC(h),(c=An)?(c=iz(c,Hr),c=c!==null&&c.data==="&"?c:null,c!==null&&(h.memoizedState={dehydrated:c,treeContext:gc!==null?{id:Qo,overflow:Zo}:null,retryLane:536870912,hydrationErrors:null},m=_M(c),m.return=h,h.child=m,qs=h,An=null)):c=null,c===null)throw bc(h);return h.lanes=536870912,null}return jy(h,x)}var E=c.memoizedState;if(E!==null){var I=E.dehydrated;if(WC(h),A)if(h.flags&256)h.flags&=-257,h=qR(c,h,m);else if(h.memoizedState!==null)h.child=c.child,h.flags|=128,h=null;else throw Error(s(558));else if(hs||Nf(c,h,m,!1),A=(m&c.childLanes)!==0,hs||A){if(x=mn,x!==null&&(I=qo(x,m),I!==0&&I!==E.retryLane))throw E.retryLane=I,nu(c,I),Gi(x,c,I),p1;qy(),h=qR(c,h,m)}else c=E.treeContext,An=$r(I.nextSibling),qs=h,Ut=!0,xc=null,Hr=!1,c!==null&&IM(h,c),h=jy(h,x),h.flags|=4096;return h}return c=Ga(c.child,{mode:x.mode,children:x.children}),c.ref=h.ref,h.child=c,c.return=h,c}function Py(c,h){var m=h.ref;if(m===null)c!==null&&c.ref!==null&&(h.flags|=4194816);else{if(typeof m!="function"&&typeof m!="object")throw Error(s(284));(c===null||c.ref!==m)&&(h.flags|=4194816)}}function m1(c,h,m,x,A){return ou(h),m=YC(c,h,m,x,void 0,A),x=JC(),c!==null&&!hs?(XC(c,h,A),Ja(c,h,A)):(Ut&&x&&MC(h),h.flags|=1,Ks(c,h,m,A),h.child)}function WR(c,h,m,x,A,E){return ou(h),h.updateQueue=null,m=JM(h,x,m,A),YM(c),x=JC(),c!==null&&!hs?(XC(c,h,E),Ja(c,h,E)):(Ut&&x&&MC(h),h.flags|=1,Ks(c,h,m,E),h.child)}function KR(c,h,m,x,A){if(ou(h),h.stateNode===null){var E=kf,I=m.contextType;typeof I=="object"&&I!==null&&(E=Ws(I)),E=new m(x,E),h.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,E.updater=h1,h.stateNode=E,E._reactInternals=h,E=h.stateNode,E.props=x,E.state=h.memoizedState,E.refs={},HC(h),I=m.contextType,E.context=typeof I=="object"&&I!==null?Ws(I):kf,E.state=h.memoizedState,I=m.getDerivedStateFromProps,typeof I=="function"&&(u1(h,m,I,x),E.state=h.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(I=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),I!==E.state&&h1.enqueueReplaceState(E,E.state,null),mg(h,x,E,A),pg(),E.state=h.memoizedState),typeof E.componentDidMount=="function"&&(h.flags|=4194308),x=!0}else if(c===null){E=h.stateNode;var B=h.memoizedProps,X=hu(m,B);E.props=X;var de=E.context,we=m.contextType;I=kf,typeof we=="object"&&we!==null&&(I=Ws(we));var Ee=m.getDerivedStateFromProps;we=typeof Ee=="function"||typeof E.getSnapshotBeforeUpdate=="function",B=h.pendingProps!==B,we||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(B||de!==I)&&DR(h,E,x,I),vc=!1;var fe=h.memoizedState;E.state=fe,mg(h,x,E,A),pg(),de=h.memoizedState,B||fe!==de||vc?(typeof Ee=="function"&&(u1(h,m,Ee,x),de=h.memoizedState),(X=vc||zR(h,m,X,x,fe,de,I))?(we||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(h.flags|=4194308)):(typeof E.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=x,h.memoizedState=de),E.props=x,E.state=de,E.context=I,x=X):(typeof E.componentDidMount=="function"&&(h.flags|=4194308),x=!1)}else{E=h.stateNode,UC(c,h),I=h.memoizedProps,we=hu(m,I),E.props=we,Ee=h.pendingProps,fe=E.context,de=m.contextType,X=kf,typeof de=="object"&&de!==null&&(X=Ws(de)),B=m.getDerivedStateFromProps,(de=typeof B=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(I!==Ee||fe!==X)&&DR(h,E,x,X),vc=!1,fe=h.memoizedState,E.state=fe,mg(h,x,E,A),pg();var ge=h.memoizedState;I!==Ee||fe!==ge||vc||c!==null&&c.dependencies!==null&&xy(c.dependencies)?(typeof B=="function"&&(u1(h,m,B,x),ge=h.memoizedState),(we=vc||zR(h,m,we,x,fe,ge,X)||c!==null&&c.dependencies!==null&&xy(c.dependencies))?(de||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(x,ge,X),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(x,ge,X)),typeof E.componentDidUpdate=="function"&&(h.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof E.componentDidUpdate!="function"||I===c.memoizedProps&&fe===c.memoizedState||(h.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||I===c.memoizedProps&&fe===c.memoizedState||(h.flags|=1024),h.memoizedProps=x,h.memoizedState=ge),E.props=x,E.state=ge,E.context=X,x=we):(typeof E.componentDidUpdate!="function"||I===c.memoizedProps&&fe===c.memoizedState||(h.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||I===c.memoizedProps&&fe===c.memoizedState||(h.flags|=1024),x=!1)}return E=x,Py(c,h),x=(h.flags&128)!==0,E||x?(E=h.stateNode,m=x&&typeof m.getDerivedStateFromError!="function"?null:E.render(),h.flags|=1,c!==null&&x?(h.child=du(h,c.child,null,A),h.child=du(h,null,m,A)):Ks(c,h,m,A),h.memoizedState=E.state,c=h.child):c=Ja(c,h,A),c}function YR(c,h,m,x){return iu(),h.flags|=256,Ks(c,h,m,x),h.child}var g1={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function x1(c){return{baseLanes:c,cachePool:OM()}}function b1(c,h,m){return c=c!==null?c.childLanes&~m:0,h&&(c|=ur),c}function JR(c,h,m){var x=h.pendingProps,A=!1,E=(h.flags&128)!==0,I;if((I=E)||(I=c!==null&&c.memoizedState===null?!1:(Zn.current&2)!==0),I&&(A=!0,h.flags&=-129),I=(h.flags&32)!==0,h.flags&=-33,c===null){if(Ut){if(A?Sc(h):Cc(),(c=An)?(c=iz(c,Hr),c=c!==null&&c.data!=="&"?c:null,c!==null&&(h.memoizedState={dehydrated:c,treeContext:gc!==null?{id:Qo,overflow:Zo}:null,retryLane:536870912,hydrationErrors:null},m=_M(c),m.return=h,h.child=m,qs=h,An=null)):c=null,c===null)throw bc(h);return eA(c)?h.lanes=32:h.lanes=536870912,null}var B=x.children;return x=x.fallback,A?(Cc(),A=h.mode,B=Ly({mode:"hidden",children:B},A),x=su(x,A,m,null),B.return=h,x.return=h,B.sibling=x,h.child=B,x=h.child,x.memoizedState=x1(m),x.childLanes=b1(c,I,m),h.memoizedState=g1,vg(null,x)):(Sc(h),y1(h,B))}var X=c.memoizedState;if(X!==null&&(B=X.dehydrated,B!==null)){if(E)h.flags&256?(Sc(h),h.flags&=-257,h=v1(c,h,m)):h.memoizedState!==null?(Cc(),h.child=c.child,h.flags|=128,h=null):(Cc(),B=x.fallback,A=h.mode,x=Ly({mode:"visible",children:x.children},A),B=su(B,A,m,null),B.flags|=2,x.return=h,B.return=h,x.sibling=B,h.child=x,du(h,c.child,null,m),x=h.child,x.memoizedState=x1(m),x.childLanes=b1(c,I,m),h.memoizedState=g1,h=vg(null,x));else if(Sc(h),eA(B)){if(I=B.nextSibling&&B.nextSibling.dataset,I)var de=I.dgst;I=de,x=Error(s(419)),x.stack="",x.digest=I,lg({value:x,source:null,stack:null}),h=v1(c,h,m)}else if(hs||Nf(c,h,m,!1),I=(m&c.childLanes)!==0,hs||I){if(I=mn,I!==null&&(x=qo(I,m),x!==0&&x!==X.retryLane))throw X.retryLane=x,nu(c,x),Gi(I,c,x),p1;Z1(B)||qy(),h=v1(c,h,m)}else Z1(B)?(h.flags|=192,h.child=c.child,h=null):(c=X.treeContext,An=$r(B.nextSibling),qs=h,Ut=!0,xc=null,Hr=!1,c!==null&&IM(h,c),h=y1(h,x.children),h.flags|=4096);return h}return A?(Cc(),B=x.fallback,A=h.mode,X=c.child,de=X.sibling,x=Ga(X,{mode:"hidden",children:x.children}),x.subtreeFlags=X.subtreeFlags&65011712,de!==null?B=Ga(de,B):(B=su(B,A,m,null),B.flags|=2),B.return=h,x.return=h,x.sibling=B,h.child=x,vg(null,x),x=h.child,B=c.child.memoizedState,B===null?B=x1(m):(A=B.cachePool,A!==null?(X=ds._currentValue,A=A.parent!==X?{parent:X,pool:X}:A):A=OM(),B={baseLanes:B.baseLanes|m,cachePool:A}),x.memoizedState=B,x.childLanes=b1(c,I,m),h.memoizedState=g1,vg(c.child,x)):(Sc(h),m=c.child,c=m.sibling,m=Ga(m,{mode:"visible",children:x.children}),m.return=h,m.sibling=null,c!==null&&(I=h.deletions,I===null?(h.deletions=[c],h.flags|=16):I.push(c)),h.child=m,h.memoizedState=null,m)}function y1(c,h){return h=Ly({mode:"visible",children:h},c.mode),h.return=c,c.child=h}function Ly(c,h){return c=ar(22,c,null,h),c.lanes=0,c}function v1(c,h,m){return du(h,c.child,null,m),c=y1(h,h.pendingProps.children),c.flags|=2,h.memoizedState=null,c}function XR(c,h,m){c.lanes|=h;var x=c.alternate;x!==null&&(x.lanes|=h),jC(c.return,h,m)}function w1(c,h,m,x,A,E){var I=c.memoizedState;I===null?c.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:x,tail:m,tailMode:A,treeForkCount:E}:(I.isBackwards=h,I.rendering=null,I.renderingStartTime=0,I.last=x,I.tail=m,I.tailMode=A,I.treeForkCount=E)}function QR(c,h,m){var x=h.pendingProps,A=x.revealOrder,E=x.tail;x=x.children;var I=Zn.current,B=(I&2)!==0;if(B?(I=I&1|2,h.flags|=128):I&=1,ie(Zn,I),Ks(c,h,x,m),x=Ut?ag:0,!B&&c!==null&&(c.flags&128)!==0)e:for(c=h.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&XR(c,m,h);else if(c.tag===19)XR(c,m,h);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===h)break e;for(;c.sibling===null;){if(c.return===null||c.return===h)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}switch(A){case"forwards":for(m=h.child,A=null;m!==null;)c=m.alternate,c!==null&&Ay(c)===null&&(A=m),m=m.sibling;m=A,m===null?(A=h.child,h.child=null):(A=m.sibling,m.sibling=null),w1(h,!1,A,m,E,x);break;case"backwards":case"unstable_legacy-backwards":for(m=null,A=h.child,h.child=null;A!==null;){if(c=A.alternate,c!==null&&Ay(c)===null){h.child=A;break}c=A.sibling,A.sibling=m,m=A,A=c}w1(h,!0,m,null,E,x);break;case"together":w1(h,!1,null,null,void 0,x);break;default:h.memoizedState=null}return h.child}function Ja(c,h,m){if(c!==null&&(h.dependencies=c.dependencies),Ec|=h.lanes,(m&h.childLanes)===0)if(c!==null){if(Nf(c,h,m,!1),(m&h.childLanes)===0)return null}else return null;if(c!==null&&h.child!==c.child)throw Error(s(153));if(h.child!==null){for(c=h.child,m=Ga(c,c.pendingProps),h.child=m,m.return=h;c.sibling!==null;)c=c.sibling,m=m.sibling=Ga(c,c.pendingProps),m.return=h;m.sibling=null}return h.child}function k1(c,h){return(c.lanes&h)!==0?!0:(c=c.dependencies,!!(c!==null&&xy(c)))}function sU(c,h,m){switch(h.tag){case 3:Ge(h,h.stateNode.containerInfo),yc(h,ds,c.memoizedState.cache),iu();break;case 27:case 5:Qe(h);break;case 4:Ge(h,h.stateNode.containerInfo);break;case 10:yc(h,h.type,h.memoizedProps.value);break;case 31:if(h.memoizedState!==null)return h.flags|=128,WC(h),null;break;case 13:var x=h.memoizedState;if(x!==null)return x.dehydrated!==null?(Sc(h),h.flags|=128,null):(m&h.child.childLanes)!==0?JR(c,h,m):(Sc(h),c=Ja(c,h,m),c!==null?c.sibling:null);Sc(h);break;case 19:var A=(c.flags&128)!==0;if(x=(m&h.childLanes)!==0,x||(Nf(c,h,m,!1),x=(m&h.childLanes)!==0),A){if(x)return QR(c,h,m);h.flags|=128}if(A=h.memoizedState,A!==null&&(A.rendering=null,A.tail=null,A.lastEffect=null),ie(Zn,Zn.current),x)break;return null;case 22:return h.lanes=0,GR(c,h,m,h.pendingProps);case 24:yc(h,ds,c.memoizedState.cache)}return Ja(c,h,m)}function ZR(c,h,m){if(c!==null)if(c.memoizedProps!==h.pendingProps)hs=!0;else{if(!k1(c,m)&&(h.flags&128)===0)return hs=!1,sU(c,h,m);hs=(c.flags&131072)!==0}else hs=!1,Ut&&(h.flags&1048576)!==0&&RM(h,ag,h.index);switch(h.lanes=0,h.tag){case 16:e:{var x=h.pendingProps;if(c=lu(h.elementType),h.type=c,typeof c=="function")EC(c)?(x=hu(c,x),h.tag=1,h=KR(null,h,c,x,m)):(h.tag=0,h=m1(null,h,c,x,m));else{if(c!=null){var A=c.$$typeof;if(A===_){h.tag=11,h=HR(null,h,c,x,m);break e}else if(A===D){h.tag=14,h=UR(null,h,c,x,m);break e}}throw h=Q(c)||c,Error(s(306,h,""))}}return h;case 0:return m1(c,h,h.type,h.pendingProps,m);case 1:return x=h.type,A=hu(x,h.pendingProps),KR(c,h,x,A,m);case 3:e:{if(Ge(h,h.stateNode.containerInfo),c===null)throw Error(s(387));x=h.pendingProps;var E=h.memoizedState;A=E.element,UC(c,h),mg(h,x,null,m);var I=h.memoizedState;if(x=I.cache,yc(h,ds,x),x!==E.cache&&PC(h,[ds],m,!0),pg(),x=I.element,E.isDehydrated)if(E={element:x,isDehydrated:!1,cache:I.cache},h.updateQueue.baseState=E,h.memoizedState=E,h.flags&256){h=YR(c,h,x,m);break e}else if(x!==A){A=Or(Error(s(424)),h),lg(A),h=YR(c,h,x,m);break e}else{switch(c=h.stateNode.containerInfo,c.nodeType){case 9:c=c.body;break;default:c=c.nodeName==="HTML"?c.ownerDocument.body:c}for(An=$r(c.firstChild),qs=h,Ut=!0,xc=null,Hr=!0,m=GM(h,null,x,m),h.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling}else{if(iu(),x===A){h=Ja(c,h,m);break e}Ks(c,h,x,m)}h=h.child}return h;case 26:return Py(c,h),c===null?(m=dz(h.type,null,h.pendingProps,null))?h.memoizedState=m:Ut||(m=h.type,c=h.pendingProps,x=Zy(ke.current).createElement(m),x[Un]=h,x[at]=c,Ys(x,m,c),cs(x),h.stateNode=x):h.memoizedState=dz(h.type,c.memoizedProps,h.pendingProps,c.memoizedState),null;case 27:return Qe(h),c===null&&Ut&&(x=h.stateNode=az(h.type,h.pendingProps,ke.current),qs=h,Hr=!0,A=An,Ic(h.type)?(tA=A,An=$r(x.firstChild)):An=A),Ks(c,h,h.pendingProps.children,m),Py(c,h),c===null&&(h.flags|=4194304),h.child;case 5:return c===null&&Ut&&((A=x=An)&&(x=zU(x,h.type,h.pendingProps,Hr),x!==null?(h.stateNode=x,qs=h,An=$r(x.firstChild),Hr=!1,A=!0):A=!1),A||bc(h)),Qe(h),A=h.type,E=h.pendingProps,I=c!==null?c.memoizedProps:null,x=E.children,J1(A,E)?x=null:I!==null&&J1(A,I)&&(h.flags|=32),h.memoizedState!==null&&(A=YC(c,h,KH,null,null,m),jg._currentValue=A),Py(c,h),Ks(c,h,x,m),h.child;case 6:return c===null&&Ut&&((c=m=An)&&(m=DU(m,h.pendingProps,Hr),m!==null?(h.stateNode=m,qs=h,An=null,c=!0):c=!1),c||bc(h)),null;case 13:return JR(c,h,m);case 4:return Ge(h,h.stateNode.containerInfo),x=h.pendingProps,c===null?h.child=du(h,null,x,m):Ks(c,h,x,m),h.child;case 11:return HR(c,h,h.type,h.pendingProps,m);case 7:return Ks(c,h,h.pendingProps,m),h.child;case 8:return Ks(c,h,h.pendingProps.children,m),h.child;case 12:return Ks(c,h,h.pendingProps.children,m),h.child;case 10:return x=h.pendingProps,yc(h,h.type,x.value),Ks(c,h,x.children,m),h.child;case 9:return A=h.type._context,x=h.pendingProps.children,ou(h),A=Ws(A),x=x(A),h.flags|=1,Ks(c,h,x,m),h.child;case 14:return UR(c,h,h.type,h.pendingProps,m);case 15:return $R(c,h,h.type,h.pendingProps,m);case 19:return QR(c,h,m);case 31:return nU(c,h,m);case 22:return GR(c,h,m,h.pendingProps);case 24:return ou(h),x=Ws(ds),c===null?(A=BC(),A===null&&(A=mn,E=LC(),A.pooledCache=E,E.refCount++,E!==null&&(A.pooledCacheLanes|=m),A=E),h.memoizedState={parent:x,cache:A},HC(h),yc(h,ds,A)):((c.lanes&m)!==0&&(UC(c,h),mg(h,null,null,m),pg()),A=c.memoizedState,E=h.memoizedState,A.parent!==x?(A={parent:x,cache:x},h.memoizedState=A,h.lanes===0&&(h.memoizedState=h.updateQueue.baseState=A),yc(h,ds,x)):(x=E.cache,yc(h,ds,x),x!==A.cache&&PC(h,[ds],m,!0))),Ks(c,h,h.pendingProps.children,m),h.child;case 29:throw h.pendingProps}throw Error(s(156,h.tag))}function Xa(c){c.flags|=4}function S1(c,h,m,x,A){if((h=(c.mode&32)!==0)&&(h=!1),h){if(c.flags|=16777216,(A&335544128)===A)if(c.stateNode.complete)c.flags|=8192;else if(NI())c.flags|=8192;else throw cu=wy,FC}else c.flags&=-16777217}function eI(c,h){if(h.type!=="stylesheet"||(h.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!mz(h))if(NI())c.flags|=8192;else throw cu=wy,FC}function Oy(c,h){h!==null&&(c.flags|=4),c.flags&16384&&(h=c.tag!==22?Hn():536870912,c.lanes|=h,Of|=h)}function wg(c,h){if(!Ut)switch(c.tailMode){case"hidden":h=c.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?c.tail=null:m.sibling=null;break;case"collapsed":m=c.tail;for(var x=null;m!==null;)m.alternate!==null&&(x=m),m=m.sibling;x===null?h||c.tail===null?c.tail=null:c.tail.sibling=null:x.sibling=null}}function Nn(c){var h=c.alternate!==null&&c.alternate.child===c.child,m=0,x=0;if(h)for(var A=c.child;A!==null;)m|=A.lanes|A.childLanes,x|=A.subtreeFlags&65011712,x|=A.flags&65011712,A.return=c,A=A.sibling;else for(A=c.child;A!==null;)m|=A.lanes|A.childLanes,x|=A.subtreeFlags,x|=A.flags,A.return=c,A=A.sibling;return c.subtreeFlags|=x,c.childLanes=m,h}function iU(c,h,m){var x=h.pendingProps;switch(RC(h),h.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nn(h),null;case 1:return Nn(h),null;case 3:return m=h.stateNode,x=null,c!==null&&(x=c.memoizedState.cache),h.memoizedState.cache!==x&&(h.flags|=2048),Wa(ds),Je(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(c===null||c.child===null)&&(Af(h)?Xa(h):c===null||c.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,zC())),Nn(h),null;case 26:var A=h.type,E=h.memoizedState;return c===null?(Xa(h),E!==null?(Nn(h),eI(h,E)):(Nn(h),S1(h,A,null,x,m))):E?E!==c.memoizedState?(Xa(h),Nn(h),eI(h,E)):(Nn(h),h.flags&=-16777217):(c=c.memoizedProps,c!==x&&Xa(h),Nn(h),S1(h,A,c,x,m)),null;case 27:if(je(h),m=ke.current,A=h.type,c!==null&&h.stateNode!=null)c.memoizedProps!==x&&Xa(h);else{if(!x){if(h.stateNode===null)throw Error(s(166));return Nn(h),null}c=pe.current,Af(h)?zM(h):(c=az(A,x,m),h.stateNode=c,Xa(h))}return Nn(h),null;case 5:if(je(h),A=h.type,c!==null&&h.stateNode!=null)c.memoizedProps!==x&&Xa(h);else{if(!x){if(h.stateNode===null)throw Error(s(166));return Nn(h),null}if(E=pe.current,Af(h))zM(h);else{var I=Zy(ke.current);switch(E){case 1:E=I.createElementNS("http://www.w3.org/2000/svg",A);break;case 2:E=I.createElementNS("http://www.w3.org/1998/Math/MathML",A);break;default:switch(A){case"svg":E=I.createElementNS("http://www.w3.org/2000/svg",A);break;case"math":E=I.createElementNS("http://www.w3.org/1998/Math/MathML",A);break;case"script":E=I.createElement("div"),E.innerHTML="<script><\/script>",E=E.removeChild(E.firstChild);break;case"select":E=typeof x.is=="string"?I.createElement("select",{is:x.is}):I.createElement("select"),x.multiple?E.multiple=!0:x.size&&(E.size=x.size);break;default:E=typeof x.is=="string"?I.createElement(A,{is:x.is}):I.createElement(A)}}E[Un]=h,E[at]=x;e:for(I=h.child;I!==null;){if(I.tag===5||I.tag===6)E.appendChild(I.stateNode);else if(I.tag!==4&&I.tag!==27&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===h)break e;for(;I.sibling===null;){if(I.return===null||I.return===h)break e;I=I.return}I.sibling.return=I.return,I=I.sibling}h.stateNode=E;e:switch(Ys(E,A,x),A){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}x&&Xa(h)}}return Nn(h),S1(h,h.type,c===null?null:c.memoizedProps,h.pendingProps,m),null;case 6:if(c&&h.stateNode!=null)c.memoizedProps!==x&&Xa(h);else{if(typeof x!="string"&&h.stateNode===null)throw Error(s(166));if(c=ke.current,Af(h)){if(c=h.stateNode,m=h.memoizedProps,x=null,A=qs,A!==null)switch(A.tag){case 27:case 5:x=A.memoizedProps}c[Un]=h,c=!!(c.nodeValue===m||x!==null&&x.suppressHydrationWarning===!0||JI(c.nodeValue,m)),c||bc(h,!0)}else c=Zy(c).createTextNode(x),c[Un]=h,h.stateNode=c}return Nn(h),null;case 31:if(m=h.memoizedState,c===null||c.memoizedState!==null){if(x=Af(h),m!==null){if(c===null){if(!x)throw Error(s(318));if(c=h.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(s(557));c[Un]=h}else iu(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Nn(h),c=!1}else m=zC(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=m),c=!0;if(!c)return h.flags&256?(cr(h),h):(cr(h),null);if((h.flags&128)!==0)throw Error(s(558))}return Nn(h),null;case 13:if(x=h.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(A=Af(h),x!==null&&x.dehydrated!==null){if(c===null){if(!A)throw Error(s(318));if(A=h.memoizedState,A=A!==null?A.dehydrated:null,!A)throw Error(s(317));A[Un]=h}else iu(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Nn(h),A=!1}else A=zC(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=A),A=!0;if(!A)return h.flags&256?(cr(h),h):(cr(h),null)}return cr(h),(h.flags&128)!==0?(h.lanes=m,h):(m=x!==null,c=c!==null&&c.memoizedState!==null,m&&(x=h.child,A=null,x.alternate!==null&&x.alternate.memoizedState!==null&&x.alternate.memoizedState.cachePool!==null&&(A=x.alternate.memoizedState.cachePool.pool),E=null,x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(E=x.memoizedState.cachePool.pool),E!==A&&(x.flags|=2048)),m!==c&&m&&(h.child.flags|=8192),Oy(h,h.updateQueue),Nn(h),null);case 4:return Je(),c===null&&V1(h.stateNode.containerInfo),Nn(h),null;case 10:return Wa(h.type),Nn(h),null;case 19:if(J(Zn),x=h.memoizedState,x===null)return Nn(h),null;if(A=(h.flags&128)!==0,E=x.rendering,E===null)if(A)wg(x,!1);else{if(Gn!==0||c!==null&&(c.flags&128)!==0)for(c=h.child;c!==null;){if(E=Ay(c),E!==null){for(h.flags|=128,wg(x,!1),c=E.updateQueue,h.updateQueue=c,Oy(h,c),h.subtreeFlags=0,c=m,m=h.child;m!==null;)TM(m,c),m=m.sibling;return ie(Zn,Zn.current&1|2),Ut&&Va(h,x.treeForkCount),h.child}c=c.sibling}x.tail!==null&&Qt()>$y&&(h.flags|=128,A=!0,wg(x,!1),h.lanes=4194304)}else{if(!A)if(c=Ay(E),c!==null){if(h.flags|=128,A=!0,c=c.updateQueue,h.updateQueue=c,Oy(h,c),wg(x,!0),x.tail===null&&x.tailMode==="hidden"&&!E.alternate&&!Ut)return Nn(h),null}else 2*Qt()-x.renderingStartTime>$y&&m!==536870912&&(h.flags|=128,A=!0,wg(x,!1),h.lanes=4194304);x.isBackwards?(E.sibling=h.child,h.child=E):(c=x.last,c!==null?c.sibling=E:h.child=E,x.last=E)}return x.tail!==null?(c=x.tail,x.rendering=c,x.tail=c.sibling,x.renderingStartTime=Qt(),c.sibling=null,m=Zn.current,ie(Zn,A?m&1|2:m&1),Ut&&Va(h,x.treeForkCount),c):(Nn(h),null);case 22:case 23:return cr(h),qC(),x=h.memoizedState!==null,c!==null?c.memoizedState!==null!==x&&(h.flags|=8192):x&&(h.flags|=8192),x?(m&536870912)!==0&&(h.flags&128)===0&&(Nn(h),h.subtreeFlags&6&&(h.flags|=8192)):Nn(h),m=h.updateQueue,m!==null&&Oy(h,m.retryQueue),m=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(m=c.memoizedState.cachePool.pool),x=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(x=h.memoizedState.cachePool.pool),x!==m&&(h.flags|=2048),c!==null&&J(au),null;case 24:return m=null,c!==null&&(m=c.memoizedState.cache),h.memoizedState.cache!==m&&(h.flags|=2048),Wa(ds),Nn(h),null;case 25:return null;case 30:return null}throw Error(s(156,h.tag))}function rU(c,h){switch(RC(h),h.tag){case 1:return c=h.flags,c&65536?(h.flags=c&-65537|128,h):null;case 3:return Wa(ds),Je(),c=h.flags,(c&65536)!==0&&(c&128)===0?(h.flags=c&-65537|128,h):null;case 26:case 27:case 5:return je(h),null;case 31:if(h.memoizedState!==null){if(cr(h),h.alternate===null)throw Error(s(340));iu()}return c=h.flags,c&65536?(h.flags=c&-65537|128,h):null;case 13:if(cr(h),c=h.memoizedState,c!==null&&c.dehydrated!==null){if(h.alternate===null)throw Error(s(340));iu()}return c=h.flags,c&65536?(h.flags=c&-65537|128,h):null;case 19:return J(Zn),null;case 4:return Je(),null;case 10:return Wa(h.type),null;case 22:case 23:return cr(h),qC(),c!==null&&J(au),c=h.flags,c&65536?(h.flags=c&-65537|128,h):null;case 24:return Wa(ds),null;case 25:return null;default:return null}}function tI(c,h){switch(RC(h),h.tag){case 3:Wa(ds),Je();break;case 26:case 27:case 5:je(h);break;case 4:Je();break;case 31:h.memoizedState!==null&&cr(h);break;case 13:cr(h);break;case 19:J(Zn);break;case 10:Wa(h.type);break;case 22:case 23:cr(h),qC(),c!==null&&J(au);break;case 24:Wa(ds)}}function kg(c,h){try{var m=h.updateQueue,x=m!==null?m.lastEffect:null;if(x!==null){var A=x.next;m=A;do{if((m.tag&c)===c){x=void 0;var E=m.create,I=m.inst;x=E(),I.destroy=x}m=m.next}while(m!==A)}}catch(B){sn(h,h.return,B)}}function Ac(c,h,m){try{var x=h.updateQueue,A=x!==null?x.lastEffect:null;if(A!==null){var E=A.next;x=E;do{if((x.tag&c)===c){var I=x.inst,B=I.destroy;if(B!==void 0){I.destroy=void 0,A=h;var X=m,de=B;try{de()}catch(we){sn(A,X,we)}}}x=x.next}while(x!==E)}}catch(we){sn(h,h.return,we)}}function nI(c){var h=c.updateQueue;if(h!==null){var m=c.stateNode;try{qM(h,m)}catch(x){sn(c,c.return,x)}}}function sI(c,h,m){m.props=hu(c.type,c.memoizedProps),m.state=c.memoizedState;try{m.componentWillUnmount()}catch(x){sn(c,h,x)}}function Sg(c,h){try{var m=c.ref;if(m!==null){switch(c.tag){case 26:case 27:case 5:var x=c.stateNode;break;case 30:x=c.stateNode;break;default:x=c.stateNode}typeof m=="function"?c.refCleanup=m(x):m.current=x}}catch(A){sn(c,h,A)}}function ea(c,h){var m=c.ref,x=c.refCleanup;if(m!==null)if(typeof x=="function")try{x()}catch(A){sn(c,h,A)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof m=="function")try{m(null)}catch(A){sn(c,h,A)}else m.current=null}function iI(c){var h=c.type,m=c.memoizedProps,x=c.stateNode;try{e:switch(h){case"button":case"input":case"select":case"textarea":m.autoFocus&&x.focus();break e;case"img":m.src?x.src=m.src:m.srcSet&&(x.srcset=m.srcSet)}}catch(A){sn(c,c.return,A)}}function C1(c,h,m){try{var x=c.stateNode;EU(x,c.type,m,h),x[at]=h}catch(A){sn(c,c.return,A)}}function rI(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&Ic(c.type)||c.tag===4}function A1(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||rI(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&Ic(c.type)||c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function N1(c,h,m){var x=c.tag;if(x===5||x===6)c=c.stateNode,h?(m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m).insertBefore(c,h):(h=m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m,h.appendChild(c),m=m._reactRootContainer,m!=null||h.onclick!==null||(h.onclick=go));else if(x!==4&&(x===27&&Ic(c.type)&&(m=c.stateNode,h=null),c=c.child,c!==null))for(N1(c,h,m),c=c.sibling;c!==null;)N1(c,h,m),c=c.sibling}function By(c,h,m){var x=c.tag;if(x===5||x===6)c=c.stateNode,h?m.insertBefore(c,h):m.appendChild(c);else if(x!==4&&(x===27&&Ic(c.type)&&(m=c.stateNode),c=c.child,c!==null))for(By(c,h,m),c=c.sibling;c!==null;)By(c,h,m),c=c.sibling}function oI(c){var h=c.stateNode,m=c.memoizedProps;try{for(var x=c.type,A=h.attributes;A.length;)h.removeAttributeNode(A[0]);Ys(h,x,m),h[Un]=c,h[at]=m}catch(E){sn(c,c.return,E)}}var Qa=!1,fs=!1,E1=!1,aI=typeof WeakSet=="function"?WeakSet:Set,Rs=null;function oU(c,h){if(c=c.containerInfo,K1=ov,c=yM(c),vC(c)){if("selectionStart"in c)var m={start:c.selectionStart,end:c.selectionEnd};else e:{m=(m=c.ownerDocument)&&m.defaultView||window;var x=m.getSelection&&m.getSelection();if(x&&x.rangeCount!==0){m=x.anchorNode;var A=x.anchorOffset,E=x.focusNode;x=x.focusOffset;try{m.nodeType,E.nodeType}catch{m=null;break e}var I=0,B=-1,X=-1,de=0,we=0,Ee=c,fe=null;t:for(;;){for(var ge;Ee!==m||A!==0&&Ee.nodeType!==3||(B=I+A),Ee!==E||x!==0&&Ee.nodeType!==3||(X=I+x),Ee.nodeType===3&&(I+=Ee.nodeValue.length),(ge=Ee.firstChild)!==null;)fe=Ee,Ee=ge;for(;;){if(Ee===c)break t;if(fe===m&&++de===A&&(B=I),fe===E&&++we===x&&(X=I),(ge=Ee.nextSibling)!==null)break;Ee=fe,fe=Ee.parentNode}Ee=ge}m=B===-1||X===-1?null:{start:B,end:X}}else m=null}m=m||{start:0,end:0}}else m=null;for(Y1={focusedElem:c,selectionRange:m},ov=!1,Rs=h;Rs!==null;)if(h=Rs,c=h.child,(h.subtreeFlags&1028)!==0&&c!==null)c.return=h,Rs=c;else for(;Rs!==null;){switch(h=Rs,E=h.alternate,c=h.flags,h.tag){case 0:if((c&4)!==0&&(c=h.updateQueue,c=c!==null?c.events:null,c!==null))for(m=0;m<c.length;m++)A=c[m],A.ref.impl=A.nextImpl;break;case 11:case 15:break;case 1:if((c&1024)!==0&&E!==null){c=void 0,m=h,A=E.memoizedProps,E=E.memoizedState,x=m.stateNode;try{var et=hu(m.type,A);c=x.getSnapshotBeforeUpdate(et,E),x.__reactInternalSnapshotBeforeUpdate=c}catch(ft){sn(m,m.return,ft)}}break;case 3:if((c&1024)!==0){if(c=h.stateNode.containerInfo,m=c.nodeType,m===9)Q1(c);else if(m===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":Q1(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(s(163))}if(c=h.sibling,c!==null){c.return=h.return,Rs=c;break}Rs=h.return}}function lI(c,h,m){var x=m.flags;switch(m.tag){case 0:case 11:case 15:el(c,m),x&4&&kg(5,m);break;case 1:if(el(c,m),x&4)if(c=m.stateNode,h===null)try{c.componentDidMount()}catch(I){sn(m,m.return,I)}else{var A=hu(m.type,h.memoizedProps);h=h.memoizedState;try{c.componentDidUpdate(A,h,c.__reactInternalSnapshotBeforeUpdate)}catch(I){sn(m,m.return,I)}}x&64&&nI(m),x&512&&Sg(m,m.return);break;case 3:if(el(c,m),x&64&&(c=m.updateQueue,c!==null)){if(h=null,m.child!==null)switch(m.child.tag){case 27:case 5:h=m.child.stateNode;break;case 1:h=m.child.stateNode}try{qM(c,h)}catch(I){sn(m,m.return,I)}}break;case 27:h===null&&x&4&&oI(m);case 26:case 5:el(c,m),h===null&&x&4&&iI(m),x&512&&Sg(m,m.return);break;case 12:el(c,m);break;case 31:el(c,m),x&4&&uI(c,m);break;case 13:el(c,m),x&4&&hI(c,m),x&64&&(c=m.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(m=mU.bind(null,m),jU(c,m))));break;case 22:if(x=m.memoizedState!==null||Qa,!x){h=h!==null&&h.memoizedState!==null||fs,A=Qa;var E=fs;Qa=x,(fs=h)&&!E?tl(c,m,(m.subtreeFlags&8772)!==0):el(c,m),Qa=A,fs=E}break;case 30:break;default:el(c,m)}}function cI(c){var h=c.alternate;h!==null&&(c.alternate=null,cI(h)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(h=c.stateNode,h!==null&&rc(h)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var In=null,Fi=!1;function Za(c,h,m){for(m=m.child;m!==null;)dI(c,h,m),m=m.sibling}function dI(c,h,m){if(se&&typeof se.onCommitFiberUnmount=="function")try{se.onCommitFiberUnmount(De,m)}catch{}switch(m.tag){case 26:fs||ea(m,h),Za(c,h,m),m.memoizedState?m.memoizedState.count--:m.stateNode&&(m=m.stateNode,m.parentNode.removeChild(m));break;case 27:fs||ea(m,h);var x=In,A=Fi;Ic(m.type)&&(In=m.stateNode,Fi=!1),Za(c,h,m),Ig(m.stateNode),In=x,Fi=A;break;case 5:fs||ea(m,h);case 6:if(x=In,A=Fi,In=null,Za(c,h,m),In=x,Fi=A,In!==null)if(Fi)try{(In.nodeType===9?In.body:In.nodeName==="HTML"?In.ownerDocument.body:In).removeChild(m.stateNode)}catch(E){sn(m,h,E)}else try{In.removeChild(m.stateNode)}catch(E){sn(m,h,E)}break;case 18:In!==null&&(Fi?(c=In,nz(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,m.stateNode),qf(c)):nz(In,m.stateNode));break;case 4:x=In,A=Fi,In=m.stateNode.containerInfo,Fi=!0,Za(c,h,m),In=x,Fi=A;break;case 0:case 11:case 14:case 15:Ac(2,m,h),fs||Ac(4,m,h),Za(c,h,m);break;case 1:fs||(ea(m,h),x=m.stateNode,typeof x.componentWillUnmount=="function"&&sI(m,h,x)),Za(c,h,m);break;case 21:Za(c,h,m);break;case 22:fs=(x=fs)||m.memoizedState!==null,Za(c,h,m),fs=x;break;default:Za(c,h,m)}}function uI(c,h){if(h.memoizedState===null&&(c=h.alternate,c!==null&&(c=c.memoizedState,c!==null))){c=c.dehydrated;try{qf(c)}catch(m){sn(h,h.return,m)}}}function hI(c,h){if(h.memoizedState===null&&(c=h.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{qf(c)}catch(m){sn(h,h.return,m)}}function aU(c){switch(c.tag){case 31:case 13:case 19:var h=c.stateNode;return h===null&&(h=c.stateNode=new aI),h;case 22:return c=c.stateNode,h=c._retryCache,h===null&&(h=c._retryCache=new aI),h;default:throw Error(s(435,c.tag))}}function Fy(c,h){var m=aU(c);h.forEach(function(x){if(!m.has(x)){m.add(x);var A=gU.bind(null,c,x);x.then(A,A)}})}function Hi(c,h){var m=h.deletions;if(m!==null)for(var x=0;x<m.length;x++){var A=m[x],E=c,I=h,B=I;e:for(;B!==null;){switch(B.tag){case 27:if(Ic(B.type)){In=B.stateNode,Fi=!1;break e}break;case 5:In=B.stateNode,Fi=!1;break e;case 3:case 4:In=B.stateNode.containerInfo,Fi=!0;break e}B=B.return}if(In===null)throw Error(s(160));dI(E,I,A),In=null,Fi=!1,E=A.alternate,E!==null&&(E.return=null),A.return=null}if(h.subtreeFlags&13886)for(h=h.child;h!==null;)fI(h,c),h=h.sibling}var vo=null;function fI(c,h){var m=c.alternate,x=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:Hi(h,c),Ui(c),x&4&&(Ac(3,c,c.return),kg(3,c),Ac(5,c,c.return));break;case 1:Hi(h,c),Ui(c),x&512&&(fs||m===null||ea(m,m.return)),x&64&&Qa&&(c=c.updateQueue,c!==null&&(x=c.callbacks,x!==null&&(m=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=m===null?x:m.concat(x))));break;case 26:var A=vo;if(Hi(h,c),Ui(c),x&512&&(fs||m===null||ea(m,m.return)),x&4){var E=m!==null?m.memoizedState:null;if(x=c.memoizedState,m===null)if(x===null)if(c.stateNode===null){e:{x=c.type,m=c.memoizedProps,A=A.ownerDocument||A;t:switch(x){case"title":E=A.getElementsByTagName("title")[0],(!E||E[Kd]||E[Un]||E.namespaceURI==="http://www.w3.org/2000/svg"||E.hasAttribute("itemprop"))&&(E=A.createElement(x),A.head.insertBefore(E,A.querySelector("head > title"))),Ys(E,x,m),E[Un]=c,cs(E),x=E;break e;case"link":var I=fz("link","href",A).get(x+(m.href||""));if(I){for(var B=0;B<I.length;B++)if(E=I[B],E.getAttribute("href")===(m.href==null||m.href===""?null:m.href)&&E.getAttribute("rel")===(m.rel==null?null:m.rel)&&E.getAttribute("title")===(m.title==null?null:m.title)&&E.getAttribute("crossorigin")===(m.crossOrigin==null?null:m.crossOrigin)){I.splice(B,1);break t}}E=A.createElement(x),Ys(E,x,m),A.head.appendChild(E);break;case"meta":if(I=fz("meta","content",A).get(x+(m.content||""))){for(B=0;B<I.length;B++)if(E=I[B],E.getAttribute("content")===(m.content==null?null:""+m.content)&&E.getAttribute("name")===(m.name==null?null:m.name)&&E.getAttribute("property")===(m.property==null?null:m.property)&&E.getAttribute("http-equiv")===(m.httpEquiv==null?null:m.httpEquiv)&&E.getAttribute("charset")===(m.charSet==null?null:m.charSet)){I.splice(B,1);break t}}E=A.createElement(x),Ys(E,x,m),A.head.appendChild(E);break;default:throw Error(s(468,x))}E[Un]=c,cs(E),x=E}c.stateNode=x}else pz(A,c.type,c.stateNode);else c.stateNode=hz(A,x,c.memoizedProps);else E!==x?(E===null?m.stateNode!==null&&(m=m.stateNode,m.parentNode.removeChild(m)):E.count--,x===null?pz(A,c.type,c.stateNode):hz(A,x,c.memoizedProps)):x===null&&c.stateNode!==null&&C1(c,c.memoizedProps,m.memoizedProps)}break;case 27:Hi(h,c),Ui(c),x&512&&(fs||m===null||ea(m,m.return)),m!==null&&x&4&&C1(c,c.memoizedProps,m.memoizedProps);break;case 5:if(Hi(h,c),Ui(c),x&512&&(fs||m===null||ea(m,m.return)),c.flags&32){A=c.stateNode;try{hc(A,"")}catch(et){sn(c,c.return,et)}}x&4&&c.stateNode!=null&&(A=c.memoizedProps,C1(c,A,m!==null?m.memoizedProps:A)),x&1024&&(E1=!0);break;case 6:if(Hi(h,c),Ui(c),x&4){if(c.stateNode===null)throw Error(s(162));x=c.memoizedProps,m=c.stateNode;try{m.nodeValue=x}catch(et){sn(c,c.return,et)}}break;case 3:if(nv=null,A=vo,vo=ev(h.containerInfo),Hi(h,c),vo=A,Ui(c),x&4&&m!==null&&m.memoizedState.isDehydrated)try{qf(h.containerInfo)}catch(et){sn(c,c.return,et)}E1&&(E1=!1,pI(c));break;case 4:x=vo,vo=ev(c.stateNode.containerInfo),Hi(h,c),Ui(c),vo=x;break;case 12:Hi(h,c),Ui(c);break;case 31:Hi(h,c),Ui(c),x&4&&(x=c.updateQueue,x!==null&&(c.updateQueue=null,Fy(c,x)));break;case 13:Hi(h,c),Ui(c),c.child.flags&8192&&c.memoizedState!==null!=(m!==null&&m.memoizedState!==null)&&(Uy=Qt()),x&4&&(x=c.updateQueue,x!==null&&(c.updateQueue=null,Fy(c,x)));break;case 22:A=c.memoizedState!==null;var X=m!==null&&m.memoizedState!==null,de=Qa,we=fs;if(Qa=de||A,fs=we||X,Hi(h,c),fs=we,Qa=de,Ui(c),x&8192)e:for(h=c.stateNode,h._visibility=A?h._visibility&-2:h._visibility|1,A&&(m===null||X||Qa||fs||fu(c)),m=null,h=c;;){if(h.tag===5||h.tag===26){if(m===null){X=m=h;try{if(E=X.stateNode,A)I=E.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none";else{B=X.stateNode;var Ee=X.memoizedProps.style,fe=Ee!=null&&Ee.hasOwnProperty("display")?Ee.display:null;B.style.display=fe==null||typeof fe=="boolean"?"":(""+fe).trim()}}catch(et){sn(X,X.return,et)}}}else if(h.tag===6){if(m===null){X=h;try{X.stateNode.nodeValue=A?"":X.memoizedProps}catch(et){sn(X,X.return,et)}}}else if(h.tag===18){if(m===null){X=h;try{var ge=X.stateNode;A?sz(ge,!0):sz(X.stateNode,!1)}catch(et){sn(X,X.return,et)}}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===c)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===c)break e;for(;h.sibling===null;){if(h.return===null||h.return===c)break e;m===h&&(m=null),h=h.return}m===h&&(m=null),h.sibling.return=h.return,h=h.sibling}x&4&&(x=c.updateQueue,x!==null&&(m=x.retryQueue,m!==null&&(x.retryQueue=null,Fy(c,m))));break;case 19:Hi(h,c),Ui(c),x&4&&(x=c.updateQueue,x!==null&&(c.updateQueue=null,Fy(c,x)));break;case 30:break;case 21:break;default:Hi(h,c),Ui(c)}}function Ui(c){var h=c.flags;if(h&2){try{for(var m,x=c.return;x!==null;){if(rI(x)){m=x;break}x=x.return}if(m==null)throw Error(s(160));switch(m.tag){case 27:var A=m.stateNode,E=A1(c);By(c,E,A);break;case 5:var I=m.stateNode;m.flags&32&&(hc(I,""),m.flags&=-33);var B=A1(c);By(c,B,I);break;case 3:case 4:var X=m.stateNode.containerInfo,de=A1(c);N1(c,de,X);break;default:throw Error(s(161))}}catch(we){sn(c,c.return,we)}c.flags&=-3}h&4096&&(c.flags&=-4097)}function pI(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var h=c;pI(h),h.tag===5&&h.flags&1024&&h.stateNode.reset(),c=c.sibling}}function el(c,h){if(h.subtreeFlags&8772)for(h=h.child;h!==null;)lI(c,h.alternate,h),h=h.sibling}function fu(c){for(c=c.child;c!==null;){var h=c;switch(h.tag){case 0:case 11:case 14:case 15:Ac(4,h,h.return),fu(h);break;case 1:ea(h,h.return);var m=h.stateNode;typeof m.componentWillUnmount=="function"&&sI(h,h.return,m),fu(h);break;case 27:Ig(h.stateNode);case 26:case 5:ea(h,h.return),fu(h);break;case 22:h.memoizedState===null&&fu(h);break;case 30:fu(h);break;default:fu(h)}c=c.sibling}}function tl(c,h,m){for(m=m&&(h.subtreeFlags&8772)!==0,h=h.child;h!==null;){var x=h.alternate,A=c,E=h,I=E.flags;switch(E.tag){case 0:case 11:case 15:tl(A,E,m),kg(4,E);break;case 1:if(tl(A,E,m),x=E,A=x.stateNode,typeof A.componentDidMount=="function")try{A.componentDidMount()}catch(de){sn(x,x.return,de)}if(x=E,A=x.updateQueue,A!==null){var B=x.stateNode;try{var X=A.shared.hiddenCallbacks;if(X!==null)for(A.shared.hiddenCallbacks=null,A=0;A<X.length;A++)VM(X[A],B)}catch(de){sn(x,x.return,de)}}m&&I&64&&nI(E),Sg(E,E.return);break;case 27:oI(E);case 26:case 5:tl(A,E,m),m&&x===null&&I&4&&iI(E),Sg(E,E.return);break;case 12:tl(A,E,m);break;case 31:tl(A,E,m),m&&I&4&&uI(A,E);break;case 13:tl(A,E,m),m&&I&4&&hI(A,E);break;case 22:E.memoizedState===null&&tl(A,E,m),Sg(E,E.return);break;case 30:break;default:tl(A,E,m)}h=h.sibling}}function T1(c,h){var m=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(m=c.memoizedState.cachePool.pool),c=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(c=h.memoizedState.cachePool.pool),c!==m&&(c!=null&&c.refCount++,m!=null&&cg(m))}function _1(c,h){c=null,h.alternate!==null&&(c=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==c&&(h.refCount++,c!=null&&cg(c))}function wo(c,h,m,x){if(h.subtreeFlags&10256)for(h=h.child;h!==null;)mI(c,h,m,x),h=h.sibling}function mI(c,h,m,x){var A=h.flags;switch(h.tag){case 0:case 11:case 15:wo(c,h,m,x),A&2048&&kg(9,h);break;case 1:wo(c,h,m,x);break;case 3:wo(c,h,m,x),A&2048&&(c=null,h.alternate!==null&&(c=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==c&&(h.refCount++,c!=null&&cg(c)));break;case 12:if(A&2048){wo(c,h,m,x),c=h.stateNode;try{var E=h.memoizedProps,I=E.id,B=E.onPostCommit;typeof B=="function"&&B(I,h.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(X){sn(h,h.return,X)}}else wo(c,h,m,x);break;case 31:wo(c,h,m,x);break;case 13:wo(c,h,m,x);break;case 23:break;case 22:E=h.stateNode,I=h.alternate,h.memoizedState!==null?E._visibility&2?wo(c,h,m,x):Cg(c,h):E._visibility&2?wo(c,h,m,x):(E._visibility|=2,jf(c,h,m,x,(h.subtreeFlags&10256)!==0||!1)),A&2048&&T1(I,h);break;case 24:wo(c,h,m,x),A&2048&&_1(h.alternate,h);break;default:wo(c,h,m,x)}}function jf(c,h,m,x,A){for(A=A&&((h.subtreeFlags&10256)!==0||!1),h=h.child;h!==null;){var E=c,I=h,B=m,X=x,de=I.flags;switch(I.tag){case 0:case 11:case 15:jf(E,I,B,X,A),kg(8,I);break;case 23:break;case 22:var we=I.stateNode;I.memoizedState!==null?we._visibility&2?jf(E,I,B,X,A):Cg(E,I):(we._visibility|=2,jf(E,I,B,X,A)),A&&de&2048&&T1(I.alternate,I);break;case 24:jf(E,I,B,X,A),A&&de&2048&&_1(I.alternate,I);break;default:jf(E,I,B,X,A)}h=h.sibling}}function Cg(c,h){if(h.subtreeFlags&10256)for(h=h.child;h!==null;){var m=c,x=h,A=x.flags;switch(x.tag){case 22:Cg(m,x),A&2048&&T1(x.alternate,x);break;case 24:Cg(m,x),A&2048&&_1(x.alternate,x);break;default:Cg(m,x)}h=h.sibling}}var Ag=8192;function Pf(c,h,m){if(c.subtreeFlags&Ag)for(c=c.child;c!==null;)gI(c,h,m),c=c.sibling}function gI(c,h,m){switch(c.tag){case 26:Pf(c,h,m),c.flags&Ag&&c.memoizedState!==null&&WU(m,vo,c.memoizedState,c.memoizedProps);break;case 5:Pf(c,h,m);break;case 3:case 4:var x=vo;vo=ev(c.stateNode.containerInfo),Pf(c,h,m),vo=x;break;case 22:c.memoizedState===null&&(x=c.alternate,x!==null&&x.memoizedState!==null?(x=Ag,Ag=16777216,Pf(c,h,m),Ag=x):Pf(c,h,m));break;default:Pf(c,h,m)}}function xI(c){var h=c.alternate;if(h!==null&&(c=h.child,c!==null)){h.child=null;do h=c.sibling,c.sibling=null,c=h;while(c!==null)}}function Ng(c){var h=c.deletions;if((c.flags&16)!==0){if(h!==null)for(var m=0;m<h.length;m++){var x=h[m];Rs=x,yI(x,c)}xI(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)bI(c),c=c.sibling}function bI(c){switch(c.tag){case 0:case 11:case 15:Ng(c),c.flags&2048&&Ac(9,c,c.return);break;case 3:Ng(c);break;case 12:Ng(c);break;case 22:var h=c.stateNode;c.memoizedState!==null&&h._visibility&2&&(c.return===null||c.return.tag!==13)?(h._visibility&=-3,Hy(c)):Ng(c);break;default:Ng(c)}}function Hy(c){var h=c.deletions;if((c.flags&16)!==0){if(h!==null)for(var m=0;m<h.length;m++){var x=h[m];Rs=x,yI(x,c)}xI(c)}for(c=c.child;c!==null;){switch(h=c,h.tag){case 0:case 11:case 15:Ac(8,h,h.return),Hy(h);break;case 22:m=h.stateNode,m._visibility&2&&(m._visibility&=-3,Hy(h));break;default:Hy(h)}c=c.sibling}}function yI(c,h){for(;Rs!==null;){var m=Rs;switch(m.tag){case 0:case 11:case 15:Ac(8,m,h);break;case 23:case 22:if(m.memoizedState!==null&&m.memoizedState.cachePool!==null){var x=m.memoizedState.cachePool.pool;x!=null&&x.refCount++}break;case 24:cg(m.memoizedState.cache)}if(x=m.child,x!==null)x.return=m,Rs=x;else e:for(m=c;Rs!==null;){x=Rs;var A=x.sibling,E=x.return;if(cI(x),x===m){Rs=null;break e}if(A!==null){A.return=E,Rs=A;break e}Rs=E}}}var lU={getCacheForType:function(c){var h=Ws(ds),m=h.data.get(c);return m===void 0&&(m=c(),h.data.set(c,m)),m},cacheSignal:function(){return Ws(ds).controller.signal}},cU=typeof WeakMap=="function"?WeakMap:Map,en=0,mn=null,zt=null,Lt=0,nn=0,dr=null,Nc=!1,Lf=!1,M1=!1,nl=0,Gn=0,Ec=0,pu=0,R1=0,ur=0,Of=0,Eg=null,$i=null,I1=!1,Uy=0,vI=0,$y=1/0,Gy=null,Tc=null,ws=0,_c=null,Bf=null,sl=0,z1=0,D1=null,wI=null,Tg=0,j1=null;function hr(){return(en&2)!==0&&Lt!==0?Lt&-Lt:$.T!==null?H1():af()}function kI(){if(ur===0)if((Lt&536870912)===0||Ut){var c=lt;lt<<=1,(lt&3932160)===0&&(lt=262144),ur=c}else ur=536870912;return c=lr.current,c!==null&&(c.flags|=32),ur}function Gi(c,h,m){(c===mn&&(nn===2||nn===9)||c.cancelPendingCommit!==null)&&(Ff(c,0),Mc(c,Lt,ur,!1)),ys(c,m),((en&2)===0||c!==mn)&&(c===mn&&((en&2)===0&&(pu|=m),Gn===4&&Mc(c,Lt,ur,!1)),ta(c))}function SI(c,h,m){if((en&6)!==0)throw Error(s(327));var x=!m&&(h&127)===0&&(h&c.expiredLanes)===0||Zt(c,h),A=x?hU(c,h):L1(c,h,!0),E=x;do{if(A===0){Lf&&!x&&Mc(c,h,0,!1);break}else{if(m=c.current.alternate,E&&!dU(m)){A=L1(c,h,!1),E=!1;continue}if(A===2){if(E=h,c.errorRecoveryDisabledLanes&E)var I=0;else I=c.pendingLanes&-536870913,I=I!==0?I:I&536870912?536870912:0;if(I!==0){h=I;e:{var B=c;A=Eg;var X=B.current.memoizedState.isDehydrated;if(X&&(Ff(B,I).flags|=256),I=L1(B,I,!1),I!==2){if(M1&&!X){B.errorRecoveryDisabledLanes|=E,pu|=E,A=4;break e}E=$i,$i=A,E!==null&&($i===null?$i=E:$i.push.apply($i,E))}A=I}if(E=!1,A!==2)continue}}if(A===1){Ff(c,0),Mc(c,h,0,!0);break}e:{switch(x=c,E=A,E){case 0:case 1:throw Error(s(345));case 4:if((h&4194048)!==h)break;case 6:Mc(x,h,ur,!Nc);break e;case 2:$i=null;break;case 3:case 5:break;default:throw Error(s(329))}if((h&62914560)===h&&(A=Uy+300-Qt(),10<A)){if(Mc(x,h,ur,!Nc),Cn(x,0,!0)!==0)break e;sl=h,x.timeoutHandle=ez(CI.bind(null,x,m,$i,Gy,I1,h,ur,pu,Of,Nc,E,"Throttled",-0,0),A);break e}CI(x,m,$i,Gy,I1,h,ur,pu,Of,Nc,E,null,-0,0)}}break}while(!0);ta(c)}function CI(c,h,m,x,A,E,I,B,X,de,we,Ee,fe,ge){if(c.timeoutHandle=-1,Ee=h.subtreeFlags,Ee&8192||(Ee&16785408)===16785408){Ee={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:go},gI(h,E,Ee);var et=(E&62914560)===E?Uy-Qt():(E&4194048)===E?vI-Qt():0;if(et=KU(Ee,et),et!==null){sl=E,c.cancelPendingCommit=et(II.bind(null,c,h,E,m,x,A,I,B,X,we,Ee,null,fe,ge)),Mc(c,E,I,!de);return}}II(c,h,E,m,x,A,I,B,X)}function dU(c){for(var h=c;;){var m=h.tag;if((m===0||m===11||m===15)&&h.flags&16384&&(m=h.updateQueue,m!==null&&(m=m.stores,m!==null)))for(var x=0;x<m.length;x++){var A=m[x],E=A.getSnapshot;A=A.value;try{if(!or(E(),A))return!1}catch{return!1}}if(m=h.child,h.subtreeFlags&16384&&m!==null)m.return=h,h=m;else{if(h===c)break;for(;h.sibling===null;){if(h.return===null||h.return===c)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function Mc(c,h,m,x){h&=~R1,h&=~pu,c.suspendedLanes|=h,c.pingedLanes&=~h,x&&(c.warmLanes|=h),x=c.expirationTimes;for(var A=h;0<A;){var E=31-Ke(A),I=1<<E;x[E]=-1,A&=~I}m!==0&&ls(c,m,h)}function Vy(){return(en&6)===0?(_g(0),!1):!0}function P1(){if(zt!==null){if(nn===0)var c=zt.return;else c=zt,qa=ru=null,QC(c),Mf=null,ug=0,c=zt;for(;c!==null;)tI(c.alternate,c),c=c.return;zt=null}}function Ff(c,h){var m=c.timeoutHandle;m!==-1&&(c.timeoutHandle=-1,MU(m)),m=c.cancelPendingCommit,m!==null&&(c.cancelPendingCommit=null,m()),sl=0,P1(),mn=c,zt=m=Ga(c.current,null),Lt=h,nn=0,dr=null,Nc=!1,Lf=Zt(c,h),M1=!1,Of=ur=R1=pu=Ec=Gn=0,$i=Eg=null,I1=!1,(h&8)!==0&&(h|=h&32);var x=c.entangledLanes;if(x!==0)for(c=c.entanglements,x&=h;0<x;){var A=31-Ke(x),E=1<<A;h|=c[A],x&=~E}return nl=h,hy(),m}function AI(c,h){vt=null,$.H=yg,h===_f||h===vy?(h=HM(),nn=3):h===FC?(h=HM(),nn=4):nn=h===p1?8:h!==null&&typeof h=="object"&&typeof h.then=="function"?6:1,dr=h,zt===null&&(Gn=1,Dy(c,Or(h,c.current)))}function NI(){var c=lr.current;return c===null?!0:(Lt&4194048)===Lt?Ur===null:(Lt&62914560)===Lt||(Lt&536870912)!==0?c===Ur:!1}function EI(){var c=$.H;return $.H=yg,c===null?yg:c}function TI(){var c=$.A;return $.A=lU,c}function qy(){Gn=4,Nc||(Lt&4194048)!==Lt&&lr.current!==null||(Lf=!0),(Ec&134217727)===0&&(pu&134217727)===0||mn===null||Mc(mn,Lt,ur,!1)}function L1(c,h,m){var x=en;en|=2;var A=EI(),E=TI();(mn!==c||Lt!==h)&&(Gy=null,Ff(c,h)),h=!1;var I=Gn;e:do try{if(nn!==0&&zt!==null){var B=zt,X=dr;switch(nn){case 8:P1(),I=6;break e;case 3:case 2:case 9:case 6:lr.current===null&&(h=!0);var de=nn;if(nn=0,dr=null,Hf(c,B,X,de),m&&Lf){I=0;break e}break;default:de=nn,nn=0,dr=null,Hf(c,B,X,de)}}uU(),I=Gn;break}catch(we){AI(c,we)}while(!0);return h&&c.shellSuspendCounter++,qa=ru=null,en=x,$.H=A,$.A=E,zt===null&&(mn=null,Lt=0,hy()),I}function uU(){for(;zt!==null;)_I(zt)}function hU(c,h){var m=en;en|=2;var x=EI(),A=TI();mn!==c||Lt!==h?(Gy=null,$y=Qt()+500,Ff(c,h)):Lf=Zt(c,h);e:do try{if(nn!==0&&zt!==null){h=zt;var E=dr;t:switch(nn){case 1:nn=0,dr=null,Hf(c,h,E,1);break;case 2:case 9:if(BM(E)){nn=0,dr=null,MI(h);break}h=function(){nn!==2&&nn!==9||mn!==c||(nn=7),ta(c)},E.then(h,h);break e;case 3:nn=7;break e;case 4:nn=5;break e;case 7:BM(E)?(nn=0,dr=null,MI(h)):(nn=0,dr=null,Hf(c,h,E,7));break;case 5:var I=null;switch(zt.tag){case 26:I=zt.memoizedState;case 5:case 27:var B=zt;if(I?mz(I):B.stateNode.complete){nn=0,dr=null;var X=B.sibling;if(X!==null)zt=X;else{var de=B.return;de!==null?(zt=de,Wy(de)):zt=null}break t}}nn=0,dr=null,Hf(c,h,E,5);break;case 6:nn=0,dr=null,Hf(c,h,E,6);break;case 8:P1(),Gn=6;break e;default:throw Error(s(462))}}fU();break}catch(we){AI(c,we)}while(!0);return qa=ru=null,$.H=x,$.A=A,en=m,zt!==null?0:(mn=null,Lt=0,hy(),Gn)}function fU(){for(;zt!==null&&!yn();)_I(zt)}function _I(c){var h=ZR(c.alternate,c,nl);c.memoizedProps=c.pendingProps,h===null?Wy(c):zt=h}function MI(c){var h=c,m=h.alternate;switch(h.tag){case 15:case 0:h=WR(m,h,h.pendingProps,h.type,void 0,Lt);break;case 11:h=WR(m,h,h.pendingProps,h.type.render,h.ref,Lt);break;case 5:QC(h);default:tI(m,h),h=zt=TM(h,nl),h=ZR(m,h,nl)}c.memoizedProps=c.pendingProps,h===null?Wy(c):zt=h}function Hf(c,h,m,x){qa=ru=null,QC(h),Mf=null,ug=0;var A=h.return;try{if(tU(c,A,h,m,Lt)){Gn=1,Dy(c,Or(m,c.current)),zt=null;return}}catch(E){if(A!==null)throw zt=A,E;Gn=1,Dy(c,Or(m,c.current)),zt=null;return}h.flags&32768?(Ut||x===1?c=!0:Lf||(Lt&536870912)!==0?c=!1:(Nc=c=!0,(x===2||x===9||x===3||x===6)&&(x=lr.current,x!==null&&x.tag===13&&(x.flags|=16384))),RI(h,c)):Wy(h)}function Wy(c){var h=c;do{if((h.flags&32768)!==0){RI(h,Nc);return}c=h.return;var m=iU(h.alternate,h,nl);if(m!==null){zt=m;return}if(h=h.sibling,h!==null){zt=h;return}zt=h=c}while(h!==null);Gn===0&&(Gn=5)}function RI(c,h){do{var m=rU(c.alternate,c);if(m!==null){m.flags&=32767,zt=m;return}if(m=c.return,m!==null&&(m.flags|=32768,m.subtreeFlags=0,m.deletions=null),!h&&(c=c.sibling,c!==null)){zt=c;return}zt=c=m}while(c!==null);Gn=6,zt=null}function II(c,h,m,x,A,E,I,B,X){c.cancelPendingCommit=null;do Ky();while(ws!==0);if((en&6)!==0)throw Error(s(327));if(h!==null){if(h===c.current)throw Error(s(177));if(E=h.lanes|h.childLanes,E|=AC,of(c,m,E,I,B,X),c===mn&&(zt=mn=null,Lt=0),Bf=h,_c=c,sl=m,z1=E,D1=A,wI=x,(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,xU(He,function(){return LI(),null})):(c.callbackNode=null,c.callbackPriority=0),x=(h.flags&13878)!==0,(h.subtreeFlags&13878)!==0||x){x=$.T,$.T=null,A=Y.p,Y.p=2,I=en,en|=4;try{oU(c,h,m)}finally{en=I,Y.p=A,$.T=x}}ws=1,zI(),DI(),jI()}}function zI(){if(ws===1){ws=0;var c=_c,h=Bf,m=(h.flags&13878)!==0;if((h.subtreeFlags&13878)!==0||m){m=$.T,$.T=null;var x=Y.p;Y.p=2;var A=en;en|=4;try{fI(h,c);var E=Y1,I=yM(c.containerInfo),B=E.focusedElem,X=E.selectionRange;if(I!==B&&B&&B.ownerDocument&&bM(B.ownerDocument.documentElement,B)){if(X!==null&&vC(B)){var de=X.start,we=X.end;if(we===void 0&&(we=de),"selectionStart"in B)B.selectionStart=de,B.selectionEnd=Math.min(we,B.value.length);else{var Ee=B.ownerDocument||document,fe=Ee&&Ee.defaultView||window;if(fe.getSelection){var ge=fe.getSelection(),et=B.textContent.length,ft=Math.min(X.start,et),un=X.end===void 0?ft:Math.min(X.end,et);!ge.extend&&ft>un&&(I=un,un=ft,ft=I);var oe=xM(B,ft),ne=xM(B,un);if(oe&&ne&&(ge.rangeCount!==1||ge.anchorNode!==oe.node||ge.anchorOffset!==oe.offset||ge.focusNode!==ne.node||ge.focusOffset!==ne.offset)){var ce=Ee.createRange();ce.setStart(oe.node,oe.offset),ge.removeAllRanges(),ft>un?(ge.addRange(ce),ge.extend(ne.node,ne.offset)):(ce.setEnd(ne.node,ne.offset),ge.addRange(ce))}}}}for(Ee=[],ge=B;ge=ge.parentNode;)ge.nodeType===1&&Ee.push({element:ge,left:ge.scrollLeft,top:ge.scrollTop});for(typeof B.focus=="function"&&B.focus(),B=0;B<Ee.length;B++){var Ce=Ee[B];Ce.element.scrollLeft=Ce.left,Ce.element.scrollTop=Ce.top}}ov=!!K1,Y1=K1=null}finally{en=A,Y.p=x,$.T=m}}c.current=h,ws=2}}function DI(){if(ws===2){ws=0;var c=_c,h=Bf,m=(h.flags&8772)!==0;if((h.subtreeFlags&8772)!==0||m){m=$.T,$.T=null;var x=Y.p;Y.p=2;var A=en;en|=4;try{lI(c,h.alternate,h)}finally{en=A,Y.p=x,$.T=m}}ws=3}}function jI(){if(ws===4||ws===3){ws=0,_t();var c=_c,h=Bf,m=sl,x=wI;(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?ws=5:(ws=0,Bf=_c=null,PI(c,c.pendingLanes));var A=c.pendingLanes;if(A===0&&(Tc=null),Fa(m),h=h.stateNode,se&&typeof se.onCommitFiberRoot=="function")try{se.onCommitFiberRoot(De,h,void 0,(h.current.flags&128)===128)}catch{}if(x!==null){h=$.T,A=Y.p,Y.p=2,$.T=null;try{for(var E=c.onRecoverableError,I=0;I<x.length;I++){var B=x[I];E(B.value,{componentStack:B.stack})}}finally{$.T=h,Y.p=A}}(sl&3)!==0&&Ky(),ta(c),A=c.pendingLanes,(m&261930)!==0&&(A&42)!==0?c===j1?Tg++:(Tg=0,j1=c):Tg=0,_g(0)}}function PI(c,h){(c.pooledCacheLanes&=h)===0&&(h=c.pooledCache,h!=null&&(c.pooledCache=null,cg(h)))}function Ky(){return zI(),DI(),jI(),LI()}function LI(){if(ws!==5)return!1;var c=_c,h=z1;z1=0;var m=Fa(sl),x=$.T,A=Y.p;try{Y.p=32>m?32:m,$.T=null,m=D1,D1=null;var E=_c,I=sl;if(ws=0,Bf=_c=null,sl=0,(en&6)!==0)throw Error(s(331));var B=en;if(en|=4,bI(E.current),mI(E,E.current,I,m),en=B,_g(0,!1),se&&typeof se.onPostCommitFiberRoot=="function")try{se.onPostCommitFiberRoot(De,E)}catch{}return!0}finally{Y.p=A,$.T=x,PI(c,h)}}function OI(c,h,m){h=Or(m,h),h=f1(c.stateNode,h,2),c=kc(c,h,2),c!==null&&(ys(c,2),ta(c))}function sn(c,h,m){if(c.tag===3)OI(c,c,m);else for(;h!==null;){if(h.tag===3){OI(h,c,m);break}else if(h.tag===1){var x=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(Tc===null||!Tc.has(x))){c=Or(m,c),m=BR(2),x=kc(h,m,2),x!==null&&(FR(m,x,h,c),ys(x,2),ta(x));break}}h=h.return}}function O1(c,h,m){var x=c.pingCache;if(x===null){x=c.pingCache=new cU;var A=new Set;x.set(h,A)}else A=x.get(h),A===void 0&&(A=new Set,x.set(h,A));A.has(m)||(M1=!0,A.add(m),c=pU.bind(null,c,h,m),h.then(c,c))}function pU(c,h,m){var x=c.pingCache;x!==null&&x.delete(h),c.pingedLanes|=c.suspendedLanes&m,c.warmLanes&=~m,mn===c&&(Lt&m)===m&&(Gn===4||Gn===3&&(Lt&62914560)===Lt&&300>Qt()-Uy?(en&2)===0&&Ff(c,0):R1|=m,Of===Lt&&(Of=0)),ta(c)}function BI(c,h){h===0&&(h=Hn()),c=nu(c,h),c!==null&&(ys(c,h),ta(c))}function mU(c){var h=c.memoizedState,m=0;h!==null&&(m=h.retryLane),BI(c,m)}function gU(c,h){var m=0;switch(c.tag){case 31:case 13:var x=c.stateNode,A=c.memoizedState;A!==null&&(m=A.retryLane);break;case 19:x=c.stateNode;break;case 22:x=c.stateNode._retryCache;break;default:throw Error(s(314))}x!==null&&x.delete(h),BI(c,m)}function xU(c,h){return qt(c,h)}var Yy=null,Uf=null,B1=!1,Jy=!1,F1=!1,Rc=0;function ta(c){c!==Uf&&c.next===null&&(Uf===null?Yy=Uf=c:Uf=Uf.next=c),Jy=!0,B1||(B1=!0,yU())}function _g(c,h){if(!F1&&Jy){F1=!0;do for(var m=!1,x=Yy;x!==null;){if(c!==0){var A=x.pendingLanes;if(A===0)var E=0;else{var I=x.suspendedLanes,B=x.pingedLanes;E=(1<<31-Ke(42|c)+1)-1,E&=A&~(I&~B),E=E&201326741?E&201326741|1:E?E|2:0}E!==0&&(m=!0,$I(x,E))}else E=Lt,E=Cn(x,x===mn?E:0,x.cancelPendingCommit!==null||x.timeoutHandle!==-1),(E&3)===0||Zt(x,E)||(m=!0,$I(x,E));x=x.next}while(m);F1=!1}}function bU(){FI()}function FI(){Jy=B1=!1;var c=0;Rc!==0&&_U()&&(c=Rc);for(var h=Qt(),m=null,x=Yy;x!==null;){var A=x.next,E=HI(x,h);E===0?(x.next=null,m===null?Yy=A:m.next=A,A===null&&(Uf=m)):(m=x,(c!==0||(E&3)!==0)&&(Jy=!0)),x=A}ws!==0&&ws!==5||_g(c),Rc!==0&&(Rc=0)}function HI(c,h){for(var m=c.suspendedLanes,x=c.pingedLanes,A=c.expirationTimes,E=c.pendingLanes&-62914561;0<E;){var I=31-Ke(E),B=1<<I,X=A[I];X===-1?((B&m)===0||(B&x)!==0)&&(A[I]=Pn(B,h)):X<=h&&(c.expiredLanes|=B),E&=~B}if(h=mn,m=Lt,m=Cn(c,c===h?m:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),x=c.callbackNode,m===0||c===h&&(nn===2||nn===9)||c.cancelPendingCommit!==null)return x!==null&&x!==null&&jt(x),c.callbackNode=null,c.callbackPriority=0;if((m&3)===0||Zt(c,m)){if(h=m&-m,h===c.callbackPriority)return h;switch(x!==null&&jt(x),Fa(m)){case 2:case 8:m=Me;break;case 32:m=He;break;case 268435456:m=Sn;break;default:m=He}return x=UI.bind(null,c),m=qt(m,x),c.callbackPriority=h,c.callbackNode=m,h}return x!==null&&x!==null&&jt(x),c.callbackPriority=2,c.callbackNode=null,2}function UI(c,h){if(ws!==0&&ws!==5)return c.callbackNode=null,c.callbackPriority=0,null;var m=c.callbackNode;if(Ky()&&c.callbackNode!==m)return null;var x=Lt;return x=Cn(c,c===mn?x:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),x===0?null:(SI(c,x,h),HI(c,Qt()),c.callbackNode!=null&&c.callbackNode===m?UI.bind(null,c):null)}function $I(c,h){if(Ky())return null;SI(c,h,!0)}function yU(){RU(function(){(en&6)!==0?qt(Se,bU):FI()})}function H1(){if(Rc===0){var c=Ef;c===0&&(c=Ue,Ue<<=1,(Ue&261888)===0&&(Ue=256)),Rc=c}return Rc}function GI(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:ff(""+c)}function VI(c,h){var m=h.ownerDocument.createElement("input");return m.name=h.name,m.value=h.value,c.id&&m.setAttribute("form",c.id),h.parentNode.insertBefore(m,h),c=new FormData(c),m.parentNode.removeChild(m),c}function vU(c,h,m,x,A){if(h==="submit"&&m&&m.stateNode===A){var E=GI((A[at]||null).action),I=x.submitter;I&&(h=(h=I[at]||null)?GI(h.formAction):I.getAttribute("formAction"),h!==null&&(E=h,I=null));var B=new gf("action","action",null,x,A);c.push({event:B,listeners:[{instance:null,listener:function(){if(x.defaultPrevented){if(Rc!==0){var X=I?VI(A,I):new FormData(A);a1(m,{pending:!0,data:X,method:A.method,action:E},null,X)}}else typeof E=="function"&&(B.preventDefault(),X=I?VI(A,I):new FormData(A),a1(m,{pending:!0,data:X,method:A.method,action:E},E,X))},currentTarget:A}]})}}for(var U1=0;U1<CC.length;U1++){var $1=CC[U1],wU=$1.toLowerCase(),kU=$1[0].toUpperCase()+$1.slice(1);yo(wU,"on"+kU)}yo(kM,"onAnimationEnd"),yo(SM,"onAnimationIteration"),yo(CM,"onAnimationStart"),yo("dblclick","onDoubleClick"),yo("focusin","onFocus"),yo("focusout","onBlur"),yo(OH,"onTransitionRun"),yo(BH,"onTransitionStart"),yo(FH,"onTransitionCancel"),yo(AM,"onTransitionEnd"),ac("onMouseEnter",["mouseout","mouseover"]),ac("onMouseLeave",["mouseout","mouseover"]),ac("onPointerEnter",["pointerout","pointerover"]),ac("onPointerLeave",["pointerout","pointerover"]),Jo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Jo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Jo("onBeforeInput",["compositionend","keypress","textInput","paste"]),Jo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Jo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Jo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),SU=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Mg));function qI(c,h){h=(h&4)!==0;for(var m=0;m<c.length;m++){var x=c[m],A=x.event;x=x.listeners;e:{var E=void 0;if(h)for(var I=x.length-1;0<=I;I--){var B=x[I],X=B.instance,de=B.currentTarget;if(B=B.listener,X!==E&&A.isPropagationStopped())break e;E=B,A.currentTarget=de;try{E(A)}catch(we){uy(we)}A.currentTarget=null,E=X}else for(I=0;I<x.length;I++){if(B=x[I],X=B.instance,de=B.currentTarget,B=B.listener,X!==E&&A.isPropagationStopped())break e;E=B,A.currentTarget=de;try{E(A)}catch(we){uy(we)}A.currentTarget=null,E=X}}}}function Dt(c,h){var m=h[Ko];m===void 0&&(m=h[Ko]=new Set);var x=c+"__bubble";m.has(x)||(WI(h,c,2,!1),m.add(x))}function G1(c,h,m){var x=0;h&&(x|=4),WI(m,c,x,h)}var Xy="_reactListening"+Math.random().toString(36).slice(2);function V1(c){if(!c[Xy]){c[Xy]=!0,lf.forEach(function(m){m!=="selectionchange"&&(SU.has(m)||G1(m,!1,c),G1(m,!0,c))});var h=c.nodeType===9?c:c.ownerDocument;h===null||h[Xy]||(h[Xy]=!0,G1("selectionchange",!1,h))}}function WI(c,h,m,x){switch(kz(h)){case 2:var A=XU;break;case 8:A=QU;break;default:A=oA}m=A.bind(null,h,m,c),A=void 0,!tg||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(A=!0),x?A!==void 0?c.addEventListener(h,m,{capture:!0,passive:A}):c.addEventListener(h,m,!0):A!==void 0?c.addEventListener(h,m,{passive:A}):c.addEventListener(h,m,!1)}function q1(c,h,m,x,A){var E=x;if((h&1)===0&&(h&2)===0&&x!==null)e:for(;;){if(x===null)return;var I=x.tag;if(I===3||I===4){var B=x.stateNode.containerInfo;if(B===A)break;if(I===4)for(I=x.return;I!==null;){var X=I.tag;if((X===3||X===4)&&I.stateNode.containerInfo===A)return;I=I.return}for(;B!==null;){if(I=oc(B),I===null)return;if(X=I.tag,X===5||X===6||X===26||X===27){x=E=I;continue e}B=B.parentNode}}x=x.return}ny(function(){var de=E,we=Zm(m),Ee=[];e:{var fe=NM.get(c);if(fe!==void 0){var ge=gf,et=c;switch(c){case"keypress":if(pf(m)===0)break e;case"keydown":case"keyup":ge=nM;break;case"focusin":et="focus",ge=oy;break;case"focusout":et="blur",ge=oy;break;case"beforeblur":case"afterblur":ge=oy;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ge=ry;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ge=uC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ge=rM;break;case kM:case SM:case CM:ge=W2;break;case AM:ge=aM;break;case"scroll":case"scrollend":ge=cC;break;case"wheel":ge=cM;break;case"copy":case"cut":case"paste":ge=Y2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ge=fC;break;case"toggle":case"beforetoggle":ge=uM}var ft=(h&4)!==0,un=!ft&&(c==="scroll"||c==="scrollend"),oe=ft?fe!==null?fe+"Capture":null:fe;ft=[];for(var ne=de,ce;ne!==null;){var Ce=ne;if(ce=Ce.stateNode,Ce=Ce.tag,Ce!==5&&Ce!==26&&Ce!==27||ce===null||oe===null||(Ce=xo(ne,oe),Ce!=null&&ft.push(Rg(ne,Ce,ce))),un)break;ne=ne.return}0<ft.length&&(fe=new ge(fe,et,null,m,we),Ee.push({event:fe,listeners:ft}))}}if((h&7)===0){e:{if(fe=c==="mouseover"||c==="pointerover",ge=c==="mouseout"||c==="pointerout",fe&&m!==Qm&&(et=m.relatedTarget||m.fromElement)&&(oc(et)||et[vn]))break e;if((ge||fe)&&(fe=we.window===we?we:(fe=we.ownerDocument)?fe.defaultView||fe.parentWindow:window,ge?(et=m.relatedTarget||m.toElement,ge=de,et=et?oc(et):null,et!==null&&(un=r(et),ft=et.tag,et!==un||ft!==5&&ft!==27&&ft!==6)&&(et=null)):(ge=null,et=de),ge!==et)){if(ft=ry,Ce="onMouseLeave",oe="onMouseEnter",ne="mouse",(c==="pointerout"||c==="pointerover")&&(ft=fC,Ce="onPointerLeave",oe="onPointerEnter",ne="pointer"),un=ge==null?fe:Ua(ge),ce=et==null?fe:Ua(et),fe=new ft(Ce,ne+"leave",ge,m,we),fe.target=un,fe.relatedTarget=ce,Ce=null,oc(we)===de&&(ft=new ft(oe,ne+"enter",et,m,we),ft.target=ce,ft.relatedTarget=un,Ce=ft),un=Ce,ge&&et)t:{for(ft=CU,oe=ge,ne=et,ce=0,Ce=oe;Ce;Ce=ft(Ce))ce++;Ce=0;for(var ct=ne;ct;ct=ft(ct))Ce++;for(;0<ce-Ce;)oe=ft(oe),ce--;for(;0<Ce-ce;)ne=ft(ne),Ce--;for(;ce--;){if(oe===ne||ne!==null&&oe===ne.alternate){ft=oe;break t}oe=ft(oe),ne=ft(ne)}ft=null}else ft=null;ge!==null&&KI(Ee,fe,ge,ft,!1),et!==null&&un!==null&&KI(Ee,un,et,ft,!0)}}e:{if(fe=de?Ua(de):window,ge=fe.nodeName&&fe.nodeName.toLowerCase(),ge==="select"||ge==="input"&&fe.type==="file")var Wt=ht;else if(K(fe))if(yt)Wt=jH;else{Wt=zH;var st=dy}else ge=fe.nodeName,!ge||ge.toLowerCase()!=="input"||fe.type!=="checkbox"&&fe.type!=="radio"?de&&Xm(de.elementType)&&(Wt=ht):Wt=DH;if(Wt&&(Wt=Wt(c,de))){ae(Ee,Wt,m,we);break e}st&&st(c,fe,de),c==="focusout"&&de&&fe.type==="number"&&de.memoizedProps.value!=null&&Jm(fe,"number",fe.value)}switch(st=de?Ua(de):window,c){case"focusin":(K(st)||st.contentEditable==="true")&&(yf=st,wC=de,og=null);break;case"focusout":og=wC=yf=null;break;case"mousedown":kC=!0;break;case"contextmenu":case"mouseup":case"dragend":kC=!1,vM(Ee,m,we);break;case"selectionchange":if(LH)break;case"keydown":case"keyup":vM(Ee,m,we)}var St;if(ly)e:{switch(c){case"compositionstart":var Ot="onCompositionStart";break e;case"compositionend":Ot="onCompositionEnd";break e;case"compositionupdate":Ot="onCompositionUpdate";break e}Ot=void 0}else Zd?xC(c,m)&&(Ot="onCompositionEnd"):c==="keydown"&&m.keyCode===229&&(Ot="onCompositionStart");Ot&&(pC&&m.locale!=="ko"&&(Zd||Ot!=="onCompositionStart"?Ot==="onCompositionEnd"&&Zd&&(St=sy()):(Xo=we,ng="value"in Xo?Xo.value:Xo.textContent,Zd=!0)),st=Qy(de,Ot),0<st.length&&(Ot=new hC(Ot,c,null,m,we),Ee.push({event:Ot,listeners:st}),St?Ot.data=St:(St=bC(m),St!==null&&(Ot.data=St)))),(St=fM?pM(c,m):mM(c,m))&&(Ot=Qy(de,"onBeforeInput"),0<Ot.length&&(st=new hC("onBeforeInput","beforeinput",null,m,we),Ee.push({event:st,listeners:Ot}),st.data=St)),vU(Ee,c,de,m,we)}qI(Ee,h)})}function Rg(c,h,m){return{instance:c,listener:h,currentTarget:m}}function Qy(c,h){for(var m=h+"Capture",x=[];c!==null;){var A=c,E=A.stateNode;if(A=A.tag,A!==5&&A!==26&&A!==27||E===null||(A=xo(c,m),A!=null&&x.unshift(Rg(c,A,E)),A=xo(c,h),A!=null&&x.push(Rg(c,A,E))),c.tag===3)return x;c=c.return}return[]}function CU(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function KI(c,h,m,x,A){for(var E=h._reactName,I=[];m!==null&&m!==x;){var B=m,X=B.alternate,de=B.stateNode;if(B=B.tag,X!==null&&X===x)break;B!==5&&B!==26&&B!==27||de===null||(X=de,A?(de=xo(m,E),de!=null&&I.unshift(Rg(m,de,X))):A||(de=xo(m,E),de!=null&&I.push(Rg(m,de,X)))),m=m.return}I.length!==0&&c.push({event:h,listeners:I})}var AU=/\r\n?/g,NU=/\u0000|\uFFFD/g;function YI(c){return(typeof c=="string"?c:""+c).replace(AU,`
`).replace(NU,"")}function JI(c,h){return h=YI(h),YI(c)===h}function dn(c,h,m,x,A,E){switch(m){case"children":typeof x=="string"?h==="body"||h==="textarea"&&x===""||hc(c,x):(typeof x=="number"||typeof x=="bigint")&&h!=="body"&&hc(c,""+x);break;case"className":cf(c,"class",x);break;case"tabIndex":cf(c,"tabindex",x);break;case"dir":case"role":case"viewBox":case"width":case"height":cf(c,m,x);break;case"style":ey(c,x,E);break;case"data":if(h!=="object"){cf(c,"data",x);break}case"src":case"href":if(x===""&&(h!=="a"||m!=="href")){c.removeAttribute(m);break}if(x==null||typeof x=="function"||typeof x=="symbol"||typeof x=="boolean"){c.removeAttribute(m);break}x=ff(""+x),c.setAttribute(m,x);break;case"action":case"formAction":if(typeof x=="function"){c.setAttribute(m,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof E=="function"&&(m==="formAction"?(h!=="input"&&dn(c,h,"name",A.name,A,null),dn(c,h,"formEncType",A.formEncType,A,null),dn(c,h,"formMethod",A.formMethod,A,null),dn(c,h,"formTarget",A.formTarget,A,null)):(dn(c,h,"encType",A.encType,A,null),dn(c,h,"method",A.method,A,null),dn(c,h,"target",A.target,A,null)));if(x==null||typeof x=="symbol"||typeof x=="boolean"){c.removeAttribute(m);break}x=ff(""+x),c.setAttribute(m,x);break;case"onClick":x!=null&&(c.onclick=go);break;case"onScroll":x!=null&&Dt("scroll",c);break;case"onScrollEnd":x!=null&&Dt("scrollend",c);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(s(61));if(m=x.__html,m!=null){if(A.children!=null)throw Error(s(60));c.innerHTML=m}}break;case"multiple":c.multiple=x&&typeof x!="function"&&typeof x!="symbol";break;case"muted":c.muted=x&&typeof x!="function"&&typeof x!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(x==null||typeof x=="function"||typeof x=="boolean"||typeof x=="symbol"){c.removeAttribute("xlink:href");break}m=ff(""+x),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":x!=null&&typeof x!="function"&&typeof x!="symbol"?c.setAttribute(m,""+x):c.removeAttribute(m);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":x&&typeof x!="function"&&typeof x!="symbol"?c.setAttribute(m,""):c.removeAttribute(m);break;case"capture":case"download":x===!0?c.setAttribute(m,""):x!==!1&&x!=null&&typeof x!="function"&&typeof x!="symbol"?c.setAttribute(m,x):c.removeAttribute(m);break;case"cols":case"rows":case"size":case"span":x!=null&&typeof x!="function"&&typeof x!="symbol"&&!isNaN(x)&&1<=x?c.setAttribute(m,x):c.removeAttribute(m);break;case"rowSpan":case"start":x==null||typeof x=="function"||typeof x=="symbol"||isNaN(x)?c.removeAttribute(m):c.setAttribute(m,x);break;case"popover":Dt("beforetoggle",c),Dt("toggle",c),lc(c,"popover",x);break;case"xlinkActuate":Pr(c,"http://www.w3.org/1999/xlink","xlink:actuate",x);break;case"xlinkArcrole":Pr(c,"http://www.w3.org/1999/xlink","xlink:arcrole",x);break;case"xlinkRole":Pr(c,"http://www.w3.org/1999/xlink","xlink:role",x);break;case"xlinkShow":Pr(c,"http://www.w3.org/1999/xlink","xlink:show",x);break;case"xlinkTitle":Pr(c,"http://www.w3.org/1999/xlink","xlink:title",x);break;case"xlinkType":Pr(c,"http://www.w3.org/1999/xlink","xlink:type",x);break;case"xmlBase":Pr(c,"http://www.w3.org/XML/1998/namespace","xml:base",x);break;case"xmlLang":Pr(c,"http://www.w3.org/XML/1998/namespace","xml:lang",x);break;case"xmlSpace":Pr(c,"http://www.w3.org/XML/1998/namespace","xml:space",x);break;case"is":lc(c,"is",x);break;case"innerText":case"textContent":break;default:(!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(m=aC.get(m)||m,lc(c,m,x))}}function W1(c,h,m,x,A,E){switch(m){case"style":ey(c,x,E);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(s(61));if(m=x.__html,m!=null){if(A.children!=null)throw Error(s(60));c.innerHTML=m}}break;case"children":typeof x=="string"?hc(c,x):(typeof x=="number"||typeof x=="bigint")&&hc(c,""+x);break;case"onScroll":x!=null&&Dt("scroll",c);break;case"onScrollEnd":x!=null&&Dt("scrollend",c);break;case"onClick":x!=null&&(c.onclick=go);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Jb.hasOwnProperty(m))e:{if(m[0]==="o"&&m[1]==="n"&&(A=m.endsWith("Capture"),h=m.slice(2,A?m.length-7:void 0),E=c[at]||null,E=E!=null?E[m]:null,typeof E=="function"&&c.removeEventListener(h,E,A),typeof x=="function")){typeof E!="function"&&E!==null&&(m in c?c[m]=null:c.hasAttribute(m)&&c.removeAttribute(m)),c.addEventListener(h,x,A);break e}m in c?c[m]=x:x===!0?c.setAttribute(m,""):lc(c,m,x)}}}function Ys(c,h,m){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Dt("error",c),Dt("load",c);var x=!1,A=!1,E;for(E in m)if(m.hasOwnProperty(E)){var I=m[E];if(I!=null)switch(E){case"src":x=!0;break;case"srcSet":A=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,h));default:dn(c,h,E,I,m,null)}}A&&dn(c,h,"srcSet",m.srcSet,m,null),x&&dn(c,h,"src",m.src,m,null);return;case"input":Dt("invalid",c);var B=E=I=A=null,X=null,de=null;for(x in m)if(m.hasOwnProperty(x)){var we=m[x];if(we!=null)switch(x){case"name":A=we;break;case"type":I=we;break;case"checked":X=we;break;case"defaultChecked":de=we;break;case"value":E=we;break;case"defaultValue":B=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(s(137,h));break;default:dn(c,h,x,we,m,null)}}Ym(c,E,B,X,de,I,A,!1);return;case"select":Dt("invalid",c),x=I=E=null;for(A in m)if(m.hasOwnProperty(A)&&(B=m[A],B!=null))switch(A){case"value":E=B;break;case"defaultValue":I=B;break;case"multiple":x=B;default:dn(c,h,A,B,m,null)}h=E,m=I,c.multiple=!!x,h!=null?dc(c,!!x,h,!1):m!=null&&dc(c,!!x,m,!0);return;case"textarea":Dt("invalid",c),E=A=x=null;for(I in m)if(m.hasOwnProperty(I)&&(B=m[I],B!=null))switch(I){case"value":x=B;break;case"defaultValue":A=B;break;case"children":E=B;break;case"dangerouslySetInnerHTML":if(B!=null)throw Error(s(91));break;default:dn(c,h,I,B,m,null)}uf(c,x,A,E);return;case"option":for(X in m)if(m.hasOwnProperty(X)&&(x=m[X],x!=null))switch(X){case"selected":c.selected=x&&typeof x!="function"&&typeof x!="symbol";break;default:dn(c,h,X,x,m,null)}return;case"dialog":Dt("beforetoggle",c),Dt("toggle",c),Dt("cancel",c),Dt("close",c);break;case"iframe":case"object":Dt("load",c);break;case"video":case"audio":for(x=0;x<Mg.length;x++)Dt(Mg[x],c);break;case"image":Dt("error",c),Dt("load",c);break;case"details":Dt("toggle",c);break;case"embed":case"source":case"link":Dt("error",c),Dt("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(de in m)if(m.hasOwnProperty(de)&&(x=m[de],x!=null))switch(de){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,h));default:dn(c,h,de,x,m,null)}return;default:if(Xm(h)){for(we in m)m.hasOwnProperty(we)&&(x=m[we],x!==void 0&&W1(c,h,we,x,m,void 0));return}}for(B in m)m.hasOwnProperty(B)&&(x=m[B],x!=null&&dn(c,h,B,x,m,null))}function EU(c,h,m,x){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var A=null,E=null,I=null,B=null,X=null,de=null,we=null;for(ge in m){var Ee=m[ge];if(m.hasOwnProperty(ge)&&Ee!=null)switch(ge){case"checked":break;case"value":break;case"defaultValue":X=Ee;default:x.hasOwnProperty(ge)||dn(c,h,ge,null,x,Ee)}}for(var fe in x){var ge=x[fe];if(Ee=m[fe],x.hasOwnProperty(fe)&&(ge!=null||Ee!=null))switch(fe){case"type":E=ge;break;case"name":A=ge;break;case"checked":de=ge;break;case"defaultChecked":we=ge;break;case"value":I=ge;break;case"defaultValue":B=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(s(137,h));break;default:ge!==Ee&&dn(c,h,fe,ge,x,Ee)}}Km(c,I,B,X,de,we,E,A);return;case"select":ge=I=B=fe=null;for(E in m)if(X=m[E],m.hasOwnProperty(E)&&X!=null)switch(E){case"value":break;case"multiple":ge=X;default:x.hasOwnProperty(E)||dn(c,h,E,null,x,X)}for(A in x)if(E=x[A],X=m[A],x.hasOwnProperty(A)&&(E!=null||X!=null))switch(A){case"value":fe=E;break;case"defaultValue":B=E;break;case"multiple":I=E;default:E!==X&&dn(c,h,A,E,x,X)}h=B,m=I,x=ge,fe!=null?dc(c,!!m,fe,!1):!!x!=!!m&&(h!=null?dc(c,!!m,h,!0):dc(c,!!m,m?[]:"",!1));return;case"textarea":ge=fe=null;for(B in m)if(A=m[B],m.hasOwnProperty(B)&&A!=null&&!x.hasOwnProperty(B))switch(B){case"value":break;case"children":break;default:dn(c,h,B,null,x,A)}for(I in x)if(A=x[I],E=m[I],x.hasOwnProperty(I)&&(A!=null||E!=null))switch(I){case"value":fe=A;break;case"defaultValue":ge=A;break;case"children":break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(s(91));break;default:A!==E&&dn(c,h,I,A,x,E)}uc(c,fe,ge);return;case"option":for(var et in m)if(fe=m[et],m.hasOwnProperty(et)&&fe!=null&&!x.hasOwnProperty(et))switch(et){case"selected":c.selected=!1;break;default:dn(c,h,et,null,x,fe)}for(X in x)if(fe=x[X],ge=m[X],x.hasOwnProperty(X)&&fe!==ge&&(fe!=null||ge!=null))switch(X){case"selected":c.selected=fe&&typeof fe!="function"&&typeof fe!="symbol";break;default:dn(c,h,X,fe,x,ge)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ft in m)fe=m[ft],m.hasOwnProperty(ft)&&fe!=null&&!x.hasOwnProperty(ft)&&dn(c,h,ft,null,x,fe);for(de in x)if(fe=x[de],ge=m[de],x.hasOwnProperty(de)&&fe!==ge&&(fe!=null||ge!=null))switch(de){case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(s(137,h));break;default:dn(c,h,de,fe,x,ge)}return;default:if(Xm(h)){for(var un in m)fe=m[un],m.hasOwnProperty(un)&&fe!==void 0&&!x.hasOwnProperty(un)&&W1(c,h,un,void 0,x,fe);for(we in x)fe=x[we],ge=m[we],!x.hasOwnProperty(we)||fe===ge||fe===void 0&&ge===void 0||W1(c,h,we,fe,x,ge);return}}for(var oe in m)fe=m[oe],m.hasOwnProperty(oe)&&fe!=null&&!x.hasOwnProperty(oe)&&dn(c,h,oe,null,x,fe);for(Ee in x)fe=x[Ee],ge=m[Ee],!x.hasOwnProperty(Ee)||fe===ge||fe==null&&ge==null||dn(c,h,Ee,fe,x,ge)}function XI(c){switch(c){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function TU(){if(typeof performance.getEntriesByType=="function"){for(var c=0,h=0,m=performance.getEntriesByType("resource"),x=0;x<m.length;x++){var A=m[x],E=A.transferSize,I=A.initiatorType,B=A.duration;if(E&&B&&XI(I)){for(I=0,B=A.responseEnd,x+=1;x<m.length;x++){var X=m[x],de=X.startTime;if(de>B)break;var we=X.transferSize,Ee=X.initiatorType;we&&XI(Ee)&&(X=X.responseEnd,I+=we*(X<B?1:(B-de)/(X-de)))}if(--x,h+=8*(E+I)/(A.duration/1e3),c++,10<c)break}}if(0<c)return h/c/1e6}return navigator.connection&&(c=navigator.connection.downlink,typeof c=="number")?c:5}var K1=null,Y1=null;function Zy(c){return c.nodeType===9?c:c.ownerDocument}function QI(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ZI(c,h){if(c===0)switch(h){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&h==="foreignObject"?0:c}function J1(c,h){return c==="textarea"||c==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.children=="bigint"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var X1=null;function _U(){var c=window.event;return c&&c.type==="popstate"?c===X1?!1:(X1=c,!0):(X1=null,!1)}var ez=typeof setTimeout=="function"?setTimeout:void 0,MU=typeof clearTimeout=="function"?clearTimeout:void 0,tz=typeof Promise=="function"?Promise:void 0,RU=typeof queueMicrotask=="function"?queueMicrotask:typeof tz<"u"?function(c){return tz.resolve(null).then(c).catch(IU)}:ez;function IU(c){setTimeout(function(){throw c})}function Ic(c){return c==="head"}function nz(c,h){var m=h,x=0;do{var A=m.nextSibling;if(c.removeChild(m),A&&A.nodeType===8)if(m=A.data,m==="/$"||m==="/&"){if(x===0){c.removeChild(A),qf(h);return}x--}else if(m==="$"||m==="$?"||m==="$~"||m==="$!"||m==="&")x++;else if(m==="html")Ig(c.ownerDocument.documentElement);else if(m==="head"){m=c.ownerDocument.head,Ig(m);for(var E=m.firstChild;E;){var I=E.nextSibling,B=E.nodeName;E[Kd]||B==="SCRIPT"||B==="STYLE"||B==="LINK"&&E.rel.toLowerCase()==="stylesheet"||m.removeChild(E),E=I}}else m==="body"&&Ig(c.ownerDocument.body);m=A}while(m);qf(h)}function sz(c,h){var m=c;c=0;do{var x=m.nextSibling;if(m.nodeType===1?h?(m._stashedDisplay=m.style.display,m.style.display="none"):(m.style.display=m._stashedDisplay||"",m.getAttribute("style")===""&&m.removeAttribute("style")):m.nodeType===3&&(h?(m._stashedText=m.nodeValue,m.nodeValue=""):m.nodeValue=m._stashedText||""),x&&x.nodeType===8)if(m=x.data,m==="/$"){if(c===0)break;c--}else m!=="$"&&m!=="$?"&&m!=="$~"&&m!=="$!"||c++;m=x}while(m)}function Q1(c){var h=c.firstChild;for(h&&h.nodeType===10&&(h=h.nextSibling);h;){var m=h;switch(h=h.nextSibling,m.nodeName){case"HTML":case"HEAD":case"BODY":Q1(m),rc(m);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(m.rel.toLowerCase()==="stylesheet")continue}c.removeChild(m)}}function zU(c,h,m,x){for(;c.nodeType===1;){var A=m;if(c.nodeName.toLowerCase()!==h.toLowerCase()){if(!x&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(x){if(!c[Kd])switch(h){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if(E=c.getAttribute("rel"),E==="stylesheet"&&c.hasAttribute("data-precedence"))break;if(E!==A.rel||c.getAttribute("href")!==(A.href==null||A.href===""?null:A.href)||c.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin)||c.getAttribute("title")!==(A.title==null?null:A.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if(E=c.getAttribute("src"),(E!==(A.src==null?null:A.src)||c.getAttribute("type")!==(A.type==null?null:A.type)||c.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin))&&E&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(h==="input"&&c.type==="hidden"){var E=A.name==null?null:""+A.name;if(A.type==="hidden"&&c.getAttribute("name")===E)return c}else return c;if(c=$r(c.nextSibling),c===null)break}return null}function DU(c,h,m){if(h==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!m||(c=$r(c.nextSibling),c===null))return null;return c}function iz(c,h){for(;c.nodeType!==8;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!h||(c=$r(c.nextSibling),c===null))return null;return c}function Z1(c){return c.data==="$?"||c.data==="$~"}function eA(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState!=="loading"}function jU(c,h){var m=c.ownerDocument;if(c.data==="$~")c._reactRetry=h;else if(c.data!=="$?"||m.readyState!=="loading")h();else{var x=function(){h(),m.removeEventListener("DOMContentLoaded",x)};m.addEventListener("DOMContentLoaded",x),c._reactRetry=x}}function $r(c){for(;c!=null;c=c.nextSibling){var h=c.nodeType;if(h===1||h===3)break;if(h===8){if(h=c.data,h==="$"||h==="$!"||h==="$?"||h==="$~"||h==="&"||h==="F!"||h==="F")break;if(h==="/$"||h==="/&")return null}}return c}var tA=null;function rz(c){c=c.nextSibling;for(var h=0;c;){if(c.nodeType===8){var m=c.data;if(m==="/$"||m==="/&"){if(h===0)return $r(c.nextSibling);h--}else m!=="$"&&m!=="$!"&&m!=="$?"&&m!=="$~"&&m!=="&"||h++}c=c.nextSibling}return null}function oz(c){c=c.previousSibling;for(var h=0;c;){if(c.nodeType===8){var m=c.data;if(m==="$"||m==="$!"||m==="$?"||m==="$~"||m==="&"){if(h===0)return c;h--}else m!=="/$"&&m!=="/&"||h++}c=c.previousSibling}return null}function az(c,h,m){switch(h=Zy(m),c){case"html":if(c=h.documentElement,!c)throw Error(s(452));return c;case"head":if(c=h.head,!c)throw Error(s(453));return c;case"body":if(c=h.body,!c)throw Error(s(454));return c;default:throw Error(s(451))}}function Ig(c){for(var h=c.attributes;h.length;)c.removeAttributeNode(h[0]);rc(c)}var Gr=new Map,lz=new Set;function ev(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var il=Y.d;Y.d={f:PU,r:LU,D:OU,C:BU,L:FU,m:HU,X:$U,S:UU,M:GU};function PU(){var c=il.f(),h=Vy();return c||h}function LU(c){var h=Ha(c);h!==null&&h.tag===5&&h.type==="form"?AR(h):il.r(c)}var $f=typeof document>"u"?null:document;function cz(c,h,m){var x=$f;if(x&&typeof h=="string"&&h){var A=Ci(h);A='link[rel="'+c+'"][href="'+A+'"]',typeof m=="string"&&(A+='[crossorigin="'+m+'"]'),lz.has(A)||(lz.add(A),c={rel:c,crossOrigin:m,href:h},x.querySelector(A)===null&&(h=x.createElement("link"),Ys(h,"link",c),cs(h),x.head.appendChild(h)))}}function OU(c){il.D(c),cz("dns-prefetch",c,null)}function BU(c,h){il.C(c,h),cz("preconnect",c,h)}function FU(c,h,m){il.L(c,h,m);var x=$f;if(x&&c&&h){var A='link[rel="preload"][as="'+Ci(h)+'"]';h==="image"&&m&&m.imageSrcSet?(A+='[imagesrcset="'+Ci(m.imageSrcSet)+'"]',typeof m.imageSizes=="string"&&(A+='[imagesizes="'+Ci(m.imageSizes)+'"]')):A+='[href="'+Ci(c)+'"]';var E=A;switch(h){case"style":E=Gf(c);break;case"script":E=Vf(c)}Gr.has(E)||(c=p({rel:"preload",href:h==="image"&&m&&m.imageSrcSet?void 0:c,as:h},m),Gr.set(E,c),x.querySelector(A)!==null||h==="style"&&x.querySelector(zg(E))||h==="script"&&x.querySelector(Dg(E))||(h=x.createElement("link"),Ys(h,"link",c),cs(h),x.head.appendChild(h)))}}function HU(c,h){il.m(c,h);var m=$f;if(m&&c){var x=h&&typeof h.as=="string"?h.as:"script",A='link[rel="modulepreload"][as="'+Ci(x)+'"][href="'+Ci(c)+'"]',E=A;switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":E=Vf(c)}if(!Gr.has(E)&&(c=p({rel:"modulepreload",href:c},h),Gr.set(E,c),m.querySelector(A)===null)){switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(m.querySelector(Dg(E)))return}x=m.createElement("link"),Ys(x,"link",c),cs(x),m.head.appendChild(x)}}}function UU(c,h,m){il.S(c,h,m);var x=$f;if(x&&c){var A=Yo(x).hoistableStyles,E=Gf(c);h=h||"default";var I=A.get(E);if(!I){var B={loading:0,preload:null};if(I=x.querySelector(zg(E)))B.loading=5;else{c=p({rel:"stylesheet",href:c,"data-precedence":h},m),(m=Gr.get(E))&&nA(c,m);var X=I=x.createElement("link");cs(X),Ys(X,"link",c),X._p=new Promise(function(de,we){X.onload=de,X.onerror=we}),X.addEventListener("load",function(){B.loading|=1}),X.addEventListener("error",function(){B.loading|=2}),B.loading|=4,tv(I,h,x)}I={type:"stylesheet",instance:I,count:1,state:B},A.set(E,I)}}}function $U(c,h){il.X(c,h);var m=$f;if(m&&c){var x=Yo(m).hoistableScripts,A=Vf(c),E=x.get(A);E||(E=m.querySelector(Dg(A)),E||(c=p({src:c,async:!0},h),(h=Gr.get(A))&&sA(c,h),E=m.createElement("script"),cs(E),Ys(E,"link",c),m.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},x.set(A,E))}}function GU(c,h){il.M(c,h);var m=$f;if(m&&c){var x=Yo(m).hoistableScripts,A=Vf(c),E=x.get(A);E||(E=m.querySelector(Dg(A)),E||(c=p({src:c,async:!0,type:"module"},h),(h=Gr.get(A))&&sA(c,h),E=m.createElement("script"),cs(E),Ys(E,"link",c),m.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},x.set(A,E))}}function dz(c,h,m,x){var A=(A=ke.current)?ev(A):null;if(!A)throw Error(s(446));switch(c){case"meta":case"title":return null;case"style":return typeof m.precedence=="string"&&typeof m.href=="string"?(h=Gf(m.href),m=Yo(A).hoistableStyles,x=m.get(h),x||(x={type:"style",instance:null,count:0,state:null},m.set(h,x)),x):{type:"void",instance:null,count:0,state:null};case"link":if(m.rel==="stylesheet"&&typeof m.href=="string"&&typeof m.precedence=="string"){c=Gf(m.href);var E=Yo(A).hoistableStyles,I=E.get(c);if(I||(A=A.ownerDocument||A,I={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},E.set(c,I),(E=A.querySelector(zg(c)))&&!E._p&&(I.instance=E,I.state.loading=5),Gr.has(c)||(m={rel:"preload",as:"style",href:m.href,crossOrigin:m.crossOrigin,integrity:m.integrity,media:m.media,hrefLang:m.hrefLang,referrerPolicy:m.referrerPolicy},Gr.set(c,m),E||VU(A,c,m,I.state))),h&&x===null)throw Error(s(528,""));return I}if(h&&x!==null)throw Error(s(529,""));return null;case"script":return h=m.async,m=m.src,typeof m=="string"&&h&&typeof h!="function"&&typeof h!="symbol"?(h=Vf(m),m=Yo(A).hoistableScripts,x=m.get(h),x||(x={type:"script",instance:null,count:0,state:null},m.set(h,x)),x):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,c))}}function Gf(c){return'href="'+Ci(c)+'"'}function zg(c){return'link[rel="stylesheet"]['+c+"]"}function uz(c){return p({},c,{"data-precedence":c.precedence,precedence:null})}function VU(c,h,m,x){c.querySelector('link[rel="preload"][as="style"]['+h+"]")?x.loading=1:(h=c.createElement("link"),x.preload=h,h.addEventListener("load",function(){return x.loading|=1}),h.addEventListener("error",function(){return x.loading|=2}),Ys(h,"link",m),cs(h),c.head.appendChild(h))}function Vf(c){return'[src="'+Ci(c)+'"]'}function Dg(c){return"script[async]"+c}function hz(c,h,m){if(h.count++,h.instance===null)switch(h.type){case"style":var x=c.querySelector('style[data-href~="'+Ci(m.href)+'"]');if(x)return h.instance=x,cs(x),x;var A=p({},m,{"data-href":m.href,"data-precedence":m.precedence,href:null,precedence:null});return x=(c.ownerDocument||c).createElement("style"),cs(x),Ys(x,"style",A),tv(x,m.precedence,c),h.instance=x;case"stylesheet":A=Gf(m.href);var E=c.querySelector(zg(A));if(E)return h.state.loading|=4,h.instance=E,cs(E),E;x=uz(m),(A=Gr.get(A))&&nA(x,A),E=(c.ownerDocument||c).createElement("link"),cs(E);var I=E;return I._p=new Promise(function(B,X){I.onload=B,I.onerror=X}),Ys(E,"link",x),h.state.loading|=4,tv(E,m.precedence,c),h.instance=E;case"script":return E=Vf(m.src),(A=c.querySelector(Dg(E)))?(h.instance=A,cs(A),A):(x=m,(A=Gr.get(E))&&(x=p({},m),sA(x,A)),c=c.ownerDocument||c,A=c.createElement("script"),cs(A),Ys(A,"link",x),c.head.appendChild(A),h.instance=A);case"void":return null;default:throw Error(s(443,h.type))}else h.type==="stylesheet"&&(h.state.loading&4)===0&&(x=h.instance,h.state.loading|=4,tv(x,m.precedence,c));return h.instance}function tv(c,h,m){for(var x=m.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),A=x.length?x[x.length-1]:null,E=A,I=0;I<x.length;I++){var B=x[I];if(B.dataset.precedence===h)E=B;else if(E!==A)break}E?E.parentNode.insertBefore(c,E.nextSibling):(h=m.nodeType===9?m.head:m,h.insertBefore(c,h.firstChild))}function nA(c,h){c.crossOrigin==null&&(c.crossOrigin=h.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=h.referrerPolicy),c.title==null&&(c.title=h.title)}function sA(c,h){c.crossOrigin==null&&(c.crossOrigin=h.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=h.referrerPolicy),c.integrity==null&&(c.integrity=h.integrity)}var nv=null;function fz(c,h,m){if(nv===null){var x=new Map,A=nv=new Map;A.set(m,x)}else A=nv,x=A.get(m),x||(x=new Map,A.set(m,x));if(x.has(c))return x;for(x.set(c,null),m=m.getElementsByTagName(c),A=0;A<m.length;A++){var E=m[A];if(!(E[Kd]||E[Un]||c==="link"&&E.getAttribute("rel")==="stylesheet")&&E.namespaceURI!=="http://www.w3.org/2000/svg"){var I=E.getAttribute(h)||"";I=c+I;var B=x.get(I);B?B.push(E):x.set(I,[E])}}return x}function pz(c,h,m){c=c.ownerDocument||c,c.head.insertBefore(m,h==="title"?c.querySelector("head > title"):null)}function qU(c,h,m){if(m===1||h.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof h.precedence!="string"||typeof h.href!="string"||h.href==="")break;return!0;case"link":if(typeof h.rel!="string"||typeof h.href!="string"||h.href===""||h.onLoad||h.onError)break;switch(h.rel){case"stylesheet":return c=h.disabled,typeof h.precedence=="string"&&c==null;default:return!0}case"script":if(h.async&&typeof h.async!="function"&&typeof h.async!="symbol"&&!h.onLoad&&!h.onError&&h.src&&typeof h.src=="string")return!0}return!1}function mz(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}function WU(c,h,m,x){if(m.type==="stylesheet"&&(typeof x.media!="string"||matchMedia(x.media).matches!==!1)&&(m.state.loading&4)===0){if(m.instance===null){var A=Gf(x.href),E=h.querySelector(zg(A));if(E){h=E._p,h!==null&&typeof h=="object"&&typeof h.then=="function"&&(c.count++,c=sv.bind(c),h.then(c,c)),m.state.loading|=4,m.instance=E,cs(E);return}E=h.ownerDocument||h,x=uz(x),(A=Gr.get(A))&&nA(x,A),E=E.createElement("link"),cs(E);var I=E;I._p=new Promise(function(B,X){I.onload=B,I.onerror=X}),Ys(E,"link",x),m.instance=E}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(m,h),(h=m.state.preload)&&(m.state.loading&3)===0&&(c.count++,m=sv.bind(c),h.addEventListener("load",m),h.addEventListener("error",m))}}var iA=0;function KU(c,h){return c.stylesheets&&c.count===0&&rv(c,c.stylesheets),0<c.count||0<c.imgCount?function(m){var x=setTimeout(function(){if(c.stylesheets&&rv(c,c.stylesheets),c.unsuspend){var E=c.unsuspend;c.unsuspend=null,E()}},6e4+h);0<c.imgBytes&&iA===0&&(iA=62500*TU());var A=setTimeout(function(){if(c.waitingForImages=!1,c.count===0&&(c.stylesheets&&rv(c,c.stylesheets),c.unsuspend)){var E=c.unsuspend;c.unsuspend=null,E()}},(c.imgBytes>iA?50:800)+h);return c.unsuspend=m,function(){c.unsuspend=null,clearTimeout(x),clearTimeout(A)}}:null}function sv(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)rv(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var iv=null;function rv(c,h){c.stylesheets=null,c.unsuspend!==null&&(c.count++,iv=new Map,h.forEach(YU,c),iv=null,sv.call(c))}function YU(c,h){if(!(h.state.loading&4)){var m=iv.get(c);if(m)var x=m.get(null);else{m=new Map,iv.set(c,m);for(var A=c.querySelectorAll("link[data-precedence],style[data-precedence]"),E=0;E<A.length;E++){var I=A[E];(I.nodeName==="LINK"||I.getAttribute("media")!=="not all")&&(m.set(I.dataset.precedence,I),x=I)}x&&m.set(null,x)}A=h.instance,I=A.getAttribute("data-precedence"),E=m.get(I)||x,E===x&&m.set(null,A),m.set(I,A),this.count++,x=sv.bind(this),A.addEventListener("load",x),A.addEventListener("error",x),E?E.parentNode.insertBefore(A,E.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(A,c.firstChild)),h.state.loading|=4}}var jg={$$typeof:R,Provider:null,Consumer:null,_currentValue:he,_currentValue2:he,_threadCount:0};function JU(c,h,m,x,A,E,I,B,X){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Bi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bi(0),this.hiddenUpdates=Bi(null),this.identifierPrefix=x,this.onUncaughtError=A,this.onCaughtError=E,this.onRecoverableError=I,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=X,this.incompleteTransitions=new Map}function gz(c,h,m,x,A,E,I,B,X,de,we,Ee){return c=new JU(c,h,m,I,X,de,we,Ee,B),h=1,E===!0&&(h|=24),E=ar(3,null,null,h),c.current=E,E.stateNode=c,h=LC(),h.refCount++,c.pooledCache=h,h.refCount++,E.memoizedState={element:x,isDehydrated:m,cache:h},HC(E),c}function xz(c){return c?(c=kf,c):kf}function bz(c,h,m,x,A,E){A=xz(A),x.context===null?x.context=A:x.pendingContext=A,x=wc(h),x.payload={element:m},E=E===void 0?null:E,E!==null&&(x.callback=E),m=kc(c,x,h),m!==null&&(Gi(m,c,h),fg(m,c,h))}function yz(c,h){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var m=c.retryLane;c.retryLane=m!==0&&m<h?m:h}}function rA(c,h){yz(c,h),(c=c.alternate)&&yz(c,h)}function vz(c){if(c.tag===13||c.tag===31){var h=nu(c,67108864);h!==null&&Gi(h,c,67108864),rA(c,67108864)}}function wz(c){if(c.tag===13||c.tag===31){var h=hr();h=Wo(h);var m=nu(c,h);m!==null&&Gi(m,c,h),rA(c,h)}}var ov=!0;function XU(c,h,m,x){var A=$.T;$.T=null;var E=Y.p;try{Y.p=2,oA(c,h,m,x)}finally{Y.p=E,$.T=A}}function QU(c,h,m,x){var A=$.T;$.T=null;var E=Y.p;try{Y.p=8,oA(c,h,m,x)}finally{Y.p=E,$.T=A}}function oA(c,h,m,x){if(ov){var A=aA(x);if(A===null)q1(c,h,x,av,m),Sz(c,x);else if(e$(A,c,h,m,x))x.stopPropagation();else if(Sz(c,x),h&4&&-1<ZU.indexOf(c)){for(;A!==null;){var E=Ha(A);if(E!==null)switch(E.tag){case 3:if(E=E.stateNode,E.current.memoizedState.isDehydrated){var I=Ht(E.pendingLanes);if(I!==0){var B=E;for(B.pendingLanes|=2,B.entangledLanes|=2;I;){var X=1<<31-Ke(I);B.entanglements[1]|=X,I&=~X}ta(E),(en&6)===0&&($y=Qt()+500,_g(0))}}break;case 31:case 13:B=nu(E,2),B!==null&&Gi(B,E,2),Vy(),rA(E,2)}if(E=aA(x),E===null&&q1(c,h,x,av,m),E===A)break;A=E}A!==null&&x.stopPropagation()}else q1(c,h,x,null,m)}}function aA(c){return c=Zm(c),lA(c)}var av=null;function lA(c){if(av=null,c=oc(c),c!==null){var h=r(c);if(h===null)c=null;else{var m=h.tag;if(m===13){if(c=o(h),c!==null)return c;c=null}else if(m===31){if(c=a(h),c!==null)return c;c=null}else if(m===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;c=null}else h!==c&&(c=null)}}return av=c,null}function kz(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(_s()){case Se:return 2;case Me:return 8;case He:case Pt:return 32;case Sn:return 268435456;default:return 32}default:return 32}}var cA=!1,zc=null,Dc=null,jc=null,Pg=new Map,Lg=new Map,Pc=[],ZU="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Sz(c,h){switch(c){case"focusin":case"focusout":zc=null;break;case"dragenter":case"dragleave":Dc=null;break;case"mouseover":case"mouseout":jc=null;break;case"pointerover":case"pointerout":Pg.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lg.delete(h.pointerId)}}function Og(c,h,m,x,A,E){return c===null||c.nativeEvent!==E?(c={blockedOn:h,domEventName:m,eventSystemFlags:x,nativeEvent:E,targetContainers:[A]},h!==null&&(h=Ha(h),h!==null&&vz(h)),c):(c.eventSystemFlags|=x,h=c.targetContainers,A!==null&&h.indexOf(A)===-1&&h.push(A),c)}function e$(c,h,m,x,A){switch(h){case"focusin":return zc=Og(zc,c,h,m,x,A),!0;case"dragenter":return Dc=Og(Dc,c,h,m,x,A),!0;case"mouseover":return jc=Og(jc,c,h,m,x,A),!0;case"pointerover":var E=A.pointerId;return Pg.set(E,Og(Pg.get(E)||null,c,h,m,x,A)),!0;case"gotpointercapture":return E=A.pointerId,Lg.set(E,Og(Lg.get(E)||null,c,h,m,x,A)),!0}return!1}function Cz(c){var h=oc(c.target);if(h!==null){var m=r(h);if(m!==null){if(h=m.tag,h===13){if(h=o(m),h!==null){c.blockedOn=h,ic(c.priority,function(){wz(m)});return}}else if(h===31){if(h=a(m),h!==null){c.blockedOn=h,ic(c.priority,function(){wz(m)});return}}else if(h===3&&m.stateNode.current.memoizedState.isDehydrated){c.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}c.blockedOn=null}function lv(c){if(c.blockedOn!==null)return!1;for(var h=c.targetContainers;0<h.length;){var m=aA(c.nativeEvent);if(m===null){m=c.nativeEvent;var x=new m.constructor(m.type,m);Qm=x,m.target.dispatchEvent(x),Qm=null}else return h=Ha(m),h!==null&&vz(h),c.blockedOn=m,!1;h.shift()}return!0}function Az(c,h,m){lv(c)&&m.delete(h)}function t$(){cA=!1,zc!==null&&lv(zc)&&(zc=null),Dc!==null&&lv(Dc)&&(Dc=null),jc!==null&&lv(jc)&&(jc=null),Pg.forEach(Az),Lg.forEach(Az)}function cv(c,h){c.blockedOn===h&&(c.blockedOn=null,cA||(cA=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,t$)))}var dv=null;function Nz(c){dv!==c&&(dv=c,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){dv===c&&(dv=null);for(var h=0;h<c.length;h+=3){var m=c[h],x=c[h+1],A=c[h+2];if(typeof x!="function"){if(lA(x||m)===null)continue;break}var E=Ha(m);E!==null&&(c.splice(h,3),h-=3,a1(E,{pending:!0,data:A,method:m.method,action:x},x,A))}}))}function qf(c){function h(X){return cv(X,c)}zc!==null&&cv(zc,c),Dc!==null&&cv(Dc,c),jc!==null&&cv(jc,c),Pg.forEach(h),Lg.forEach(h);for(var m=0;m<Pc.length;m++){var x=Pc[m];x.blockedOn===c&&(x.blockedOn=null)}for(;0<Pc.length&&(m=Pc[0],m.blockedOn===null);)Cz(m),m.blockedOn===null&&Pc.shift();if(m=(c.ownerDocument||c).$$reactFormReplay,m!=null)for(x=0;x<m.length;x+=3){var A=m[x],E=m[x+1],I=A[at]||null;if(typeof E=="function")I||Nz(m);else if(I){var B=null;if(E&&E.hasAttribute("formAction")){if(A=E,I=E[at]||null)B=I.formAction;else if(lA(A)!==null)continue}else B=I.action;typeof B=="function"?m[x+1]=B:(m.splice(x,3),x-=3),Nz(m)}}}function Ez(){function c(E){E.canIntercept&&E.info==="react-transition"&&E.intercept({handler:function(){return new Promise(function(I){return A=I})},focusReset:"manual",scroll:"manual"})}function h(){A!==null&&(A(),A=null),x||setTimeout(m,20)}function m(){if(!x&&!navigation.transition){var E=navigation.currentEntry;E&&E.url!=null&&navigation.navigate(E.url,{state:E.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var x=!1,A=null;return navigation.addEventListener("navigate",c),navigation.addEventListener("navigatesuccess",h),navigation.addEventListener("navigateerror",h),setTimeout(m,100),function(){x=!0,navigation.removeEventListener("navigate",c),navigation.removeEventListener("navigatesuccess",h),navigation.removeEventListener("navigateerror",h),A!==null&&(A(),A=null)}}}function dA(c){this._internalRoot=c}uv.prototype.render=dA.prototype.render=function(c){var h=this._internalRoot;if(h===null)throw Error(s(409));var m=h.current,x=hr();bz(m,x,c,h,null,null)},uv.prototype.unmount=dA.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var h=c.containerInfo;bz(c.current,2,null,c,null,null),Vy(),h[vn]=null}};function uv(c){this._internalRoot=c}uv.prototype.unstable_scheduleHydration=function(c){if(c){var h=af();c={blockedOn:null,target:c,priority:h};for(var m=0;m<Pc.length&&h!==0&&h<Pc[m].priority;m++);Pc.splice(m,0,c),m===0&&Cz(c)}};var Tz=e.version;if(Tz!=="19.2.3")throw Error(s(527,Tz,"19.2.3"));Y.findDOMNode=function(c){var h=c._reactInternals;if(h===void 0)throw typeof c.render=="function"?Error(s(188)):(c=Object.keys(c).join(","),Error(s(268,c)));return c=u(h),c=c!==null?f(c):null,c=c===null?null:c.stateNode,c};var n$={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:$,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hv.isDisabled&&hv.supportsFiber)try{De=hv.inject(n$),se=hv}catch{}}return Fg.createRoot=function(c,h){if(!i(c))throw Error(s(299));var m=!1,x="",A=jR,E=PR,I=LR;return h!=null&&(h.unstable_strictMode===!0&&(m=!0),h.identifierPrefix!==void 0&&(x=h.identifierPrefix),h.onUncaughtError!==void 0&&(A=h.onUncaughtError),h.onCaughtError!==void 0&&(E=h.onCaughtError),h.onRecoverableError!==void 0&&(I=h.onRecoverableError)),h=gz(c,1,!1,null,null,m,x,null,A,E,I,Ez),c[vn]=h.current,V1(c),new dA(h)},Fg.hydrateRoot=function(c,h,m){if(!i(c))throw Error(s(299));var x=!1,A="",E=jR,I=PR,B=LR,X=null;return m!=null&&(m.unstable_strictMode===!0&&(x=!0),m.identifierPrefix!==void 0&&(A=m.identifierPrefix),m.onUncaughtError!==void 0&&(E=m.onUncaughtError),m.onCaughtError!==void 0&&(I=m.onCaughtError),m.onRecoverableError!==void 0&&(B=m.onRecoverableError),m.formState!==void 0&&(X=m.formState)),h=gz(c,1,!0,h,m??null,x,A,X,E,I,B,Ez),h.context=xz(null),m=h.current,x=hr(),x=Wo(x),A=wc(x),A.callback=null,kc(m,A,x),m=x,h.current.lanes=m,ys(h,m),ta(h),c[vn]=h.current,V1(c),new uv(h)},Fg.version="19.2.3",Fg}var Bz;function m$(){if(Bz)return pA.exports;Bz=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),pA.exports=p$(),pA.exports}var g$=m$();const x$=JT(g$);var b$=SO();const y$=JT(b$);/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function B0(){return B0=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},B0.apply(this,arguments)}var Nd;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Nd||(Nd={}));const Fz="popstate";function v$(n){n===void 0&&(n={});function e(i,r){let{pathname:o="/",search:a="",hash:l=""}=ef(i.location.hash.substr(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),yN("",{pathname:o,search:a,hash:l},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(i,r){let o=i.document.querySelector("base"),a="";if(o&&o.getAttribute("href")){let l=i.location.href,u=l.indexOf("#");a=u===-1?l:l.slice(0,u)}return a+"#"+(typeof r=="string"?r:jw(r))}function s(i,r){xS(i.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(r)+")")}return k$(e,t,s,n)}function ss(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function xS(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function w$(){return Math.random().toString(36).substr(2,8)}function Hz(n,e){return{usr:n.state,key:n.key,idx:e}}function yN(n,e,t,s){return t===void 0&&(t=null),B0({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?ef(e):e,{state:t,key:e&&e.key||s||w$()})}function jw(n){let{pathname:e="/",search:t="",hash:s=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function ef(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let s=n.indexOf("?");s>=0&&(e.search=n.substr(s),n=n.substr(0,s)),n&&(e.pathname=n)}return e}function k$(n,e,t,s){s===void 0&&(s={});let{window:i=document.defaultView,v5Compat:r=!1}=s,o=i.history,a=Nd.Pop,l=null,u=f();u==null&&(u=0,o.replaceState(B0({},o.state,{idx:u}),""));function f(){return(o.state||{idx:null}).idx}function p(){a=Nd.Pop;let N=f(),C=N==null?null:N-u;u=N,l&&l({action:a,location:S.location,delta:C})}function g(N,C){a=Nd.Push;let M=yN(S.location,N,C);t&&t(M,N),u=f()+1;let R=Hz(M,u),_=S.createHref(M);try{o.pushState(R,"",_)}catch(j){if(j instanceof DOMException&&j.name==="DataCloneError")throw j;i.location.assign(_)}r&&l&&l({action:a,location:S.location,delta:1})}function b(N,C){a=Nd.Replace;let M=yN(S.location,N,C);t&&t(M,N),u=f();let R=Hz(M,u),_=S.createHref(M);o.replaceState(R,"",_),r&&l&&l({action:a,location:S.location,delta:0})}function w(N){let C=i.location.origin!=="null"?i.location.origin:i.location.href,M=typeof N=="string"?N:jw(N);return M=M.replace(/ $/,"%20"),ss(C,"No window.location.(origin|href) available to create URL for href: "+M),new URL(M,C)}let S={get action(){return a},get location(){return n(i,o)},listen(N){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(Fz,p),l=N,()=>{i.removeEventListener(Fz,p),l=null}},createHref(N){return e(i,N)},createURL:w,encodeLocation(N){let C=w(N);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:g,replace:b,go(N){return o.go(N)}};return S}var Uz;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Uz||(Uz={}));function S$(n,e,t){return t===void 0&&(t="/"),C$(n,e,t)}function C$(n,e,t,s){let i=typeof e=="string"?ef(e):e,r=QT(i.pathname||"/",t);if(r==null)return null;let o=CO(n);A$(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=L$(r);a=D$(o[l],u)}return a}function CO(n,e,t,s){e===void 0&&(e=[]),t===void 0&&(t=[]),s===void 0&&(s="");let i=(r,o,a)=>{let l={relativePath:a===void 0?r.path||"":a,caseSensitive:r.caseSensitive===!0,childrenIndex:o,route:r};l.relativePath.startsWith("/")&&(ss(l.relativePath.startsWith(s),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(s.length));let u=Md([s,l.relativePath]),f=t.concat(l);r.children&&r.children.length>0&&(ss(r.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),CO(r.children,e,f,u)),!(r.path==null&&!r.index)&&e.push({path:u,score:I$(u,r.index),routesMeta:f})};return n.forEach((r,o)=>{var a;if(r.path===""||!((a=r.path)!=null&&a.includes("?")))i(r,o);else for(let l of AO(r.path))i(r,o,l)}),e}function AO(n){let e=n.split("/");if(e.length===0)return[];let[t,...s]=e,i=t.endsWith("?"),r=t.replace(/\?$/,"");if(s.length===0)return i?[r,""]:[r];let o=AO(s.join("/")),a=[];return a.push(...o.map(l=>l===""?r:[r,l].join("/"))),i&&a.push(...o),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function A$(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:z$(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}const N$=/^:[\w-]+$/,E$=3,T$=2,_$=1,M$=10,R$=-2,$z=n=>n==="*";function I$(n,e){let t=n.split("/"),s=t.length;return t.some($z)&&(s+=R$),e&&(s+=T$),t.filter(i=>!$z(i)).reduce((i,r)=>i+(N$.test(r)?E$:r===""?_$:M$),s)}function z$(n,e){return n.length===e.length&&n.slice(0,-1).every((s,i)=>s===e[i])?n[n.length-1]-e[e.length-1]:0}function D$(n,e,t){let{routesMeta:s}=n,i={},r="/",o=[];for(let a=0;a<s.length;++a){let l=s[a],u=a===s.length-1,f=r==="/"?e:e.slice(r.length)||"/",p=j$({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},f),g=l.route;if(!p)return null;Object.assign(i,p.params),o.push({params:i,pathname:Md([r,p.pathname]),pathnameBase:U$(Md([r,p.pathnameBase])),route:g}),p.pathnameBase!=="/"&&(r=Md([r,p.pathnameBase]))}return o}function j$(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,s]=P$(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let r=i[0],o=r.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:s.reduce((u,f,p)=>{let{paramName:g,isOptional:b}=f;if(g==="*"){let S=a[p]||"";o=r.slice(0,r.length-S.length).replace(/(.)\/+$/,"$1")}const w=a[p];return b&&!w?u[g]=void 0:u[g]=(w||"").replace(/%2F/g,"/"),u},{}),pathname:r,pathnameBase:o,pattern:n}}function P$(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),xS(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let s=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(s.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(s.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),s]}function L$(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return xS(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function QT(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=n.charAt(t);return s&&s!=="/"?null:n.slice(t)||"/"}const O$=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,B$=n=>O$.test(n);function F$(n,e){e===void 0&&(e="/");let{pathname:t,search:s="",hash:i=""}=typeof n=="string"?ef(n):n,r;if(t)if(B$(t))r=t;else{if(t.includes("//")){let o=t;t=t.replace(/\/\/+/g,"/"),xS(!1,"Pathnames cannot have embedded double slashes - normalizing "+(o+" -> "+t))}t.startsWith("/")?r=Gz(t.substring(1),"/"):r=Gz(t,e)}else r=e;return{pathname:r,search:$$(s),hash:G$(i)}}function Gz(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function bA(n,e,t,s){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function H$(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function ZT(n,e){let t=H$(n);return e?t.map((s,i)=>i===t.length-1?s.pathname:s.pathnameBase):t.map(s=>s.pathnameBase)}function e_(n,e,t,s){s===void 0&&(s=!1);let i;typeof n=="string"?i=ef(n):(i=B0({},n),ss(!i.pathname||!i.pathname.includes("?"),bA("?","pathname","search",i)),ss(!i.pathname||!i.pathname.includes("#"),bA("#","pathname","hash",i)),ss(!i.search||!i.search.includes("#"),bA("#","search","hash",i)));let r=n===""||i.pathname==="",o=r?"/":i.pathname,a;if(o==null)a=t;else{let p=e.length-1;if(!s&&o.startsWith("..")){let g=o.split("/");for(;g[0]==="..";)g.shift(),p-=1;i.pathname=g.join("/")}a=p>=0?e[p]:"/"}let l=F$(i,a),u=o&&o!=="/"&&o.endsWith("/"),f=(r||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||f)&&(l.pathname+="/"),l}const Md=n=>n.join("/").replace(/\/\/+/g,"/"),U$=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),$$=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,G$=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function V$(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const NO=["post","put","patch","delete"];new Set(NO);const q$=["get",...NO];new Set(q$);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function F0(){return F0=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},F0.apply(this,arguments)}const t_=T.createContext(null),W$=T.createContext(null),Hd=T.createContext(null),bS=T.createContext(null),tc=T.createContext({outlet:null,matches:[],isDataRoute:!1}),EO=T.createContext(null);function K$(n,e){let{relative:t}=e===void 0?{}:e;Om()||ss(!1);let{basename:s,navigator:i}=T.useContext(Hd),{hash:r,pathname:o,search:a}=MO(n,{relative:t}),l=o;return s!=="/"&&(l=o==="/"?s:Md([s,o])),i.createHref({pathname:l,search:a,hash:r})}function Om(){return T.useContext(bS)!=null}function Oa(){return Om()||ss(!1),T.useContext(bS).location}function TO(n){T.useContext(Hd).static||T.useLayoutEffect(n)}function Es(){let{isDataRoute:n}=T.useContext(tc);return n?a8():Y$()}function Y$(){Om()||ss(!1);let n=T.useContext(t_),{basename:e,future:t,navigator:s}=T.useContext(Hd),{matches:i}=T.useContext(tc),{pathname:r}=Oa(),o=JSON.stringify(ZT(i,t.v7_relativeSplatPath)),a=T.useRef(!1);return TO(()=>{a.current=!0}),T.useCallback(function(u,f){if(f===void 0&&(f={}),!a.current)return;if(typeof u=="number"){s.go(u);return}let p=e_(u,JSON.parse(o),r,f.relative==="path");n==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:Md([e,p.pathname])),(f.replace?s.replace:s.push)(p,f.state,f)},[e,s,o,r,n])}function _O(){let{matches:n}=T.useContext(tc),e=n[n.length-1];return e?e.params:{}}function MO(n,e){let{relative:t}=e===void 0?{}:e,{future:s}=T.useContext(Hd),{matches:i}=T.useContext(tc),{pathname:r}=Oa(),o=JSON.stringify(ZT(i,s.v7_relativeSplatPath));return T.useMemo(()=>e_(n,JSON.parse(o),r,t==="path"),[n,o,r,t])}function J$(n,e){return X$(n,e)}function X$(n,e,t,s){Om()||ss(!1);let{navigator:i}=T.useContext(Hd),{matches:r}=T.useContext(tc),o=r[r.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let u=Oa(),f;if(e){var p;let N=typeof e=="string"?ef(e):e;l==="/"||(p=N.pathname)!=null&&p.startsWith(l)||ss(!1),f=N}else f=u;let g=f.pathname||"/",b=g;if(l!=="/"){let N=l.replace(/^\//,"").split("/");b="/"+g.replace(/^\//,"").split("/").slice(N.length).join("/")}let w=S$(n,{pathname:b}),S=n8(w&&w.map(N=>Object.assign({},N,{params:Object.assign({},a,N.params),pathname:Md([l,i.encodeLocation?i.encodeLocation(N.pathname).pathname:N.pathname]),pathnameBase:N.pathnameBase==="/"?l:Md([l,i.encodeLocation?i.encodeLocation(N.pathnameBase).pathname:N.pathnameBase])})),r,t,s);return e&&S?T.createElement(bS.Provider,{value:{location:F0({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:Nd.Pop}},S):S}function Q$(){let n=o8(),e=V$(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return T.createElement(T.Fragment,null,T.createElement("h2",null,"Unexpected Application Error!"),T.createElement("h3",{style:{fontStyle:"italic"}},e),t?T.createElement("pre",{style:i},t):null,null)}const Z$=T.createElement(Q$,null);class e8 extends T.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?T.createElement(tc.Provider,{value:this.props.routeContext},T.createElement(EO.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function t8(n){let{routeContext:e,match:t,children:s}=n,i=T.useContext(t_);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),T.createElement(tc.Provider,{value:e},s)}function n8(n,e,t,s){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),s===void 0&&(s=null),n==null){var r;if(!t)return null;if(t.errors)n=t.matches;else if((r=s)!=null&&r.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,a=(i=t)==null?void 0:i.errors;if(a!=null){let f=o.findIndex(p=>p.route.id&&(a==null?void 0:a[p.route.id])!==void 0);f>=0||ss(!1),o=o.slice(0,Math.min(o.length,f+1))}let l=!1,u=-1;if(t&&s&&s.v7_partialHydration)for(let f=0;f<o.length;f++){let p=o[f];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(u=f),p.route.id){let{loaderData:g,errors:b}=t,w=p.route.loader&&g[p.route.id]===void 0&&(!b||b[p.route.id]===void 0);if(p.route.lazy||w){l=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((f,p,g)=>{let b,w=!1,S=null,N=null;t&&(b=a&&p.route.id?a[p.route.id]:void 0,S=p.route.errorElement||Z$,l&&(u<0&&g===0?(l8("route-fallback"),w=!0,N=null):u===g&&(w=!0,N=p.route.hydrateFallbackElement||null)));let C=e.concat(o.slice(0,g+1)),M=()=>{let R;return b?R=S:w?R=N:p.route.Component?R=T.createElement(p.route.Component,null):p.route.element?R=p.route.element:R=f,T.createElement(t8,{match:p,routeContext:{outlet:f,matches:C,isDataRoute:t!=null},children:R})};return t&&(p.route.ErrorBoundary||p.route.errorElement||g===0)?T.createElement(e8,{location:t.location,revalidation:t.revalidation,component:S,error:b,children:M(),routeContext:{outlet:null,matches:C,isDataRoute:!0}}):M()},null)}var RO=(function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n})(RO||{}),IO=(function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n})(IO||{});function s8(n){let e=T.useContext(t_);return e||ss(!1),e}function i8(n){let e=T.useContext(W$);return e||ss(!1),e}function r8(n){let e=T.useContext(tc);return e||ss(!1),e}function zO(n){let e=r8(),t=e.matches[e.matches.length-1];return t.route.id||ss(!1),t.route.id}function o8(){var n;let e=T.useContext(EO),t=i8(),s=zO();return e!==void 0?e:(n=t.errors)==null?void 0:n[s]}function a8(){let{router:n}=s8(RO.UseNavigateStable),e=zO(IO.UseNavigateStable),t=T.useRef(!1);return TO(()=>{t.current=!0}),T.useCallback(function(i,r){r===void 0&&(r={}),t.current&&(typeof i=="number"?n.navigate(i):n.navigate(i,F0({fromRouteId:e},r)))},[n,e])}const Vz={};function l8(n,e,t){Vz[n]||(Vz[n]=!0)}function c8(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function d8(n){let{to:e,replace:t,state:s,relative:i}=n;Om()||ss(!1);let{future:r,static:o}=T.useContext(Hd),{matches:a}=T.useContext(tc),{pathname:l}=Oa(),u=Es(),f=e_(e,ZT(a,r.v7_relativeSplatPath),l,i==="path"),p=JSON.stringify(f);return T.useEffect(()=>u(JSON.parse(p),{replace:t,state:s,relative:i}),[u,p,i,t,s]),null}function qi(n){ss(!1)}function u8(n){let{basename:e="/",children:t=null,location:s,navigationType:i=Nd.Pop,navigator:r,static:o=!1,future:a}=n;Om()&&ss(!1);let l=e.replace(/^\/*/,"/"),u=T.useMemo(()=>({basename:l,navigator:r,static:o,future:F0({v7_relativeSplatPath:!1},a)}),[l,a,r,o]);typeof s=="string"&&(s=ef(s));let{pathname:f="/",search:p="",hash:g="",state:b=null,key:w="default"}=s,S=T.useMemo(()=>{let N=QT(f,l);return N==null?null:{location:{pathname:N,search:p,hash:g,state:b,key:w},navigationType:i}},[l,f,p,g,b,w,i]);return S==null?null:T.createElement(Hd.Provider,{value:u},T.createElement(bS.Provider,{children:t,value:S}))}function h8(n){let{children:e,location:t}=n;return J$(vN(e),t)}new Promise(()=>{});function vN(n,e){e===void 0&&(e=[]);let t=[];return T.Children.forEach(n,(s,i)=>{if(!T.isValidElement(s))return;let r=[...e,i];if(s.type===T.Fragment){t.push.apply(t,vN(s.props.children,r));return}s.type!==qi&&ss(!1),!s.props.index||!s.props.children||ss(!1);let o={id:s.props.id||r.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(o.children=vN(s.props.children,r)),t.push(o)}),t}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function wN(){return wN=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},wN.apply(this,arguments)}function f8(n,e){if(n==null)return{};var t={},s=Object.keys(n),i,r;for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function p8(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function m8(n,e){return n.button===0&&(!e||e==="_self")&&!p8(n)}const g8=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],x8="6";try{window.__reactRouterVersion=x8}catch{}const b8="startTransition",qz=d$[b8];function y8(n){let{basename:e,children:t,future:s,window:i}=n,r=T.useRef();r.current==null&&(r.current=v$({window:i,v5Compat:!0}));let o=r.current,[a,l]=T.useState({action:o.action,location:o.location}),{v7_startTransition:u}=s||{},f=T.useCallback(p=>{u&&qz?qz(()=>l(p)):l(p)},[l,u]);return T.useLayoutEffect(()=>o.listen(f),[o,f]),T.useEffect(()=>c8(s),[s]),T.createElement(u8,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:o,future:s})}const v8=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",w8=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,DO=T.forwardRef(function(e,t){let{onClick:s,relative:i,reloadDocument:r,replace:o,state:a,target:l,to:u,preventScrollReset:f,viewTransition:p}=e,g=f8(e,g8),{basename:b}=T.useContext(Hd),w,S=!1;if(typeof u=="string"&&w8.test(u)&&(w=u,v8))try{let R=new URL(window.location.href),_=u.startsWith("//")?new URL(R.protocol+u):new URL(u),j=QT(_.pathname,b);_.origin===R.origin&&j!=null?u=j+_.search+_.hash:S=!0}catch{}let N=K$(u,{relative:i}),C=k8(u,{replace:o,state:a,target:l,preventScrollReset:f,relative:i,viewTransition:p});function M(R){s&&s(R),R.defaultPrevented||C(R)}return T.createElement("a",wN({},g,{href:w||N,onClick:S||r?s:M,ref:t,target:l}))});var Wz;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(Wz||(Wz={}));var Kz;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(Kz||(Kz={}));function k8(n,e){let{target:t,replace:s,state:i,preventScrollReset:r,relative:o,viewTransition:a}=e===void 0?{}:e,l=Es(),u=Oa(),f=MO(n,{relative:o});return T.useCallback(p=>{if(m8(p,t)){p.preventDefault();let g=s!==void 0?s:jw(u)===jw(f);l(n,{replace:g,state:i,preventScrollReset:r,relative:o,viewTransition:a})}},[u,l,f,s,i,t,n,r,o,a])}const Yz="ai-book-studio-db",S8=4;class ia{constructor(e,t){this.db=e,this.storeName=t}transaction(e){return this.db.transaction(this.storeName,e).objectStore(this.storeName)}async getAll(){return new Promise((e,t)=>{const s=this.transaction("readonly").getAll();s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})}async get(e){return new Promise((t,s)=>{const i=this.transaction("readonly").get(e);i.onsuccess=()=>t(i.result),i.onerror=()=>s(i.error)})}async put(e){return new Promise((t,s)=>{const i=this.transaction("readwrite").put(e);i.onsuccess=()=>{window.dispatchEvent(new Event("dbversionchange")),t()},i.onerror=()=>s(i.error)})}async delete(e){return new Promise((t,s)=>{const i=this.transaction("readwrite").delete(e);i.onsuccess=()=>t(),i.onerror=()=>s(i.error)})}async clear(){return new Promise((e,t)=>{const s=this.transaction("readwrite").clear();s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}}class C8 extends ia{async getAllForBook(e){return(await this.getAll()).filter(s=>s.bookId===e)}}class ra{constructor(e,t="id"){this.storeName=e,this.keyPath=t,this.cache=new Map,this.storageKey=`aibookstudio_fallback_${e}`,this.load()}load(){try{const e=localStorage.getItem(this.storageKey);e&&JSON.parse(e).forEach(s=>{const i=s[this.keyPath];i&&this.cache.set(String(i),s)})}catch(e){console.warn(`Failed to load ${this.storeName} from localStorage fallback`,e)}}save(){try{const e=Array.from(this.cache.values());localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(e){console.warn(`Failed to save ${this.storeName} to localStorage fallback (quota exceeded?)`,e)}}async getAll(){return Array.from(this.cache.values())}async get(e){return this.cache.get(e)}async put(e){const t=e[this.keyPath];t&&(this.cache.set(String(t),e),this.save(),window.dispatchEvent(new Event("dbversionchange")))}async delete(e){this.cache.delete(e)&&this.save()}async clear(){this.cache.clear(),localStorage.removeItem(this.storageKey)}}class A8 extends ra{async getAllForBook(e){return(await this.getAll()).filter(s=>s.bookId===e)}}class oa{async getAll(){throw new Error("Database not initialized")}async get(e){throw new Error("Database not initialized")}async put(e){throw new Error("Database not initialized")}async delete(e){throw new Error("Database not initialized")}async clear(){throw new Error("Database not initialized")}}class N8 extends oa{async getAllForBook(e){throw new Error("Database not initialized")}}class E8{constructor(){this.db=null,this.initPromise=null,this.books=new oa,this.documents=new oa,this.instructions=new oa,this.styles=new oa,this.snapshots=new N8,this.macros=new oa,this.series=new oa,this.readingProgress=new oa,this.settings=new oa,this.history=new oa,this.audioCache={get:async()=>{},put:async()=>{}}}async init(){return this.db?Promise.resolve():this.initPromise?this.initPromise:(this.initPromise=new Promise((e,t)=>{if(typeof window>"u"||!window.indexedDB){console.warn("IndexedDB not supported in this environment. Using In-Memory Fallback."),this.useInMemory(),e();return}try{const s=indexedDB.open(Yz,S8);s.onerror=()=>{console.warn("IndexedDB failed to open (likely restricted environment). Switching to In-Memory Fallback.",s.error),this.useInMemory(),e()},s.onupgradeneeded=i=>{const r=i.target.result,o=(a,l={keyPath:"id"})=>{r.objectStoreNames.contains(a)||r.createObjectStore(a,l)};o("books"),o("documents"),o("instructions"),o("styles"),o("snapshots"),o("macros"),o("series"),r.objectStoreNames.contains("readingProgress")||r.createObjectStore("readingProgress",{keyPath:"bookId"}),o("settings"),o("history"),r.objectStoreNames.contains("audioCache")||r.createObjectStore("audioCache")},s.onsuccess=i=>{this.db=i.target.result,this.books=new ia(this.db,"books"),this.documents=new ia(this.db,"documents"),this.instructions=new ia(this.db,"instructions"),this.styles=new ia(this.db,"styles"),this.snapshots=new C8(this.db,"snapshots"),this.macros=new ia(this.db,"macros"),this.series=new ia(this.db,"series"),this.readingProgress=new ia(this.db,"readingProgress"),this.settings=new ia(this.db,"settings"),this.history=new ia(this.db,"history"),this.audioCache={get:r=>new Promise((o,a)=>{if(!this.db)return o(void 0);const l=this.db.transaction("audioCache","readonly").objectStore("audioCache").get(r);l.onsuccess=()=>o(l.result),l.onerror=()=>a(l.error)}),put:(r,o)=>new Promise((a,l)=>{if(!this.db)return l("DB not initialized");const u=this.db.transaction("audioCache","readwrite").objectStore("audioCache").put(o,r);u.onsuccess=()=>a(),u.onerror=()=>l(u.error)})},e()}}catch(s){console.warn("Exception opening IndexedDB. Using In-Memory Fallback.",s),this.useInMemory(),e()}}),this.initPromise)}useInMemory(){console.log("%c AI Book Studio: Using LocalStorage/Memory Fallback ","background: #f59e0b; color: white; padding: 4px; border-radius: 4px;"),this.books=new ra("books"),this.documents=new ra("documents"),this.instructions=new ra("instructions"),this.styles=new ra("styles"),this.snapshots=new A8("snapshots"),this.macros=new ra("macros"),this.series=new ra("series"),this.readingProgress=new ra("readingProgress","bookId"),this.settings=new ra("settings"),this.history=new ra("history");const e=new Map;this.audioCache={get:async t=>e.get(t),put:async(t,s)=>{e.set(t,s)}}}async deleteDatabase(){return this.db&&(this.db.close(),this.db=null),new Promise((e,t)=>{const s=indexedDB.deleteDatabase(Yz);s.onsuccess=()=>e(),s.onerror=()=>t(s.error),s.onblocked=()=>console.warn("Delete blocked")})}async backup(e){await this.init();const t=await this.settings.get("readerSettings");let s=await this.books.getAll();e!=null&&e.excludeImages&&(s=s.map(r=>({...r,coverImage:void 0,content:r.content.map(o=>({...o,htmlContent:o.htmlContent.replace(/src="data:image\/[^;]+;base64,[^"]+"/g,'src="" data-stripped="true"')}))})));const i={books:s,documents:await this.documents.getAll(),instructions:await this.instructions.getAll(),styles:await this.styles.getAll(),snapshots:await this.snapshots.getAll(),macros:await this.macros.getAll(),series:await this.series.getAll(),readerSettings:(t==null?void 0:t.value)??null,readingProgress:await this.readingProgress.getAll()};return JSON.stringify(i,null,2)}async restore(e){await this.init();const t=JSON.parse(e),s=async(i,r)=>{if(r){await i.clear();for(const o of r)await i.put(o)}};await s(this.books,t.books),await s(this.documents,t.documents),await s(this.instructions,t.instructions),await s(this.styles,t.styles),await s(this.snapshots,t.snapshots),await s(this.macros,t.macros),await s(this.series,t.series),await s(this.readingProgress,t.readingProgress),t.readerSettings&&await this.settings.put({id:"readerSettings",value:t.readerSettings})}async merge(e,t){await this.init();const s=JSON.parse(e),{selectedNewBooks:i,overwriteExisting:r}=t;if(s.books)for(const a of s.books)(i.includes(a.id)||r)&&await this.books.put(a);const o=async(a,l)=>{if(l)for(const u of l)(!await a.get(u.id)||r)&&await a.put(u)};if(await o(this.documents,s.documents),await o(this.instructions,s.instructions),await o(this.styles,s.styles),await o(this.macros,s.macros),await o(this.series,s.series),s.readingProgress)for(const a of s.readingProgress)(i.includes(a.bookId)||r)&&await this.readingProgress.put(a)}async smartMerge(e){await this.init();const t=JSON.parse(e),s=async(i,r)=>{if(r)for(const o of r){const a=await i.get(o.id||o.bookId);a?o.updatedAt&&a.updatedAt?o.updatedAt>a.updatedAt&&await i.put(o):await i.put(o):await i.put(o)}};await s(this.books,t.books),await s(this.documents,t.documents),await s(this.instructions,t.instructions),await s(this.styles,t.styles),await s(this.macros,t.macros),await s(this.series,t.series),await s(this.readingProgress,t.readingProgress),t.readerSettings&&await this.settings.put({id:"readerSettings",value:t.readerSettings})}async getLatestUpdateTimestamp(){await this.init();const e=await this.books.getAll(),t=await this.documents.getAll(),s=e.length>0?Math.max(...e.map(r=>r.updatedAt)):0,i=t.length>0?Math.max(...t.map(r=>r.updatedAt)):0;return Math.max(s,i)}}const Te=new E8,Jz=Object.freeze(Object.defineProperty({__proto__:null,db:Te},Symbol.toStringTag,{value:"Module"}));class T8{constructor(){this.toasts=[],this.subscribers=new Set,this.nextId=0}subscribe(e){return this.subscribers.add(e),e(this.toasts),()=>{this.subscribers.delete(e)}}notify(){this.subscribers.forEach(e=>e(this.toasts))}addToast(e,t,s){const i=this.nextId++,r=t==="success"?"CLOUD_CHECK":t==="error"?"CLOUD_OFF":"INFO";this.toasts=[...this.toasts,{id:i,message:e,type:t,duration:s,icon:r}],this.notify(),setTimeout(()=>{this.removeToast(i)},s)}removeToast(e){this.toasts=this.toasts.filter(t=>t.id!==e),this.notify()}success(e,t=5e3){this.addToast(e,"success",t)}error(e,t=7e3){this.addToast(e,"error",t)}info(e,t=5e3){this.addToast(e,"info",t)}}const te=new T8;var _8={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let M8,R8;function I8(){return{geminiUrl:M8,vertexUrl:R8}}function z8(n,e,t,s){var i,r;if(!(n!=null&&n.baseUrl)){const o=I8();return e?(i=o.vertexUrl)!==null&&i!==void 0?i:t:(r=o.geminiUrl)!==null&&r!==void 0?r:s}return n.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nc{}function Ye(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(s,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const r=e[i];return r!=null?String(r):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function k(n,e,t){for(let r=0;r<e.length-1;r++){const o=e[r];if(o.endsWith("[]")){const a=o.slice(0,-2);if(!(a in n))if(Array.isArray(t))n[a]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${o}`);if(Array.isArray(n[a])){const l=n[a];if(Array.isArray(t))for(let u=0;u<l.length;u++){const f=l[u];k(f,e.slice(r+1),t[u])}else for(const u of l)k(u,e.slice(r+1),t)}return}else if(o.endsWith("[0]")){const a=o.slice(0,-3);a in n||(n[a]=[{}]);const l=n[a];k(l[0],e.slice(r+1),t);return}(!n[o]||typeof n[o]!="object")&&(n[o]={}),n=n[o]}const s=e[e.length-1],i=n[s];if(i!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===i)return;if(typeof i=="object"&&typeof t=="object"&&i!==null&&t!==null)Object.assign(i,t);else throw new Error(`Cannot set value for an existing key. Key: ${s}`)}else s==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[s]=t}function v(n,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return n;for(let s=0;s<e.length;s++){if(typeof n!="object"||n===null)return t;const i=e[s];if(i.endsWith("[]")){const r=i.slice(0,-2);if(r in n){const o=n[r];return Array.isArray(o)?o.map(a=>v(a,e.slice(s+1),t)):t}else return t}else n=n[i]}return n}catch(s){if(s instanceof TypeError)return t;throw s}}function D8(n,e){for(const[t,s]of Object.entries(e)){const i=t.split("."),r=s.split("."),o=new Set;let a=-1;for(let l=0;l<i.length;l++)if(i[l]==="*"){a=l;break}if(a!==-1&&r.length>a)for(let l=a;l<r.length;l++){const u=r[l];u!=="*"&&!u.endsWith("[]")&&!u.endsWith("[0]")&&o.add(u)}kN(n,i,r,0,o)}}function kN(n,e,t,s,i){if(s>=e.length||typeof n!="object"||n===null)return;const r=e[s];if(r.endsWith("[]")){const o=r.slice(0,-2),a=n;if(o in a&&Array.isArray(a[o]))for(const l of a[o])kN(l,e,t,s+1,i)}else if(r==="*"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){const o=n,a=Object.keys(o).filter(u=>!u.startsWith("_")&&!i.has(u)),l={};for(const u of a)l[u]=o[u];for(const[u,f]of Object.entries(l)){const p=[];for(const g of t.slice(s))g==="*"?p.push(u):p.push(g);k(o,p,f)}for(const u of a)delete o[u]}}else{const o=n;r in o&&kN(o[r],e,t,s+1,i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function n_(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function j8(n){const e={},t=v(n,["operationName"]);t!=null&&k(e,["operationName"],t);const s=v(n,["resourceName"]);return s!=null&&k(e,["_url","resourceName"],s),e}function P8(n){const e={},t=v(n,["name"]);t!=null&&k(e,["name"],t);const s=v(n,["metadata"]);s!=null&&k(e,["metadata"],s);const i=v(n,["done"]);i!=null&&k(e,["done"],i);const r=v(n,["error"]);r!=null&&k(e,["error"],r);const o=v(n,["response","generateVideoResponse"]);return o!=null&&k(e,["response"],O8(o)),e}function L8(n){const e={},t=v(n,["name"]);t!=null&&k(e,["name"],t);const s=v(n,["metadata"]);s!=null&&k(e,["metadata"],s);const i=v(n,["done"]);i!=null&&k(e,["done"],i);const r=v(n,["error"]);r!=null&&k(e,["error"],r);const o=v(n,["response"]);return o!=null&&k(e,["response"],B8(o)),e}function O8(n){const e={},t=v(n,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>F8(o))),k(e,["generatedVideos"],r)}const s=v(n,["raiMediaFilteredCount"]);s!=null&&k(e,["raiMediaFilteredCount"],s);const i=v(n,["raiMediaFilteredReasons"]);return i!=null&&k(e,["raiMediaFilteredReasons"],i),e}function B8(n){const e={},t=v(n,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>H8(o))),k(e,["generatedVideos"],r)}const s=v(n,["raiMediaFilteredCount"]);s!=null&&k(e,["raiMediaFilteredCount"],s);const i=v(n,["raiMediaFilteredReasons"]);return i!=null&&k(e,["raiMediaFilteredReasons"],i),e}function F8(n){const e={},t=v(n,["video"]);return t!=null&&k(e,["video"],W8(t)),e}function H8(n){const e={},t=v(n,["_self"]);return t!=null&&k(e,["video"],K8(t)),e}function U8(n){const e={},t=v(n,["operationName"]);return t!=null&&k(e,["_url","operationName"],t),e}function $8(n){const e={},t=v(n,["operationName"]);return t!=null&&k(e,["_url","operationName"],t),e}function G8(n){const e={},t=v(n,["name"]);t!=null&&k(e,["name"],t);const s=v(n,["metadata"]);s!=null&&k(e,["metadata"],s);const i=v(n,["done"]);i!=null&&k(e,["done"],i);const r=v(n,["error"]);r!=null&&k(e,["error"],r);const o=v(n,["response"]);return o!=null&&k(e,["response"],V8(o)),e}function V8(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["parent"]);s!=null&&k(e,["parent"],s);const i=v(n,["documentName"]);return i!=null&&k(e,["documentName"],i),e}function jO(n){const e={},t=v(n,["name"]);t!=null&&k(e,["name"],t);const s=v(n,["metadata"]);s!=null&&k(e,["metadata"],s);const i=v(n,["done"]);i!=null&&k(e,["done"],i);const r=v(n,["error"]);r!=null&&k(e,["error"],r);const o=v(n,["response"]);return o!=null&&k(e,["response"],q8(o)),e}function q8(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["parent"]);s!=null&&k(e,["parent"],s);const i=v(n,["documentName"]);return i!=null&&k(e,["documentName"],i),e}function W8(n){const e={},t=v(n,["uri"]);t!=null&&k(e,["uri"],t);const s=v(n,["encodedVideo"]);s!=null&&k(e,["videoBytes"],n_(s));const i=v(n,["encoding"]);return i!=null&&k(e,["mimeType"],i),e}function K8(n){const e={},t=v(n,["gcsUri"]);t!=null&&k(e,["uri"],t);const s=v(n,["bytesBase64Encoded"]);s!=null&&k(e,["videoBytes"],n_(s));const i=v(n,["mimeType"]);return i!=null&&k(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Xz;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Xz||(Xz={}));var Qz;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(Qz||(Qz={}));var Zz;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(Zz||(Zz={}));var _e;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(_e||(_e={}));var eD;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(eD||(eD={}));var tD;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(tD||(tD={}));var nD;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(nD||(nD={}));var sD;(function(n){n.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",n.HTTP_IN_QUERY="HTTP_IN_QUERY",n.HTTP_IN_HEADER="HTTP_IN_HEADER",n.HTTP_IN_PATH="HTTP_IN_PATH",n.HTTP_IN_BODY="HTTP_IN_BODY",n.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(sD||(sD={}));var iD;(function(n){n.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",n.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",n.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",n.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(iD||(iD={}));var rD;(function(n){n.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH",n.MINIMAL="MINIMAL"})(rD||(rD={}));var oD;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(oD||(oD={}));var aD;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(aD||(aD={}));var lD;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(lD||(lD={}));var cD;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",n.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",n.NO_IMAGE="NO_IMAGE",n.IMAGE_RECITATION="IMAGE_RECITATION",n.IMAGE_OTHER="IMAGE_OTHER"})(cD||(cD={}));var dD;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(dD||(dD={}));var uD;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(uD||(uD={}));var hD;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(hD||(hD={}));var fD;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY",n.MODEL_ARMOR="MODEL_ARMOR",n.JAILBREAK="JAILBREAK"})(fD||(fD={}));var pD;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(pD||(pD={}));var H0;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(H0||(H0={}));var mD;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(mD||(mD={}));var gD;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(gD||(gD={}));var xD;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(xD||(xD={}));var SN;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(SN||(SN={}));var bD;(function(n){n.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",n.TUNING_TASK_I2V="TUNING_TASK_I2V",n.TUNING_TASK_T2V="TUNING_TASK_T2V",n.TUNING_TASK_R2V="TUNING_TASK_R2V"})(bD||(bD={}));var yD;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",n.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(yD||(yD={}));var vD;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(vD||(vD={}));var wD;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(wD||(wD={}));var kD;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(kD||(kD={}));var SD;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(SD||(SD={}));var CD;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE",n.VALIDATED="VALIDATED"})(CD||(CD={}));var AD;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(AD||(AD={}));var ND;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(ND||(ND={}));var ED;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(ED||(ED={}));var TD;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(TD||(TD={}));var _D;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(_D||(_D={}));var MD;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(MD||(MD={}));var RD;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(RD||(RD={}));var ID;(function(n){n.FOREGROUND="FOREGROUND",n.BACKGROUND="BACKGROUND",n.PROMPT="PROMPT",n.SEMANTIC="SEMANTIC",n.INTERACTIVE="INTERACTIVE"})(ID||(ID={}));var zD;(function(n){n.ASSET="ASSET",n.STYLE="STYLE"})(zD||(zD={}));var DD;(function(n){n.INSERT="INSERT",n.REMOVE="REMOVE",n.REMOVE_STATIC="REMOVE_STATIC",n.OUTPAINT="OUTPAINT"})(DD||(DD={}));var jD;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(jD||(jD={}));var PD;(function(n){n.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",n.PREFERENCE_TUNING="PREFERENCE_TUNING"})(PD||(PD={}));var LD;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.STATE_PENDING="STATE_PENDING",n.STATE_ACTIVE="STATE_ACTIVE",n.STATE_FAILED="STATE_FAILED"})(LD||(LD={}));var OD;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(OD||(OD={}));var BD;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(BD||(BD={}));var FD;(function(n){n.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.RESPONSE_REJECTED="RESPONSE_REJECTED",n.NEED_MORE_INPUT="NEED_MORE_INPUT"})(FD||(FD={}));var HD;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(HD||(HD={}));var UD;(function(n){n.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",n.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",n.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(UD||(UD={}));var $D;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})($D||($D={}));var GD;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(GD||(GD={}));var VD;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(VD||(VD={}));var qD;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(qD||(qD={}));var WD;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(WD||(WD={}));var KD;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(KD||(KD={}));var lp;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(lp||(lp={}));class CN{constructor(e){const t={};for(const s of e.headers.entries())t[s[0]]=s[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class Hg{get text(){var e,t,s,i,r,o,a,l;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let u="",f=!1;const p=[];for(const g of(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(const[b,w]of Object.entries(g))b!=="text"&&b!=="thought"&&b!=="thoughtSignature"&&(w!==null||w!==void 0)&&p.push(b);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;f=!0,u+=g.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?u:void 0}get data(){var e,t,s,i,r,o,a,l;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let u="";const f=[];for(const p of(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(const[g,b]of Object.entries(p))g!=="inlineData"&&(b!==null||b!==void 0)&&f.push(g);p.inlineData&&typeof p.inlineData.data=="string"&&(u+=atob(p.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),u.length>0?btoa(u):void 0}get functionCalls(){var e,t,s,i,r,o,a,l;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const u=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((u==null?void 0:u.length)!==0)return u}get executableCode(){var e,t,s,i,r,o,a,l,u;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(u=f==null?void 0:f[0])===null||u===void 0?void 0:u.code}get codeExecutionResult(){var e,t,s,i,r,o,a,l,u;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(u=f==null?void 0:f[0])===null||u===void 0?void 0:u.output}}class YD{}class JD{}class Y8{}class J8{}class X8{}class Q8{}class XD{}class QD{}class ZD{}class Z8{}class Pw{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new Pw;let i;const r=e;return t?i=L8(r):i=P8(r),Object.assign(s,i),s}}class ej{}class tj{}class nj{}class sj{}class eG{}class tG{}class nG{}class s_{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new s_,r=G8(e);return Object.assign(s,r),s}}class sG{}class iG{}class rG{}class ij{}class oG{get text(){var e,t,s;let i="",r=!1;const o=[];for(const a of(s=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&s!==void 0?s:[]){for(const[l,u]of Object.entries(a))l!=="text"&&l!=="thought"&&u!==null&&o.push(l);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;r=!0,i+=a.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?i:void 0}get data(){var e,t,s;let i="";const r=[];for(const o of(s=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&s!==void 0?s:[]){for(const[a,l]of Object.entries(o))a!=="inlineData"&&l!==null&&r.push(a);o.inlineData&&typeof o.inlineData.data=="string"&&(i+=atob(o.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class aG{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class i_{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new i_,r=jO(e);return Object.assign(s,r),s}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Jt(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function PO(n,e){const t=Jt(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function LO(n){return Array.isArray(n)?n.map(e=>Lw(e)):[Lw(n)]}function Lw(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function OO(n){const e=Lw(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function BO(n){const e=Lw(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function rj(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function FO(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>rj(e)):[rj(n)]}function AN(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function oj(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function aj(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function bi(n){if(n==null)throw new Error("ContentUnion is required");return AN(n)?n:{role:"user",parts:FO(n)}}function r_(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const s=bi(t);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]});if(n.isVertexAI()){const t=bi(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>bi(t)):[bi(e)]}function ao(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(oj(n)||aj(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[bi(n)]}const e=[],t=[],s=AN(n[0]);for(const i of n){const r=AN(i);if(r!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(i);else{if(oj(i)||aj(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(i)}}return s||e.push({role:"user",parts:FO(t)}),e}function lG(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(s=>s!=="null");if(t.length===1)e.type=Object.values(_e).includes(t[0].toUpperCase())?t[0].toUpperCase():_e.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const s of t)e.anyOf.push({type:Object.values(_e).includes(s.toUpperCase())?s.toUpperCase():_e.TYPE_UNSPECIFIED})}}function pp(n){const e={},t=["items"],s=["anyOf"],i=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const r=n.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,n=r[1]):r[1].type==="null"&&(e.nullable=!0,n=r[0])),n.type instanceof Array&&lG(n.type,e);for(const[o,a]of Object.entries(n))if(a!=null)if(o=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(_e).includes(a.toUpperCase())?a.toUpperCase():_e.TYPE_UNSPECIFIED}else if(t.includes(o))e[o]=pp(a);else if(s.includes(o)){const l=[];for(const u of a){if(u.type=="null"){e.nullable=!0;continue}l.push(pp(u))}e[o]=l}else if(i.includes(o)){const l={};for(const[u,f]of Object.entries(a))l[u]=pp(f);e[o]=l}else{if(o==="additionalProperties")continue;e[o]=a}return e}function o_(n){return pp(n)}function a_(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function l_(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function Bm(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=pp(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=pp(e.response));return n}function Fm(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function cG(n,e,t,s=1){const i=!e.startsWith(`${t}/`)&&e.split("/").length===s;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:i?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:i?`${t}/${e}`:e}function sc(n,e){if(typeof e!="string")throw new Error("name must be a string");return cG(n,e,"cachedContents")}function HO(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function Ud(n){return n_(n)}function dG(n){return n!=null&&typeof n=="object"&&"name"in n}function uG(n){return n!=null&&typeof n=="object"&&"video"in n}function hG(n){return n!=null&&typeof n=="object"&&"uri"in n}function UO(n){var e;let t;if(dG(n)&&(t=n.name),!(hG(n)&&(t=n.uri,t===void 0))&&!(uG(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const i=t.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${t}`);t=i[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function $O(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function GO(n){for(const e of["models","tunedModels","publisherModels"])if(fG(n,e))return n[e];return[]}function fG(n,e){return n!==null&&typeof n=="object"&&e in n}function pG(n,e={}){const t=n,s={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(s.responseJsonSchema=t.outputSchema),e.behavior&&(s.behavior=e.behavior),{functionDeclarations:[s]}}function mG(n,e={}){const t=[],s=new Set;for(const i of n){const r=i.name;if(s.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);s.add(r);const o=pG(i,e);o.functionDeclarations&&t.push(...o.functionDeclarations)}return{functionDeclarations:t}}function VO(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;const s=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,i=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(i>0||s!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(s>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function gG(n){if(typeof n!="string")return n;const e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function qO(n){if(typeof n!="object"||n===null)return{};const e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;const i=t.inlinedResponses;if(!Array.isArray(i)||i.length===0)return n;let r=!1;for(const o of i){if(typeof o!="object"||o===null)continue;const l=o.response;if(typeof l!="object"||l===null)continue;if(l.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function Hm(n,e){const t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function WO(n){const e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function xG(n){const e={},t=v(n,["responsesFile"]);t!=null&&k(e,["fileName"],t);const s=v(n,["inlinedResponses","inlinedResponses"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>XG(o))),k(e,["inlinedResponses"],r)}const i=v(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),k(e,["inlinedEmbedContentResponses"],r)}return e}function bG(n){const e={},t=v(n,["predictionsFormat"]);t!=null&&k(e,["format"],t);const s=v(n,["gcsDestination","outputUriPrefix"]);s!=null&&k(e,["gcsUri"],s);const i=v(n,["bigqueryDestination","outputUri"]);return i!=null&&k(e,["bigqueryUri"],i),e}function yG(n){const e={},t=v(n,["format"]);t!=null&&k(e,["predictionsFormat"],t);const s=v(n,["gcsUri"]);s!=null&&k(e,["gcsDestination","outputUriPrefix"],s);const i=v(n,["bigqueryUri"]);if(i!=null&&k(e,["bigqueryDestination","outputUri"],i),v(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(v(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(v(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Wv(n){const e={},t=v(n,["name"]);t!=null&&k(e,["name"],t);const s=v(n,["metadata","displayName"]);s!=null&&k(e,["displayName"],s);const i=v(n,["metadata","state"]);i!=null&&k(e,["state"],WO(i));const r=v(n,["metadata","createTime"]);r!=null&&k(e,["createTime"],r);const o=v(n,["metadata","endTime"]);o!=null&&k(e,["endTime"],o);const a=v(n,["metadata","updateTime"]);a!=null&&k(e,["updateTime"],a);const l=v(n,["metadata","model"]);l!=null&&k(e,["model"],l);const u=v(n,["metadata","output"]);return u!=null&&k(e,["dest"],xG(qO(u))),e}function NN(n){const e={},t=v(n,["name"]);t!=null&&k(e,["name"],t);const s=v(n,["displayName"]);s!=null&&k(e,["displayName"],s);const i=v(n,["state"]);i!=null&&k(e,["state"],WO(i));const r=v(n,["error"]);r!=null&&k(e,["error"],r);const o=v(n,["createTime"]);o!=null&&k(e,["createTime"],o);const a=v(n,["startTime"]);a!=null&&k(e,["startTime"],a);const l=v(n,["endTime"]);l!=null&&k(e,["endTime"],l);const u=v(n,["updateTime"]);u!=null&&k(e,["updateTime"],u);const f=v(n,["model"]);f!=null&&k(e,["model"],f);const p=v(n,["inputConfig"]);p!=null&&k(e,["src"],vG(p));const g=v(n,["outputConfig"]);g!=null&&k(e,["dest"],bG(qO(g)));const b=v(n,["completionStats"]);return b!=null&&k(e,["completionStats"],b),e}function vG(n){const e={},t=v(n,["instancesFormat"]);t!=null&&k(e,["format"],t);const s=v(n,["gcsSource","uris"]);s!=null&&k(e,["gcsUri"],s);const i=v(n,["bigquerySource","inputUri"]);return i!=null&&k(e,["bigqueryUri"],i),e}function wG(n,e){const t={};if(v(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(v(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(v(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const s=v(e,["fileName"]);s!=null&&k(t,["fileName"],s);const i=v(e,["inlinedRequests"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>JG(n,o))),k(t,["requests","requests"],r)}return t}function kG(n){const e={},t=v(n,["format"]);t!=null&&k(e,["instancesFormat"],t);const s=v(n,["gcsUri"]);s!=null&&k(e,["gcsSource","uris"],s);const i=v(n,["bigqueryUri"]);if(i!=null&&k(e,["bigquerySource","inputUri"],i),v(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(v(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function SG(n){const e={},t=v(n,["data"]);if(t!=null&&k(e,["data"],t),v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=v(n,["mimeType"]);return s!=null&&k(e,["mimeType"],s),e}function CG(n,e){const t={},s=v(e,["name"]);return s!=null&&k(t,["_url","name"],Hm(n,s)),t}function AG(n,e){const t={},s=v(e,["name"]);return s!=null&&k(t,["_url","name"],Hm(n,s)),t}function NG(n){const e={},t=v(n,["content"]);t!=null&&k(e,["content"],t);const s=v(n,["citationMetadata"]);s!=null&&k(e,["citationMetadata"],EG(s));const i=v(n,["tokenCount"]);i!=null&&k(e,["tokenCount"],i);const r=v(n,["finishReason"]);r!=null&&k(e,["finishReason"],r);const o=v(n,["avgLogprobs"]);o!=null&&k(e,["avgLogprobs"],o);const a=v(n,["groundingMetadata"]);a!=null&&k(e,["groundingMetadata"],a);const l=v(n,["index"]);l!=null&&k(e,["index"],l);const u=v(n,["logprobsResult"]);u!=null&&k(e,["logprobsResult"],u);const f=v(n,["safetyRatings"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(b=>b)),k(e,["safetyRatings"],g)}const p=v(n,["urlContextMetadata"]);return p!=null&&k(e,["urlContextMetadata"],p),e}function EG(n){const e={},t=v(n,["citationSources"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>i)),k(e,["citations"],s)}return e}function KO(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>iV(r))),k(e,["parts"],i)}const s=v(n,["role"]);return s!=null&&k(e,["role"],s),e}function TG(n,e){const t={},s=v(n,["displayName"]);if(e!==void 0&&s!=null&&k(e,["batch","displayName"],s),v(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function _G(n,e){const t={},s=v(n,["displayName"]);e!==void 0&&s!=null&&k(e,["displayName"],s);const i=v(n,["dest"]);return e!==void 0&&i!=null&&k(e,["outputConfig"],yG(gG(i))),t}function lj(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["src"]);i!=null&&k(t,["batch","inputConfig"],wG(n,VO(n,i)));const r=v(e,["config"]);return r!=null&&TG(r,t),t}function MG(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["model"],Jt(n,s));const i=v(e,["src"]);i!=null&&k(t,["inputConfig"],kG(VO(n,i)));const r=v(e,["config"]);return r!=null&&_G(r,t),t}function RG(n,e){const t={},s=v(n,["displayName"]);return e!==void 0&&s!=null&&k(e,["batch","displayName"],s),t}function IG(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["src"]);i!=null&&k(t,["batch","inputConfig"],BG(n,i));const r=v(e,["config"]);return r!=null&&RG(r,t),t}function zG(n,e){const t={},s=v(e,["name"]);return s!=null&&k(t,["_url","name"],Hm(n,s)),t}function DG(n,e){const t={},s=v(e,["name"]);return s!=null&&k(t,["_url","name"],Hm(n,s)),t}function jG(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["name"]);s!=null&&k(e,["name"],s);const i=v(n,["done"]);i!=null&&k(e,["done"],i);const r=v(n,["error"]);return r!=null&&k(e,["error"],r),e}function PG(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["name"]);s!=null&&k(e,["name"],s);const i=v(n,["done"]);i!=null&&k(e,["done"],i);const r=v(n,["error"]);return r!=null&&k(e,["error"],r),e}function LG(n,e){const t={},s=v(e,["contents"]);if(s!=null){let r=r_(n,s);Array.isArray(r)&&(r=r.map(o=>o)),k(t,["requests[]","request","content"],r)}const i=v(e,["config"]);return i!=null&&(k(t,["_self"],OG(i,t)),D8(t,{"requests[].*":"requests[].request.*"})),t}function OG(n,e){const t={},s=v(n,["taskType"]);e!==void 0&&s!=null&&k(e,["requests[]","taskType"],s);const i=v(n,["title"]);e!==void 0&&i!=null&&k(e,["requests[]","title"],i);const r=v(n,["outputDimensionality"]);if(e!==void 0&&r!=null&&k(e,["requests[]","outputDimensionality"],r),v(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(v(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function BG(n,e){const t={},s=v(e,["fileName"]);s!=null&&k(t,["file_name"],s);const i=v(e,["inlinedRequests"]);return i!=null&&k(t,["requests"],LG(n,i)),t}function FG(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&k(e,["fileUri"],t);const s=v(n,["mimeType"]);return s!=null&&k(e,["mimeType"],s),e}function HG(n){const e={},t=v(n,["id"]);t!=null&&k(e,["id"],t);const s=v(n,["args"]);s!=null&&k(e,["args"],s);const i=v(n,["name"]);if(i!=null&&k(e,["name"],i),v(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function UG(n){const e={},t=v(n,["mode"]);t!=null&&k(e,["mode"],t);const s=v(n,["allowedFunctionNames"]);if(s!=null&&k(e,["allowedFunctionNames"],s),v(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function $G(n,e,t){const s={},i=v(e,["systemInstruction"]);t!==void 0&&i!=null&&k(t,["systemInstruction"],KO(bi(i)));const r=v(e,["temperature"]);r!=null&&k(s,["temperature"],r);const o=v(e,["topP"]);o!=null&&k(s,["topP"],o);const a=v(e,["topK"]);a!=null&&k(s,["topK"],a);const l=v(e,["candidateCount"]);l!=null&&k(s,["candidateCount"],l);const u=v(e,["maxOutputTokens"]);u!=null&&k(s,["maxOutputTokens"],u);const f=v(e,["stopSequences"]);f!=null&&k(s,["stopSequences"],f);const p=v(e,["responseLogprobs"]);p!=null&&k(s,["responseLogprobs"],p);const g=v(e,["logprobs"]);g!=null&&k(s,["logprobs"],g);const b=v(e,["presencePenalty"]);b!=null&&k(s,["presencePenalty"],b);const w=v(e,["frequencyPenalty"]);w!=null&&k(s,["frequencyPenalty"],w);const S=v(e,["seed"]);S!=null&&k(s,["seed"],S);const N=v(e,["responseMimeType"]);N!=null&&k(s,["responseMimeType"],N);const C=v(e,["responseSchema"]);C!=null&&k(s,["responseSchema"],o_(C));const M=v(e,["responseJsonSchema"]);if(M!=null&&k(s,["responseJsonSchema"],M),v(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(v(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const R=v(e,["safetySettings"]);if(t!==void 0&&R!=null){let W=R;Array.isArray(W)&&(W=W.map(Q=>rV(Q))),k(t,["safetySettings"],W)}const _=v(e,["tools"]);if(t!==void 0&&_!=null){let W=Fm(_);Array.isArray(W)&&(W=W.map(Q=>aV(Bm(Q)))),k(t,["tools"],W)}const j=v(e,["toolConfig"]);if(t!==void 0&&j!=null&&k(t,["toolConfig"],oV(j)),v(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const P=v(e,["cachedContent"]);t!==void 0&&P!=null&&k(t,["cachedContent"],sc(n,P));const D=v(e,["responseModalities"]);D!=null&&k(s,["responseModalities"],D);const U=v(e,["mediaResolution"]);U!=null&&k(s,["mediaResolution"],U);const V=v(e,["speechConfig"]);if(V!=null&&k(s,["speechConfig"],a_(V)),v(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const q=v(e,["thinkingConfig"]);q!=null&&k(s,["thinkingConfig"],q);const G=v(e,["imageConfig"]);G!=null&&k(s,["imageConfig"],YG(G));const ee=v(e,["enableEnhancedCivicAnswers"]);return ee!=null&&k(s,["enableEnhancedCivicAnswers"],ee),s}function GG(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["candidates"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(u=>NG(u))),k(e,["candidates"],l)}const i=v(n,["modelVersion"]);i!=null&&k(e,["modelVersion"],i);const r=v(n,["promptFeedback"]);r!=null&&k(e,["promptFeedback"],r);const o=v(n,["responseId"]);o!=null&&k(e,["responseId"],o);const a=v(n,["usageMetadata"]);return a!=null&&k(e,["usageMetadata"],a),e}function VG(n,e){const t={},s=v(e,["name"]);return s!=null&&k(t,["_url","name"],Hm(n,s)),t}function qG(n,e){const t={},s=v(e,["name"]);return s!=null&&k(t,["_url","name"],Hm(n,s)),t}function WG(n){const e={};if(v(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(n,["enableWidget"]);return t!=null&&k(e,["enableWidget"],t),e}function KG(n){const e={};if(v(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(n,["timeRangeFilter"]);return t!=null&&k(e,["timeRangeFilter"],t),e}function YG(n){const e={},t=v(n,["aspectRatio"]);t!=null&&k(e,["aspectRatio"],t);const s=v(n,["imageSize"]);if(s!=null&&k(e,["imageSize"],s),v(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(v(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function JG(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["request","model"],Jt(n,s));const i=v(e,["contents"]);if(i!=null){let a=ao(i);Array.isArray(a)&&(a=a.map(l=>KO(l))),k(t,["request","contents"],a)}const r=v(e,["metadata"]);r!=null&&k(t,["metadata"],r);const o=v(e,["config"]);return o!=null&&k(t,["request","generationConfig"],$G(n,o,v(t,["request"],{}))),t}function XG(n){const e={},t=v(n,["response"]);t!=null&&k(e,["response"],GG(t));const s=v(n,["error"]);return s!=null&&k(e,["error"],s),e}function QG(n,e){const t={},s=v(n,["pageSize"]);e!==void 0&&s!=null&&k(e,["_query","pageSize"],s);const i=v(n,["pageToken"]);if(e!==void 0&&i!=null&&k(e,["_query","pageToken"],i),v(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function ZG(n,e){const t={},s=v(n,["pageSize"]);e!==void 0&&s!=null&&k(e,["_query","pageSize"],s);const i=v(n,["pageToken"]);e!==void 0&&i!=null&&k(e,["_query","pageToken"],i);const r=v(n,["filter"]);return e!==void 0&&r!=null&&k(e,["_query","filter"],r),t}function eV(n){const e={},t=v(n,["config"]);return t!=null&&QG(t,e),e}function tV(n){const e={},t=v(n,["config"]);return t!=null&&ZG(t,e),e}function nV(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&k(e,["nextPageToken"],s);const i=v(n,["operations"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>Wv(o))),k(e,["batchJobs"],r)}return e}function sV(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&k(e,["nextPageToken"],s);const i=v(n,["batchPredictionJobs"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>NN(o))),k(e,["batchJobs"],r)}return e}function iV(n){const e={},t=v(n,["mediaResolution"]);t!=null&&k(e,["mediaResolution"],t);const s=v(n,["codeExecutionResult"]);s!=null&&k(e,["codeExecutionResult"],s);const i=v(n,["executableCode"]);i!=null&&k(e,["executableCode"],i);const r=v(n,["fileData"]);r!=null&&k(e,["fileData"],FG(r));const o=v(n,["functionCall"]);o!=null&&k(e,["functionCall"],HG(o));const a=v(n,["functionResponse"]);a!=null&&k(e,["functionResponse"],a);const l=v(n,["inlineData"]);l!=null&&k(e,["inlineData"],SG(l));const u=v(n,["text"]);u!=null&&k(e,["text"],u);const f=v(n,["thought"]);f!=null&&k(e,["thought"],f);const p=v(n,["thoughtSignature"]);p!=null&&k(e,["thoughtSignature"],p);const g=v(n,["videoMetadata"]);return g!=null&&k(e,["videoMetadata"],g),e}function rV(n){const e={},t=v(n,["category"]);if(t!=null&&k(e,["category"],t),v(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=v(n,["threshold"]);return s!=null&&k(e,["threshold"],s),e}function oV(n){const e={},t=v(n,["functionCallingConfig"]);t!=null&&k(e,["functionCallingConfig"],UG(t));const s=v(n,["retrievalConfig"]);return s!=null&&k(e,["retrievalConfig"],s),e}function aV(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>p)),k(e,["functionDeclarations"],f)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=v(n,["googleSearchRetrieval"]);s!=null&&k(e,["googleSearchRetrieval"],s);const i=v(n,["computerUse"]);i!=null&&k(e,["computerUse"],i);const r=v(n,["fileSearch"]);r!=null&&k(e,["fileSearch"],r);const o=v(n,["codeExecution"]);if(o!=null&&k(e,["codeExecution"],o),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=v(n,["googleMaps"]);a!=null&&k(e,["googleMaps"],WG(a));const l=v(n,["googleSearch"]);l!=null&&k(e,["googleSearch"],KG(l));const u=v(n,["urlContext"]);return u!=null&&k(e,["urlContext"],u),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Jl;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents",n.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",n.PAGED_ITEM_DOCUMENTS="documents"})(Jl||(Jl={}));class tf{constructor(e,t,s,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,s,i)}init(e,t,s){var i,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let o={config:{}};!s||Object.keys(s).length===0?o={config:{}}:typeof s=="object"?o=Object.assign({},s):o=s,o.config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=(r=(i=o.config)===null||i===void 0?void 0:i.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class lV extends nc{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new tf(Jl.PAGED_ITEM_BATCH_JOBS,s=>this.listInternal(s),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){const t=lj(this.apiClient,e),s=t._url,i=Ye("{model}:batchGenerateContent",s),a=t.batch.inputConfig.requests,l=a.requests,u=[];for(const f of l){const p=Object.assign({},f);if(p.systemInstruction){const g=p.systemInstruction;delete p.systemInstruction;const b=p.request;b.systemInstruction=g,p.request=b}u.push(p)}return a.requests=u,delete t.config,delete t._url,delete t._query,{path:i,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){const s=t?Object.assign({},t):{},i=Date.now().toString();if(s.displayName||(s.displayName=`genaiBatchJob_${i}`),s.dest===void 0){const r=this.getGcsUri(e),o=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?s.dest=`${r.slice(0,-6)}/dest`:s.dest=`${r}_dest_${i}`;else if(o)s.dest=`${o}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return s}async createInternal(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=MG(this.apiClient,e);return a=Ye("batchPredictionJobs",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>NN(f))}else{const u=lj(this.apiClient,e);return a=Ye("{model}:batchGenerateContent",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>Wv(f))}}async createEmbeddingsInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=IG(this.apiClient,e);return r=Ye("{model}:asyncBatchEmbedContent",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),i.then(l=>Wv(l))}}async get(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=qG(this.apiClient,e);return a=Ye("batchPredictionJobs/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>NN(f))}else{const u=VG(this.apiClient,e);return a=Ye("batches/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>Wv(f))}}async cancel(e){var t,s,i,r;let o="",a={};if(this.apiClient.isVertexAI()){const l=AG(this.apiClient,e);o=Ye("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const l=CG(this.apiClient,e);o=Ye("batches/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=tV(e);return a=Ye("batchPredictionJobs",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=sV(f),g=new ij;return Object.assign(g,p),g})}else{const u=eV(e);return a=Ye("batches",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=nV(f),g=new ij;return Object.assign(g,p),g})}}async delete(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=DG(this.apiClient,e);return a=Ye("batchPredictionJobs/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>PG(f))}else{const u=zG(this.apiClient,e);return a=Ye("batches/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>jG(f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function cV(n){const e={},t=v(n,["data"]);if(t!=null&&k(e,["data"],t),v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=v(n,["mimeType"]);return s!=null&&k(e,["mimeType"],s),e}function cj(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>IV(r))),k(e,["parts"],i)}const s=v(n,["role"]);return s!=null&&k(e,["role"],s),e}function dV(n,e){const t={},s=v(n,["ttl"]);e!==void 0&&s!=null&&k(e,["ttl"],s);const i=v(n,["expireTime"]);e!==void 0&&i!=null&&k(e,["expireTime"],i);const r=v(n,["displayName"]);e!==void 0&&r!=null&&k(e,["displayName"],r);const o=v(n,["contents"]);if(e!==void 0&&o!=null){let f=ao(o);Array.isArray(f)&&(f=f.map(p=>cj(p))),k(e,["contents"],f)}const a=v(n,["systemInstruction"]);e!==void 0&&a!=null&&k(e,["systemInstruction"],cj(bi(a)));const l=v(n,["tools"]);if(e!==void 0&&l!=null){let f=l;Array.isArray(f)&&(f=f.map(p=>DV(p))),k(e,["tools"],f)}const u=v(n,["toolConfig"]);if(e!==void 0&&u!=null&&k(e,["toolConfig"],zV(u)),v(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function uV(n,e){const t={},s=v(n,["ttl"]);e!==void 0&&s!=null&&k(e,["ttl"],s);const i=v(n,["expireTime"]);e!==void 0&&i!=null&&k(e,["expireTime"],i);const r=v(n,["displayName"]);e!==void 0&&r!=null&&k(e,["displayName"],r);const o=v(n,["contents"]);if(e!==void 0&&o!=null){let p=ao(o);Array.isArray(p)&&(p=p.map(g=>g)),k(e,["contents"],p)}const a=v(n,["systemInstruction"]);e!==void 0&&a!=null&&k(e,["systemInstruction"],bi(a));const l=v(n,["tools"]);if(e!==void 0&&l!=null){let p=l;Array.isArray(p)&&(p=p.map(g=>jV(g))),k(e,["tools"],p)}const u=v(n,["toolConfig"]);e!==void 0&&u!=null&&k(e,["toolConfig"],u);const f=v(n,["kmsKeyName"]);return e!==void 0&&f!=null&&k(e,["encryption_spec","kmsKeyName"],f),t}function hV(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["model"],PO(n,s));const i=v(e,["config"]);return i!=null&&dV(i,t),t}function fV(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["model"],PO(n,s));const i=v(e,["config"]);return i!=null&&uV(i,t),t}function pV(n,e){const t={},s=v(e,["name"]);return s!=null&&k(t,["_url","name"],sc(n,s)),t}function mV(n,e){const t={},s=v(e,["name"]);return s!=null&&k(t,["_url","name"],sc(n,s)),t}function gV(n){const e={},t=v(n,["sdkHttpResponse"]);return t!=null&&k(e,["sdkHttpResponse"],t),e}function xV(n){const e={},t=v(n,["sdkHttpResponse"]);return t!=null&&k(e,["sdkHttpResponse"],t),e}function bV(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&k(e,["fileUri"],t);const s=v(n,["mimeType"]);return s!=null&&k(e,["mimeType"],s),e}function yV(n){const e={},t=v(n,["id"]);t!=null&&k(e,["id"],t);const s=v(n,["args"]);s!=null&&k(e,["args"],s);const i=v(n,["name"]);if(i!=null&&k(e,["name"],i),v(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function vV(n){const e={},t=v(n,["mode"]);t!=null&&k(e,["mode"],t);const s=v(n,["allowedFunctionNames"]);if(s!=null&&k(e,["allowedFunctionNames"],s),v(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function wV(n){const e={};if(v(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=v(n,["description"]);t!=null&&k(e,["description"],t);const s=v(n,["name"]);s!=null&&k(e,["name"],s);const i=v(n,["parameters"]);i!=null&&k(e,["parameters"],i);const r=v(n,["parametersJsonSchema"]);r!=null&&k(e,["parametersJsonSchema"],r);const o=v(n,["response"]);o!=null&&k(e,["response"],o);const a=v(n,["responseJsonSchema"]);return a!=null&&k(e,["responseJsonSchema"],a),e}function kV(n,e){const t={},s=v(e,["name"]);return s!=null&&k(t,["_url","name"],sc(n,s)),t}function SV(n,e){const t={},s=v(e,["name"]);return s!=null&&k(t,["_url","name"],sc(n,s)),t}function CV(n){const e={};if(v(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(n,["enableWidget"]);return t!=null&&k(e,["enableWidget"],t),e}function AV(n){const e={};if(v(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(n,["timeRangeFilter"]);return t!=null&&k(e,["timeRangeFilter"],t),e}function NV(n,e){const t={},s=v(n,["pageSize"]);e!==void 0&&s!=null&&k(e,["_query","pageSize"],s);const i=v(n,["pageToken"]);return e!==void 0&&i!=null&&k(e,["_query","pageToken"],i),t}function EV(n,e){const t={},s=v(n,["pageSize"]);e!==void 0&&s!=null&&k(e,["_query","pageSize"],s);const i=v(n,["pageToken"]);return e!==void 0&&i!=null&&k(e,["_query","pageToken"],i),t}function TV(n){const e={},t=v(n,["config"]);return t!=null&&NV(t,e),e}function _V(n){const e={},t=v(n,["config"]);return t!=null&&EV(t,e),e}function MV(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&k(e,["nextPageToken"],s);const i=v(n,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),k(e,["cachedContents"],r)}return e}function RV(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&k(e,["nextPageToken"],s);const i=v(n,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),k(e,["cachedContents"],r)}return e}function IV(n){const e={},t=v(n,["mediaResolution"]);t!=null&&k(e,["mediaResolution"],t);const s=v(n,["codeExecutionResult"]);s!=null&&k(e,["codeExecutionResult"],s);const i=v(n,["executableCode"]);i!=null&&k(e,["executableCode"],i);const r=v(n,["fileData"]);r!=null&&k(e,["fileData"],bV(r));const o=v(n,["functionCall"]);o!=null&&k(e,["functionCall"],yV(o));const a=v(n,["functionResponse"]);a!=null&&k(e,["functionResponse"],a);const l=v(n,["inlineData"]);l!=null&&k(e,["inlineData"],cV(l));const u=v(n,["text"]);u!=null&&k(e,["text"],u);const f=v(n,["thought"]);f!=null&&k(e,["thought"],f);const p=v(n,["thoughtSignature"]);p!=null&&k(e,["thoughtSignature"],p);const g=v(n,["videoMetadata"]);return g!=null&&k(e,["videoMetadata"],g),e}function zV(n){const e={},t=v(n,["functionCallingConfig"]);t!=null&&k(e,["functionCallingConfig"],vV(t));const s=v(n,["retrievalConfig"]);return s!=null&&k(e,["retrievalConfig"],s),e}function DV(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>p)),k(e,["functionDeclarations"],f)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=v(n,["googleSearchRetrieval"]);s!=null&&k(e,["googleSearchRetrieval"],s);const i=v(n,["computerUse"]);i!=null&&k(e,["computerUse"],i);const r=v(n,["fileSearch"]);r!=null&&k(e,["fileSearch"],r);const o=v(n,["codeExecution"]);if(o!=null&&k(e,["codeExecution"],o),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=v(n,["googleMaps"]);a!=null&&k(e,["googleMaps"],CV(a));const l=v(n,["googleSearch"]);l!=null&&k(e,["googleSearch"],AV(l));const u=v(n,["urlContext"]);return u!=null&&k(e,["urlContext"],u),e}function jV(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let p=t;Array.isArray(p)&&(p=p.map(g=>wV(g))),k(e,["functionDeclarations"],p)}const s=v(n,["retrieval"]);s!=null&&k(e,["retrieval"],s);const i=v(n,["googleSearchRetrieval"]);i!=null&&k(e,["googleSearchRetrieval"],i);const r=v(n,["computerUse"]);if(r!=null&&k(e,["computerUse"],r),v(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=v(n,["codeExecution"]);o!=null&&k(e,["codeExecution"],o);const a=v(n,["enterpriseWebSearch"]);a!=null&&k(e,["enterpriseWebSearch"],a);const l=v(n,["googleMaps"]);l!=null&&k(e,["googleMaps"],l);const u=v(n,["googleSearch"]);u!=null&&k(e,["googleSearch"],u);const f=v(n,["urlContext"]);return f!=null&&k(e,["urlContext"],f),e}function PV(n,e){const t={},s=v(n,["ttl"]);e!==void 0&&s!=null&&k(e,["ttl"],s);const i=v(n,["expireTime"]);return e!==void 0&&i!=null&&k(e,["expireTime"],i),t}function LV(n,e){const t={},s=v(n,["ttl"]);e!==void 0&&s!=null&&k(e,["ttl"],s);const i=v(n,["expireTime"]);return e!==void 0&&i!=null&&k(e,["expireTime"],i),t}function OV(n,e){const t={},s=v(e,["name"]);s!=null&&k(t,["_url","name"],sc(n,s));const i=v(e,["config"]);return i!=null&&PV(i,t),t}function BV(n,e){const t={},s=v(e,["name"]);s!=null&&k(t,["_url","name"],sc(n,s));const i=v(e,["config"]);return i!=null&&LV(i,t),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class FV extends nc{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new tf(Jl.PAGED_ITEM_CACHED_CONTENTS,s=>this.listInternal(s),await this.listInternal(t),t)}async create(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=fV(this.apiClient,e);return a=Ye("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>f)}else{const u=hV(this.apiClient,e);return a=Ye("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async get(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=SV(this.apiClient,e);return a=Ye("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>f)}else{const u=kV(this.apiClient,e);return a=Ye("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async delete(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=mV(this.apiClient,e);return a=Ye("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=xV(f),g=new nj;return Object.assign(g,p),g})}else{const u=pV(this.apiClient,e);return a=Ye("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=gV(f),g=new nj;return Object.assign(g,p),g})}}async update(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=BV(this.apiClient,e);return a=Ye("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>f)}else{const u=OV(this.apiClient,e);return a=Ye("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async listInternal(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=_V(e);return a=Ye("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=RV(f),g=new sj;return Object.assign(g,p),g})}else{const u=TV(e);return a=Ye("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=MV(f),g=new sj;return Object.assign(g,p),g})}}}function Ow(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t}function dj(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],s=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function xt(n){return this instanceof xt?(this.v=n,this):new xt(n)}function Fo(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(n,e||[]),i,r=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(b){return function(w){return Promise.resolve(w).then(b,p)}}function a(b,w){s[b]&&(i[b]=function(S){return new Promise(function(N,C){r.push([b,S,N,C])>1||l(b,S)})},w&&(i[b]=w(i[b])))}function l(b,w){try{u(s[b](w))}catch(S){g(r[0][3],S)}}function u(b){b.value instanceof xt?Promise.resolve(b.value.v).then(f,p):g(r[0][2],b)}function f(b){l("next",b)}function p(b){l("throw",b)}function g(b,w){b(w),r.shift(),r.length&&l(r[0][0],r[0][1])}}function Ho(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof dj=="function"?dj(n):n[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=n[r]&&function(o){return new Promise(function(a,l){o=n[r](o),i(a,l,o.done,o.value)})}}function i(r,o,a,l){Promise.resolve(l).then(function(u){r({value:u,done:a})},o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function HV(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:YO(t)}function YO(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function UV(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function uj(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let s=0;for(;s<t;)if(n[s].role==="user")e.push(n[s]),s++;else{const i=[];let r=!0;for(;s<t&&n[s].role==="model";)i.push(n[s]),r&&!YO(n[s])&&(r=!1),s++;r?e.push(...i):e.pop()}return e}class $V{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new GV(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class GV{constructor(e,t,s,i={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=s,this.config=i,this.history=r,this.sendPromise=Promise.resolve(),UV(r)}async sendMessage(e){var t;await this.sendPromise;const s=bi(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(s),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var r,o,a;const l=await i,u=(o=(r=l.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content,f=l.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let g=[];f!=null&&(g=(a=f.slice(p))!==null&&a!==void 0?a:[]);const b=u?[u]:[];this.recordHistory(s,b,g)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;const s=bi(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(s),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const r=await i;return this.processStreamResponse(r,s)}getHistory(e=!1){const t=e?uj(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return Fo(this,arguments,function*(){var i,r,o,a,l,u;const f=[];try{for(var p=!0,g=Ho(e),b;b=yield xt(g.next()),i=b.done,!i;p=!0){a=b.value,p=!1;const w=a;if(HV(w)){const S=(u=(l=w.candidates)===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.content;S!==void 0&&f.push(S)}yield yield xt(w)}}catch(w){r={error:w}}finally{try{!p&&!i&&(o=g.return)&&(yield xt(o.call(g)))}finally{if(r)throw r.error}}this.recordHistory(t,f)})}recordHistory(e,t,s){let i=[];t.length>0&&t.every(r=>r.role!==void 0)?i=t:i.push({role:"model",parts:[]}),s&&s.length>0?this.history.push(...uj(s)):this.history.push(e),this.history.push(...i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yS extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,yS.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function VV(n){const e={},t=v(n,["file"]);return t!=null&&k(e,["file"],t),e}function qV(n){const e={},t=v(n,["sdkHttpResponse"]);return t!=null&&k(e,["sdkHttpResponse"],t),e}function WV(n){const e={},t=v(n,["name"]);return t!=null&&k(e,["_url","file"],UO(t)),e}function KV(n){const e={},t=v(n,["sdkHttpResponse"]);return t!=null&&k(e,["sdkHttpResponse"],t),e}function YV(n){const e={},t=v(n,["name"]);return t!=null&&k(e,["_url","file"],UO(t)),e}function JV(n,e){const t={},s=v(n,["pageSize"]);e!==void 0&&s!=null&&k(e,["_query","pageSize"],s);const i=v(n,["pageToken"]);return e!==void 0&&i!=null&&k(e,["_query","pageToken"],i),t}function XV(n){const e={},t=v(n,["config"]);return t!=null&&JV(t,e),e}function QV(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&k(e,["nextPageToken"],s);const i=v(n,["files"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),k(e,["files"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ZV extends nc{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new tf(Jl.PAGED_ITEM_FILES,s=>this.listInternal(s),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=XV(e);return r=Ye("files",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const f=u;return f.sdkHttpResponse={headers:l.headers},f})),i.then(l=>{const u=QV(l),f=new sG;return Object.assign(f,u),f})}}async createInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=VV(e);return r=Ye("upload/v1beta/files",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),i.then(l=>{const u=qV(l),f=new iG;return Object.assign(f,u),f})}}async get(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=YV(e);return r=Ye("files/{file}",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async delete(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=WV(e);return r=Ye("files/{file}",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const f=u;return f.sdkHttpResponse={headers:l.headers},f})),i.then(l=>{const u=KV(l),f=new rG;return Object.assign(f,u),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Kv(n){const e={},t=v(n,["data"]);if(t!=null&&k(e,["data"],t),v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=v(n,["mimeType"]);return s!=null&&k(e,["mimeType"],s),e}function e7(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>g7(r))),k(e,["parts"],i)}const s=v(n,["role"]);return s!=null&&k(e,["role"],s),e}function t7(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&k(e,["fileUri"],t);const s=v(n,["mimeType"]);return s!=null&&k(e,["mimeType"],s),e}function n7(n){const e={},t=v(n,["id"]);t!=null&&k(e,["id"],t);const s=v(n,["args"]);s!=null&&k(e,["args"],s);const i=v(n,["name"]);if(i!=null&&k(e,["name"],i),v(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function s7(n){const e={};if(v(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=v(n,["description"]);t!=null&&k(e,["description"],t);const s=v(n,["name"]);s!=null&&k(e,["name"],s);const i=v(n,["parameters"]);i!=null&&k(e,["parameters"],i);const r=v(n,["parametersJsonSchema"]);r!=null&&k(e,["parametersJsonSchema"],r);const o=v(n,["response"]);o!=null&&k(e,["response"],o);const a=v(n,["responseJsonSchema"]);return a!=null&&k(e,["responseJsonSchema"],a),e}function i7(n){const e={},t=v(n,["modelSelectionConfig"]);t!=null&&k(e,["modelConfig"],t);const s=v(n,["responseJsonSchema"]);s!=null&&k(e,["responseJsonSchema"],s);const i=v(n,["audioTimestamp"]);i!=null&&k(e,["audioTimestamp"],i);const r=v(n,["candidateCount"]);r!=null&&k(e,["candidateCount"],r);const o=v(n,["enableAffectiveDialog"]);o!=null&&k(e,["enableAffectiveDialog"],o);const a=v(n,["frequencyPenalty"]);a!=null&&k(e,["frequencyPenalty"],a);const l=v(n,["logprobs"]);l!=null&&k(e,["logprobs"],l);const u=v(n,["maxOutputTokens"]);u!=null&&k(e,["maxOutputTokens"],u);const f=v(n,["mediaResolution"]);f!=null&&k(e,["mediaResolution"],f);const p=v(n,["presencePenalty"]);p!=null&&k(e,["presencePenalty"],p);const g=v(n,["responseLogprobs"]);g!=null&&k(e,["responseLogprobs"],g);const b=v(n,["responseMimeType"]);b!=null&&k(e,["responseMimeType"],b);const w=v(n,["responseModalities"]);w!=null&&k(e,["responseModalities"],w);const S=v(n,["responseSchema"]);S!=null&&k(e,["responseSchema"],S);const N=v(n,["routingConfig"]);N!=null&&k(e,["routingConfig"],N);const C=v(n,["seed"]);C!=null&&k(e,["seed"],C);const M=v(n,["speechConfig"]);M!=null&&k(e,["speechConfig"],M);const R=v(n,["stopSequences"]);R!=null&&k(e,["stopSequences"],R);const _=v(n,["temperature"]);_!=null&&k(e,["temperature"],_);const j=v(n,["thinkingConfig"]);j!=null&&k(e,["thinkingConfig"],j);const P=v(n,["topK"]);P!=null&&k(e,["topK"],P);const D=v(n,["topP"]);if(D!=null&&k(e,["topP"],D),v(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function r7(n){const e={};if(v(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(n,["enableWidget"]);return t!=null&&k(e,["enableWidget"],t),e}function o7(n){const e={};if(v(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(n,["timeRangeFilter"]);return t!=null&&k(e,["timeRangeFilter"],t),e}function a7(n,e){const t={},s=v(n,["generationConfig"]);e!==void 0&&s!=null&&k(e,["setup","generationConfig"],s);const i=v(n,["responseModalities"]);e!==void 0&&i!=null&&k(e,["setup","generationConfig","responseModalities"],i);const r=v(n,["temperature"]);e!==void 0&&r!=null&&k(e,["setup","generationConfig","temperature"],r);const o=v(n,["topP"]);e!==void 0&&o!=null&&k(e,["setup","generationConfig","topP"],o);const a=v(n,["topK"]);e!==void 0&&a!=null&&k(e,["setup","generationConfig","topK"],a);const l=v(n,["maxOutputTokens"]);e!==void 0&&l!=null&&k(e,["setup","generationConfig","maxOutputTokens"],l);const u=v(n,["mediaResolution"]);e!==void 0&&u!=null&&k(e,["setup","generationConfig","mediaResolution"],u);const f=v(n,["seed"]);e!==void 0&&f!=null&&k(e,["setup","generationConfig","seed"],f);const p=v(n,["speechConfig"]);e!==void 0&&p!=null&&k(e,["setup","generationConfig","speechConfig"],l_(p));const g=v(n,["thinkingConfig"]);e!==void 0&&g!=null&&k(e,["setup","generationConfig","thinkingConfig"],g);const b=v(n,["enableAffectiveDialog"]);e!==void 0&&b!=null&&k(e,["setup","generationConfig","enableAffectiveDialog"],b);const w=v(n,["systemInstruction"]);e!==void 0&&w!=null&&k(e,["setup","systemInstruction"],e7(bi(w)));const S=v(n,["tools"]);if(e!==void 0&&S!=null){let P=Fm(S);Array.isArray(P)&&(P=P.map(D=>b7(Bm(D)))),k(e,["setup","tools"],P)}const N=v(n,["sessionResumption"]);e!==void 0&&N!=null&&k(e,["setup","sessionResumption"],x7(N));const C=v(n,["inputAudioTranscription"]);e!==void 0&&C!=null&&k(e,["setup","inputAudioTranscription"],C);const M=v(n,["outputAudioTranscription"]);e!==void 0&&M!=null&&k(e,["setup","outputAudioTranscription"],M);const R=v(n,["realtimeInputConfig"]);e!==void 0&&R!=null&&k(e,["setup","realtimeInputConfig"],R);const _=v(n,["contextWindowCompression"]);e!==void 0&&_!=null&&k(e,["setup","contextWindowCompression"],_);const j=v(n,["proactivity"]);if(e!==void 0&&j!=null&&k(e,["setup","proactivity"],j),v(n,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function l7(n,e){const t={},s=v(n,["generationConfig"]);e!==void 0&&s!=null&&k(e,["setup","generationConfig"],i7(s));const i=v(n,["responseModalities"]);e!==void 0&&i!=null&&k(e,["setup","generationConfig","responseModalities"],i);const r=v(n,["temperature"]);e!==void 0&&r!=null&&k(e,["setup","generationConfig","temperature"],r);const o=v(n,["topP"]);e!==void 0&&o!=null&&k(e,["setup","generationConfig","topP"],o);const a=v(n,["topK"]);e!==void 0&&a!=null&&k(e,["setup","generationConfig","topK"],a);const l=v(n,["maxOutputTokens"]);e!==void 0&&l!=null&&k(e,["setup","generationConfig","maxOutputTokens"],l);const u=v(n,["mediaResolution"]);e!==void 0&&u!=null&&k(e,["setup","generationConfig","mediaResolution"],u);const f=v(n,["seed"]);e!==void 0&&f!=null&&k(e,["setup","generationConfig","seed"],f);const p=v(n,["speechConfig"]);e!==void 0&&p!=null&&k(e,["setup","generationConfig","speechConfig"],l_(p));const g=v(n,["thinkingConfig"]);e!==void 0&&g!=null&&k(e,["setup","generationConfig","thinkingConfig"],g);const b=v(n,["enableAffectiveDialog"]);e!==void 0&&b!=null&&k(e,["setup","generationConfig","enableAffectiveDialog"],b);const w=v(n,["systemInstruction"]);e!==void 0&&w!=null&&k(e,["setup","systemInstruction"],bi(w));const S=v(n,["tools"]);if(e!==void 0&&S!=null){let D=Fm(S);Array.isArray(D)&&(D=D.map(U=>y7(Bm(U)))),k(e,["setup","tools"],D)}const N=v(n,["sessionResumption"]);e!==void 0&&N!=null&&k(e,["setup","sessionResumption"],N);const C=v(n,["inputAudioTranscription"]);e!==void 0&&C!=null&&k(e,["setup","inputAudioTranscription"],C);const M=v(n,["outputAudioTranscription"]);e!==void 0&&M!=null&&k(e,["setup","outputAudioTranscription"],M);const R=v(n,["realtimeInputConfig"]);e!==void 0&&R!=null&&k(e,["setup","realtimeInputConfig"],R);const _=v(n,["contextWindowCompression"]);e!==void 0&&_!=null&&k(e,["setup","contextWindowCompression"],_);const j=v(n,["proactivity"]);e!==void 0&&j!=null&&k(e,["setup","proactivity"],j);const P=v(n,["explicitVadSignal"]);return e!==void 0&&P!=null&&k(e,["setup","explicitVadSignal"],P),t}function c7(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["setup","model"],Jt(n,s));const i=v(e,["config"]);return i!=null&&k(t,["config"],a7(i,t)),t}function d7(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["setup","model"],Jt(n,s));const i=v(e,["config"]);return i!=null&&k(t,["config"],l7(i,t)),t}function u7(n){const e={},t=v(n,["musicGenerationConfig"]);return t!=null&&k(e,["musicGenerationConfig"],t),e}function h7(n){const e={},t=v(n,["weightedPrompts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>i)),k(e,["weightedPrompts"],s)}return e}function f7(n){const e={},t=v(n,["media"]);if(t!=null){let u=LO(t);Array.isArray(u)&&(u=u.map(f=>Kv(f))),k(e,["mediaChunks"],u)}const s=v(n,["audio"]);s!=null&&k(e,["audio"],Kv(BO(s)));const i=v(n,["audioStreamEnd"]);i!=null&&k(e,["audioStreamEnd"],i);const r=v(n,["video"]);r!=null&&k(e,["video"],Kv(OO(r)));const o=v(n,["text"]);o!=null&&k(e,["text"],o);const a=v(n,["activityStart"]);a!=null&&k(e,["activityStart"],a);const l=v(n,["activityEnd"]);return l!=null&&k(e,["activityEnd"],l),e}function p7(n){const e={},t=v(n,["media"]);if(t!=null){let u=LO(t);Array.isArray(u)&&(u=u.map(f=>f)),k(e,["mediaChunks"],u)}const s=v(n,["audio"]);s!=null&&k(e,["audio"],BO(s));const i=v(n,["audioStreamEnd"]);i!=null&&k(e,["audioStreamEnd"],i);const r=v(n,["video"]);r!=null&&k(e,["video"],OO(r));const o=v(n,["text"]);o!=null&&k(e,["text"],o);const a=v(n,["activityStart"]);a!=null&&k(e,["activityStart"],a);const l=v(n,["activityEnd"]);return l!=null&&k(e,["activityEnd"],l),e}function m7(n){const e={},t=v(n,["setupComplete"]);t!=null&&k(e,["setupComplete"],t);const s=v(n,["serverContent"]);s!=null&&k(e,["serverContent"],s);const i=v(n,["toolCall"]);i!=null&&k(e,["toolCall"],i);const r=v(n,["toolCallCancellation"]);r!=null&&k(e,["toolCallCancellation"],r);const o=v(n,["usageMetadata"]);o!=null&&k(e,["usageMetadata"],v7(o));const a=v(n,["goAway"]);a!=null&&k(e,["goAway"],a);const l=v(n,["sessionResumptionUpdate"]);l!=null&&k(e,["sessionResumptionUpdate"],l);const u=v(n,["voiceActivityDetectionSignal"]);return u!=null&&k(e,["voiceActivityDetectionSignal"],u),e}function g7(n){const e={},t=v(n,["mediaResolution"]);t!=null&&k(e,["mediaResolution"],t);const s=v(n,["codeExecutionResult"]);s!=null&&k(e,["codeExecutionResult"],s);const i=v(n,["executableCode"]);i!=null&&k(e,["executableCode"],i);const r=v(n,["fileData"]);r!=null&&k(e,["fileData"],t7(r));const o=v(n,["functionCall"]);o!=null&&k(e,["functionCall"],n7(o));const a=v(n,["functionResponse"]);a!=null&&k(e,["functionResponse"],a);const l=v(n,["inlineData"]);l!=null&&k(e,["inlineData"],Kv(l));const u=v(n,["text"]);u!=null&&k(e,["text"],u);const f=v(n,["thought"]);f!=null&&k(e,["thought"],f);const p=v(n,["thoughtSignature"]);p!=null&&k(e,["thoughtSignature"],p);const g=v(n,["videoMetadata"]);return g!=null&&k(e,["videoMetadata"],g),e}function x7(n){const e={},t=v(n,["handle"]);if(t!=null&&k(e,["handle"],t),v(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function b7(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>p)),k(e,["functionDeclarations"],f)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=v(n,["googleSearchRetrieval"]);s!=null&&k(e,["googleSearchRetrieval"],s);const i=v(n,["computerUse"]);i!=null&&k(e,["computerUse"],i);const r=v(n,["fileSearch"]);r!=null&&k(e,["fileSearch"],r);const o=v(n,["codeExecution"]);if(o!=null&&k(e,["codeExecution"],o),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=v(n,["googleMaps"]);a!=null&&k(e,["googleMaps"],r7(a));const l=v(n,["googleSearch"]);l!=null&&k(e,["googleSearch"],o7(l));const u=v(n,["urlContext"]);return u!=null&&k(e,["urlContext"],u),e}function y7(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let p=t;Array.isArray(p)&&(p=p.map(g=>s7(g))),k(e,["functionDeclarations"],p)}const s=v(n,["retrieval"]);s!=null&&k(e,["retrieval"],s);const i=v(n,["googleSearchRetrieval"]);i!=null&&k(e,["googleSearchRetrieval"],i);const r=v(n,["computerUse"]);if(r!=null&&k(e,["computerUse"],r),v(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=v(n,["codeExecution"]);o!=null&&k(e,["codeExecution"],o);const a=v(n,["enterpriseWebSearch"]);a!=null&&k(e,["enterpriseWebSearch"],a);const l=v(n,["googleMaps"]);l!=null&&k(e,["googleMaps"],l);const u=v(n,["googleSearch"]);u!=null&&k(e,["googleSearch"],u);const f=v(n,["urlContext"]);return f!=null&&k(e,["urlContext"],f),e}function v7(n){const e={},t=v(n,["promptTokenCount"]);t!=null&&k(e,["promptTokenCount"],t);const s=v(n,["cachedContentTokenCount"]);s!=null&&k(e,["cachedContentTokenCount"],s);const i=v(n,["candidatesTokenCount"]);i!=null&&k(e,["responseTokenCount"],i);const r=v(n,["toolUsePromptTokenCount"]);r!=null&&k(e,["toolUsePromptTokenCount"],r);const o=v(n,["thoughtsTokenCount"]);o!=null&&k(e,["thoughtsTokenCount"],o);const a=v(n,["totalTokenCount"]);a!=null&&k(e,["totalTokenCount"],a);const l=v(n,["promptTokensDetails"]);if(l!=null){let b=l;Array.isArray(b)&&(b=b.map(w=>w)),k(e,["promptTokensDetails"],b)}const u=v(n,["cacheTokensDetails"]);if(u!=null){let b=u;Array.isArray(b)&&(b=b.map(w=>w)),k(e,["cacheTokensDetails"],b)}const f=v(n,["candidatesTokensDetails"]);if(f!=null){let b=f;Array.isArray(b)&&(b=b.map(w=>w)),k(e,["responseTokensDetails"],b)}const p=v(n,["toolUsePromptTokensDetails"]);if(p!=null){let b=p;Array.isArray(b)&&(b=b.map(w=>w)),k(e,["toolUsePromptTokensDetails"],b)}const g=v(n,["trafficType"]);return g!=null&&k(e,["trafficType"],g),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function w7(n){const e={},t=v(n,["data"]);if(t!=null&&k(e,["data"],t),v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=v(n,["mimeType"]);return s!=null&&k(e,["mimeType"],s),e}function k7(n){const e={},t=v(n,["content"]);t!=null&&k(e,["content"],t);const s=v(n,["citationMetadata"]);s!=null&&k(e,["citationMetadata"],S7(s));const i=v(n,["tokenCount"]);i!=null&&k(e,["tokenCount"],i);const r=v(n,["finishReason"]);r!=null&&k(e,["finishReason"],r);const o=v(n,["avgLogprobs"]);o!=null&&k(e,["avgLogprobs"],o);const a=v(n,["groundingMetadata"]);a!=null&&k(e,["groundingMetadata"],a);const l=v(n,["index"]);l!=null&&k(e,["index"],l);const u=v(n,["logprobsResult"]);u!=null&&k(e,["logprobsResult"],u);const f=v(n,["safetyRatings"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(b=>b)),k(e,["safetyRatings"],g)}const p=v(n,["urlContextMetadata"]);return p!=null&&k(e,["urlContextMetadata"],p),e}function S7(n){const e={},t=v(n,["citationSources"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>i)),k(e,["citations"],s)}return e}function C7(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["contents"]);if(i!=null){let r=ao(i);Array.isArray(r)&&(r=r.map(o=>o)),k(t,["contents"],r)}return t}function A7(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["tokensInfo"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),k(e,["tokensInfo"],i)}return e}function N7(n){const e={},t=v(n,["values"]);t!=null&&k(e,["values"],t);const s=v(n,["statistics"]);return s!=null&&k(e,["statistics"],E7(s)),e}function E7(n){const e={},t=v(n,["truncated"]);t!=null&&k(e,["truncated"],t);const s=v(n,["token_count"]);return s!=null&&k(e,["tokenCount"],s),e}function vS(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>Pq(r))),k(e,["parts"],i)}const s=v(n,["role"]);return s!=null&&k(e,["role"],s),e}function T7(n){const e={},t=v(n,["controlType"]);t!=null&&k(e,["controlType"],t);const s=v(n,["enableControlImageComputation"]);return s!=null&&k(e,["computeControl"],s),e}function _7(n){const e={};if(v(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(v(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(v(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function M7(n,e){const t={},s=v(n,["systemInstruction"]);e!==void 0&&s!=null&&k(e,["systemInstruction"],bi(s));const i=v(n,["tools"]);if(e!==void 0&&i!=null){let o=i;Array.isArray(o)&&(o=o.map(a=>ZO(a))),k(e,["tools"],o)}const r=v(n,["generationConfig"]);return e!==void 0&&r!=null&&k(e,["generationConfig"],wq(r)),t}function R7(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["contents"]);if(i!=null){let o=ao(i);Array.isArray(o)&&(o=o.map(a=>vS(a))),k(t,["contents"],o)}const r=v(e,["config"]);return r!=null&&_7(r),t}function I7(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["contents"]);if(i!=null){let o=ao(i);Array.isArray(o)&&(o=o.map(a=>a)),k(t,["contents"],o)}const r=v(e,["config"]);return r!=null&&M7(r,t),t}function z7(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["totalTokens"]);s!=null&&k(e,["totalTokens"],s);const i=v(n,["cachedContentTokenCount"]);return i!=null&&k(e,["cachedContentTokenCount"],i),e}function D7(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["totalTokens"]);return s!=null&&k(e,["totalTokens"],s),e}function j7(n,e){const t={},s=v(e,["model"]);return s!=null&&k(t,["_url","name"],Jt(n,s)),t}function P7(n,e){const t={},s=v(e,["model"]);return s!=null&&k(t,["_url","name"],Jt(n,s)),t}function L7(n){const e={},t=v(n,["sdkHttpResponse"]);return t!=null&&k(e,["sdkHttpResponse"],t),e}function O7(n){const e={},t=v(n,["sdkHttpResponse"]);return t!=null&&k(e,["sdkHttpResponse"],t),e}function B7(n,e){const t={},s=v(n,["outputGcsUri"]);e!==void 0&&s!=null&&k(e,["parameters","storageUri"],s);const i=v(n,["negativePrompt"]);e!==void 0&&i!=null&&k(e,["parameters","negativePrompt"],i);const r=v(n,["numberOfImages"]);e!==void 0&&r!=null&&k(e,["parameters","sampleCount"],r);const o=v(n,["aspectRatio"]);e!==void 0&&o!=null&&k(e,["parameters","aspectRatio"],o);const a=v(n,["guidanceScale"]);e!==void 0&&a!=null&&k(e,["parameters","guidanceScale"],a);const l=v(n,["seed"]);e!==void 0&&l!=null&&k(e,["parameters","seed"],l);const u=v(n,["safetyFilterLevel"]);e!==void 0&&u!=null&&k(e,["parameters","safetySetting"],u);const f=v(n,["personGeneration"]);e!==void 0&&f!=null&&k(e,["parameters","personGeneration"],f);const p=v(n,["includeSafetyAttributes"]);e!==void 0&&p!=null&&k(e,["parameters","includeSafetyAttributes"],p);const g=v(n,["includeRaiReason"]);e!==void 0&&g!=null&&k(e,["parameters","includeRaiReason"],g);const b=v(n,["language"]);e!==void 0&&b!=null&&k(e,["parameters","language"],b);const w=v(n,["outputMimeType"]);e!==void 0&&w!=null&&k(e,["parameters","outputOptions","mimeType"],w);const S=v(n,["outputCompressionQuality"]);e!==void 0&&S!=null&&k(e,["parameters","outputOptions","compressionQuality"],S);const N=v(n,["addWatermark"]);e!==void 0&&N!=null&&k(e,["parameters","addWatermark"],N);const C=v(n,["labels"]);e!==void 0&&C!=null&&k(e,["labels"],C);const M=v(n,["editMode"]);e!==void 0&&M!=null&&k(e,["parameters","editMode"],M);const R=v(n,["baseSteps"]);return e!==void 0&&R!=null&&k(e,["parameters","editConfig","baseSteps"],R),t}function F7(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["prompt"]);i!=null&&k(t,["instances[0]","prompt"],i);const r=v(e,["referenceImages"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(l=>Uq(l))),k(t,["instances[0]","referenceImages"],a)}const o=v(e,["config"]);return o!=null&&B7(o,t),t}function H7(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>wS(r))),k(e,["generatedImages"],i)}return e}function U7(n,e){const t={},s=v(n,["taskType"]);e!==void 0&&s!=null&&k(e,["requests[]","taskType"],s);const i=v(n,["title"]);e!==void 0&&i!=null&&k(e,["requests[]","title"],i);const r=v(n,["outputDimensionality"]);if(e!==void 0&&r!=null&&k(e,["requests[]","outputDimensionality"],r),v(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(v(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function $7(n,e){const t={},s=v(n,["taskType"]);e!==void 0&&s!=null&&k(e,["instances[]","task_type"],s);const i=v(n,["title"]);e!==void 0&&i!=null&&k(e,["instances[]","title"],i);const r=v(n,["outputDimensionality"]);e!==void 0&&r!=null&&k(e,["parameters","outputDimensionality"],r);const o=v(n,["mimeType"]);e!==void 0&&o!=null&&k(e,["instances[]","mimeType"],o);const a=v(n,["autoTruncate"]);return e!==void 0&&a!=null&&k(e,["parameters","autoTruncate"],a),t}function G7(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["contents"]);if(i!=null){let a=r_(n,i);Array.isArray(a)&&(a=a.map(l=>l)),k(t,["requests[]","content"],a)}const r=v(e,["config"]);r!=null&&U7(r,t);const o=v(e,["model"]);return o!==void 0&&k(t,["requests[]","model"],Jt(n,o)),t}function V7(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["contents"]);if(i!=null){let o=r_(n,i);Array.isArray(o)&&(o=o.map(a=>a)),k(t,["instances[]","content"],o)}const r=v(e,["config"]);return r!=null&&$7(r,t),t}function q7(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["embeddings"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),k(e,["embeddings"],r)}const i=v(n,["metadata"]);return i!=null&&k(e,["metadata"],i),e}function W7(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["predictions[]","embeddings"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>N7(o))),k(e,["embeddings"],r)}const i=v(n,["metadata"]);return i!=null&&k(e,["metadata"],i),e}function K7(n){const e={},t=v(n,["endpoint"]);t!=null&&k(e,["name"],t);const s=v(n,["deployedModelId"]);return s!=null&&k(e,["deployedModelId"],s),e}function Y7(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&k(e,["fileUri"],t);const s=v(n,["mimeType"]);return s!=null&&k(e,["mimeType"],s),e}function J7(n){const e={},t=v(n,["id"]);t!=null&&k(e,["id"],t);const s=v(n,["args"]);s!=null&&k(e,["args"],s);const i=v(n,["name"]);if(i!=null&&k(e,["name"],i),v(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function X7(n){const e={},t=v(n,["mode"]);t!=null&&k(e,["mode"],t);const s=v(n,["allowedFunctionNames"]);if(s!=null&&k(e,["allowedFunctionNames"],s),v(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function Q7(n){const e={};if(v(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=v(n,["description"]);t!=null&&k(e,["description"],t);const s=v(n,["name"]);s!=null&&k(e,["name"],s);const i=v(n,["parameters"]);i!=null&&k(e,["parameters"],i);const r=v(n,["parametersJsonSchema"]);r!=null&&k(e,["parametersJsonSchema"],r);const o=v(n,["response"]);o!=null&&k(e,["response"],o);const a=v(n,["responseJsonSchema"]);return a!=null&&k(e,["responseJsonSchema"],a),e}function Z7(n,e,t){const s={},i=v(e,["systemInstruction"]);t!==void 0&&i!=null&&k(t,["systemInstruction"],vS(bi(i)));const r=v(e,["temperature"]);r!=null&&k(s,["temperature"],r);const o=v(e,["topP"]);o!=null&&k(s,["topP"],o);const a=v(e,["topK"]);a!=null&&k(s,["topK"],a);const l=v(e,["candidateCount"]);l!=null&&k(s,["candidateCount"],l);const u=v(e,["maxOutputTokens"]);u!=null&&k(s,["maxOutputTokens"],u);const f=v(e,["stopSequences"]);f!=null&&k(s,["stopSequences"],f);const p=v(e,["responseLogprobs"]);p!=null&&k(s,["responseLogprobs"],p);const g=v(e,["logprobs"]);g!=null&&k(s,["logprobs"],g);const b=v(e,["presencePenalty"]);b!=null&&k(s,["presencePenalty"],b);const w=v(e,["frequencyPenalty"]);w!=null&&k(s,["frequencyPenalty"],w);const S=v(e,["seed"]);S!=null&&k(s,["seed"],S);const N=v(e,["responseMimeType"]);N!=null&&k(s,["responseMimeType"],N);const C=v(e,["responseSchema"]);C!=null&&k(s,["responseSchema"],o_(C));const M=v(e,["responseJsonSchema"]);if(M!=null&&k(s,["responseJsonSchema"],M),v(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(v(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const R=v(e,["safetySettings"]);if(t!==void 0&&R!=null){let W=R;Array.isArray(W)&&(W=W.map(Q=>$q(Q))),k(t,["safetySettings"],W)}const _=v(e,["tools"]);if(t!==void 0&&_!=null){let W=Fm(_);Array.isArray(W)&&(W=W.map(Q=>Jq(Bm(Q)))),k(t,["tools"],W)}const j=v(e,["toolConfig"]);if(t!==void 0&&j!=null&&k(t,["toolConfig"],Yq(j)),v(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const P=v(e,["cachedContent"]);t!==void 0&&P!=null&&k(t,["cachedContent"],sc(n,P));const D=v(e,["responseModalities"]);D!=null&&k(s,["responseModalities"],D);const U=v(e,["mediaResolution"]);U!=null&&k(s,["mediaResolution"],U);const V=v(e,["speechConfig"]);if(V!=null&&k(s,["speechConfig"],a_(V)),v(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const q=v(e,["thinkingConfig"]);q!=null&&k(s,["thinkingConfig"],q);const G=v(e,["imageConfig"]);G!=null&&k(s,["imageConfig"],Nq(G));const ee=v(e,["enableEnhancedCivicAnswers"]);return ee!=null&&k(s,["enableEnhancedCivicAnswers"],ee),s}function eq(n,e,t){const s={},i=v(e,["systemInstruction"]);t!==void 0&&i!=null&&k(t,["systemInstruction"],bi(i));const r=v(e,["temperature"]);r!=null&&k(s,["temperature"],r);const o=v(e,["topP"]);o!=null&&k(s,["topP"],o);const a=v(e,["topK"]);a!=null&&k(s,["topK"],a);const l=v(e,["candidateCount"]);l!=null&&k(s,["candidateCount"],l);const u=v(e,["maxOutputTokens"]);u!=null&&k(s,["maxOutputTokens"],u);const f=v(e,["stopSequences"]);f!=null&&k(s,["stopSequences"],f);const p=v(e,["responseLogprobs"]);p!=null&&k(s,["responseLogprobs"],p);const g=v(e,["logprobs"]);g!=null&&k(s,["logprobs"],g);const b=v(e,["presencePenalty"]);b!=null&&k(s,["presencePenalty"],b);const w=v(e,["frequencyPenalty"]);w!=null&&k(s,["frequencyPenalty"],w);const S=v(e,["seed"]);S!=null&&k(s,["seed"],S);const N=v(e,["responseMimeType"]);N!=null&&k(s,["responseMimeType"],N);const C=v(e,["responseSchema"]);C!=null&&k(s,["responseSchema"],o_(C));const M=v(e,["responseJsonSchema"]);M!=null&&k(s,["responseJsonSchema"],M);const R=v(e,["routingConfig"]);R!=null&&k(s,["routingConfig"],R);const _=v(e,["modelSelectionConfig"]);_!=null&&k(s,["modelConfig"],_);const j=v(e,["safetySettings"]);if(t!==void 0&&j!=null){let $=j;Array.isArray($)&&($=$.map(Y=>Y)),k(t,["safetySettings"],$)}const P=v(e,["tools"]);if(t!==void 0&&P!=null){let $=Fm(P);Array.isArray($)&&($=$.map(Y=>ZO(Bm(Y)))),k(t,["tools"],$)}const D=v(e,["toolConfig"]);t!==void 0&&D!=null&&k(t,["toolConfig"],D);const U=v(e,["labels"]);t!==void 0&&U!=null&&k(t,["labels"],U);const V=v(e,["cachedContent"]);t!==void 0&&V!=null&&k(t,["cachedContent"],sc(n,V));const q=v(e,["responseModalities"]);q!=null&&k(s,["responseModalities"],q);const G=v(e,["mediaResolution"]);G!=null&&k(s,["mediaResolution"],G);const ee=v(e,["speechConfig"]);ee!=null&&k(s,["speechConfig"],a_(ee));const W=v(e,["audioTimestamp"]);W!=null&&k(s,["audioTimestamp"],W);const Q=v(e,["thinkingConfig"]);Q!=null&&k(s,["thinkingConfig"],Q);const Z=v(e,["imageConfig"]);if(Z!=null&&k(s,["imageConfig"],Eq(Z)),v(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return s}function hj(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["contents"]);if(i!=null){let o=ao(i);Array.isArray(o)&&(o=o.map(a=>vS(a))),k(t,["contents"],o)}const r=v(e,["config"]);return r!=null&&k(t,["generationConfig"],Z7(n,r,t)),t}function fj(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["contents"]);if(i!=null){let o=ao(i);Array.isArray(o)&&(o=o.map(a=>a)),k(t,["contents"],o)}const r=v(e,["config"]);return r!=null&&k(t,["generationConfig"],eq(n,r,t)),t}function pj(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["candidates"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(u=>k7(u))),k(e,["candidates"],l)}const i=v(n,["modelVersion"]);i!=null&&k(e,["modelVersion"],i);const r=v(n,["promptFeedback"]);r!=null&&k(e,["promptFeedback"],r);const o=v(n,["responseId"]);o!=null&&k(e,["responseId"],o);const a=v(n,["usageMetadata"]);return a!=null&&k(e,["usageMetadata"],a),e}function mj(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["candidates"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(f=>f)),k(e,["candidates"],u)}const i=v(n,["createTime"]);i!=null&&k(e,["createTime"],i);const r=v(n,["modelVersion"]);r!=null&&k(e,["modelVersion"],r);const o=v(n,["promptFeedback"]);o!=null&&k(e,["promptFeedback"],o);const a=v(n,["responseId"]);a!=null&&k(e,["responseId"],a);const l=v(n,["usageMetadata"]);return l!=null&&k(e,["usageMetadata"],l),e}function tq(n,e){const t={};if(v(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(v(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=v(n,["numberOfImages"]);e!==void 0&&s!=null&&k(e,["parameters","sampleCount"],s);const i=v(n,["aspectRatio"]);e!==void 0&&i!=null&&k(e,["parameters","aspectRatio"],i);const r=v(n,["guidanceScale"]);if(e!==void 0&&r!=null&&k(e,["parameters","guidanceScale"],r),v(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=v(n,["safetyFilterLevel"]);e!==void 0&&o!=null&&k(e,["parameters","safetySetting"],o);const a=v(n,["personGeneration"]);e!==void 0&&a!=null&&k(e,["parameters","personGeneration"],a);const l=v(n,["includeSafetyAttributes"]);e!==void 0&&l!=null&&k(e,["parameters","includeSafetyAttributes"],l);const u=v(n,["includeRaiReason"]);e!==void 0&&u!=null&&k(e,["parameters","includeRaiReason"],u);const f=v(n,["language"]);e!==void 0&&f!=null&&k(e,["parameters","language"],f);const p=v(n,["outputMimeType"]);e!==void 0&&p!=null&&k(e,["parameters","outputOptions","mimeType"],p);const g=v(n,["outputCompressionQuality"]);if(e!==void 0&&g!=null&&k(e,["parameters","outputOptions","compressionQuality"],g),v(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(v(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const b=v(n,["imageSize"]);if(e!==void 0&&b!=null&&k(e,["parameters","sampleImageSize"],b),v(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function nq(n,e){const t={},s=v(n,["outputGcsUri"]);e!==void 0&&s!=null&&k(e,["parameters","storageUri"],s);const i=v(n,["negativePrompt"]);e!==void 0&&i!=null&&k(e,["parameters","negativePrompt"],i);const r=v(n,["numberOfImages"]);e!==void 0&&r!=null&&k(e,["parameters","sampleCount"],r);const o=v(n,["aspectRatio"]);e!==void 0&&o!=null&&k(e,["parameters","aspectRatio"],o);const a=v(n,["guidanceScale"]);e!==void 0&&a!=null&&k(e,["parameters","guidanceScale"],a);const l=v(n,["seed"]);e!==void 0&&l!=null&&k(e,["parameters","seed"],l);const u=v(n,["safetyFilterLevel"]);e!==void 0&&u!=null&&k(e,["parameters","safetySetting"],u);const f=v(n,["personGeneration"]);e!==void 0&&f!=null&&k(e,["parameters","personGeneration"],f);const p=v(n,["includeSafetyAttributes"]);e!==void 0&&p!=null&&k(e,["parameters","includeSafetyAttributes"],p);const g=v(n,["includeRaiReason"]);e!==void 0&&g!=null&&k(e,["parameters","includeRaiReason"],g);const b=v(n,["language"]);e!==void 0&&b!=null&&k(e,["parameters","language"],b);const w=v(n,["outputMimeType"]);e!==void 0&&w!=null&&k(e,["parameters","outputOptions","mimeType"],w);const S=v(n,["outputCompressionQuality"]);e!==void 0&&S!=null&&k(e,["parameters","outputOptions","compressionQuality"],S);const N=v(n,["addWatermark"]);e!==void 0&&N!=null&&k(e,["parameters","addWatermark"],N);const C=v(n,["labels"]);e!==void 0&&C!=null&&k(e,["labels"],C);const M=v(n,["imageSize"]);e!==void 0&&M!=null&&k(e,["parameters","sampleImageSize"],M);const R=v(n,["enhancePrompt"]);return e!==void 0&&R!=null&&k(e,["parameters","enhancePrompt"],R),t}function sq(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["prompt"]);i!=null&&k(t,["instances[0]","prompt"],i);const r=v(e,["config"]);return r!=null&&tq(r,t),t}function iq(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["prompt"]);i!=null&&k(t,["instances[0]","prompt"],i);const r=v(e,["config"]);return r!=null&&nq(r,t),t}function rq(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>xq(o))),k(e,["generatedImages"],r)}const i=v(n,["positivePromptSafetyAttributes"]);return i!=null&&k(e,["positivePromptSafetyAttributes"],XO(i)),e}function oq(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>wS(o))),k(e,["generatedImages"],r)}const i=v(n,["positivePromptSafetyAttributes"]);return i!=null&&k(e,["positivePromptSafetyAttributes"],QO(i)),e}function aq(n,e){const t={},s=v(n,["numberOfVideos"]);if(e!==void 0&&s!=null&&k(e,["parameters","sampleCount"],s),v(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(v(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const i=v(n,["durationSeconds"]);if(e!==void 0&&i!=null&&k(e,["parameters","durationSeconds"],i),v(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const r=v(n,["aspectRatio"]);e!==void 0&&r!=null&&k(e,["parameters","aspectRatio"],r);const o=v(n,["resolution"]);e!==void 0&&o!=null&&k(e,["parameters","resolution"],o);const a=v(n,["personGeneration"]);if(e!==void 0&&a!=null&&k(e,["parameters","personGeneration"],a),v(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const l=v(n,["negativePrompt"]);e!==void 0&&l!=null&&k(e,["parameters","negativePrompt"],l);const u=v(n,["enhancePrompt"]);if(e!==void 0&&u!=null&&k(e,["parameters","enhancePrompt"],u),v(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const f=v(n,["lastFrame"]);e!==void 0&&f!=null&&k(e,["instances[0]","lastFrame"],kS(f));const p=v(n,["referenceImages"]);if(e!==void 0&&p!=null){let g=p;Array.isArray(g)&&(g=g.map(b=>c9(b))),k(e,["instances[0]","referenceImages"],g)}if(v(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(v(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function lq(n,e){const t={},s=v(n,["numberOfVideos"]);e!==void 0&&s!=null&&k(e,["parameters","sampleCount"],s);const i=v(n,["outputGcsUri"]);e!==void 0&&i!=null&&k(e,["parameters","storageUri"],i);const r=v(n,["fps"]);e!==void 0&&r!=null&&k(e,["parameters","fps"],r);const o=v(n,["durationSeconds"]);e!==void 0&&o!=null&&k(e,["parameters","durationSeconds"],o);const a=v(n,["seed"]);e!==void 0&&a!=null&&k(e,["parameters","seed"],a);const l=v(n,["aspectRatio"]);e!==void 0&&l!=null&&k(e,["parameters","aspectRatio"],l);const u=v(n,["resolution"]);e!==void 0&&u!=null&&k(e,["parameters","resolution"],u);const f=v(n,["personGeneration"]);e!==void 0&&f!=null&&k(e,["parameters","personGeneration"],f);const p=v(n,["pubsubTopic"]);e!==void 0&&p!=null&&k(e,["parameters","pubsubTopic"],p);const g=v(n,["negativePrompt"]);e!==void 0&&g!=null&&k(e,["parameters","negativePrompt"],g);const b=v(n,["enhancePrompt"]);e!==void 0&&b!=null&&k(e,["parameters","enhancePrompt"],b);const w=v(n,["generateAudio"]);e!==void 0&&w!=null&&k(e,["parameters","generateAudio"],w);const S=v(n,["lastFrame"]);e!==void 0&&S!=null&&k(e,["instances[0]","lastFrame"],Go(S));const N=v(n,["referenceImages"]);if(e!==void 0&&N!=null){let R=N;Array.isArray(R)&&(R=R.map(_=>d9(_))),k(e,["instances[0]","referenceImages"],R)}const C=v(n,["mask"]);e!==void 0&&C!=null&&k(e,["instances[0]","mask"],l9(C));const M=v(n,["compressionQuality"]);return e!==void 0&&M!=null&&k(e,["parameters","compressionQuality"],M),t}function cq(n){const e={},t=v(n,["name"]);t!=null&&k(e,["name"],t);const s=v(n,["metadata"]);s!=null&&k(e,["metadata"],s);const i=v(n,["done"]);i!=null&&k(e,["done"],i);const r=v(n,["error"]);r!=null&&k(e,["error"],r);const o=v(n,["response","generateVideoResponse"]);return o!=null&&k(e,["response"],fq(o)),e}function dq(n){const e={},t=v(n,["name"]);t!=null&&k(e,["name"],t);const s=v(n,["metadata"]);s!=null&&k(e,["metadata"],s);const i=v(n,["done"]);i!=null&&k(e,["done"],i);const r=v(n,["error"]);r!=null&&k(e,["error"],r);const o=v(n,["response"]);return o!=null&&k(e,["response"],pq(o)),e}function uq(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["prompt"]);i!=null&&k(t,["instances[0]","prompt"],i);const r=v(e,["image"]);r!=null&&k(t,["instances[0]","image"],kS(r));const o=v(e,["video"]);o!=null&&k(t,["instances[0]","video"],e3(o));const a=v(e,["source"]);a!=null&&mq(a,t);const l=v(e,["config"]);return l!=null&&aq(l,t),t}function hq(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["prompt"]);i!=null&&k(t,["instances[0]","prompt"],i);const r=v(e,["image"]);r!=null&&k(t,["instances[0]","image"],Go(r));const o=v(e,["video"]);o!=null&&k(t,["instances[0]","video"],t3(o));const a=v(e,["source"]);a!=null&&gq(a,t);const l=v(e,["config"]);return l!=null&&lq(l,t),t}function fq(n){const e={},t=v(n,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>yq(o))),k(e,["generatedVideos"],r)}const s=v(n,["raiMediaFilteredCount"]);s!=null&&k(e,["raiMediaFilteredCount"],s);const i=v(n,["raiMediaFilteredReasons"]);return i!=null&&k(e,["raiMediaFilteredReasons"],i),e}function pq(n){const e={},t=v(n,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>vq(o))),k(e,["generatedVideos"],r)}const s=v(n,["raiMediaFilteredCount"]);s!=null&&k(e,["raiMediaFilteredCount"],s);const i=v(n,["raiMediaFilteredReasons"]);return i!=null&&k(e,["raiMediaFilteredReasons"],i),e}function mq(n,e){const t={},s=v(n,["prompt"]);e!==void 0&&s!=null&&k(e,["instances[0]","prompt"],s);const i=v(n,["image"]);e!==void 0&&i!=null&&k(e,["instances[0]","image"],kS(i));const r=v(n,["video"]);return e!==void 0&&r!=null&&k(e,["instances[0]","video"],e3(r)),t}function gq(n,e){const t={},s=v(n,["prompt"]);e!==void 0&&s!=null&&k(e,["instances[0]","prompt"],s);const i=v(n,["image"]);e!==void 0&&i!=null&&k(e,["instances[0]","image"],Go(i));const r=v(n,["video"]);return e!==void 0&&r!=null&&k(e,["instances[0]","video"],t3(r)),t}function xq(n){const e={},t=v(n,["_self"]);t!=null&&k(e,["image"],Tq(t));const s=v(n,["raiFilteredReason"]);s!=null&&k(e,["raiFilteredReason"],s);const i=v(n,["_self"]);return i!=null&&k(e,["safetyAttributes"],XO(i)),e}function wS(n){const e={},t=v(n,["_self"]);t!=null&&k(e,["image"],JO(t));const s=v(n,["raiFilteredReason"]);s!=null&&k(e,["raiFilteredReason"],s);const i=v(n,["_self"]);i!=null&&k(e,["safetyAttributes"],QO(i));const r=v(n,["prompt"]);return r!=null&&k(e,["enhancedPrompt"],r),e}function bq(n){const e={},t=v(n,["_self"]);t!=null&&k(e,["mask"],JO(t));const s=v(n,["labels"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),k(e,["labels"],i)}return e}function yq(n){const e={},t=v(n,["video"]);return t!=null&&k(e,["video"],o9(t)),e}function vq(n){const e={},t=v(n,["_self"]);return t!=null&&k(e,["video"],a9(t)),e}function wq(n){const e={},t=v(n,["modelSelectionConfig"]);t!=null&&k(e,["modelConfig"],t);const s=v(n,["responseJsonSchema"]);s!=null&&k(e,["responseJsonSchema"],s);const i=v(n,["audioTimestamp"]);i!=null&&k(e,["audioTimestamp"],i);const r=v(n,["candidateCount"]);r!=null&&k(e,["candidateCount"],r);const o=v(n,["enableAffectiveDialog"]);o!=null&&k(e,["enableAffectiveDialog"],o);const a=v(n,["frequencyPenalty"]);a!=null&&k(e,["frequencyPenalty"],a);const l=v(n,["logprobs"]);l!=null&&k(e,["logprobs"],l);const u=v(n,["maxOutputTokens"]);u!=null&&k(e,["maxOutputTokens"],u);const f=v(n,["mediaResolution"]);f!=null&&k(e,["mediaResolution"],f);const p=v(n,["presencePenalty"]);p!=null&&k(e,["presencePenalty"],p);const g=v(n,["responseLogprobs"]);g!=null&&k(e,["responseLogprobs"],g);const b=v(n,["responseMimeType"]);b!=null&&k(e,["responseMimeType"],b);const w=v(n,["responseModalities"]);w!=null&&k(e,["responseModalities"],w);const S=v(n,["responseSchema"]);S!=null&&k(e,["responseSchema"],S);const N=v(n,["routingConfig"]);N!=null&&k(e,["routingConfig"],N);const C=v(n,["seed"]);C!=null&&k(e,["seed"],C);const M=v(n,["speechConfig"]);M!=null&&k(e,["speechConfig"],M);const R=v(n,["stopSequences"]);R!=null&&k(e,["stopSequences"],R);const _=v(n,["temperature"]);_!=null&&k(e,["temperature"],_);const j=v(n,["thinkingConfig"]);j!=null&&k(e,["thinkingConfig"],j);const P=v(n,["topK"]);P!=null&&k(e,["topK"],P);const D=v(n,["topP"]);if(D!=null&&k(e,["topP"],D),v(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function kq(n,e){const t={},s=v(e,["model"]);return s!=null&&k(t,["_url","name"],Jt(n,s)),t}function Sq(n,e){const t={},s=v(e,["model"]);return s!=null&&k(t,["_url","name"],Jt(n,s)),t}function Cq(n){const e={};if(v(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(n,["enableWidget"]);return t!=null&&k(e,["enableWidget"],t),e}function Aq(n){const e={};if(v(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(n,["timeRangeFilter"]);return t!=null&&k(e,["timeRangeFilter"],t),e}function Nq(n){const e={},t=v(n,["aspectRatio"]);t!=null&&k(e,["aspectRatio"],t);const s=v(n,["imageSize"]);if(s!=null&&k(e,["imageSize"],s),v(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(v(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function Eq(n){const e={},t=v(n,["aspectRatio"]);t!=null&&k(e,["aspectRatio"],t);const s=v(n,["imageSize"]);s!=null&&k(e,["imageSize"],s);const i=v(n,["outputMimeType"]);i!=null&&k(e,["imageOutputOptions","mimeType"],i);const r=v(n,["outputCompressionQuality"]);return r!=null&&k(e,["imageOutputOptions","compressionQuality"],r),e}function Tq(n){const e={},t=v(n,["bytesBase64Encoded"]);t!=null&&k(e,["imageBytes"],Ud(t));const s=v(n,["mimeType"]);return s!=null&&k(e,["mimeType"],s),e}function JO(n){const e={},t=v(n,["gcsUri"]);t!=null&&k(e,["gcsUri"],t);const s=v(n,["bytesBase64Encoded"]);s!=null&&k(e,["imageBytes"],Ud(s));const i=v(n,["mimeType"]);return i!=null&&k(e,["mimeType"],i),e}function kS(n){const e={};if(v(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=v(n,["imageBytes"]);t!=null&&k(e,["bytesBase64Encoded"],Ud(t));const s=v(n,["mimeType"]);return s!=null&&k(e,["mimeType"],s),e}function Go(n){const e={},t=v(n,["gcsUri"]);t!=null&&k(e,["gcsUri"],t);const s=v(n,["imageBytes"]);s!=null&&k(e,["bytesBase64Encoded"],Ud(s));const i=v(n,["mimeType"]);return i!=null&&k(e,["mimeType"],i),e}function _q(n,e,t){const s={},i=v(e,["pageSize"]);t!==void 0&&i!=null&&k(t,["_query","pageSize"],i);const r=v(e,["pageToken"]);t!==void 0&&r!=null&&k(t,["_query","pageToken"],r);const o=v(e,["filter"]);t!==void 0&&o!=null&&k(t,["_query","filter"],o);const a=v(e,["queryBase"]);return t!==void 0&&a!=null&&k(t,["_url","models_url"],$O(n,a)),s}function Mq(n,e,t){const s={},i=v(e,["pageSize"]);t!==void 0&&i!=null&&k(t,["_query","pageSize"],i);const r=v(e,["pageToken"]);t!==void 0&&r!=null&&k(t,["_query","pageToken"],r);const o=v(e,["filter"]);t!==void 0&&o!=null&&k(t,["_query","filter"],o);const a=v(e,["queryBase"]);return t!==void 0&&a!=null&&k(t,["_url","models_url"],$O(n,a)),s}function Rq(n,e){const t={},s=v(e,["config"]);return s!=null&&_q(n,s,t),t}function Iq(n,e){const t={},s=v(e,["config"]);return s!=null&&Mq(n,s,t),t}function zq(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&k(e,["nextPageToken"],s);const i=v(n,["_self"]);if(i!=null){let r=GO(i);Array.isArray(r)&&(r=r.map(o=>EN(o))),k(e,["models"],r)}return e}function Dq(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&k(e,["nextPageToken"],s);const i=v(n,["_self"]);if(i!=null){let r=GO(i);Array.isArray(r)&&(r=r.map(o=>TN(o))),k(e,["models"],r)}return e}function jq(n){const e={},t=v(n,["maskMode"]);t!=null&&k(e,["maskMode"],t);const s=v(n,["segmentationClasses"]);s!=null&&k(e,["maskClasses"],s);const i=v(n,["maskDilation"]);return i!=null&&k(e,["dilation"],i),e}function EN(n){const e={},t=v(n,["name"]);t!=null&&k(e,["name"],t);const s=v(n,["displayName"]);s!=null&&k(e,["displayName"],s);const i=v(n,["description"]);i!=null&&k(e,["description"],i);const r=v(n,["version"]);r!=null&&k(e,["version"],r);const o=v(n,["_self"]);o!=null&&k(e,["tunedModelInfo"],Xq(o));const a=v(n,["inputTokenLimit"]);a!=null&&k(e,["inputTokenLimit"],a);const l=v(n,["outputTokenLimit"]);l!=null&&k(e,["outputTokenLimit"],l);const u=v(n,["supportedGenerationMethods"]);u!=null&&k(e,["supportedActions"],u);const f=v(n,["temperature"]);f!=null&&k(e,["temperature"],f);const p=v(n,["maxTemperature"]);p!=null&&k(e,["maxTemperature"],p);const g=v(n,["topP"]);g!=null&&k(e,["topP"],g);const b=v(n,["topK"]);b!=null&&k(e,["topK"],b);const w=v(n,["thinking"]);return w!=null&&k(e,["thinking"],w),e}function TN(n){const e={},t=v(n,["name"]);t!=null&&k(e,["name"],t);const s=v(n,["displayName"]);s!=null&&k(e,["displayName"],s);const i=v(n,["description"]);i!=null&&k(e,["description"],i);const r=v(n,["versionId"]);r!=null&&k(e,["version"],r);const o=v(n,["deployedModels"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(g=>K7(g))),k(e,["endpoints"],p)}const a=v(n,["labels"]);a!=null&&k(e,["labels"],a);const l=v(n,["_self"]);l!=null&&k(e,["tunedModelInfo"],Qq(l));const u=v(n,["defaultCheckpointId"]);u!=null&&k(e,["defaultCheckpointId"],u);const f=v(n,["checkpoints"]);if(f!=null){let p=f;Array.isArray(p)&&(p=p.map(g=>g)),k(e,["checkpoints"],p)}return e}function Pq(n){const e={},t=v(n,["mediaResolution"]);t!=null&&k(e,["mediaResolution"],t);const s=v(n,["codeExecutionResult"]);s!=null&&k(e,["codeExecutionResult"],s);const i=v(n,["executableCode"]);i!=null&&k(e,["executableCode"],i);const r=v(n,["fileData"]);r!=null&&k(e,["fileData"],Y7(r));const o=v(n,["functionCall"]);o!=null&&k(e,["functionCall"],J7(o));const a=v(n,["functionResponse"]);a!=null&&k(e,["functionResponse"],a);const l=v(n,["inlineData"]);l!=null&&k(e,["inlineData"],w7(l));const u=v(n,["text"]);u!=null&&k(e,["text"],u);const f=v(n,["thought"]);f!=null&&k(e,["thought"],f);const p=v(n,["thoughtSignature"]);p!=null&&k(e,["thoughtSignature"],p);const g=v(n,["videoMetadata"]);return g!=null&&k(e,["videoMetadata"],g),e}function Lq(n){const e={},t=v(n,["productImage"]);return t!=null&&k(e,["image"],Go(t)),e}function Oq(n,e){const t={},s=v(n,["numberOfImages"]);e!==void 0&&s!=null&&k(e,["parameters","sampleCount"],s);const i=v(n,["baseSteps"]);e!==void 0&&i!=null&&k(e,["parameters","baseSteps"],i);const r=v(n,["outputGcsUri"]);e!==void 0&&r!=null&&k(e,["parameters","storageUri"],r);const o=v(n,["seed"]);e!==void 0&&o!=null&&k(e,["parameters","seed"],o);const a=v(n,["safetyFilterLevel"]);e!==void 0&&a!=null&&k(e,["parameters","safetySetting"],a);const l=v(n,["personGeneration"]);e!==void 0&&l!=null&&k(e,["parameters","personGeneration"],l);const u=v(n,["addWatermark"]);e!==void 0&&u!=null&&k(e,["parameters","addWatermark"],u);const f=v(n,["outputMimeType"]);e!==void 0&&f!=null&&k(e,["parameters","outputOptions","mimeType"],f);const p=v(n,["outputCompressionQuality"]);e!==void 0&&p!=null&&k(e,["parameters","outputOptions","compressionQuality"],p);const g=v(n,["enhancePrompt"]);e!==void 0&&g!=null&&k(e,["parameters","enhancePrompt"],g);const b=v(n,["labels"]);return e!==void 0&&b!=null&&k(e,["labels"],b),t}function Bq(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["source"]);i!=null&&Hq(i,t);const r=v(e,["config"]);return r!=null&&Oq(r,t),t}function Fq(n){const e={},t=v(n,["predictions"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>wS(i))),k(e,["generatedImages"],s)}return e}function Hq(n,e){const t={},s=v(n,["prompt"]);e!==void 0&&s!=null&&k(e,["instances[0]","prompt"],s);const i=v(n,["personImage"]);e!==void 0&&i!=null&&k(e,["instances[0]","personImage","image"],Go(i));const r=v(n,["productImages"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>Lq(a))),k(e,["instances[0]","productImages"],o)}return t}function Uq(n){const e={},t=v(n,["referenceImage"]);t!=null&&k(e,["referenceImage"],Go(t));const s=v(n,["referenceId"]);s!=null&&k(e,["referenceId"],s);const i=v(n,["referenceType"]);i!=null&&k(e,["referenceType"],i);const r=v(n,["maskImageConfig"]);r!=null&&k(e,["maskImageConfig"],jq(r));const o=v(n,["controlImageConfig"]);o!=null&&k(e,["controlImageConfig"],T7(o));const a=v(n,["styleImageConfig"]);a!=null&&k(e,["styleImageConfig"],a);const l=v(n,["subjectImageConfig"]);return l!=null&&k(e,["subjectImageConfig"],l),e}function XO(n){const e={},t=v(n,["safetyAttributes","categories"]);t!=null&&k(e,["categories"],t);const s=v(n,["safetyAttributes","scores"]);s!=null&&k(e,["scores"],s);const i=v(n,["contentType"]);return i!=null&&k(e,["contentType"],i),e}function QO(n){const e={},t=v(n,["safetyAttributes","categories"]);t!=null&&k(e,["categories"],t);const s=v(n,["safetyAttributes","scores"]);s!=null&&k(e,["scores"],s);const i=v(n,["contentType"]);return i!=null&&k(e,["contentType"],i),e}function $q(n){const e={},t=v(n,["category"]);if(t!=null&&k(e,["category"],t),v(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=v(n,["threshold"]);return s!=null&&k(e,["threshold"],s),e}function Gq(n){const e={},t=v(n,["image"]);return t!=null&&k(e,["image"],Go(t)),e}function Vq(n,e){const t={},s=v(n,["mode"]);e!==void 0&&s!=null&&k(e,["parameters","mode"],s);const i=v(n,["maxPredictions"]);e!==void 0&&i!=null&&k(e,["parameters","maxPredictions"],i);const r=v(n,["confidenceThreshold"]);e!==void 0&&r!=null&&k(e,["parameters","confidenceThreshold"],r);const o=v(n,["maskDilation"]);e!==void 0&&o!=null&&k(e,["parameters","maskDilation"],o);const a=v(n,["binaryColorThreshold"]);e!==void 0&&a!=null&&k(e,["parameters","binaryColorThreshold"],a);const l=v(n,["labels"]);return e!==void 0&&l!=null&&k(e,["labels"],l),t}function qq(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["source"]);i!=null&&Kq(i,t);const r=v(e,["config"]);return r!=null&&Vq(r,t),t}function Wq(n){const e={},t=v(n,["predictions"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>bq(i))),k(e,["generatedMasks"],s)}return e}function Kq(n,e){const t={},s=v(n,["prompt"]);e!==void 0&&s!=null&&k(e,["instances[0]","prompt"],s);const i=v(n,["image"]);e!==void 0&&i!=null&&k(e,["instances[0]","image"],Go(i));const r=v(n,["scribbleImage"]);return e!==void 0&&r!=null&&k(e,["instances[0]","scribble"],Gq(r)),t}function Yq(n){const e={},t=v(n,["functionCallingConfig"]);t!=null&&k(e,["functionCallingConfig"],X7(t));const s=v(n,["retrievalConfig"]);return s!=null&&k(e,["retrievalConfig"],s),e}function Jq(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>p)),k(e,["functionDeclarations"],f)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=v(n,["googleSearchRetrieval"]);s!=null&&k(e,["googleSearchRetrieval"],s);const i=v(n,["computerUse"]);i!=null&&k(e,["computerUse"],i);const r=v(n,["fileSearch"]);r!=null&&k(e,["fileSearch"],r);const o=v(n,["codeExecution"]);if(o!=null&&k(e,["codeExecution"],o),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=v(n,["googleMaps"]);a!=null&&k(e,["googleMaps"],Cq(a));const l=v(n,["googleSearch"]);l!=null&&k(e,["googleSearch"],Aq(l));const u=v(n,["urlContext"]);return u!=null&&k(e,["urlContext"],u),e}function ZO(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let p=t;Array.isArray(p)&&(p=p.map(g=>Q7(g))),k(e,["functionDeclarations"],p)}const s=v(n,["retrieval"]);s!=null&&k(e,["retrieval"],s);const i=v(n,["googleSearchRetrieval"]);i!=null&&k(e,["googleSearchRetrieval"],i);const r=v(n,["computerUse"]);if(r!=null&&k(e,["computerUse"],r),v(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=v(n,["codeExecution"]);o!=null&&k(e,["codeExecution"],o);const a=v(n,["enterpriseWebSearch"]);a!=null&&k(e,["enterpriseWebSearch"],a);const l=v(n,["googleMaps"]);l!=null&&k(e,["googleMaps"],l);const u=v(n,["googleSearch"]);u!=null&&k(e,["googleSearch"],u);const f=v(n,["urlContext"]);return f!=null&&k(e,["urlContext"],f),e}function Xq(n){const e={},t=v(n,["baseModel"]);t!=null&&k(e,["baseModel"],t);const s=v(n,["createTime"]);s!=null&&k(e,["createTime"],s);const i=v(n,["updateTime"]);return i!=null&&k(e,["updateTime"],i),e}function Qq(n){const e={},t=v(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&k(e,["baseModel"],t);const s=v(n,["createTime"]);s!=null&&k(e,["createTime"],s);const i=v(n,["updateTime"]);return i!=null&&k(e,["updateTime"],i),e}function Zq(n,e){const t={},s=v(n,["displayName"]);e!==void 0&&s!=null&&k(e,["displayName"],s);const i=v(n,["description"]);e!==void 0&&i!=null&&k(e,["description"],i);const r=v(n,["defaultCheckpointId"]);return e!==void 0&&r!=null&&k(e,["defaultCheckpointId"],r),t}function e9(n,e){const t={},s=v(n,["displayName"]);e!==void 0&&s!=null&&k(e,["displayName"],s);const i=v(n,["description"]);e!==void 0&&i!=null&&k(e,["description"],i);const r=v(n,["defaultCheckpointId"]);return e!==void 0&&r!=null&&k(e,["defaultCheckpointId"],r),t}function t9(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","name"],Jt(n,s));const i=v(e,["config"]);return i!=null&&Zq(i,t),t}function n9(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["config"]);return i!=null&&e9(i,t),t}function s9(n,e){const t={},s=v(n,["outputGcsUri"]);e!==void 0&&s!=null&&k(e,["parameters","storageUri"],s);const i=v(n,["safetyFilterLevel"]);e!==void 0&&i!=null&&k(e,["parameters","safetySetting"],i);const r=v(n,["personGeneration"]);e!==void 0&&r!=null&&k(e,["parameters","personGeneration"],r);const o=v(n,["includeRaiReason"]);e!==void 0&&o!=null&&k(e,["parameters","includeRaiReason"],o);const a=v(n,["outputMimeType"]);e!==void 0&&a!=null&&k(e,["parameters","outputOptions","mimeType"],a);const l=v(n,["outputCompressionQuality"]);e!==void 0&&l!=null&&k(e,["parameters","outputOptions","compressionQuality"],l);const u=v(n,["enhanceInputImage"]);e!==void 0&&u!=null&&k(e,["parameters","upscaleConfig","enhanceInputImage"],u);const f=v(n,["imagePreservationFactor"]);e!==void 0&&f!=null&&k(e,["parameters","upscaleConfig","imagePreservationFactor"],f);const p=v(n,["labels"]);e!==void 0&&p!=null&&k(e,["labels"],p);const g=v(n,["numberOfImages"]);e!==void 0&&g!=null&&k(e,["parameters","sampleCount"],g);const b=v(n,["mode"]);return e!==void 0&&b!=null&&k(e,["parameters","mode"],b),t}function i9(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["_url","model"],Jt(n,s));const i=v(e,["image"]);i!=null&&k(t,["instances[0]","image"],Go(i));const r=v(e,["upscaleFactor"]);r!=null&&k(t,["parameters","upscaleConfig","upscaleFactor"],r);const o=v(e,["config"]);return o!=null&&s9(o,t),t}function r9(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>wS(r))),k(e,["generatedImages"],i)}return e}function o9(n){const e={},t=v(n,["uri"]);t!=null&&k(e,["uri"],t);const s=v(n,["encodedVideo"]);s!=null&&k(e,["videoBytes"],Ud(s));const i=v(n,["encoding"]);return i!=null&&k(e,["mimeType"],i),e}function a9(n){const e={},t=v(n,["gcsUri"]);t!=null&&k(e,["uri"],t);const s=v(n,["bytesBase64Encoded"]);s!=null&&k(e,["videoBytes"],Ud(s));const i=v(n,["mimeType"]);return i!=null&&k(e,["mimeType"],i),e}function l9(n){const e={},t=v(n,["image"]);t!=null&&k(e,["_self"],Go(t));const s=v(n,["maskMode"]);return s!=null&&k(e,["maskMode"],s),e}function c9(n){const e={},t=v(n,["image"]);t!=null&&k(e,["image"],kS(t));const s=v(n,["referenceType"]);return s!=null&&k(e,["referenceType"],s),e}function d9(n){const e={},t=v(n,["image"]);t!=null&&k(e,["image"],Go(t));const s=v(n,["referenceType"]);return s!=null&&k(e,["referenceType"],s),e}function e3(n){const e={},t=v(n,["uri"]);t!=null&&k(e,["uri"],t);const s=v(n,["videoBytes"]);s!=null&&k(e,["encodedVideo"],Ud(s));const i=v(n,["mimeType"]);return i!=null&&k(e,["encoding"],i),e}function t3(n){const e={},t=v(n,["uri"]);t!=null&&k(e,["gcsUri"],t);const s=v(n,["videoBytes"]);s!=null&&k(e,["bytesBase64Encoded"],Ud(s));const i=v(n,["mimeType"]);return i!=null&&k(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function u9(n,e){const t={},s=v(n,["displayName"]);return e!==void 0&&s!=null&&k(e,["displayName"],s),t}function h9(n){const e={},t=v(n,["config"]);return t!=null&&u9(t,e),e}function f9(n,e){const t={},s=v(n,["force"]);return e!==void 0&&s!=null&&k(e,["_query","force"],s),t}function p9(n){const e={},t=v(n,["name"]);t!=null&&k(e,["_url","name"],t);const s=v(n,["config"]);return s!=null&&f9(s,e),e}function m9(n){const e={},t=v(n,["name"]);return t!=null&&k(e,["_url","name"],t),e}function g9(n,e){const t={},s=v(n,["customMetadata"]);if(e!==void 0&&s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),k(e,["customMetadata"],r)}const i=v(n,["chunkingConfig"]);return e!==void 0&&i!=null&&k(e,["chunkingConfig"],i),t}function x9(n){const e={},t=v(n,["name"]);t!=null&&k(e,["name"],t);const s=v(n,["metadata"]);s!=null&&k(e,["metadata"],s);const i=v(n,["done"]);i!=null&&k(e,["done"],i);const r=v(n,["error"]);r!=null&&k(e,["error"],r);const o=v(n,["response"]);return o!=null&&k(e,["response"],y9(o)),e}function b9(n){const e={},t=v(n,["fileSearchStoreName"]);t!=null&&k(e,["_url","file_search_store_name"],t);const s=v(n,["fileName"]);s!=null&&k(e,["fileName"],s);const i=v(n,["config"]);return i!=null&&g9(i,e),e}function y9(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["parent"]);s!=null&&k(e,["parent"],s);const i=v(n,["documentName"]);return i!=null&&k(e,["documentName"],i),e}function v9(n,e){const t={},s=v(n,["pageSize"]);e!==void 0&&s!=null&&k(e,["_query","pageSize"],s);const i=v(n,["pageToken"]);return e!==void 0&&i!=null&&k(e,["_query","pageToken"],i),t}function w9(n){const e={},t=v(n,["config"]);return t!=null&&v9(t,e),e}function k9(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&k(e,["nextPageToken"],s);const i=v(n,["fileSearchStores"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),k(e,["fileSearchStores"],r)}return e}function n3(n,e){const t={},s=v(n,["mimeType"]);e!==void 0&&s!=null&&k(e,["mimeType"],s);const i=v(n,["displayName"]);e!==void 0&&i!=null&&k(e,["displayName"],i);const r=v(n,["customMetadata"]);if(e!==void 0&&r!=null){let a=r;Array.isArray(a)&&(a=a.map(l=>l)),k(e,["customMetadata"],a)}const o=v(n,["chunkingConfig"]);return e!==void 0&&o!=null&&k(e,["chunkingConfig"],o),t}function S9(n){const e={},t=v(n,["fileSearchStoreName"]);t!=null&&k(e,["_url","file_search_store_name"],t);const s=v(n,["config"]);return s!=null&&n3(s,e),e}function C9(n){const e={},t=v(n,["sdkHttpResponse"]);return t!=null&&k(e,["sdkHttpResponse"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const A9="Content-Type",N9="X-Server-Timeout",E9="User-Agent",_N="x-goog-api-client",T9="1.34.0",_9=`google-genai-sdk/${T9}`,M9="v1beta1",R9="v1beta";class I9{constructor(e){var t,s;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:M9,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:R9,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const s=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&s.push(e.apiVersion),s.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,s){const i=[this.getRequestUrlInternal(t)];return s&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,s);if(e.queryParams)for(const[o,a]of Object.entries(e.queryParams))i.searchParams.append(o,String(a));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,i.toString(),e.abortSignal),this.unaryApiCall(i,r,e.httpMethod)}patchHttpOptions(e,t){const s=JSON.parse(JSON.stringify(e));for(const[i,r]of Object.entries(t))typeof r=="object"?s[i]=Object.assign(Object.assign({},s[i]),r):r!==void 0&&(s[i]=r);return s}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,s);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,i.toString(),e.abortSignal),this.streamApiCall(i,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,s,i){if(t&&t.timeout||i){const r=new AbortController,o=r.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){const a=setTimeout(()=>r.abort(),t.timeout);a&&typeof a.unref=="function"&&a.unref()}i&&i.addEventListener("abort",()=>{r.abort()}),e.signal=o}return t&&t.extraBody!==null&&z9(e,t.extraBody),e.headers=await this.getHeadersInternal(t,s),e}async unaryApiCall(e,t,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:s})).then(async i=>(await gj(i),new CN(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,t,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:s})).then(async i=>(await gj(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){return Fo(this,arguments,function*(){var s;const i=(s=e==null?void 0:e.body)===null||s===void 0?void 0:s.getReader(),r=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let o="";const a="data:",l=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:u,value:f}=yield xt(i.read());if(u){if(o.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const p=r.decode(f,{stream:!0});try{const w=JSON.parse(p);if("error"in w){const S=JSON.parse(JSON.stringify(w.error)),N=S.status,C=S.code,M=`got status: ${N}. ${JSON.stringify(w)}`;if(C>=400&&C<600)throw new yS({message:M,status:C})}}catch(w){if(w.name==="ApiError")throw w}o+=p;let g=-1,b=0;for(;;){g=-1,b=0;for(const N of l){const C=o.indexOf(N);C!==-1&&(g===-1||C<g)&&(g=C,b=N.length)}if(g===-1)break;const w=o.substring(0,g);o=o.substring(g+b);const S=w.trim();if(S.startsWith(a)){const N=S.substring(a.length).trim();try{const C=new Response(N,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield xt(new CN(C))}catch(C){throw new Error(`exception parsing stream chunk ${N}. ${C}`)}}}}}finally{i.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(s=>{throw new Error(`exception ${s} sending request`)})}getDefaultHeaders(){const e={},t=_9+" "+this.clientOptions.userAgentExtra;return e[E9]=t,e[_N]=t,e[A9]="application/json",e}async getHeadersInternal(e,t){const s=new Headers;if(e&&e.headers){for(const[i,r]of Object.entries(e.headers))s.append(i,r);e.timeout&&e.timeout>0&&s.append(N9,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(s,t),s}getFileName(e){var t;let s="";return typeof e=="string"&&(s=e.replace(/[/\\]+$/,""),s=(t=s.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),s}async uploadFile(e,t){var s;const i={};t!=null&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const r=this.clientOptions.uploader,o=await r.stat(e);i.sizeBytes=String(o.size);const a=(s=t==null?void 0:t.mimeType)!==null&&s!==void 0?s:o.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=a;const l={file:i},u=this.getFileName(e),f=Ye("upload/v1beta/files",l._url),p=await this.fetchUploadUrl(f,i.sizeBytes,i.mimeType,u,l,t==null?void 0:t.httpOptions);return r.upload(e,p,this)}async uploadFileToFileSearchStore(e,t,s){var i;const r=this.clientOptions.uploader,o=await r.stat(t),a=String(o.size),l=(i=s==null?void 0:s.mimeType)!==null&&i!==void 0?i:o.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const u=`upload/v1beta/${e}:uploadToFileSearchStore`,f=this.getFileName(t),p={};s!=null&&n3(s,p);const g=await this.fetchUploadUrl(u,a,l,f,p,s==null?void 0:s.httpOptions);return r.uploadToFileSearchStore(t,g,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,s,i,r,o){var a;let l={};o?l=o:l={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${s}`},i?{"X-Goog-Upload-File-Name":i}:{})};const u=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:l});if(!u||!(u!=null&&u.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const f=(a=u==null?void 0:u.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(f===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return f}}async function gj(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let s;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?s=await n.json():s={error:{message:await n.text(),code:n.status,status:n.statusText}};const i=JSON.stringify(s);throw t>=400&&t<600?new yS({message:i,status:t}):new Error(i)}}function z9(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const r=JSON.parse(n.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))t=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function s(r,o){const a=Object.assign({},r);for(const l in o)if(Object.prototype.hasOwnProperty.call(o,l)){const u=o[l],f=a[l];u&&typeof u=="object"&&!Array.isArray(u)&&f&&typeof f=="object"&&!Array.isArray(f)?a[l]=s(f,u):(f&&u&&typeof f!=typeof u&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${l}". Original type: ${typeof f}, New type: ${typeof u}. Overwriting.`),a[l]=u)}return a}const i=s(t,e);n.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const D9="mcp_used/unknown";let j9=!1;function s3(n){for(const e of n)if(P9(e)||typeof e=="object"&&"inputSchema"in e)return!0;return j9}function i3(n){var e;const t=(e=n[_N])!==null&&e!==void 0?e:"";n[_N]=(t+` ${D9}`).trimStart()}function P9(n){return n!==null&&typeof n=="object"&&n instanceof c_}function L9(n){return Fo(this,arguments,function*(t,s=100){let i,r=0;for(;r<s;){const o=yield xt(t.listTools({cursor:i}));for(const a of o.tools)yield yield xt(a),r++;if(!o.nextCursor)break;i=o.nextCursor}})}class c_{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new c_(e,t)}async initialize(){var e,t,s,i;if(this.mcpTools.length>0)return;const r={},o=[];for(const f of this.mcpClients)try{for(var a=!0,l=(t=void 0,Ho(L9(f))),u;u=await l.next(),e=u.done,!e;a=!0){i=u.value,a=!1;const p=i;o.push(p);const g=p.name;if(r[g])throw new Error(`Duplicate function name ${g} found in MCP tools. Please ensure function names are unique.`);r[g]=f}}catch(p){t={error:p}}finally{try{!a&&!e&&(s=l.return)&&await s.call(l)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),mG(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const s of e)if(s.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[s.name];let r;this.config.timeout&&(r={timeout:this.config.timeout});const o=await i.callTool({name:s.name,arguments:s.args},void 0,r);t.push({functionResponse:{name:s.name,response:o.isError?{error:o}:o}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function O9(n,e,t){const s=new aG;let i;t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data),Object.assign(s,i),e(s)}class B9{constructor(e,t,s){this.apiClient=e,this.auth=t,this.webSocketFactory=s}async connect(e){var t,s;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),o=U9(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${i}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${a}`;let u=()=>{};const f=new Promise(R=>{u=R}),p=e.callbacks,g=function(){u({})},b=this.apiClient,w={onopen:g,onmessage:R=>{O9(b,p.onmessage,R)},onerror:(t=p==null?void 0:p.onerror)!==null&&t!==void 0?t:function(R){},onclose:(s=p==null?void 0:p.onclose)!==null&&s!==void 0?s:function(R){}},S=this.webSocketFactory.create(l,H9(o),w);S.connect(),await f;const M={setup:{model:Jt(this.apiClient,e.model)}};return S.send(JSON.stringify(M)),new F9(S,this.apiClient)}}class F9{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=h7(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=u7(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){const t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(lp.PLAY)}pause(){this.sendPlaybackControl(lp.PAUSE)}stop(){this.sendPlaybackControl(lp.STOP)}resetContext(){this.sendPlaybackControl(lp.RESET_CONTEXT)}close(){this.conn.close()}}function H9(n){const e={};return n.forEach((t,s)=>{e[s]=t}),e}function U9(n){const e=new Headers;for(const[t,s]of Object.entries(n))e.append(t,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const $9="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function G9(n,e,t){const s=new oG;let i;t.data instanceof Blob?i=await t.data.text():t.data instanceof ArrayBuffer?i=new TextDecoder().decode(t.data):i=t.data;const r=JSON.parse(i);if(n.isVertexAI()){const o=m7(r);Object.assign(s,o)}else Object.assign(s,r);e(s)}class V9{constructor(e,t,s){this.apiClient=e,this.auth=t,this.webSocketFactory=s,this.music=new B9(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,s,i,r,o,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const l=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion();let f;const p=this.apiClient.getHeaders();e.config&&e.config.tools&&s3(e.config.tools)&&i3(p);const g=Y9(p);if(this.apiClient.isVertexAI())f=`${l}/ws/google.cloud.aiplatform.${u}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g,f);else{const V=this.apiClient.getApiKey();let q="BidiGenerateContent",G="key";V!=null&&V.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),u!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),q="BidiGenerateContentConstrained",G="access_token"),f=`${l}/ws/google.ai.generativelanguage.${u}.GenerativeService.${q}?${G}=${V}`}let b=()=>{};const w=new Promise(V=>{b=V}),S=e.callbacks,N=function(){var V;(V=S==null?void 0:S.onopen)===null||V===void 0||V.call(S),b({})},C=this.apiClient,M={onopen:N,onmessage:V=>{G9(C,S.onmessage,V)},onerror:(t=S==null?void 0:S.onerror)!==null&&t!==void 0?t:function(V){},onclose:(s=S==null?void 0:S.onclose)!==null&&s!==void 0?s:function(V){}},R=this.webSocketFactory.create(f,K9(g),M);R.connect(),await w;let _=Jt(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&_.startsWith("publishers/")){const V=this.apiClient.getProject(),q=this.apiClient.getLocation();_=`projects/${V}/locations/${q}/`+_}let j={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[H0.AUDIO]}:e.config.responseModalities=[H0.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const P=(a=(o=e.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[],D=[];for(const V of P)if(this.isCallableTool(V)){const q=V;D.push(await q.tool())}else D.push(V);D.length>0&&(e.config.tools=D);const U={model:_,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?j=d7(this.apiClient,U):j=c7(this.apiClient,U),delete j.config,R.send(JSON.stringify(j)),new W9(R,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const q9={turnComplete:!0};class W9{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let s=[];try{s=ao(t.turns),e.isVertexAI()||(s=s.map(i=>vS(i)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:s,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let s=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?s=t.functionResponses:s=[t.functionResponses],s.length===0)throw new Error("functionResponses is required.");for(const r of s){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error($9)}return{toolResponse:{functionResponses:s}}}sendClientContent(e){e=Object.assign(Object.assign({},q9),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:p7(e)}:t={realtimeInput:f7(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function K9(n){const e={};return n.forEach((t,s)=>{e[s]=t}),e}function Y9(n){const e=new Headers;for(const[t,s]of Object.entries(n))e.append(t,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const xj=10;function bj(n){var e,t,s;if(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const o of(t=n==null?void 0:n.tools)!==null&&t!==void 0?t:[])if(mp(o)){i=!0;break}if(!i)return!0;const r=(s=n==null?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function mp(n){return"callTool"in n&&typeof n.callTool=="function"}function J9(n){var e,t,s;return(s=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>mp(i)))!==null&&s!==void 0?s:!1}function yj(n){var e;const t=[];return!((e=n==null?void 0:n.config)===null||e===void 0)&&e.tools&&n.config.tools.forEach((s,i)=>{if(mp(s))return;const r=s;r.functionDeclarations&&r.functionDeclarations.length>0&&t.push(i)}),t}function vj(n){var e;return!(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class X9 extends nc{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var s,i,r,o,a;const l=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!J9(t)||bj(t.config))return await this.generateContentInternal(l);const u=yj(t);if(u.length>0){const S=u.map(N=>`tools[${N}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${S}.`)}let f,p;const g=ao(l.contents),b=(r=(i=(s=l.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&r!==void 0?r:xj;let w=0;for(;w<b&&(f=await this.generateContentInternal(l),!(!f.functionCalls||f.functionCalls.length===0));){const S=f.candidates[0].content,N=[];for(const C of(a=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[])if(mp(C)){const R=await C.callTool(f.functionCalls);N.push(...R)}w++,p={role:"user",parts:N},l.contents=ao(l.contents),l.contents.push(S),l.contents.push(p),vj(l.config)&&(g.push(S),g.push(p))}return vj(l.config)&&(f.automaticFunctionCallingHistory=g),f},this.generateContentStream=async t=>{var s,i,r,o,a;if(this.maybeMoveToResponseJsonSchem(t),bj(t.config)){const p=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(p)}const l=yj(t);if(l.length>0){const p=l.map(g=>`tools[${g}]`).join(", ");throw new Error(`Incompatible tools found at ${p}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const u=(r=(i=(s=t==null?void 0:t.config)===null||s===void 0?void 0:s.toolConfig)===null||i===void 0?void 0:i.functionCallingConfig)===null||r===void 0?void 0:r.streamFunctionCallArguments,f=(a=(o=t==null?void 0:t.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(u&&!f)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(s=>{var i;let r;const o=[];if(s!=null&&s.generatedImages)for(const l of s.generatedImages)l&&(l!=null&&l.safetyAttributes)&&((i=l==null?void 0:l.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?r=l==null?void 0:l.safetyAttributes:o.push(l);let a;return r?a={generatedImages:o,positivePromptSafetyAttributes:r,sdkHttpResponse:s.sdkHttpResponse}:a={generatedImages:o,sdkHttpResponse:s.sdkHttpResponse},a}),this.list=async t=>{var s;const o={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!o.config.queryBase){if(!((s=o.config)===null||s===void 0)&&s.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");o.config.filter="labels.tune-type:*"}return new tf(Jl.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(o),o)},this.editImage=async t=>{const s={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(s.referenceImages=t.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(s)},this.upscaleImage=async t=>{let s={numberOfImages:1,mode:"upscale"};t.config&&(s=Object.assign(Object.assign({},s),t.config));const i={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:s};return await this.upscaleImageInternal(i)},this.generateVideos=async t=>{var s,i,r,o,a,l;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((s=t.video)===null||s===void 0)&&s.uri&&(!((i=t.video)===null||i===void 0)&&i.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((o=(r=t.source)===null||r===void 0?void 0:r.video)===null||o===void 0)&&o.uri&&(!((l=(a=t.source)===null||a===void 0?void 0:a.video)===null||l===void 0)&&l.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,s,i;const r=(t=e.config)===null||t===void 0?void 0:t.tools;if(!r)return e;const o=await Promise.all(r.map(async l=>mp(l)?await l.tool():l)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(a.config.tools=o,e.config&&e.config.tools&&s3(e.config.tools)){const l=(i=(s=e.config.httpOptions)===null||s===void 0?void 0:s.headers)!==null&&i!==void 0?i:{};let u=Object.assign({},l);Object.keys(u).length===0&&(u=this.apiClient.getDefaultHeaders()),i3(u),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:u})}return a}async initAfcToolsMap(e){var t,s,i;const r=new Map;for(const o of(s=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&s!==void 0?s:[])if(mp(o)){const a=o,l=await a.tool();for(const u of(i=l.functionDeclarations)!==null&&i!==void 0?i:[]){if(!u.name)throw new Error("Function declaration name is required.");if(r.has(u.name))throw new Error(`Duplicate tool declaration name: ${u.name}`);r.set(u.name,a)}}return r}async processAfcStream(e){var t,s,i;const r=(i=(s=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&i!==void 0?i:xj;let o=!1,a=0;const l=await this.initAfcToolsMap(e);return(function(u,f,p){return Fo(this,arguments,function*(){for(var g,b,w,S,N,C;a<r;){o&&(a++,o=!1);const j=yield xt(u.processParamsMaybeAddMcpUsage(p)),P=yield xt(u.generateContentStreamInternal(j)),D=[],U=[];try{for(var M=!0,R=(b=void 0,Ho(P)),_;_=yield xt(R.next()),g=_.done,!g;M=!0){S=_.value,M=!1;const V=S;if(yield yield xt(V),V.candidates&&(!((N=V.candidates[0])===null||N===void 0)&&N.content)){U.push(V.candidates[0].content);for(const q of(C=V.candidates[0].content.parts)!==null&&C!==void 0?C:[])if(a<r&&q.functionCall){if(!q.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(q.functionCall.name)){const G=yield xt(f.get(q.functionCall.name).callTool([q.functionCall]));D.push(...G)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${q.functionCall.name}`)}}}}catch(V){b={error:V}}finally{try{!M&&!g&&(w=R.return)&&(yield xt(w.call(R)))}finally{if(b)throw b.error}}if(D.length>0){o=!0;const V=new Hg;V.candidates=[{content:{role:"user",parts:D}}],yield yield xt(V);const q=[];q.push(...U),q.push({role:"user",parts:D});const G=ao(p.contents).concat(q);p.contents=G}else break}})})(this,l,e)}async generateContentInternal(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=fj(this.apiClient,e);return a=Ye("{model}:generateContent",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=mj(f),g=new Hg;return Object.assign(g,p),g})}else{const u=hj(this.apiClient,e);return a=Ye("{model}:generateContent",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=pj(f),g=new Hg;return Object.assign(g,p),g})}}async generateContentStreamInternal(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=fj(this.apiClient,e);return a=Ye("{model}:streamGenerateContent?alt=sse",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),o.then(function(p){return Fo(this,arguments,function*(){var g,b,w,S;try{for(var N=!0,C=Ho(p),M;M=yield xt(C.next()),g=M.done,!g;N=!0){S=M.value,N=!1;const R=S,_=mj(yield xt(R.json()));_.sdkHttpResponse={headers:R.headers};const j=new Hg;Object.assign(j,_),yield yield xt(j)}}catch(R){b={error:R}}finally{try{!N&&!g&&(w=C.return)&&(yield xt(w.call(C)))}finally{if(b)throw b.error}}})})}else{const u=hj(this.apiClient,e);return a=Ye("{model}:streamGenerateContent?alt=sse",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),o.then(function(p){return Fo(this,arguments,function*(){var g,b,w,S;try{for(var N=!0,C=Ho(p),M;M=yield xt(C.next()),g=M.done,!g;N=!0){S=M.value,N=!1;const R=S,_=pj(yield xt(R.json()));_.sdkHttpResponse={headers:R.headers};const j=new Hg;Object.assign(j,_),yield yield xt(j)}}catch(R){b={error:R}}finally{try{!N&&!g&&(w=C.return)&&(yield xt(w.call(C)))}finally{if(b)throw b.error}}})})}}async embedContent(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=V7(this.apiClient,e);return a=Ye("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=W7(f),g=new YD;return Object.assign(g,p),g})}else{const u=G7(this.apiClient,e);return a=Ye("{model}:batchEmbedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=q7(f),g=new YD;return Object.assign(g,p),g})}}async generateImagesInternal(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=iq(this.apiClient,e);return a=Ye("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=oq(f),g=new JD;return Object.assign(g,p),g})}else{const u=sq(this.apiClient,e);return a=Ye("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=rq(f),g=new JD;return Object.assign(g,p),g})}}async editImageInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const a=F7(this.apiClient,e);return r=Ye("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const f=u;return f.sdkHttpResponse={headers:l.headers},f})),i.then(l=>{const u=H7(l),f=new Y8;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const a=i9(this.apiClient,e);return r=Ye("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const f=u;return f.sdkHttpResponse={headers:l.headers},f})),i.then(l=>{const u=r9(l),f=new J8;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const a=Bq(this.apiClient,e);return r=Ye("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),i.then(l=>{const u=Fq(l),f=new X8;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const a=qq(this.apiClient,e);return r=Ye("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),i.then(l=>{const u=Wq(l),f=new Q8;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Sq(this.apiClient,e);return a=Ye("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>TN(f))}else{const u=kq(this.apiClient,e);return a=Ye("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>EN(f))}}async listInternal(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Iq(this.apiClient,e);return a=Ye("{models_url}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=Dq(f),g=new XD;return Object.assign(g,p),g})}else{const u=Rq(this.apiClient,e);return a=Ye("{models_url}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=zq(f),g=new XD;return Object.assign(g,p),g})}}async update(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=n9(this.apiClient,e);return a=Ye("{model}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>TN(f))}else{const u=t9(this.apiClient,e);return a=Ye("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>EN(f))}}async delete(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=P7(this.apiClient,e);return a=Ye("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=O7(f),g=new QD;return Object.assign(g,p),g})}else{const u=j7(this.apiClient,e);return a=Ye("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=L7(f),g=new QD;return Object.assign(g,p),g})}}async countTokens(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=I7(this.apiClient,e);return a=Ye("{model}:countTokens",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=D7(f),g=new ZD;return Object.assign(g,p),g})}else{const u=R7(this.apiClient,e);return a=Ye("{model}:countTokens",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=z7(f),g=new ZD;return Object.assign(g,p),g})}}async computeTokens(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const a=C7(this.apiClient,e);return r=Ye("{model}:computeTokens",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const f=u;return f.sdkHttpResponse={headers:l.headers},f})),i.then(l=>{const u=A7(l),f=new Z8;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=hq(this.apiClient,e);return a=Ye("{model}:predictLongRunning",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>{const p=dq(f),g=new Pw;return Object.assign(g,p),g})}else{const u=uq(this.apiClient,e);return a=Ye("{model}:predictLongRunning",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>{const p=cq(f),g=new Pw;return Object.assign(g,p),g})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Q9 extends nc{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,s=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=t.name.split("/operations/")[0];let r;s&&"httpOptions"in s&&(r=s.httpOptions);const o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:t.name,config:s});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){const t=e.operation,s=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=t.name.split("/operations/")[0];let r;s&&"httpOptions"in s&&(r=s.httpOptions);const o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:t.name,config:s});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=$8(e);return a=Ye("{operationName}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o}else{const u=U8(e);return a=Ye("{operationName}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o}}async fetchPredictVideosOperationInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const a=j8(e);return r=Ye("{resourceName}:fetchPredictOperation",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Z9(n){const e={},t=v(n,["data"]);if(t!=null&&k(e,["data"],t),v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=v(n,["mimeType"]);return s!=null&&k(e,["mimeType"],s),e}function eW(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>cW(r))),k(e,["parts"],i)}const s=v(n,["role"]);return s!=null&&k(e,["role"],s),e}function tW(n,e,t){const s={},i=v(e,["expireTime"]);t!==void 0&&i!=null&&k(t,["expireTime"],i);const r=v(e,["newSessionExpireTime"]);t!==void 0&&r!=null&&k(t,["newSessionExpireTime"],r);const o=v(e,["uses"]);t!==void 0&&o!=null&&k(t,["uses"],o);const a=v(e,["liveConnectConstraints"]);t!==void 0&&a!=null&&k(t,["bidiGenerateContentSetup"],lW(n,a));const l=v(e,["lockAdditionalFields"]);return t!==void 0&&l!=null&&k(t,["fieldMask"],l),s}function nW(n,e){const t={},s=v(e,["config"]);return s!=null&&k(t,["config"],tW(n,s,t)),t}function sW(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&k(e,["fileUri"],t);const s=v(n,["mimeType"]);return s!=null&&k(e,["mimeType"],s),e}function iW(n){const e={},t=v(n,["id"]);t!=null&&k(e,["id"],t);const s=v(n,["args"]);s!=null&&k(e,["args"],s);const i=v(n,["name"]);if(i!=null&&k(e,["name"],i),v(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(v(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function rW(n){const e={};if(v(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=v(n,["enableWidget"]);return t!=null&&k(e,["enableWidget"],t),e}function oW(n){const e={};if(v(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(v(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=v(n,["timeRangeFilter"]);return t!=null&&k(e,["timeRangeFilter"],t),e}function aW(n,e){const t={},s=v(n,["generationConfig"]);e!==void 0&&s!=null&&k(e,["setup","generationConfig"],s);const i=v(n,["responseModalities"]);e!==void 0&&i!=null&&k(e,["setup","generationConfig","responseModalities"],i);const r=v(n,["temperature"]);e!==void 0&&r!=null&&k(e,["setup","generationConfig","temperature"],r);const o=v(n,["topP"]);e!==void 0&&o!=null&&k(e,["setup","generationConfig","topP"],o);const a=v(n,["topK"]);e!==void 0&&a!=null&&k(e,["setup","generationConfig","topK"],a);const l=v(n,["maxOutputTokens"]);e!==void 0&&l!=null&&k(e,["setup","generationConfig","maxOutputTokens"],l);const u=v(n,["mediaResolution"]);e!==void 0&&u!=null&&k(e,["setup","generationConfig","mediaResolution"],u);const f=v(n,["seed"]);e!==void 0&&f!=null&&k(e,["setup","generationConfig","seed"],f);const p=v(n,["speechConfig"]);e!==void 0&&p!=null&&k(e,["setup","generationConfig","speechConfig"],l_(p));const g=v(n,["thinkingConfig"]);e!==void 0&&g!=null&&k(e,["setup","generationConfig","thinkingConfig"],g);const b=v(n,["enableAffectiveDialog"]);e!==void 0&&b!=null&&k(e,["setup","generationConfig","enableAffectiveDialog"],b);const w=v(n,["systemInstruction"]);e!==void 0&&w!=null&&k(e,["setup","systemInstruction"],eW(bi(w)));const S=v(n,["tools"]);if(e!==void 0&&S!=null){let P=Fm(S);Array.isArray(P)&&(P=P.map(D=>uW(Bm(D)))),k(e,["setup","tools"],P)}const N=v(n,["sessionResumption"]);e!==void 0&&N!=null&&k(e,["setup","sessionResumption"],dW(N));const C=v(n,["inputAudioTranscription"]);e!==void 0&&C!=null&&k(e,["setup","inputAudioTranscription"],C);const M=v(n,["outputAudioTranscription"]);e!==void 0&&M!=null&&k(e,["setup","outputAudioTranscription"],M);const R=v(n,["realtimeInputConfig"]);e!==void 0&&R!=null&&k(e,["setup","realtimeInputConfig"],R);const _=v(n,["contextWindowCompression"]);e!==void 0&&_!=null&&k(e,["setup","contextWindowCompression"],_);const j=v(n,["proactivity"]);if(e!==void 0&&j!=null&&k(e,["setup","proactivity"],j),v(n,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function lW(n,e){const t={},s=v(e,["model"]);s!=null&&k(t,["setup","model"],Jt(n,s));const i=v(e,["config"]);return i!=null&&k(t,["config"],aW(i,t)),t}function cW(n){const e={},t=v(n,["mediaResolution"]);t!=null&&k(e,["mediaResolution"],t);const s=v(n,["codeExecutionResult"]);s!=null&&k(e,["codeExecutionResult"],s);const i=v(n,["executableCode"]);i!=null&&k(e,["executableCode"],i);const r=v(n,["fileData"]);r!=null&&k(e,["fileData"],sW(r));const o=v(n,["functionCall"]);o!=null&&k(e,["functionCall"],iW(o));const a=v(n,["functionResponse"]);a!=null&&k(e,["functionResponse"],a);const l=v(n,["inlineData"]);l!=null&&k(e,["inlineData"],Z9(l));const u=v(n,["text"]);u!=null&&k(e,["text"],u);const f=v(n,["thought"]);f!=null&&k(e,["thought"],f);const p=v(n,["thoughtSignature"]);p!=null&&k(e,["thoughtSignature"],p);const g=v(n,["videoMetadata"]);return g!=null&&k(e,["videoMetadata"],g),e}function dW(n){const e={},t=v(n,["handle"]);if(t!=null&&k(e,["handle"],t),v(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function uW(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>p)),k(e,["functionDeclarations"],f)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=v(n,["googleSearchRetrieval"]);s!=null&&k(e,["googleSearchRetrieval"],s);const i=v(n,["computerUse"]);i!=null&&k(e,["computerUse"],i);const r=v(n,["fileSearch"]);r!=null&&k(e,["fileSearch"],r);const o=v(n,["codeExecution"]);if(o!=null&&k(e,["codeExecution"],o),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=v(n,["googleMaps"]);a!=null&&k(e,["googleMaps"],rW(a));const l=v(n,["googleSearch"]);l!=null&&k(e,["googleSearch"],oW(l));const u=v(n,["urlContext"]);return u!=null&&k(e,["urlContext"],u),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function hW(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const s=n[t];if(typeof s=="object"&&s!=null&&Object.keys(s).length>0){const i=Object.keys(s).map(r=>`${t}.${r}`);e.push(...i)}else e.push(t)}return e.join(",")}function fW(n,e){let t=null;const s=n.bidiGenerateContentSetup;if(typeof s=="object"&&s!==null&&"setup"in s){const r=s.setup;typeof r=="object"&&r!==null?(n.bidiGenerateContentSetup=r,t=r):delete n.bidiGenerateContentSetup}else s!==void 0&&delete n.bidiGenerateContentSetup;const i=n.fieldMask;if(t){const r=hW(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)r?n.fieldMask=r:delete n.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const o=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let a=[];i.length>0&&(a=i.map(u=>o.includes(u)?`generationConfig.${u}`:u));const l=[];r&&l.push(r),a.length>0&&l.push(...a),l.length>0?n.fieldMask=l.join(","):delete n.fieldMask}else delete n.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?n.fieldMask=i.join(","):delete n.fieldMask;return n}class pW extends nc{constructor(e){super(),this.apiClient=e}async create(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const a=nW(this.apiClient,e);r=Ye("auth_tokens",a._url),o=a._query,delete a.config,delete a._url,delete a._query;const l=fW(a,e.config);return i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json()),i.then(u=>u)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function mW(n,e){const t={},s=v(n,["force"]);return e!==void 0&&s!=null&&k(e,["_query","force"],s),t}function gW(n){const e={},t=v(n,["name"]);t!=null&&k(e,["_url","name"],t);const s=v(n,["config"]);return s!=null&&mW(s,e),e}function xW(n){const e={},t=v(n,["name"]);return t!=null&&k(e,["_url","name"],t),e}function bW(n,e){const t={},s=v(n,["pageSize"]);e!==void 0&&s!=null&&k(e,["_query","pageSize"],s);const i=v(n,["pageToken"]);return e!==void 0&&i!=null&&k(e,["_query","pageToken"],i),t}function yW(n){const e={},t=v(n,["parent"]);t!=null&&k(e,["_url","parent"],t);const s=v(n,["config"]);return s!=null&&bW(s,e),e}function vW(n){const e={},t=v(n,["sdkHttpResponse"]);t!=null&&k(e,["sdkHttpResponse"],t);const s=v(n,["nextPageToken"]);s!=null&&k(e,["nextPageToken"],s);const i=v(n,["documents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),k(e,["documents"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class wW extends nc{constructor(e){super(),this.apiClient=e,this.list=async t=>new tf(Jl.PAGED_ITEM_DOCUMENTS,s=>this.listInternal({parent:t.parent,config:s.config}),await this.listInternal(t),t)}async get(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=xW(e);return r=Ye("{name}",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async delete(e){var t,s;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=gW(e);i=Ye("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=yW(e);return r=Ye("{parent}/documents",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),i.then(l=>{const u=vW(l),f=new eG;return Object.assign(f,u),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class kW extends nc{constructor(e,t=new wW(e)){super(),this.apiClient=e,this.documents=t,this.list=async(s={})=>new tf(Jl.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(s),s)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=h9(e);return r=Ye("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async get(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=m9(e);return r=Ye("{name}",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),i.then(l=>l)}}async delete(e){var t,s;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=p9(e);i=Ye("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=w9(e);return r=Ye("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),i.then(l=>{const u=k9(l),f=new tG;return Object.assign(f,u),f})}}async uploadToFileSearchStoreInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=S9(e);return r=Ye("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),i.then(l=>{const u=C9(l),f=new nG;return Object.assign(f,u),f})}}async importFile(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=b9(e);return r=Ye("{file_search_store_name}:importFile",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),i.then(l=>{const u=x9(l),f=new s_;return Object.assign(f,u),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let r3=function(){const{crypto:n}=globalThis;if(n!=null&&n.randomUUID)return r3=n.randomUUID.bind(n),n.randomUUID();const e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,s=>(+s^t()&15>>+s/4).toString(16))};const SW=()=>r3();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function MN(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}const RN=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){const e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class fo extends Error{}class Pi extends fo{constructor(e,t,s,i){super(`${Pi.makeMessage(e,t,s)}`),this.status=e,this.headers=i,this.error=t}static makeMessage(e,t,s){const i=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,s,i){if(!e||!i)return new SS({message:s,cause:RN(t)});const r=t;return e===400?new a3(e,r,s,i):e===401?new l3(e,r,s,i):e===403?new c3(e,r,s,i):e===404?new d3(e,r,s,i):e===409?new u3(e,r,s,i):e===422?new h3(e,r,s,i):e===429?new f3(e,r,s,i):e>=500?new p3(e,r,s,i):new Pi(e,r,s,i)}}class IN extends Pi{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class SS extends Pi{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class o3 extends SS{constructor({message:e}={}){super({message:e??"Request timed out."})}}class a3 extends Pi{}class l3 extends Pi{}class c3 extends Pi{}class d3 extends Pi{}class u3 extends Pi{}class h3 extends Pi{}class f3 extends Pi{}class p3 extends Pi{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const CW=/^[a-z][a-z0-9+.-]*:/i,AW=n=>CW.test(n);let zN=n=>(zN=Array.isArray,zN(n));const NW=zN;let EW=NW;const wj=EW;function TW(n){if(!n)return!0;for(const e in n)return!1;return!0}function _W(n,e){return Object.prototype.hasOwnProperty.call(n,e)}const MW=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new fo(`${n} must be an integer`);if(e<0)throw new fo(`${n} must be a positive integer`);return e},RW=n=>{try{return JSON.parse(n)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const IW=n=>new Promise(e=>setTimeout(e,n));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Yf="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zW(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const DW=()=>{var n,e,t,s,i;const r=zW();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Yf,"X-Stainless-OS":Sj(Deno.build.os),"X-Stainless-Arch":kj(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(n=Deno.version)===null||n===void 0?void 0:n.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Yf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Yf,"X-Stainless-OS":Sj((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":kj((s=globalThis.process.arch)!==null&&s!==void 0?s:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(i=globalThis.process.version)!==null&&i!==void 0?i:"unknown"};const o=jW();return o?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Yf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${o.browser}`,"X-Stainless-Runtime-Version":o.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Yf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function jW(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const s=t.exec(navigator.userAgent);if(s){const i=s[1]||0,r=s[2]||0,o=s[3]||0;return{browser:e,version:`${i}.${r}.${o}`}}}return null}const kj=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Sj=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let fv;const PW=()=>fv??(fv=DW());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function LW(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function m3(...n){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function OW(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return m3({start(){},async pull(t){const{done:s,value:i}=await e.next();s?t.close():t.enqueue(i)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function g3(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function BW(n){var e,t;if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await((t=(e=n[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}const s=n.getReader(),i=s.cancel();s.releaseLock(),await i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const FW=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const x3=()=>{var n;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((n=e==null?void 0:e.versions)===null||n===void 0?void 0:n.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function yA(n,e,t){return x3(),new File(n,e??"unknown_file",t)}function HW(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}const UW=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const b3=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",$W=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&b3(n),GW=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function VW(n,e,t){if(x3(),n=await n,$W(n))return n instanceof File?n:yA([await n.arrayBuffer()],n.name);if(GW(n)){const i=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),yA(await DN(i),e,t)}const s=await DN(n);if(e||(e=HW(n)),!(t!=null&&t.type)){const i=s.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof i=="string"&&(t=Object.assign(Object.assign({},t),{type:i}))}return yA(s,e,t)}async function DN(n){var e,t,s,i,r;let o=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)o.push(n);else if(b3(n))o.push(n instanceof Blob?n:await n.arrayBuffer());else if(UW(n))try{for(var a=!0,l=Ho(n),u;u=await l.next(),e=u.done,!e;a=!0){i=u.value,a=!1;const f=i;o.push(...await DN(f))}}catch(f){t={error:f}}finally{try{!a&&!e&&(s=l.return)&&await s.call(l)}finally{if(t)throw t.error}}else{const f=(r=n==null?void 0:n.constructor)===null||r===void 0?void 0:r.name;throw new Error(`Unexpected data type: ${typeof n}${f?`; constructor: ${f}`:""}${qW(n)}`)}return o}function qW(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class y3{constructor(e){this._client=e}}y3._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function v3(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Cj=Object.freeze(Object.create(null)),WW=(n=v3)=>(function(t,...s){if(t.length===1)return t[0];let i=!1;const r=[],o=t.reduce((f,p,g)=>{var b,w,S;/[?#]/.test(p)&&(i=!0);const N=s[g];let C=(i?encodeURIComponent:n)(""+N);return g!==s.length&&(N==null||typeof N=="object"&&N.toString===((S=Object.getPrototypeOf((w=Object.getPrototypeOf((b=N.hasOwnProperty)!==null&&b!==void 0?b:Cj))!==null&&w!==void 0?w:Cj))===null||S===void 0?void 0:S.toString))&&(C=N+"",r.push({start:f.length+p.length,length:C.length,error:`Value of type ${Object.prototype.toString.call(N).slice(8,-1)} is not a valid path parameter`})),f+p+(g===s.length?"":C)},""),a=o.split(/[?#]/,1)[0],l=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let u;for(;(u=l.exec(a))!==null;)r.push({start:u.index,length:u[0].length,error:`Value "${u[0]}" can't be safely passed as a path parameter`});if(r.sort((f,p)=>f.start-p.start),r.length>0){let f=0;const p=r.reduce((g,b)=>{const w=" ".repeat(b.start-f),S="^".repeat(b.length);return f=b.start+b.length,g+w+S},"");throw new fo(`Path parameters result in path with invalid segments:
${r.map(g=>g.error).join(`
`)}
${o}
${p}`)}return o}),pv=WW(v3);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class w3 extends y3{create(e,t){var s;const{api_version:i=this._client.apiVersion}=e,r=Ow(e,["api_version"]);if("model"in r&&"agent_config"in r)throw new fo("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in r&&"generation_config"in r)throw new fo("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(pv`/${i}/interactions`,Object.assign(Object.assign({body:r},t),{stream:(s=e.stream)!==null&&s!==void 0?s:!1}))}delete(e,t={},s){const{api_version:i=this._client.apiVersion}=t??{};return this._client.delete(pv`/${i}/interactions/${e}`,s)}cancel(e,t={},s){const{api_version:i=this._client.apiVersion}=t??{};return this._client.post(pv`/${i}/interactions/${e}/cancel`,s)}get(e,t={},s){var i;const r=t??{},{api_version:o=this._client.apiVersion}=r,a=Ow(r,["api_version"]);return this._client.get(pv`/${o}/interactions/${e}`,Object.assign(Object.assign({query:a},s),{stream:(i=t==null?void 0:t.stream)!==null&&i!==void 0?i:!1}))}}w3._key=Object.freeze(["interactions"]);class k3 extends w3{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function KW(n){let e=0;for(const i of n)e+=i.length;const t=new Uint8Array(e);let s=0;for(const i of n)t.set(i,s),s+=i.length;return t}let mv;function d_(n){let e;return(mv??(e=new globalThis.TextEncoder,mv=e.encode.bind(e)))(n)}let gv;function Aj(n){let e;return(gv??(e=new globalThis.TextDecoder,gv=e.decode.bind(e)))(n)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class CS{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?d_(e):e;this.buffer=KW([this.buffer,t]);const s=[];let i;for(;(i=YW(this.buffer,this.carriageReturnIndex))!=null;){if(i.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=i.index;continue}if(this.carriageReturnIndex!=null&&(i.index!==this.carriageReturnIndex+1||i.carriage)){s.push(Aj(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const r=this.carriageReturnIndex!==null?i.preceding-1:i.preceding,o=Aj(this.buffer.subarray(0,r));s.push(o),this.buffer=this.buffer.subarray(i.index),this.carriageReturnIndex=null}return s}flush(){return this.buffer.length?this.decode(`
`):[]}}CS.NEWLINE_CHARS=new Set([`
`,"\r"]);CS.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function YW(n,e){for(let i=e??0;i<n.length;i++){if(n[i]===10)return{preceding:i,index:i+1,carriage:!1};if(n[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function JW(n){for(let s=0;s<n.length-1;s++){if(n[s]===10&&n[s+1]===10||n[s]===13&&n[s+1]===13)return s+2;if(n[s]===13&&n[s+1]===10&&s+3<n.length&&n[s+2]===13&&n[s+3]===10)return s+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Bw={off:0,error:200,warn:300,info:400,debug:500},Nj=(n,e,t)=>{if(n){if(_W(Bw,n))return n;Ii(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(Bw))}`)}};function Qg(){}function xv(n,e,t){return!e||Bw[n]>Bw[t]?Qg:e[n].bind(e)}const XW={error:Qg,warn:Qg,info:Qg,debug:Qg};let Ej=new WeakMap;function Ii(n){var e;const t=n.logger,s=(e=n.logLevel)!==null&&e!==void 0?e:"off";if(!t)return XW;const i=Ej.get(t);if(i&&i[0]===s)return i[1];const r={error:xv("error",t,s),warn:xv("warn",t,s),info:xv("info",t,s),debug:xv("debug",t,s)};return Ej.set(t,[s,r]),r}const gu=n=>(n.options&&(n.options=Object.assign({},n.options),delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class cp{constructor(e,t,s){this.iterator=e,this.controller=t,this.client=s}static fromSSEResponse(e,t,s){let i=!1;const r=s?Ii(s):console;function o(){return Fo(this,arguments,function*(){var l,u,f,p;if(i)throw new fo("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let g=!1;try{try{for(var b=!0,w=Ho(QW(e,t)),S;S=yield xt(w.next()),l=S.done,!l;b=!0){p=S.value,b=!1;const N=p;if(!g)if(N.data.startsWith("[DONE]")){g=!0;continue}else try{yield yield xt(JSON.parse(N.data))}catch(C){throw r.error("Could not parse message into JSON:",N.data),r.error("From chunk:",N.raw),C}}}catch(N){u={error:N}}finally{try{!b&&!l&&(f=w.return)&&(yield xt(f.call(w)))}finally{if(u)throw u.error}}g=!0}catch(N){if(MN(N))return yield xt(void 0);throw N}finally{g||t.abort()}})}return new cp(o,t,s)}static fromReadableStream(e,t,s){let i=!1;function r(){return Fo(this,arguments,function*(){var l,u,f,p;const g=new CS,b=g3(e);try{for(var w=!0,S=Ho(b),N;N=yield xt(S.next()),l=N.done,!l;w=!0){p=N.value,w=!1;const C=p;for(const M of g.decode(C))yield yield xt(M)}}catch(C){u={error:C}}finally{try{!w&&!l&&(f=S.return)&&(yield xt(f.call(S)))}finally{if(u)throw u.error}}for(const C of g.flush())yield yield xt(C)})}function o(){return Fo(this,arguments,function*(){var l,u,f,p;if(i)throw new fo("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let g=!1;try{try{for(var b=!0,w=Ho(r()),S;S=yield xt(w.next()),l=S.done,!l;b=!0){p=S.value,b=!1;const N=p;g||N&&(yield yield xt(JSON.parse(N)))}}catch(N){u={error:N}}finally{try{!b&&!l&&(f=w.return)&&(yield xt(f.call(w)))}finally{if(u)throw u.error}}g=!0}catch(N){if(MN(N))return yield xt(void 0);throw N}finally{g||t.abort()}})}return new cp(o,t,s)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),i=r=>({next:()=>{if(r.length===0){const o=s.next();e.push(o),t.push(o)}return r.shift()}});return[new cp(()=>i(e),this.controller,this.client),new cp(()=>i(t),this.controller,this.client)]}toReadableStream(){const e=this;let t;return m3({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:r}=await t.next();if(r)return s.close();const o=d_(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)===null||s===void 0?void 0:s.call(t))}})}}function QW(n,e){return Fo(this,arguments,function*(){var s,i,r,o;if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new fo("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new fo("Attempted to iterate over a response with no body");const a=new eK,l=new CS,u=g3(n.body);try{for(var f=!0,p=Ho(ZW(u)),g;g=yield xt(p.next()),s=g.done,!s;f=!0){o=g.value,f=!1;const b=o;for(const w of l.decode(b)){const S=a.decode(w);S&&(yield yield xt(S))}}}catch(b){i={error:b}}finally{try{!f&&!s&&(r=p.return)&&(yield xt(r.call(p)))}finally{if(i)throw i.error}}for(const b of l.flush()){const w=a.decode(b);w&&(yield yield xt(w))}})}function ZW(n){return Fo(this,arguments,function*(){var t,s,i,r;let o=new Uint8Array;try{for(var a=!0,l=Ho(n),u;u=yield xt(l.next()),t=u.done,!t;a=!0){r=u.value,a=!1;const f=r;if(f==null)continue;const p=f instanceof ArrayBuffer?new Uint8Array(f):typeof f=="string"?d_(f):f;let g=new Uint8Array(o.length+p.length);g.set(o),g.set(p,o.length),o=g;let b;for(;(b=JW(o))!==-1;)yield yield xt(o.slice(0,b)),o=o.slice(b)}}catch(f){s={error:f}}finally{try{!a&&!t&&(i=l.return)&&(yield xt(i.call(l)))}finally{if(s)throw s.error}}o.length>0&&(yield yield xt(o))})}class eK{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,i]=tK(e,":");return i.startsWith(" ")&&(i=i.substring(1)),t==="event"?this.event=i:t==="data"&&this.data.push(i),null}}function tK(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function nK(n,e){const{response:t,requestLogID:s,retryOfRequestLogID:i,startTime:r}=e,o=await(async()=>{var a;if(e.options.stream)return Ii(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,n):cp.fromSSEResponse(t,e.controller,n);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const l=t.headers.get("content-type"),u=(a=l==null?void 0:l.split(";")[0])===null||a===void 0?void 0:a.trim();return(u==null?void 0:u.includes("application/json"))||(u==null?void 0:u.endsWith("+json"))?await t.json():await t.text()})();return Ii(n).debug(`[${s}] response parsed`,gu({retryOfRequestLogID:i,url:t.url,status:t.status,body:o,durationMs:Date.now()-r})),o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class u_ extends Promise{constructor(e,t,s=nK){super(i=>{i(null)}),this.responsePromise=t,this.parseResponse=s,this.client=e}_thenUnwrap(e){return new u_(this.client,this.responsePromise,async(t,s)=>e(await this.parseResponse(t,s),s))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const S3=Symbol("brand.privateNullableHeaders");function*sK(n){if(!n)return;if(S3 in n){const{values:s,nulls:i}=n;yield*s.entries();for(const r of i)yield[r,null];return}let e=!1,t;n instanceof Headers?t=n.entries():wj(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let s of t){const i=s[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const r=wj(s[1])?s[1]:[s[1]];let o=!1;for(const a of r)a!==void 0&&(e&&!o&&(o=!0,yield[i,null]),yield[i,a])}}const Ug=n=>{const e=new Headers,t=new Set;for(const s of n){const i=new Set;for(const[r,o]of sK(s)){const a=r.toLowerCase();i.has(a)||(e.delete(r),i.add(a)),o===null?(e.delete(r),t.add(a)):(e.append(r,o),t.delete(a))}}return{[S3]:!0,values:e,nulls:t}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vA=n=>{var e,t,s,i,r,o;if(typeof globalThis.process<"u")return(s=(t=(e=_8)===null||e===void 0?void 0:e[n])===null||t===void 0?void 0:t.trim())!==null&&s!==void 0?s:void 0;if(typeof globalThis.Deno<"u")return(o=(r=(i=globalThis.Deno.env)===null||i===void 0?void 0:i.get)===null||r===void 0?void 0:r.call(i,n))===null||o===void 0?void 0:o.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var C3;class AS{constructor(e){var t,s,i,r,o,a,l,{baseURL:u=vA("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:f=(t=vA("GEMINI_API_KEY"))!==null&&t!==void 0?t:null,apiVersion:p="v1beta"}=e,g=Ow(e,["baseURL","apiKey","apiVersion"]);const b=Object.assign(Object.assign({apiKey:f,apiVersion:p},g),{baseURL:u||"https://generativelanguage.googleapis.com"});this.baseURL=b.baseURL,this.timeout=(s=b.timeout)!==null&&s!==void 0?s:AS.DEFAULT_TIMEOUT,this.logger=(i=b.logger)!==null&&i!==void 0?i:console;const w="warn";this.logLevel=w,this.logLevel=(o=(r=Nj(b.logLevel,"ClientOptions.logLevel",this))!==null&&r!==void 0?r:Nj(vA("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&o!==void 0?o:w,this.fetchOptions=b.fetchOptions,this.maxRetries=(a=b.maxRetries)!==null&&a!==void 0?a:2,this.fetch=(l=b.fetch)!==null&&l!==void 0?l:LW(),this.encoder=FW,this._options=b,this.apiKey=f,this.apiVersion=p,this.clientAdapter=b.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!t.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const t=Ug([e.headers]);if(!(t.values.has("authorization")||t.values.has("x-goog-api-key"))){if(this.apiKey)return Ug([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return Ug([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([t,s])=>typeof s<"u").map(([t,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(t)}=`;throw new fo(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Yf}`}defaultIdempotencyKey(){return`stainless-node-retry-${SW()}`}makeStatusError(e,t,s,i){return Pi.generate(e,t,s,i)}buildURL(e,t,s){const i=!this.baseURLOverridden()&&s||this.baseURL,r=AW(e)?new URL(e):new URL(i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return TW(o)||(t=Object.assign(Object.assign({},o),t)),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(i=>Object.assign({method:e,path:t},i)))}request(e,t=null){return new u_(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){var i,r,o;const a=await e,l=(i=a.maxRetries)!==null&&i!==void 0?i:this.maxRetries;t==null&&(t=l),await this.prepareOptions(a);const{req:u,url:f,timeout:p}=await this.buildRequest(a,{retryCount:l-t});await this.prepareRequest(u,{url:f,options:a});const g="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),b=s===void 0?"":`, retryOf: ${s}`,w=Date.now();if(Ii(this).debug(`[${g}] sending request`,gu({retryOfRequestLogID:s,method:a.method,url:f,options:a,headers:u.headers})),!((r=a.signal)===null||r===void 0)&&r.aborted)throw new IN;const S=new AbortController,N=await this.fetchWithTimeout(f,u,p,S).catch(RN),C=Date.now();if(N instanceof globalThis.Error){const R=`retrying, ${t} attempts remaining`;if(!((o=a.signal)===null||o===void 0)&&o.aborted)throw new IN;const _=MN(N)||/timed? ?out/i.test(String(N)+("cause"in N?String(N.cause):""));if(t)return Ii(this).info(`[${g}] connection ${_?"timed out":"failed"} - ${R}`),Ii(this).debug(`[${g}] connection ${_?"timed out":"failed"} (${R})`,gu({retryOfRequestLogID:s,url:f,durationMs:C-w,message:N.message})),this.retryRequest(a,t,s??g);throw Ii(this).info(`[${g}] connection ${_?"timed out":"failed"} - error; no more retries left`),Ii(this).debug(`[${g}] connection ${_?"timed out":"failed"} (error; no more retries left)`,gu({retryOfRequestLogID:s,url:f,durationMs:C-w,message:N.message})),_?new o3:new SS({cause:N})}const M=`[${g}${b}] ${u.method} ${f} ${N.ok?"succeeded":"failed"} with status ${N.status} in ${C-w}ms`;if(!N.ok){const R=await this.shouldRetry(N);if(t&&R){const V=`retrying, ${t} attempts remaining`;return await BW(N.body),Ii(this).info(`${M} - ${V}`),Ii(this).debug(`[${g}] response error (${V})`,gu({retryOfRequestLogID:s,url:N.url,status:N.status,headers:N.headers,durationMs:C-w})),this.retryRequest(a,t,s??g,N.headers)}const _=R?"error; no more retries left":"error; not retryable";Ii(this).info(`${M} - ${_}`);const j=await N.text().catch(V=>RN(V).message),P=RW(j),D=P?void 0:j;throw Ii(this).debug(`[${g}] response error (${_})`,gu({retryOfRequestLogID:s,url:N.url,status:N.status,headers:N.headers,message:D,durationMs:Date.now()-w})),this.makeStatusError(N.status,P,D,N.headers)}return Ii(this).info(M),Ii(this).debug(`[${g}] response start`,gu({retryOfRequestLogID:s,url:N.url,status:N.status,headers:N.headers,durationMs:C-w})),{response:N,options:a,controller:S,requestLogID:g,retryOfRequestLogID:s,startTime:w}}async fetchWithTimeout(e,t,s,i){const r=t||{},{signal:o,method:a}=r,l=Ow(r,["signal","method"]);o&&o.addEventListener("abort",()=>i.abort());const u=setTimeout(()=>i.abort(),s),f=globalThis.ReadableStream&&l.body instanceof globalThis.ReadableStream||typeof l.body=="object"&&l.body!==null&&Symbol.asyncIterator in l.body,p=Object.assign(Object.assign(Object.assign({signal:i.signal},f?{duplex:"half"}:{}),{method:"GET"}),l);a&&(p.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,p)}finally{clearTimeout(u)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,s,i){var r;let o;const a=i==null?void 0:i.get("retry-after-ms");if(a){const u=parseFloat(a);Number.isNaN(u)||(o=u)}const l=i==null?void 0:i.get("retry-after");if(l&&!o){const u=parseFloat(l);Number.isNaN(u)?o=Date.parse(l)-Date.now():o=u*1e3}if(!(o&&0<=o&&o<60*1e3)){const u=(r=e.maxRetries)!==null&&r!==void 0?r:this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,u)}return await IW(o),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){const r=t-e,o=Math.min(.5*Math.pow(2,r),8),a=1-Math.random()*.25;return o*a*1e3}async buildRequest(e,{retryCount:t=0}={}){var s,i,r;const o=Object.assign({},e),{method:a,path:l,query:u,defaultBaseURL:f}=o,p=this.buildURL(l,u,f);"timeout"in o&&MW("timeout",o.timeout),o.timeout=(s=o.timeout)!==null&&s!==void 0?s:this.timeout;const{bodyHeaders:g,body:b}=this.buildBody({options:o}),w=await this.buildHeaders({options:e,method:a,bodyHeaders:g,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:w},o.signal&&{signal:o.signal}),globalThis.ReadableStream&&b instanceof globalThis.ReadableStream&&{duplex:"half"}),b&&{body:b}),(i=this.fetchOptions)!==null&&i!==void 0?i:{}),(r=o.fetchOptions)!==null&&r!==void 0?r:{}),url:p,timeout:o.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:i}){let r={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const o=await this.authHeaders(e);let a=Ug([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),PW()),this._options.defaultHeaders,s,e.headers,o]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const s=Ug([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:OW(e)}:this.encoder({body:e,headers:s})}}AS.DEFAULT_TIMEOUT=6e4;class Gs extends AS{constructor(){super(...arguments),this.interactions=new k3(this)}}C3=Gs;Gs.GeminiNextGenAPIClient=C3;Gs.GeminiNextGenAPIClientError=fo;Gs.APIError=Pi;Gs.APIConnectionError=SS;Gs.APIConnectionTimeoutError=o3;Gs.APIUserAbortError=IN;Gs.NotFoundError=d3;Gs.ConflictError=u3;Gs.RateLimitError=f3;Gs.BadRequestError=a3;Gs.AuthenticationError=l3;Gs.InternalServerError=p3;Gs.PermissionDeniedError=c3;Gs.UnprocessableEntityError=h3;Gs.toFile=VW;Gs.Interactions=k3;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function iK(n,e){const t={},s=v(n,["name"]);return s!=null&&k(t,["_url","name"],s),t}function rK(n,e){const t={},s=v(n,["name"]);return s!=null&&k(t,["_url","name"],s),t}function oK(n,e){const t={},s=v(n,["sdkHttpResponse"]);return s!=null&&k(t,["sdkHttpResponse"],s),t}function aK(n,e){const t={},s=v(n,["sdkHttpResponse"]);return s!=null&&k(t,["sdkHttpResponse"],s),t}function lK(n,e,t){const s={};if(v(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=v(n,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&k(e,["displayName"],i),v(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const r=v(n,["epochCount"]);e!==void 0&&r!=null&&k(e,["tuningTask","hyperparameters","epochCount"],r);const o=v(n,["learningRateMultiplier"]);if(o!=null&&k(s,["tuningTask","hyperparameters","learningRateMultiplier"],o),v(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(v(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(v(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const a=v(n,["batchSize"]);e!==void 0&&a!=null&&k(e,["tuningTask","hyperparameters","batchSize"],a);const l=v(n,["learningRate"]);if(e!==void 0&&l!=null&&k(e,["tuningTask","hyperparameters","learningRate"],l),v(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(v(n,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return s}function cK(n,e,t){const s={};let i=v(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const b=v(n,["validationDataset"]);e!==void 0&&b!=null&&k(e,["supervisedTuningSpec"],Tj(b))}else if(i==="PREFERENCE_TUNING"){const b=v(n,["validationDataset"]);e!==void 0&&b!=null&&k(e,["preferenceOptimizationSpec"],Tj(b))}const r=v(n,["tunedModelDisplayName"]);e!==void 0&&r!=null&&k(e,["tunedModelDisplayName"],r);const o=v(n,["description"]);e!==void 0&&o!=null&&k(e,["description"],o);let a=v(t,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const b=v(n,["epochCount"]);e!==void 0&&b!=null&&k(e,["supervisedTuningSpec","hyperParameters","epochCount"],b)}else if(a==="PREFERENCE_TUNING"){const b=v(n,["epochCount"]);e!==void 0&&b!=null&&k(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],b)}let l=v(t,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const b=v(n,["learningRateMultiplier"]);e!==void 0&&b!=null&&k(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],b)}else if(l==="PREFERENCE_TUNING"){const b=v(n,["learningRateMultiplier"]);e!==void 0&&b!=null&&k(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],b)}let u=v(t,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const b=v(n,["exportLastCheckpointOnly"]);e!==void 0&&b!=null&&k(e,["supervisedTuningSpec","exportLastCheckpointOnly"],b)}else if(u==="PREFERENCE_TUNING"){const b=v(n,["exportLastCheckpointOnly"]);e!==void 0&&b!=null&&k(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],b)}let f=v(t,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const b=v(n,["adapterSize"]);e!==void 0&&b!=null&&k(e,["supervisedTuningSpec","hyperParameters","adapterSize"],b)}else if(f==="PREFERENCE_TUNING"){const b=v(n,["adapterSize"]);e!==void 0&&b!=null&&k(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],b)}if(v(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(v(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const p=v(n,["labels"]);e!==void 0&&p!=null&&k(e,["labels"],p);const g=v(n,["beta"]);return e!==void 0&&g!=null&&k(e,["preferenceOptimizationSpec","hyperParameters","beta"],g),s}function dK(n,e){const t={},s=v(n,["baseModel"]);s!=null&&k(t,["baseModel"],s);const i=v(n,["preTunedModel"]);i!=null&&k(t,["preTunedModel"],i);const r=v(n,["trainingDataset"]);r!=null&&wK(r);const o=v(n,["config"]);return o!=null&&lK(o,t),t}function uK(n,e){const t={},s=v(n,["baseModel"]);s!=null&&k(t,["baseModel"],s);const i=v(n,["preTunedModel"]);i!=null&&k(t,["preTunedModel"],i);const r=v(n,["trainingDataset"]);r!=null&&kK(r,t,e);const o=v(n,["config"]);return o!=null&&cK(o,t,e),t}function hK(n,e){const t={},s=v(n,["name"]);return s!=null&&k(t,["_url","name"],s),t}function fK(n,e){const t={},s=v(n,["name"]);return s!=null&&k(t,["_url","name"],s),t}function pK(n,e,t){const s={},i=v(n,["pageSize"]);e!==void 0&&i!=null&&k(e,["_query","pageSize"],i);const r=v(n,["pageToken"]);e!==void 0&&r!=null&&k(e,["_query","pageToken"],r);const o=v(n,["filter"]);return e!==void 0&&o!=null&&k(e,["_query","filter"],o),s}function mK(n,e,t){const s={},i=v(n,["pageSize"]);e!==void 0&&i!=null&&k(e,["_query","pageSize"],i);const r=v(n,["pageToken"]);e!==void 0&&r!=null&&k(e,["_query","pageToken"],r);const o=v(n,["filter"]);return e!==void 0&&o!=null&&k(e,["_query","filter"],o),s}function gK(n,e){const t={},s=v(n,["config"]);return s!=null&&pK(s,t),t}function xK(n,e){const t={},s=v(n,["config"]);return s!=null&&mK(s,t),t}function bK(n,e){const t={},s=v(n,["sdkHttpResponse"]);s!=null&&k(t,["sdkHttpResponse"],s);const i=v(n,["nextPageToken"]);i!=null&&k(t,["nextPageToken"],i);const r=v(n,["tunedModels"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>A3(a))),k(t,["tuningJobs"],o)}return t}function yK(n,e){const t={},s=v(n,["sdkHttpResponse"]);s!=null&&k(t,["sdkHttpResponse"],s);const i=v(n,["nextPageToken"]);i!=null&&k(t,["nextPageToken"],i);const r=v(n,["tuningJobs"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>jN(a))),k(t,["tuningJobs"],o)}return t}function vK(n,e){const t={},s=v(n,["name"]);s!=null&&k(t,["model"],s);const i=v(n,["name"]);return i!=null&&k(t,["endpoint"],i),t}function wK(n,e){const t={};if(v(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(v(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const s=v(n,["examples"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),k(t,["examples","examples"],i)}return t}function kK(n,e,t){const s={};let i=v(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const o=v(n,["gcsUri"]);e!==void 0&&o!=null&&k(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(i==="PREFERENCE_TUNING"){const o=v(n,["gcsUri"]);e!==void 0&&o!=null&&k(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}let r=v(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const o=v(n,["vertexDatasetResource"]);e!==void 0&&o!=null&&k(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(r==="PREFERENCE_TUNING"){const o=v(n,["vertexDatasetResource"]);e!==void 0&&o!=null&&k(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}if(v(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return s}function A3(n,e){const t={},s=v(n,["sdkHttpResponse"]);s!=null&&k(t,["sdkHttpResponse"],s);const i=v(n,["name"]);i!=null&&k(t,["name"],i);const r=v(n,["state"]);r!=null&&k(t,["state"],HO(r));const o=v(n,["createTime"]);o!=null&&k(t,["createTime"],o);const a=v(n,["tuningTask","startTime"]);a!=null&&k(t,["startTime"],a);const l=v(n,["tuningTask","completeTime"]);l!=null&&k(t,["endTime"],l);const u=v(n,["updateTime"]);u!=null&&k(t,["updateTime"],u);const f=v(n,["description"]);f!=null&&k(t,["description"],f);const p=v(n,["baseModel"]);p!=null&&k(t,["baseModel"],p);const g=v(n,["_self"]);return g!=null&&k(t,["tunedModel"],vK(g)),t}function jN(n,e){const t={},s=v(n,["sdkHttpResponse"]);s!=null&&k(t,["sdkHttpResponse"],s);const i=v(n,["name"]);i!=null&&k(t,["name"],i);const r=v(n,["state"]);r!=null&&k(t,["state"],HO(r));const o=v(n,["createTime"]);o!=null&&k(t,["createTime"],o);const a=v(n,["startTime"]);a!=null&&k(t,["startTime"],a);const l=v(n,["endTime"]);l!=null&&k(t,["endTime"],l);const u=v(n,["updateTime"]);u!=null&&k(t,["updateTime"],u);const f=v(n,["error"]);f!=null&&k(t,["error"],f);const p=v(n,["description"]);p!=null&&k(t,["description"],p);const g=v(n,["baseModel"]);g!=null&&k(t,["baseModel"],g);const b=v(n,["tunedModel"]);b!=null&&k(t,["tunedModel"],b);const w=v(n,["preTunedModel"]);w!=null&&k(t,["preTunedModel"],w);const S=v(n,["supervisedTuningSpec"]);S!=null&&k(t,["supervisedTuningSpec"],S);const N=v(n,["preferenceOptimizationSpec"]);N!=null&&k(t,["preferenceOptimizationSpec"],N);const C=v(n,["tuningDataStats"]);C!=null&&k(t,["tuningDataStats"],C);const M=v(n,["encryptionSpec"]);M!=null&&k(t,["encryptionSpec"],M);const R=v(n,["partnerModelTuningSpec"]);R!=null&&k(t,["partnerModelTuningSpec"],R);const _=v(n,["customBaseModel"]);_!=null&&k(t,["customBaseModel"],_);const j=v(n,["experiment"]);j!=null&&k(t,["experiment"],j);const P=v(n,["labels"]);P!=null&&k(t,["labels"],P);const D=v(n,["outputUri"]);D!=null&&k(t,["outputUri"],D);const U=v(n,["pipelineJob"]);U!=null&&k(t,["pipelineJob"],U);const V=v(n,["serviceAccount"]);V!=null&&k(t,["serviceAccount"],V);const q=v(n,["tunedModelDisplayName"]);q!=null&&k(t,["tunedModelDisplayName"],q);const G=v(n,["veoTuningSpec"]);return G!=null&&k(t,["veoTuningSpec"],G),t}function SK(n,e){const t={},s=v(n,["sdkHttpResponse"]);s!=null&&k(t,["sdkHttpResponse"],s);const i=v(n,["name"]);i!=null&&k(t,["name"],i);const r=v(n,["metadata"]);r!=null&&k(t,["metadata"],r);const o=v(n,["done"]);o!=null&&k(t,["done"],o);const a=v(n,["error"]);return a!=null&&k(t,["error"],a),t}function Tj(n,e){const t={},s=v(n,["gcsUri"]);s!=null&&k(t,["validationDatasetUri"],s);const i=v(n,["vertexDatasetResource"]);return i!=null&&k(t,["validationDatasetUri"],i),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class CK extends nc{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new tf(Jl.PAGED_ITEM_TUNING_JOBS,s=>this.listInternal(s),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var s;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const i={tunedModelName:t.baseModel};!((s=t.config)===null||s===void 0)&&s.preTunedModelCheckpointId&&(i.checkpointId=t.config.preTunedModelCheckpointId);const r=Object.assign(Object.assign({},t),{preTunedModel:i});return r.baseModel=void 0,await this.tuneInternal(r)}else{const i=Object.assign({},t);return await this.tuneInternal(i)}else{const i=Object.assign({},t),r=await this.tuneMldevInternal(i);let o="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?o=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(o=r.name.split("/operations/")[0]),{name:o,state:SN.JOB_STATE_QUEUED}}}}async getInternal(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=fK(e);return a=Ye("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>jN(f))}else{const u=hK(e);return a=Ye("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>A3(f))}}async listInternal(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=xK(e);return a=Ye("tuningJobs",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=yK(f),g=new ej;return Object.assign(g,p),g})}else{const u=gK(e);return a=Ye("tunedModels",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=bK(f),g=new ej;return Object.assign(g,p),g})}}async cancel(e){var t,s,i,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=rK(e);return a=Ye("{name}:cancel",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=aK(f),g=new tj;return Object.assign(g,p),g})}else{const u=iK(e);return a=Ye("{name}:cancel",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const g=p;return g.sdkHttpResponse={headers:f.headers},g})),o.then(f=>{const p=oK(f),g=new tj;return Object.assign(g,p),g})}}async tuneInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const a=uK(e,e);return r=Ye("tuningJobs",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const f=u;return f.sdkHttpResponse={headers:l.headers},f})),i.then(l=>jN(l))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=dK(e);return r=Ye("tunedModels",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const f=u;return f.sdkHttpResponse={headers:l.headers},f})),i.then(l=>SK(l))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class AK{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const NK=1024*1024*8,EK=3,TK=1e3,_K=2,Fw="x-goog-upload-status";async function MK(n,e,t){var s;const i=await N3(n,e,t),r=await(i==null?void 0:i.json());if(((s=i==null?void 0:i.headers)===null||s===void 0?void 0:s[Fw])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function RK(n,e,t){var s;const i=await N3(n,e,t),r=await(i==null?void 0:i.json());if(((s=i==null?void 0:i.headers)===null||s===void 0?void 0:s[Fw])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const o=jO(r),a=new i_;return Object.assign(a,o),a}async function N3(n,e,t){var s,i;let r=0,o=0,a=new CN(new Response),l="upload";for(r=n.size;o<r;){const u=Math.min(NK,r-o),f=n.slice(o,o+u);o+u>=r&&(l+=", finalize");let p=0,g=TK;for(;p<EK&&(a=await t.request({path:"",body:f,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(o),"Content-Length":String(u)}}}),!(!((s=a==null?void 0:a.headers)===null||s===void 0)&&s[Fw]));)p++,await zK(g),g=g*_K;if(o+=u,((i=a==null?void 0:a.headers)===null||i===void 0?void 0:i[Fw])!=="active")break;if(r<=o)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function IK(n){return{size:n.size,type:n.type}}function zK(n){return new Promise(e=>setTimeout(e,n))}class DK{async upload(e,t,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await MK(e,t,s)}async uploadToFileSearchStore(e,t,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await RK(e,t,s)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await IK(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class jK{create(e,t,s){return new PK(e,t,s)}}class PK{constructor(e,t,s){this.url=e,this.headers=t,this.callbacks=s}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const _j="x-goog-api-key";class LK{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(_j)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(_j,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const OK="gl-node/";class BK{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const e=this.httpOptions;e!=null&&e.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const t=new Gs({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e==null?void 0:e.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const s=z8(e.httpOptions,e.vertexai,void 0,void 0);s&&(e.httpOptions?e.httpOptions.baseUrl=s:e.httpOptions={baseUrl:s}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const i=new LK(this.apiKey);this.apiClient=new I9({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:OK+"web",uploader:new DK,downloader:new AK}),this.models=new X9(this.apiClient),this.live=new V9(this.apiClient,i,new jK),this.batches=new lV(this.apiClient),this.chats=new $V(this.models,this.apiClient),this.caches=new FV(this.apiClient),this.files=new ZV(this.apiClient),this.operations=new Q9(this.apiClient),this.authTokens=new pW(this.apiClient),this.tunings=new CK(this.apiClient),this.fileSearchStores=new kW(this.apiClient)}}let bv=null;const FK=()=>"PLACEHOLDER_API_KEY"!=="",HK=()=>{if(!navigator.onLine)throw new Error("You are currently offline. AI features require an internet connection.")},Ft=()=>{if(HK(),bv)return bv;const n="PLACEHOLDER_API_KEY";return bv=new BK({apiKey:n}),bv},U0={"Standard Co-Author":"You are an expert co-author and editor. Be helpful, creative, and encouraging.","Ruthless Editor":"You are a harsh, critical editor. Focus on cutting fluff, fixing logic holes, and improving pacing. Do not sugarcoat your feedback. Be direct and concise.",Cheerleader:"You are an enthusiastic writing coach. Focus on what is working well, offer gentle suggestions, and keep the user motivated. Use emojis and encouraging language.",Lorekeeper:"You are a continuity expert. You are obsessed with consistency in names, dates, world-building rules, and character histories. Flag any contradiction immediately.",Poet:"You are a master of prose. Focus on sensory details, metaphors, rhythm, and emotional resonance. Suggest lyrical improvements."},Lb=(n,e)=>{const t=[...(e==null?void 0:e.map(a=>({sheet:a,scope:"Series"})))||[],...(n==null?void 0:n.map(a=>({sheet:a,scope:"Book"})))||[]];if(t.length===0)return"";let s="",i="";const r=[];t.forEach(a=>{a.sheet.category==="Value System & Beliefs"?s+=`
## ${a.sheet.name} (${a.scope}-level)
${a.sheet.content}`:a.sheet.category==="Plot & Narrative Structure"||a.sheet.category==="Theme & Tone"?i+=`
## ${a.sheet.name} (${a.scope}-level)
${a.sheet.content}`:r.push(a)});let o="";if(i.trim()&&(o+=`

---
NARRATIVE DIRECTIVES:
This is the master guide for the story. ALL generated content must strictly follow these plot, theme, and tone instructions.
`+i.trim()+`
---`),s.trim()&&(o+=`

---
WORLDVIEW LENS:
The following defines the core value system and beliefs of this world. ALL generated content, character motivations, and societal reactions MUST be viewed through this lens.
`+s.trim()+`
---`),r.length>0){const a=r.reduce((l,u)=>(l[u.scope]||(l[u.scope]=[]),l[u.scope].push(`## ${u.sheet.name} (${u.sheet.category})
${u.sheet.content}`),l),{});o+=`

---
WORLD KNOWLEDGE BASE:
You MUST adhere to the facts and descriptions provided in this knowledge base to maintain consistency.
`,a.Series&&(o+=`
### SERIES KNOWLEDGE (Applies to all books in this series)
${a.Series.join(`

`)}
`),a.Book&&(o+=`
### BOOK-SPECIFIC KNOWLEDGE
${a.Book.join(`

`)}
`),o+="---"}return o},UK={name:"updateChapter",description:"Updates the text content of a specific chapter. Use this tool when the user asks you to rewrite, edit, fix, or change the text/prose of a chapter body. You must provide the FULL new HTML content for the chapter.",parameters:{type:_e.OBJECT,properties:{chapterIndex:{type:_e.INTEGER,description:"The zero-based index of the chapter to update."},newContent:{type:_e.STRING,description:"The complete, new HTML content for the chapter."},changeDescription:{type:_e.STRING,description:'A concise summary of what changes were made (e.g., "Rewrote the dialogue to be more tense", "Fixed grammar and pacing").'}},required:["chapterIndex","newContent","changeDescription"]}},$K={name:"updateBookMetadata",description:"Updates the main book details. Use this to change the book title, subtitle, author name, or description.",parameters:{type:_e.OBJECT,properties:{topic:{type:_e.STRING,description:"The new book title."},subtitle:{type:_e.STRING,description:"The new subtitle."},author:{type:_e.STRING,description:"The author name."},description:{type:_e.STRING,description:"The book description."}}}},GK={name:"updateChapterMetadata",description:"Updates the structure/outline of a specific chapter. Use this to rename a chapter, assign it to a different Part, or change its summary.",parameters:{type:_e.OBJECT,properties:{chapterIndex:{type:_e.INTEGER,description:"The zero-based index of the chapter to update."},title:{type:_e.STRING,description:"The new chapter title (heading)."},part:{type:_e.STRING,description:'The Part/Section name (e.g., "Part 1").'},partContent:{type:_e.STRING,description:"Introductory text for the Part."},summary:{type:_e.STRING,description:"The summary of the chapter."}},required:["chapterIndex"]}},VK={name:"addChapter",description:"Adds a new chapter to the book outline.",parameters:{type:_e.OBJECT,properties:{title:{type:_e.STRING,description:"The title of the new chapter."},index:{type:_e.INTEGER,description:"The zero-based index where the chapter should be inserted. If omitted, adds to the end."},part:{type:_e.STRING,description:"The Part this chapter belongs to."},summary:{type:_e.STRING,description:"A summary of the new chapter."}},required:["title"]}},qK={name:"deleteChapter",description:"Deletes a chapter from the book.",parameters:{type:_e.OBJECT,properties:{chapterIndex:{type:_e.INTEGER,description:"The zero-based index of the chapter to delete."}},required:["chapterIndex"]}},WK=async(n,e,t,s,i,r)=>{const o=Ft(),a=e.filter(f=>f.parts&&f.parts.length>0&&f.parts.some(p=>p.text&&p.text.trim()!==""||p.functionCall));let l=`${s||U0["Standard Co-Author"]}
You are assisting the user in writing the book titled "${t.topic}".

${Lb(t.knowledgeBase,t.seriesKnowledgeBase)}

**Book Outline:**
${t.outline.map((f,p)=>`${p+1}. ${f.title}: ${f.summary}`).join(`
`)}
`;t.currentChapter&&(l+=`
**Current Chapter Context:**
You are currently focused on the chapter: "${t.currentChapter.title}".
Here is the current content of this chapter (use this to answer questions or provide specific suggestions):
---
${t.currentChapter.content.substring(0,15e3)}... (truncated)
---
`),l+='\n**Instructions:**\n- Act as a "perfect servant" to the user\'s vision, while offering expert advice based on your persona.\n- If the user asks for ideas, ensure they fit the established outline, characters, and tone.\n- You have the ability to propose edits to the book content using the `updateChapter` tool.\n- **IMPORTANT:** If the user explicitly asks you to "rewrite", "edit", "fix", or "change" the content of the current chapter, you MUST use the `updateChapter` tool to propose the new content.\n- When using `updateChapter`, ensure the `newContent` is the complete, fully formed HTML for the chapter. \n- You also have tools to manage the book structure: `updateBookMetadata` (title, author), `updateChapterMetadata` (chapter titles, parts), `addChapter`, and `deleteChapter`. Use these when the user asks to restructure the book.\n- Format your text responses using Markdown (bold, italics, lists, etc.) for readability.\n';const u=o.chats.create({model:"gemini-2.5-flash",history:a,config:{systemInstruction:l,tools:[{functionDeclarations:[UK,$K,GK,VK,qK]}]}});try{const f=await u.sendMessageStream({message:n});for await(const p of f){const g=p.text;g&&i(g);const b=p.functionCalls;b&&b.length>0&&r(b[0])}return await u.getHistory()}catch(f){throw console.error("Error in chat stream:",f),f}},E3=async(n,e,t,s)=>{const i=Ft();let r=`You are a world-class Book Architect and Creative Consultant. Your goal is to help the user build a complete, robust foundation for a new book.
    
    **Your Process:**
    1.  **Interview:** Ask probing, creative questions to flesh out the core concept, genre, tone, main characters, setting, and central conflict. Do not ask too many questions at once; keep it conversational.
    2.  **Structure:** Once the idea is clear, start suggesting structural elements (Three-Act, Hero's Journey, etc.) and high-level plot points.
    3.  **Refine:** Help the user tighten the premise and character motivations.
    
    **Goal:** By the end of this conversation, you should have enough information to generate a full chapter outline, a list of characters/places for the knowledge base, and style instructions.
    
    Be encouraging, insightful, and proactive. Suggest ideas if the user is stuck.`;s&&(r+=`

INITIAL CONTEXT:
${s}`);const o=i.chats.create({model:"gemini-2.5-flash",history:e,config:{systemInstruction:r}}),a=await o.sendMessageStream({message:n});for await(const l of a)l.text&&t(l.text);return await o.getHistory()},T3=async n=>{const e=Ft(),t=`Analyze the entire brainstorming conversation provided below. Your task is to architect the full book structure based on this discussion.
    
    You must extract and generate:
    1. **Metadata**: Title, Description, Writing Style/Tone instructions.
    2. **Visuals**: Whether to generate images and the art style.
    3. **Outline**: A detailed, chapter-by-chapter outline.
    4. **Knowledge Base**: A comprehensive list of characters, places, and lore mentioned or implied in the chat.

    **Conversation History:**
    ${n.map(s=>`${s.role}: ${s.parts.map(i=>i.text).join("")}`).join(`
`)}

    **Output Requirements:**
    Return a valid JSON object matching this structure exactly:
    {
      "topic": "Book Title",
      "description": "1-2 sentence premise.",
      "instructions": "Detailed writing style, tone, and perspective instructions for the AI author.",
      "generateImages": true/false,
      "imageStyle": "Art style description",
      "outline": [
        {
          "title": "Chapter Title",
          "part": "Part Name (optional)",
          "summary": "Detailed paragraph describing events in this chapter."
        }
      ],
      "knowledgeBase": [
        {
          "name": "Character/Place Name",
          "category": "Character" | "Place" | "Object" | "Event" | "Lore" | "Other",
          "content": "Detailed description of this entity based on the chat."
        }
      ]
    }

    Generate the full JSON now.`;try{const s=await e.models.generateContent({model:"gemini-2.5-flash",contents:t,config:{responseMimeType:"application/json",responseSchema:{type:_e.OBJECT,properties:{topic:{type:_e.STRING},description:{type:_e.STRING},instructions:{type:_e.STRING},generateImages:{type:_e.BOOLEAN},imageStyle:{type:_e.STRING},outline:{type:_e.ARRAY,items:{type:_e.OBJECT,properties:{title:{type:_e.STRING},part:{type:_e.STRING},summary:{type:_e.STRING}},required:["title","summary"]}},knowledgeBase:{type:_e.ARRAY,items:{type:_e.OBJECT,properties:{name:{type:_e.STRING},category:{type:_e.STRING},content:{type:_e.STRING}},required:["name","category","content"]}}},required:["topic","outline","knowledgeBase"]}}}),i=JSON.parse(s.text.trim());return i.knowledgeBase&&(i.knowledgeBase=i.knowledgeBase.map(r=>({...r,id:crypto.randomUUID()}))),i}catch(s){throw console.error("Error generating full book data:",s),new Error("Failed to generate book structure from chat. Please try again.")}},KK=async n=>{const e=await T3(n);return{topic:e.topic,description:e.description,instructions:e.instructions,generateImages:e.generateImages,imageStyle:e.imageStyle}},h_=async(n,e,t)=>{var r,o,a,l,u,f;const s=Ft();let i=n;t&&t.trim()&&(i=`(Perform with the following style: ${t}) ${n}`);try{const g=(f=(u=(l=(a=(o=(r=(await s.models.generateContent({model:"gemini-2.5-flash-preview-tts",contents:[{parts:[{text:i}]}],config:{responseModalities:[H0.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}}}})).candidates)==null?void 0:r[0])==null?void 0:o.content)==null?void 0:a.parts)==null?void 0:l[0])==null?void 0:u.inlineData)==null?void 0:f.data;if(!g)throw new Error("No audio data returned from API.");return g}catch(p){throw console.error("Error generating speech:",p),p instanceof Error&&p.message.includes("API key not valid")?new Error("The Gemini API key is invalid. Please check your settings."):new Error("Failed to generate speech. The service may be busy or unavailable.")}},YK=async(n,e)=>{const t=Ft(),s=`Analyze the following book excerpt and suggest a concise voice style instruction for an audiobook narrator.
    Describe the ideal tone, pace, and emotional delivery.
    Book Topic: "${n}"
    Excerpt: "${e.substring(0,2e3)}"
    Return ONLY the instruction string (e.g., "A warm, soothing voice with a slow pace."). Do not include quotes or intro text.`;try{return(await t.models.generateContent({model:"gemini-2.5-flash",contents:s})).text.trim()}catch(i){return console.error("Error generating voice instructions:",i),"A clear and engaging narration style."}},_3=async(n,e)=>{const t=Ft(),s=`You are an expert prompt engineer. A user has provided an instruction template for an AI author. Your task is to refine and improve this prompt to be clearer, more detailed, and more effective for guiding a large language model.
**Template Name:** "${e}"
**Original Prompt:** "${n}"
**Your Task:**
Rewrite the prompt. Add details, specify output formats if relevant, provide examples, and clarify any ambiguities. The goal is to make the AI's output more consistent and higher quality when using this template. Return ONLY the improved prompt text.`;try{return(await t.models.generateContent({model:"gemini-2.5-flash",contents:s})).text.trim()}catch(i){throw console.error("Error improving instruction prompt:",i),new Error("Failed to generate suggestion for the instruction prompt.")}},JK=async(n,e)=>_3(e,`Book about ${n}`),XK=async(n,e)=>{const t=Ft(),s=`You are a text analysis AI. I have a chapter of a book and a list of topics that were supposed to be covered in it.
For each topic in the plan, determine if the existing chapter content adequately covers it.
Your response MUST be a JSON array of booleans, with the same number of elements as the input topic list. Each boolean should be \`true\` if the topic is covered and \`false\` if it is not.
**Existing Chapter Content:**
---
${n.substring(0,4e3)}
---
**Chapter Plan (Topics to check):**
${e.map((i,r)=>`${r+1}. ${i}`).join(`
`)}
Return ONLY the JSON array.`;try{const i=await t.models.generateContent({model:"gemini-2.5-flash",contents:s,config:{responseMimeType:"application/json",responseSchema:{type:_e.ARRAY,items:{type:_e.BOOLEAN}}}});return JSON.parse(i.text.trim())}catch(i){throw console.error("Error analyzing plan completeness:",i),new Error("AI analysis of the plan failed.")}},QK=async(n,e,t,s)=>{const i=Ft(),r=document.createElement("div");r.innerHTML=n;const o=r.textContent||"",l=`${s||U0["Standard Co-Author"]} Analyze the following chapter from a book and provide feedback.
Your response MUST be a JSON object with two keys: "feedback" (a string with your overall analysis) and "suggestions" (an array of objects, each with "title", "description", and "prompt").
**Book Topic:** ${e.topic}
**Overall Instructions:** ${e.instructions}
${Lb(e.knowledgeBase,t)}
**Chapter Content to Analyze:**
---
${o.substring(0,5e3)}
---
Provide concise, actionable feedback. The suggestions should be things that can be executed by another AI model by using the 'prompt' value.`;try{const u=await i.models.generateContent({model:"gemini-2.5-flash",contents:l,config:{responseMimeType:"application/json",responseSchema:{type:_e.OBJECT,properties:{feedback:{type:_e.STRING},suggestions:{type:_e.ARRAY,items:{type:_e.OBJECT,properties:{title:{type:_e.STRING},description:{type:_e.STRING},prompt:{type:_e.STRING}}}}}}}});return JSON.parse(u.text.trim())}catch(u){throw console.error("Error analyzing chapter content:",u),new Error("AI analysis of the chapter failed.")}},ZK=async(n,e,t)=>{const s=Ft(),i=document.createElement("div");i.innerHTML=n;const r=i.textContent||"",o=`You are an expert developmental editor. Analyze the style and tone of the following book chapter. Compare it against the author's overall instructions and provide specific, actionable suggestions for improvement.
Your response MUST be a JSON array of objects. Each object must have three keys: "originalPassage", "suggestedRewrite", and "explanation".
**Author's Overall Instructions for the Book:** "${t}"
**Book Topic:** "${e}"
**Chapter Content to Analyze:**
---
${r.substring(0,8e3)}
---
**Your Task:**
Identify up to 5 key passages where the writing style or tone deviates from the author's instructions. For each passage:
1. Extract the exact original text into "originalPassage".
2. Provide a rewritten version that better matches the desired style in "suggestedRewrite".
3. Briefly explain why the rewrite is an improvement in "explanation".
If the chapter's style is already excellent, return an empty array [].`;try{const a=await s.models.generateContent({model:"gemini-2.5-flash",contents:o,config:{responseMimeType:"application/json",responseSchema:{type:_e.ARRAY,items:{type:_e.OBJECT,properties:{originalPassage:{type:_e.STRING},suggestedRewrite:{type:_e.STRING},explanation:{type:_e.STRING}},required:["originalPassage","suggestedRewrite","explanation"]}}}});return JSON.parse(a.text.trim())}catch(a){throw console.error("Error analyzing chapter style:",a),new Error("AI analysis of the chapter style failed.")}},eY=async(n,e,t,s)=>{const i=Ft(),r=document.createElement("div");r.innerHTML=n;const o=r.textContent||"",a=`You are a professional author. Rewrite the following chapter content based on the provided instruction.
Return ONLY the rewritten chapter content in valid, semantic HTML format.
**Formatting Rules:** Paragraphs <p>, Lists <ul>/<ol>, Emphasis <strong>/<em>, Blockquotes <blockquote>, Subheadings <h4>, Breaks <hr />. Preserve Images.
**Book Topic:** ${e.topic}
**Overall Style:** ${e.instructions}
${Lb(e.knowledgeBase,t)}
**Rewrite Instruction:** "${s}"
**Original Chapter Content:**
---
${o.substring(0,5e3)}
---
Now, provide the rewritten HTML content adhering to the formatting rules.`;try{return(await i.models.generateContent({model:"gemini-2.5-flash",contents:a})).text.trim()}catch(l){throw console.error("Error rewriting chapter with prompt:",l),new Error("AI failed to rewrite the chapter.")}},tY=async n=>{const e=Ft(),t=`Analyze the pacing and flow of the following text.
Return a JSON object with: "sentenceLengthHistogram", "dialogueRatio", "pacingFeedback".
**Text:** "${n.substring(0,1e4)}"`;try{const s=await e.models.generateContent({model:"gemini-2.5-flash",contents:t,config:{responseMimeType:"application/json",responseSchema:{type:_e.OBJECT,properties:{sentenceLengthHistogram:{type:_e.ARRAY,items:{type:_e.OBJECT,properties:{range:{type:_e.STRING},count:{type:_e.INTEGER}}}},dialogueRatio:{type:_e.NUMBER},pacingFeedback:{type:_e.STRING}},required:["sentenceLengthHistogram","dialogueRatio","pacingFeedback"]}}});return JSON.parse(s.text.trim())}catch(s){return console.error("Error analyzing pacing:",s),{sentenceLengthHistogram:[{range:"Error",count:0}],dialogueRatio:0,pacingFeedback:"Could not analyze pacing."}}},nY=async n=>{const e=Ft(),t=`Analyze the text for "telling" instead of "showing". Identify up to 3 instances. Return JSON array: "passage", "suggestion".
**Text:** "${n.substring(0,1e4)}"`;try{const s=await e.models.generateContent({model:"gemini-2.5-flash",contents:t,config:{responseMimeType:"application/json",responseSchema:{type:_e.ARRAY,items:{type:_e.OBJECT,properties:{passage:{type:_e.STRING},suggestion:{type:_e.STRING}},required:["passage","suggestion"]}}}});return JSON.parse(s.text.trim())}catch(s){return console.error("Error analyzing show vs tell:",s),[]}},sY=async n=>{const e=Ft(),t=`Read the following opening of a chapter. Generate 3 alternative opening paragraphs. Return JSON array of strings.
**Current Opening:** "${n.substring(0,1e3)}"`;try{const s=await e.models.generateContent({model:"gemini-2.5-flash",contents:t,config:{responseMimeType:"application/json",responseSchema:{type:_e.ARRAY,items:{type:_e.STRING}}}});return JSON.parse(s.text.trim())}catch(s){return console.error("Error generating alternative openings:",s),["Could not generate openings."]}},iY=async(n,e,t,s)=>{const i=Ft(),o=`You are a continuity editor. Check the provided chapter text for consistency errors against the series context. Return JSON array: "inconsistentPassage", "contradictionSource", "explanation".
**Context:** ${`**Series Title:** ${s.title}
**Current Book:** ${e.topic}
**Series Knowledge Base:** ${(s.sharedKnowledgeBase||[]).map(a=>`- ${a.name}: ${a.content}`).join(`
`)}
**Other Books:** ${t.map(a=>`- ${a.topic}: ${a.description}`).join(`
`)}`}
**Chapter Text:** "${n.substring(0,15e3)}"`;try{const a=await i.models.generateContent({model:"gemini-2.5-flash",contents:o,config:{responseMimeType:"application/json",responseSchema:{type:_e.ARRAY,items:{type:_e.OBJECT,properties:{inconsistentPassage:{type:_e.STRING},contradictionSource:{type:_e.STRING},explanation:{type:_e.STRING}},required:["inconsistentPassage","contradictionSource","explanation"]}}}});return JSON.parse(a.text.trim())}catch(a){return console.error("Error analyzing series consistency:",a),[]}},rY=async(n,e)=>{const t=Ft(),s=e.filter(o=>o.category==="Character");if(s.length===0)return[];const r=`You are a dialogue coach and character editor. Analyze the following chapter text specifically for character voice consistency.
    
    **Characters:**
    ${s.map(o=>`- ${o.name}: ${o.content}`).join(`
`)}
    
    **Chapter Text:**
    "${n.substring(0,2e4)}"
    
    **Task:**
    Identify up to 5 instances where a character's dialogue does NOT match their established voice, personality, or background as described.
    
    Return a JSON array of objects with:
    - "characterName": The name of the character speaking.
    - "dialogue": The specific line of dialogue that is out of character.
    - "inconsistencyReason": Why this doesn't sound like them.
    - "suggestedFix": A rewritten version of the dialogue that fits their voice better.
    
    If all dialogue is consistent, return an empty array.`;try{const o=await t.models.generateContent({model:"gemini-2.5-flash",contents:r,config:{responseMimeType:"application/json",responseSchema:{type:_e.ARRAY,items:{type:_e.OBJECT,properties:{characterName:{type:_e.STRING},dialogue:{type:_e.STRING},inconsistencyReason:{type:_e.STRING},suggestedFix:{type:_e.STRING}},required:["characterName","dialogue","inconsistencyReason","suggestedFix"]}}}});return JSON.parse(o.text.trim())}catch(o){return console.error("Error analyzing character voice:",o),[]}},oY=async(n,e,t)=>{const s=Ft(),i=e.map((a,l)=>`${l+1}. ${a.title}: ${a.summary}`).join(`
`),r=t.map(a=>`- ${a.name} (${a.category}): ${a.content}`).join(`
`),o=`You are a narrative consistency checker and plot hole detector.
    
    **Story Outline:**
    ${i}
    
    **World Knowledge:**
    ${r}
    
    **Current Chapter Content:**
    "${n.substring(0,2e4)}"
    
    **Task:**
    Analyze the current chapter content for logical inconsistencies, contradictions with the outline or world rules, or unexplained events.
    
    Return a JSON array of objects with:
    - "issue": A brief title for the plot hole.
    - "location": The specific part of the text (quote) where the issue occurs.
    - "severity": "High", "Medium", or "Low".
    - "explanation": Detailed explanation of why this is a plot hole.
    - "suggestion": How to fix it.
    
    If no plot holes are found, return an empty array.`;try{const a=await s.models.generateContent({model:"gemini-2.5-flash",contents:o,config:{responseMimeType:"application/json",responseSchema:{type:_e.ARRAY,items:{type:_e.OBJECT,properties:{issue:{type:_e.STRING},location:{type:_e.STRING},severity:{type:_e.STRING},explanation:{type:_e.STRING},suggestion:{type:_e.STRING}},required:["issue","location","severity","explanation","suggestion"]}}}});return JSON.parse(a.text.trim())}catch(a){return console.error("Error analyzing plot holes:",a),[]}},aY=async(n,e)=>{const t=Ft(),i=`You are a world-building and lore consistency expert.
    
    **World Knowledge Base:**
    ${e.map(r=>`- ${r.name} (${r.category}): ${r.content}`).join(`
`)}
    
    **Chapter Text:**
    "${n.substring(0,2e4)}"
    
    **Task:**
    Analyze the chapter text specifically for contradictions with the established knowledge base (facts, history, character traits, magic rules, etc.).
    
    Return a JSON array of objects with:
    - "passage": The quote from the text containing the error.
    - "contradiction": Explanation of why it contradicts the lore.
    - "knowledgeSheetName": The name of the Knowledge Base entry it contradicts.
    - "suggestion": A rewritten version of the passage that fixes the error.
    
    If no inconsistencies are found, return an empty array.`;try{const r=await t.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{responseMimeType:"application/json",responseSchema:{type:_e.ARRAY,items:{type:_e.OBJECT,properties:{passage:{type:_e.STRING},contradiction:{type:_e.STRING},knowledgeSheetName:{type:_e.STRING},suggestion:{type:_e.STRING}},required:["passage","contradiction","knowledgeSheetName","suggestion"]}}}});return JSON.parse(r.text.trim())}catch(r){return console.error("Error analyzing lore consistency:",r),[]}},M3=async(n,e)=>{var i;const t=Ft(),s=`You are a helpful co-author. Complete the following sentence or paragraph naturally, maintaining the author's style.
    
    **Style Instructions:** ${e}
    
    **Preceding Context:**
    "${n.slice(-1e3)}"
    
    Return ONLY the completion text. Do not repeat the context. Keep it concise (1-2 sentences).`;try{return((i=(await t.models.generateContent({model:"gemini-2.5-flash",contents:s,config:{maxOutputTokens:100}})).text)==null?void 0:i.trim())||""}catch(r){return console.warn("Prediction failed",r),""}},Mj=async(n,e,t,s,i,r,o,a="en")=>{const l=Ft(),u=Lb(t,s),f=`Write the full content for the following chapter.
    **Book Topic:** ${n}
    **Chapter Title:** ${i.title}
    **Chapter Summary:** ${i.summary}
    **Writing Style:** ${e}
    ${u}
    
    Write the content in HTML format suitable for a book (using <p>, <h2>, etc.). Do not include the chapter title as an <h1>, start directly with the content.`,g=await l.chats.create({model:"gemini-2.5-flash",history:r}).sendMessageStream({message:f});for await(const b of g)b.text&&o(b.text)},f_=async(n,e)=>{const t=Ft(),s=`You are a literary analyst AI. Read the book content and extract important entities for a knowledge base.
Return JSON array of objects: "name", "content", "category" ('Character', 'Place', 'Object', 'Event', 'Lore', 'Other').
**Book Topic:** ${n}
**Content:** "${e.substring(0,2e4)}"`;try{const i=await t.models.generateContent({model:"gemini-2.5-flash",contents:s,config:{responseMimeType:"application/json",responseSchema:{type:_e.ARRAY,items:{type:_e.OBJECT,properties:{name:{type:_e.STRING},content:{type:_e.STRING},category:{type:_e.STRING}},required:["name","content","category"]}}}});return JSON.parse(i.text.trim()).map(o=>({...o,id:crypto.randomUUID()})).filter(o=>["Character","Place","Object","Event","Lore","Other"].includes(o.category))}catch(i){throw console.error("Error auto-filling knowledge base:",i),new Error("AI failed to extract knowledge from content.")}},lY=async n=>p_(n,""),cY=async(n,e)=>(await Ft().models.generateContent({model:"gemini-2.5-flash",contents:`Rephrase: "${n}"
Context: "${e.substring(0,1e3)}"`})).text.trim(),dY=async(n,e)=>(await Ft().models.generateContent({model:"gemini-2.5-flash",contents:`Expand: "${n}"
Context: "${e.substring(0,1e3)}"`})).text.trim(),uY=async n=>(await Ft().models.generateContent({model:"gemini-2.5-flash",contents:`Summarize: "${n}"`})).text.trim(),hY=async(n,e,t)=>(await Ft().models.generateContent({model:"gemini-2.5-flash",contents:`Rewrite to ${e} tone: "${n}"
Context: "${t.substring(0,1e3)}"`})).text.trim(),fY=async n=>({text:(await Ft().models.generateContent({model:"gemini-2.5-flash",contents:n})).text.trim(),sources:[]}),wA=async(n,e,t,s,i,r=[],o=4)=>{const l=await Ft().models.generateContent({model:"gemini-2.5-flash",contents:`Generate ${o} book angles. Topic: ${n}. Instructions: ${e}. Format: JSON array of strings.`,config:{responseMimeType:"application/json",responseSchema:{type:_e.ARRAY,items:{type:_e.STRING}}}});return JSON.parse(l.text.trim())},pY=async(n,e,t,s,i,r)=>(await Ft().models.generateContent({model:"gemini-2.5-flash",contents:`Synthesize these angles into one: ${r.join(", ")}. Topic: ${n}.`})).text.trim(),kA=async(n,e,t,s,i,r,o=[],a=4)=>{const u=await Ft().models.generateContent({model:"gemini-2.5-flash",contents:`Generate ${a} book parts. Topic: ${n}. Angle: ${t}. Format: JSON array of strings.`,config:{responseMimeType:"application/json",responseSchema:{type:_e.ARRAY,items:{type:_e.STRING}}}});return JSON.parse(u.text.trim())},mY=async(n,e,t,s,i,r,o)=>(await Ft().models.generateContent({model:"gemini-2.5-flash",contents:`Synthesize these parts into one: ${o.join(", ")}. Topic: ${n}. Angle: ${t}.`})).text.trim(),gY=async(n,e,t,s,i,r,o)=>{const l=await Ft().models.generateContent({model:"gemini-2.5-flash",contents:`Generate a book outline JSON. Topic: ${n}. Angle: ${t}. Structure: ${i.map(u=>u.title).join(", ")}.`,config:{responseMimeType:"application/json",responseSchema:{type:_e.ARRAY,items:{type:_e.OBJECT,properties:{part:{type:_e.STRING},title:{type:_e.STRING},summary:{type:_e.STRING}},required:["title","summary"]}}}});return JSON.parse(l.text.trim())},xY=async(n,e)=>{const s=await Ft().models.generateContent({model:"gemini-2.5-flash",contents:`Generate 3 ${e} ideas for book "${n.topic}". Format: JSON string array.`,config:{responseMimeType:"application/json",responseSchema:{type:_e.ARRAY,items:{type:_e.STRING}}}});return JSON.parse(s.text.trim())},bY=async(n,e,t)=>{const s=Ft();try{const i=await s.models.generateContent({model:"gemini-2.5-flash",contents:`Breakdown chapter "${t.title}": ${t.summary}. 3-5 steps. JSON string array.`,config:{responseMimeType:"application/json",responseSchema:{type:_e.ARRAY,items:{type:_e.STRING}}}});return JSON.parse(i.text.trim())}catch{return[t.summary]}},p_=async(n,e)=>{var i,r,o;const s=await Ft().models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{text:`Book Cover. Title: ${n}. Style: ${e}`}]},config:{imageConfig:{aspectRatio:"1:1"}}});for(const a of((o=(r=(i=s.candidates)==null?void 0:i[0])==null?void 0:r.content)==null?void 0:o.parts)||[])if(a.inlineData)return`data:${a.inlineData.mimeType||"image/png"};base64,${a.inlineData.data}`;throw new Error("No image")},R3=async(n,e)=>{var i,r,o;const s=await Ft().models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:"image/png",data:n.split(",")[1]}},{text:e}]}});for(const a of((o=(r=(i=s.candidates)==null?void 0:i[0])==null?void 0:r.content)==null?void 0:o.parts)||[])if(a.inlineData)return`data:${a.inlineData.mimeType||"image/png"};base64,${a.inlineData.data}`;throw new Error("No image")},yY=async(n,e,t)=>{var r,o,a;const i=await Ft().models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{text:`${n}. Style: ${e}`}]},config:{imageConfig:{aspectRatio:t}}});for(const l of((a=(o=(r=i.candidates)==null?void 0:r[0])==null?void 0:o.content)==null?void 0:a.parts)||[])if(l.inlineData)return`data:${l.inlineData.mimeType||"image/png"};base64,${l.inlineData.data}`;throw new Error("No image")},vY=R3,wY=async(n,e,t,s,i,r,o,a,l="en")=>{const u=Ft(),f=`Write a section of a chapter.
**Book:** ${n}
**Chapter:** ${i.title} - ${i.summary}
**Section Topic:** ${r}
**Style:** ${e}
${Lb(t,s)}
Write ONLY the content for this section in HTML.`,p=await u.models.generateContentStream({model:"gemini-2.5-flash",contents:[{role:"user",parts:[{text:f}]}]});let g="";for await(const b of p){const w=b.text;w&&(g+=w,a(w))}return{newContent:g}};function kY(n){const e=atob(n),t=e.length,s=new Uint8Array(t);for(let i=0;i<t;i++)s[i]=e.charCodeAt(i);return s}async function SY(n,e,t,s){const i=new Int16Array(n.buffer),r=i.length/s,o=e.createBuffer(s,r,t);for(let a=0;a<s;a++){const l=o.getChannelData(a);for(let u=0;u<r;u++)l[u]=i[u*s+a]/32768}return o}class CY{constructor(e){this._audioContext=null,this._gainNode=null,this._volume=1,this._currentSource=null,this._audioQueue=[],this._audioBufferQueue=new Map,this._currentQueueIndex=0,this._isStopping=!1,this._isBuffering=!1,this._book=null,this.BUFFER_LOOKAHEAD=5,this.onStateChange=e,this._state={playbackState:"stopped",bookId:null,bookTitle:null,currentChapterIndex:-1,currentChapterTitle:null,currentParagraphIndex:-1,chapterProgress:0,playbackRate:1,totalParagraphsInChapter:0}}_setState(e){this._state={...this._state,...e},this.onStateChange(this._state)}async play(e,t){if(this._state.playbackState!=="stopped"&&await this.stop(),this._isStopping=!1,this._book=e,this._setState({playbackState:"loading",bookId:e.id,bookTitle:e.topic}),this._audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3}),this._gainNode=this._audioContext.createGain(),this._gainNode.gain.value=this._volume,this._gainNode.connect(this._audioContext.destination),this._buildQueue(e,t),this._currentQueueIndex=0,this._audioBufferQueue.clear(),this._audioQueue.length===0){te.info("No text content found to play."),this.stop();return}this._playNext(),this._fillBuffer()}stop(){if(this._isStopping=!0,this._currentSource){this._currentSource.onended=null;try{this._currentSource.stop()}catch{}this._currentSource=null}this._audioContext&&(this._audioContext.close(),this._audioContext=null,this._gainNode=null),this._audioQueue=[],this._audioBufferQueue.clear(),this._book=null,this._isBuffering=!1,this._setState({playbackState:"stopped",bookId:null,bookTitle:null,currentChapterIndex:-1,currentChapterTitle:null,currentParagraphIndex:-1,chapterProgress:0,totalParagraphsInChapter:0})}pause(){this._audioContext&&this._state.playbackState==="playing"&&(this._audioContext.suspend(),this._setState({playbackState:"paused"}))}resume(){this._audioContext&&this._state.playbackState==="paused"&&(this._audioContext.resume(),this._setState({playbackState:"playing"}))}setPlaybackRate(e){this._setState({playbackRate:e}),this._currentSource&&(this._currentSource.playbackRate.value=e)}setVolume(e){this._volume=Math.max(0,Math.min(1,e)),this._gainNode&&(this._gainNode.gain.value=this._volume)}skipChapter(e){var r;if(this._isStopping||this._audioQueue.length===0)return;const t=(r=this._audioQueue[this._currentQueueIndex])==null?void 0:r.chapterIndex;if(t===void 0)return;const s=e==="next"?t+1:t-1,i=this._audioQueue.findIndex(o=>o.chapterIndex===s);i!==-1?(this._currentSource&&(this._currentSource.onended=null,this._currentSource.stop()),this._currentQueueIndex=i,this._playNext()):e==="next"&&this.stop()}skipParagraph(e){if(this._isStopping)return;const t=this._currentQueueIndex+(e==="next"?1:-1);t>=0&&t<this._audioQueue.length?(this._currentSource&&(this._currentSource.onended=null,this._currentSource.stop()),this._currentQueueIndex=t,this._playNext()):e==="next"&&this.stop()}jumpToParagraph(e){const{currentChapterIndex:t}=this._state;if(this._isStopping||t===-1)return;const s=this._audioQueue.findIndex(r=>r.chapterIndex===t);if(s===-1)return;const i=s+e;i>=0&&i<this._audioQueue.length&&(this._currentSource&&(this._currentSource.onended=null,this._currentSource.stop()),this._currentQueueIndex=i,this._playNext())}_buildQueue(e,t){const s=[];e.content.slice(t).forEach((i,r)=>{const o=t+r;if(!i)return;const a=document.createElement("div");a.innerHTML=i.htmlContent;let l=0;a.querySelectorAll("p, h1, h2, h3, h4, li").forEach(u=>{const f=u.textContent||"";if(f.trim().length>10){const p=`${e.id}-${o}-${l}`;s.push({text:f.trim(),chapterIndex:o,paragraphIndex:l,bookId:e.id,key:p}),l++}})}),this._audioQueue=s}async _fillBuffer(){if(!this._isBuffering){for(this._isBuffering=!0;!this._isStopping&&this._currentQueueIndex<this._audioQueue.length;){const e=this._currentQueueIndex+this.BUFFER_LOOKAHEAD,s=this._audioQueue.slice(this._currentQueueIndex,e).filter(r=>r&&!this._audioBufferQueue.has(r.key)).map(r=>this._fetchAndCacheAudio(r));s.length>0&&await Promise.allSettled(s);const i=this._audioQueue[this._currentQueueIndex];this._state.playbackState==="buffering"&&i&&this._audioBufferQueue.has(i.key)&&this._playNext(),await new Promise(r=>setTimeout(r,200))}this._isBuffering=!1}}async _fetchAudioWithRetries(e){let s=0;for(;s<3;)try{return await h_(e,"Kore")}catch(i){if(s++,s>=3)throw i;const r=Math.pow(2,s-1)*1e3+Math.random()*250;console.warn(`Audio generation failed (attempt ${s}/3). Retrying in ${Math.round(r)}ms...`,i),await new Promise(o=>setTimeout(o,r))}throw new Error("Audio generation failed after multiple retries.")}_gracefulFallback(e){console.error("Audio generation failed permanently after retries. Pausing playback.",e);try{const t=new SpeechSynthesisUtterance("Sorry, I'm having trouble loading the next section. Playback has been paused.");window.speechSynthesis.speak(t)}catch(t){console.warn("SpeechSynthesis fallback failed.",t)}this.pause()}async _fetchAndCacheAudio(e){if(!(!this._audioContext||this._isStopping))try{const t=await Te.audioCache.get(e.key);let s;if(t)s=new Uint8Array(t);else try{const i=await this._fetchAudioWithRetries(e.text);s=kY(i),Te.audioCache.put(e.key,s.buffer).catch(r=>console.warn("Failed to cache audio",r))}catch(i){throw this._gracefulFallback(i),i}if(this._audioContext&&!this._isStopping){const i=await SY(s,this._audioContext,24e3,1);this._isStopping||this._audioBufferQueue.set(e.key,i)}}catch(t){console.error(`Skipping audio item due to processing failure: ${e.key}`,t)}}async _playNext(){var a,l;if(this._isStopping||this._currentQueueIndex>=this._audioQueue.length){this.stop();return}const e=this._audioQueue[this._currentQueueIndex],t=this._audioBufferQueue.get(e.key);if(!t){this._setState({playbackState:"buffering"});return}const i=this._state.currentChapterIndex!==e.chapterIndex?this._audioQueue.filter(u=>u.chapterIndex===e.chapterIndex).length:this._state.totalParagraphsInChapter,r=this._audioQueue.slice(0,this._currentQueueIndex+1).filter(u=>u.chapterIndex===e.chapterIndex).length-1;this._setState({playbackState:"playing",currentChapterIndex:e.chapterIndex,currentChapterTitle:((l=(a=this._book)==null?void 0:a.outline[e.chapterIndex])==null?void 0:l.title)||null,currentParagraphIndex:e.paragraphIndex,chapterProgress:i>0?(r+1)/i*100:0,totalParagraphsInChapter:i});const o=this._audioContext.createBufferSource();this._currentSource=o,o.buffer=t,o.playbackRate.value=this._state.playbackRate,o.connect(this._gainNode),o.start(),o.onended=()=>{this._isStopping||(this._currentQueueIndex++,this._audioBufferQueue.delete(e.key),this._playNext())}}}var I3=Symbol.for("immer-nothing"),Rj=Symbol.for("immer-draftable"),Dr=Symbol.for("immer-state");function Po(n,...e){throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var $0=Object.getPrototypeOf;function Nm(n){return!!n&&!!n[Dr]}function Fh(n){var e;return n?z3(n)||Array.isArray(n)||!!n[Rj]||!!((e=n.constructor)!=null&&e[Rj])||Ob(n)||ES(n):!1}var AY=Object.prototype.constructor.toString(),Ij=new WeakMap;function z3(n){if(!n||typeof n!="object")return!1;const e=Object.getPrototypeOf(n);if(e===null||e===Object.prototype)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;if(t===Object)return!0;if(typeof t!="function")return!1;let s=Ij.get(t);return s===void 0&&(s=Function.toString.call(t),Ij.set(t,s)),s===AY}function Hw(n,e,t=!0){NS(n)===0?(t?Reflect.ownKeys(n):Object.keys(n)).forEach(i=>{e(i,n[i],n)}):n.forEach((s,i)=>e(i,s,n))}function NS(n){const e=n[Dr];return e?e.type_:Array.isArray(n)?1:Ob(n)?2:ES(n)?3:0}function PN(n,e){return NS(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function D3(n,e,t){const s=NS(n);s===2?n.set(e,t):s===3?n.add(t):n[e]=t}function NY(n,e){return n===e?n!==0||1/n===1/e:n!==n&&e!==e}function Ob(n){return n instanceof Map}function ES(n){return n instanceof Set}function xu(n){return n.copy_||n.base_}function LN(n,e){if(Ob(n))return new Map(n);if(ES(n))return new Set(n);if(Array.isArray(n))return Array.prototype.slice.call(n);const t=z3(n);if(e===!0||e==="class_only"&&!t){const s=Object.getOwnPropertyDescriptors(n);delete s[Dr];let i=Reflect.ownKeys(s);for(let r=0;r<i.length;r++){const o=i[r],a=s[o];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(s[o]={configurable:!0,writable:!0,enumerable:a.enumerable,value:n[o]})}return Object.create($0(n),s)}else{const s=$0(n);if(s!==null&&t)return{...n};const i=Object.create(s);return Object.assign(i,n)}}function m_(n,e=!1){return TS(n)||Nm(n)||!Fh(n)||(NS(n)>1&&Object.defineProperties(n,{set:yv,add:yv,clear:yv,delete:yv}),Object.freeze(n),e&&Object.values(n).forEach(t=>m_(t,!0))),n}function EY(){Po(2)}var yv={value:EY};function TS(n){return n===null||typeof n!="object"?!0:Object.isFrozen(n)}var TY={};function Hh(n){const e=TY[n];return e||Po(0,n),e}var G0;function j3(){return G0}function _Y(n,e){return{drafts_:[],parent_:n,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function zj(n,e){e&&(Hh("Patches"),n.patches_=[],n.inversePatches_=[],n.patchListener_=e)}function ON(n){BN(n),n.drafts_.forEach(MY),n.drafts_=null}function BN(n){n===G0&&(G0=n.parent_)}function Dj(n){return G0=_Y(G0,n)}function MY(n){const e=n[Dr];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function jj(n,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return n!==void 0&&n!==t?(t[Dr].modified_&&(ON(e),Po(4)),Fh(n)&&(n=Uw(e,n),e.parent_||$w(e,n)),e.patches_&&Hh("Patches").generateReplacementPatches_(t[Dr].base_,n,e.patches_,e.inversePatches_)):n=Uw(e,t,[]),ON(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),n!==I3?n:void 0}function Uw(n,e,t){if(TS(e))return e;const s=n.immer_.shouldUseStrictIteration(),i=e[Dr];if(!i)return Hw(e,(r,o)=>Pj(n,i,e,r,o,t),s),e;if(i.scope_!==n)return e;if(!i.modified_)return $w(n,i.base_,!0),i.base_;if(!i.finalized_){i.finalized_=!0,i.scope_.unfinalizedDrafts_--;const r=i.copy_;let o=r,a=!1;i.type_===3&&(o=new Set(r),r.clear(),a=!0),Hw(o,(l,u)=>Pj(n,i,r,l,u,t,a),s),$w(n,r,!1),t&&n.patches_&&Hh("Patches").generatePatches_(i,t,n.patches_,n.inversePatches_)}return i.copy_}function Pj(n,e,t,s,i,r,o){if(i==null||typeof i!="object"&&!o)return;const a=TS(i);if(!(a&&!o)){if(Nm(i)){const l=r&&e&&e.type_!==3&&!PN(e.assigned_,s)?r.concat(s):void 0,u=Uw(n,i,l);if(D3(t,s,u),Nm(u))n.canAutoFreeze_=!1;else return}else o&&t.add(i);if(Fh(i)&&!a){if(!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1||e&&e.base_&&e.base_[s]===i&&a)return;Uw(n,i),(!e||!e.scope_.parent_)&&typeof s!="symbol"&&(Ob(t)?t.has(s):Object.prototype.propertyIsEnumerable.call(t,s))&&$w(n,i)}}}function $w(n,e,t=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&m_(e,t)}function RY(n,e){const t=Array.isArray(n),s={type_:t?1:0,scope_:e?e.scope_:j3(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=s,r=g_;t&&(i=[s],r=V0);const{revoke:o,proxy:a}=Proxy.revocable(i,r);return s.draft_=a,s.revoke_=o,a}var g_={get(n,e){if(e===Dr)return n;const t=xu(n);if(!PN(t,e))return IY(n,t,e);const s=t[e];return n.finalized_||!Fh(s)?s:s===SA(n.base_,e)?(CA(n),n.copy_[e]=HN(s,n)):s},has(n,e){return e in xu(n)},ownKeys(n){return Reflect.ownKeys(xu(n))},set(n,e,t){const s=P3(xu(n),e);if(s!=null&&s.set)return s.set.call(n.draft_,t),!0;if(!n.modified_){const i=SA(xu(n),e),r=i==null?void 0:i[Dr];if(r&&r.base_===t)return n.copy_[e]=t,n.assigned_[e]=!1,!0;if(NY(t,i)&&(t!==void 0||PN(n.base_,e)))return!0;CA(n),FN(n)}return n.copy_[e]===t&&(t!==void 0||e in n.copy_)||Number.isNaN(t)&&Number.isNaN(n.copy_[e])||(n.copy_[e]=t,n.assigned_[e]=!0),!0},deleteProperty(n,e){return SA(n.base_,e)!==void 0||e in n.base_?(n.assigned_[e]=!1,CA(n),FN(n)):delete n.assigned_[e],n.copy_&&delete n.copy_[e],!0},getOwnPropertyDescriptor(n,e){const t=xu(n),s=Reflect.getOwnPropertyDescriptor(t,e);return s&&{writable:!0,configurable:n.type_!==1||e!=="length",enumerable:s.enumerable,value:t[e]}},defineProperty(){Po(11)},getPrototypeOf(n){return $0(n.base_)},setPrototypeOf(){Po(12)}},V0={};Hw(g_,(n,e)=>{V0[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});V0.deleteProperty=function(n,e){return V0.set.call(this,n,e,void 0)};V0.set=function(n,e,t){return g_.set.call(this,n[0],e,t,n[0])};function SA(n,e){const t=n[Dr];return(t?xu(t):n)[e]}function IY(n,e,t){var i;const s=P3(e,t);return s?"value"in s?s.value:(i=s.get)==null?void 0:i.call(n.draft_):void 0}function P3(n,e){if(!(e in n))return;let t=$0(n);for(;t;){const s=Object.getOwnPropertyDescriptor(t,e);if(s)return s;t=$0(t)}}function FN(n){n.modified_||(n.modified_=!0,n.parent_&&FN(n.parent_))}function CA(n){n.copy_||(n.copy_=LN(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var zY=class{constructor(n){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(e,t,s)=>{if(typeof e=="function"&&typeof t!="function"){const r=t;t=e;const o=this;return function(l=r,...u){return o.produce(l,f=>t.call(this,f,...u))}}typeof t!="function"&&Po(6),s!==void 0&&typeof s!="function"&&Po(7);let i;if(Fh(e)){const r=Dj(this),o=HN(e,void 0);let a=!0;try{i=t(o),a=!1}finally{a?ON(r):BN(r)}return zj(r,s),jj(i,r)}else if(!e||typeof e!="object"){if(i=t(e),i===void 0&&(i=e),i===I3&&(i=void 0),this.autoFreeze_&&m_(i,!0),s){const r=[],o=[];Hh("Patches").generateReplacementPatches_(e,i,r,o),s(r,o)}return i}else Po(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(o,...a)=>this.produceWithPatches(o,l=>e(l,...a));let s,i;return[this.produce(e,t,(o,a)=>{s=o,i=a}),s,i]},typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze),typeof(n==null?void 0:n.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(n.useStrictShallowCopy),typeof(n==null?void 0:n.useStrictIteration)=="boolean"&&this.setUseStrictIteration(n.useStrictIteration)}createDraft(n){Fh(n)||Po(8),Nm(n)&&(n=DY(n));const e=Dj(this),t=HN(n,void 0);return t[Dr].isManual_=!0,BN(e),t}finishDraft(n,e){const t=n&&n[Dr];(!t||!t.isManual_)&&Po(9);const{scope_:s}=t;return zj(s,e),jj(void 0,s)}setAutoFreeze(n){this.autoFreeze_=n}setUseStrictShallowCopy(n){this.useStrictShallowCopy_=n}setUseStrictIteration(n){this.useStrictIteration_=n}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(n,e){let t;for(t=e.length-1;t>=0;t--){const i=e[t];if(i.path.length===0&&i.op==="replace"){n=i.value;break}}t>-1&&(e=e.slice(t+1));const s=Hh("Patches").applyPatches_;return Nm(n)?s(n,e):this.produce(n,i=>s(i,e))}};function HN(n,e){const t=Ob(n)?Hh("MapSet").proxyMap_(n,e):ES(n)?Hh("MapSet").proxySet_(n,e):RY(n,e);return(e?e.scope_:j3()).drafts_.push(t),t}function DY(n){return Nm(n)||Po(10,n),L3(n)}function L3(n){if(!Fh(n)||TS(n))return n;const e=n[Dr];let t,s=!0;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=LN(n,e.scope_.immer_.useStrictShallowCopy_),s=e.scope_.immer_.shouldUseStrictIteration()}else t=LN(n,!0);return Hw(t,(i,r)=>{D3(t,i,L3(r))},s),e&&(e.finalized_=!1),t}var jY=new zY,Is=jY.produce;const rs=T.createContext(void 0),PY=({children:n})=>{const[e,t]=T.useState([]),[s,i]=T.useState([]),[r,o]=T.useState([]),[a,l]=T.useState([]),[u,f]=T.useState("google_drive"),[p,g]=T.useState({playbackState:"stopped",bookId:null,bookTitle:null,currentChapterIndex:-1,currentChapterTitle:null,currentParagraphIndex:-1,chapterProgress:0,playbackRate:1,totalParagraphsInChapter:0}),b=FK(),w=T.useMemo(()=>new CY(g),[]),S=T.useCallback(async()=>{try{await Te.init();const[F,J,ie,pe,ue]=await Promise.all([Te.books.getAll(),Te.series.getAll(),Te.macros.getAll(),Te.documents.getAll(),Te.settings.get("syncProvider")]);t(F.sort((ke,re)=>re.updatedAt-ke.updatedAt)),o(J),l(ie),i(pe.sort((ke,re)=>re.updatedAt-ke.updatedAt)),ue&&f(ue.value)}catch(F){te.error(`Failed to load data: ${F.message}`)}},[]);T.useEffect(()=>{S();const F=()=>{te.error("Database updated in another tab. Please reload.")};return window.addEventListener("dbversionchange",F),()=>window.removeEventListener("dbversionchange",F)},[S]);const N=T.useCallback(async F=>{await Te.settings.put({id:"syncProvider",value:F}),f(F)},[]),C=T.useCallback(async F=>{await Te.books.put({...F,updatedAt:Date.now()}),await S()},[S]),M=T.useCallback(async(F={})=>{const J={id:crypto.randomUUID(),topic:"New Book",instructions:"",generateImages:!1,imageGenerationInstructions:"Photorealistic, cinematic lighting, epic fantasy",status:"configuring",outline:[],content:[],createdAt:Date.now(),updatedAt:Date.now(),language:"en",bookChatHistory:[],...F};return await Te.books.put(J),await S(),J.id},[S]),R=T.useCallback(async(F,J=!1)=>{const ie=e.find(ue=>ue.id===F);if(!ie||!ie.seriesId)return;const pe=r.find(ue=>ue.id===ie.seriesId);if(pe){const ue=pe.bookIds.filter(ke=>ke!==F);if(ue.length<=1){if(await Te.series.delete(pe.id),ue.length===1){const ke=e.find(re=>re.id===ue[0]);ke&&await Te.books.put({...ke,seriesId:void 0,seriesName:void 0})}te.info(`Series "${pe.title}" dissolved.`)}else await Te.series.put({...pe,bookIds:ue})}J||await Te.books.put({...ie,seriesId:void 0,seriesName:void 0}),await S()},[e,r,S]),_=T.useCallback(async F=>{const J=e.find(ie=>ie.id===F);if(J){if(J.deletedAt){await R(F,!0),await Te.books.delete(F);const ie=await Te.snapshots.getAllForBook(F);for(const pe of ie)await Te.snapshots.delete(pe.id);te.info("Book permanently deleted.")}else await Te.books.put({...J,deletedAt:Date.now()}),te.info("Book moved to trash.");await S()}},[e,S,R]),j=T.useCallback(async F=>{const J=e.find(ie=>ie.id===F);if(J){if(J.deletedAt){const ie={...J};delete ie.deletedAt,await Te.books.put(ie),te.success("Book restored from trash.")}else J.status==="archived"&&(await Te.books.put({...J,status:"writing"}),te.success("Book unarchived."));await S()}},[e,S]),P=T.useCallback(async F=>{const J=e.find(ie=>ie.id===F);J&&(await Te.books.put({...J,status:"archived"}),await S(),te.success("Book archived."))},[e,S]),D=T.useCallback(F=>Te.snapshots.getAllForBook(F),[]),U=T.useCallback(async(F,J)=>{const ie={id:crypto.randomUUID(),bookId:F.id,name:J,bookData:JSON.stringify(F),createdAt:Date.now()};await Te.snapshots.put(ie)},[]),V=T.useCallback(async F=>{const J=JSON.parse(F.bookData);await Te.books.put(J),await S(),window.location.reload()},[S]),q=T.useCallback(async F=>{await Te.snapshots.delete(F)},[]),G=T.useCallback(async(F,J)=>{const ie={id:crypto.randomUUID(),title:F,bookIds:[]},pe=await M({topic:J,seriesId:ie.id,seriesName:F});return ie.bookIds.push(pe),await Te.series.put(ie),await S(),pe},[M,S]),ee=T.useCallback(async(F,J)=>{const ie=e.find(ue=>ue.id===F);if(!ie)return;let pe;if(J.seriesId?pe=r.find(ue=>ue.id===J.seriesId):J.newSeriesTitle&&(pe={id:crypto.randomUUID(),title:J.newSeriesTitle,bookIds:[]},await Te.series.put(pe)),!pe){te.error("Could not find or create series.");return}await Te.books.put({...ie,seriesId:pe.id,seriesName:pe.title}),await Te.series.put({...pe,bookIds:[...pe.bookIds,ie.id]}),await S(),te.success(`"${ie.topic}" added to series "${pe.title}".`)},[e,r,S]),W=T.useCallback(async(F,J,ie)=>{const pe=r.find(ke=>ke.id===F);if(!pe)return;const ue=Is(pe.bookIds,ke=>{const[re]=ke.splice(J,1);ke.splice(ie,0,re)});await Te.series.put({...pe,bookIds:ue}),await S()},[r,S]),Q=T.useCallback(async F=>{await Te.series.put(F),await S()},[S]),Z=T.useCallback(async(F,J,ie,pe={})=>{const ue=await M({topic:J,instructions:F.instructions,generateImages:F.generateImages,imageGenerationInstructions:F.imageGenerationInstructions,seriesId:F.seriesId,seriesName:F.seriesName,...pe});if(F.seriesId){const ke=r.find(re=>re.id===F.seriesId);if(ke){const re=ke.bookIds.indexOf(F.id),Ge=Is(ke.bookIds,Je=>{const Qe=ie==="sequel"?re+1:re;Je.splice(Qe,0,ue)});await Te.series.put({...ke,bookIds:Ge}),await S()}}return ue},[M,r,S]),$=T.useCallback(async(F="Untitled Document")=>{const J={id:crypto.randomUUID(),title:F,content:"",createdAt:Date.now(),updatedAt:Date.now()};return await Te.documents.put(J),await S(),J.id},[S]),Y=T.useCallback(async F=>{await Te.documents.put({...F,updatedAt:Date.now()}),await S()},[S]),he=T.useCallback(async F=>{await Te.documents.delete(F),await S(),te.info("Document deleted.")},[S]),Re=T.useCallback(async(F,J)=>{const ie=e.find(pe=>pe.id===F);ie&&w.play(ie,J)},[e,w]),ze=T.useMemo(()=>({books:e,documents:s,series:r,macros:a,audiobookState:p,isAiEnabled:b,syncProvider:u,setSyncProvider:N,createNewBook:M,deleteBook:_,restoreBook:j,archiveBook:P,updateBook:C,fetchSnapshotsForBook:D,createSnapshot:U,restoreSnapshot:V,deleteSnapshot:q,createNewSeriesAndFirstBook:G,addBookToSeries:ee,removeBookFromSeries:R,reorderBooksInSeries:W,updateSeries:Q,createRelatedBook:Z,createNewDocument:$,updateDocument:Y,deleteDocument:he,playAudiobook:Re,pauseAudiobook:()=>w.pause(),resumeAudiobook:()=>w.resume(),stopAudiobook:()=>w.stop(),skipAudiobookChapter:F=>w.skipChapter(F),setPlaybackRate:F=>w.setPlaybackRate(F),setAudiobookVolume:F=>w.setVolume(F),jumpToParagraph:F=>w.jumpToParagraph(F),skipParagraph:F=>w.skipParagraph(F)}),[e,s,r,a,p,b,u,N,M,_,j,P,C,D,U,V,q,G,ee,R,W,Q,Z,$,Y,he,Re,w]);return d.jsx(rs.Provider,{value:ze,children:n})},x_=T.createContext(void 0),b_=T.createContext(void 0),LY=({children:n})=>{const[e,t]=T.useState(!1),[s,i]=T.useState([]),r=T.useCallback(()=>t(!0),[]),o=T.useCallback(()=>t(!1),[]),a=T.useCallback(p=>{i(g=>{const b=new Set(p.map(S=>S.id));return[...g.filter(S=>!b.has(S.id)),...p]})},[]),l=T.useCallback(p=>{i(g=>g.filter(b=>!p.includes(b.id)))},[]),u=T.useMemo(()=>({openPalette:r,closePalette:o,registerCommands:a,unregisterCommands:l}),[r,o,a,l]),f=T.useMemo(()=>({isOpen:e,commands:s}),[e,s]);return d.jsx(b_.Provider,{value:u,children:d.jsx(x_.Provider,{value:f,children:n})})},OY=()=>{const n=T.useContext(b_),e=T.useContext(x_);if(n===void 0||e===void 0)throw new Error("useCommandPalette must be used within a CommandPaletteProvider");return{...n,...e}},O3=()=>{const n=T.useContext(b_);if(n===void 0)throw new Error("useCommandPaletteActions must be used within a CommandPaletteProvider");return n},BY=()=>{const n=T.useContext(x_);if(n===void 0)throw new Error("useCommandPaletteState must be used within a CommandPaletteProvider");return n};class FY{constructor(){this.subscribers=new Set,this.modalType=null}subscribe(e){return this.subscribers.add(e),()=>this.subscribers.delete(e)}notify(e){this.subscribers.forEach(t=>t(e))}confirm(e){return this.modalType="confirm",new Promise(t=>{this.resolvePromise=t,this.notify({type:"confirm",options:e})})}prompt(e){return this.modalType="prompt",new Promise(t=>{this.resolvePromise=t,this.notify({type:"prompt",options:e})})}alert(e){return this.modalType="alert",new Promise(t=>{this.resolvePromise=()=>t(),this.notify({type:"alert",options:e})})}handleConfirm(e){this.resolvePromise&&this.resolvePromise(e??!0),this.close()}handleCancel(){this.resolvePromise&&(this.modalType==="prompt"?this.resolvePromise(null):this.resolvePromise(!1)),this.close()}close(){this.modalType=null,this.notify(null),this.resolvePromise=void 0}}const Mn=new FY,fr=n=>n?n.replace(/[<>&'"]/g,e=>{switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;";default:return e}}):"";class HY{constructor(e,t){if(this._images=[],this._coverImage=null,typeof JSZip>"u")throw new Error("JSZip library is not loaded. Please include it in your project.");this._book=e,this._options=t,this._zip=new JSZip,this._uuid=crypto.randomUUID()}async generate(){this._addMimetype(),this._addContainerXml(),this._options.includeCover&&await this._processCoverImage();const e=await this._processContentAndExtractImages();this._addStyles(),await this._addImages(),this._options.includeCover&&this._coverImage&&this._addCoverXhtml(),this._addContentOpf(e),this._options.includeToc&&this._addTocNcx(e);for(const t of e)this._addChapterXhtml(t);return this._zip.generateAsync({type:"blob",mimeType:"application/epub+zip",compression:"DEFLATE"})}_addMimetype(){this._zip.file("mimetype","application/epub+zip",{compression:"STORE"})}_addContainerXml(){this._zip.file("META-INF/container.xml",`<?xml version="1.0" encoding="UTF-8" ?>
<container version="1.0" xmlns="urn:oasis:names:tc:opendocument:xmlns:container">
  <rootfiles>
    <rootfile full-path="OEBPS/content.opf" media-type="application/oebps-package+xml"/>
  </rootfiles>
</container>`)}async _processCoverImage(){var e;if(!(!this._book.coverImage||!this._book.coverImage.startsWith("data:")))try{const t=this._book.coverImage,i=await(await fetch(t)).blob(),r=i.type||"image/jpeg",o=((e=r.split("/")[1])==null?void 0:e.split("+")[0])||"jpeg",a="cover-image",l=`OEBPS/images/cover.${o}`;this._coverImage={id:a,originalSrc:t,path:l,mimeType:r,extension:o,data:i}}catch(t){console.warn("Could not process cover image for EPUB.",t),this._coverImage=null}}async _processContentAndExtractImages(){var i;const e=[];let t=1,s="";for(const[r,o]of this._book.content.entries()){if(!o||!o.htmlContent)continue;const a=document.createElement("div");a.innerHTML=o.htmlContent||"";const l=Array.from(a.getElementsByTagName("img"));for(const b of l){const w=b.getAttribute("src");if(w&&w.startsWith("data:")){const S=this._images.find(N=>N.originalSrc===w);if(S)b.setAttribute("src",`../images/${S.id}.${S.extension}`);else try{const C=await(await fetch(w)).blob(),M=C.type,R=((i=M.split("/")[1])==null?void 0:i.split("+")[0])||"jpeg",_=`img${t++}`,j=`OEBPS/images/${_}.${R}`,P={id:_,originalSrc:w,path:j,mimeType:M,extension:R,data:C};this._images.push(P),b.setAttribute("src",`../images/${_}.${R}`)}catch(N){console.warn(`Could not process image for EPUB: ${w.substring(0,50)}...`,N),b.remove()}}else w&&(console.warn(`External image source "${w}" cannot be embedded in EPUB. Removing.`),b.remove())}let u=a.innerHTML;u=u.replace(/<img([^>]*?)>/g,"<img$1 />"),u=u.replace(/<p>\s*(<img[^>]*?\/>)\s*<\/p>/gi,"<div>$1</div>");const f=this._book.outline[r];let p="";f!=null&&f.part&&f.part!==s&&(p+=`<h1 class="part-header">${fr(f.part)}</h1>`,f.partContent&&(p+=`<div class="part-content">${fr(f.partContent)}</div>`),s=f.part),p+=`<h2>${fr(o.title)}</h2>`,p+=u;const g=`chapter-${r+1}`;e.push({title:o.title,bodyContent:p,id:g,path:`OEBPS/xhtml/${g}.xhtml`})}return e}_addStyles(){const t=`
body { font-family: "Palatino", "Iowan Old Style", "Apple Garamond", "Bookman", "Times New Roman", serif; line-height: 1.6; margin: 1em; }
h1.part-header { font-size: 2.5em; text-align: center; margin-top: 30%; margin-bottom: 1em; page-break-before: always; }
div.part-content { font-size: 1.2em; text-align: center; font-style: italic; margin-bottom: 30%; page-break-after: always; }
h2 { font-family: "Avenir Next", "Helvetica Neue", "Gill Sans", sans-serif; font-size: 2em; margin-top: 1.5em; margin-bottom: 0.5em; text-align: left; page-break-after: avoid; border-bottom: 1px solid #ccc; padding-bottom: 0.2em; }
h3 { font-size: 1.6em; margin-top: 1.8em; font-weight: bold; }
h4 { font-size: 1.3em; font-style: italic; margin-top: 1.5em; }
p { text-align: justify; text-indent: 1.5em; margin: 0 0 0.75em 0; }
img { max-width: 90%; height: auto; display: block; margin: 2em auto; page-break-inside: avoid; border-radius: 4px; }
div { text-align: center; margin: 2em 0; text-indent: 0; }
ul, ol { margin-left: 1.5em; margin-bottom: 1em; text-align: left; text-indent: 0; }
li { margin-bottom: 0.25em; }
strong { font-weight: bold; }
em { font-style: italic; }


/* --- Custom User Styles --- */
${this._options.customCss}`;this._zip.file("OEBPS/css/style.css",t)}async _addImages(){this._options.includeCover&&this._coverImage&&this._zip.file(this._coverImage.path,this._coverImage.data);for(const e of this._images)this._zip.file(e.path,e.data)}_addChapterXhtml(e){const t=`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
  <title>${fr(e.title)}</title>
  <link rel="stylesheet" type="text/css" href="../css/style.css" />
</head>
<body>
  ${e.bodyContent}
</body>
</html>`;this._zip.file(e.path,t)}_addCoverXhtml(){if(!this._coverImage)return;const e=`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" style="height:100%">
<head>
  <title>Cover</title>
  <style type="text/css">
    body { margin: 0; padding: 0; height: 100%; text-align: center; }
    svg { width: 100%; height: 100%; }
  </style>
</head>
<body epub:type="cover">
  <svg xmlns="http://www.w3.org/2000/svg" version="1.1" 
       xmlns:xlink="http://www.w3.org/1999/xlink"
       width="100%" height="100%" 
       viewBox="0 0 600 800" preserveAspectRatio="xMidYMid meet">
    <image width="600" height="800" xlink:href="../images/cover.${this._coverImage.extension}" />
  </svg>
</body>
</html>`;this._zip.file("OEBPS/xhtml/cover.xhtml",e)}_addContentOpf(e){const t=['<item id="css" href="css/style.css" media-type="text/css" />'];this._options.includeToc&&t.push('<item id="ncx" href="toc.ncx" media-type="application/x-dtbncx+xml" />');const s=[];let i="",r="";this._options.includeCover&&this._coverImage&&(i=`
    <meta name="cover" content="${this._coverImage.id}" />`,t.push('<item id="cover" href="xhtml/cover.xhtml" media-type="application/xhtml+xml" />'),t.push(`<item id="${this._coverImage.id}" href="images/cover.${this._coverImage.extension}" media-type="${this._coverImage.mimeType}" />`),s.push('<itemref idref="cover" linear="no" />'),r=`
  <guide>
    <reference type="cover" title="Cover" href="xhtml/cover.xhtml" />
  </guide>`),e.forEach(l=>{t.push(`<item id="${l.id}" href="xhtml/${l.id}.xhtml" media-type="application/xhtml+xml" />`),s.push(`<itemref idref="${l.id}" />`)}),this._images.forEach(l=>{t.push(`<item id="${l.id}" href="images/${l.id}.${l.extension}" media-type="${l.mimeType}" />`)});const o=this._options.includeToc?' toc="ncx"':"",a=`<?xml version="1.0" encoding="UTF-8"?>
<package xmlns="http://www.idpf.org/2007/opf" unique-identifier="book-id" version="2.0">
  <metadata xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:opf="http://www.idpf.org/2007/opf">
    <dc:title>${fr(this._book.topic)}</dc:title>
    ${this._book.subtitle?`<dc:title>${fr(this._book.subtitle)}</dc:title>`:""}
    <dc:creator opf:role="aut">${fr(this._book.author||"AI Book Studio")}</dc:creator>
    <dc:publisher>${fr(this._book.publisher||"AI Book Studio")}</dc:publisher>
    <dc:date>${fr(this._book.publicationDate||new Date().getFullYear().toString())}</dc:date>
    <dc:description>${fr(this._book.description||"")}</dc:description>
    <dc:identifier id="book-id">urn:uuid:${this._uuid}</dc:identifier>
    <dc:language>${fr(this._book.language||"en")}</dc:language>${i}
  </metadata>
  <manifest>
    ${t.join(`
    `)}
  </manifest>
  <spine${o}>
    ${s.join(`
    `)}
  </spine>${r}
</package>`;this._zip.file("OEBPS/content.opf",a)}_addTocNcx(e){const t=e.map((i,r)=>`
    <navPoint id="navpoint-${r+1}" playOrder="${r+1}">
      <navLabel><text>${fr(i.title)}</text></navLabel>
      <content src="xhtml/${i.id}.xhtml" />
    </navPoint>`).join(""),s=`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE ncx PUBLIC "-//NISO//DTD ncx 2005-1//EN" "http://www.daisy.org/z3986/2005/ncx-2005-1.dtd">
<ncx xmlns="http://www.daisy.org/z3986/2005/ncx/" version="2005-1">
  <head>
    <meta name="dtb:uid" content="urn:uuid:${this._uuid}" />
    <meta name="dtb:depth" content="1" />
    <meta name="dtb:totalPageCount" content="0" />
    <meta name="dtb:maxPageNumber" content="0" />
  </head>
  <docTitle><text>${fr(this._book.topic)}</text></docTitle>
  <navMap>${t}
  </navMap>
</ncx>`;this._zip.file("OEBPS/toc.ncx",s)}}const AA=n=>n?n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):"",UY=async n=>{const{jsPDF:e}=window.jspdf,t=new e("p","pt","a4"),s=t.internal.pageSize.getWidth(),i=t.internal.pageSize.getHeight(),r=40,o=s-r*2,a=i-r*2,l=document.createElement("div");l.style.position="absolute",l.style.left="-9999px",l.style.width=`${o}pt`,l.style.fontFamily="Times, serif",l.style.color="black";const u=document.createElement("style");u.innerHTML=`
        :root {
            font-size: 12pt;
            line-height: 1.6;
        }
        h1.book-title { font-size: 28pt; font-weight: 800; text-align: center; margin-bottom: 0.5em; line-height: 1.2; }
        h2.book-subtitle { font-size: 18pt; font-weight: 300; text-align: center; margin-bottom: 2em; font-style: italic; color: #555; }
        h2.part-header { font-size: 24pt; text-align: center; margin-top: 100pt; margin-bottom: 20pt; font-weight: bold; page-break-before: always; }
        div.part-content { font-size: 14pt; text-align: center; font-style: italic; margin-bottom: 100pt; padding: 0 2em; }
        h3.chapter-title { font-size: 20pt; margin-top: 40pt; margin-bottom: 20pt; font-weight: bold; text-align: left; border-bottom: 1px solid #ccc; padding-bottom: 5pt; page-break-before: always; page-break-after: avoid; }
        h4 { font-size: 16pt; margin-top: 24pt; margin-bottom: 12pt; font-weight: bold; page-break-after: avoid; }
        h5 { font-size: 14pt; margin-top: 18pt; margin-bottom: 10pt; font-weight: bold; font-style: italic; }
        p { margin-bottom: 12pt; text-align: justify; }
        ul, ol { margin-left: 25pt; margin-bottom: 10pt; }
        li { margin-bottom: 5pt; }
        img { max-width: 100%; height: auto; display: block; margin: 20pt auto; border-radius: 0.25rem; }
    `,l.appendChild(u);const f=document.createElement("div");f.style.width=`${o}pt`,f.style.height=`${a}pt`,f.style.display="flex",f.style.flexDirection="column",f.style.justifyContent="center",f.style.alignItems="center",f.innerHTML=`
        <h1 class="book-title">${n.topic}</h1>
        ${n.subtitle?`<h2 class="book-subtitle">${n.subtitle}</h2>`:""}
        <p style="font-size: 14pt; text-align: center; margin-top: 2em;">By ${n.author||"AI Book Studio"}</p>
    `,l.appendChild(f);let p="";n.content.forEach((g,b)=>{if(!g)return;const w=n.outline[b];let S="";w!=null&&w.part&&w.part!==p&&(S+=`<h2 class="part-header">${AA(w.part)}</h2>`,w.partContent&&(S+=`<div class="part-content">${AA(w.partContent)}</div>`),p=w.part),S+=`
            <div>
                <h3 class="chapter-title">${AA(g.title)}</h3>
                <div>${g.htmlContent||""}</div>
            </div>`;const N=document.createElement("div");N.innerHTML=S,l.appendChild(N)}),document.body.appendChild(l);try{const b=(await window.html2canvas(l,{scale:2})).toDataURL("image/png"),w=t.getImageProperties(b),S=w.width,C=w.height/S,M=o*C;let R=M,_=0;for(t.addImage(b,"PNG",r,r,o,M),R-=a;R>0;)_-=i,t.addPage(),t.addImage(b,"PNG",r,_+r,o,M),R-=i;const j=t.internal.getNumberOfPages();for(let P=1;P<=j;P++)t.setPage(P),t.setFontSize(10),P>1&&t.text(`Page ${P-1}`,s/2,i-20,{align:"center"});t.save(`${n.topic.replace(/ /g,"_")}.pdf`)}catch(g){console.error("Failed to export PDF:",g),te.error("An error occurred during PDF export. The content might be too large or complex. See console for details.")}finally{document.body.removeChild(l)}},$Y=async(n,e)=>{try{const s=await new HY(n,e).generate(),i=URL.createObjectURL(s),r=document.createElement("a");r.href=i,r.download=`${n.topic.replace(/ /g,"_")}.epub`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}catch(t){console.error("Failed to generate ePub:",t);const s=t instanceof Error?t.message:"An unknown error occurred.";te.error(`An error occurred during ePub export: ${s}`)}};class GY{constructor(){this.state={isConflict:!1,localData:null,remoteData:null,remoteTimestamp:0,localTimestamp:0},this.subscribers=new Set}subscribe(e){return this.subscribers.add(e),e(this.state),()=>{this.subscribers.delete(e)}}notify(){this.subscribers.forEach(e=>e(this.state))}triggerConflict(e,t,s){this.state={isConflict:!0,localData:e,remoteData:t,remoteTimestamp:s,localTimestamp:Date.now()},this.notify()}dismiss(){this.state={isConflict:!1,localData:null,remoteData:null,remoteTimestamp:0,localTimestamp:0},this.notify()}async resolve(e){if(!(!this.state.localData||!this.state.remoteData))try{switch(e){case"use_local":break;case"use_remote":await Te.restore(this.state.remoteData);break;case"smart_merge":await Te.smartMerge(this.state.remoteData);break}}finally{this.dismiss()}}findConflictingItems(e,t,s){try{const i=JSON.parse(e),r=JSON.parse(t),o=[],a=(l,u,f="id")=>{if(!Array.isArray(l)||!Array.isArray(u))return;const p=new Map(l.map(b=>[b.id,b])),g=new Map(u.map(b=>[b.id,b]));for(const b of u){const w=p.get(b.id);if(w){const S=w.updatedAt>s,N=b.updatedAt>s;if(S&&N&&Math.abs(w.updatedAt-b.updatedAt)>1e3){const C=w[f]||w.title||w.name||w.id;o.push(C)}}}};return a(i.books,r.books,"topic"),a(i.documents,r.documents,"title"),o}catch(i){return console.warn("Failed to analyze conflicts",i),["Unknown Data Error"]}}getDiffSummary(){if(!this.state.localData||!this.state.remoteData)return null;const e=JSON.parse(this.state.localData),t=JSON.parse(this.state.remoteData),s=e.books||[],i=t.books||[],r=e.documents||[],o=t.documents||[],a=new Map(s.map(b=>[b.id,b])),l=new Map(i.map(b=>[b.id,b])),u=s.filter(b=>!l.has(b.id)),f=i.filter(b=>!a.has(b.id)),p=s.filter(b=>{const w=l.get(b.id);return w&&b.updatedAt>w.updatedAt}),g=i.filter(b=>{const w=a.get(b.id);return w&&b.updatedAt>w.updatedAt});return{localCount:s.length,remoteCount:i.length,localDocCount:r.length,remoteDocCount:o.length,booksOnlyInLocal:u,booksOnlyInRemote:f,newerInLocal:p,newerInRemote:g}}}const v0=new GY,q0="autoBackupEnabled",Gw="lowDataMode",UN="backupApiKey",B3="ai-book-studio",F3="https://www.greenyogafestival.org/backup-api/api/v1/apps",W0=`${F3}/${B3}/backups`,VY=`${W0}/list`,H3=`${F3}/${B3}/backups/latest`;let oo={status:"idle",lastBackupTimestamp:localStorage.getItem("lastBackupTimestamp")?parseInt(localStorage.getItem("lastBackupTimestamp"),10):null};const $N=new Set,Um=async()=>{try{const n=await Te.settings.get(UN);return(n==null?void 0:n.value)||""}catch{return""}},Vw=()=>{const n=navigator,e=n.connection||n.mozConnection||n.webkitConnection;if(!e)return!0;if(e.saveData)return!1;if(e.type){if(e.type==="cellular"||e.type==="bluetooth"||e.type==="none")return!1;if(e.type==="wifi"||e.type==="ethernet")return!0}return!0},qY=()=>{const n=navigator,e=n.connection||n.mozConnection||n.webkitConnection;e&&e.addEventListener("change",()=>{Vw()&&(oo.status==="idle"||oo.status==="failed")&&(console.log("WiFi detected, triggering pending backup."),Lj())}),window.addEventListener("online",()=>{oo.status!=="synced"&&oo.status!=="disabled"&&Vw()&&Lj()})},WY=async()=>{try{await Te.init();const n=await Te.settings.get(q0),e=await Um(),t=(n==null?void 0:n.value)!==!1&&e.length>0;qY(),t?oo.lastBackupTimestamp?to({status:"synced"}):to({status:"idle"}):to({status:"disabled"})}catch(n){console.warn("Could not initialize backup status.",n)}},KY=()=>{$N.forEach(n=>n(oo))},to=n=>{oo={...oo,...n},KY()},U3=n=>($N.add(n),n(oo),()=>{$N.delete(n)});async function YY(n){const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(r=>r.toString(16).padStart(2,"0")).join("")}async function y_(n){const e=new DecompressionStream("gzip"),t=n.stream().pipeThrough(e);return await new Response(t).text()}const JY=()=>{const n=localStorage.getItem("totalBytesUploaded")||"0",e=sessionStorage.getItem("sessionBytesUploaded")||"0";return{total:parseInt(n,10),session:parseInt(e,10)}},$3=n=>{const e=parseInt(localStorage.getItem("totalBytesUploaded")||"0",10);localStorage.setItem("totalBytesUploaded",(e+n).toString());const t=parseInt(sessionStorage.getItem("sessionBytesUploaded")||"0",10);sessionStorage.setItem("sessionBytesUploaded",(t+n).toString())};let vv=!1,NA=!1,wv=0;const qw=async(n=!1)=>{if(vv)return NA=!0,null;const e=await Um();if(!e&&!n)return to({status:"disabled"}),null;if(!n&&!Vw())return console.log("Backup deferred: Not on WiFi or metered connection."),oo.status==="synced"&&to({status:"idle"}),null;try{const t=await Te.settings.get(q0);if(!n&&(t==null?void 0:t.value)===!1)return to({status:"disabled"}),null;const s=await Te.settings.get(Gw),i=(s==null?void 0:s.value)===!0;vv=!0,to({status:"syncing"});let r=await Te.backup({excludeImages:i});const o=await YY(r),a=localStorage.getItem("lastBackupHash");if(!n&&o===a){console.log("Backup skipped: Content unchanged since last sync.");const C=Date.now();return localStorage.setItem("lastBackupTimestamp",C.toString()),to({status:"synced",lastBackupTimestamp:C}),null}try{const C=await fetch(`${H3}?t=${Date.now()}`,{method:"GET",headers:{"X-API-Key":e},cache:"no-store"});if(C.ok){const M=await C.json(),R=new Date(M.modified).getTime(),_=oo.lastBackupTimestamp||0;if(R>_+2e3){console.warn("Sync Check: Server is newer.");const j=M.download_url,P=await fetch(j);if(P.ok){let D=await P.blob(),U="";M.filename.endsWith(".gz")?U=await y_(D):U=await D.text();const V=v0.findConflictingItems(r,U,_);if(V.length===0)console.log("Auto-resolving sync: No overlapping conflicts found. Merging..."),await Te.smartMerge(U),r=await Te.backup({excludeImages:i}),te.success("Synced with server (Changes merged)");else return console.warn("Sync Conflict: Overlapping changes found.",V),v0.triggerConflict(r,U,R),to({status:"conflict"}),null}}}}catch(C){console.warn("Could not check for conflicts, proceeding with overwrite (risky)",C)}const l=new Blob([r],{type:"application/json"}),u="latest.json",f=new File([l],u,{type:"application/json"}),p=new FormData;p.append("file",f);const g=await fetch(W0,{method:"POST",headers:{"X-API-Key":e},body:p});if(!g.ok){const C=await g.text();throw new Error(`Failed to upload latest backup: ${g.status} ${g.statusText} - ${C}`)}$3(l.size),localStorage.setItem("lastBackupHash",o);const b=new Date().toISOString().split("T")[0],w=`dailySnapshotCreated_${b}`;if(!localStorage.getItem(w)){const C=`daily_${b}.json`,M=new File([l],C,{type:"application/json"}),R=new FormData;R.append("file",M),fetch(W0,{method:"POST",headers:{"X-API-Key":e},body:R}).then(()=>{localStorage.setItem(w,"true")}).catch(_=>console.warn("Failed to create daily snapshot",_))}const N=Date.now();return localStorage.setItem("lastBackupTimestamp",N.toString()),to({status:"synced",lastBackupTimestamp:N}),wv=0,null}catch(t){if(console.error("An error occurred during server backup:",t),to({status:"failed"}),!n&&wv<5){wv++;const s=Math.pow(2,wv)*1e3+Math.random()*1e3;setTimeout(()=>{vv=!1,qw(!1)},s)}return t}finally{vv=!1,NA&&(NA=!1,setTimeout(()=>qw(n),1e3))}},XY=async n=>{const e=await Um();if(!e)throw new Error("Backup API Key not configured.");const t=await Te.settings.get(Gw),s=(t==null?void 0:t.value)===!0,i=await Te.backup({excludeImages:s}),r=new Blob([i],{type:"application/json"}),o=n.replace(/[^a-z0-9]/gi,"_").toLowerCase(),l=`snapshot_${new Date().toISOString().replace(/[:.]/g,"-")}_${o}.json`,u=new File([r],l,{type:"application/json"}),f=new FormData;f.append("file",u);const p=await fetch(W0,{method:"POST",headers:{"X-API-Key":e},body:f});if(!p.ok)throw new Error(`Failed to upload snapshot: ${p.statusText}`);$3(r.size)};let Nu=null;const Lj=()=>{if(Nu&&clearTimeout(Nu),!Vw()){oo.status==="synced"&&to({status:"idle"});return}Nu=window.setTimeout(()=>{qw(),Nu=null},1500)},gp=async(n=!1)=>(Nu&&(clearTimeout(Nu),Nu=null),await qw(n)),G3=async(n=!1)=>{try{const e=await Um();if(!e&&!n||!navigator.onLine&&!n)return null;await Te.init();const t=await Te.settings.get(q0);if((t==null?void 0:t.value)===!1&&!n)return null;const s=localStorage.getItem("latestBackupEtag"),i=localStorage.getItem("latestBackupContent"),r=localStorage.getItem("latestBackupLastModified"),o=async M=>{const R={"X-API-Key":e};M&&s&&!n&&(R["If-None-Match"]=s);const _=`${H3}?t=${new Date().getTime()}`;return fetch(_,{method:"GET",headers:R,cache:"no-store"})};let a=await o(!0);if(a.status===304&&!i&&(a=await o(!1)),a.status===304){if(i){const M=JSON.parse(i);if(!M.books||M.books.length===0)return null;const R=Math.max(...M.books.map(j=>j.updatedAt)),_=r?new Date(r).getTime():R;return{content:i,contentTimestamp:R,backupTimestamp:_}}return null}if(a.status===404)return localStorage.removeItem("latestBackupEtag"),localStorage.removeItem("latestBackupContent"),localStorage.removeItem("latestBackupLastModified"),null;if(!a.ok)return null;const l=await a.json(),u=l.download_url;if(!u)return null;const f=await fetch(u,{method:"GET",headers:{"X-API-Key":e},cache:"no-store"});if(!f.ok)return null;let p=await f.blob(),g="";if(l.filename&&l.filename.endsWith(".gz"))try{g=await y_(p)}catch{g=await p.text()}else g=await p.text();const b=a.headers.get("ETag"),w=a.headers.get("Last-Modified")||l.modified;if(b&&(localStorage.setItem("latestBackupEtag",b),localStorage.setItem("latestBackupContent",g),w&&localStorage.setItem("latestBackupLastModified",w)),!g)return null;const S=JSON.parse(g);if(!S.books||S.books.length===0)return null;const N=Math.max(...S.books.map(M=>M.updatedAt)),C=w?new Date(w).getTime():N;return{content:g,contentTimestamp:N,backupTimestamp:C}}catch(e){return e instanceof TypeError&&e.message==="Failed to fetch"?console.warn("Backup check skipped: Server unreachable."):console.error("An error occurred while fetching the latest server backup:",e),null}},QY=async()=>{try{await Te.init();const n=await Um();if(!n)throw new Error("Backup API Key not configured.");const e=await fetch(VY,{method:"GET",headers:{"X-API-Key":n},cache:"no-store"});if(e.status===404)return[];if(!e.ok){const r=await e.text();throw new Error(`Failed to list backups: ${e.status} ${e.statusText} - ${r}`)}const i=((await e.json()).backups||[]).filter(r=>r.filename.endsWith(".json")||r.filename.endsWith(".json.gz")).map(r=>({id:r.filename,createdAt:r.modified,size:r.size}));return i.sort((r,o)=>new Date(o.createdAt).getTime()-new Date(r.createdAt).getTime()),i}catch(n){throw console.error("An error occurred while listing server backups:",n),n instanceof TypeError?new Error("Could not connect to the backup server. Check your network or firewall."):n}},Oj=async n=>{try{const e=await Um();if(!e)throw new Error("Backup API Key not configured.");const t=await fetch(`${W0}/${encodeURIComponent(n)}`,{method:"GET",headers:{"X-API-Key":e}});if(t.status===404)return null;if(!t.ok)throw new Error("Failed to fetch backup content");const s=await t.blob();return n.endsWith(".gz")?await y_(s):await s.text()}catch(e){throw console.error(`An error occurred while fetching backup content for ${n}:`,e),e instanceof TypeError?new Error("Could not connect to the backup server. Please check your internet connection."):e}},V3=T.createContext(void 0),ZY=({bookId:n,onBack:e,children:t})=>{Es();const s=T.useContext(rs);if(!s)throw new Error("BookEditorProvider must be used within an AppContextProvider");const{updateBook:i,fetchSnapshotsForBook:r,createSnapshot:o,restoreSnapshot:a,deleteSnapshot:l,macros:u,playAudiobook:f,pauseAudiobook:p,resumeAudiobook:g,stopAudiobook:b,skipAudiobookChapter:w,audiobookState:S,isAiEnabled:N}=s,[C,M]=T.useState(null),[R,_]=T.useState([]),[j,P]=T.useState(!0),[D,U]=T.useState("Loading book..."),[V,q]=T.useState("saved"),[G,ee]=T.useState(0),[W,Q]=T.useState(!1),Z=T.useRef(new Map),[$,Y]=T.useState(null),[he,Re]=T.useState(!1),[ze,F]=T.useState(!1),[J,ie]=T.useState(null),[pe,ue]=T.useState(!1),[ke,re]=T.useState(!1),[Ge,Je]=T.useState(!1),[Qe,je]=T.useState(!1),[ye,Fe]=T.useState(!1),[Ne,ve]=T.useState(!1),[Pe,ot]=T.useState(!1),[Gt,bn]=T.useState(!1),[qt,jt]=T.useState(!1),[yn,_t]=T.useState(!1),[Qt,_s]=T.useState(!1),[Se,Me]=T.useState(!1),[He,Pt]=T.useState(!1),[Sn,as]=T.useState(!1),[Xn,De]=T.useState(!1),[se,Oe]=T.useState(null),[Ke,me]=T.useState([]),[xe,Le]=T.useState(""),[Ue,lt]=T.useState(!1),[Mt,Ht]=T.useState(null),[Cn,Zt]=T.useState(!1),[Pn,Hn]=T.useState(null),[Bi,ys]=T.useState(null),[of,ls]=T.useState([]),[rr,qo]=T.useState({chapterIndex:0,result:null}),[Wo,Fa]=T.useState(!1),[af,ic]=T.useState(null),[ri,Un]=T.useState(null),[at,vn]=T.useState(!1),[Ko,nC]=T.useState(null),[Yb,sC]=T.useState(null),[Kd,rc]=T.useState([]),[oc,Ha]=T.useState([]),[Ua,Yo]=T.useState(null),[cs,lf]=T.useState(null),[Jb,Jo]=T.useState(!1),[ac,Xb]=T.useState(null),[Qb,Wm]=T.useState(!1),[iC,lc]=T.useState(null),[cf,Pr]=T.useState(!1),[vs,cc]=T.useState(null),[rC,df]=T.useState(!1),[Zb,Yd]=T.useState(!1),[oC,Ci]=T.useState(null),[Km,Ym]=T.useState([]),[Jm,dc]=T.useState(!1),[uc,uf]=T.useState([]),hc=["Kore","Puck","Charon","Fenrir","Zephyr"];T.useEffect(()=>{(async()=>{try{P(!0);const ae=await Te.books.get(n);if(!ae){te.error("Book not found"),e();return}let be=!1;const le=ae.outline.map(yt=>yt.id?yt:(be=!0,{...yt,id:crypto.randomUUID()}));if(be&&(ae.outline=le),M(ae),cc(ae.bookChatHistory||[]),ae.seriesId){const yt=await Te.series.get(ae.seriesId);_((yt==null?void 0:yt.sharedKnowledgeBase)||[])}const Ae=await Te.instructions.getAll();me(Ae);const $e=await r(n);ls($e.sort((yt,kt)=>kt.createdAt-yt.createdAt));const ht=await Te.settings.get("customPersonas");ht&&Array.isArray(ht.value)&&uf(ht.value)}catch(ae){console.error(ae),te.error("Failed to load book")}finally{P(!1)}})()},[n,e,r]);const Rn=K=>{M(ae=>ae?{...ae,...K}:null),q("unsaved")},hf=T.useCallback(K=>{const ae=U0[K];if(ae)return ae;const be=uc.find(le=>le.name===K);return be?be.instructions:U0["Standard Co-Author"]},[uc]),ey=T.useCallback(K=>{Le(K),Rn({instructions:K})},[]),Xm=T.useCallback(async()=>{if(!C)return;const K=await Mn.prompt({title:"Save Template",inputLabel:"Template Name"});if(K){const ae={id:crypto.randomUUID(),name:K,prompt:C.instructions};await Te.instructions.put(ae),me(be=>[...be,ae]),te.success("Template saved.")}},[C]),aC=T.useCallback(async K=>{if(!C)return;if(await Mn.confirm({title:"Update Template?",message:`Update "${K.name}" with current instructions?`})){const be={...K,prompt:C.instructions};await Te.instructions.put(be),me(le=>le.map(Ae=>Ae.id===K.id?be:Ae)),te.success("Template updated.")}},[C]),lC=T.useCallback(async()=>{if(C){lt(!0);try{const K=await JK(C.topic,C.instructions);Ht(K)}catch(K){te.error("Failed to generate suggestion: "+K.message)}finally{lt(!1)}}},[C]),ff=T.useCallback(()=>{re(!0)},[]),go=K=>{const{name:ae,value:be,type:le}=K.target,Ae=K.target.checked;Rn({[ae]:le==="checkbox"?Ae:be})},Qm=K=>{Rn({topic:K.currentTarget.textContent||""})},Zm=K=>{Rn({subtitle:K.currentTarget.textContent||""})},fc=(K,ae)=>{if(!C)return;const be=Is(C.outline,Ae=>{Ae[ae].title=K.currentTarget.textContent||""});Rn({outline:be});const le=Is(C.content,Ae=>{Ae[ae]&&(Ae[ae].title=K.currentTarget.textContent||"")});Rn({content:le})},Qn=T.useCallback((K,ae)=>{C&&(M(be=>{var Ae,$e;if(!be)return null;if(((Ae=be.content[K])==null?void 0:Ae.htmlContent)===ae)return be;const le=[...be.content];for(;le.length<=K;)le.push({title:(($e=be.outline[le.length])==null?void 0:$e.title)||"",htmlContent:""});return le[K]={...le[K],htmlContent:ae},{...be,content:le}}),q("unsaved"))},[C]),ty=(K,ae)=>{if(!C)return;const be=Is(C.outline,le=>{le[K].part=ae});Rn({outline:be})},eg=(K,ae)=>{if(!C)return;const be=Is(C.outline,le=>{le[K].partContent=ae});Rn({outline:be})},ny=K=>{if(!C)return;const ae=C.outline[K].part;if(!ae)return;const be=Is(C.outline,le=>{for(let Ae=K+1;Ae<le.length&&!(le[Ae].part&&le[Ae].part!==ae);Ae++)le[Ae].part=ae});Rn({outline:be}),te.success(`Applied "${ae}" to subsequent chapters.`)},xo=T.useCallback(async()=>{if(C){q("saving");try{const K=(vs||[]).map(ae=>({...ae,role:ae.role||"model"}));await i({...C,bookChatHistory:K}),q("saved")}catch(K){console.error(K),q("unsaved"),te.error("Failed to save")}}},[C,i,vs]);T.useEffect(()=>{const K=setInterval(()=>{V==="unsaved"&&xo()},5e3);return()=>clearInterval(K)},[V,xo]);const bo=async()=>{await xo(),Q(!0);try{await gp()}catch{}finally{Q(!1)}},tg=T.useCallback((K,ae)=>{if(!C)return;const be=ae==="after"?K+1:K,le={id:crypto.randomUUID(),title:"New Chapter",summary:"Describe the chapter here...",status:"todo"};C.outline[K]&&(le.part=C.outline[K].part);const Ae=[...C.outline];Ae.splice(be,0,le);const $e=[...C.content];$e.splice(be,0,{title:le.title,htmlContent:""}),M({...C,outline:Ae,content:$e}),q("unsaved"),ee(be),te.success("Chapter added.")},[C]),pc=T.useCallback(async K=>{if(!C)return;if(await Mn.confirm({title:"Delete Chapter?",message:`Are you sure you want to delete "${C.outline[K].title}"? This action cannot be undone.`,danger:!0,confirmText:"Delete"})){const be=[...C.outline],le=[...C.content];be.splice(K,1),le.splice(K,1);const Ae={...C,outline:be,content:le};M(Ae),q("unsaved"),G>=be.length&&ee(Math.max(0,be.length-1)),te.info("Chapter deleted.")}},[C,G]),Xo=T.useCallback((K,ae)=>{if(!C||K===ae)return;const be=[...C.outline],le=[...C.content],[Ae]=be.splice(K,1);be.splice(ae,0,Ae);const[$e]=le.splice(K,1);le.splice(ae,0,$e),M({...C,outline:be,content:le}),q("unsaved"),G===K?ee(ae):G>K&&G<=ae?ee(G-1):G<K&&G>=ae&&ee(G+1)},[C,G]),ng=async K=>{var be,le;if(!C||K>=C.outline.length-1)return;if(await Mn.confirm({title:"Merge Chapters?",message:`Merge "${C.outline[K+1].title}" into "${C.outline[K].title}"? The content will be combined and the second chapter removed.`,confirmText:"Merge"})){const Ae=((be=C.content[K])==null?void 0:be.htmlContent)||"",$e=((le=C.content[K+1])==null?void 0:le.htmlContent)||"",ht=`${Ae}<hr/><p><em>(Merged from ${C.outline[K+1].title})</em></p>${$e}`,yt=[...C.content];yt[K]={...yt[K],htmlContent:ht},yt.splice(K+1,1);const kt=[...C.outline];kt[K].summary+=`

(Merged): ${kt[K+1].summary}`,kt.splice(K+1,1),M({...C,outline:kt,content:yt}),q("unsaved"),te.success("Chapters merged.")}},Jd=(K,ae)=>{if(!C)return;const be=Is(C.outline,Ae=>{Object.assign(Ae[K],ae)});let le=C.content;ae.title&&C.content[K]&&(le=Is(C.content,Ae=>{Ae[K].title=ae.title})),M({...C,outline:be,content:le}),q("unsaved")},sy=async K=>{if(!C)return;const ae=K.args;if(K.name==="updateBookMetadata")Rn({topic:ae.topic||C.topic,subtitle:ae.subtitle||C.subtitle,author:ae.author||C.author,description:ae.description||C.description}),te.success("Book metadata updated.");else if(K.name==="updateChapterMetadata"){const be=ae.chapterIndex;C.outline[be]&&(Jd(be,{title:ae.title,part:ae.part,partContent:ae.partContent,summary:ae.summary}),te.success(`Chapter ${be+1} updated.`))}else if(K.name==="addChapter"){const be=ae.index??C.outline.length,le={id:crypto.randomUUID(),title:ae.title,part:ae.part,summary:ae.summary||"",status:"todo"},Ae=[...C.outline];Ae.splice(be,0,le);const $e=[...C.content];$e.splice(be,0,{title:ae.title,htmlContent:""}),M({...C,outline:Ae,content:$e}),q("unsaved"),te.success(`Chapter added: ${ae.title}`)}else K.name==="deleteChapter"?pc(ae.chapterIndex):K.name},pf=async()=>{if(!C)return;const K=C.content.length<C.outline.length?C.content.length:-1;if(K===-1){te.info("All chapters appear to be written!");return}Hn(K),ee(K);try{const ae=C.outline[K];C.content[K]||Qn(K,""),await Mj(C.topic,C.instructions,C.knowledgeBase,R,ae,C.bookChatHistory||[],be=>{M(le=>{var ht;if(!le)return null;const Ae=[...le.content],$e=((ht=Ae[K])==null?void 0:ht.htmlContent)||"";return Ae[K]={title:ae.title,htmlContent:$e+be},{...le,content:Ae}})},C.language||"en"),te.success(`Chapter "${ae.title}" generated.`),q("unsaved")}catch(ae){te.error(`Generation failed: ${ae.message}`)}finally{Hn(null)}},mf=async()=>{var be;if(!C)return;let K=C.content.findIndex(le=>!le||!le.htmlContent.trim());if(K===-1&&C.content.length<C.outline.length&&(K=C.content.length),K===-1){te.info("All chapters written.");return}if(await Mn.confirm({title:"Generate Remaining Book?",message:`This will auto-generate chapters starting from ${C.outline[K].title}. This may take a while. Ensure you have a stable connection.`,confirmText:"Start Generation"})){for(let le=K;le<C.outline.length;le++){Hn(le),ee(le),(be=document.getElementById(`chapter-${le}`))==null||be.scrollIntoView();try{await new Promise($e=>setTimeout($e,500));const Ae=C.outline[le];M($e=>{if(!$e)return null;const ht=[...$e.content];return ht[le]||(ht[le]={title:Ae.title,htmlContent:""}),{...$e,content:ht}}),await Mj(C.topic,C.instructions,C.knowledgeBase,R,Ae,vs||[],$e=>{M(ht=>{var ln;if(!ht)return null;const yt=[...ht.content],kt=((ln=yt[le])==null?void 0:ln.htmlContent)||"";return yt[le]={title:Ae.title,htmlContent:kt+$e},{...ht,content:yt}})},C.language||"en"),await xo()}catch(Ae){te.error(`Stopped at chapter ${le+1}: ${Ae.message}`);break}}Hn(null),te.success("Batch generation complete.")}},iy=async K=>{if(C){ue(!1),te.info("Generating ePub...");try{await $Y(C,K),te.success("ePub Downloaded!")}catch(ae){te.error(`Export failed: ${ae.message}`)}}},oi=async()=>{if(C){te.info("Generating PDF...");try{await UY(C),te.success("PDF Downloaded!")}catch(K){te.error(`Export failed: ${K.message}`)}}},$a=async K=>{if(!C)return;await o(C,K);const ae=await r(C.id);ls(ae.sort((be,le)=>le.createdAt-be.createdAt))},gf=async K=>{await a(K)},Xd=async K=>{await l(K);const ae=await r(n);ls(ae.sort((be,le)=>le.createdAt-be.createdAt))},cC=(K,ae)=>{Z.current.set(K,ae)},sg=K=>Z.current.delete(K),ig=async K=>{if(!$||he)return;const{from:ae,to:be}=$.state.selection,le=$.state.doc.textBetween(ae,be," "),Ae=$.getText();if(!le&&K!=="suggest"){te.info("Please select some text first.");return}Re(!0);try{let $e="";if(K==="rephrase")$e=await cY(le,Ae);else if(K==="expand")$e=await dY(le,Ae);else if(K==="summarize")$e=await uY(le);else if(K==="suggest"){const ht=$.state.doc.textBetween(Math.max(0,ae-500),ae," ");$e=await M3(ht,(C==null?void 0:C.instructions)||"")}else typeof K=="object"&&K.type==="tone"&&($e=await hY(le,K.tone,Ae));$e&&$.commands.insertContent($e)}catch($e){te.error(`AI Action failed: ${$e.message}`)}finally{Re(!1)}},Qd=T.useCallback((K,ae)=>{C&&(Qn(K,ae),te.success("Changes applied to chapter."))},[C,Qn]),mc=T.useCallback(async K=>{if(!C)return;df(!0);const ae={role:"user",parts:[{text:K}]},be=[...vs||[],ae];cc(be);try{const le=C.content[G],Ae={topic:C.topic,outline:C.outline,currentChapter:le?{title:le.title,content:le.htmlContent}:void 0,knowledgeBase:C.knowledgeBase,seriesKnowledgeBase:R},$e=hf(C.aiPersona||"Standard Co-Author"),ht=await WK(K,be,Ae,$e,yt=>{cc(kt=>{if(!kt)return null;const ln=kt[kt.length-1];if(ln.role==="model"){const Ms=ln.parts[0].text||"";return[...kt.slice(0,-1),{role:"model",parts:[{text:Ms+yt}]}]}else return[...kt,{role:"model",parts:[{text:yt}]}]})},yt=>{cc(kt=>[...kt||[],{role:"model",parts:[{functionCall:yt}]}])});cc(ht)}catch(le){te.error(le.message||String(le))}finally{df(!1)}},[C,vs,G,R,hf]),ry=T.useCallback(K=>{je(!1),jt(!0),mc(K)},[mc]),dC=T.useCallback(K=>{const ae=K||$;if(!ae){console.warn("No active editor instance found for Text to Image");return}K&&Y(K);const{from:be,to:le}=ae.state.selection,Ae=ae.state.doc.textBetween(be,le," ");if(!Ae.trim()){te.info("Please select some text to describe the image.");return}Oe({text:Ae,from:be,to:le}),Me(!0)},[$]),uC=T.useCallback((K,ae)=>{!$||!se||($.chain().focus().setTextSelection(se.to).insertContent([{type:"paragraph"},{type:"image",attrs:{src:K,alt:ae}},{type:"paragraph"}]).run(),Me(!1),Oe(null))},[$,se]),yC={book:C,isLoading:j,loadingMessage:D,saveStatus:V,isSyncing:W,activeChapterIndex:G,setActiveChapterIndex:ee,handleInputChange:go,handleTitleChange:Qm,handleSubtitleChange:Zm,handleChapterTitleChange:fc,handleContentChange:Qn,handleUpdatePart:ty,handleUpdatePartContent:eg,handlePropagatePart:ny,instructions:Ke,selectedInstruction:xe,handleUpdateInstructions:ey,handleSaveNewInstructionTemplate:Xm,handleUpdateInstructionTemplate:aC,isSuggestingInstructions:Ue,instructionSuggestion:Mt,setInstructionSuggestion:Ht,handleSuggestBookInstructionImprovement:lC,isImageModalOpen:ze,setIsImageModalOpen:F,editingImageData:J,handleEditImage:K=>{ie(K),F(!0)},isRegeneratingImage:Cn,handleRegenerateImage:async K=>{if(J){Zt(!0);try{const ae=`${K} (Style: ${(C==null?void 0:C.imageGenerationInstructions)||""})`,be=await lY(ae),le=C==null?void 0:C.content[J.chapterIndex];if(le){const Ae=document.createElement("div");Ae.innerHTML=le.htmlContent;const $e=Ae.querySelector(`img[src="${J.src}"]`);$e&&($e.setAttribute("src",be),Qn(J.chapterIndex,Ae.innerHTML),ie({...J,src:be}),te.success("Image regenerated!"))}}catch(ae){te.error(ae.message)}finally{Zt(!1)}}},imageSuggestions:oc,setImageSuggestions:Ha,suggestionToGenerate:Ua,openImageSuggestionModal:K=>{Yo(K)},closeImageSuggestionModal:()=>{Yo(null)},generateImageFromSuggestion:async K=>{if(!(!Ua||!C)){P(!0);try{const ae=`${K} (Style: ${C.imageGenerationInstructions||""})`,be=await p_(ae,""),{chapterIndex:le,id:Ae}=Ua,$e=C.content[le],ht=new RegExp(`<span[^>]*data-suggestion-id="${Ae}"[^>]*></span>`,"i");if(ht.test($e.htmlContent)){const yt=`<img src="${be}" alt="${K}" />`,kt=$e.htmlContent.replace(ht,yt);Qn(le,kt),Ha(ln=>ln.filter(Ms=>Ms.id!==Ae)),Yo(null),te.success("Image generated and inserted.")}else te.error("Could not find insertion point.")}catch(ae){te.error(ae.message)}finally{P(!1)}}},isEpubModalOpen:pe,setIsEpubModalOpen:ue,handleStartEpubExport:iy,handleExportPdf:oi,handleDownloadAudiobook:K=>{Ym(K!==void 0?[K]:[]),_t(!0)},isDownloadModalOpen:yn,setIsDownloadModalOpen:_t,downloadModalInitialSelection:Km,handleSaveToDB:xo,handleSaveAndSync:bo,isSnapshotsPanelOpen:Ge,setIsSnapshotsPanelOpen:Je,snapshots:of,createSnapshot:$a,handleRestoreSnapshot:gf,handleDeleteSnapshot:Xd,isBrainstormModalOpen:ke,setIsBrainstormModalOpen:re,handleStartOutlineBrainstorm:ff,handleBrainstormComplete:(K,ae)=>{if(!C)return;const be=K.map(le=>C.content.find($e=>$e&&$e.title===le.title)||{title:le.title,htmlContent:""});M({...C,topic:ae,outline:K,content:be}),re(!1),q("unsaved"),te.success("Outline applied!")},isGeneratingChapter:Pn,handleGenerateChapters:pf,handleGenerateFullBook:mf,isAnalysisModalOpen:Qe,setIsAnalysisModalOpen:je,analysisData:rr,isAnalyzing:Wo,handleOpenAnalysisModal:async K=>{var be;if(!C)return;const ae=(be=C.content[K])==null?void 0:be.htmlContent;if(!ae){te.info("Chapter is empty.");return}je(!0),Fa(!0),qo({chapterIndex:K,result:null});try{const le=document.createElement("div");le.innerHTML=ae;const Ae=hf(C.aiPersona||"Standard Co-Author"),$e=await QK(ae,C,R,Ae);qo({chapterIndex:K,result:$e})}catch(le){te.error(le.message),je(!1)}finally{Fa(!1)}},handleExecuteAnalysisAction:ry,isStyleAnalysisModalOpen:ye,setIsStyleAnalysisModalOpen:Fe,styleAnalysisResult:af,analyzingStyleChapterIndex:ri,isAnalyzingStyle:at,handleAnalyzeChapterStyle:async K=>{if(C){Fe(!0),vn(!0),Un(K);try{const ae=await ZK(C.content[K].htmlContent,C.topic,C.instructions);ic(ae)}catch(ae){te.error(ae.message),Fe(!1)}finally{vn(!1)}}},handleApplyStyleSuggestion:(K,ae)=>{if(ri===null||!C)return;const le=C.content[ri].htmlContent.replace(K,ae);Qn(ri,le),ic(Ae=>Ae?Ae.filter($e=>$e.originalPassage!==K):null),te.success("Suggestion applied.")},isCharacterVoiceAnalysisModalOpen:He,setIsCharacterVoiceAnalysisModalOpen:Pt,characterVoiceAnalysisResult:cs,isAnalyzingCharacterVoice:Jb,handleAnalyzeCharacterVoice:async()=>{var be;if(!C||!C.knowledgeBase||C.knowledgeBase.length===0){te.error("No character profiles in Knowledge Base to analyze against.");return}const K=((be=C.content[G])==null?void 0:be.htmlContent)||"";if(!K.trim()){te.info("Current chapter is empty.");return}const ae=K.replace(/<[^>]*>/g,"");Pt(!0),Jo(!0),lf(null);try{const le=await rY(ae,C.knowledgeBase);lf(le)}catch(le){te.error(le.message),Pt(!1)}finally{Jo(!1)}},handleApplyCharacterVoiceSuggestion:(K,ae)=>{if(!C)return;const be=C.content[G].htmlContent,le=be.replace(K,ae);le===be?te.error("Could not find exact match to replace in HTML. You may need to edit manually."):(Qn(G,le),lf(Ae=>Ae?Ae.filter($e=>$e.dialogue!==K):null),te.success("Voice fix applied."))},isPlotHoleModalOpen:Sn,setIsPlotHoleModalOpen:as,plotHoleResults:ac,isAnalyzingPlotHoles:Qb,handleAnalyzePlotHoles:async()=>{var be;if(!C||C.outline.length===0){te.error("No outline to analyze against.");return}const K=((be=C.content[G])==null?void 0:be.htmlContent)||"";if(!K.trim()){te.info("Current chapter is empty.");return}const ae=K.replace(/<[^>]*>/g,"");as(!0),Wm(!0),Xb(null);try{const le=await oY(ae,C.outline,C.knowledgeBase||[]);Xb(le)}catch(le){te.error(le.message),as(!1)}finally{Wm(!1)}},isLoreConsistencyModalOpen:Xn,setIsLoreConsistencyModalOpen:De,loreConsistencyResults:iC,isAnalyzingLore:cf,handleAnalyzeLoreConsistency:async()=>{var be;if(!C||!C.knowledgeBase||C.knowledgeBase.length===0){te.error("No knowledge base to analyze against.");return}const K=((be=C.content[G])==null?void 0:be.htmlContent)||"";if(!K.trim()){te.info("Current chapter is empty.");return}const ae=K.replace(/<[^>]*>/g,"");De(!0),Pr(!0),lc(null);try{const le=await aY(ae,C.knowledgeBase);lc(le)}catch(le){te.error(le.message),De(!1)}finally{Pr(!1)}},handleApplyLoreSuggestion:(K,ae)=>{if(!C)return;const be=C.content[G].htmlContent,le=be.replace(K,ae);le===be?te.error("Could not find exact match. Please edit manually."):(Qn(G,le),lc(Ae=>Ae?Ae.filter($e=>$e.passage!==K):null),te.success("Lore fix applied."))},isChatOpen:qt,setIsChatOpen:jt,chatMessages:vs,handleSendChatMessage:mc,isChatLoading:rC,handleApplyEdit:Qd,handleExecuteTool:sy,activeEditorInstance:$,setActiveEditorInstance:Y,registerEditor:cC,unregisterEditor:sg,handleAssistantAction:ig,isAssistantLoading:he,handleAddChapter:tg,handleDeleteChapter:pc,handleMoveChapter:Xo,handleMergeChapters:ng,handleUpdateChapterOutline:Jd,isDeepAnalysisModalOpen:Ne,setIsDeepAnalysisModalOpen:ve,deepAnalysisResult:Ko,deepAnalysisType:Yb,handleApplyShowTellSuggestion:(K,ae)=>{if(rr.chapterIndex===null||!C)return;const le=C.content[rr.chapterIndex].htmlContent.replace(K,ae);Qn(rr.chapterIndex,le),Yb==="show_tell"&&nC(Ae=>Ae.filter($e=>$e.passage!==K)),te.success("Suggestion applied.")},isMacroResultModalOpen:Pe,setIsMacroResultModalOpen:ot,macroResults:Kd,handleRunMacro:async K=>{var be,le;const ae=u.find(Ae=>Ae.id===K);if(!(!ae||!C)){ot(!0),rc([]);for(const Ae of ae.actions){const $e={actionId:Ae.id,actionName:Ae.name,type:Ae.type,result:"Running..."};rc(ht=>[...ht,$e]);try{let ht;const yt=((be=C.content[G])==null?void 0:be.htmlContent)||"";if(Ae.type==="analyze_pacing"){const kt=yt.replace(/<[^>]*>/g,"");ht=await tY(kt)}else if(Ae.type==="analyze_show_dont_tell"){const kt=yt.replace(/<[^>]*>/g,"");ht=await nY(kt)}else if(Ae.type==="generate_alt_openings"){const kt=yt.replace(/<[^>]*>/g,"");ht=await sY(kt)}else if(Ae.type==="analyze_series_consistency"){const kt=(await Te.books.getAll()).filter(Ms=>Ms.seriesId===C.seriesId&&Ms.id!==C.id),ln=C.seriesId?await Te.series.get(C.seriesId):null;if(ln)ht=await iY(yt,C,kt,ln);else throw new Error("Book is not part of a series.")}else Ae.type==="rewrite_with_prompt"&&(ht=await eY(yt,C,R,((le=Ae.params)==null?void 0:le.prompt)||""),Qn(G,ht),ht="Chapter rewritten and updated.");rc(kt=>kt.map(ln=>ln.actionId===Ae.id?{...ln,result:ht}:ln))}catch(ht){rc(yt=>yt.map(kt=>kt.actionId===Ae.id?{...kt,error:ht.message}:kt))}}}},handleApplyMacroShowTellSuggestion:(K,ae)=>{if(!C)return;const le=C.content[G].htmlContent.replace(K,ae);Qn(G,le),te.success("Applied.")},handleApplyMacroOpeningSuggestion:K=>{if(!C)return;const ae=C.content[G].htmlContent,be=ae.match(/<p>(.*?)<\/p>/);if(be){const le=ae.replace(be[0],`<p>${K}</p>`);Qn(G,le),te.success("Opening updated.")}else te.error("Could not identify opening paragraph to replace.")},macros:u,isKnowledgeBaseOpen:Gt,setIsKnowledgeBaseOpen:bn,handleKnowledgeBaseUpdate:K=>{C&&Rn({knowledgeBase:K})},handleAutoFillKnowledgeBase:async()=>{if(C){Yd(!0);try{const K=C.content.map(Ae=>Ae.htmlContent).join(`
`),ae=await f_(C.topic,K),be=new Set((C.knowledgeBase||[]).map(Ae=>Ae.name.toLowerCase())),le=ae.filter(Ae=>!be.has(Ae.name.toLowerCase()));Rn({knowledgeBase:[...C.knowledgeBase||[],...le]}),te.success(`Added ${le.length} new entries.`)}catch(K){te.error(K.message)}finally{Yd(!1)}}},isAutoFillingKb:Zb,generatingSubSection:Bi,handleGenerateSubSection:async(K,ae)=>{var le;if(!C)return;const be=(le=C.outline[K].subSections)==null?void 0:le[ae];if(be){ys({chapter:K,section:ae}),Hn(K);try{const Ae=C.outline[K],$e=be.prompt;C.content[K]||Qn(K,"");const ht=[],yt=ln=>{M(Ms=>{var dy;if(!Ms)return null;const bf=[...Ms.content],cy=((dy=bf[K])==null?void 0:dy.htmlContent)||"";return bf[K]={title:Ae.title,htmlContent:cy+ln},{...Ms,content:bf}})};await wY(C.topic,C.instructions,C.knowledgeBase,R,Ae,$e,ht,yt,C.language||"en");const kt=Is(C.outline,ln=>{var Ms;(Ms=ln[K].subSections)!=null&&Ms[ae]&&(ln[K].subSections[ae].isGenerated=!0)});M(ln=>ln?{...ln,outline:kt}:null),q("unsaved")}catch(Ae){te.error(Ae.message)}finally{ys(null),Hn(null)}}},handleGenerateChapterBreakdown:async K=>{if(C){Hn(K);try{const ae=C.outline[K],le=(await bY(C.topic,C.instructions,ae)).map($e=>({prompt:$e,isGenerated:!1})),Ae=Is(C.outline,$e=>{$e[K].subSections=le});Rn({outline:Ae}),te.success("Chapter plan generated.")}catch(ae){te.error(ae.message)}finally{Hn(null)}}},handleUpdateSubSectionPrompt:(K,ae,be)=>{if(!C)return;const le=Is(C.outline,Ae=>{var $e;($e=Ae[K].subSections)!=null&&$e[ae]&&(Ae[K].subSections[ae].prompt=be)});Rn({outline:le})},handleRemoveSubSection:(K,ae)=>{if(!C)return;const be=Is(C.outline,le=>{le[K].subSections&&le[K].subSections.splice(ae,1)});Rn({outline:be})},handleAnalyzePlanCompleteness:async K=>{var Ae,$e;if(!C)return;const ae=C.outline[K],be=((Ae=C.content[K])==null?void 0:Ae.htmlContent)||"",le=(($e=ae.subSections)==null?void 0:$e.map(ht=>ht.prompt))||[];if(le.length!==0){Ci(K);try{const ht=await XK(be,le),yt=Is(C.outline,kt=>{kt[K].subSections&&kt[K].subSections.forEach((ln,Ms)=>{ln.isGenerated=ht[Ms]})});Rn({outline:yt}),te.success("Plan analysis complete.")}catch(ht){te.error(ht.message)}finally{Ci(null)}}},isAnalyzingPlan:oC,handleUpdateScene:(K,ae,be)=>{if(!C)return;const le=Is(C.outline,Ae=>{var ht;const $e=(ht=Ae[K].scenes)==null?void 0:ht.find(yt=>yt.id===ae);$e&&Object.assign($e,be)});Rn({outline:le})},handleAddScene:K=>{if(!C)return;const ae={id:crypto.randomUUID(),title:"New Scene",summary:""},be=Is(C.outline,le=>{le[K].scenes||(le[K].scenes=[]),le[K].scenes.push(ae)});Rn({outline:be})},handleDeleteScene:(K,ae)=>{if(!C)return;const be=Is(C.outline,le=>{le[K].scenes&&(le[K].scenes=le[K].scenes.filter(Ae=>Ae.id!==ae))});Rn({outline:be})},handleMoveScene:(K,ae,be)=>{if(!C)return;const le=Is(C.outline,Ae=>{const $e=Ae[K].scenes;if($e){const[ht]=$e.splice(ae,1);$e.splice(be,0,ht)}});Rn({outline:le})},geminiTTSVoices:hc,audiobookState:S,handlePlayFullBook:()=>f(n,0),handlePlayChapter:K=>f(n,K),handleSetVoice:()=>{},handleUpdateVoiceStyle:K=>Rn({voiceStyleInstructions:K}),handlePauseAudiobook:p,handleResumeAudiobook:g,handleStopAudiobook:b,handleSkipChapter:w,isMetadataOpen:Qt,setIsMetadataOpen:_s,isAiEnabled:N,isTextToImageModalOpen:Se,setIsTextToImageModalOpen:Me,textToImageContext:se,handleOpenTextToImage:dC,handleInsertGeneratedImage:uC,handleUpdatePersona:K=>{Rn({aiPersona:K})},isAutocompleteEnabled:Jm,toggleAutocomplete:()=>{dc(K=>!K)},customPersonas:uc,addCustomPersona:async K=>{const ae={...K,id:crypto.randomUUID()},be=[...uc,ae];uf(be),await Te.settings.put({id:"customPersonas",value:be}),te.success("Custom persona added.")},deleteCustomPersona:async K=>{const ae=uc.filter(be=>be.id!==K);uf(ae),await Te.settings.put({id:"customPersonas",value:ae}),te.info("Persona deleted.")}};return d.jsx(V3.Provider,{value:yC,children:t})},Xt=()=>{const n=T.useContext(V3);if(n===void 0)throw new Error("useBookEditor must be used within a BookEditorProvider");return n},q3=T.createContext(void 0),eJ=({children:n})=>{const[e,t]=T.useState(()=>{if(typeof window<"u"){const r=localStorage.getItem("theme");return r||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}return"light"});T.useEffect(()=>{const r=window.document.documentElement;e==="dark"?r.classList.add("dark"):r.classList.remove("dark"),localStorage.setItem("theme",e)},[e]);const s=T.useCallback(()=>{t(r=>r==="light"?"dark":"light")},[]),i=T.useMemo(()=>({theme:e,toggleTheme:s}),[e,s]);return d.jsx(q3.Provider,{value:i,children:n})},W3=()=>{const n=T.useContext(q3);if(n===void 0)throw new Error("useTheme must be used within a ThemeProvider");return n};var Bj={};const tJ="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",nJ="https://www.googleapis.com/auth/drive.appdata https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/drive.readonly",Ww=()=>({clientId:Bj.GOOGLE_CLIENT_ID||localStorage.getItem("google_client_id")||"",apiKey:Bj.GOOGLE_API_KEY||localStorage.getItem("google_api_key")||""}),sJ=(n,e)=>{n&&localStorage.setItem("google_client_id",n.trim()),e&&localStorage.setItem("google_api_key",e.trim())},iJ=()=>{localStorage.removeItem("google_client_id"),localStorage.removeItem("google_api_key")};let Ul=null,Kw=!1,Yw=!1,v_=!1,za=null,Em=0,_S=null,K0="loading";const GN=new Set,VN=new Set,Bc=n=>{K0=n,VN.forEach(e=>e(K0))};let Zg=null;const w_=()=>(Zg&&K0!=="unconfigured"&&K0!=="error"||(Zg=new Promise(n=>{const{clientId:e,apiKey:t}=Ww();if(!e||!t||e==="undefined"||t==="undefined"){console.warn("Google Drive API Key or Client ID missing."),Bc("unconfigured"),n();return}Bc("loading");const s=()=>{Kw&&Yw&&(Bc("ready"),localStorage.getItem("gdrive_connected")==="true"&&J3())},i=new Promise(o=>{const a=()=>{gapi.load("client:picker",async()=>{try{await gapi.client.init({apiKey:t,discoveryDocs:[tJ]}),Kw=!0,v_=!0,s()}catch(l){console.error("Failed to init GAPI client",l),Bc("error")}o()})};if(typeof gapi<"u")a();else{const l=document.createElement("script");l.src="https://apis.google.com/js/api.js",l.onload=a,l.onerror=()=>{console.error("Failed to load GAPI script"),Bc("error"),o()},document.body.appendChild(l)}}),r=new Promise(o=>{const a=()=>{try{Ul=google.accounts.oauth2.initTokenClient({client_id:e,scope:nJ,callback:l=>{if(l.error!==void 0)throw l;oJ(l)}}),Yw=!0,s()}catch(l){console.error("Failed to init GIS client",l),Bc("error")}o()};if(typeof google<"u"&&google.accounts)a();else{const l=document.createElement("script");l.src="https://accounts.google.com/gsi/client",l.onload=a,l.onerror=()=>{console.error("Failed to load GIS script"),Bc("error"),o()},document.body.appendChild(l)}});Promise.all([i,r]).then(()=>{n()})})),Zg),K3=async(n,e)=>{sJ(n,e),Kw=!1,Yw=!1,v_=!1,Zg=null,await w_()},rJ=()=>{iJ(),X3(),Bc("unconfigured")},oJ=n=>{if(n&&n.access_token){za=n.access_token;const e=n.expires_in?parseInt(n.expires_in):3599;Em=Date.now()+e*1e3-6e4,localStorage.setItem("gdrive_connected","true"),aJ()}},aJ=async()=>{if(za)try{const n=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${za}`}});n.ok&&(_S=await n.json(),Y3())}catch(n){console.warn("Failed to fetch user profile",n)}},k_=n=>(GN.add(n),n(!!za&&Date.now()<Em,_S),()=>GN.delete(n)),Y3=()=>{const n=!!za&&Date.now()<Em;GN.forEach(e=>e(n,_S))},Yv=()=>{if(!Ul){w_().then(()=>{Ul&&Ul.requestAccessToken({prompt:"consent"})});return}Ul.requestAccessToken({prompt:"consent"})},J3=()=>{Ul&&Ul.requestAccessToken({prompt:"none"})},X3=()=>{var e,t,s;const n=(e=gapi==null?void 0:gapi.client)==null?void 0:e.getToken();n!==null&&((t=google==null?void 0:google.accounts)!=null&&t.oauth2)&&google.accounts.oauth2.revoke(n.access_token,()=>{}),(s=gapi==null?void 0:gapi.client)==null||s.setToken(null),za=null,_S=null,Em=0,localStorage.removeItem("gdrive_connected"),Y3()},Q3=n=>(VN.add(n),n(K0),()=>VN.delete(n)),$m=async()=>{if(!Kw||!Yw)throw new Error("Google Services not initialized.");if(!(za&&Date.now()<Em)){if(localStorage.getItem("gdrive_connected")==="true")return new Promise((n,e)=>{const t=Date.now();if(Ul)Ul.requestAccessToken({prompt:"none"});else{e(new Error("Token client not initialized"));return}const s=setInterval(()=>{za&&Date.now()<Em?(clearInterval(s),n()):Date.now()-t>5e3&&(clearInterval(s),e(new Error("Silent refresh failed. Please sign in again.")))},100)});throw new Error("Not signed in.")}},lJ=async()=>{await $m();const n=await Te.backup(),e=JSON.parse(n);if(e.books.length===0&&e.instructions.length===0)throw new Error("No data to backup.");const i={name:`ai-book-studio-backup-${new Date().toISOString().replace(/[:.]/g,"-")}.json`,parents:["appDataFolder"],mimeType:"application/json"},r=new Blob([n],{type:"application/json"}),o=new Blob([JSON.stringify(i)],{type:"application/json"}),a=new FormData;a.append("metadata",o),a.append("file",r);const l=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:{Authorization:`Bearer ${za}`},body:a});if(!l.ok){const u=await l.text();throw new Error(`Upload failed: ${l.status} - ${u}`)}},cJ=async()=>(await $m(),(await gapi.client.drive.files.list({spaces:"appDataFolder",fields:"files(id, name, modifiedTime)",orderBy:"modifiedTime desc",pageSize:20})).result.files||[]),dJ=async n=>(await $m(),(await gapi.client.drive.files.get({fileId:n,alt:"media"})).body),uJ=async n=>{await $m(),await gapi.client.drive.files.delete({fileId:n})},hJ=async n=>(await $m(),(await gapi.client.drive.files.export({fileId:n,mimeType:"text/html"})).body),fJ=async n=>{if(await $m(),!v_)throw new Error("Google Picker not initialized.");const{apiKey:e}=Ww(),t=new google.picker.View(google.picker.ViewId.DOCS);t.setMimeTypes("application/vnd.google-apps.document"),new google.picker.PickerBuilder().setDeveloperKey(e).setAppId(Ww().clientId.split("-")[0]).setOAuthToken(za).addView(t).addView(new google.picker.DocsUploadView).setCallback(i=>{if(i[google.picker.Response.ACTION]==google.picker.Action.PICKED){const r=i[google.picker.Response.DOCUMENTS][0];n(r[google.picker.Document.ID],r[google.picker.Document.NAME])}}).build().setVisible(!0)},pJ="modulepreload",mJ=function(n){return"/book-studio/"+n},Fj={},Hj=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){let o=function(u){return Promise.all(u.map(f=>Promise.resolve(f).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=o(t.map(u=>{if(u=mJ(u),u in Fj)return;Fj[u]=!0;const f=u.endsWith(".css"),p=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${p}`))return;const g=document.createElement("link");if(g.rel=f?"stylesheet":pJ,f||(g.as="script"),g.crossOrigin="",g.href=u,l&&g.setAttribute("nonce",l),document.head.appendChild(g),f)return new Promise((b,w)=>{g.addEventListener("load",b),g.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${u}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return e().catch(r)})};class gJ{constructor(){this.undoStack=[],this.redoStack=[],this.subscribers=new Set,this.isRestoring=!1,this.MAX_HISTORY_SIZE=50,this.initPromise=null}init(){return this.initPromise||(this.initPromise=this.loadStateFromDB()),this.initPromise}subscribe(e){return this.subscribers.add(e),e(this.getState()),()=>{this.subscribers.delete(e)}}notify(e=!0){this.subscribers.forEach(t=>t(this.getState())),e&&this.saveStateToDB()}getState(){return{canUndo:this.undoStack.length>0,canRedo:this.redoStack.length>0}}async saveStateToDB(){try{const{db:e}=await Hj(async()=>{const{db:t}=await Promise.resolve().then(()=>Jz);return{db:t}},[]);await this.init(),await e.history.put({id:"undoStack",value:this.undoStack}),await e.history.put({id:"redoStack",value:this.redoStack})}catch(e){console.warn("Could not save history to IndexedDB.",e)}}async loadStateFromDB(){try{const{db:e}=await Hj(async()=>{const{db:i}=await Promise.resolve().then(()=>Jz);return{db:i}},void 0),t=await e.history.get("undoStack"),s=await e.history.get("redoStack");t&&Array.isArray(t.value)&&(this.undoStack=t.value),s&&Array.isArray(s.value)&&(this.redoStack=s.value)}catch(e){console.error("Could not load history from IndexedDB.",e),this.undoStack=[],this.redoStack=[]}finally{this.notify(!1)}}async addHistoryStep(e){this.isRestoring||(await this.init(),!(this.undoStack.length>0&&this.undoStack[this.undoStack.length-1]===e)&&(this.undoStack.push(e),this.undoStack.length>this.MAX_HISTORY_SIZE&&this.undoStack.shift(),this.redoStack.length>0&&(this.redoStack=[]),this.notify()))}async undo(e){if(await this.init(),this.undoStack.length===0)return;this.redoStack.push(e),this.redoStack.length>this.MAX_HISTORY_SIZE&&this.redoStack.shift();const t=this.undoStack.pop();return this.notify(),t}async redo(e){if(await this.init(),this.redoStack.length===0)return;this.undoStack.push(e),this.undoStack.length>this.MAX_HISTORY_SIZE&&this.undoStack.shift();const t=this.redoStack.pop();return this.notify(),t}}const Fc=new gJ,Tn={BOOK:'<path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>',GRID:'<rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/>',EDIT:'<path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>',WORKFLOW:'<circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><path d="M8.59 13.51l6.83 4.98"/><path d="M15.41 6.51l-6.82 4.98"/>',SETTINGS:'<circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>',PLUS:'<path d="M5 12h14"/><path d="M12 5v14"/>',LINK:'<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"/>',DOWNLOAD:'<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>',UPLOAD:'<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>',WAND:'<path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>',SPARKLES:'<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>',TRASH:'<path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>',CLOSE:'<path d="M18 6 6 18"/><path d="m6 6 12 12"/>',CHEVRON_LEFT:'<path d="m15 18-6-6 6-6"/>',CHEVRON_RIGHT:'<path d="m9 18 6-6-6-6"/>',HISTORY:'<polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>',SAVE:'<path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>',COPY:'<rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>',MORE_VERTICAL:'<circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/>',IMAGE:'<rect width="18" height="18" x="3" y="3" rx="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>',IMAGE_PLUS:'<path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7" /><line x1="16" y1="5" x2="22" y2="5" /><line x1="19" y1="2" x2="19" y2="8" /><circle cx="9" cy="9" r="2" /><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" />',UNDO:'<path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/>',REDO:'<path d="M21 7v6h-6"/><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3L21 13"/>',ROTATE_CW:'<path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/>',REPHRASE:'<polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/>',EXPAND:'<polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/>',SUMMARIZE:'<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/>',TONE:'<line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/><line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/>',COMMAND:'<path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z"/>',SEARCH:'<circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>',SEARCH_REPLACE:'<path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>',BRAIN:'<ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>',PEN_TOOL:'<path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/>',LAYOUT:'<rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/>',LIST:'<path d="M8 6h13"/><path d="M8 12h13"/><path d="M8 18h13"/><path d="M3 6h.01"/><path d="M3 12h.01"/><path d="M3 18h.01"/>',MESSAGE_CIRCLE:'<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2-2z"/>',CLOUD_CHECK:'<path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/><polyline points="9 13 12 16 16 11"/>',CLOUD_OFF:'<path d="M22.61 16.95A5 5 0 0 0 18 10h-1.26a8 8 0 0 0-7.05-6M5 5a8 8 0 0 0 4 15h9a5 5 0 0 0 1.7-.3"/><line x1="1" y1="1" x2="23" y2="23"/>',INFO:'<circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>',CLOUD:'<path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/>',HEADPHONES:'<path d="M3 18v-6a9 9 0 0 1 18 0v6"/><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/>',PLAY:'<polygon points="5 3 19 12 5 21 5 3"/>',PAUSE:'<rect width="4" height="16" x="6" y="4"/><rect width="4" height="16" x="14" y="4"/>',SKIP_BACK:'<polygon points="19 20 9 12 19 4 19 20"/><line x1="5" y1="19" x2="5" y2="5"/>',SKIP_FORWARD:'<polygon points="5 4 15 12 5 20 5 4"/><line x1="19" y1="5" x2="19" y2="19"/>',STOP_CIRCLE:'<circle cx="12" cy="12" r="10"/><rect width="6" height="6" x="9" y="9"/>',SUN:'<circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m4.93 19.07 1.41-1.41"/><path d="m17.66 6.34 1.41-1.41"/>',MOON:'<path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>',LOCK:'<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>',UNLOCK:'<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/>',SYNTHESIZE:'<circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><path d="M6 9v6"/><path d="M9 12h12"/><circle cx="18" cy="12" r="3"/>',CODE:'<polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/>',MENU:'<line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/>',CHECK_SQUARE:'<polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>',TABLE:'<rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/><path d="M9 3v18"/><path d="M15 3v18"/>',HIGHLIGHT:'<path d="m9 11-6 6v3h9l3-3"/><path d="m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4"/>',ARCHIVE:'<rect width="20" height="5" x="2" y="3" rx="1"/><path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8"/><path d="M10 12h4"/>',RESTORE:'<path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/>',ROW_PLUS:'<rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/><line x1="12" y1="12" x2="12" y2="12.01"/><line x1="12" y1="3" x2="12" y2="9"/><line x1="12" y1="15" x2="12" y2="21"/>',COL_PLUS:'<rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="9" y1="3" x2="9" y2="21"/><line x1="15" y1="3" x2="15" y2="21"/><line x1="3" y1="12" x2="21" y2="12"/>',MERGE:'<rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/><path d="M9 3v6"/><path d="M15 3v18"/>',DELETE_ROW:'<path d="M3 6h18"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/><line x1="3" y1="12" x2="21" y2="12" style="stroke-dasharray: 2 2"/>',DELETE_COL:'<path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><line x1="12" y1="6" x2="12" y2="22" style="stroke-dasharray: 2 2"/>',FILE_TEXT:'<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/>',BOLD:'<path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/><path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/>',ITALIC:'<line x1="19" y1="4" x2="10" y2="4"/><line x1="14" y1="20" x2="5" y2="20"/><line x1="15" y1="4" x2="9" y2="20"/>',UNDERLINE:'<path d="M6 4v6a6 6 0 0 0 12 0V4"/><line x1="4" y1="20" x2="20" y2="20"/>',USER:'<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>',ALERT_TRIANGLE:'<path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>'},xJ={Fiction:["Hero's Journey","Save the Cat","Three-Act Structure","Fichtean Curve","Seven-Point Structure"],"Non-Fiction":["Problem-Agitate-Solve","Heroes Journey (Non-Fiction)","The Golden Circle","Pillar Content"]},bJ=[{type:"analyze_pacing",name:"Analyze Pacing"},{type:"analyze_show_dont_tell",name:"Show, Don't Tell Analysis"},{type:"generate_alt_openings",name:"Generate Alternative Openings"},{type:"analyze_series_consistency",name:"Check Series Consistency"},{type:"rewrite_with_prompt",name:"Rewrite with Custom Prompt"}],yJ=["Character","Place","Object","Event","Lore","Value System & Beliefs","Technology & Magic Systems","Culture & Society","History & Timeline","Plot & Narrative Structure","Theme & Tone","Other"],vJ=`## Core Beliefs
- 

## Virtues & Vices
- 

## Religion/Philosophy
- `,wJ=`## System Rules
- 

## Limitations & Costs
- 

## Impact on Society
- `,kJ=`## Social Structure
- 

## Customs & Traditions
- 

## Politics
- `,SJ=`## Key Events
- 

## Historical Figures
- 

## Myths & Legends
- `,CJ=`## Core Conflict
- 

## Key Plot Points
- 

## Ending Goal
- `,AJ=`## Central Themes
- 

## Atmosphere & Mood
- 

## Stylistic Choices
- `,H=({name:n,...e})=>{const t=Tn[n];return t?d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,dangerouslySetInnerHTML:{__html:t}}):(console.warn(`Icon "${n}" not found.`),null)},Uj=({label:n,page:e,currentPage:t,icon:s,onClick:i})=>{const r=t===e;return d.jsx("li",{children:d.jsxs(DO,{to:`/${e}`,onClick:i,className:`flex items-center space-x-3 w-full px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 group ${r?"bg-indigo-600 text-white shadow-md shadow-indigo-200 dark:shadow-indigo-900/20":"text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800/50 hover:text-zinc-900 dark:hover:text-zinc-200"}`,children:[d.jsx(H,{name:s,className:`w-5 h-5 transition-transform duration-200 ${r?"":"group-hover:scale-110 text-zinc-400 dark:text-zinc-500 group-hover:text-zinc-600 dark:group-hover:text-zinc-300"}`}),d.jsx("span",{children:n})]})})},NJ=()=>{const[n,e]=T.useState("idle"),[t,s]=T.useState(null),[i,r]=T.useState("");T.useEffect(()=>U3(b=>{e(b.status),s(b.lastBackupTimestamp)}),[]),T.useEffect(()=>{const g=()=>{if(!t){r("");return}const w=Date.now(),S=Math.round((w-t)/1e3);S<10?r("just now"):S<60?r(`${S}s ago`):S<3600?r(`${Math.floor(S/60)}m ago`):S<86400?r(`${Math.floor(S/3600)}h ago`):r(`${Math.floor(S/86400)}d ago`)};g();const b=setInterval(g,1e4);return()=>clearInterval(b)},[t]);const o=()=>{switch(n){case"syncing":return{icon:"ROTATE_CW",color:"text-blue-500",text:"Syncing...",spin:!0};case"synced":return{icon:"CLOUD_CHECK",color:"text-emerald-500",text:`Saved ${i}`,spin:!1};case"failed":return{icon:"CLOUD_OFF",color:"text-red-500",text:"Backup Failed",spin:!1};case"disabled":return{icon:"CLOUD_OFF",color:"text-zinc-400",text:"Backup Disabled",spin:!1};case"idle":default:return{icon:"CLOUD",color:"text-zinc-400",text:"Backup Ready",spin:!1}}},{icon:a,color:l,text:u,spin:f}=o(),p=n!=="syncing"&&n!=="disabled";return d.jsxs("button",{onClick:()=>p&&gp(!0),disabled:!p,className:"flex items-center space-x-2 text-xs font-medium text-zinc-500 dark:text-zinc-400 hover:text-zinc-800 dark:hover:text-zinc-200 transition-colors w-full px-2 py-1 rounded disabled:cursor-default",title:n==="disabled"?"Enable in Settings":"Click to force backup now",children:[d.jsx(H,{name:a,className:`w-4 h-4 ${l} ${f?"animate-spin":""}`}),d.jsx("span",{children:u})]})},EJ=()=>{const[n,e]=T.useState(null);return T.useEffect(()=>{const t=k_((s,i)=>{e(s&&i?i:null)});return()=>{t()}},[]),n?d.jsxs("div",{className:"flex items-center space-x-3 px-2 py-2 bg-zinc-50 dark:bg-zinc-700/30 rounded-xl border border-zinc-100 dark:border-zinc-700/50 mb-3",children:[d.jsx("img",{src:n.picture,alt:n.name,className:"w-8 h-8 rounded-full border border-zinc-200 dark:border-zinc-600"}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("p",{className:"text-xs font-bold text-zinc-800 dark:text-zinc-100 truncate",children:n.name}),d.jsx("p",{className:"text-[10px] text-zinc-500 dark:text-zinc-400 truncate",children:n.email})]})]}):null},TJ=({currentPage:n,isOpen:e,setIsOpen:t})=>{const{theme:s,toggleTheme:i}=W3(),r=[{page:"dashboard",label:"Library",icon:"GRID"},{page:"documents",label:"Documents",icon:"FILE_TEXT"},{page:"reading",label:"Reading",icon:"BOOK"},{page:"instructions",label:"Templates",icon:"EDIT"},{page:"macros",label:"Workflows",icon:"WORKFLOW"},{page:"settings",label:"Settings",icon:"SETTINGS"}],o=[{page:"archived",label:"Archived",icon:"ARCHIVE"},{page:"trash",label:"Trash",icon:"TRASH"}];return d.jsxs(d.Fragment,{children:[d.jsx("div",{className:`fixed inset-0 bg-zinc-900/20 dark:bg-black/50 backdrop-blur-sm z-30 lg:hidden transition-opacity duration-300 ${e?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:()=>t(!1),"aria-hidden":"true"}),d.jsxs("aside",{className:`fixed inset-y-0 left-0 w-72 bg-white dark:bg-zinc-900 border-r border-zinc-200 dark:border-zinc-800 flex flex-col z-40 transform transition-transform duration-300 ease-[cubic-bezier(0.2,0,0,1)] ${e?"translate-x-0":"-translate-x-full"} lg:translate-x-0 lg:shadow-none shadow-2xl pb-[env(safe-area-inset-bottom)]`,children:[d.jsxs("div",{className:"flex items-center justify-between p-6 pb-2 pt-[calc(1.5rem+env(safe-area-inset-top))]",children:[d.jsxs(DO,{to:"/",className:"flex items-center space-x-3 group",onClick:()=>t(!1),children:[d.jsx("div",{className:"bg-indigo-600 text-white p-2 rounded-lg shadow-lg shadow-indigo-200 dark:shadow-none group-hover:bg-indigo-700 transition-colors",children:d.jsx(H,{name:"BOOK",className:"w-6 h-6"})}),d.jsxs("div",{children:[d.jsx("span",{className:"block text-lg font-bold text-zinc-900 dark:text-white leading-none",children:"AI Book"}),d.jsx("span",{className:"block text-xs font-medium text-zinc-500 dark:text-zinc-400 tracking-wider uppercase mt-0.5",children:"Studio"})]})]}),d.jsx("button",{onClick:()=>t(!1),className:"lg:hidden p-2 rounded-lg text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors","aria-label":"Close sidebar",children:d.jsx(H,{name:"CLOSE",className:"w-5 h-5"})})]}),d.jsxs("nav",{className:"flex-1 px-4 py-6 space-y-8 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-700",children:[d.jsxs("div",{children:[d.jsx("p",{className:"px-4 text-xs font-semibold text-zinc-400 dark:text-zinc-500 uppercase tracking-wider mb-3",children:"Menu"}),d.jsx("ul",{className:"space-y-1",children:r.map(a=>d.jsx(Uj,{label:a.label,page:a.page,currentPage:n,icon:a.icon,onClick:()=>t(!1)},a.page))})]}),d.jsxs("div",{children:[d.jsx("p",{className:"px-4 text-xs font-semibold text-zinc-400 dark:text-zinc-500 uppercase tracking-wider mb-3",children:"Library"}),d.jsx("ul",{className:"space-y-1",children:o.map(a=>d.jsx(Uj,{label:a.label,page:a.page,currentPage:n,icon:a.icon,onClick:()=>t(!1)},a.page))})]})]}),d.jsxs("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 pb-[calc(1rem+env(safe-area-inset-bottom))]",children:[d.jsx(EJ,{}),d.jsx("div",{className:"flex items-center justify-between mb-3 px-2",children:d.jsx(NJ,{})}),d.jsxs("div",{className:"flex items-center justify-between px-2 pt-2 border-t border-zinc-200/50 dark:border-zinc-700/50",children:[d.jsxs("button",{onClick:i,className:"flex items-center space-x-2 text-xs font-medium text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-200 transition-colors p-1.5 rounded-md hover:bg-zinc-200/50 dark:hover:bg-zinc-700/50","aria-label":"Toggle theme",children:[d.jsx(H,{name:s==="light"?"MOON":"SUN",className:"w-4 h-4"}),d.jsx("span",{children:s==="light"?"Dark Mode":"Light Mode"})]}),d.jsx("span",{className:"text-[10px] text-zinc-300 dark:text-zinc-600",children:"v1.3.2"})]})]})]})]})},_J=({onMenuClick:n})=>d.jsx("header",{className:"bg-white dark:bg-zinc-800/50 backdrop-blur-sm border-b border-zinc-200 dark:border-zinc-700 p-4 pt-[calc(1rem+env(safe-area-inset-top))] lg:hidden",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("button",{onClick:n,className:"p-3 rounded-md text-zinc-500 hover:bg-zinc-200 dark:hover:bg-zinc-700","aria-label":"Open sidebar",children:d.jsxs("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[d.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),d.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),d.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx(H,{name:"BOOK",className:"text-2xl w-8 h-8"}),d.jsx("span",{className:"text-xl font-bold text-zinc-800 dark:text-white",children:"AI Book Studio"})]})]})}),sr=({message:n})=>d.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex flex-col items-center justify-center z-[10002]",children:[d.jsx("div",{className:"w-16 h-16 border-4 border-t-blue-500 border-gray-200 rounded-full animate-spin"}),d.jsx("p",{className:"mt-4 text-white text-lg font-semibold",children:n})]}),Z3=({book:n,allBooks:e,onClose:t,onCoverGenerated:s})=>{const[i,r]=T.useState(n.topic),[o,a]=T.useState(n.imageGenerationInstructions||"Photorealistic, cinematic lighting, epic fantasy"),[l,u]=T.useState(n.coverImage?[n.coverImage]:[]),[f,p]=T.useState(n.coverImage?0:-1),[g,b]=T.useState(""),[w,S]=T.useState(!1),[N,C]=T.useState(""),M=T.useRef(null),R=f>=0?l[f]:null,_=e.filter(Z=>Z.id!==n.id),j=Z=>{const $=l.slice(0,f+1);$.push(Z),u($),p($.length-1)},P=()=>{f>0&&p(f-1)},D=()=>{f<l.length-1&&p(f+1)},U=async()=>{if(!i.trim()||!o.trim()){C("Please provide both a description and a style.");return}S(!0),C("");try{const Z=await p_(i,o);j(Z)}catch(Z){C(Z.message||"Failed to generate cover image.")}finally{S(!1)}},V=async()=>{if(!(!R||!g.trim())){S(!0),C("");try{const Z=await R3(R,g);j(Z),b("")}catch(Z){C(Z.message||"Failed to refine image.")}finally{S(!1)}}},q=()=>{R&&s(n.id,R)},G=Z=>{if(!Z)return;const $=e.find(Y=>Y.id===Z);$&&$.imageGenerationInstructions?(a($.imageGenerationInstructions),te.info(`Style copied from "${$.topic}"`)):te.error("Could not find style instructions for the selected book.")},ee=()=>{var Z;(Z=M.current)==null||Z.click()},W=Z=>{var Y;const $=(Y=Z.target.files)==null?void 0:Y[0];if($){const he=new FileReader;he.onload=Re=>{var F;const ze=(F=Re.target)==null?void 0:F.result;ze&&(j(ze),te.success("Cover uploaded successfully."))},he.readAsDataURL($)}Z.target.value=""},Q=()=>{if(!R)return;const Z=document.createElement("a");Z.href=R,Z.download=`${n.topic.replace(/[^a-z0-9]/gi,"_")}_cover.png`,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z)};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:t,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:Z=>Z.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsxs("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:['Generate Book Cover for "',n.topic,'"']}),d.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 flex-grow overflow-y-auto pr-2 -mr-2",children:[d.jsxs("div",{className:"flex flex-col space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Cover Description"}),d.jsx("textarea",{id:"description",value:i,onChange:Z=>r(Z.target.value),rows:4,className:"mt-1 block w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"A lone knight standing on a cliff overlooking a stormy sea..."})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"style",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Art Style"}),d.jsx("textarea",{id:"style",value:o,onChange:Z=>a(Z.target.value),rows:4,className:"mt-1 block w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., minimalist, photographic, watercolor, vintage sci-fi"})]}),_.length>0&&d.jsxs("div",{className:"mt-2",children:[d.jsx("label",{htmlFor:"copy-style",className:"block text-xs font-medium text-gray-500 dark:text-gray-400",children:"Or copy style from another book"}),d.jsxs("select",{id:"copy-style",onChange:Z=>G(Z.target.value),defaultValue:"",className:"mt-1 block w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm",children:[d.jsx("option",{value:"",children:"-- Select a book --"}),_.map(Z=>d.jsx("option",{value:Z.id,children:Z.topic},Z.id))]})]}),R&&d.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-600",children:[d.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-gray-100 mb-2",children:"Fine Tune Current Image"}),d.jsx("label",{htmlFor:"refinement",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Adjustment Instructions"}),d.jsx("textarea",{id:"refinement",value:g,onChange:Z=>b(Z.target.value),rows:3,className:"mt-1 block w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., Remove the tree, make the title text larger, change the background to sunset..."}),d.jsx("button",{onClick:V,disabled:w||!g.trim(),className:"mt-2 w-full bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition-colors disabled:bg-indigo-400",children:"Apply Changes"})]}),N&&d.jsx("p",{className:"text-sm text-red-500",children:N})]}),d.jsxs("div",{className:"flex flex-col h-full",children:[d.jsx("div",{className:"bg-gray-100 dark:bg-gray-900/50 rounded-lg flex items-center justify-center p-4 flex-grow min-h-[300px] relative",children:w?d.jsxs("div",{className:"flex flex-col items-center text-gray-500 dark:text-gray-400",children:[d.jsx("div",{className:"w-12 h-12 border-4 border-t-blue-500 border-gray-200 rounded-full animate-spin"}),d.jsx("p",{className:"mt-3 font-semibold",children:"Generating cover..."})]}):R?d.jsx("img",{src:R,alt:"Generated cover",className:"max-h-full w-auto object-contain rounded-md shadow-lg"}):d.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400",children:[d.jsx(H,{name:"IMAGE",className:"w-16 h-16"}),d.jsx("p",{className:"mt-2",children:"Cover preview will appear here"})]})}),d.jsxs("div",{className:"flex items-center justify-between mt-3 px-1",children:[d.jsxs("div",{className:"flex space-x-2",children:[d.jsx("button",{onClick:P,disabled:f<=0||w,className:"p-2 rounded-md bg-zinc-100 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-600 disabled:opacity-40 transition-colors",title:"Undo",children:d.jsx(H,{name:"UNDO",className:"w-4 h-4"})}),d.jsx("button",{onClick:D,disabled:f>=l.length-1||w,className:"p-2 rounded-md bg-zinc-100 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-600 disabled:opacity-40 transition-colors",title:"Redo",children:d.jsx(H,{name:"REDO",className:"w-4 h-4"})})]}),d.jsxs("div",{className:"flex space-x-2",children:[d.jsx("input",{type:"file",ref:M,onChange:W,className:"hidden",accept:"image/*"}),d.jsx("button",{onClick:ee,disabled:w,className:"p-2 rounded-md bg-zinc-100 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-600 disabled:opacity-40 transition-colors",title:"Upload Custom Cover",children:d.jsx(H,{name:"UPLOAD",className:"w-4 h-4"})}),d.jsx("button",{onClick:Q,disabled:!R||w,className:"p-2 rounded-md bg-zinc-100 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-600 disabled:opacity-40 transition-colors",title:"Download Cover",children:d.jsx(H,{name:"DOWNLOAD",className:"w-4 h-4"})})]})]})]})]}),d.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[d.jsx("div",{children:R&&d.jsx("button",{onClick:U,disabled:w,className:"bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors disabled:opacity-50",children:"Regenerate New"})}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsx("button",{onClick:t,disabled:w,className:"bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors disabled:opacity-50",children:"Cancel"}),R?d.jsxs("button",{onClick:q,disabled:w,className:"bg-green-600 text-white px-6 py-2 rounded-lg shadow font-semibold hover:bg-green-700 transition-colors flex items-center space-x-2 disabled:opacity-50",children:[d.jsx(H,{name:"SAVE",className:"w-5 h-5"}),d.jsx("span",{children:"Save Cover"})]}):d.jsxs("button",{onClick:U,disabled:w,className:"bg-blue-600 text-white px-6 py-2 rounded-lg shadow font-semibold hover:bg-blue-700 transition-colors flex items-center space-x-2 disabled:opacity-50",children:[d.jsx(H,{name:"WAND",className:"w-5 h-5"}),d.jsx("span",{children:"Generate"})]})]})]})]})})},e4=({book:n,onClose:e})=>{const{fetchSnapshotsForBook:t,createSnapshot:s,restoreSnapshot:i,deleteSnapshot:r}=T.useContext(rs),[o,a]=T.useState([]),[l,u]=T.useState(!0),[f,p]=T.useState(""),g=async()=>{u(!0);const N=await t(n.id);a(N.sort((C,M)=>M.createdAt-C.createdAt)),u(!1)};T.useEffect(()=>{g()},[n.id]);const b=async N=>{N.preventDefault(),f.trim()&&(await s(n,f.trim()),te.success("Version saved!"),p(""),await g())},w=async N=>{await Mn.confirm({title:`Restore "${N.name}"?`,message:`This will overwrite the current version of "${n.topic}" with the version from ${new Date(N.createdAt).toLocaleString()}. This action cannot be undone.`,confirmText:"Restore Version",danger:!0})&&(await i(N),te.success("Book restored to selected version."),e())},S=async N=>{await Mn.confirm({title:`Delete "${N.name}"?`,message:"Are you sure you want to permanently delete this version? This action cannot be undone.",confirmText:"Delete Version",danger:!0})&&(await r(N.id),te.info("Version deleted."),await g())};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col border border-zinc-200 dark:border-zinc-700",onClick:N=>N.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-zinc-200 dark:border-zinc-700 flex-shrink-0",children:[d.jsxs("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100 truncate",children:["Version History: ",n.topic]}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700","aria-label":"Close",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("form",{onSubmit:b,className:"p-4 border-b border-zinc-200 dark:border-zinc-700 flex-shrink-0",children:[d.jsx("label",{htmlFor:"snapshot-name",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Save new version"}),d.jsxs("div",{className:"mt-1 flex gap-2",children:[d.jsx("input",{id:"snapshot-name",type:"text",value:f,onChange:N=>p(N.target.value),placeholder:'e.g., "Finished draft", "Before rewrite"',className:"flex-grow block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500"}),d.jsx("button",{type:"submit",className:"bg-indigo-600 text-white px-4 py-2 rounded-lg shadow font-semibold hover:bg-indigo-700 transition-colors disabled:bg-indigo-400",disabled:!f.trim(),children:"Save"})]})]}),d.jsx("div",{className:"flex-grow overflow-y-auto p-4",children:l?d.jsx("p",{className:"text-center text-zinc-500",children:"Loading history..."}):o.length>0?d.jsx("ul",{className:"space-y-3",children:o.map(N=>d.jsxs("li",{className:"bg-zinc-50 dark:bg-zinc-700/50 p-3 rounded-lg flex flex-col sm:flex-row justify-between items-start sm:items-center border border-zinc-200 dark:border-zinc-700",children:[d.jsxs("div",{className:"mb-2 sm:mb-0",children:[d.jsx("p",{className:"font-semibold text-zinc-800 dark:text-zinc-100",children:N.name}),d.jsxs("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:["Saved: ",new Date(N.createdAt).toLocaleString()]})]}),d.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[d.jsx("button",{onClick:()=>w(N),className:"px-3 py-1 text-sm font-semibold rounded-md bg-emerald-600 text-white hover:bg-emerald-700 transition-colors",children:"Restore"}),d.jsx("button",{onClick:()=>S(N),className:"p-2 rounded-full text-zinc-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-zinc-700",title:"Delete version",children:d.jsx(H,{name:"TRASH",className:"w-4 h-4"})})]})]},N.id))}):d.jsx("p",{className:"text-center text-zinc-500 py-8",children:"No versions saved for this book yet."})})]})})};function S_(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let nf=S_();function t4(n){nf=n}const n4=/[&<>"']/,MJ=new RegExp(n4.source,"g"),s4=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,RJ=new RegExp(s4.source,"g"),IJ={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},$j=n=>IJ[n];function Er(n,e){if(e){if(n4.test(n))return n.replace(MJ,$j)}else if(s4.test(n))return n.replace(RJ,$j);return n}const zJ=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function DJ(n){return n.replace(zJ,(e,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}const jJ=/(^|[^\[])\^/g;function pn(n,e){let t=typeof n=="string"?n:n.source;e=e||"";const s={replace:(i,r)=>{let o=typeof r=="string"?r:r.source;return o=o.replace(jJ,"$1"),t=t.replace(i,o),s},getRegex:()=>new RegExp(t,e)};return s}function Gj(n){try{n=encodeURI(n).replace(/%25/g,"%")}catch{return null}return n}const w0={exec:()=>null};function Vj(n,e){const t=n.replace(/\|/g,(r,o,a)=>{let l=!1,u=o;for(;--u>=0&&a[u]==="\\";)l=!l;return l?"|":" |"}),s=t.split(/ \|/);let i=0;if(s[0].trim()||s.shift(),s.length>0&&!s[s.length-1].trim()&&s.pop(),e)if(s.length>e)s.splice(e);else for(;s.length<e;)s.push("");for(;i<s.length;i++)s[i]=s[i].trim().replace(/\\\|/g,"|");return s}function $g(n,e,t){const s=n.length;if(s===0)return"";let i=0;for(;i<s&&n.charAt(s-i-1)===e;)i++;return n.slice(0,s-i)}function PJ(n,e){if(n.indexOf(e[1])===-1)return-1;let t=0;for(let s=0;s<n.length;s++)if(n[s]==="\\")s++;else if(n[s]===e[0])t++;else if(n[s]===e[1]&&(t--,t<0))return s;return-1}function qj(n,e,t,s){const i=e.href,r=e.title?Er(e.title):null,o=n[1].replace(/\\([\[\]])/g,"$1");if(n[0].charAt(0)!=="!"){s.state.inLink=!0;const a={type:"link",raw:t,href:i,title:r,text:o,tokens:s.inlineTokens(o)};return s.state.inLink=!1,a}return{type:"image",raw:t,href:i,title:r,text:Er(o)}}function LJ(n,e){const t=n.match(/^(\s+)(?:```)/);if(t===null)return e;const s=t[1];return e.split(`
`).map(i=>{const r=i.match(/^\s+/);if(r===null)return i;const[o]=r;return o.length>=s.length?i.slice(s.length):i}).join(`
`)}class Jw{constructor(e){We(this,"options");We(this,"rules");We(this,"lexer");this.options=e||nf}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const s=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?s:$g(s,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const s=t[0],i=LJ(s,t[3]||"");return{type:"code",raw:s,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:i}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let s=t[2].trim();if(/#$/.test(s)){const i=$g(s,"#");(this.options.pedantic||!i||/ $/.test(i))&&(s=i.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:s,tokens:this.lexer.inline(s)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:$g(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let s=$g(t[0],`
`).split(`
`),i="",r="";const o=[];for(;s.length>0;){let a=!1;const l=[];let u;for(u=0;u<s.length;u++)if(/^ {0,3}>/.test(s[u]))l.push(s[u]),a=!0;else if(!a)l.push(s[u]);else break;s=s.slice(u);const f=l.join(`
`),p=f.replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,`
    $1`).replace(/^ {0,3}>[ \t]?/gm,"");i=i?`${i}
${f}`:f,r=r?`${r}
${p}`:p;const g=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(p,o,!0),this.lexer.state.top=g,s.length===0)break;const b=o[o.length-1];if((b==null?void 0:b.type)==="code")break;if((b==null?void 0:b.type)==="blockquote"){const w=b,S=w.raw+`
`+s.join(`
`),N=this.blockquote(S);o[o.length-1]=N,i=i.substring(0,i.length-w.raw.length)+N.raw,r=r.substring(0,r.length-w.text.length)+N.text;break}else if((b==null?void 0:b.type)==="list"){const w=b,S=w.raw+`
`+s.join(`
`),N=this.list(S);o[o.length-1]=N,i=i.substring(0,i.length-b.raw.length)+N.raw,r=r.substring(0,r.length-w.raw.length)+N.raw,s=S.substring(o[o.length-1].raw.length).split(`
`);continue}}return{type:"blockquote",raw:i,tokens:o,text:r}}}list(e){let t=this.rules.block.list.exec(e);if(t){let s=t[1].trim();const i=s.length>1,r={type:"list",raw:"",ordered:i,start:i?+s.slice(0,-1):"",loose:!1,items:[]};s=i?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=i?s:"[*+-]");const o=new RegExp(`^( {0,3}${s})((?:[	 ][^\\n]*)?(?:\\n|$))`);let a=!1;for(;e;){let l=!1,u="",f="";if(!(t=o.exec(e))||this.rules.block.hr.test(e))break;u=t[0],e=e.substring(u.length);let p=t[2].split(`
`,1)[0].replace(/^\t+/,C=>" ".repeat(3*C.length)),g=e.split(`
`,1)[0],b=!p.trim(),w=0;if(this.options.pedantic?(w=2,f=p.trimStart()):b?w=t[1].length+1:(w=t[2].search(/[^ ]/),w=w>4?1:w,f=p.slice(w),w+=t[1].length),b&&/^ *$/.test(g)&&(u+=g+`
`,e=e.substring(g.length+1),l=!0),!l){const C=new RegExp(`^ {0,${Math.min(3,w-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),M=new RegExp(`^ {0,${Math.min(3,w-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),R=new RegExp(`^ {0,${Math.min(3,w-1)}}(?:\`\`\`|~~~)`),_=new RegExp(`^ {0,${Math.min(3,w-1)}}#`);for(;e;){const j=e.split(`
`,1)[0];if(g=j,this.options.pedantic&&(g=g.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),R.test(g)||_.test(g)||C.test(g)||M.test(e))break;if(g.search(/[^ ]/)>=w||!g.trim())f+=`
`+g.slice(w);else{if(b||p.search(/[^ ]/)>=4||R.test(p)||_.test(p)||M.test(p))break;f+=`
`+g}!b&&!g.trim()&&(b=!0),u+=j+`
`,e=e.substring(j.length+1),p=g.slice(w)}}r.loose||(a?r.loose=!0:/\n *\n *$/.test(u)&&(a=!0));let S=null,N;this.options.gfm&&(S=/^\[[ xX]\] /.exec(f),S&&(N=S[0]!=="[ ] ",f=f.replace(/^\[[ xX]\] +/,""))),r.items.push({type:"list_item",raw:u,task:!!S,checked:N,loose:!1,text:f,tokens:[]}),r.raw+=u}r.items[r.items.length-1].raw=r.items[r.items.length-1].raw.trimEnd(),r.items[r.items.length-1].text=r.items[r.items.length-1].text.trimEnd(),r.raw=r.raw.trimEnd();for(let l=0;l<r.items.length;l++)if(this.lexer.state.top=!1,r.items[l].tokens=this.lexer.blockTokens(r.items[l].text,[]),!r.loose){const u=r.items[l].tokens.filter(p=>p.type==="space"),f=u.length>0&&u.some(p=>/\n.*\n/.test(p.raw));r.loose=f}if(r.loose)for(let l=0;l<r.items.length;l++)r.items[l].loose=!0;return r}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const s=t[1].toLowerCase().replace(/\s+/g," "),i=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",r=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:s,raw:t[0],href:i,title:r}}}table(e){const t=this.rules.block.table.exec(e);if(!t||!/[:|]/.test(t[2]))return;const s=Vj(t[1]),i=t[2].replace(/^\||\| *$/g,"").split("|"),r=t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[],o={type:"table",raw:t[0],header:[],align:[],rows:[]};if(s.length===i.length){for(const a of i)/^ *-+: *$/.test(a)?o.align.push("right"):/^ *:-+: *$/.test(a)?o.align.push("center"):/^ *:-+ *$/.test(a)?o.align.push("left"):o.align.push(null);for(let a=0;a<s.length;a++)o.header.push({text:s[a],tokens:this.lexer.inline(s[a]),header:!0,align:o.align[a]});for(const a of r)o.rows.push(Vj(a,o.header.length).map((l,u)=>({text:l,tokens:this.lexer.inline(l),header:!1,align:o.align[u]})));return o}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const s=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:s,tokens:this.lexer.inline(s)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:Er(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const s=t[2].trim();if(!this.options.pedantic&&/^</.test(s)){if(!/>$/.test(s))return;const o=$g(s.slice(0,-1),"\\");if((s.length-o.length)%2===0)return}else{const o=PJ(t[2],"()");if(o>-1){const l=(t[0].indexOf("!")===0?5:4)+t[1].length+o;t[2]=t[2].substring(0,o),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let i=t[2],r="";if(this.options.pedantic){const o=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(i);o&&(i=o[1],r=o[3])}else r=t[3]?t[3].slice(1,-1):"";return i=i.trim(),/^</.test(i)&&(this.options.pedantic&&!/>$/.test(s)?i=i.slice(1):i=i.slice(1,-1)),qj(t,{href:i&&i.replace(this.rules.inline.anyPunctuation,"$1"),title:r&&r.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer)}}reflink(e,t){let s;if((s=this.rules.inline.reflink.exec(e))||(s=this.rules.inline.nolink.exec(e))){const i=(s[2]||s[1]).replace(/\s+/g," "),r=t[i.toLowerCase()];if(!r){const o=s[0].charAt(0);return{type:"text",raw:o,text:o}}return qj(s,r,s[0],this.lexer)}}emStrong(e,t,s=""){let i=this.rules.inline.emStrongLDelim.exec(e);if(!i||i[3]&&s.match(/[\p{L}\p{N}]/u))return;if(!(i[1]||i[2]||"")||!s||this.rules.inline.punctuation.exec(s)){const o=[...i[0]].length-1;let a,l,u=o,f=0;const p=i[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(p.lastIndex=0,t=t.slice(-1*e.length+o);(i=p.exec(t))!=null;){if(a=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!a)continue;if(l=[...a].length,i[3]||i[4]){u+=l;continue}else if((i[5]||i[6])&&o%3&&!((o+l)%3)){f+=l;continue}if(u-=l,u>0)continue;l=Math.min(l,l+u+f);const g=[...i[0]][0].length,b=e.slice(0,o+i.index+g+l);if(Math.min(o,l)%2){const S=b.slice(1,-1);return{type:"em",raw:b,text:S,tokens:this.lexer.inlineTokens(S)}}const w=b.slice(2,-2);return{type:"strong",raw:b,text:w,tokens:this.lexer.inlineTokens(w)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let s=t[2].replace(/\n/g," ");const i=/[^ ]/.test(s),r=/^ /.test(s)&&/ $/.test(s);return i&&r&&(s=s.substring(1,s.length-1)),s=Er(s,!0),{type:"codespan",raw:t[0],text:s}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let s,i;return t[2]==="@"?(s=Er(t[1]),i="mailto:"+s):(s=Er(t[1]),i=s),{type:"link",raw:t[0],text:s,href:i,tokens:[{type:"text",raw:s,text:s}]}}}url(e){var s;let t;if(t=this.rules.inline.url.exec(e)){let i,r;if(t[2]==="@")i=Er(t[0]),r="mailto:"+i;else{let o;do o=t[0],t[0]=((s=this.rules.inline._backpedal.exec(t[0]))==null?void 0:s[0])??"";while(o!==t[0]);i=Er(t[0]),t[1]==="www."?r="http://"+t[0]:r=t[0]}return{type:"link",raw:t[0],text:i,href:r,tokens:[{type:"text",raw:i,text:i}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){let s;return this.lexer.state.inRawBlock?s=t[0]:s=Er(t[0]),{type:"text",raw:t[0],text:s}}}}const OJ=/^(?: *(?:\n|$))+/,BJ=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,FJ=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Bb=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,HJ=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,i4=/(?:[*+-]|\d{1,9}[.)])/,r4=pn(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,i4).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),C_=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,UJ=/^[^\n]+/,A_=/(?!\s*\])(?:\\.|[^\[\]\\])+/,$J=pn(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",A_).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),GJ=pn(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,i4).getRegex(),MS="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",N_=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,VJ=pn("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",N_).replace("tag",MS).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),o4=pn(C_).replace("hr",Bb).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",MS).getRegex(),qJ=pn(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",o4).getRegex(),E_={blockquote:qJ,code:BJ,def:$J,fences:FJ,heading:HJ,hr:Bb,html:VJ,lheading:r4,list:GJ,newline:OJ,paragraph:o4,table:w0,text:UJ},Wj=pn("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Bb).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",MS).getRegex(),WJ={...E_,table:Wj,paragraph:pn(C_).replace("hr",Bb).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Wj).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",MS).getRegex()},KJ={...E_,html:pn(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",N_).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:w0,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:pn(C_).replace("hr",Bb).replace("heading",` *#{1,6} *[^
]`).replace("lheading",r4).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},a4=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,YJ=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,l4=/^( {2,}|\\)\n(?!\s*$)/,JJ=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Fb="\\p{P}\\p{S}",XJ=pn(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,Fb).getRegex(),QJ=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,ZJ=pn(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,Fb).getRegex(),eX=pn("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,Fb).getRegex(),tX=pn("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,Fb).getRegex(),nX=pn(/\\([punct])/,"gu").replace(/punct/g,Fb).getRegex(),sX=pn(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),iX=pn(N_).replace("(?:-->|$)","-->").getRegex(),rX=pn("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",iX).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Xw=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,oX=pn(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",Xw).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),c4=pn(/^!?\[(label)\]\[(ref)\]/).replace("label",Xw).replace("ref",A_).getRegex(),d4=pn(/^!?\[(ref)\](?:\[\])?/).replace("ref",A_).getRegex(),aX=pn("reflink|nolink(?!\\()","g").replace("reflink",c4).replace("nolink",d4).getRegex(),T_={_backpedal:w0,anyPunctuation:nX,autolink:sX,blockSkip:QJ,br:l4,code:YJ,del:w0,emStrongLDelim:ZJ,emStrongRDelimAst:eX,emStrongRDelimUnd:tX,escape:a4,link:oX,nolink:d4,punctuation:XJ,reflink:c4,reflinkSearch:aX,tag:rX,text:JJ,url:w0},lX={...T_,link:pn(/^!?\[(label)\]\((.*?)\)/).replace("label",Xw).getRegex(),reflink:pn(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Xw).getRegex()},qN={...T_,escape:pn(a4).replace("])","~|])").getRegex(),url:pn(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},cX={...qN,br:pn(l4).replace("{2,}","*").getRegex(),text:pn(qN.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},kv={normal:E_,gfm:WJ,pedantic:KJ},Gg={normal:T_,gfm:qN,breaks:cX,pedantic:lX};class _a{constructor(e){We(this,"tokens");We(this,"options");We(this,"state");We(this,"tokenizer");We(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||nf,this.options.tokenizer=this.options.tokenizer||new Jw,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:kv.normal,inline:Gg.normal};this.options.pedantic?(t.block=kv.pedantic,t.inline=Gg.pedantic):this.options.gfm&&(t.block=kv.gfm,this.options.breaks?t.inline=Gg.breaks:t.inline=Gg.gfm),this.tokenizer.rules=t}static get rules(){return{block:kv,inline:Gg}}static lex(e,t){return new _a(t).lex(e)}static lexInline(e,t){return new _a(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const s=this.inlineQueue[t];this.inlineTokens(s.src,s.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],s=!1){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(a,l,u)=>l+"    ".repeat(u.length));let i,r,o;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>(i=a.call({lexer:this},e,t))?(e=e.substring(i.raw.length),t.push(i),!0):!1))){if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length),i.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length),r=t[t.length-1],r&&(r.type==="paragraph"||r.type==="text")?(r.raw+=`
`+i.raw,r.text+=`
`+i.text,this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length),r=t[t.length-1],r&&(r.type==="paragraph"||r.type==="text")?(r.raw+=`
`+i.raw,r.text+=`
`+i.raw,this.inlineQueue[this.inlineQueue.length-1].src=r.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title});continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),t.push(i);continue}if(o=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0;const l=e.slice(1);let u;this.options.extensions.startBlock.forEach(f=>{u=f.call({lexer:this},l),typeof u=="number"&&u>=0&&(a=Math.min(a,u))}),a<1/0&&a>=0&&(o=e.substring(0,a+1))}if(this.state.top&&(i=this.tokenizer.paragraph(o))){r=t[t.length-1],s&&(r==null?void 0:r.type)==="paragraph"?(r.raw+=`
`+i.raw,r.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(i),s=o.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length),r=t[t.length-1],r&&r.type==="text"?(r.raw+=`
`+i.raw,r.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(i);continue}if(e){const a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let s,i,r,o=e,a,l,u;if(this.tokens.links){const f=Object.keys(this.tokens.links);if(f.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(o))!=null;)f.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(o))!=null;)o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(o))!=null;)o=o.slice(0,a.index)+"++"+o.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(l||(u=""),l=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(f=>(s=f.call({lexer:this},e,t))?(e=e.substring(s.raw.length),t.push(s),!0):!1))){if(s=this.tokenizer.escape(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.tag(e)){e=e.substring(s.raw.length),i=t[t.length-1],i&&s.type==="text"&&i.type==="text"?(i.raw+=s.raw,i.text+=s.text):t.push(s);continue}if(s=this.tokenizer.link(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(s.raw.length),i=t[t.length-1],i&&s.type==="text"&&i.type==="text"?(i.raw+=s.raw,i.text+=s.text):t.push(s);continue}if(s=this.tokenizer.emStrong(e,o,u)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.codespan(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.br(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.del(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.autolink(e)){e=e.substring(s.raw.length),t.push(s);continue}if(!this.state.inLink&&(s=this.tokenizer.url(e))){e=e.substring(s.raw.length),t.push(s);continue}if(r=e,this.options.extensions&&this.options.extensions.startInline){let f=1/0;const p=e.slice(1);let g;this.options.extensions.startInline.forEach(b=>{g=b.call({lexer:this},p),typeof g=="number"&&g>=0&&(f=Math.min(f,g))}),f<1/0&&f>=0&&(r=e.substring(0,f+1))}if(s=this.tokenizer.inlineText(r)){e=e.substring(s.raw.length),s.raw.slice(-1)!=="_"&&(u=s.raw.slice(-1)),l=!0,i=t[t.length-1],i&&i.type==="text"?(i.raw+=s.raw,i.text+=s.text):t.push(s);continue}if(e){const f="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return t}}class Qw{constructor(e){We(this,"options");We(this,"parser");this.options=e||nf}space(e){return""}code({text:e,lang:t,escaped:s}){var o;const i=(o=(t||"").match(/^\S*/))==null?void 0:o[0],r=e.replace(/\n$/,"")+`
`;return i?'<pre><code class="language-'+Er(i)+'">'+(s?r:Er(r,!0))+`</code></pre>
`:"<pre><code>"+(s?r:Er(r,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,s=e.start;let i="";for(let a=0;a<e.items.length;a++){const l=e.items[a];i+=this.listitem(l)}const r=t?"ol":"ul",o=t&&s!==1?' start="'+s+'"':"";return"<"+r+o+`>
`+i+"</"+r+`>
`}listitem(e){let t="";if(e.task){const s=this.checkbox({checked:!!e.checked});e.loose?e.tokens.length>0&&e.tokens[0].type==="paragraph"?(e.tokens[0].text=s+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=s+" "+e.tokens[0].tokens[0].text)):e.tokens.unshift({type:"text",raw:s+" ",text:s+" "}):t+=s+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",s="";for(let r=0;r<e.header.length;r++)s+=this.tablecell(e.header[r]);t+=this.tablerow({text:s});let i="";for(let r=0;r<e.rows.length;r++){const o=e.rows[r];s="";for(let a=0;a<o.length;a++)s+=this.tablecell(o[a]);i+=this.tablerow({text:s})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+i+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),s=e.header?"th":"td";return(e.align?`<${s} align="${e.align}">`:`<${s}>`)+t+`</${s}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${e}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:s}){const i=this.parser.parseInline(s),r=Gj(e);if(r===null)return i;e=r;let o='<a href="'+e+'"';return t&&(o+=' title="'+t+'"'),o+=">"+i+"</a>",o}image({href:e,title:t,text:s}){const i=Gj(e);if(i===null)return s;e=i;let r=`<img src="${e}" alt="${s}"`;return t&&(r+=` title="${t}"`),r+=">",r}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):e.text}}class __{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class Ma{constructor(e){We(this,"options");We(this,"renderer");We(this,"textRenderer");this.options=e||nf,this.options.renderer=this.options.renderer||new Qw,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new __}static parse(e,t){return new Ma(t).parse(e)}static parseInline(e,t){return new Ma(t).parseInline(e)}parse(e,t=!0){let s="";for(let i=0;i<e.length;i++){const r=e[i];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[r.type]){const a=r,l=this.options.extensions.renderers[a.type].call({parser:this},a);if(l!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(a.type)){s+=l||"";continue}}const o=r;switch(o.type){case"space":{s+=this.renderer.space(o);continue}case"hr":{s+=this.renderer.hr(o);continue}case"heading":{s+=this.renderer.heading(o);continue}case"code":{s+=this.renderer.code(o);continue}case"table":{s+=this.renderer.table(o);continue}case"blockquote":{s+=this.renderer.blockquote(o);continue}case"list":{s+=this.renderer.list(o);continue}case"html":{s+=this.renderer.html(o);continue}case"paragraph":{s+=this.renderer.paragraph(o);continue}case"text":{let a=o,l=this.renderer.text(a);for(;i+1<e.length&&e[i+1].type==="text";)a=e[++i],l+=`
`+this.renderer.text(a);t?s+=this.renderer.paragraph({type:"paragraph",raw:l,text:l,tokens:[{type:"text",raw:l,text:l}]}):s+=l;continue}default:{const a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return s}parseInline(e,t){t=t||this.renderer;let s="";for(let i=0;i<e.length;i++){const r=e[i];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[r.type]){const a=this.options.extensions.renderers[r.type].call({parser:this},r);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(r.type)){s+=a||"";continue}}const o=r;switch(o.type){case"escape":{s+=t.text(o);break}case"html":{s+=t.html(o);break}case"link":{s+=t.link(o);break}case"image":{s+=t.image(o);break}case"strong":{s+=t.strong(o);break}case"em":{s+=t.em(o);break}case"codespan":{s+=t.codespan(o);break}case"br":{s+=t.br(o);break}case"del":{s+=t.del(o);break}case"text":{s+=t.text(o);break}default:{const a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return s}}class k0{constructor(e){We(this,"options");this.options=e||nf}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}}We(k0,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));var Ql,u4,WN,h4;class dX{constructor(...e){L(this,Ql);We(this,"defaults",S_());We(this,"options",this.setOptions);We(this,"parse",O(this,Ql,WN).call(this,_a.lex,Ma.parse));We(this,"parseInline",O(this,Ql,WN).call(this,_a.lexInline,Ma.parseInline));We(this,"Parser",Ma);We(this,"Renderer",Qw);We(this,"TextRenderer",__);We(this,"Lexer",_a);We(this,"Tokenizer",Jw);We(this,"Hooks",k0);this.use(...e)}walkTokens(e,t){var i,r;let s=[];for(const o of e)switch(s=s.concat(t.call(this,o)),o.type){case"table":{const a=o;for(const l of a.header)s=s.concat(this.walkTokens(l.tokens,t));for(const l of a.rows)for(const u of l)s=s.concat(this.walkTokens(u.tokens,t));break}case"list":{const a=o;s=s.concat(this.walkTokens(a.items,t));break}default:{const a=o;(r=(i=this.defaults.extensions)==null?void 0:i.childTokens)!=null&&r[a.type]?this.defaults.extensions.childTokens[a.type].forEach(l=>{const u=a[l].flat(1/0);s=s.concat(this.walkTokens(u,t))}):a.tokens&&(s=s.concat(this.walkTokens(a.tokens,t)))}}return s}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(s=>{const i={...s};if(i.async=this.defaults.async||i.async||!1,s.extensions&&(s.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if("renderer"in r){const o=t.renderers[r.name];o?t.renderers[r.name]=function(...a){let l=r.renderer.apply(this,a);return l===!1&&(l=o.apply(this,a)),l}:t.renderers[r.name]=r.renderer}if("tokenizer"in r){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const o=t[r.level];o?o.unshift(r.tokenizer):t[r.level]=[r.tokenizer],r.start&&(r.level==="block"?t.startBlock?t.startBlock.push(r.start):t.startBlock=[r.start]:r.level==="inline"&&(t.startInline?t.startInline.push(r.start):t.startInline=[r.start]))}"childTokens"in r&&r.childTokens&&(t.childTokens[r.name]=r.childTokens)}),i.extensions=t),s.renderer){const r=this.defaults.renderer||new Qw(this.defaults);for(const o in s.renderer){if(!(o in r))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;const a=o;let l=s.renderer[a];s.useNewRenderer||(l=O(this,Ql,u4).call(this,l,a,r));const u=r[a];r[a]=(...f)=>{let p=l.apply(r,f);return p===!1&&(p=u.apply(r,f)),p||""}}i.renderer=r}if(s.tokenizer){const r=this.defaults.tokenizer||new Jw(this.defaults);for(const o in s.tokenizer){if(!(o in r))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;const a=o,l=s.tokenizer[a],u=r[a];r[a]=(...f)=>{let p=l.apply(r,f);return p===!1&&(p=u.apply(r,f)),p}}i.tokenizer=r}if(s.hooks){const r=this.defaults.hooks||new k0;for(const o in s.hooks){if(!(o in r))throw new Error(`hook '${o}' does not exist`);if(o==="options")continue;const a=o,l=s.hooks[a],u=r[a];k0.passThroughHooks.has(o)?r[a]=f=>{if(this.defaults.async)return Promise.resolve(l.call(r,f)).then(g=>u.call(r,g));const p=l.call(r,f);return u.call(r,p)}:r[a]=(...f)=>{let p=l.apply(r,f);return p===!1&&(p=u.apply(r,f)),p}}i.hooks=r}if(s.walkTokens){const r=this.defaults.walkTokens,o=s.walkTokens;i.walkTokens=function(a){let l=[];return l.push(o.call(this,a)),r&&(l=l.concat(r.call(this,a))),l}}this.defaults={...this.defaults,...i}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return _a.lex(e,t??this.defaults)}parser(e,t){return Ma.parse(e,t??this.defaults)}}Ql=new WeakSet,u4=function(e,t,s){switch(t){case"heading":return function(i){return!i.type||i.type!==t?e.apply(this,arguments):e.call(this,s.parser.parseInline(i.tokens),i.depth,DJ(s.parser.parseInline(i.tokens,s.parser.textRenderer)))};case"code":return function(i){return!i.type||i.type!==t?e.apply(this,arguments):e.call(this,i.text,i.lang,!!i.escaped)};case"table":return function(i){if(!i.type||i.type!==t)return e.apply(this,arguments);let r="",o="";for(let l=0;l<i.header.length;l++)o+=this.tablecell({text:i.header[l].text,tokens:i.header[l].tokens,header:!0,align:i.align[l]});r+=this.tablerow({text:o});let a="";for(let l=0;l<i.rows.length;l++){const u=i.rows[l];o="";for(let f=0;f<u.length;f++)o+=this.tablecell({text:u[f].text,tokens:u[f].tokens,header:!1,align:i.align[f]});a+=this.tablerow({text:o})}return e.call(this,r,a)};case"blockquote":return function(i){if(!i.type||i.type!==t)return e.apply(this,arguments);const r=this.parser.parse(i.tokens);return e.call(this,r)};case"list":return function(i){if(!i.type||i.type!==t)return e.apply(this,arguments);const r=i.ordered,o=i.start,a=i.loose;let l="";for(let u=0;u<i.items.length;u++){const f=i.items[u],p=f.checked,g=f.task;let b="";if(f.task){const w=this.checkbox({checked:!!p});a?f.tokens.length>0&&f.tokens[0].type==="paragraph"?(f.tokens[0].text=w+" "+f.tokens[0].text,f.tokens[0].tokens&&f.tokens[0].tokens.length>0&&f.tokens[0].tokens[0].type==="text"&&(f.tokens[0].tokens[0].text=w+" "+f.tokens[0].tokens[0].text)):f.tokens.unshift({type:"text",text:w+" "}):b+=w+" "}b+=this.parser.parse(f.tokens,a),l+=this.listitem({type:"list_item",raw:b,text:b,task:g,checked:!!p,loose:a,tokens:f.tokens})}return e.call(this,l,r,o)};case"html":return function(i){return!i.type||i.type!==t?e.apply(this,arguments):e.call(this,i.text,i.block)};case"paragraph":return function(i){return!i.type||i.type!==t?e.apply(this,arguments):e.call(this,this.parser.parseInline(i.tokens))};case"escape":return function(i){return!i.type||i.type!==t?e.apply(this,arguments):e.call(this,i.text)};case"link":return function(i){return!i.type||i.type!==t?e.apply(this,arguments):e.call(this,i.href,i.title,this.parser.parseInline(i.tokens))};case"image":return function(i){return!i.type||i.type!==t?e.apply(this,arguments):e.call(this,i.href,i.title,i.text)};case"strong":return function(i){return!i.type||i.type!==t?e.apply(this,arguments):e.call(this,this.parser.parseInline(i.tokens))};case"em":return function(i){return!i.type||i.type!==t?e.apply(this,arguments):e.call(this,this.parser.parseInline(i.tokens))};case"codespan":return function(i){return!i.type||i.type!==t?e.apply(this,arguments):e.call(this,i.text)};case"del":return function(i){return!i.type||i.type!==t?e.apply(this,arguments):e.call(this,this.parser.parseInline(i.tokens))};case"text":return function(i){return!i.type||i.type!==t?e.apply(this,arguments):e.call(this,i.text)}}return e},WN=function(e,t){return(s,i)=>{const r={...i},o={...this.defaults,...r};this.defaults.async===!0&&r.async===!1&&(o.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),o.async=!0);const a=O(this,Ql,h4).call(this,!!o.silent,!!o.async);if(typeof s>"u"||s===null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof s!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(s)+", string expected"));if(o.hooks&&(o.hooks.options=o),o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(s):s).then(l=>e(l,o)).then(l=>o.hooks?o.hooks.processAllTokens(l):l).then(l=>o.walkTokens?Promise.all(this.walkTokens(l,o.walkTokens)).then(()=>l):l).then(l=>t(l,o)).then(l=>o.hooks?o.hooks.postprocess(l):l).catch(a);try{o.hooks&&(s=o.hooks.preprocess(s));let l=e(s,o);o.hooks&&(l=o.hooks.processAllTokens(l)),o.walkTokens&&this.walkTokens(l,o.walkTokens);let u=t(l,o);return o.hooks&&(u=o.hooks.postprocess(u)),u}catch(l){return a(l)}}},h4=function(e,t){return s=>{if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const i="<p>An error occurred:</p><pre>"+Er(s.message+"",!0)+"</pre>";return t?Promise.resolve(i):i}if(t)return Promise.reject(s);throw s}};const Uh=new dX;function Bt(n,e){return Uh.parse(n,e)}Bt.options=Bt.setOptions=function(n){return Uh.setOptions(n),Bt.defaults=Uh.defaults,t4(Bt.defaults),Bt};Bt.getDefaults=S_;Bt.defaults=nf;Bt.use=function(...n){return Uh.use(...n),Bt.defaults=Uh.defaults,t4(Bt.defaults),Bt};Bt.walkTokens=function(n,e){return Uh.walkTokens(n,e)};Bt.parseInline=Uh.parseInline;Bt.Parser=Ma;Bt.parser=Ma.parse;Bt.Renderer=Qw;Bt.TextRenderer=__;Bt.Lexer=_a;Bt.lexer=_a.lex;Bt.Tokenizer=Jw;Bt.Hooks=k0;Bt.parse=Bt;Bt.options;Bt.setOptions;Bt.use;Bt.walkTokens;Bt.parseInline;Ma.parse;_a.lex;const f4=({parentBook:n,relationType:e,onClose:t})=>{const{createRelatedBook:s}=T.useContext(rs),i=Es(),[r,o]=T.useState("ideas"),[a,l]=T.useState([]),[u,f]=T.useState(""),[p,g]=T.useState(!1),[b,w]=T.useState(!1),[S,N]=T.useState(""),[C,M]=T.useState([]),[R,_]=T.useState([]),[j,P]=T.useState(""),D=T.useRef(null),U=T.useRef(null),[V,q]=T.useState(""),[G,ee]=T.useState(""),[W,Q]=T.useState(n.generateImages),[Z,$]=T.useState(n.imageGenerationInstructions),Y=T.useCallback(async()=>{g(!0),N("Generating ideas...");try{const re=await xY(n,e);l(re),re.length>0&&f(re[0])}catch(re){te.error(`Failed to generate ideas: ${re.message}`)}finally{g(!1)}},[n,e]);T.useEffect(()=>{Y()},[Y]),T.useEffect(()=>{var re;(re=D.current)==null||re.scrollIntoView({behavior:"smooth"})},[R]);const he=()=>{o("chat");const re={role:"model",parts:[{text:`Hi! I'm here to help you plan a ${e} to "${n.topic}". What kind of story are you imagining?`}]};_([re]),M([]),setTimeout(()=>{var Ge;return(Ge=U.current)==null?void 0:Ge.focus()},100)},Re=async re=>{if(re==null||re.preventDefault(),!j.trim()||p)return;const Ge=j.trim();P(""),U.current&&(U.current.style.height="46px"),g(!0);const Je={role:"user",parts:[{text:Ge}]};_(ye=>[...ye,Je]);const Qe={role:"model",parts:[{text:""}]};_(ye=>[...ye,Qe]);const je=`
Parent Book Title: "${n.topic}"
Parent Book Description: "${n.description||"N/A"}"
Relation: The user wants to create a ${e}.
Parent Book Outline Summary: ${n.outline.map(ye=>ye.title).join(", ")}.
`;try{const ye=await E3(Ge,C,Fe=>{_(Ne=>{const ve=[...Ne],Pe=ve[ve.length-1];if(Pe.role==="model"){const ot=Pe.parts[0].text||"";Pe.parts=[{text:ot+Fe}]}return ve})},je);M(ye)}catch{te.error("Failed to get response from AI."),_(Fe=>Fe.slice(0,-1))}finally{g(!1)}},ze=re=>{re.key==="Enter"&&!re.shiftKey&&(re.preventDefault(),Re())},F=re=>{P(re.target.value),re.target.style.height="auto",re.target.style.height=`${Math.min(re.target.scrollHeight,150)}px`},J=async()=>{g(!0),N("Extracting book details...");try{const re=await KK(C);f(re.topic||`New ${e} to ${n.topic}`),q(re.description||""),ee(re.instructions||n.instructions),Q(re.generateImages??n.generateImages),$(re.imageStyle||n.imageGenerationInstructions),o("review")}catch{te.error("Failed to extract details. Please review manually."),o("review")}finally{g(!1)}},ie=async()=>{if(!u.trim()){te.error("Please enter a topic/title for the new book.");return}w(!0);try{const re=await s(n,u,e,{description:V,instructions:G,generateImages:W,imageGenerationInstructions:Z});i(`/editor/${re}`),t()}catch(re){te.error(`Failed to create ${e}: ${re.message}`)}finally{w(!1)}};if(!n)return null;const pe=()=>d.jsx(d.Fragment,{children:d.jsxs("div",{className:"p-6 space-y-6",children:[d.jsxs("div",{onClick:he,className:"group bg-indigo-50 dark:bg-indigo-900/20 border-2 border-indigo-200 dark:border-indigo-800 hover:border-indigo-500 dark:hover:border-indigo-400 rounded-xl p-5 cursor-pointer transition-all flex items-center space-x-4",children:[d.jsx("div",{className:"p-3 bg-indigo-100 dark:bg-indigo-900/50 rounded-full text-indigo-600 dark:text-indigo-400 group-hover:scale-110 transition-transform",children:d.jsx(H,{name:"SPARKLES",className:"w-8 h-8"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-lg text-zinc-800 dark:text-zinc-100",children:"Brainstorm with AI"}),d.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400 mt-1",children:"Discuss plot points, continuity, and themes with a creative consultant before starting."})]}),d.jsx("div",{className:"flex-grow text-right",children:d.jsx(H,{name:"CHEVRON_RIGHT",className:"w-6 h-6 text-indigo-400"})})]}),d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute inset-0 flex items-center","aria-hidden":"true",children:d.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"})}),d.jsx("div",{className:"relative flex justify-center",children:d.jsx("span",{className:"px-2 bg-white dark:bg-zinc-800 text-sm text-gray-500",children:"OR CHOOSE A QUICK IDEA"})})]}),p?d.jsxs("div",{className:"text-center py-4",children:[d.jsx("div",{className:"w-8 h-8 mx-auto border-4 border-t-indigo-500 border-gray-200 rounded-full animate-spin"}),d.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Generating ideas..."})]}):d.jsxs("div",{className:"space-y-3",children:[a.map((re,Ge)=>d.jsx("button",{onClick:()=>{f(re),o("review")},className:"w-full text-left p-4 rounded-lg border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-700/50 hover:border-indigo-300 dark:hover:border-indigo-600 transition-all",children:d.jsx("span",{className:"font-medium text-zinc-800 dark:text-zinc-200",children:re})},Ge)),d.jsx("button",{onClick:()=>{f(""),o("review")},className:"w-full text-center text-sm text-indigo-600 dark:text-indigo-400 hover:underline p-2",children:"Skip to manual entry"})]})]})}),ue=()=>d.jsxs("div",{className:"flex flex-col h-full max-h-[60vh]",children:[d.jsxs("div",{className:"flex-grow overflow-y-auto p-4 space-y-4 bg-zinc-50 dark:bg-zinc-900/50 m-4 mb-0 rounded-xl border border-zinc-200 dark:border-zinc-700",children:[R.map((re,Ge)=>{const Je=re.role==="user",Qe=re.parts[0].text||"";return!Qe&&!p?null:d.jsx("div",{className:`flex ${Je?"justify-end":"justify-start"}`,children:d.jsx("div",{className:`max-w-[85%] rounded-2xl p-3 text-sm shadow-sm ${Je?"bg-indigo-600 text-white rounded-tr-none":"bg-white dark:bg-zinc-800 text-zinc-800 dark:text-zinc-200 rounded-tl-none border border-zinc-200 dark:border-zinc-700"}`,children:d.jsx("div",{className:`prose prose-sm max-w-none leading-relaxed break-words ${Je?"prose-user-bubble":"dark:prose-invert"}`,dangerouslySetInnerHTML:{__html:Bt.parse(Qe,{breaks:!0})}})})},Ge)}),d.jsx("div",{ref:D})]}),d.jsxs("div",{className:"p-4 flex items-end gap-2",children:[d.jsx("div",{className:"flex-grow relative",children:d.jsx("textarea",{ref:U,value:j,onChange:F,onKeyDown:ze,placeholder:"Type your response...",rows:1,className:"w-full bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm resize-none max-h-40",disabled:p,style:{minHeight:"46px"}})}),d.jsx("button",{onClick:Re,disabled:p||!j.trim(),className:"p-3 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 disabled:opacity-50 transition-colors mb-1",children:d.jsx(H,{name:p?"ROTATE_CW":"MESSAGE_CIRCLE",className:`w-5 h-5 ${p?"animate-spin":""}`})}),d.jsx("div",{className:"w-px h-8 bg-zinc-300 dark:bg-zinc-700 mx-2 mb-2"}),d.jsxs("button",{onClick:J,disabled:R.length<2||p,className:"whitespace-nowrap bg-emerald-600 text-white px-4 py-2.5 rounded-full text-sm font-semibold hover:bg-emerald-700 disabled:bg-zinc-300 dark:disabled:bg-zinc-700 disabled:cursor-not-allowed transition-colors flex items-center space-x-2 mb-1",children:[d.jsx("span",{children:"I'm Ready"}),d.jsx(H,{name:"CHEVRON_RIGHT",className:"w-4 h-4"})]})]})]}),ke=()=>d.jsxs("div",{className:"p-6 space-y-4 max-h-[60vh] overflow-y-auto",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Book Title"}),d.jsx("input",{type:"text",value:u,onChange:re=>f(re.target.value),className:"mt-1 block w-full bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 font-bold"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Description"}),d.jsx("textarea",{value:V,onChange:re=>q(re.target.value),rows:3,className:"mt-1 block w-full bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",placeholder:"What is this book about?"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Writing Style & Instructions"}),d.jsx("textarea",{value:G,onChange:re=>ee(re.target.value),rows:3,className:"mt-1 block w-full bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",placeholder:"Inherited from parent book if left blank..."})]}),d.jsxs("div",{className:"flex items-center pt-2",children:[d.jsx("input",{id:"gen-images",type:"checkbox",checked:W,onChange:re=>Q(re.target.checked),className:"h-4 w-4 text-indigo-600 border-zinc-300 rounded focus:ring-indigo-500"}),d.jsx("label",{htmlFor:"gen-images",className:"ml-2 block text-sm text-zinc-900 dark:text-zinc-200",children:"Generate Chapter Images"})]}),W&&d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Image Style"}),d.jsx("input",{type:"text",value:Z,onChange:re=>$(re.target.value),className:"mt-1 block w-full bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm"})]})]});return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:t,children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl w-full max-w-2xl flex flex-col border border-zinc-200 dark:border-zinc-700 max-h-[90vh]",onClick:re=>re.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-zinc-200 dark:border-zinc-700 bg-zinc-50/50 dark:bg-zinc-900/50",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100",children:r==="chat"?"Brainstorming...":r==="review"?"Review Details":`Create ${e} to "${n.topic}"`}),r==="ideas"&&d.jsx("p",{className:"text-xs text-zinc-500",children:"Choose a path to start your new book"})]}),d.jsx("button",{onClick:t,className:"p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700","aria-label":"Close",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("div",{className:"flex-grow overflow-hidden",children:[r==="ideas"&&pe(),r==="chat"&&ue(),r==="review"&&ke()]}),r==="review"&&d.jsxs("div",{className:"flex justify-end space-x-3 p-4 bg-zinc-50 dark:bg-zinc-800/50 border-t border-zinc-200 dark:border-zinc-700",children:[d.jsx("button",{onClick:()=>o("ideas"),className:"bg-zinc-200 dark:bg-zinc-600 text-zinc-800 dark:text-zinc-100 px-4 py-2 rounded-lg font-semibold hover:bg-zinc-300 dark:hover:bg-zinc-500 transition-colors",children:"Back"}),d.jsxs("button",{onClick:ie,disabled:p||b,className:"bg-indigo-600 text-white px-6 py-2 rounded-lg shadow font-semibold hover:bg-indigo-700 disabled:bg-indigo-400 transition-colors flex items-center space-x-2",children:[b?d.jsx(H,{name:"ROTATE_CW",className:"w-4 h-4 animate-spin"}):d.jsx(H,{name:"PLUS",className:"w-4 h-4"}),d.jsx("span",{children:b?"Creating...":`Create ${e}`})]})]})]})})},uX=n=>!n||!n.trim()?0:n.trim().split(/\s+/).filter(Boolean).length,Zw=({book:n,readingProgress:e=0,onDelete:t,onManageSnapshots:s,onGenerateCover:i,onCreateRelated:r,onAddToSeries:o,onRemoveFromSeries:a,isDraggable:l,onDragStart:u,onDragEnter:f,onDragOver:p,onDrop:g,onDragEnd:b,isDragging:w,isDragOver:S,onOpen:N})=>{const C=Es(),M=Oa(),{isAiEnabled:R,restoreBook:_,archiveBook:j}=T.useContext(rs),[P,D]=T.useState(!1),U=T.useRef(null);T.useEffect(()=>{const Y=he=>{U.current&&!U.current.contains(he.target)&&D(!1)};return document.addEventListener("mousedown",Y),()=>document.removeEventListener("mousedown",Y)},[]);const V=()=>{C(`/reader/${n.id}`,{state:{from:M.pathname}})},q=[],G=!!n.deletedAt,ee=n.status==="archived";G?q.push({label:"Restore Book",icon:"RESTORE",action:()=>_(n.id)}):(R&&q.push({label:"Generate Cover",icon:"IMAGE",action:i}),q.push({label:"Version History",icon:"HISTORY",action:s},{label:"Read Book",icon:"BOOK",action:V}),o&&q.push({label:"Add to Series...",icon:"LINK",action:o}),a&&q.push({label:"Remove from Series",icon:"CLOSE",action:a}),R&&q.push({label:"Create Sequel",icon:"PLUS",action:()=>r("sequel")},{label:"Create Prequel",icon:"PLUS",action:()=>r("prequel")}),ee?q.push({label:"Unarchive",icon:"RESTORE",action:()=>_(n.id)}):q.push({label:"Archive",icon:"ARCHIVE",action:()=>j(n.id)})),q.push({label:G?"Delete Forever":"Delete",icon:"TRASH",action:t,danger:!0});const W=T.useMemo(()=>n.content?n.content.reduce((Y,he)=>{if(!he||!he.htmlContent)return Y;const Re=document.createElement("div");return Re.innerHTML=he.htmlContent,Y+uX(Re.textContent||"")},0):0,[n.content]),Q=`
        relative group bg-white dark:bg-zinc-800 rounded-2xl shadow-sm border border-zinc-200 dark:border-zinc-700 flex flex-row overflow-hidden transition-all duration-300 hover:shadow-xl hover:border-indigo-300 dark:hover:border-indigo-700 hover:-translate-y-1 h-full min-h-[16rem]
        ${l?"cursor-grab active:cursor-grabbing":""}
        ${w?"opacity-40":""}
        ${G?"opacity-60 grayscale":""}
    `,Z=`
        absolute -inset-1 border-2 border-dashed border-indigo-500 rounded-2xl transition-opacity pointer-events-none z-50
        ${S?"opacity-100":"opacity-0"}
    `,$=()=>{G||(N?N():C(`/editor/${n.id}`,{state:{from:M.pathname}}))};return d.jsxs("div",{className:Q,draggable:l,onDragStart:u,onDragEnter:f,onDragOver:p,onDrop:g,onDragEnd:b,children:[d.jsx("div",{className:Z}),d.jsxs("div",{className:`w-28 sm:w-36 bg-zinc-200 dark:bg-zinc-700 flex-shrink-0 relative overflow-hidden group/cover ${G?"":"cursor-pointer"}`,onClick:$,children:[n.coverImage?d.jsx("img",{src:n.coverImage,alt:`${n.topic} cover`,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}):d.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-zinc-100 to-zinc-200 dark:from-zinc-700 dark:to-zinc-800 p-4 text-center",children:[d.jsx(H,{name:"IMAGE",className:"text-zinc-300 dark:text-zinc-600 w-12 h-12 mb-3"}),R&&!G&&d.jsxs("span",{className:"text-[10px] text-zinc-400 dark:text-zinc-500 font-medium uppercase tracking-widest leading-relaxed",children:["Generate",d.jsx("br",{}),"Cover"]})]}),!G&&d.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors pointer-events-none"}),e>0&&!G&&d.jsxs("div",{className:"absolute bottom-0 left-0 right-0",children:[d.jsx("div",{className:"h-2 bg-zinc-800/80 dark:bg-black/80 backdrop-blur-sm overflow-hidden",children:d.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-500 via-purple-500 to-indigo-500 animate-shimmer bg-[length:200%_100%]",style:{width:`${e}%`}})}),d.jsx("div",{className:"absolute bottom-3 right-1 opacity-0 group-hover/cover:opacity-100 transition-opacity duration-300",children:d.jsxs("span",{className:"px-1.5 py-0.5 rounded bg-zinc-900/90 text-[10px] font-bold text-white shadow-sm border border-white/10 backdrop-blur-md",children:[e,"%"]})})]})]}),d.jsxs("div",{className:"flex-1 flex flex-col p-4 sm:p-5 min-w-0 relative",children:[d.jsxs("div",{ref:U,className:"absolute top-2 right-2 z-10",children:[d.jsx("button",{onClick:Y=>{Y.stopPropagation(),D(!P)},className:"p-1.5 rounded-md text-zinc-400 hover:text-zinc-700 hover:bg-zinc-100 dark:text-zinc-500 dark:hover:text-zinc-200 dark:hover:bg-zinc-700 transition-colors",children:d.jsx(H,{name:"MORE_VERTICAL",className:"w-5 h-5"})}),P&&d.jsx("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-zinc-800 rounded-lg shadow-xl border border-zinc-200 dark:border-zinc-700 z-20 animate-fade-in-up overflow-hidden",children:q.map((Y,he)=>d.jsxs("button",{onClick:Re=>{Re.stopPropagation(),Y.action(),D(!1)},className:`w-full text-left flex items-center space-x-2 px-4 py-2.5 text-sm transition-colors
                                        ${Y.danger?"text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30":"text-zinc-700 dark:text-zinc-200 hover:bg-zinc-50 dark:hover:bg-zinc-700"}`,children:[d.jsx(H,{name:Y.icon,className:"w-4 h-4 opacity-70"}),d.jsx("span",{children:Y.label})]},he))})]}),d.jsxs("div",{onClick:$,className:`flex-1 min-w-0 pr-6 ${G?"cursor-default":"cursor-pointer"}`,children:[d.jsx("h3",{className:"font-bold text-xl sm:text-2xl text-zinc-900 dark:text-zinc-100 leading-tight group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors line-clamp-2",title:n.topic,children:n.topic||"Untitled Book"}),n.subtitle&&d.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300 mt-1 italic line-clamp-1",children:n.subtitle}),d.jsx("p",{className:"text-base font-medium text-zinc-500 dark:text-zinc-400 mt-2 truncate",children:n.author||"Unknown Author"})]}),d.jsx("div",{className:"flex-grow"}),d.jsx("div",{className:"mt-4 pt-4 border-t border-zinc-100 dark:border-zinc-700/50 flex items-center justify-between",children:d.jsx("div",{className:"flex flex-col space-y-1",children:d.jsxs("div",{className:"flex items-center space-x-4 text-sm text-zinc-500 dark:text-zinc-400",children:[d.jsxs("div",{className:"flex items-center",title:"Chapters Written / Planned",children:[d.jsx(H,{name:"BOOK",className:"w-3.5 h-3.5 mr-1.5 text-zinc-400"}),d.jsxs("span",{children:[n.content.length," / ",n.outline.length||"?"," ch"]})]}),d.jsxs("div",{className:"flex items-center",title:"Total Word Count",children:[d.jsx(H,{name:"EDIT",className:"w-3.5 h-3.5 mr-1.5 text-zinc-400"}),d.jsxs("span",{children:[W>1e3?`${(W/1e3).toFixed(1)}k`:W," words"]})]})]})})}),G?d.jsx("span",{className:"px-2.5 py-1 rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 font-bold text-[10px] uppercase tracking-wide",children:"Deleted"}):ee?d.jsx("span",{className:"px-2.5 py-1 rounded-full bg-zinc-100 text-zinc-700 dark:bg-zinc-700 dark:text-zinc-300 font-bold text-[10px] uppercase tracking-wide",children:"Archived"}):n.status==="complete"?d.jsx("span",{className:"px-2.5 py-1 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400 font-bold text-[10px] uppercase tracking-wide",children:"Complete"}):d.jsx("button",{onClick:$,className:"w-8 h-8 flex items-center justify-center rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-100 dark:bg-indigo-900/30 dark:text-indigo-300 dark:hover:bg-indigo-900/50 transition-colors",title:N?"Open Reader":"Open Editor",children:d.jsx(H,{name:N?"BOOK":"EDIT",className:"w-4 h-4"})})]})]})},hX=({isOpen:n,onClose:e})=>{const{createNewSeriesAndFirstBook:t}=T.useContext(rs),s=Es(),[i,r]=T.useState(""),[o,a]=T.useState(""),[l,u]=T.useState(!1);if(!n)return null;const f=async p=>{if(p.preventDefault(),!i.trim()||!o.trim()){te.error("Please fill out both fields.");return}u(!0);try{const g=await t(i,o);s(`/editor/${g}`),e()}catch(g){te.error(`Failed to create series: ${g.message}`)}finally{u(!1)}};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl w-full max-w-lg flex flex-col border border-zinc-200 dark:border-zinc-700",onClick:p=>p.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-zinc-200 dark:border-zinc-700",children:[d.jsx("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100",children:"Create a New Book Series"}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700","aria-label":"Close",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("form",{onSubmit:f,className:"p-6 space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"series-title",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Series Title"}),d.jsx("input",{id:"series-title",type:"text",value:i,onChange:p=>r(p.target.value),placeholder:"e.g., The Galactic Chronicles",className:"mt-1 block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"first-book-title",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"First Book's Title"}),d.jsx("input",{id:"first-book-title",type:"text",value:o,onChange:p=>a(p.target.value),placeholder:"e.g., Episode I: The Stellar Forge",className:"mt-1 block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),d.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[d.jsx("button",{type:"button",onClick:e,className:"bg-zinc-200 dark:bg-zinc-600 text-zinc-800 dark:text-zinc-100 px-4 py-2 rounded-lg font-semibold hover:bg-zinc-300 dark:hover:bg-zinc-500",children:"Cancel"}),d.jsx("button",{type:"submit",disabled:l,className:"bg-indigo-600 text-white px-6 py-2 rounded-lg shadow font-semibold hover:bg-indigo-700 disabled:bg-indigo-400",children:l?"Creating...":"Create Series"})]})]})]})})},fX=({book:n,onClose:e})=>{const{series:t,addBookToSeries:s}=T.useContext(rs),[i,r]=T.useState(!1),[o,a]=T.useState("existing"),[l,u]=T.useState(t.length>0?t[0].id:""),[f,p]=T.useState(""),g=async b=>{b.preventDefault(),r(!0),o==="existing"?await s(n.id,{seriesId:l}):await s(n.id,{newSeriesTitle:f}),r(!1),e()};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl w-full max-w-lg flex flex-col border border-zinc-200 dark:border-zinc-700",onClick:b=>b.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-zinc-200 dark:border-zinc-700",children:[d.jsxs("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100",children:['Add "',n.topic,'" to Series']}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700","aria-label":"Close",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("form",{onSubmit:g,className:"p-6",children:[d.jsx("div",{className:"mb-4",children:d.jsxs("div",{className:"flex border border-zinc-300 dark:border-zinc-600 rounded-lg p-1 bg-zinc-100 dark:bg-zinc-900",children:[d.jsx("button",{type:"button",onClick:()=>a("existing"),className:`flex-1 py-2 text-sm font-semibold rounded-md ${o==="existing"?"bg-white dark:bg-zinc-700 shadow":"text-zinc-600 dark:text-zinc-300"}`,children:"Existing Series"}),d.jsx("button",{type:"button",onClick:()=>a("new"),className:`flex-1 py-2 text-sm font-semibold rounded-md ${o==="new"?"bg-white dark:bg-zinc-700 shadow":"text-zinc-600 dark:text-zinc-300"}`,children:"New Series"})]})}),o==="existing"?d.jsxs("div",{children:[d.jsx("label",{htmlFor:"series-select",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Select a series"}),t.length>0?d.jsx("select",{id:"series-select",value:l,onChange:b=>u(b.target.value),className:"mt-1 block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500",children:t.map(b=>d.jsx("option",{value:b.id,children:b.title},b.id))}):d.jsx("p",{className:"text-sm text-zinc-500 mt-2",children:"No existing series found. Create a new one!"})]}):d.jsxs("div",{children:[d.jsx("label",{htmlFor:"new-series-title",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"New Series Title"}),d.jsx("input",{id:"new-series-title",type:"text",value:f,onChange:b=>p(b.target.value),placeholder:"e.g., The Galactic Chronicles",className:"mt-1 block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:!0})]}),d.jsxs("div",{className:"flex justify-end space-x-3 pt-6",children:[d.jsx("button",{type:"button",onClick:e,className:"bg-zinc-200 dark:bg-zinc-600 text-zinc-800 dark:text-zinc-100 px-4 py-2 rounded-lg font-semibold hover:bg-zinc-300 dark:hover:bg-zinc-500",children:"Cancel"}),d.jsx("button",{type:"submit",disabled:i||o==="existing"&&t.length===0,className:"bg-indigo-600 text-white px-6 py-2 rounded-lg shadow font-semibold hover:bg-indigo-700 disabled:bg-indigo-400",children:i?"Adding...":"Add to Series"})]})]})]})})},pX=({isOpen:n,onClose:e})=>{const{createNewBook:t,isAiEnabled:s}=T.useContext(rs),i=Es(),[r,o]=T.useState("select"),[a,l]=T.useState(!1),[u,f]=T.useState(""),[p,g]=T.useState(""),[b,w]=T.useState(""),[S,N]=T.useState(""),[C,M]=T.useState(""),[R,_]=T.useState(!1),[j,P]=T.useState("Photorealistic, cinematic lighting"),[D,U]=T.useState([]),[V,q]=T.useState([{role:"model",parts:[{text:"Hi there! I'm your creative consultant. Let's build your book together. What genre or idea do you have in mind?"}]}]),[G,ee]=T.useState(""),W=T.useRef(null),Q=T.useRef(null);T.useEffect(()=>{n&&(o(s?"select":"manual"),g(""),w(""),N(""),M(""),_(!1),U([]),q([{role:"model",parts:[{text:"Hi there! I'm your creative consultant. Let's build your book together. What genre or idea do you have in mind?"}]}]),l(!1))},[n,s]),T.useEffect(()=>{var ue;(ue=W.current)==null||ue.scrollIntoView({behavior:"smooth"})},[V,r]);const Z=()=>{o("manual")},$=()=>{o("brainstorm")},Y=async()=>{if(!p.trim()){te.error("Please enter a book title.");return}l(!0),f("Creating your book...");try{const ue=await t({topic:p,subtitle:b,description:S,instructions:C,generateImages:R,imageGenerationInstructions:j});i(`/editor/${ue}`),e()}catch(ue){te.error(`Failed to create book: ${ue.message}`)}finally{l(!1)}},he=async ue=>{if(ue==null||ue.preventDefault(),!G.trim()||a)return;const ke=G.trim();ee(""),Q.current&&(Q.current.style.height="46px"),l(!0);const re={role:"user",parts:[{text:ke}]};q(Je=>[...Je,re]);const Ge={role:"model",parts:[{text:""}]};q(Je=>[...Je,Ge]);try{const Je=await E3(ke,D,Qe=>{q(je=>{const ye=[...je],Fe=ye[ye.length-1];if(Fe.role==="model"){const Ne=Fe.parts[0].text||"";Fe.parts=[{text:Ne+Qe}]}return ye})});U(Je)}catch{te.error("Failed to get response from AI."),q(Qe=>Qe.slice(0,-1))}finally{l(!1)}},Re=ue=>{ue.key==="Enter"&&!ue.shiftKey&&(ue.preventDefault(),he())},ze=ue=>{ee(ue.target.value),ue.target.style.height="auto",ue.target.style.height=`${Math.min(ue.target.scrollHeight,150)}px`},F=async()=>{if(V.length<3){te.info("Let's chat a bit more to flesh out the idea first.");return}l(!0),f("Architecting your book... Generating outline and knowledge base...");try{const ue=await T3(D),ke=await t({...ue,bookChatHistory:D.map(re=>({role:re.role,parts:re.parts?re.parts.map(Ge=>({text:Ge.text})):[]}))});i(`/editor/${ke}`),e(),te.success("Book created successfully!")}catch(ue){te.error(`Failed to generate book: ${ue.message}. Please try again.`),l(!1)}};if(!n)return null;const J=()=>d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-full place-items-center p-8",children:[d.jsxs("button",{onClick:Z,className:"w-full h-64 bg-zinc-50 dark:bg-zinc-700/30 hover:bg-zinc-100 dark:hover:bg-zinc-700 border-2 border-zinc-200 dark:border-zinc-600 hover:border-indigo-500 dark:hover:border-indigo-500 rounded-2xl flex flex-col items-center justify-center p-6 transition-all group",children:[d.jsx("div",{className:"w-20 h-20 bg-zinc-200 dark:bg-zinc-600 rounded-full flex items-center justify-center mb-6 group-hover:scale-110 transition-transform",children:d.jsx(H,{name:"EDIT",className:"w-10 h-10 text-zinc-500 dark:text-zinc-300"})}),d.jsx("h3",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100",children:"Manual Setup"}),d.jsxs("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 mt-2 text-center",children:["I already have a title and idea.",d.jsx("br",{}),"Let me configure it manually."]})]}),s&&d.jsxs("button",{onClick:$,className:"w-full h-64 bg-indigo-50 dark:bg-indigo-900/10 hover:bg-indigo-100 dark:hover:bg-indigo-900/20 border-2 border-indigo-200 dark:border-indigo-800 hover:border-indigo-500 dark:hover:border-indigo-400 rounded-2xl flex flex-col items-center justify-center p-6 transition-all group relative overflow-hidden",children:[d.jsx("div",{className:"absolute top-0 right-0 p-2",children:d.jsx("span",{className:"bg-indigo-600 text-white text-[10px] font-bold px-2 py-1 rounded-full uppercase tracking-wide",children:"AI Powered"})}),d.jsx("div",{className:"w-20 h-20 bg-indigo-100 dark:bg-indigo-900/50 rounded-full flex items-center justify-center mb-6 group-hover:scale-110 transition-transform",children:d.jsx(H,{name:"SPARKLES",className:"w-10 h-10 text-indigo-600 dark:text-indigo-400"})}),d.jsx("h3",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100",children:"Book Architect"}),d.jsxs("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 mt-2 text-center",children:["Chat with an expert to brainstorm",d.jsx("br",{}),"and automatically generate your book."]})]})]}),ie=()=>d.jsxs("div",{className:"flex flex-col h-full",children:[d.jsxs("div",{className:"flex-grow overflow-y-auto p-4 space-y-4 bg-zinc-50 dark:bg-zinc-900/50 rounded-lg border border-zinc-200 dark:border-zinc-700 m-4 mb-0",children:[V.map((ue,ke)=>{const re=ue.role==="user",Ge=ue.parts[0].text||"";return!Ge&&!a?null:d.jsx("div",{className:`flex ${re?"justify-end":"justify-start"}`,children:d.jsx("div",{className:`max-w-[85%] rounded-2xl p-3 text-sm shadow-sm ${re?"bg-indigo-600 text-white rounded-tr-none":"bg-white dark:bg-zinc-800 text-zinc-800 dark:text-zinc-200 rounded-tl-none border border-zinc-200 dark:border-zinc-700"}`,children:d.jsx("div",{className:`prose prose-sm max-w-none leading-relaxed break-words ${re?"prose-user-bubble":"dark:prose-invert"}`,dangerouslySetInnerHTML:{__html:Bt.parse(Ge,{breaks:!0})}})})},ke)}),d.jsx("div",{ref:W})]}),d.jsxs("div",{className:"p-4 flex items-end gap-2",children:[d.jsx("div",{className:"flex-grow relative",children:d.jsx("textarea",{ref:Q,value:G,onChange:ze,onKeyDown:Re,placeholder:"Type your response...",rows:1,className:"w-full bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded-2xl px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:text-white resize-none max-h-40",disabled:a,style:{minHeight:"46px"}})}),d.jsx("button",{onClick:he,disabled:a||!G.trim(),className:"p-3 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 disabled:opacity-50 transition-colors mb-1",children:d.jsx(H,{name:a?"ROTATE_CW":"MESSAGE_CIRCLE",className:`w-5 h-5 ${a?"animate-spin":""}`})}),d.jsx("div",{className:"w-px h-8 bg-zinc-300 dark:bg-zinc-700 mx-2 mb-2"}),d.jsxs("button",{onClick:F,disabled:V.length<3||a,className:"whitespace-nowrap bg-emerald-600 text-white px-4 py-2.5 rounded-full font-semibold hover:bg-emerald-700 disabled:bg-zinc-300 dark:disabled:bg-zinc-700 disabled:cursor-not-allowed transition-colors flex items-center space-x-2 mb-1",children:[d.jsx(H,{name:"WAND",className:"w-4 h-4"}),d.jsx("span",{children:"I'm Ready"})]})]})]}),pe=()=>d.jsxs("div",{className:"p-6 md:p-8 space-y-6 h-full overflow-y-auto",children:[d.jsx("h3",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100 border-b border-zinc-200 dark:border-zinc-700 pb-2",children:"Book Details"}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"topic",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Book Title"}),d.jsx("input",{type:"text",id:"topic",value:p,onChange:ue=>g(ue.target.value),className:"mt-1 block w-full bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-lg font-semibold",placeholder:"e.g., The Last Starship"})]}),d.jsxs("div",{children:[d.jsxs("label",{htmlFor:"subtitle",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:["Subtitle ",d.jsx("span",{className:"text-zinc-400 font-normal",children:"(Optional)"})]}),d.jsx("input",{type:"text",id:"subtitle",value:b,onChange:ue=>w(ue.target.value),className:"mt-1 block w-full bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-lg",placeholder:"e.g., A Journey Beyond"})]})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Premise / Description"}),d.jsx("textarea",{id:"description",value:S,onChange:ue=>N(ue.target.value),rows:3,className:"mt-1 block w-full bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"What is this book about?"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"instructions",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Writing Style & Tone"}),d.jsx("textarea",{id:"instructions",value:C,onChange:ue=>M(ue.target.value),rows:3,className:"mt-1 block w-full bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"e.g., Fast-paced, witty, first-person perspective..."})]}),s&&d.jsxs("div",{className:"flex items-center pt-2",children:[d.jsx("input",{id:"generateImages",type:"checkbox",checked:R,onChange:ue=>_(ue.target.checked),className:"h-4 w-4 text-indigo-600 border-zinc-300 rounded focus:ring-indigo-500"}),d.jsx("label",{htmlFor:"generateImages",className:"ml-2 block text-sm text-zinc-900 dark:text-zinc-200",children:"Enable AI Image Generation"})]}),R&&d.jsxs("div",{className:"animate-fade-in",children:[d.jsx("label",{htmlFor:"imageStyle",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Art Style"}),d.jsx("input",{type:"text",id:"imageStyle",value:j,onChange:ue=>P(ue.target.value),className:"mt-1 block w-full bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"e.g., Oil painting, Cyberpunk, Minimalist vector..."})]})]}),d.jsx("div",{className:"pt-6 flex justify-end space-x-3",children:d.jsxs("button",{onClick:Y,className:"bg-indigo-600 text-white px-6 py-2 rounded-lg shadow-md font-bold hover:bg-indigo-700 transition-transform transform hover:scale-105 flex items-center space-x-2",children:[d.jsx(H,{name:"BOOK",className:"w-5 h-5"}),d.jsx("span",{children:"Create Book"})]})})]});return d.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 w-full max-w-4xl h-[80vh] rounded-2xl shadow-2xl border border-zinc-200 dark:border-zinc-700 overflow-hidden flex flex-col",onClick:ue=>ue.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-zinc-200 dark:border-zinc-700 bg-zinc-50/50 dark:bg-zinc-900/50",children:[d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("div",{className:"p-2 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg text-indigo-600 dark:text-indigo-400",children:d.jsx(H,{name:r==="brainstorm"?"SPARKLES":"PLUS",className:"w-5 h-5"})}),d.jsx("h2",{className:"text-lg font-bold text-zinc-800 dark:text-zinc-100",children:r==="select"?"Create New Book":r==="brainstorm"?"Creative Brainstorm":"Configure Book"})]}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6 text-zinc-500"})})]}),d.jsxs("div",{className:"flex-grow overflow-hidden relative",children:[a&&r!=="brainstorm"&&d.jsxs("div",{className:"absolute inset-0 bg-white/80 dark:bg-zinc-900/80 z-10 flex flex-col items-center justify-center",children:[d.jsx("div",{className:"w-12 h-12 border-4 border-t-indigo-500 border-zinc-200 rounded-full animate-spin mb-4"}),d.jsx("p",{className:"text-zinc-600 dark:text-zinc-300 font-semibold animate-pulse",children:u})]}),r==="select"&&J(),r==="brainstorm"&&ie(),r==="manual"&&pe()]})]})})},Sv=({label:n,value:e,icon:t,colorClass:s})=>d.jsxs("div",{className:"bg-white dark:bg-zinc-800 p-4 rounded-xl border border-zinc-200 dark:border-zinc-700 shadow-sm flex items-center space-x-4 hover:shadow-md transition-all",children:[d.jsx("div",{className:`p-3 rounded-lg ${s}`,children:d.jsx(H,{name:t,className:"w-6 h-6"})}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wide",children:n}),d.jsx("p",{className:"text-2xl font-bold text-zinc-800 dark:text-zinc-100",children:e})]})]}),mX=()=>{const{books:n,series:e,deleteBook:t,archiveBook:s,updateBook:i,removeBookFromSeries:r,reorderBooksInSeries:o}=T.useContext(rs),a=Es(),[l,u]=T.useState(!1),[f,p]=T.useState(null),[g,b]=T.useState(null),[w,S]=T.useState(null),[N,C]=T.useState(!1),[M,R]=T.useState(!1),[_,j]=T.useState(null),[P,D]=T.useState(""),[U,V]=T.useState("updated"),[q,G]=T.useState(new Set),[ee,W]=T.useState({}),[Q,Z]=T.useState(null),[$,Y]=T.useState(null);T.useEffect(()=>{(async()=>{try{const ye=await Te.readingProgress.getAll(),Fe={};ye.forEach(Ne=>{Ne.percentage!==void 0&&(Fe[Ne.bookId]=Ne.percentage)}),W(Fe)}catch(ye){console.warn("Failed to fetch reading progress",ye)}})()},[n]);const he=(je,ye)=>{const Fe=n.find(Ne=>Ne.id===je);Fe&&i({...Fe,coverImage:ye}),p(null)},Re=async je=>{await Mn.confirm({title:"Remove from Series?",message:`Are you sure you want to remove "${je.topic}" from the "${je.seriesName}" series? If only one book remains, the series will be dissolved.`,confirmText:"Remove",danger:!0})&&await r(je.id)},ze=(je,ye)=>{Z({seriesId:je,fromIndex:ye})},F=(je,ye)=>{Q&&Q.seriesId===je&&Y({seriesId:je,toIndex:ye})},J=je=>{je.preventDefault()},ie=()=>{Q&&$&&Q.seriesId===$.seriesId&&Q.fromIndex!==$.toIndex&&o(Q.seriesId,Q.fromIndex,$.toIndex),Z(null),Y(null)},pe=()=>{Z(null),Y(null)},ue=je=>{G(ye=>{const Fe=new Set(ye);return Fe.has(je)?Fe.delete(je):Fe.add(je),Fe})},ke=T.useMemo(()=>n.filter(je=>!je.deletedAt&&je.status!=="archived"),[n]),re=T.useMemo(()=>{if(!P.trim())return ke;const je=P.toLowerCase();return ke.filter(ye=>ye.topic.toLowerCase().includes(je))},[ke,P]),{series:Ge,standalone:Je}=T.useMemo(()=>{const je=new Map(e.map(ve=>[ve.id,ve])),ye={},Fe=[];re.forEach(ve=>{ve.seriesId?(ye[ve.seriesId]||(ye[ve.seriesId]=[]),ye[ve.seriesId].push(ve)):Fe.push(ve)});const Ne=Object.keys(ye).map(ve=>{const Pe=je.get(ve);if(!Pe)return Fe.push(...ye[ve]),null;const ot=ye[ve],Gt=new Map(Pe.bookIds.map((jt,yn)=>[jt,yn]));ot.sort((jt,yn)=>{const _t=Gt.get(jt.id)??1/0,Qt=Gt.get(yn.id)??1/0;return _t-Qt});const bn=ot.length>0?Math.max(...ot.map(jt=>jt.updatedAt)):0,qt=ot.length>0?Math.min(...ot.map(jt=>jt.createdAt)):0;return{seriesInfo:Pe,books:ot,lastUpdated:bn,createdAt:qt}}).filter(ve=>ve!==null);return Ne.sort((ve,Pe)=>{switch(U){case"alpha":return ve.seriesInfo.title.localeCompare(Pe.seriesInfo.title);case"created":return Pe.createdAt-ve.createdAt;case"updated":default:return Pe.lastUpdated-ve.lastUpdated}}),Fe.sort((ve,Pe)=>{switch(U){case"alpha":return ve.topic.localeCompare(Pe.topic);case"created":return Pe.createdAt-ve.createdAt;case"updated":default:return Pe.updatedAt-ve.updatedAt}}),{series:Ne,standalone:Fe}},[re,e,U]),Qe=T.useMemo(()=>ke.length===0?null:ke.reduce((je,ye)=>je.updatedAt>ye.updatedAt?je:ye),[ke]);return d.jsxs("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8",children:[l&&d.jsx(sr,{message:"Processing..."}),f&&d.jsx(Z3,{book:f,allBooks:n,onClose:()=>p(null),onCoverGenerated:he}),g&&d.jsx(e4,{book:g,onClose:()=>b(null)}),w&&d.jsx(f4,{parentBook:w.parentBook,relationType:w.relationType,onClose:()=>S(null)}),N&&d.jsx(hX,{isOpen:N,onClose:()=>C(!1)}),M&&d.jsx(pX,{isOpen:M,onClose:()=>R(!1)}),_&&d.jsx(fX,{book:_,onClose:()=>j(null)}),d.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-8",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-4xl font-bold tracking-tight text-gray-900 dark:text-white mb-2",children:"Your Library"}),d.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Manage your books, series, and creative projects."})]}),d.jsxs("div",{className:"flex gap-3 w-full md:w-auto",children:[d.jsxs("button",{onClick:()=>C(!0),className:"flex-1 md:flex-none flex items-center justify-center space-x-2 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-700 dark:text-zinc-200 px-4 py-2.5 rounded-lg shadow-sm hover:bg-zinc-50 dark:hover:bg-zinc-700 transition-all",children:[d.jsx(H,{name:"LINK",className:"w-5 h-5"}),d.jsx("span",{className:"font-semibold",children:"New Series"})]}),d.jsxs("button",{onClick:()=>R(!0),className:"flex-1 md:flex-none flex items-center justify-center space-x-2 bg-indigo-600 text-white px-5 py-2.5 rounded-lg shadow-md hover:bg-indigo-700 transition-all",children:[d.jsx(H,{name:"PLUS",className:"w-5 h-5"}),d.jsx("span",{className:"font-semibold",children:"New Book"})]})]})]}),d.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-10",children:[d.jsx(Sv,{label:"Active Books",value:ke.length,icon:"BOOK",colorClass:"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400"}),d.jsx(Sv,{label:"Total Series",value:e.length,icon:"LINK",colorClass:"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}),d.jsx(Sv,{label:"In Progress",value:ke.filter(je=>je.status!=="complete").length,icon:"EDIT",colorClass:"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400"}),d.jsx(Sv,{label:"Completed",value:ke.filter(je=>je.status==="complete").length,icon:"CLOUD_CHECK",colorClass:"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400"})]}),d.jsxs("div",{className:"space-y-8",children:[!P&&Qe&&d.jsxs("div",{className:"relative rounded-2xl shadow-xl overflow-hidden text-white p-6 sm:p-10 min-h-[220px] flex flex-col justify-center group transition-all hover:shadow-2xl",children:[d.jsx("div",{className:"absolute inset-0 z-0 bg-zinc-900",children:Qe.coverImage?d.jsxs(d.Fragment,{children:[d.jsx("img",{src:Qe.coverImage,alt:"Background",className:"w-full h-full object-cover opacity-40 blur-xl scale-110 group-hover:scale-105 transition-transform duration-1000"}),d.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-zinc-900/90 via-zinc-900/70 to-transparent/30"})]}):d.jsx("div",{className:"w-full h-full bg-gradient-to-r from-indigo-600 to-purple-700"})}),d.jsxs("div",{className:"relative z-10 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-6",children:[d.jsxs("div",{className:"flex items-center gap-6",children:[Qe.coverImage?d.jsx("img",{src:Qe.coverImage,alt:"Cover",className:"w-24 h-36 object-cover rounded-lg shadow-2xl border border-white/20 hidden sm:block transform group-hover:scale-105 transition-transform duration-500"}):d.jsx("div",{className:"w-24 h-36 bg-white/10 rounded-lg border-2 border-white/20 flex items-center justify-center hidden sm:flex",children:d.jsx(H,{name:"BOOK",className:"w-10 h-10 text-white/70"})}),d.jsxs("div",{children:[d.jsxs("div",{className:"inline-flex items-center space-x-2 bg-white/20 backdrop-blur-md px-3 py-1 rounded-full text-xs font-medium mb-3 border border-white/10",children:[d.jsx(H,{name:"HISTORY",className:"w-3 h-3"}),d.jsx("span",{children:"Resume Writing"})]}),d.jsx("h2",{className:"text-3xl sm:text-4xl font-bold leading-tight mb-2 tracking-tight",children:Qe.topic}),d.jsxs("p",{className:"text-zinc-300 text-sm mb-1 flex items-center gap-2",children:[Qe.seriesName&&d.jsx("span",{className:"bg-white/10 px-2 py-0.5 rounded text-xs",children:Qe.seriesName}),d.jsxs("span",{children:[Qe.content.length," Chapters Written"]})]}),d.jsxs("p",{className:"text-zinc-400 text-xs",children:["Updated ",new Date(Qe.updatedAt).toLocaleDateString()]})]})]}),d.jsxs("button",{onClick:()=>a(`/editor/${Qe.id}`),className:"bg-white text-zinc-900 px-8 py-3.5 rounded-xl font-bold shadow-lg hover:bg-indigo-50 transition-all transform hover:-translate-y-0.5 flex items-center space-x-2 whitespace-nowrap w-full sm:w-auto justify-center",children:[d.jsx(H,{name:"EDIT",className:"w-5 h-5"}),d.jsx("span",{children:"Open Editor"})]})]})]}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[d.jsxs("div",{className:"relative flex-grow",children:[d.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:d.jsx(H,{name:"SEARCH",className:"h-5 w-5 text-zinc-400"})}),d.jsx("input",{type:"text",placeholder:"Search your library...",value:P,onChange:je=>D(je.target.value),className:"block w-full pl-10 pr-4 py-3 border border-zinc-300 dark:border-zinc-700 rounded-xl bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 placeholder-zinc-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all shadow-sm"})]}),d.jsx("div",{className:"flex-shrink-0",children:d.jsxs("select",{value:U,onChange:je=>V(je.target.value),className:"block w-full pl-4 pr-10 py-3 border border-zinc-300 dark:border-zinc-700 rounded-xl bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm cursor-pointer",children:[d.jsx("option",{value:"updated",children:"Last Updated"}),d.jsx("option",{value:"created",children:"Date Created"}),d.jsx("option",{value:"alpha",children:"Alphabetical"})]})})]}),re.length===0&&P?d.jsxs("div",{className:"text-center py-20",children:[d.jsx(H,{name:"SEARCH",className:"w-12 h-12 mx-auto text-zinc-300 dark:text-zinc-600 mb-4"}),d.jsxs("p",{className:"text-zinc-500 dark:text-zinc-400",children:['No books found matching "',P,'"']})]}):ke.length===0?d.jsxs("div",{className:"text-center py-20 bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-zinc-200 dark:border-zinc-700 empty-state-bg",children:[d.jsx(H,{name:"BOOK",className:"w-20 h-20 mx-auto text-zinc-300 dark:text-zinc-600"}),d.jsx("h2",{className:"mt-4 text-2xl font-semibold text-zinc-800 dark:text-zinc-100",children:"Your library is empty"}),d.jsx("p",{className:"mt-2 text-zinc-500 dark:text-zinc-400",children:'Click "New Book" above to start your first masterpiece.'})]}):d.jsxs("div",{className:"space-y-12",children:[Ge.map(({seriesInfo:je,books:ye})=>d.jsxs("div",{className:"bg-zinc-50/50 dark:bg-zinc-800/20 rounded-2xl p-2 border border-zinc-200/50 dark:border-zinc-700/30",children:[d.jsxs("div",{className:"flex justify-between items-center p-4",children:[d.jsxs("div",{className:"flex items-center space-x-3 cursor-pointer group",onClick:()=>ue(je.id),children:[d.jsx("div",{className:"p-2 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg text-indigo-600 dark:text-indigo-400",children:d.jsx(H,{name:"LINK",className:"w-5 h-5"})}),d.jsxs("div",{children:[d.jsxs("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100 flex items-center gap-2",children:[je.title,d.jsx("span",{className:"text-xs font-normal text-zinc-500 dark:text-zinc-400 bg-zinc-200 dark:bg-zinc-700 px-2 py-0.5 rounded-full",children:"Series"})]}),d.jsxs("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mt-0.5",children:[ye.length," books"]})]}),d.jsx(H,{name:"CHEVRON_RIGHT",className:`w-5 h-5 text-zinc-400 transform transition-transform duration-200 group-hover:text-zinc-600 dark:group-hover:text-zinc-300 ${q.has(je.id)?"rotate-0":"rotate-90"}`})]}),d.jsx("button",{onClick:()=>a(`/series/${je.id}`),className:"text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:underline px-3 py-1 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 rounded-md transition-colors",children:"Manage Series"})]}),!q.has(je.id)&&d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8 p-4 pt-0 animate-fade-in",children:ye.map((Fe,Ne)=>{const ve=(Q==null?void 0:Q.seriesId)===je.id&&(Q==null?void 0:Q.fromIndex)===Ne,Pe=($==null?void 0:$.seriesId)===je.id&&($==null?void 0:$.toIndex)===Ne&&!ve;return d.jsx(Zw,{book:Fe,readingProgress:ee[Fe.id],onDelete:()=>t(Fe.id),onManageSnapshots:()=>b(Fe),onGenerateCover:()=>p(Fe),onCreateRelated:ot=>S({parentBook:Fe,relationType:ot}),onRemoveFromSeries:()=>Re(Fe),isDraggable:!0,onDragStart:()=>ze(je.id,Ne),onDragEnter:()=>F(je.id,Ne),onDragOver:J,onDrop:ie,onDragEnd:pe,isDragging:ve,isDragOver:Pe},Fe.id)})})]},je.id)),Je.length>0&&d.jsxs("div",{className:"space-y-6 px-2",children:[Ge.length>0&&d.jsxs("div",{className:"flex items-center space-x-2 border-b border-zinc-200 dark:border-zinc-700 pb-2",children:[d.jsx(H,{name:"BOOK",className:"w-5 h-5 text-zinc-400"}),d.jsx("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100",children:"Standalone Books"})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8",children:Je.map(je=>d.jsx(Zw,{book:je,readingProgress:ee[je.id],onDelete:()=>t(je.id),onManageSnapshots:()=>b(je),onGenerateCover:()=>p(je),onCreateRelated:ye=>S({parentBook:je,relationType:ye}),onAddToSeries:()=>j(je)},je.id))})]})]})]})]})},gX=()=>{const{documents:n,createNewDocument:e,deleteDocument:t}=T.useContext(rs),s=Es(),[i,r]=T.useState(""),[o,a]=T.useState(!1),l=async()=>{a(!0);try{const p=await e();s(`/documents/${p}`)}finally{a(!1)}},u=async(p,g)=>{p.stopPropagation(),await Mn.confirm({title:"Delete Document?",message:"Are you sure you want to delete this document? This action cannot be undone.",danger:!0,confirmText:"Delete"})&&await t(g)},f=T.useMemo(()=>i.trim()?n.filter(p=>p.title.toLowerCase().includes(i.toLowerCase())):n,[n,i]);return d.jsxs("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8",children:[d.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8",children:[d.jsxs("h1",{className:"text-3xl font-bold tracking-tight text-gray-900 dark:text-white flex items-center gap-3",children:[d.jsx(H,{name:"FILE_TEXT",className:"text-indigo-600 dark:text-indigo-400"}),"Documents"]}),d.jsxs("button",{onClick:l,disabled:o,className:"bg-indigo-600 text-white px-5 py-2.5 rounded-lg shadow-md hover:bg-indigo-700 transition-all flex items-center space-x-2 disabled:opacity-70",children:[d.jsx(H,{name:"PLUS",className:"w-5 h-5"}),d.jsx("span",{children:"New Document"})]})]}),d.jsx("div",{className:"mb-6",children:d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:d.jsx(H,{name:"SEARCH",className:"h-5 w-5 text-zinc-400"})}),d.jsx("input",{type:"text",placeholder:"Search documents...",value:i,onChange:p=>r(p.target.value),className:"block w-full pl-10 pr-4 py-3 border border-zinc-300 dark:border-zinc-700 rounded-xl bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 placeholder-zinc-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all shadow-sm"})]})}),f.length===0?d.jsxs("div",{className:"text-center py-20 bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-zinc-200 dark:border-zinc-700 empty-state-bg",children:[d.jsx(H,{name:"FILE_TEXT",className:"w-20 h-20 mx-auto text-zinc-300 dark:text-zinc-600"}),d.jsx("h2",{className:"mt-4 text-2xl font-semibold text-zinc-800 dark:text-zinc-100",children:"No documents yet"}),d.jsx("p",{className:"mt-2 text-zinc-500 dark:text-zinc-400",children:"Create a new document to start writing."})]}):d.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:f.map(p=>d.jsxs("div",{onClick:()=>s(`/documents/${p.id}`),className:"group bg-white dark:bg-zinc-800 rounded-xl border border-zinc-200 dark:border-zinc-700 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all cursor-pointer flex flex-col h-64",children:[d.jsxs("div",{className:"flex-grow p-5 overflow-hidden relative",children:[d.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-white dark:to-zinc-800 opacity-90 z-10 pointer-events-none"}),d.jsx("div",{className:"prose prose-sm dark:prose-invert scale-75 origin-top-left pointer-events-none opacity-60 select-none",dangerouslySetInnerHTML:{__html:p.content||"<p>Empty document</p>"}})]}),d.jsxs("div",{className:"p-4 border-t border-zinc-100 dark:border-zinc-700/50 flex justify-between items-center bg-zinc-50/50 dark:bg-zinc-900/30 rounded-b-xl",children:[d.jsxs("div",{className:"min-w-0 flex-1 mr-2",children:[d.jsx("h3",{className:"font-bold text-zinc-800 dark:text-zinc-100 truncate text-sm",title:p.title,children:p.title}),d.jsxs("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mt-0.5",children:["Updated ",new Date(p.updatedAt).toLocaleDateString()]})]}),d.jsx("button",{onClick:g=>u(g,p.id),className:"p-2 rounded-full text-zinc-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-zinc-700 opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete",children:d.jsx(H,{name:"TRASH",className:"w-4 h-4"})})]})]},p.id))})]})};function ti(n){this.content=n}ti.prototype={constructor:ti,find:function(n){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===n)return e;return-1},get:function(n){var e=this.find(n);return e==-1?void 0:this.content[e+1]},update:function(n,e,t){var s=t&&t!=n?this.remove(t):this,i=s.find(n),r=s.content.slice();return i==-1?r.push(t||n,e):(r[i+1]=e,t&&(r[i]=t)),new ti(r)},remove:function(n){var e=this.find(n);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new ti(t)},addToStart:function(n,e){return new ti([n,e].concat(this.remove(n).content))},addToEnd:function(n,e){var t=this.remove(n).content.slice();return t.push(n,e),new ti(t)},addBefore:function(n,e,t){var s=this.remove(e),i=s.content.slice(),r=s.find(n);return i.splice(r==-1?i.length:r,0,e,t),new ti(i)},forEach:function(n){for(var e=0;e<this.content.length;e+=2)n(this.content[e],this.content[e+1])},prepend:function(n){return n=ti.from(n),n.size?new ti(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=ti.from(n),n.size?new ti(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var e=this;n=ti.from(n);for(var t=0;t<n.content.length;t+=2)e=e.remove(n.content[t]);return e},toObject:function(){var n={};return this.forEach(function(e,t){n[e]=t}),n},get size(){return this.content.length>>1}};ti.from=function(n){if(n instanceof ti)return n;var e=[];if(n)for(var t in n)e.push(t,n[t]);return new ti(e)};function p4(n,e,t){for(let s=0;;s++){if(s==n.childCount||s==e.childCount)return n.childCount==e.childCount?null:t;let i=n.child(s),r=e.child(s);if(i==r){t+=i.nodeSize;continue}if(!i.sameMarkup(r))return t;if(i.isText&&i.text!=r.text){for(let o=0;i.text[o]==r.text[o];o++)t++;return t}if(i.content.size||r.content.size){let o=p4(i.content,r.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function m4(n,e,t,s){for(let i=n.childCount,r=e.childCount;;){if(i==0||r==0)return i==r?null:{a:t,b:s};let o=n.child(--i),a=e.child(--r),l=o.nodeSize;if(o==a){t-=l,s-=l;continue}if(!o.sameMarkup(a))return{a:t,b:s};if(o.isText&&o.text!=a.text){let u=0,f=Math.min(o.text.length,a.text.length);for(;u<f&&o.text[o.text.length-u-1]==a.text[a.text.length-u-1];)u++,t--,s--;return{a:t,b:s}}if(o.content.size||a.content.size){let u=m4(o.content,a.content,t-1,s-1);if(u)return u}t-=l,s-=l}}class Ie{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let s=0;s<e.length;s++)this.size+=e[s].nodeSize}nodesBetween(e,t,s,i=0,r){for(let o=0,a=0;a<t;o++){let l=this.content[o],u=a+l.nodeSize;if(u>e&&s(l,i+a,r||null,o)!==!1&&l.content.size){let f=a+1;l.nodesBetween(Math.max(0,e-f),Math.min(l.content.size,t-f),s,i+f)}a=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,s,i){let r="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let u=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&u||a.isTextblock)&&s&&(o?o=!1:r+=s),r+=u},0),r}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,s=e.firstChild,i=this.content.slice(),r=0;for(t.isText&&t.sameMarkup(s)&&(i[i.length-1]=t.withText(t.text+s.text),r=1);r<e.content.length;r++)i.push(e.content[r]);return new Ie(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let s=[],i=0;if(t>e)for(let r=0,o=0;o<t;r++){let a=this.content[r],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),s.push(a),i+=a.nodeSize),o=l}return new Ie(s,i)}cutByIndex(e,t){return e==t?Ie.empty:e==0&&t==this.content.length?this:new Ie(this.content.slice(e,t))}replaceChild(e,t){let s=this.content[e];if(s==t)return this;let i=this.content.slice(),r=this.size+t.nodeSize-s.nodeSize;return i[e]=t,new Ie(i,r)}addToStart(e){return new Ie([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Ie(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,s=0;t<this.content.length;t++){let i=this.content[t];e(i,s,t),s+=i.nodeSize}}findDiffStart(e,t=0){return p4(this,e,t)}findDiffEnd(e,t=this.size,s=e.size){return m4(this,e,t,s)}findIndex(e){if(e==0)return Cv(0,e);if(e==this.size)return Cv(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,s=0;;t++){let i=this.child(t),r=s+i.nodeSize;if(r>=e)return r==e?Cv(t+1,r):Cv(t,s);s=r}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return Ie.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new Ie(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Ie.empty;let t,s=0;for(let i=0;i<e.length;i++){let r=e[i];s+=r.nodeSize,i&&r.isText&&e[i-1].sameMarkup(r)?(t||(t=e.slice(0,i)),t[t.length-1]=r.withText(t[t.length-1].text+r.text)):t&&t.push(r)}return new Ie(t||e,s)}static from(e){if(!e)return Ie.empty;if(e instanceof Ie)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Ie([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Ie.empty=new Ie([],0);const EA={index:0,offset:0};function Cv(n,e){return EA.index=n,EA.offset=e,EA}function ek(n,e){if(n===e)return!0;if(!(n&&typeof n=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(n);if(Array.isArray(e)!=t)return!1;if(t){if(n.length!=e.length)return!1;for(let s=0;s<n.length;s++)if(!ek(n[s],e[s]))return!1}else{for(let s in n)if(!(s in e)||!ek(n[s],e[s]))return!1;for(let s in e)if(!(s in n))return!1}return!0}let gn=class KN{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,s=!1;for(let i=0;i<e.length;i++){let r=e[i];if(this.eq(r))return e;if(this.type.excludes(r.type))t||(t=e.slice(0,i));else{if(r.type.excludes(this.type))return e;!s&&r.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),s=!0),t&&t.push(r)}}return t||(t=e.slice()),s||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&ek(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let s=e.marks[t.type];if(!s)throw new RangeError(`There is no mark type ${t.type} in this schema`);let i=s.create(t.attrs);return s.checkAttrs(i.attrs),i}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let s=0;s<e.length;s++)if(!e[s].eq(t[s]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return KN.none;if(e instanceof KN)return[e];let t=e.slice();return t.sort((s,i)=>s.type.rank-i.type.rank),t}};gn.none=[];class tk extends Error{}class Ve{constructor(e,t,s){this.content=e,this.openStart=t,this.openEnd=s}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let s=x4(this.content,e+this.openStart,t);return s&&new Ve(s,this.openStart,this.openEnd)}removeBetween(e,t){return new Ve(g4(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return Ve.empty;let s=t.openStart||0,i=t.openEnd||0;if(typeof s!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Ve(Ie.fromJSON(e,t.content),s,i)}static maxOpen(e,t=!0){let s=0,i=0;for(let r=e.firstChild;r&&!r.isLeaf&&(t||!r.type.spec.isolating);r=r.firstChild)s++;for(let r=e.lastChild;r&&!r.isLeaf&&(t||!r.type.spec.isolating);r=r.lastChild)i++;return new Ve(e,s,i)}}Ve.empty=new Ve(Ie.empty,0,0);function g4(n,e,t){let{index:s,offset:i}=n.findIndex(e),r=n.maybeChild(s),{index:o,offset:a}=n.findIndex(t);if(i==e||r.isText){if(a!=t&&!n.child(o).isText)throw new RangeError("Removing non-flat range");return n.cut(0,e).append(n.cut(t))}if(s!=o)throw new RangeError("Removing non-flat range");return n.replaceChild(s,r.copy(g4(r.content,e-i-1,t-i-1)))}function x4(n,e,t,s){let{index:i,offset:r}=n.findIndex(e),o=n.maybeChild(i);if(r==e||o.isText)return s&&!s.canReplace(i,i,t)?null:n.cut(0,e).append(t).append(n.cut(e));let a=x4(o.content,e-r-1,t,o);return a&&n.replaceChild(i,o.copy(a))}function xX(n,e,t){if(t.openStart>n.depth)throw new tk("Inserted content deeper than insertion position");if(n.depth-t.openStart!=e.depth-t.openEnd)throw new tk("Inconsistent open depths");return b4(n,e,t,0)}function b4(n,e,t,s){let i=n.index(s),r=n.node(s);if(i==e.index(s)&&s<n.depth-t.openStart){let o=b4(n,e,t,s+1);return r.copy(r.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&n.depth==s&&e.depth==s){let o=n.parent,a=o.content;return jh(o,a.cut(0,n.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=bX(t,n);return jh(r,v4(n,o,a,e,s))}else return jh(r,nk(n,e,s))}function y4(n,e){if(!e.type.compatibleContent(n.type))throw new tk("Cannot join "+e.type.name+" onto "+n.type.name)}function YN(n,e,t){let s=n.node(t);return y4(s,e.node(t)),s}function Dh(n,e){let t=e.length-1;t>=0&&n.isText&&n.sameMarkup(e[t])?e[t]=n.withText(e[t].text+n.text):e.push(n)}function S0(n,e,t,s){let i=(e||n).node(t),r=0,o=e?e.index(t):i.childCount;n&&(r=n.index(t),n.depth>t?r++:n.textOffset&&(Dh(n.nodeAfter,s),r++));for(let a=r;a<o;a++)Dh(i.child(a),s);e&&e.depth==t&&e.textOffset&&Dh(e.nodeBefore,s)}function jh(n,e){return n.type.checkContent(e),n.copy(e)}function v4(n,e,t,s,i){let r=n.depth>i&&YN(n,e,i+1),o=s.depth>i&&YN(t,s,i+1),a=[];return S0(null,n,i,a),r&&o&&e.index(i)==t.index(i)?(y4(r,o),Dh(jh(r,v4(n,e,t,s,i+1)),a)):(r&&Dh(jh(r,nk(n,e,i+1)),a),S0(e,t,i,a),o&&Dh(jh(o,nk(t,s,i+1)),a)),S0(s,null,i,a),new Ie(a)}function nk(n,e,t){let s=[];if(S0(null,n,t,s),n.depth>t){let i=YN(n,e,t+1);Dh(jh(i,nk(n,e,t+1)),s)}return S0(e,null,t,s),new Ie(s)}function bX(n,e){let t=e.depth-n.openStart,i=e.node(t).copy(n.content);for(let r=t-1;r>=0;r--)i=e.node(r).copy(Ie.from(i));return{start:i.resolveNoCache(n.openStart+t),end:i.resolveNoCache(i.content.size-n.openEnd-t)}}class Y0{constructor(e,t,s){this.pos=e,this.path=t,this.parentOffset=s,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let s=this.pos-this.path[this.path.length-1],i=e.child(t);return s?e.child(t).cut(s):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let s=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let r=0;r<e;r++)i+=s.child(r).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return gn.none;if(this.textOffset)return e.child(t).marks;let s=e.maybeChild(t-1),i=e.maybeChild(t);if(!s){let a=s;s=i,i=a}let r=s.marks;for(var o=0;o<r.length;o++)r[o].type.spec.inclusive===!1&&(!i||!r[o].isInSet(i.marks))&&(r=r[o--].removeFromSet(r));return r}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let s=t.marks,i=e.parent.maybeChild(e.index());for(var r=0;r<s.length;r++)s[r].type.spec.inclusive===!1&&(!i||!s[r].isInSet(i.marks))&&(s=s[r--].removeFromSet(s));return s}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let s=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);s>=0;s--)if(e.pos<=this.end(s)&&(!t||t(this.node(s))))return new sk(this,e,s);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let s=[],i=0,r=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(r),u=r-l;if(s.push(o,a,i+l),!u||(o=o.child(a),o.isText))break;r=u-1,i+=l+1}return new Y0(t,s,r)}static resolveCached(e,t){let s=Kj.get(e);if(s)for(let r=0;r<s.elts.length;r++){let o=s.elts[r];if(o.pos==t)return o}else Kj.set(e,s=new yX);let i=s.elts[s.i]=Y0.resolve(e,t);return s.i=(s.i+1)%vX,i}}class yX{constructor(){this.elts=[],this.i=0}}const vX=12,Kj=new WeakMap;class sk{constructor(e,t,s){this.$from=e,this.$to=t,this.depth=s}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const wX=Object.create(null);let Rd=class JN{constructor(e,t,s,i=gn.none){this.type=e,this.attrs=t,this.marks=i,this.content=s||Ie.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,s,i=0){this.content.nodesBetween(e,t,s,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,s,i){return this.content.textBetween(e,t,s,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,s){return this.type==e&&ek(this.attrs,t||e.defaultAttrs||wX)&&gn.sameSet(this.marks,s||gn.none)}copy(e=null){return e==this.content?this:new JN(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new JN(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,s=!1){if(e==t)return Ve.empty;let i=this.resolve(e),r=this.resolve(t),o=s?0:i.sharedDepth(t),a=i.start(o),u=i.node(o).content.cut(i.pos-a,r.pos-a);return new Ve(u,i.depth-o,r.depth-o)}replace(e,t,s){return xX(this.resolve(e),this.resolve(t),s)}nodeAt(e){for(let t=this;;){let{index:s,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(s),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:s}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:s}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:s}=this.content.findIndex(e);if(s<e)return{node:this.content.child(t),index:t,offset:s};let i=this.content.child(t-1);return{node:i,index:t-1,offset:s-i.nodeSize}}resolve(e){return Y0.resolveCached(this,e)}resolveNoCache(e){return Y0.resolve(this,e)}rangeHasMark(e,t,s){let i=!1;return t>e&&this.nodesBetween(e,t,r=>(s.isInSet(r.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),w4(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,s=Ie.empty,i=0,r=s.childCount){let o=this.contentMatchAt(e).matchFragment(s,i,r),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=i;l<r;l++)if(!this.type.allowsMarks(s.child(l).marks))return!1;return!0}canReplaceWith(e,t,s,i){if(i&&!this.type.allowsMarks(i))return!1;let r=this.contentMatchAt(e).matchType(s),o=r&&r.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=gn.none;for(let t=0;t<this.marks.length;t++){let s=this.marks[t];s.type.checkAttrs(s.attrs),e=s.addToSet(e)}if(!gn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let s;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");s=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,s)}let i=Ie.fromJSON(e,t.content),r=e.nodeType(t.type).create(t.attrs,i,s);return r.type.checkAttrs(r.attrs),r}};Rd.prototype.text=void 0;class ik extends Rd{constructor(e,t,s,i){if(super(e,t,null,i),!s)throw new RangeError("Empty text nodes are not allowed");this.text=s}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):w4(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new ik(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new ik(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function w4(n,e){for(let t=n.length-1;t>=0;t--)e=n[t].type.name+"("+e+")";return e}class $h{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let s=new kX(e,t);if(s.next==null)return $h.empty;let i=k4(s);s.next&&s.err("Unexpected trailing text");let r=_X(TX(i));return MX(r,s),r}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,s=e.childCount){let i=this;for(let r=t;i&&r<s;r++)i=i.matchType(e.child(r).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let s=0;s<e.next.length;s++)if(this.next[t].type==e.next[s].type)return!0;return!1}fillBefore(e,t=!1,s=0){let i=[this];function r(o,a){let l=o.matchFragment(e,s);if(l&&(!t||l.validEnd))return Ie.from(a.map(u=>u.createAndFill()));for(let u=0;u<o.next.length;u++){let{type:f,next:p}=o.next[u];if(!(f.isText||f.hasRequiredAttrs())&&i.indexOf(p)==-1){i.push(p);let g=r(p,a.concat(f));if(g)return g}}return null}return r(this,[])}findWrapping(e){for(let s=0;s<this.wrapCache.length;s+=2)if(this.wrapCache[s]==e)return this.wrapCache[s+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),s=[{match:this,type:null,via:null}];for(;s.length;){let i=s.shift(),r=i.match;if(r.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<r.next.length;o++){let{type:a,next:l}=r.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!i.type||l.validEnd)&&(s.push({match:a.contentMatch,type:a,via:i}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(s){e.push(s);for(let i=0;i<s.next.length;i++)e.indexOf(s.next[i].next)==-1&&t(s.next[i].next)}return t(this),e.map((s,i)=>{let r=i+(s.validEnd?"*":" ")+" ";for(let o=0;o<s.next.length;o++)r+=(o?", ":"")+s.next[o].type.name+"->"+e.indexOf(s.next[o].next);return r}).join(`
`)}}$h.empty=new $h(!0);class kX{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function k4(n){let e=[];do e.push(SX(n));while(n.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function SX(n){let e=[];do e.push(CX(n));while(n.next&&n.next!=")"&&n.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function CX(n){let e=EX(n);for(;;)if(n.eat("+"))e={type:"plus",expr:e};else if(n.eat("*"))e={type:"star",expr:e};else if(n.eat("?"))e={type:"opt",expr:e};else if(n.eat("{"))e=AX(n,e);else break;return e}function Yj(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let e=Number(n.next);return n.pos++,e}function AX(n,e){let t=Yj(n),s=t;return n.eat(",")&&(n.next!="}"?s=Yj(n):s=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:t,max:s,expr:e}}function NX(n,e){let t=n.nodeTypes,s=t[e];if(s)return[s];let i=[];for(let r in t){let o=t[r];o.isInGroup(e)&&i.push(o)}return i.length==0&&n.err("No node type or group '"+e+"' found"),i}function EX(n){if(n.eat("(")){let e=k4(n);return n.eat(")")||n.err("Missing closing paren"),e}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let e=NX(n,n.next).map(t=>(n.inline==null?n.inline=t.isInline:n.inline!=t.isInline&&n.err("Mixing inline and block content"),{type:"name",value:t}));return n.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function TX(n){let e=[[]];return i(r(n,0),t()),e;function t(){return e.push([])-1}function s(o,a,l){let u={term:l,to:a};return e[o].push(u),u}function i(o,a){o.forEach(l=>l.to=a)}function r(o,a){if(o.type=="choice")return o.exprs.reduce((l,u)=>l.concat(r(u,a)),[]);if(o.type=="seq")for(let l=0;;l++){let u=r(o.exprs[l],a);if(l==o.exprs.length-1)return u;i(u,a=t())}else if(o.type=="star"){let l=t();return s(a,l),i(r(o.expr,l),l),[s(l)]}else if(o.type=="plus"){let l=t();return i(r(o.expr,a),l),i(r(o.expr,l),l),[s(l)]}else{if(o.type=="opt")return[s(a)].concat(r(o.expr,a));if(o.type=="range"){let l=a;for(let u=0;u<o.min;u++){let f=t();i(r(o.expr,l),f),l=f}if(o.max==-1)i(r(o.expr,l),l);else for(let u=o.min;u<o.max;u++){let f=t();s(l,f),i(r(o.expr,l),f),l=f}return[s(l)]}else{if(o.type=="name")return[s(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function S4(n,e){return e-n}function Jj(n,e){let t=[];return s(e),t.sort(S4);function s(i){let r=n[i];if(r.length==1&&!r[0].term)return s(r[0].to);t.push(i);for(let o=0;o<r.length;o++){let{term:a,to:l}=r[o];!a&&t.indexOf(l)==-1&&s(l)}}}function _X(n){let e=Object.create(null);return t(Jj(n,0));function t(s){let i=[];s.forEach(o=>{n[o].forEach(({term:a,to:l})=>{if(!a)return;let u;for(let f=0;f<i.length;f++)i[f][0]==a&&(u=i[f][1]);Jj(n,l).forEach(f=>{u||i.push([a,u=[]]),u.indexOf(f)==-1&&u.push(f)})})});let r=e[s.join(",")]=new $h(s.indexOf(n.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(S4);r.next.push({type:i[o][0],next:e[a.join(",")]||t(a)})}return r}}function MX(n,e){for(let t=0,s=[n];t<s.length;t++){let i=s[t],r=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:u}=i.next[a];o.push(l.name),r&&!(l.isText||l.hasRequiredAttrs())&&(r=!1),s.indexOf(u)==-1&&s.push(u)}r&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function C4(n){let e=Object.create(null);for(let t in n){let s=n[t];if(!s.hasDefault)return null;e[t]=s.default}return e}function A4(n,e){let t=Object.create(null);for(let s in n){let i=e&&e[s];if(i===void 0){let r=n[s];if(r.hasDefault)i=r.default;else throw new RangeError("No value supplied for attribute "+s)}t[s]=i}return t}function N4(n,e,t,s){for(let i in e)if(!(i in n))throw new RangeError(`Unsupported attribute ${i} for ${t} of type ${i}`);for(let i in n){let r=n[i];r.validate&&r.validate(e[i])}}function E4(n,e){let t=Object.create(null);if(e)for(let s in e)t[s]=new IX(n,s,e[s]);return t}let Xj=class T4{constructor(e,t,s){this.name=e,this.schema=t,this.spec=s,this.markSet=null,this.groups=s.group?s.group.split(" "):[],this.attrs=E4(e,s.attrs),this.defaultAttrs=C4(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(s.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==$h.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:A4(this.attrs,e)}create(e=null,t,s){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Rd(this,this.computeAttrs(e),Ie.from(t),gn.setFrom(s))}createChecked(e=null,t,s){return t=Ie.from(t),this.checkContent(t),new Rd(this,this.computeAttrs(e),t,gn.setFrom(s))}createAndFill(e=null,t,s){if(e=this.computeAttrs(e),t=Ie.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),r=i&&i.fillBefore(Ie.empty,!0);return r?new Rd(this,e,t.append(r),gn.setFrom(s)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let s=0;s<e.childCount;s++)if(!this.allowsMarks(e.child(s).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){N4(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let s=0;s<e.length;s++)this.allowsMarkType(e[s].type)?t&&t.push(e[s]):t||(t=e.slice(0,s));return t?t.length?t:gn.none:e}static compile(e,t){let s=Object.create(null);e.forEach((r,o)=>s[r]=new T4(r,t,o));let i=t.spec.topNode||"doc";if(!s[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!s.text)throw new RangeError("Every schema needs a 'text' type");for(let r in s.text.attrs)throw new RangeError("The text node type should not have attributes");return s}};function RX(n,e,t){let s=t.split("|");return i=>{let r=i===null?"null":typeof i;if(s.indexOf(r)<0)throw new RangeError(`Expected value of type ${s} for attribute ${e} on type ${n}, got ${r}`)}}class IX{constructor(e,t,s){this.hasDefault=Object.prototype.hasOwnProperty.call(s,"default"),this.default=s.default,this.validate=typeof s.validate=="string"?RX(e,t,s.validate):s.validate}get isRequired(){return!this.hasDefault}}class RS{constructor(e,t,s,i){this.name=e,this.rank=t,this.schema=s,this.spec=i,this.attrs=E4(e,i.attrs),this.excluded=null;let r=C4(this.attrs);this.instance=r?new gn(this,r):null}create(e=null){return!e&&this.instance?this.instance:new gn(this,A4(this.attrs,e))}static compile(e,t){let s=Object.create(null),i=0;return e.forEach((r,o)=>s[r]=new RS(r,i++,t,o)),s}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){N4(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class _4{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=ti.from(e.nodes),t.marks=ti.from(e.marks||{}),this.nodes=Xj.compile(this.spec.nodes,this),this.marks=RS.compile(this.spec.marks,this);let s=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let r=this.nodes[i],o=r.spec.content||"",a=r.spec.marks;if(r.contentMatch=s[o]||(s[o]=$h.parse(o,this.nodes)),r.inlineContent=r.contentMatch.inlineContent,r.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!r.isInline||!r.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=r}r.markSet=a=="_"?null:a?Qj(this,a.split(" ")):a==""||!r.inlineContent?[]:null}for(let i in this.marks){let r=this.marks[i],o=r.spec.excludes;r.excluded=o==null?[r]:o==""?[]:Qj(this,o.split(" "))}this.nodeFromJSON=i=>Rd.fromJSON(this,i),this.markFromJSON=i=>gn.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,s,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof Xj){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,s,i)}text(e,t){let s=this.nodes.text;return new ik(s,s.defaultAttrs,e,gn.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function Qj(n,e){let t=[];for(let s=0;s<e.length;s++){let i=e[s],r=n.marks[i],o=r;if(r)t.push(r);else for(let a in n.marks){let l=n.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[s]+"'")}return t}function zX(n){return n.tag!=null}function DX(n){return n.style!=null}let C0=class XN{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let s=this.matchedStyles=[];t.forEach(i=>{if(zX(i))this.tags.push(i);else if(DX(i)){let r=/[^=]*/.exec(i.style)[0];s.indexOf(r)<0&&s.push(r),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let r=e.nodes[i.node];return r.contentMatch.matchType(r)})}parse(e,t={}){let s=new eP(this,t,!1);return s.addAll(e,gn.none,t.from,t.to),s.finish()}parseSlice(e,t={}){let s=new eP(this,t,!0);return s.addAll(e,gn.none,t.from,t.to),Ve.maxOpen(s.finish())}matchTag(e,t,s){for(let i=s?this.tags.indexOf(s)+1:0;i<this.tags.length;i++){let r=this.tags[i];if(LX(e,r.tag)&&(r.namespace===void 0||e.namespaceURI==r.namespace)&&(!r.context||t.matchesContext(r.context))){if(r.getAttrs){let o=r.getAttrs(e);if(o===!1)continue;r.attrs=o||void 0}return r}}}matchStyle(e,t,s,i){for(let r=i?this.styles.indexOf(i)+1:0;r<this.styles.length;r++){let o=this.styles[r],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!s.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function s(i){let r=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<r)break}t.splice(o,0,i)}for(let i in e.marks){let r=e.marks[i].spec.parseDOM;r&&r.forEach(o=>{s(o=tP(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let r=e.nodes[i].spec.parseDOM;r&&r.forEach(o=>{s(o=tP(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new XN(e,XN.schemaRules(e)))}};const M4={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},jX={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},R4={ol:!0,ul:!0},J0=1,QN=2,A0=4;function Zj(n,e,t){return e!=null?(e?J0:0)|(e==="full"?QN:0):n&&n.whitespace=="pre"?J0|QN:t&~A0}class Av{constructor(e,t,s,i,r,o){this.type=e,this.attrs=t,this.marks=s,this.solid=i,this.options=o,this.content=[],this.activeMarks=gn.none,this.match=r||(o&A0?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(Ie.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let s=this.type.contentMatch,i;return(i=s.findWrapping(e.type))?(this.match=s,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&J0)){let s=this.content[this.content.length-1],i;if(s&&s.isText&&(i=/[ \t\r\n\u000c]+$/.exec(s.text))){let r=s;s.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-i[0].length))}}let t=Ie.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(Ie.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!M4.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class eP{constructor(e,t,s){this.parser=e,this.options=t,this.isOpen=s,this.open=0,this.localPreserveWS=!1;let i=t.topNode,r,o=Zj(null,t.preserveWhitespace,0)|(s?A0:0);i?r=new Av(i.type,i.attrs,gn.none,!0,t.topMatch||i.type.contentMatch,o):s?r=new Av(null,null,gn.none,!0,null,o):r=new Av(e.schema.topNodeType,null,gn.none,!0,null,o),this.nodes=[r],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let s=e.nodeValue,i=this.top,r=i.options&QN?"full":this.localPreserveWS||(i.options&J0)>0,{schema:o}=this.parser;if(r==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(s)){if(r)if(r==="full")s=s.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(s)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=s.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),t,!0),a[l]&&this.insertNode(o.text(a[l]),t,!/\S/.test(a[l]));s=""}else s=s.replace(/\r?\n|\r/g," ");else if(s=s.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(s)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(s=s.slice(1))}s&&this.insertNode(o.text(s),t,!/\S/.test(s)),this.findInText(e)}else this.findInside(e)}addElement(e,t,s){let i=this.localPreserveWS,r=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;R4.hasOwnProperty(o)&&this.parser.normalizeLists&&PX(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,s));e:if(l?l.ignore:jX.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let u,f=this.needsBlock;if(M4.hasOwnProperty(o))r.content.length&&r.content[0].isInline&&this.open&&(this.open--,r=this.top),u=!0,r.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let p=l&&l.skip?t:this.readStyles(e,t);p&&this.addAll(e,p),u&&this.sync(r),this.needsBlock=f}else{let u=this.readStyles(e,t);u&&this.addElementByRule(e,l,u,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let s=e.style;if(s&&s.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let r=this.parser.matchedStyles[i],o=s.getPropertyValue(r);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(r,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(u=>!l.clearMark(u)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,s,i){let r,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),s,e.nodeName=="BR")||this.leafFallback(e,s);else{let l=this.enter(o,t.attrs||null,s,t.preserveWhitespace);l&&(r=!0,s=l)}else{let l=this.parser.schema.marks[t.mark];s=s.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,s,i);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,s,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,s),this.findAround(e,l,!1)}r&&this.sync(a)&&this.open--}addAll(e,t,s,i){let r=s||0;for(let o=s?e.childNodes[s]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++r)this.findAtPoint(e,r),this.addDOM(o,t);this.findAtPoint(e,r)}findPlace(e,t,s){let i,r;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],u=l.findWrapping(e);if(u&&(!i||i.length>u.length+a)&&(i=u,r=l,!u.length))break;if(l.solid){if(s)break;a+=2}}if(!i)return null;this.sync(r);for(let o=0;o<i.length;o++)t=this.enterInner(i[o],null,t,!1);return t}insertNode(e,t,s){if(e.isInline&&this.needsBlock&&!this.top.type){let r=this.textblockFromContext();r&&(t=this.enterInner(r,null,t))}let i=this.findPlace(e,t,s);if(i){this.closeExtra();let r=this.top;r.match&&(r.match=r.match.matchType(e.type));let o=gn.none;for(let a of i.concat(e.marks))(r.type?r.type.allowsMarkType(a.type):nP(a.type,e.type))&&(o=a.addToSet(o));return r.content.push(e.mark(o)),!0}return!1}enter(e,t,s,i){let r=this.findPlace(e.create(t),s,!1);return r&&(r=this.enterInner(e,t,s,!0,i)),r}enterInner(e,t,s,i=!1,r){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=Zj(e,r,o.options);o.options&A0&&o.content.length==0&&(a|=A0);let l=gn.none;return s=s.filter(u=>(o.type?o.type.allowsMarkType(u.type):nP(u.type,e))?(l=u.addToSet(l),!1):!0),this.nodes.push(new Av(e,t,l,i,null,a)),this.open++,s}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=J0)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let s=this.nodes[t].content;for(let i=s.length-1;i>=0;i--)e+=s[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].node==e&&this.find[s].offset==t&&(this.find[s].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,s){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(s?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),s=this.options.context,i=!this.isOpen&&(!s||s.parent.type==this.nodes[0].type),r=-(s?s.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let u=t[a];if(u==""){if(a==t.length-1||a==0)continue;for(;l>=r;l--)if(o(a-1,l))return!0;return!1}else{let f=l>0||l==0&&i?this.nodes[l].type:s&&l>=r?s.node(l-r).type:null;if(!f||f.name!=u&&!f.isInGroup(u))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let s=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(s&&s.isTextblock&&s.defaultAttrs)return s}for(let t in this.parser.schema.nodes){let s=this.parser.schema.nodes[t];if(s.isTextblock&&s.defaultAttrs)return s}}}function PX(n){for(let e=n.firstChild,t=null;e;e=e.nextSibling){let s=e.nodeType==1?e.nodeName.toLowerCase():null;s&&R4.hasOwnProperty(s)&&t?(t.appendChild(e),e=t):s=="li"?t=e:s&&(t=null)}}function LX(n,e){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,e)}function tP(n){let e={};for(let t in n)e[t]=n[t];return e}function nP(n,e){let t=e.schema.nodes;for(let s in t){let i=t[s];if(!i.allowsMarkType(n))continue;let r=[],o=a=>{r.push(a);for(let l=0;l<a.edgeCount;l++){let{type:u,next:f}=a.edge(l);if(u==e||r.indexOf(f)<0&&o(f))return!0}};if(o(i.contentMatch))return!0}}class sf{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},s){s||(s=TA(t).createDocumentFragment());let i=s,r=[];return e.forEach(o=>{if(r.length||o.marks.length){let a=0,l=0;for(;a<r.length&&l<o.marks.length;){let u=o.marks[l];if(!this.marks[u.type.name]){l++;continue}if(!u.eq(r[a][0])||u.type.spec.spanning===!1)break;a++,l++}for(;a<r.length;)i=r.pop()[1];for(;l<o.marks.length;){let u=o.marks[l++],f=this.serializeMark(u,o.isInline,t);f&&(r.push([u,i]),i.appendChild(f.dom),i=f.contentDOM||f.dom)}}i.appendChild(this.serializeNodeInner(o,t))}),s}serializeNodeInner(e,t){let{dom:s,contentDOM:i}=Jv(TA(t),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,i)}return s}serializeNode(e,t={}){let s=this.serializeNodeInner(e,t);for(let i=e.marks.length-1;i>=0;i--){let r=this.serializeMark(e.marks[i],e.isInline,t);r&&((r.contentDOM||r.dom).appendChild(s),s=r.dom)}return s}serializeMark(e,t,s={}){let i=this.marks[e.type.name];return i&&Jv(TA(s),i(e,t),null,e.attrs)}static renderSpec(e,t,s=null,i){return Jv(e,t,s,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new sf(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=sP(e.nodes);return t.text||(t.text=s=>s.text),t}static marksFromSchema(e){return sP(e.marks)}}function sP(n){let e={};for(let t in n){let s=n[t].spec.toDOM;s&&(e[t]=s)}return e}function TA(n){return n.document||window.document}const iP=new WeakMap;function OX(n){let e=iP.get(n);return e===void 0&&iP.set(n,e=BX(n)),e}function BX(n){let e=null;function t(s){if(s&&typeof s=="object")if(Array.isArray(s))if(typeof s[0]=="string")e||(e=[]),e.push(s);else for(let i=0;i<s.length;i++)t(s[i]);else for(let i in s)t(s[i])}return t(n),e}function Jv(n,e,t,s){if(typeof e=="string")return{dom:n.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],r;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(s&&(r=OX(s))&&r.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=i.indexOf(" ");o>0&&(t=i.slice(0,o),i=i.slice(o+1));let a,l=t?n.createElementNS(t,i):n.createElement(i),u=e[1],f=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){f=2;for(let p in u)if(u[p]!=null){let g=p.indexOf(" ");g>0?l.setAttributeNS(p.slice(0,g),p.slice(g+1),u[p]):p=="style"&&l.style?l.style.cssText=u[p]:l.setAttribute(p,u[p])}}for(let p=f;p<e.length;p++){let g=e[p];if(g===0){if(p<e.length-1||p>f)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:b,contentDOM:w}=Jv(n,g,t,s);if(l.appendChild(b),w){if(a)throw new RangeError("Multiple content holes");a=w}}}return{dom:l,contentDOM:a}}const I4=65535,z4=Math.pow(2,16);function FX(n,e){return n+e*z4}function rP(n){return n&I4}function HX(n){return(n-(n&I4))/z4}const D4=1,j4=2,Xv=4,P4=8;class ZN{constructor(e,t,s){this.pos=e,this.delInfo=t,this.recover=s}get deleted(){return(this.delInfo&P4)>0}get deletedBefore(){return(this.delInfo&(D4|Xv))>0}get deletedAfter(){return(this.delInfo&(j4|Xv))>0}get deletedAcross(){return(this.delInfo&Xv)>0}}class _r{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&_r.empty)return _r.empty}recover(e){let t=0,s=rP(e);if(!this.inverted)for(let i=0;i<s;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[s*3]+t+HX(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,s){let i=0,r=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let u=this.ranges[a+r],f=this.ranges[a+o],p=l+u;if(e<=p){let g=u?e==l?-1:e==p?1:t:t,b=l+i+(g<0?0:f);if(s)return b;let w=e==(t<0?l:p)?null:FX(a/3,e-l),S=e==l?j4:e==p?D4:Xv;return(t<0?e!=l:e!=p)&&(S|=P4),new ZN(b,S,w)}i+=f-u}return s?e+i:new ZN(e+i,0,null)}touches(e,t){let s=0,i=rP(t),r=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>e)break;let u=this.ranges[a+r],f=l+u;if(e<=f&&a==i*3)return!0;s+=this.ranges[a+o]-u}return!1}forEach(e){let t=this.inverted?2:1,s=this.inverted?1:2;for(let i=0,r=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?r:0),l=o+(this.inverted?0:r),u=this.ranges[i+t],f=this.ranges[i+s];e(a,a+u,l,l+f),r+=f-u}}invert(){return new _r(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?_r.empty:new _r(e<0?[0,-e,0]:[0,0,e])}}_r.empty=new _r([]);class X0{constructor(e,t,s=0,i=e?e.length:0){this.mirror=t,this.from=s,this.to=i,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new X0(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,s=this._maps.length;t<e._maps.length;t++){let i=e.getMirror(t);this.appendMap(e._maps[t],i!=null&&i<t?s+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,s=this._maps.length+e._maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e._maps[t].invert(),i!=null&&i>t?s-i-1:void 0)}}invert(){let e=new X0;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let s=this.from;s<this.to;s++)e=this._maps[s].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,s){let i=0;for(let r=this.from;r<this.to;r++){let o=this._maps[r],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(r);if(l!=null&&l>r&&l<this.to){r=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return s?e:new ZN(e,i,null)}}const _A=Object.create(null);class ki{getMap(){return _r.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let s=_A[t.stepType];if(!s)throw new RangeError(`No step type ${t.stepType} defined`);return s.fromJSON(e,t)}static jsonID(e,t){if(e in _A)throw new RangeError("Duplicate use of step JSON ID "+e);return _A[e]=t,t.prototype.jsonID=e,t}}class gs{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new gs(e,null)}static fail(e){return new gs(null,e)}static fromReplace(e,t,s,i){try{return gs.ok(e.replace(t,s,i))}catch(r){if(r instanceof tk)return gs.fail(r.message);throw r}}}function M_(n,e,t){let s=[];for(let i=0;i<n.childCount;i++){let r=n.child(i);r.content.size&&(r=r.copy(M_(r.content,e,r))),r.isInline&&(r=e(r,t,i)),s.push(r)}return Ie.fromArray(s)}class Ed extends ki{constructor(e,t,s){super(),this.from=e,this.to=t,this.mark=s}apply(e){let t=e.slice(this.from,this.to),s=e.resolve(this.from),i=s.node(s.sharedDepth(this.to)),r=new Ve(M_(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return gs.fromReplace(e,this.from,this.to,r)}invert(){return new Ra(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return t.deleted&&s.deleted||t.pos>=s.pos?null:new Ed(t.pos,s.pos,this.mark)}merge(e){return e instanceof Ed&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ed(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Ed(t.from,t.to,e.markFromJSON(t.mark))}}ki.jsonID("addMark",Ed);class Ra extends ki{constructor(e,t,s){super(),this.from=e,this.to=t,this.mark=s}apply(e){let t=e.slice(this.from,this.to),s=new Ve(M_(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return gs.fromReplace(e,this.from,this.to,s)}invert(){return new Ed(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return t.deleted&&s.deleted||t.pos>=s.pos?null:new Ra(t.pos,s.pos,this.mark)}merge(e){return e instanceof Ra&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ra(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Ra(t.from,t.to,e.markFromJSON(t.mark))}}ki.jsonID("removeMark",Ra);class Td extends ki{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return gs.fail("No node at mark step's position");let s=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return gs.fromReplace(e,this.pos,this.pos+1,new Ve(Ie.from(s),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let s=this.mark.addToSet(t.marks);if(s.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(s))return new Td(this.pos,t.marks[i]);return new Td(this.pos,this.mark)}}return new Gh(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Td(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Td(t.pos,e.markFromJSON(t.mark))}}ki.jsonID("addNodeMark",Td);class Gh extends ki{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return gs.fail("No node at mark step's position");let s=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return gs.fromReplace(e,this.pos,this.pos+1,new Ve(Ie.from(s),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new Td(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Gh(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Gh(t.pos,e.markFromJSON(t.mark))}}ki.jsonID("removeNodeMark",Gh);class Bs extends ki{constructor(e,t,s,i=!1){super(),this.from=e,this.to=t,this.slice=s,this.structure=i}apply(e){return this.structure&&eE(e,this.from,this.to)?gs.fail("Structure replace would overwrite content"):gs.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new _r([this.from,this.to-this.from,this.slice.size])}invert(e){return new Bs(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return t.deletedAcross&&s.deletedAcross?null:new Bs(t.pos,Math.max(t.pos,s.pos),this.slice,this.structure)}merge(e){if(!(e instanceof Bs)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?Ve.empty:new Ve(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Bs(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?Ve.empty:new Ve(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Bs(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Bs(t.from,t.to,Ve.fromJSON(e,t.slice),!!t.structure)}}ki.jsonID("replace",Bs);class Hs extends ki{constructor(e,t,s,i,r,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=s,this.gapTo=i,this.slice=r,this.insert=o,this.structure=a}apply(e){if(this.structure&&(eE(e,this.from,this.gapFrom)||eE(e,this.gapTo,this.to)))return gs.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return gs.fail("Gap is not a flat range");let s=this.slice.insertAt(this.insert,t.content);return s?gs.fromReplace(e,this.from,this.to,s):gs.fail("Content does not fit in gap")}getMap(){return new _r([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Hs(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),s=e.mapResult(this.to,-1),i=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),r=this.to==this.gapTo?s.pos:e.map(this.gapTo,1);return t.deletedAcross&&s.deletedAcross||i<t.pos||r>s.pos?null:new Hs(t.pos,s.pos,i,r,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Hs(t.from,t.to,t.gapFrom,t.gapTo,Ve.fromJSON(e,t.slice),t.insert,!!t.structure)}}ki.jsonID("replaceAround",Hs);function eE(n,e,t){let s=n.resolve(e),i=t-e,r=s.depth;for(;i>0&&r>0&&s.indexAfter(r)==s.node(r).childCount;)r--,i--;if(i>0){let o=s.node(r).maybeChild(s.indexAfter(r));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function UX(n,e,t,s){let i=[],r=[],o,a;n.doc.nodesBetween(e,t,(l,u,f)=>{if(!l.isInline)return;let p=l.marks;if(!s.isInSet(p)&&f.type.allowsMarkType(s.type)){let g=Math.max(u,e),b=Math.min(u+l.nodeSize,t),w=s.addToSet(p);for(let S=0;S<p.length;S++)p[S].isInSet(w)||(o&&o.to==g&&o.mark.eq(p[S])?o.to=b:i.push(o=new Ra(g,b,p[S])));a&&a.to==g?a.to=b:r.push(a=new Ed(g,b,s))}}),i.forEach(l=>n.step(l)),r.forEach(l=>n.step(l))}function $X(n,e,t,s){let i=[],r=0;n.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;r++;let l=null;if(s instanceof RS){let u=o.marks,f;for(;f=s.isInSet(u);)(l||(l=[])).push(f),u=f.removeFromSet(u)}else s?s.isInSet(o.marks)&&(l=[s]):l=o.marks;if(l&&l.length){let u=Math.min(a+o.nodeSize,t);for(let f=0;f<l.length;f++){let p=l[f],g;for(let b=0;b<i.length;b++){let w=i[b];w.step==r-1&&p.eq(i[b].style)&&(g=w)}g?(g.to=u,g.step=r):i.push({style:p,from:Math.max(a,e),to:u,step:r})}}}),i.forEach(o=>n.step(new Ra(o.from,o.to,o.style)))}function R_(n,e,t,s=t.contentMatch,i=!0){let r=n.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<r.childCount;l++){let u=r.child(l),f=a+u.nodeSize,p=s.matchType(u.type);if(!p)o.push(new Bs(a,f,Ve.empty));else{s=p;for(let g=0;g<u.marks.length;g++)t.allowsMarkType(u.marks[g].type)||n.step(new Ra(a,f,u.marks[g]));if(i&&u.isText&&t.whitespace!="pre"){let g,b=/\r?\n|\r/g,w;for(;g=b.exec(u.text);)w||(w=new Ve(Ie.from(t.schema.text(" ",t.allowedMarks(u.marks))),0,0)),o.push(new Bs(a+g.index,a+g.index+g[0].length,w))}}a=f}if(!s.validEnd){let l=s.fillBefore(Ie.empty,!0);n.replace(a,a,new Ve(l,0,0))}for(let l=o.length-1;l>=0;l--)n.step(o[l])}function GX(n,e,t){return(e==0||n.canReplace(e,n.childCount))&&(t==n.childCount||n.canReplace(0,t))}function Gm(n){let t=n.parent.content.cutByIndex(n.startIndex,n.endIndex);for(let s=n.depth,i=0,r=0;;--s){let o=n.$from.node(s),a=n.$from.index(s)+i,l=n.$to.indexAfter(s)-r;if(s<n.depth&&o.canReplace(a,l,t))return s;if(s==0||o.type.spec.isolating||!GX(o,a,l))break;a&&(i=1),l<o.childCount&&(r=1)}return null}function VX(n,e,t){let{$from:s,$to:i,depth:r}=e,o=s.before(r+1),a=i.after(r+1),l=o,u=a,f=Ie.empty,p=0;for(let w=r,S=!1;w>t;w--)S||s.index(w)>0?(S=!0,f=Ie.from(s.node(w).copy(f)),p++):l--;let g=Ie.empty,b=0;for(let w=r,S=!1;w>t;w--)S||i.after(w+1)<i.end(w)?(S=!0,g=Ie.from(i.node(w).copy(g)),b++):u++;n.step(new Hs(l,u,o,a,new Ve(f.append(g),p,b),f.size-p,!0))}function I_(n,e,t=null,s=n){let i=qX(n,e),r=i&&WX(s,e);return r?i.map(oP).concat({type:e,attrs:t}).concat(r.map(oP)):null}function oP(n){return{type:n,attrs:null}}function qX(n,e){let{parent:t,startIndex:s,endIndex:i}=n,r=t.contentMatchAt(s).findWrapping(e);if(!r)return null;let o=r.length?r[0]:e;return t.canReplaceWith(s,i,o)?r:null}function WX(n,e){let{parent:t,startIndex:s,endIndex:i}=n,r=t.child(s),o=e.contentMatch.findWrapping(r.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let u=s;l&&u<i;u++)l=l.matchType(t.child(u).type);return!l||!l.validEnd?null:o}function KX(n,e,t){let s=Ie.empty;for(let o=t.length-1;o>=0;o--){if(s.size){let a=t[o].type.contentMatch.matchFragment(s);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=Ie.from(t[o].type.create(t[o].attrs,s))}let i=e.start,r=e.end;n.step(new Hs(i,r,i,r,new Ve(s,0,0),t.length,!0))}function YX(n,e,t,s,i){if(!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let r=n.steps.length;n.doc.nodesBetween(e,t,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(s,l)&&JX(n.doc,n.mapping.slice(r).map(a),s)){let u=null;if(s.schema.linebreakReplacement){let b=s.whitespace=="pre",w=!!s.contentMatch.matchType(s.schema.linebreakReplacement);b&&!w?u=!1:!b&&w&&(u=!0)}u===!1&&O4(n,o,a,r),R_(n,n.mapping.slice(r).map(a,1),s,void 0,u===null);let f=n.mapping.slice(r),p=f.map(a,1),g=f.map(a+o.nodeSize,1);return n.step(new Hs(p,g,p+1,g-1,new Ve(Ie.from(s.create(l,null,o.marks)),0,0),1,!0)),u===!0&&L4(n,o,a,r),!1}})}function L4(n,e,t,s){e.forEach((i,r)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=n.mapping.slice(s).map(t+1+r+o.index);n.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function O4(n,e,t,s){e.forEach((i,r)=>{if(i.type==i.type.schema.linebreakReplacement){let o=n.mapping.slice(s).map(t+1+r);n.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function JX(n,e,t){let s=n.resolve(e),i=s.index();return s.parent.canReplaceWith(i,i+1,t)}function XX(n,e,t,s,i){let r=n.doc.nodeAt(e);if(!r)throw new RangeError("No node at given position");t||(t=r.type);let o=t.create(s,null,i||r.marks);if(r.isLeaf)return n.replaceWith(e,e+r.nodeSize,o);if(!t.validContent(r.content))throw new RangeError("Invalid content for node type "+t.name);n.step(new Hs(e,e+r.nodeSize,e+1,e+r.nodeSize-1,new Ve(Ie.from(o),0,0),1,!0))}function ql(n,e,t=1,s){let i=n.resolve(e),r=i.depth-t,o=s&&s[s.length-1]||i.parent;if(r<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let u=i.depth-1,f=t-2;u>r;u--,f--){let p=i.node(u),g=i.index(u);if(p.type.spec.isolating)return!1;let b=p.content.cutByIndex(g,p.childCount),w=s&&s[f+1];w&&(b=b.replaceChild(0,w.type.create(w.attrs)));let S=s&&s[f]||p;if(!p.canReplace(g+1,p.childCount)||!S.type.validContent(b))return!1}let a=i.indexAfter(r),l=s&&s[0];return i.node(r).canReplaceWith(a,a,l?l.type:i.node(r+1).type)}function QX(n,e,t=1,s){let i=n.doc.resolve(e),r=Ie.empty,o=Ie.empty;for(let a=i.depth,l=i.depth-t,u=t-1;a>l;a--,u--){r=Ie.from(i.node(a).copy(r));let f=s&&s[u];o=Ie.from(f?f.type.create(f.attrs,o):i.node(a).copy(o))}n.step(new Bs(e,e,new Ve(r.append(o),t,t),!0))}function $d(n,e){let t=n.resolve(e),s=t.index();return B4(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(s,s+1)}function ZX(n,e){e.content.size||n.type.compatibleContent(e.type);let t=n.contentMatchAt(n.childCount),{linebreakReplacement:s}=n.type.schema;for(let i=0;i<e.childCount;i++){let r=e.child(i),o=r.type==s?n.type.schema.nodes.text:r.type;if(t=t.matchType(o),!t||!n.type.allowsMarks(r.marks))return!1}return t.validEnd}function B4(n,e){return!!(n&&e&&!n.isLeaf&&ZX(n,e))}function IS(n,e,t=-1){let s=n.resolve(e);for(let i=s.depth;;i--){let r,o,a=s.index(i);if(i==s.depth?(r=s.nodeBefore,o=s.nodeAfter):t>0?(r=s.node(i+1),a++,o=s.node(i).maybeChild(a)):(r=s.node(i).maybeChild(a-1),o=s.node(i+1)),r&&!r.isTextblock&&B4(r,o)&&s.node(i).canReplace(a,a+1))return e;if(i==0)break;e=t<0?s.before(i):s.after(i)}}function eQ(n,e,t){let s=null,{linebreakReplacement:i}=n.doc.type.schema,r=n.doc.resolve(e-t),o=r.node().type;if(i&&o.inlineContent){let f=o.whitespace=="pre",p=!!o.contentMatch.matchType(i);f&&!p?s=!1:!f&&p&&(s=!0)}let a=n.steps.length;if(s===!1){let f=n.doc.resolve(e+t);O4(n,f.node(),f.before(),a)}o.inlineContent&&R_(n,e+t-1,o,r.node().contentMatchAt(r.index()),s==null);let l=n.mapping.slice(a),u=l.map(e-t);if(n.step(new Bs(u,l.map(e+t,-1),Ve.empty,!0)),s===!0){let f=n.doc.resolve(u);L4(n,f.node(),f.before(),n.steps.length)}return n}function tQ(n,e,t){let s=n.resolve(e);if(s.parent.canReplaceWith(s.index(),s.index(),t))return e;if(s.parentOffset==0)for(let i=s.depth-1;i>=0;i--){let r=s.index(i);if(s.node(i).canReplaceWith(r,r,t))return s.before(i+1);if(r>0)return null}if(s.parentOffset==s.parent.content.size)for(let i=s.depth-1;i>=0;i--){let r=s.indexAfter(i);if(s.node(i).canReplaceWith(r,r,t))return s.after(i+1);if(r<s.node(i).childCount)return null}return null}function F4(n,e,t){let s=n.resolve(e);if(!t.content.size)return e;let i=t.content;for(let r=0;r<t.openStart;r++)i=i.firstChild.content;for(let r=1;r<=(t.openStart==0&&t.size?2:1);r++)for(let o=s.depth;o>=0;o--){let a=o==s.depth?0:s.pos<=(s.start(o+1)+s.end(o+1))/2?-1:1,l=s.index(o)+(a>0?1:0),u=s.node(o),f=!1;if(r==1)f=u.canReplace(l,l,i);else{let p=u.contentMatchAt(l).findWrapping(i.firstChild.type);f=p&&u.canReplaceWith(l,l,p[0])}if(f)return a==0?s.pos:a<0?s.before(o+1):s.after(o+1)}return null}function zS(n,e,t=e,s=Ve.empty){if(e==t&&!s.size)return null;let i=n.resolve(e),r=n.resolve(t);return H4(i,r,s)?new Bs(e,t,s):new nQ(i,r,s).fit()}function H4(n,e,t){return!t.openStart&&!t.openEnd&&n.start()==e.start()&&n.parent.canReplace(n.index(),e.index(),t.content)}class nQ{constructor(e,t,s){this.$from=e,this.$to=t,this.unplaced=s,this.frontier=[],this.placed=Ie.empty;for(let i=0;i<=e.depth;i++){let r=e.node(i);this.frontier.push({type:r.type,match:r.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=Ie.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,s=this.$from,i=this.close(e<0?this.$to:s.doc.resolve(e));if(!i)return null;let r=this.placed,o=s.depth,a=i.depth;for(;o&&a&&r.childCount==1;)r=r.firstChild.content,o--,a--;let l=new Ve(r,o,a);return e>-1?new Hs(s.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||s.pos!=this.$to.pos?new Bs(s.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,s=0,i=this.unplaced.openEnd;s<e;s++){let r=t.firstChild;if(t.childCount>1&&(i=0),r.type.spec.isolating&&i<=s){e=s;break}t=r.content}for(let t=1;t<=2;t++)for(let s=t==1?e:this.unplaced.openStart;s>=0;s--){let i,r=null;s?(r=MA(this.unplaced.content,s-1).firstChild,i=r.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:u}=this.frontier[a],f,p=null;if(t==1&&(o?u.matchType(o.type)||(p=u.fillBefore(Ie.from(o),!1)):r&&l.compatibleContent(r.type)))return{sliceDepth:s,frontierDepth:a,parent:r,inject:p};if(t==2&&o&&(f=u.findWrapping(o.type)))return{sliceDepth:s,frontierDepth:a,parent:r,wrap:f};if(r&&u.matchType(r.type))break}}}openMore(){let{content:e,openStart:t,openEnd:s}=this.unplaced,i=MA(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Ve(e,t+1,Math.max(s,i.size+t>=e.size-s?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:s}=this.unplaced,i=MA(e,t);if(i.childCount<=1&&t>0){let r=e.size-t<=t+i.size;this.unplaced=new Ve(e0(e,t-1,1),t-1,r?t-1:s)}else this.unplaced=new Ve(e0(e,t,1),t,s)}placeNodes({sliceDepth:e,frontierDepth:t,parent:s,inject:i,wrap:r}){for(;this.depth>t;)this.closeFrontierNode();if(r)for(let S=0;S<r.length;S++)this.openFrontierNode(r[S]);let o=this.unplaced,a=s?s.content:o.content,l=o.openStart-e,u=0,f=[],{match:p,type:g}=this.frontier[t];if(i){for(let S=0;S<i.childCount;S++)f.push(i.child(S));p=p.matchFragment(i)}let b=a.size+e-(o.content.size-o.openEnd);for(;u<a.childCount;){let S=a.child(u),N=p.matchType(S.type);if(!N)break;u++,(u>1||l==0||S.content.size)&&(p=N,f.push(U4(S.mark(g.allowedMarks(S.marks)),u==1?l:0,u==a.childCount?b:-1)))}let w=u==a.childCount;w||(b=-1),this.placed=t0(this.placed,t,Ie.from(f)),this.frontier[t].match=p,w&&b<0&&s&&s.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let S=0,N=a;S<b;S++){let C=N.lastChild;this.frontier.push({type:C.type,match:C.contentMatchAt(C.childCount)}),N=C.content}this.unplaced=w?e==0?Ve.empty:new Ve(e0(o.content,e-1,1),e-1,b<0?o.openEnd:e-1):new Ve(e0(o.content,e,u),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!RA(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:s}=this.$to,i=this.$to.after(s);for(;s>1&&i==this.$to.end(--s);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:s,type:i}=this.frontier[t],r=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=RA(e,t,i,s,r);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:u}=this.frontier[a],f=RA(e,a,u,l,!0);if(!f||f.childCount)continue e}return{depth:t,fit:o,move:r?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=t0(this.placed,t.depth,t.fit)),e=t.move;for(let s=t.depth+1;s<=e.depth;s++){let i=e.node(s),r=i.type.contentMatch.fillBefore(i.content,!0,e.index(s));this.openFrontierNode(i.type,i.attrs,r)}return e}openFrontierNode(e,t=null,s){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=t0(this.placed,this.depth,Ie.from(e.create(t,s))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(Ie.empty,!0);t.childCount&&(this.placed=t0(this.placed,this.frontier.length,t))}}function e0(n,e,t){return e==0?n.cutByIndex(t,n.childCount):n.replaceChild(0,n.firstChild.copy(e0(n.firstChild.content,e-1,t)))}function t0(n,e,t){return e==0?n.append(t):n.replaceChild(n.childCount-1,n.lastChild.copy(t0(n.lastChild.content,e-1,t)))}function MA(n,e){for(let t=0;t<e;t++)n=n.firstChild.content;return n}function U4(n,e,t){if(e<=0)return n;let s=n.content;return e>1&&(s=s.replaceChild(0,U4(s.firstChild,e-1,s.childCount==1?t-1:0))),e>0&&(s=n.type.contentMatch.fillBefore(s).append(s),t<=0&&(s=s.append(n.type.contentMatch.matchFragment(s).fillBefore(Ie.empty,!0)))),n.copy(s)}function RA(n,e,t,s,i){let r=n.node(e),o=i?n.indexAfter(e):n.index(e);if(o==r.childCount&&!t.compatibleContent(r.type))return null;let a=s.fillBefore(r.content,!0,o);return a&&!sQ(t,r.content,o)?a:null}function sQ(n,e,t){for(let s=t;s<e.childCount;s++)if(!n.allowsMarks(e.child(s).marks))return!0;return!1}function iQ(n){return n.spec.defining||n.spec.definingForContent}function rQ(n,e,t,s){if(!s.size)return n.deleteRange(e,t);let i=n.doc.resolve(e),r=n.doc.resolve(t);if(H4(i,r,s))return n.step(new Bs(e,t,s));let o=G4(i,r);o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let g=i.depth,b=i.pos-1;g>0;g--,b--){let w=i.node(g).type.spec;if(w.defining||w.definingAsContext||w.isolating)break;o.indexOf(g)>-1?a=g:i.before(g)==b&&o.splice(1,0,-g)}let l=o.indexOf(a),u=[],f=s.openStart;for(let g=s.content,b=0;;b++){let w=g.firstChild;if(u.push(w),b==s.openStart)break;g=w.content}for(let g=f-1;g>=0;g--){let b=u[g],w=iQ(b.type);if(w&&!b.sameMarkup(i.node(Math.abs(a)-1)))f=g;else if(w||!b.type.isTextblock)break}for(let g=s.openStart;g>=0;g--){let b=(g+f+1)%(s.openStart+1),w=u[b];if(w)for(let S=0;S<o.length;S++){let N=o[(S+l)%o.length],C=!0;N<0&&(C=!1,N=-N);let M=i.node(N-1),R=i.index(N-1);if(M.canReplaceWith(R,R,w.type,w.marks))return n.replace(i.before(N),C?r.after(N):t,new Ve($4(s.content,0,s.openStart,b),b,s.openEnd))}}let p=n.steps.length;for(let g=o.length-1;g>=0&&(n.replace(e,t,s),!(n.steps.length>p));g--){let b=o[g];b<0||(e=i.before(b),t=r.after(b))}}function $4(n,e,t,s,i){if(e<t){let r=n.firstChild;n=n.replaceChild(0,r.copy($4(r.content,e+1,t,s,r)))}if(e>s){let r=i.contentMatchAt(0),o=r.fillBefore(n).append(n);n=o.append(r.matchFragment(o).fillBefore(Ie.empty,!0))}return n}function oQ(n,e,t,s){if(!s.isInline&&e==t&&n.doc.resolve(e).parent.content.size){let i=tQ(n.doc,e,s.type);i!=null&&(e=t=i)}n.replaceRange(e,t,new Ve(Ie.from(s),0,0))}function aQ(n,e,t){let s=n.doc.resolve(e),i=n.doc.resolve(t),r=G4(s,i);for(let o=0;o<r.length;o++){let a=r[o],l=o==r.length-1;if(l&&a==0||s.node(a).type.contentMatch.validEnd)return n.delete(s.start(a),i.end(a));if(a>0&&(l||s.node(a-1).canReplace(s.index(a-1),i.indexAfter(a-1))))return n.delete(s.before(a),i.after(a))}for(let o=1;o<=s.depth&&o<=i.depth;o++)if(e-s.start(o)==s.depth-o&&t>s.end(o)&&i.end(o)-t!=i.depth-o&&s.start(o-1)==i.start(o-1)&&s.node(o-1).canReplace(s.index(o-1),i.index(o-1)))return n.delete(s.before(o),t);n.delete(e,t)}function G4(n,e){let t=[],s=Math.min(n.depth,e.depth);for(let i=s;i>=0;i--){let r=n.start(i);if(r<n.pos-(n.depth-i)||e.end(i)>e.pos+(e.depth-i)||n.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(r==e.start(i)||i==n.depth&&i==e.depth&&n.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==r-1)&&t.push(i)}return t}class xp extends ki{constructor(e,t,s){super(),this.pos=e,this.attr=t,this.value=s}apply(e){let t=e.nodeAt(this.pos);if(!t)return gs.fail("No node at attribute step's position");let s=Object.create(null);for(let r in t.attrs)s[r]=t.attrs[r];s[this.attr]=this.value;let i=t.type.create(s,null,t.marks);return gs.fromReplace(e,this.pos,this.pos+1,new Ve(Ie.from(i),0,t.isLeaf?0:1))}getMap(){return _r.empty}invert(e){return new xp(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new xp(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new xp(t.pos,t.attr,t.value)}}ki.jsonID("attr",xp);class Q0 extends ki{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let s=e.type.create(t,e.content,e.marks);return gs.ok(s)}getMap(){return _r.empty}invert(e){return new Q0(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Q0(t.attr,t.value)}}ki.jsonID("docAttr",Q0);let Tm=class extends Error{};Tm=function n(e){let t=Error.call(this,e);return t.__proto__=n.prototype,t};Tm.prototype=Object.create(Error.prototype);Tm.prototype.constructor=Tm;Tm.prototype.name="TransformError";class z_{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new X0}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Tm(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,s=Ve.empty){let i=zS(this.doc,e,t,s);return i&&this.step(i),this}replaceWith(e,t,s){return this.replace(e,t,new Ve(Ie.from(s),0,0))}delete(e,t){return this.replace(e,t,Ve.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,s){return rQ(this,e,t,s),this}replaceRangeWith(e,t,s){return oQ(this,e,t,s),this}deleteRange(e,t){return aQ(this,e,t),this}lift(e,t){return VX(this,e,t),this}join(e,t=1){return eQ(this,e,t),this}wrap(e,t){return KX(this,e,t),this}setBlockType(e,t=e,s,i=null){return YX(this,e,t,s,i),this}setNodeMarkup(e,t,s=null,i){return XX(this,e,t,s,i),this}setNodeAttribute(e,t,s){return this.step(new xp(e,t,s)),this}setDocAttribute(e,t){return this.step(new Q0(e,t)),this}addNodeMark(e,t){return this.step(new Td(e,t)),this}removeNodeMark(e,t){let s=this.doc.nodeAt(e);if(!s)throw new RangeError("No node at position "+e);if(t instanceof gn)t.isInSet(s.marks)&&this.step(new Gh(e,t));else{let i=s.marks,r,o=[];for(;r=t.isInSet(i);)o.push(new Gh(e,r)),i=r.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,s){return QX(this,e,t,s),this}addMark(e,t,s){return UX(this,e,t,s),this}removeMark(e,t,s){return $X(this,e,t,s),this}clearIncompatible(e,t,s){return R_(this,e,t,s),this}}const IA=Object.create(null);class mt{constructor(e,t,s){this.$anchor=e,this.$head=t,this.ranges=s||[new V4(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=Ve.empty){let s=t.content.lastChild,i=null;for(let a=0;a<t.openEnd;a++)i=s,s=s.lastChild;let r=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:u}=o[a],f=e.mapping.slice(r);e.replaceRange(f.map(l.pos),f.map(u.pos),a?Ve.empty:t),a==0&&cP(e,r,(s?s.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let s=e.steps.length,i=this.ranges;for(let r=0;r<i.length;r++){let{$from:o,$to:a}=i[r],l=e.mapping.slice(s),u=l.map(o.pos),f=l.map(a.pos);r?e.deleteRange(u,f):(e.replaceRangeWith(u,f,t),cP(e,s,t.isInline?-1:1))}}static findFrom(e,t,s=!1){let i=e.parent.inlineContent?new ut(e):Jf(e.node(0),e.parent,e.pos,e.index(),t,s);if(i)return i;for(let r=e.depth-1;r>=0;r--){let o=t<0?Jf(e.node(0),e.node(r),e.before(r+1),e.index(r),t,s):Jf(e.node(0),e.node(r),e.after(r+1),e.index(r)+1,t,s);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Ir(e.node(0))}static atStart(e){return Jf(e,e,0,0,1)||new Ir(e)}static atEnd(e){return Jf(e,e,e.content.size,e.childCount,-1)||new Ir(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let s=IA[t.type];if(!s)throw new RangeError(`No selection type ${t.type} defined`);return s.fromJSON(e,t)}static jsonID(e,t){if(e in IA)throw new RangeError("Duplicate use of selection JSON ID "+e);return IA[e]=t,t.prototype.jsonID=e,t}getBookmark(){return ut.between(this.$anchor,this.$head).getBookmark()}}mt.prototype.visible=!0;class V4{constructor(e,t){this.$from=e,this.$to=t}}let aP=!1;function lP(n){!aP&&!n.parent.inlineContent&&(aP=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}class ut extends mt{constructor(e,t=e){lP(e),lP(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let s=e.resolve(t.map(this.head));if(!s.parent.inlineContent)return mt.near(s);let i=e.resolve(t.map(this.anchor));return new ut(i.parent.inlineContent?i:s,s)}replace(e,t=Ve.empty){if(super.replace(e,t),t==Ve.empty){let s=this.$from.marksAcross(this.$to);s&&e.ensureMarks(s)}}eq(e){return e instanceof ut&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new DS(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new ut(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,s=t){let i=e.resolve(t);return new this(i,s==t?i:e.resolve(s))}static between(e,t,s){let i=e.pos-t.pos;if((!s||i)&&(s=i>=0?1:-1),!t.parent.inlineContent){let r=mt.findFrom(t,s,!0)||mt.findFrom(t,-s,!0);if(r)t=r.$head;else return mt.near(t,s)}return e.parent.inlineContent||(i==0?e=t:(e=(mt.findFrom(e,-s,!0)||mt.findFrom(e,s,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new ut(e,t)}}mt.jsonID("text",ut);class DS{constructor(e,t){this.anchor=e,this.head=t}map(e){return new DS(e.map(this.anchor),e.map(this.head))}resolve(e){return ut.between(e.resolve(this.anchor),e.resolve(this.head))}}class dt extends mt{constructor(e){let t=e.nodeAfter,s=e.node(0).resolve(e.pos+t.nodeSize);super(e,s),this.node=t}map(e,t){let{deleted:s,pos:i}=t.mapResult(this.anchor),r=e.resolve(i);return s?mt.near(r):new dt(r)}content(){return new Ve(Ie.from(this.node),0,0)}eq(e){return e instanceof dt&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new D_(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new dt(e.resolve(t.anchor))}static create(e,t){return new dt(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}dt.prototype.visible=!1;mt.jsonID("node",dt);class D_{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:s}=e.mapResult(this.anchor);return t?new DS(s,s):new D_(s)}resolve(e){let t=e.resolve(this.anchor),s=t.nodeAfter;return s&&dt.isSelectable(s)?new dt(t):mt.near(t)}}class Ir extends mt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=Ve.empty){if(t==Ve.empty){e.delete(0,e.doc.content.size);let s=mt.atStart(e.doc);s.eq(e.selection)||e.setSelection(s)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new Ir(e)}map(e){return new Ir(e)}eq(e){return e instanceof Ir}getBookmark(){return lQ}}mt.jsonID("all",Ir);const lQ={map(){return this},resolve(n){return new Ir(n)}};function Jf(n,e,t,s,i,r=!1){if(e.inlineContent)return ut.create(n,t);for(let o=s-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!r&&dt.isSelectable(a))return dt.create(n,t-(i<0?a.nodeSize:0))}else{let l=Jf(n,a,t+i,i<0?a.childCount:0,i,r);if(l)return l}t+=a.nodeSize*i}return null}function cP(n,e,t){let s=n.steps.length-1;if(s<e)return;let i=n.steps[s];if(!(i instanceof Bs||i instanceof Hs))return;let r=n.mapping.maps[s],o;r.forEach((a,l,u,f)=>{o==null&&(o=f)}),n.setSelection(mt.near(n.doc.resolve(o),t))}const dP=1,Nv=2,uP=4;class cQ extends z_{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|dP)&~Nv,this.storedMarks=null,this}get selectionSet(){return(this.updated&dP)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Nv,this}ensureMarks(e){return gn.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Nv)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~Nv,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let s=this.selection;return t&&(e=e.mark(this.storedMarks||(s.empty?s.$from.marks():s.$from.marksAcross(s.$to)||gn.none))),s.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,s){let i=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(s==null&&(s=t),!e)return this.deleteRange(t,s);let r=this.storedMarks;if(!r){let o=this.doc.resolve(t);r=s==t?o.marks():o.marksAcross(this.doc.resolve(s))}return this.replaceRangeWith(t,s,i.text(e,r)),!this.selection.empty&&this.selection.to==t+e.length&&this.setSelection(mt.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=uP,this}get scrolledIntoView(){return(this.updated&uP)>0}}function hP(n,e){return!e||!n?n:n.bind(e)}class n0{constructor(e,t,s){this.name=e,this.init=hP(t.init,s),this.apply=hP(t.apply,s)}}const dQ=[new n0("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new n0("selection",{init(n,e){return n.selection||mt.atStart(e.doc)},apply(n){return n.selection}}),new n0("storedMarks",{init(n){return n.storedMarks||null},apply(n,e,t,s){return s.selection.$cursor?n.storedMarks:null}}),new n0("scrollToSelection",{init(){return 0},apply(n,e){return n.scrolledIntoView?e+1:e}})];class zA{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=dQ.slice(),t&&t.forEach(s=>{if(this.pluginsByKey[s.key])throw new RangeError("Adding different instances of a keyed plugin ("+s.key+")");this.plugins.push(s),this.pluginsByKey[s.key]=s,s.spec.state&&this.fields.push(new n0(s.key,s.spec.state,s))})}}class dp{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let s=0;s<this.config.plugins.length;s++)if(s!=t){let i=this.config.plugins[s];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],s=this.applyInner(e),i=null;for(;;){let r=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=i?i[o].n:0,u=i?i[o].state:this,f=l<t.length&&a.spec.appendTransaction.call(a,l?t.slice(l):t,u,s);if(f&&s.filterTransaction(f,o)){if(f.setMeta("appendedTransaction",e),!i){i=[];for(let p=0;p<this.config.plugins.length;p++)i.push(p<o?{state:s,n:t.length}:{state:this,n:0})}t.push(f),s=s.applyInner(f),r=!0}i&&(i[o]={state:s,n:t.length})}}if(!r)return{state:s,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new dp(this.config),s=this.config.fields;for(let i=0;i<s.length;i++){let r=s[i];t[r.name]=r.apply(e,this[r.name],this,t)}return t}get tr(){return new cQ(this)}static create(e){let t=new zA(e.doc?e.doc.type.schema:e.schema,e.plugins),s=new dp(t);for(let i=0;i<t.fields.length;i++)s[t.fields[i].name]=t.fields[i].init(e,s);return s}reconfigure(e){let t=new zA(this.schema,e.plugins),s=t.fields,i=new dp(t);for(let r=0;r<s.length;r++){let o=s[r].name;i[o]=this.hasOwnProperty(o)?this[o]:s[r].init(e,i)}return i}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(s=>s.toJSON())),e&&typeof e=="object")for(let s in e){if(s=="doc"||s=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[s],r=i.spec.state;r&&r.toJSON&&(t[s]=r.toJSON.call(i,this[i.key]))}return t}static fromJSON(e,t,s){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new zA(e.schema,e.plugins),r=new dp(i);return i.fields.forEach(o=>{if(o.name=="doc")r.doc=Rd.fromJSON(e.schema,t.doc);else if(o.name=="selection")r.selection=mt.fromJSON(r.doc,t.selection);else if(o.name=="storedMarks")t.storedMarks&&(r.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(s)for(let a in s){let l=s[a],u=l.spec.state;if(l.key==o.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(t,a)){r[o.name]=u.fromJSON.call(l,e,t[a],r);return}}r[o.name]=o.init(e,r)}}),r}}function q4(n,e,t){for(let s in n){let i=n[s];i instanceof Function?i=i.bind(e):s=="handleDOMEvents"&&(i=q4(i,e,{})),t[s]=i}return t}class Jn{constructor(e){this.spec=e,this.props={},e.props&&q4(e.props,this,this.props),this.key=e.key?e.key.key:W4("plugin")}getState(e){return e[this.key]}}const DA=Object.create(null);function W4(n){return n in DA?n+"$"+ ++DA[n]:(DA[n]=0,n+"$")}class Ts{constructor(e="key"){this.key=W4(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const si=function(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e},_m=function(n){let e=n.assignedSlot||n.parentNode;return e&&e.nodeType==11?e.host:e};let tE=null;const fl=function(n,e,t){let s=tE||(tE=document.createRange());return s.setEnd(n,t??n.nodeValue.length),s.setStart(n,e||0),s},uQ=function(){tE=null},Vh=function(n,e,t,s){return t&&(fP(n,e,t,s,-1)||fP(n,e,t,s,1))},hQ=/^(img|br|input|textarea|hr)$/i;function fP(n,e,t,s,i){for(var r;;){if(n==t&&e==s)return!0;if(e==(i<0?0:so(n))){let o=n.parentNode;if(!o||o.nodeType!=1||Hb(n)||hQ.test(n.nodeName)||n.contentEditable=="false")return!1;e=si(n)+(i<0?0:1),n=o}else if(n.nodeType==1){let o=n.childNodes[e+(i<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((r=o.pmViewDesc)===null||r===void 0)&&r.ignoreForSelection)e+=i;else return!1;else n=o,e=i<0?so(n):0}else return!1}}function so(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function fQ(n,e){for(;;){if(n.nodeType==3&&e)return n;if(n.nodeType==1&&e>0){if(n.contentEditable=="false")return null;n=n.childNodes[e-1],e=so(n)}else if(n.parentNode&&!Hb(n))e=si(n),n=n.parentNode;else return null}}function pQ(n,e){for(;;){if(n.nodeType==3&&e<n.nodeValue.length)return n;if(n.nodeType==1&&e<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[e],e=0}else if(n.parentNode&&!Hb(n))e=si(n)+1,n=n.parentNode;else return null}}function mQ(n,e,t){for(let s=e==0,i=e==so(n);s||i;){if(n==t)return!0;let r=si(n);if(n=n.parentNode,!n)return!1;s=s&&r==0,i=i&&r==so(n)}}function Hb(n){let e;for(let t=n;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==n||e.contentDOM==n)}const jS=function(n){return n.focusNode&&Vh(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)};function ku(n,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=n,t.key=t.code=e,t}function gQ(n){let e=n.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function xQ(n,e,t){if(n.caretPositionFromPoint)try{let s=n.caretPositionFromPoint(e,t);if(s)return{node:s.offsetNode,offset:Math.min(so(s.offsetNode),s.offset)}}catch{}if(n.caretRangeFromPoint){let s=n.caretRangeFromPoint(e,t);if(s)return{node:s.startContainer,offset:Math.min(so(s.startContainer),s.startOffset)}}}const Da=typeof navigator<"u"?navigator:null,pP=typeof document<"u"?document:null,Gd=Da&&Da.userAgent||"",nE=/Edge\/(\d+)/.exec(Gd),K4=/MSIE \d/.exec(Gd),sE=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Gd),er=!!(K4||sE||nE),Id=K4?document.documentMode:sE?+sE[1]:nE?+nE[1]:0,lo=!er&&/gecko\/(\d+)/i.test(Gd);lo&&+(/Firefox\/(\d+)/.exec(Gd)||[0,0])[1];const iE=!er&&/Chrome\/(\d+)/.exec(Gd),Fs=!!iE,Y4=iE?+iE[1]:0,vi=!er&&!!Da&&/Apple Computer/.test(Da.vendor),Mm=vi&&(/Mobile\/\w+/.test(Gd)||!!Da&&Da.maxTouchPoints>2),no=Mm||(Da?/Mac/.test(Da.platform):!1),J4=Da?/Win/.test(Da.platform):!1,$l=/Android \d/.test(Gd),Ub=!!pP&&"webkitFontSmoothing"in pP.documentElement.style,bQ=Ub?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function yQ(n){let e=n.defaultView&&n.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function rl(n,e){return typeof n=="number"?n:n[e]}function vQ(n){let e=n.getBoundingClientRect(),t=e.width/n.offsetWidth||1,s=e.height/n.offsetHeight||1;return{left:e.left,right:e.left+n.clientWidth*t,top:e.top,bottom:e.top+n.clientHeight*s}}function mP(n,e,t){let s=n.someProp("scrollThreshold")||0,i=n.someProp("scrollMargin")||5,r=n.dom.ownerDocument;for(let o=t||n.dom;o;){if(o.nodeType!=1){o=_m(o);continue}let a=o,l=a==r.body,u=l?yQ(r):vQ(a),f=0,p=0;if(e.top<u.top+rl(s,"top")?p=-(u.top-e.top+rl(i,"top")):e.bottom>u.bottom-rl(s,"bottom")&&(p=e.bottom-e.top>u.bottom-u.top?e.top+rl(i,"top")-u.top:e.bottom-u.bottom+rl(i,"bottom")),e.left<u.left+rl(s,"left")?f=-(u.left-e.left+rl(i,"left")):e.right>u.right-rl(s,"right")&&(f=e.right-u.right+rl(i,"right")),f||p)if(l)r.defaultView.scrollBy(f,p);else{let b=a.scrollLeft,w=a.scrollTop;p&&(a.scrollTop+=p),f&&(a.scrollLeft+=f);let S=a.scrollLeft-b,N=a.scrollTop-w;e={left:e.left-S,top:e.top-N,right:e.right-S,bottom:e.bottom-N}}let g=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(g))break;o=g=="absolute"?o.offsetParent:_m(o)}}function wQ(n){let e=n.dom.getBoundingClientRect(),t=Math.max(0,e.top),s,i;for(let r=(e.left+e.right)/2,o=t+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=n.root.elementFromPoint(r,o);if(!a||a==n.dom||!n.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=t-20){s=a,i=l.top;break}}return{refDOM:s,refTop:i,stack:X4(n.dom)}}function X4(n){let e=[],t=n.ownerDocument;for(let s=n;s&&(e.push({dom:s,top:s.scrollTop,left:s.scrollLeft}),n!=t);s=_m(s));return e}function kQ({refDOM:n,refTop:e,stack:t}){let s=n?n.getBoundingClientRect().top:0;Q4(t,s==0?0:s-e)}function Q4(n,e){for(let t=0;t<n.length;t++){let{dom:s,top:i,left:r}=n[t];s.scrollTop!=i+e&&(s.scrollTop=i+e),s.scrollLeft!=r&&(s.scrollLeft=r)}}let Wf=null;function SQ(n){if(n.setActive)return n.setActive();if(Wf)return n.focus(Wf);let e=X4(n);n.focus(Wf==null?{get preventScroll(){return Wf={preventScroll:!0},!0}}:void 0),Wf||(Wf=!1,Q4(e,0))}function Z4(n,e){let t,s=2e8,i,r=0,o=e.top,a=e.top,l,u;for(let f=n.firstChild,p=0;f;f=f.nextSibling,p++){let g;if(f.nodeType==1)g=f.getClientRects();else if(f.nodeType==3)g=fl(f).getClientRects();else continue;for(let b=0;b<g.length;b++){let w=g[b];if(w.top<=o&&w.bottom>=a){o=Math.max(w.bottom,o),a=Math.min(w.top,a);let S=w.left>e.left?w.left-e.left:w.right<e.left?e.left-w.right:0;if(S<s){t=f,s=S,i=S&&t.nodeType==3?{left:w.right<e.left?w.right:w.left,top:e.top}:e,f.nodeType==1&&S&&(r=p+(e.left>=(w.left+w.right)/2?1:0));continue}}else w.top>e.top&&!l&&w.left<=e.left&&w.right>=e.left&&(l=f,u={left:Math.max(w.left,Math.min(w.right,e.left)),top:w.top});!t&&(e.left>=w.right&&e.top>=w.top||e.left>=w.left&&e.top>=w.bottom)&&(r=p+1)}}return!t&&l&&(t=l,i=u,s=0),t&&t.nodeType==3?CQ(t,i):!t||s&&t.nodeType==1?{node:n,offset:r}:Z4(t,i)}function CQ(n,e){let t=n.nodeValue.length,s=document.createRange(),i;for(let r=0;r<t;r++){s.setEnd(n,r+1),s.setStart(n,r);let o=Hc(s,1);if(o.top!=o.bottom&&j_(e,o)){i={node:n,offset:r+(e.left>=(o.left+o.right)/2?1:0)};break}}return s.detach(),i||{node:n,offset:0}}function j_(n,e){return n.left>=e.left-1&&n.left<=e.right+1&&n.top>=e.top-1&&n.top<=e.bottom+1}function AQ(n,e){let t=n.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<n.getBoundingClientRect().left?t:n}function NQ(n,e,t){let{node:s,offset:i}=Z4(e,t),r=-1;if(s.nodeType==1&&!s.firstChild){let o=s.getBoundingClientRect();r=o.left!=o.right&&t.left>(o.left+o.right)/2?1:-1}return n.docView.posFromDOM(s,i,r)}function EQ(n,e,t,s){let i=-1;for(let r=e,o=!1;r!=n.dom;){let a=n.docView.nearestDesc(r,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>s.left||l.top>s.top?i=a.posBefore:(!o&&l.right<s.left||l.bottom<s.top)&&(i=a.posAfter),o=!0),!a.contentDOM&&i<0&&!a.node.isText))return(a.node.isBlock?s.top<(l.top+l.bottom)/2:s.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;r=a.dom.parentNode}return i>-1?i:n.docView.posFromDOM(e,t,-1)}function e5(n,e,t){let s=n.childNodes.length;if(s&&t.top<t.bottom)for(let i=Math.max(0,Math.min(s-1,Math.floor(s*(e.top-t.top)/(t.bottom-t.top))-2)),r=i;;){let o=n.childNodes[r];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let u=a[l];if(j_(e,u))return e5(o,e,u)}}if((r=(r+1)%s)==i)break}return n}function TQ(n,e){let t=n.dom.ownerDocument,s,i=0,r=xQ(t,e.left,e.top);r&&({node:s,offset:i}=r);let o=(n.root.elementFromPoint?n.root:t).elementFromPoint(e.left,e.top),a;if(!o||!n.dom.contains(o.nodeType!=1?o.parentNode:o)){let u=n.dom.getBoundingClientRect();if(!j_(e,u)||(o=e5(n.dom,e,u),!o))return null}if(vi)for(let u=o;s&&u;u=_m(u))u.draggable&&(s=void 0);if(o=AQ(o,e),s){if(lo&&s.nodeType==1&&(i=Math.min(i,s.childNodes.length),i<s.childNodes.length)){let f=s.childNodes[i],p;f.nodeName=="IMG"&&(p=f.getBoundingClientRect()).right<=e.left&&p.bottom>e.top&&i++}let u;Ub&&i&&s.nodeType==1&&(u=s.childNodes[i-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&i--,s==n.dom&&i==s.childNodes.length-1&&s.lastChild.nodeType==1&&e.top>s.lastChild.getBoundingClientRect().bottom?a=n.state.doc.content.size:(i==0||s.nodeType!=1||s.childNodes[i-1].nodeName!="BR")&&(a=EQ(n,s,i,e))}a==null&&(a=NQ(n,o,e));let l=n.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function gP(n){return n.top<n.bottom||n.left<n.right}function Hc(n,e){let t=n.getClientRects();if(t.length){let s=t[e<0?0:t.length-1];if(gP(s))return s}return Array.prototype.find.call(t,gP)||n.getBoundingClientRect()}const _Q=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function t5(n,e,t){let{node:s,offset:i,atom:r}=n.docView.domFromPos(e,t<0?-1:1),o=Ub||lo;if(s.nodeType==3)if(o&&(_Q.test(s.nodeValue)||(t<0?!i:i==s.nodeValue.length))){let l=Hc(fl(s,i,i),t);if(lo&&i&&/\s/.test(s.nodeValue[i-1])&&i<s.nodeValue.length){let u=Hc(fl(s,i-1,i-1),-1);if(u.top==l.top){let f=Hc(fl(s,i,i+1),-1);if(f.top!=l.top)return Vg(f,f.left<u.left)}}return l}else{let l=i,u=i,f=t<0?1:-1;return t<0&&!i?(u++,f=-1):t>=0&&i==s.nodeValue.length?(l--,f=1):t<0?l--:u++,Vg(Hc(fl(s,l,u),f),f<0)}if(!n.state.doc.resolve(e-(r||0)).parent.inlineContent){if(r==null&&i&&(t<0||i==so(s))){let l=s.childNodes[i-1];if(l.nodeType==1)return jA(l.getBoundingClientRect(),!1)}if(r==null&&i<so(s)){let l=s.childNodes[i];if(l.nodeType==1)return jA(l.getBoundingClientRect(),!0)}return jA(s.getBoundingClientRect(),t>=0)}if(r==null&&i&&(t<0||i==so(s))){let l=s.childNodes[i-1],u=l.nodeType==3?fl(l,so(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(u)return Vg(Hc(u,1),!1)}if(r==null&&i<so(s)){let l=s.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let u=l?l.nodeType==3?fl(l,0,o?0:1):l.nodeType==1?l:null:null;if(u)return Vg(Hc(u,-1),!0)}return Vg(Hc(s.nodeType==3?fl(s):s,-t),t>=0)}function Vg(n,e){if(n.width==0)return n;let t=e?n.left:n.right;return{top:n.top,bottom:n.bottom,left:t,right:t}}function jA(n,e){if(n.height==0)return n;let t=e?n.top:n.bottom;return{top:t,bottom:t,left:n.left,right:n.right}}function n5(n,e,t){let s=n.state,i=n.root.activeElement;s!=e&&n.updateState(e),i!=n.dom&&n.focus();try{return t()}finally{s!=e&&n.updateState(s),i!=n.dom&&i&&i.focus()}}function MQ(n,e,t){let s=e.selection,i=t=="up"?s.$from:s.$to;return n5(n,e,()=>{let{node:r}=n.docView.domFromPos(i.pos,t=="up"?-1:1);for(;;){let a=n.docView.nearestDesc(r,!0);if(!a)break;if(a.node.isBlock){r=a.contentDOM||a.dom;break}r=a.dom.parentNode}let o=t5(n,i.pos,1);for(let a=r.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=fl(a,0,a.nodeValue.length).getClientRects();else continue;for(let u=0;u<l.length;u++){let f=l[u];if(f.bottom>f.top+1&&(t=="up"?o.top-f.top>(f.bottom-o.top)*2:f.bottom-o.bottom>(o.bottom-f.top)*2))return!1}}return!0})}const RQ=/[\u0590-\u08ac]/;function IQ(n,e,t){let{$head:s}=e.selection;if(!s.parent.isTextblock)return!1;let i=s.parentOffset,r=!i,o=i==s.parent.content.size,a=n.domSelection();return a?!RQ.test(s.parent.textContent)||!a.modify?t=="left"||t=="backward"?r:o:n5(n,e,()=>{let{focusNode:l,focusOffset:u,anchorNode:f,anchorOffset:p}=n.domSelectionRange(),g=a.caretBidiLevel;a.modify("move",t,"character");let b=s.depth?n.docView.domAfterPos(s.before()):n.dom,{focusNode:w,focusOffset:S}=n.domSelectionRange(),N=w&&!b.contains(w.nodeType==1?w:w.parentNode)||l==w&&u==S;try{a.collapse(f,p),l&&(l!=f||u!=p)&&a.extend&&a.extend(l,u)}catch{}return g!=null&&(a.caretBidiLevel=g),N}):s.pos==s.start()||s.pos==s.end()}let xP=null,bP=null,yP=!1;function zQ(n,e,t){return xP==e&&bP==t?yP:(xP=e,bP=t,yP=t=="up"||t=="down"?MQ(n,e,t):IQ(n,e,t))}const co=0,vP=1,Eu=2,ja=3;class $b{constructor(e,t,s,i){this.parent=e,this.children=t,this.dom=s,this.contentDOM=i,this.dirty=co,s.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,s){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,s=this.posAtStart;;t++){let i=this.children[t];if(i==e)return s;s+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,s){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(s<0){let r,o;if(e==this.contentDOM)r=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;r=e.previousSibling}for(;r&&!((o=r.pmViewDesc)&&o.parent==this);)r=r.previousSibling;return r?this.posBeforeChild(o)+o.size:this.posAtStart}else{let r,o;if(e==this.contentDOM)r=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;r=e.nextSibling}for(;r&&!((o=r.pmViewDesc)&&o.parent==this);)r=r.nextSibling;return r?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=t>si(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let r=e;;r=r.parentNode){if(r==this.dom){i=!1;break}if(r.previousSibling)break}if(i==null&&t==e.childNodes.length)for(let r=e;;r=r.parentNode){if(r==this.dom){i=!0;break}if(r.nextSibling)break}}return i??s>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let s=!0,i=e;i;i=i.parentNode){let r=this.getDesc(i),o;if(r&&(!t||r.node))if(s&&(o=r.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))s=!1;else return r}}getDesc(e){let t=e.pmViewDesc;for(let s=t;s;s=s.parent)if(s==this)return t}posFromDOM(e,t,s){for(let i=e;i;i=i.parentNode){let r=this.getDesc(i);if(r)return r.localPosFromDOM(e,t,s)}return-1}descAt(e){for(let t=0,s=0;t<this.children.length;t++){let i=this.children[t],r=s+i.size;if(s==e&&r!=s){for(;!i.border&&i.children.length;)for(let o=0;o<i.children.length;o++){let a=i.children[o];if(a.size){i=a;break}}return i}if(e<r)return i.descAt(e-s-i.border);s=r}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let s=0,i=0;for(let r=0;s<this.children.length;s++){let o=this.children[s],a=r+o.size;if(a>e||o instanceof i5){i=e-r;break}r=a}if(i)return this.children[s].domFromPos(i-this.children[s].border,t);for(let r;s&&!(r=this.children[s-1]).size&&r instanceof s5&&r.side>=0;s--);if(t<=0){let r,o=!0;for(;r=s?this.children[s-1]:null,!(!r||r.dom.parentNode==this.contentDOM);s--,o=!1);return r&&t&&o&&!r.border&&!r.domAtom?r.domFromPos(r.size,t):{node:this.contentDOM,offset:r?si(r.dom)+1:0}}else{let r,o=!0;for(;r=s<this.children.length?this.children[s]:null,!(!r||r.dom.parentNode==this.contentDOM);s++,o=!1);return r&&o&&!r.border&&!r.domAtom?r.domFromPos(0,t):{node:this.contentDOM,offset:r?si(r.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,s=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,r=-1;for(let o=s,a=0;;a++){let l=this.children[a],u=o+l.size;if(i==-1&&e<=u){let f=o+l.border;if(e>=f&&t<=u-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,t,f);e=o;for(let p=a;p>0;p--){let g=this.children[p-1];if(g.size&&g.dom.parentNode==this.contentDOM&&!g.emptyChildAt(1)){i=si(g.dom)+1;break}e-=g.size}i==-1&&(i=0)}if(i>-1&&(u>t||a==this.children.length-1)){t=u;for(let f=a+1;f<this.children.length;f++){let p=this.children[f];if(p.size&&p.dom.parentNode==this.contentDOM&&!p.emptyChildAt(-1)){r=si(p.dom);break}t+=p.size}r==-1&&(r=this.contentDOM.childNodes.length);break}o=u}return{node:this.contentDOM,from:e,to:t,fromOffset:i,toOffset:r}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:s}=this.domFromPos(e,0);if(t.nodeType!=1||s==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[s]}setSelection(e,t,s,i=!1){let r=Math.min(e,t),o=Math.max(e,t);for(let b=0,w=0;b<this.children.length;b++){let S=this.children[b],N=w+S.size;if(r>w&&o<N)return S.setSelection(e-w-S.border,t-w-S.border,s,i);w=N}let a=this.domFromPos(e,e?-1:1),l=t==e?a:this.domFromPos(t,t?-1:1),u=s.root.getSelection(),f=s.domSelectionRange(),p=!1;if((lo||vi)&&e==t){let{node:b,offset:w}=a;if(b.nodeType==3){if(p=!!(w&&b.nodeValue[w-1]==`
`),p&&w==b.nodeValue.length)for(let S=b,N;S;S=S.parentNode){if(N=S.nextSibling){N.nodeName=="BR"&&(a=l={node:N.parentNode,offset:si(N)+1});break}let C=S.pmViewDesc;if(C&&C.node&&C.node.isBlock)break}}else{let S=b.childNodes[w-1];p=S&&(S.nodeName=="BR"||S.contentEditable=="false")}}if(lo&&f.focusNode&&f.focusNode!=l.node&&f.focusNode.nodeType==1){let b=f.focusNode.childNodes[f.focusOffset];b&&b.contentEditable=="false"&&(i=!0)}if(!(i||p&&vi)&&Vh(a.node,a.offset,f.anchorNode,f.anchorOffset)&&Vh(l.node,l.offset,f.focusNode,f.focusOffset))return;let g=!1;if((u.extend||e==t)&&!(p&&lo)){u.collapse(a.node,a.offset);try{e!=t&&u.extend(l.node,l.offset),g=!0}catch{}}if(!g){if(e>t){let w=a;a=l,l=w}let b=document.createRange();b.setEnd(l.node,l.offset),b.setStart(a.node,a.offset),u.removeAllRanges(),u.addRange(b)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let s=0,i=0;i<this.children.length;i++){let r=this.children[i],o=s+r.size;if(s==o?e<=o&&t>=s:e<o&&t>s){let a=s+r.border,l=o-r.border;if(e>=a&&t<=l){this.dirty=e==s||t==o?Eu:vP,e==a&&t==l&&(r.contentLost||r.dom.parentNode!=this.contentDOM)?r.dirty=ja:r.markDirty(e-a,t-a);return}else r.dirty=r.dom==r.contentDOM&&r.dom.parentNode==this.contentDOM&&!r.children.length?Eu:ja}s=o}this.dirty=Eu}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let s=e==1?Eu:vP;t.dirty<s&&(t.dirty=s)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class s5 extends $b{constructor(e,t,s,i){let r,o=t.type.toDOM;if(typeof o=="function"&&(o=o(s,()=>{if(!r)return i;if(r.parent)return r.parent.posBeforeChild(r)})),!t.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=t,this.widget=t,r=this}matchesWidget(e){return this.dirty==co&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class DQ extends $b{constructor(e,t,s,i){super(e,[],t,null),this.textDOM=s,this.text=i}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class qh extends $b{constructor(e,t,s,i,r){super(e,[],s,i),this.mark=t,this.spec=r}static create(e,t,s,i){let r=i.nodeViews[t.type.name],o=r&&r(t,i,s);return(!o||!o.dom)&&(o=sf.renderSpec(document,t.type.spec.toDOM(t,s),null,t.attrs)),new qh(e,t,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&ja||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=ja&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=co){let s=this.parent;for(;!s.node;)s=s.parent;s.dirty<this.dirty&&(s.dirty=this.dirty),this.dirty=co}}slice(e,t,s){let i=qh.create(this.parent,this.mark,!0,s),r=this.children,o=this.size;t<o&&(r=oE(r,t,o,s)),e>0&&(r=oE(r,0,e,s));for(let a=0;a<r.length;a++)r[a].parent=i;return i.children=r,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class zd extends $b{constructor(e,t,s,i,r,o,a,l,u){super(e,[],r,o),this.node=t,this.outerDeco=s,this.innerDeco=i,this.nodeDOM=a}static create(e,t,s,i,r,o){let a=r.nodeViews[t.type.name],l,u=a&&a(t,r,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},s,i),f=u&&u.dom,p=u&&u.contentDOM;if(t.isText){if(!f)f=document.createTextNode(t.text);else if(f.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else f||({dom:f,contentDOM:p}=sf.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs));!p&&!t.isText&&f.nodeName!="BR"&&(f.hasAttribute("contenteditable")||(f.contentEditable="false"),t.type.spec.draggable&&(f.draggable=!0));let g=f;return f=a5(f,s,t),u?l=new jQ(e,t,s,i,f,p||null,g,u,r,o+1):t.isText?new PS(e,t,s,i,f,g,r):new zd(e,t,s,i,f,p||null,g,r,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let s=this.children[t];if(this.dom.contains(s.dom.parentNode)){e.contentElement=s.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Ie.empty)}return e}matchesNode(e,t,s){return this.dirty==co&&e.eq(this.node)&&rk(t,this.outerDeco)&&s.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let s=this.node.inlineContent,i=t,r=e.composing?this.localCompositionInfo(e,t):null,o=r&&r.pos>-1?r:null,a=r&&r.pos<0,l=new LQ(this,o&&o.node,e);FQ(this.node,this.innerDeco,(u,f,p)=>{u.spec.marks?l.syncToMarks(u.spec.marks,s,e):u.type.side>=0&&!p&&l.syncToMarks(f==this.node.childCount?gn.none:this.node.child(f).marks,s,e),l.placeWidget(u,e,i)},(u,f,p,g)=>{l.syncToMarks(u.marks,s,e);let b;l.findNodeMatch(u,f,p,g)||a&&e.state.selection.from>i&&e.state.selection.to<i+u.nodeSize&&(b=l.findIndexWithChild(r.node))>-1&&l.updateNodeAt(u,f,p,b,e)||l.updateNextNode(u,f,p,e,g,i)||l.addNode(u,f,p,e,i),i+=u.nodeSize}),l.syncToMarks([],s,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==Eu)&&(o&&this.protectLocalComposition(e,o),r5(this.contentDOM,this.children,e),Mm&&HQ(this.dom))}localCompositionInfo(e,t){let{from:s,to:i}=e.state.selection;if(!(e.state.selection instanceof ut)||s<t||i>t+this.node.content.size)return null;let r=e.input.compositionNode;if(!r||!this.dom.contains(r.parentNode))return null;if(this.node.inlineContent){let o=r.nodeValue,a=UQ(this.node.content,o,s-t,i-t);return a<0?null:{node:r,pos:a,text:o}}else return{node:r,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:s,text:i}){if(this.getDesc(t))return;let r=t;for(;r.parentNode!=this.contentDOM;r=r.parentNode){for(;r.previousSibling;)r.parentNode.removeChild(r.previousSibling);for(;r.nextSibling;)r.parentNode.removeChild(r.nextSibling);r.pmViewDesc&&(r.pmViewDesc=void 0)}let o=new DQ(this,r,t,i);e.input.compositionNodes.push(o),this.children=oE(this.children,s,s+i.length,e,o)}update(e,t,s,i){return this.dirty==ja||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,s,i),!0)}updateInner(e,t,s,i){this.updateOuterDeco(t),this.node=e,this.innerDeco=s,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=co}updateOuterDeco(e){if(rk(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,s=this.dom;this.dom=o5(this.dom,this.nodeDOM,rE(this.outerDeco,this.node,t),rE(e,this.node,t)),this.dom!=s&&(s.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function wP(n,e,t,s,i){a5(s,e,n);let r=new zd(void 0,n,e,t,s,s,s,i,0);return r.contentDOM&&r.updateChildren(i,0),r}class PS extends zd{constructor(e,t,s,i,r,o,a){super(e,t,s,i,r,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,s,i){return this.dirty==ja||this.dirty!=co&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=co||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=co,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,s){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,s)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,s){let i=this.node.cut(e,t),r=document.createTextNode(i.text);return new PS(this.parent,i,this.outerDeco,this.innerDeco,r,r,s)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=ja)}get domAtom(){return!1}isText(e){return this.node.text==e}}class i5 extends $b{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==co&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class jQ extends zd{constructor(e,t,s,i,r,o,a,l,u,f){super(e,t,s,i,r,o,a,u,f),this.spec=l}update(e,t,s,i){if(this.dirty==ja)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let r=this.spec.update(e,t,s);return r&&this.updateInner(e,t,s,i),r}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,s,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,s,i){this.spec.setSelection?this.spec.setSelection(e,t,s.root):super.setSelection(e,t,s,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function r5(n,e,t){let s=n.firstChild,i=!1;for(let r=0;r<e.length;r++){let o=e[r],a=o.dom;if(a.parentNode==n){for(;a!=s;)s=kP(s),i=!0;s=s.nextSibling}else i=!0,n.insertBefore(a,s);if(o instanceof qh){let l=s?s.previousSibling:n.lastChild;r5(o.contentDOM,o.children,t),s=l?l.nextSibling:n.firstChild}}for(;s;)s=kP(s),i=!0;i&&t.trackWrites==n&&(t.trackWrites=null)}const N0=function(n){n&&(this.nodeName=n)};N0.prototype=Object.create(null);const Tu=[new N0];function rE(n,e,t){if(n.length==0)return Tu;let s=t?Tu[0]:new N0,i=[s];for(let r=0;r<n.length;r++){let o=n[r].type.attrs;if(o){o.nodeName&&i.push(s=new N0(o.nodeName));for(let a in o){let l=o[a];l!=null&&(t&&i.length==1&&i.push(s=new N0(e.isInline?"span":"div")),a=="class"?s.class=(s.class?s.class+" ":"")+l:a=="style"?s.style=(s.style?s.style+";":"")+l:a!="nodeName"&&(s[a]=l))}}}return i}function o5(n,e,t,s){if(t==Tu&&s==Tu)return e;let i=e;for(let r=0;r<s.length;r++){let o=s[r],a=t[r];if(r){let l;a&&a.nodeName==o.nodeName&&i!=n&&(l=i.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=Tu[0]),i=l}PQ(i,a||Tu[0],o)}return i}function PQ(n,e,t){for(let s in e)s!="class"&&s!="style"&&s!="nodeName"&&!(s in t)&&n.removeAttribute(s);for(let s in t)s!="class"&&s!="style"&&s!="nodeName"&&t[s]!=e[s]&&n.setAttribute(s,t[s]);if(e.class!=t.class){let s=e.class?e.class.split(" ").filter(Boolean):[],i=t.class?t.class.split(" ").filter(Boolean):[];for(let r=0;r<s.length;r++)i.indexOf(s[r])==-1&&n.classList.remove(s[r]);for(let r=0;r<i.length;r++)s.indexOf(i[r])==-1&&n.classList.add(i[r]);n.classList.length==0&&n.removeAttribute("class")}if(e.style!=t.style){if(e.style){let s=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=s.exec(e.style);)n.style.removeProperty(i[1])}t.style&&(n.style.cssText+=t.style)}}function a5(n,e,t){return o5(n,n,Tu,rE(e,t,n.nodeType!=1))}function rk(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].type.eq(e[t].type))return!1;return!0}function kP(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class LQ{constructor(e,t,s){this.lock=t,this.view=s,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=OQ(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let s=e;s<t;s++)this.top.children[s].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,s){let i=0,r=this.stack.length>>1,o=Math.min(r,e.length);for(;i<o&&(i==r-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<r;)this.destroyRest(),this.top.dirty=co,this.index=this.stack.pop(),this.top=this.stack.pop(),r--;for(;r<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let u=this.top.children[l];if(u.matchesMark(e[r])&&!this.isLocked(u.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=qh.create(this.top,e[r],t,s);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,r++}}findNodeMatch(e,t,s,i){let r=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,t,s))r=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let u=this.top.children[a];if(u.matchesNode(e,t,s)&&!this.preMatch.matched.has(u)){r=a;break}}return r<0?!1:(this.destroyBetween(this.index,r),this.index++,!0)}updateNodeAt(e,t,s,i,r){let o=this.top.children[i];return o.dirty==ja&&o.dom==o.contentDOM&&(o.dirty=Eu),o.update(e,t,s,r)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let s=e.pmViewDesc;if(s){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==s)return i}return-1}e=t}}updateNextNode(e,t,s,i,r,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof zd){let u=this.preMatch.matched.get(l);if(u!=null&&u!=r)return!1;let f=l.dom,p,g=this.isLocked(f)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=ja&&rk(t,l.outerDeco));if(!g&&l.update(e,t,s,i))return this.destroyBetween(this.index,a),l.dom!=f&&(this.changed=!0),this.index++,!0;if(!g&&(p=this.recreateWrapper(l,e,t,s,i,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=p,p.contentDOM&&(p.dirty=Eu,p.updateChildren(i,o+1),p.dirty=co),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,s,i,r,o){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!rk(s,e.outerDeco)||!i.eq(e.innerDeco))return null;let a=zd.create(this.top,t,s,i,r,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,t,s,i,r){let o=zd.create(this.top,e,t,s,i,r);o.contentDOM&&o.updateChildren(i,r+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,t,s){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let r=new s5(this.top,e,t,s);this.top.children.splice(this.index++,0,r),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof qh;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof PS)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((vi||Fs)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let s=document.createElement(e);e=="IMG"&&(s.className="ProseMirror-separator",s.alt=""),e=="BR"&&(s.className="ProseMirror-trailingBreak");let i=new i5(this.top,[],s,null);t!=this.top?t.children.push(i):t.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function OQ(n,e){let t=e,s=t.children.length,i=n.childCount,r=new Map,o=[];e:for(;i>0;){let a;for(;;)if(s){let u=t.children[s-1];if(u instanceof qh)t=u,s=u.children.length;else{a=u,s--;break}}else{if(t==e)break e;s=t.parent.children.indexOf(t),t=t.parent}let l=a.node;if(l){if(l!=n.child(i-1))break;--i,r.set(a,i),o.push(a)}}return{index:i,matched:r,matches:o.reverse()}}function BQ(n,e){return n.type.side-e.type.side}function FQ(n,e,t,s){let i=e.locals(n),r=0;if(i.length==0){for(let u=0;u<n.childCount;u++){let f=n.child(u);s(f,i,e.forChild(r,f),u),r+=f.nodeSize}return}let o=0,a=[],l=null;for(let u=0;;){let f,p;for(;o<i.length&&i[o].to==r;){let N=i[o++];N.widget&&(f?(p||(p=[f])).push(N):f=N)}if(f)if(p){p.sort(BQ);for(let N=0;N<p.length;N++)t(p[N],u,!!l)}else t(f,u,!!l);let g,b;if(l)b=-1,g=l,l=null;else if(u<n.childCount)b=u,g=n.child(u++);else break;for(let N=0;N<a.length;N++)a[N].to<=r&&a.splice(N--,1);for(;o<i.length&&i[o].from<=r&&i[o].to>r;)a.push(i[o++]);let w=r+g.nodeSize;if(g.isText){let N=w;o<i.length&&i[o].from<N&&(N=i[o].from);for(let C=0;C<a.length;C++)a[C].to<N&&(N=a[C].to);N<w&&(l=g.cut(N-r),g=g.cut(0,N-r),w=N,b=-1)}else for(;o<i.length&&i[o].to<w;)o++;let S=g.isInline&&!g.isLeaf?a.filter(N=>!N.inline):a.slice();s(g,S,e.forChild(r,g),b),r=w}}function HQ(n){if(n.nodeName=="UL"||n.nodeName=="OL"){let e=n.style.cssText;n.style.cssText=e+"; list-style: square !important",window.getComputedStyle(n).listStyle,n.style.cssText=e}}function UQ(n,e,t,s){for(let i=0,r=0;i<n.childCount&&r<=s;){let o=n.child(i++),a=r;if(r+=o.nodeSize,!o.isText)continue;let l=o.text;for(;i<n.childCount;){let u=n.child(i++);if(r+=u.nodeSize,!u.isText)break;l+=u.text}if(r>=t){if(r>=s&&l.slice(s-e.length-a,s-a)==e)return s-e.length;let u=a<s?l.lastIndexOf(e,s-a-1):-1;if(u>=0&&u+e.length+a>=t)return a+u;if(t==s&&l.length>=s+e.length-a&&l.slice(s-a,s-a+e.length)==e)return s}}return-1}function oE(n,e,t,s,i){let r=[];for(let o=0,a=0;o<n.length;o++){let l=n[o],u=a,f=a+=l.size;u>=t||f<=e?r.push(l):(u<e&&r.push(l.slice(0,e-u,s)),i&&(r.push(i),i=void 0),f>t&&r.push(l.slice(t-u,l.size,s)))}return r}function P_(n,e=null){let t=n.domSelectionRange(),s=n.state.doc;if(!t.focusNode)return null;let i=n.docView.nearestDesc(t.focusNode),r=i&&i.size==0,o=n.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(o<0)return null;let a=s.resolve(o),l,u;if(jS(t)){for(l=o;i&&!i.node;)i=i.parent;let p=i.node;if(i&&p.isAtom&&dt.isSelectable(p)&&i.parent&&!(p.isInline&&mQ(t.focusNode,t.focusOffset,i.dom))){let g=i.posBefore;u=new dt(o==g?a:s.resolve(g))}}else{if(t instanceof n.dom.ownerDocument.defaultView.Selection&&t.rangeCount>1){let p=o,g=o;for(let b=0;b<t.rangeCount;b++){let w=t.getRangeAt(b);p=Math.min(p,n.docView.posFromDOM(w.startContainer,w.startOffset,1)),g=Math.max(g,n.docView.posFromDOM(w.endContainer,w.endOffset,-1))}if(p<0)return null;[l,o]=g==n.state.selection.anchor?[g,p]:[p,g],a=s.resolve(o)}else l=n.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(l<0)return null}let f=s.resolve(l);if(!u){let p=e=="pointer"||n.state.selection.head<a.pos&&!r?1:-1;u=L_(n,f,a,p)}return u}function l5(n){return n.editable?n.hasFocus():d5(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function Wl(n,e=!1){let t=n.state.selection;if(c5(n,t),!!l5(n)){if(!e&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&Fs){let s=n.domSelectionRange(),i=n.domObserver.currentSelection;if(s.anchorNode&&i.anchorNode&&Vh(s.anchorNode,s.anchorOffset,i.anchorNode,i.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)GQ(n);else{let{anchor:s,head:i}=t,r,o;SP&&!(t instanceof ut)&&(t.$from.parent.inlineContent||(r=CP(n,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(o=CP(n,t.to))),n.docView.setSelection(s,i,n,e),SP&&(r&&AP(r),o&&AP(o)),t.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&$Q(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}const SP=vi||Fs&&Y4<63;function CP(n,e){let{node:t,offset:s}=n.docView.domFromPos(e,0),i=s<t.childNodes.length?t.childNodes[s]:null,r=s?t.childNodes[s-1]:null;if(vi&&i&&i.contentEditable=="false")return PA(i);if((!i||i.contentEditable=="false")&&(!r||r.contentEditable=="false")){if(i)return PA(i);if(r)return PA(r)}}function PA(n){return n.contentEditable="true",vi&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function AP(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function $Q(n){let e=n.dom.ownerDocument;e.removeEventListener("selectionchange",n.input.hideSelectionGuard);let t=n.domSelectionRange(),s=t.anchorNode,i=t.anchorOffset;e.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(t.anchorNode!=s||t.anchorOffset!=i)&&(e.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!l5(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function GQ(n){let e=n.domSelection();if(!e)return;let t=n.cursorWrapper.dom,s=t.nodeName=="IMG";s?e.collapse(t.parentNode,si(t)+1):e.collapse(t,0),!s&&!n.state.selection.visible&&er&&Id<=11&&(t.disabled=!0,t.disabled=!1)}function c5(n,e){if(e instanceof dt){let t=n.docView.descAt(e.from);t!=n.lastSelectedViewDesc&&(NP(n),t&&t.selectNode(),n.lastSelectedViewDesc=t)}else NP(n)}function NP(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function L_(n,e,t,s){return n.someProp("createSelectionBetween",i=>i(n,e,t))||ut.between(e,t,s)}function EP(n){return n.editable&&!n.hasFocus()?!1:d5(n)}function d5(n){let e=n.domSelectionRange();if(!e.anchorNode)return!1;try{return n.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(n.editable||n.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function VQ(n){let e=n.docView.domFromPos(n.state.selection.anchor,0),t=n.domSelectionRange();return Vh(e.node,e.offset,t.anchorNode,t.anchorOffset)}function aE(n,e){let{$anchor:t,$head:s}=n.selection,i=e>0?t.max(s):t.min(s),r=i.parent.inlineContent?i.depth?n.doc.resolve(e>0?i.after():i.before()):null:i;return r&&mt.findFrom(r,e)}function $c(n,e){return n.dispatch(n.state.tr.setSelection(e).scrollIntoView()),!0}function TP(n,e,t){let s=n.state.selection;if(s instanceof ut)if(t.indexOf("s")>-1){let{$head:i}=s,r=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!r||r.isText||!r.isLeaf)return!1;let o=n.state.doc.resolve(i.pos+r.nodeSize*(e<0?-1:1));return $c(n,new ut(s.$anchor,o))}else if(s.empty){if(n.endOfTextblock(e>0?"forward":"backward")){let i=aE(n.state,e);return i&&i instanceof dt?$c(n,i):!1}else if(!(no&&t.indexOf("m")>-1)){let i=s.$head,r=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!r||r.isText)return!1;let a=e<0?i.pos-r.nodeSize:i.pos;return r.isAtom||(o=n.docView.descAt(a))&&!o.contentDOM?dt.isSelectable(r)?$c(n,new dt(e<0?n.state.doc.resolve(i.pos-r.nodeSize):i)):Ub?$c(n,new ut(n.state.doc.resolve(e<0?a:a+r.nodeSize))):!1:!1}}else return!1;else{if(s instanceof dt&&s.node.isInline)return $c(n,new ut(e>0?s.$to:s.$from));{let i=aE(n.state,e);return i?$c(n,i):!1}}}function ok(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function E0(n,e){let t=n.pmViewDesc;return t&&t.size==0&&(e<0||n.nextSibling||n.nodeName!="BR")}function Kf(n,e){return e<0?qQ(n):WQ(n)}function qQ(n){let e=n.domSelectionRange(),t=e.focusNode,s=e.focusOffset;if(!t)return;let i,r,o=!1;for(lo&&t.nodeType==1&&s<ok(t)&&E0(t.childNodes[s],-1)&&(o=!0);;)if(s>0){if(t.nodeType!=1)break;{let a=t.childNodes[s-1];if(E0(a,-1))i=t,r=--s;else if(a.nodeType==3)t=a,s=t.nodeValue.length;else break}}else{if(u5(t))break;{let a=t.previousSibling;for(;a&&E0(a,-1);)i=t.parentNode,r=si(a),a=a.previousSibling;if(a)t=a,s=ok(t);else{if(t=t.parentNode,t==n.dom)break;s=0}}}o?lE(n,t,s):i&&lE(n,i,r)}function WQ(n){let e=n.domSelectionRange(),t=e.focusNode,s=e.focusOffset;if(!t)return;let i=ok(t),r,o;for(;;)if(s<i){if(t.nodeType!=1)break;let a=t.childNodes[s];if(E0(a,1))r=t,o=++s;else break}else{if(u5(t))break;{let a=t.nextSibling;for(;a&&E0(a,1);)r=a.parentNode,o=si(a)+1,a=a.nextSibling;if(a)t=a,s=0,i=ok(t);else{if(t=t.parentNode,t==n.dom)break;s=i=0}}}r&&lE(n,r,o)}function u5(n){let e=n.pmViewDesc;return e&&e.node&&e.node.isBlock}function KQ(n,e){for(;n&&e==n.childNodes.length&&!Hb(n);)e=si(n)+1,n=n.parentNode;for(;n&&e<n.childNodes.length;){let t=n.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=0}}function YQ(n,e){for(;n&&!e&&!Hb(n);)e=si(n),n=n.parentNode;for(;n&&e;){let t=n.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=n.childNodes.length}}function lE(n,e,t){if(e.nodeType!=3){let r,o;(o=KQ(e,t))?(e=o,t=0):(r=YQ(e,t))&&(e=r,t=r.nodeValue.length)}let s=n.domSelection();if(!s)return;if(jS(s)){let r=document.createRange();r.setEnd(e,t),r.setStart(e,t),s.removeAllRanges(),s.addRange(r)}else s.extend&&s.extend(e,t);n.domObserver.setCurSelection();let{state:i}=n;setTimeout(()=>{n.state==i&&Wl(n)},50)}function _P(n,e){let t=n.state.doc.resolve(e);if(!(Fs||J4)&&t.parent.inlineContent){let i=n.coordsAtPos(e);if(e>t.start()){let r=n.coordsAtPos(e-1),o=(r.top+r.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(r.left-i.left)>1)return r.left<i.left?"ltr":"rtl"}if(e<t.end()){let r=n.coordsAtPos(e+1),o=(r.top+r.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(r.left-i.left)>1)return r.left>i.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}function MP(n,e,t){let s=n.state.selection;if(s instanceof ut&&!s.empty||t.indexOf("s")>-1||no&&t.indexOf("m")>-1)return!1;let{$from:i,$to:r}=s;if(!i.parent.inlineContent||n.endOfTextblock(e<0?"up":"down")){let o=aE(n.state,e);if(o&&o instanceof dt)return $c(n,o)}if(!i.parent.inlineContent){let o=e<0?i:r,a=s instanceof Ir?mt.near(o,e):mt.findFrom(o,e);return a?$c(n,a):!1}return!1}function RP(n,e){if(!(n.state.selection instanceof ut))return!0;let{$head:t,$anchor:s,empty:i}=n.state.selection;if(!t.sameParent(s))return!0;if(!i)return!1;if(n.endOfTextblock(e>0?"forward":"backward"))return!0;let r=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(r&&!r.isText){let o=n.state.tr;return e<0?o.delete(t.pos-r.nodeSize,t.pos):o.delete(t.pos,t.pos+r.nodeSize),n.dispatch(o),!0}return!1}function IP(n,e,t){n.domObserver.stop(),e.contentEditable=t,n.domObserver.start()}function JQ(n){if(!vi||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=n.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let s=e.firstChild;IP(n,s,"true"),setTimeout(()=>IP(n,s,"false"),20)}return!1}function XQ(n){let e="";return n.ctrlKey&&(e+="c"),n.metaKey&&(e+="m"),n.altKey&&(e+="a"),n.shiftKey&&(e+="s"),e}function QQ(n,e){let t=e.keyCode,s=XQ(e);if(t==8||no&&t==72&&s=="c")return RP(n,-1)||Kf(n,-1);if(t==46&&!e.shiftKey||no&&t==68&&s=="c")return RP(n,1)||Kf(n,1);if(t==13||t==27)return!0;if(t==37||no&&t==66&&s=="c"){let i=t==37?_P(n,n.state.selection.from)=="ltr"?-1:1:-1;return TP(n,i,s)||Kf(n,i)}else if(t==39||no&&t==70&&s=="c"){let i=t==39?_P(n,n.state.selection.from)=="ltr"?1:-1:1;return TP(n,i,s)||Kf(n,i)}else{if(t==38||no&&t==80&&s=="c")return MP(n,-1,s)||Kf(n,-1);if(t==40||no&&t==78&&s=="c")return JQ(n)||MP(n,1,s)||Kf(n,1);if(s==(no?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function O_(n,e){n.someProp("transformCopied",b=>{e=b(e,n)});let t=[],{content:s,openStart:i,openEnd:r}=e;for(;i>1&&r>1&&s.childCount==1&&s.firstChild.childCount==1;){i--,r--;let b=s.firstChild;t.push(b.type.name,b.attrs!=b.type.defaultAttrs?b.attrs:null),s=b.content}let o=n.someProp("clipboardSerializer")||sf.fromSchema(n.state.schema),a=x5(),l=a.createElement("div");l.appendChild(o.serializeFragment(s,{document:a}));let u=l.firstChild,f,p=0;for(;u&&u.nodeType==1&&(f=g5[u.nodeName.toLowerCase()]);){for(let b=f.length-1;b>=0;b--){let w=a.createElement(f[b]);for(;l.firstChild;)w.appendChild(l.firstChild);l.appendChild(w),p++}u=l.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${i} ${r}${p?` -${p}`:""} ${JSON.stringify(t)}`);let g=n.someProp("clipboardTextSerializer",b=>b(e,n))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:g,slice:e}}function h5(n,e,t,s,i){let r=i.parent.type.spec.code,o,a;if(!t&&!e)return null;let l=!!e&&(s||r||!t);if(l){if(n.someProp("transformPastedText",g=>{e=g(e,r||s,n)}),r)return a=new Ve(Ie.from(n.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),n.someProp("transformPasted",g=>{a=g(a,n,!0)}),a;let p=n.someProp("clipboardTextParser",g=>g(e,i,s,n));if(p)a=p;else{let g=i.marks(),{schema:b}=n.state,w=sf.fromSchema(b);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(S=>{let N=o.appendChild(document.createElement("p"));S&&N.appendChild(w.serializeNode(b.text(S,g)))})}}else n.someProp("transformPastedHTML",p=>{t=p(t,n)}),o=nZ(t),Ub&&sZ(o);let u=o&&o.querySelector("[data-pm-slice]"),f=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(f&&f[3])for(let p=+f[3];p>0;p--){let g=o.firstChild;for(;g&&g.nodeType!=1;)g=g.nextSibling;if(!g)break;o=g}if(a||(a=(n.someProp("clipboardParser")||n.someProp("domParser")||C0.fromSchema(n.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||f),context:i,ruleFromNode(g){return g.nodeName=="BR"&&!g.nextSibling&&g.parentNode&&!ZQ.test(g.parentNode.nodeName)?{ignore:!0}:null}})),f)a=iZ(zP(a,+f[1],+f[2]),f[4]);else if(a=Ve.maxOpen(eZ(a.content,i),!0),a.openStart||a.openEnd){let p=0,g=0;for(let b=a.content.firstChild;p<a.openStart&&!b.type.spec.isolating;p++,b=b.firstChild);for(let b=a.content.lastChild;g<a.openEnd&&!b.type.spec.isolating;g++,b=b.lastChild);a=zP(a,p,g)}return n.someProp("transformPasted",p=>{a=p(a,n,l)}),a}const ZQ=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function eZ(n,e){if(n.childCount<2)return n;for(let t=e.depth;t>=0;t--){let i=e.node(t).contentMatchAt(e.index(t)),r,o=[];if(n.forEach(a=>{if(!o)return;let l=i.findWrapping(a.type),u;if(!l)return o=null;if(u=o.length&&r.length&&p5(l,r,a,o[o.length-1],0))o[o.length-1]=u;else{o.length&&(o[o.length-1]=m5(o[o.length-1],r.length));let f=f5(a,l);o.push(f),i=i.matchType(f.type),r=l}}),o)return Ie.from(o)}return n}function f5(n,e,t=0){for(let s=e.length-1;s>=t;s--)n=e[s].create(null,Ie.from(n));return n}function p5(n,e,t,s,i){if(i<n.length&&i<e.length&&n[i]==e[i]){let r=p5(n,e,t,s.lastChild,i+1);if(r)return s.copy(s.content.replaceChild(s.childCount-1,r));if(s.contentMatchAt(s.childCount).matchType(i==n.length-1?t.type:n[i+1]))return s.copy(s.content.append(Ie.from(f5(t,n,i+1))))}}function m5(n,e){if(e==0)return n;let t=n.content.replaceChild(n.childCount-1,m5(n.lastChild,e-1)),s=n.contentMatchAt(n.childCount).fillBefore(Ie.empty,!0);return n.copy(t.append(s))}function cE(n,e,t,s,i,r){let o=e<0?n.firstChild:n.lastChild,a=o.content;return n.childCount>1&&(r=0),i<s-1&&(a=cE(a,e,t,s,i+1,r)),i>=t&&(a=e<0?o.contentMatchAt(0).fillBefore(a,r<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(Ie.empty,!0))),n.replaceChild(e<0?0:n.childCount-1,o.copy(a))}function zP(n,e,t){return e<n.openStart&&(n=new Ve(cE(n.content,-1,e,n.openStart,0,n.openEnd),e,n.openEnd)),t<n.openEnd&&(n=new Ve(cE(n.content,1,t,n.openEnd,0,0),n.openStart,t)),n}const g5={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let DP=null;function x5(){return DP||(DP=document.implementation.createHTMLDocument("title"))}let LA=null;function tZ(n){let e=window.trustedTypes;return e?(LA||(LA=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:t=>t})),LA.createHTML(n)):n}function nZ(n){let e=/^(\s*<meta [^>]*>)*/.exec(n);e&&(n=n.slice(e[0].length));let t=x5().createElement("div"),s=/<([a-z][^>\s]+)/i.exec(n),i;if((i=s&&g5[s[1].toLowerCase()])&&(n=i.map(r=>"<"+r+">").join("")+n+i.map(r=>"</"+r+">").reverse().join("")),t.innerHTML=tZ(n),i)for(let r=0;r<i.length;r++)t=t.querySelector(i[r])||t;return t}function sZ(n){let e=n.querySelectorAll(Fs?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let s=e[t];s.childNodes.length==1&&s.textContent==""&&s.parentNode&&s.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),s)}}function iZ(n,e){if(!n.size)return n;let t=n.content.firstChild.type.schema,s;try{s=JSON.parse(e)}catch{return n}let{content:i,openStart:r,openEnd:o}=n;for(let a=s.length-2;a>=0;a-=2){let l=t.nodes[s[a]];if(!l||l.hasRequiredAttrs())break;i=Ie.from(l.create(s[a+1],i)),r++,o++}return new Ve(i,r,o)}const Li={},Oi={},rZ={touchstart:!0,touchmove:!0};class oZ{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function aZ(n){for(let e in Li){let t=Li[e];n.dom.addEventListener(e,n.input.eventHandlers[e]=s=>{cZ(n,s)&&!B_(n,s)&&(n.editable||!(s.type in Oi))&&t(n,s)},rZ[e]?{passive:!0}:void 0)}vi&&n.dom.addEventListener("input",()=>null),dE(n)}function _d(n,e){n.input.lastSelectionOrigin=e,n.input.lastSelectionTime=Date.now()}function lZ(n){n.domObserver.stop();for(let e in n.input.eventHandlers)n.dom.removeEventListener(e,n.input.eventHandlers[e]);clearTimeout(n.input.composingTimeout),clearTimeout(n.input.lastIOSEnterFallbackTimeout)}function dE(n){n.someProp("handleDOMEvents",e=>{for(let t in e)n.input.eventHandlers[t]||n.dom.addEventListener(t,n.input.eventHandlers[t]=s=>B_(n,s))})}function B_(n,e){return n.someProp("handleDOMEvents",t=>{let s=t[e.type];return s?s(n,e)||e.defaultPrevented:!1})}function cZ(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=n.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function dZ(n,e){!B_(n,e)&&Li[e.type]&&(n.editable||!(e.type in Oi))&&Li[e.type](n,e)}Oi.keydown=(n,e)=>{let t=e;if(n.input.shiftKey=t.keyCode==16||t.shiftKey,!y5(n,t)&&(n.input.lastKeyCode=t.keyCode,n.input.lastKeyCodeTime=Date.now(),!($l&&Fs&&t.keyCode==13)))if(t.keyCode!=229&&n.domObserver.forceFlush(),Mm&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let s=Date.now();n.input.lastIOSEnter=s,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==s&&(n.someProp("handleKeyDown",i=>i(n,ku(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",s=>s(n,t))||QQ(n,t)?t.preventDefault():_d(n,"key")};Oi.keyup=(n,e)=>{e.keyCode==16&&(n.input.shiftKey=!1)};Oi.keypress=(n,e)=>{let t=e;if(y5(n,t)||!t.charCode||t.ctrlKey&&!t.altKey||no&&t.metaKey)return;if(n.someProp("handleKeyPress",i=>i(n,t))){t.preventDefault();return}let s=n.state.selection;if(!(s instanceof ut)||!s.$from.sameParent(s.$to)){let i=String.fromCharCode(t.charCode),r=()=>n.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!n.someProp("handleTextInput",o=>o(n,s.$from.pos,s.$to.pos,i,r))&&n.dispatch(r()),t.preventDefault()}};function LS(n){return{left:n.clientX,top:n.clientY}}function uZ(n,e){let t=e.x-n.clientX,s=e.y-n.clientY;return t*t+s*s<100}function F_(n,e,t,s,i){if(s==-1)return!1;let r=n.state.doc.resolve(s);for(let o=r.depth+1;o>0;o--)if(n.someProp(e,a=>o>r.depth?a(n,t,r.nodeAfter,r.before(o),i,!0):a(n,t,r.node(o),r.before(o),i,!1)))return!0;return!1}function bp(n,e,t){if(n.focused||n.focus(),n.state.selection.eq(e))return;let s=n.state.tr.setSelection(e);s.setMeta("pointer",!0),n.dispatch(s)}function hZ(n,e){if(e==-1)return!1;let t=n.state.doc.resolve(e),s=t.nodeAfter;return s&&s.isAtom&&dt.isSelectable(s)?(bp(n,new dt(t)),!0):!1}function fZ(n,e){if(e==-1)return!1;let t=n.state.selection,s,i;t instanceof dt&&(s=t.node);let r=n.state.doc.resolve(e);for(let o=r.depth+1;o>0;o--){let a=o>r.depth?r.nodeAfter:r.node(o);if(dt.isSelectable(a)){s&&t.$from.depth>0&&o>=t.$from.depth&&r.before(t.$from.depth+1)==t.$from.pos?i=r.before(t.$from.depth):i=r.before(o);break}}return i!=null?(bp(n,dt.create(n.state.doc,i)),!0):!1}function pZ(n,e,t,s,i){return F_(n,"handleClickOn",e,t,s)||n.someProp("handleClick",r=>r(n,e,s))||(i?fZ(n,t):hZ(n,t))}function mZ(n,e,t,s){return F_(n,"handleDoubleClickOn",e,t,s)||n.someProp("handleDoubleClick",i=>i(n,e,s))}function gZ(n,e,t,s){return F_(n,"handleTripleClickOn",e,t,s)||n.someProp("handleTripleClick",i=>i(n,e,s))||xZ(n,t,s)}function xZ(n,e,t){if(t.button!=0)return!1;let s=n.state.doc;if(e==-1)return s.inlineContent?(bp(n,ut.create(s,0,s.content.size)),!0):!1;let i=s.resolve(e);for(let r=i.depth+1;r>0;r--){let o=r>i.depth?i.nodeAfter:i.node(r),a=i.before(r);if(o.inlineContent)bp(n,ut.create(s,a+1,a+1+o.content.size));else if(dt.isSelectable(o))bp(n,dt.create(s,a));else continue;return!0}}function H_(n){return ak(n)}const b5=no?"metaKey":"ctrlKey";Li.mousedown=(n,e)=>{let t=e;n.input.shiftKey=t.shiftKey;let s=H_(n),i=Date.now(),r="singleClick";i-n.input.lastClick.time<500&&uZ(t,n.input.lastClick)&&!t[b5]&&n.input.lastClick.button==t.button&&(n.input.lastClick.type=="singleClick"?r="doubleClick":n.input.lastClick.type=="doubleClick"&&(r="tripleClick")),n.input.lastClick={time:i,x:t.clientX,y:t.clientY,type:r,button:t.button};let o=n.posAtCoords(LS(t));o&&(r=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new bZ(n,o,t,!!s)):(r=="doubleClick"?mZ:gZ)(n,o.pos,o.inside,t)?t.preventDefault():_d(n,"pointer"))};class bZ{constructor(e,t,s,i){this.view=e,this.pos=t,this.event=s,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!s[b5],this.allowDefault=s.shiftKey;let r,o;if(t.inside>-1)r=e.state.doc.nodeAt(t.inside),o=t.inside;else{let f=e.state.doc.resolve(t.pos);r=f.parent,o=f.depth?f.before():0}const a=i?null:s.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:u}=e.state;(s.button==0&&r.type.spec.draggable&&r.type.spec.selectable!==!1||u instanceof dt&&u.from<=o&&u.to>o)&&(this.mightDrag={node:r,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&lo&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),_d(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Wl(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(LS(e))),this.updateAllowDefault(e),this.allowDefault||!t?_d(this.view,"pointer"):pZ(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||vi&&this.mightDrag&&!this.mightDrag.node.isAtom||Fs&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(bp(this.view,mt.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):_d(this.view,"pointer")}move(e){this.updateAllowDefault(e),_d(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Li.touchstart=n=>{n.input.lastTouch=Date.now(),H_(n),_d(n,"pointer")};Li.touchmove=n=>{n.input.lastTouch=Date.now(),_d(n,"pointer")};Li.contextmenu=n=>H_(n);function y5(n,e){return n.composing?!0:vi&&Math.abs(e.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}const yZ=$l?5e3:-1;Oi.compositionstart=Oi.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:e}=n,t=e.selection.$to;if(e.selection instanceof ut&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(s=>s.type.spec.inclusive===!1)||Fs&&J4&&vZ(n)))n.markCursor=n.state.storedMarks||t.marks(),ak(n,!0),n.markCursor=null;else if(ak(n,!e.selection.empty),lo&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let s=n.domSelectionRange();for(let i=s.focusNode,r=s.focusOffset;i&&i.nodeType==1&&r!=0;){let o=r<0?i.lastChild:i.childNodes[r-1];if(!o)break;if(o.nodeType==3){let a=n.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else i=o,r=-1}}n.input.composing=!0}v5(n,yZ)};function vZ(n){let{focusNode:e,focusOffset:t}=n.domSelectionRange();if(!e||e.nodeType!=1||t>=e.childNodes.length)return!1;let s=e.childNodes[t];return s.nodeType==1&&s.contentEditable=="false"}Oi.compositionend=(n,e)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=e.timeStamp,n.input.compositionPendingChanges=n.domObserver.pendingRecords().length?n.input.compositionID:0,n.input.compositionNode=null,n.input.compositionPendingChanges&&Promise.resolve().then(()=>n.domObserver.flush()),n.input.compositionID++,v5(n,20))};function v5(n,e){clearTimeout(n.input.composingTimeout),e>-1&&(n.input.composingTimeout=setTimeout(()=>ak(n),e))}function w5(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=kZ());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}function wZ(n){let e=n.domSelectionRange();if(!e.focusNode)return null;let t=fQ(e.focusNode,e.focusOffset),s=pQ(e.focusNode,e.focusOffset);if(t&&s&&t!=s){let i=s.pmViewDesc,r=n.domObserver.lastChangedTextNode;if(t==r||s==r)return r;if(!i||!i.isText(s.nodeValue))return s;if(n.input.compositionNode==s){let o=t.pmViewDesc;if(!(!o||!o.isText(t.nodeValue)))return s}}return t||s}function kZ(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function ak(n,e=!1){if(!($l&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),w5(n),e||n.docView&&n.docView.dirty){let t=P_(n),s=n.state.selection;return t&&!t.eq(s)?n.dispatch(n.state.tr.setSelection(t)):(n.markCursor||e)&&!s.$from.node(s.$from.sharedDepth(s.to)).inlineContent?n.dispatch(n.state.tr.deleteSelection()):n.updateState(n.state),!0}return!1}}function SZ(n,e){if(!n.dom.parentNode)return;let t=n.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let s=getSelection(),i=document.createRange();i.selectNodeContents(e),n.dom.blur(),s.removeAllRanges(),s.addRange(i),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),n.focus()},50)}const Z0=er&&Id<15||Mm&&bQ<604;Li.copy=Oi.cut=(n,e)=>{let t=e,s=n.state.selection,i=t.type=="cut";if(s.empty)return;let r=Z0?null:t.clipboardData,o=s.content(),{dom:a,text:l}=O_(n,o);r?(t.preventDefault(),r.clearData(),r.setData("text/html",a.innerHTML),r.setData("text/plain",l)):SZ(n,a),i&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function CZ(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function AZ(n,e){if(!n.dom.parentNode)return;let t=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,s=n.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(s.contentEditable="true"),s.style.cssText="position: fixed; left: -10000px; top: 10px",s.focus();let i=n.input.shiftKey&&n.input.lastKeyCode!=45;setTimeout(()=>{n.focus(),s.parentNode&&s.parentNode.removeChild(s),t?ex(n,s.value,null,i,e):ex(n,s.textContent,s.innerHTML,i,e)},50)}function ex(n,e,t,s,i){let r=h5(n,e,t,s,n.state.selection.$from);if(n.someProp("handlePaste",l=>l(n,i,r||Ve.empty)))return!0;if(!r)return!1;let o=CZ(r),a=o?n.state.tr.replaceSelectionWith(o,s):n.state.tr.replaceSelection(r);return n.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function k5(n){let e=n.getData("text/plain")||n.getData("Text");if(e)return e;let t=n.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}Oi.paste=(n,e)=>{let t=e;if(n.composing&&!$l)return;let s=Z0?null:t.clipboardData,i=n.input.shiftKey&&n.input.lastKeyCode!=45;s&&ex(n,k5(s),s.getData("text/html"),i,t)?t.preventDefault():AZ(n,t)};class S5{constructor(e,t,s){this.slice=e,this.move=t,this.node=s}}const NZ=no?"altKey":"ctrlKey";function C5(n,e){let t=n.someProp("dragCopies",s=>!s(e));return t??!e[NZ]}Li.dragstart=(n,e)=>{let t=e,s=n.input.mouseDown;if(s&&s.done(),!t.dataTransfer)return;let i=n.state.selection,r=i.empty?null:n.posAtCoords(LS(t)),o;if(!(r&&r.pos>=i.from&&r.pos<=(i instanceof dt?i.to-1:i.to))){if(s&&s.mightDrag)o=dt.create(n.state.doc,s.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let p=n.docView.nearestDesc(t.target,!0);p&&p.node.type.spec.draggable&&p!=n.docView&&(o=dt.create(n.state.doc,p.posBefore))}}let a=(o||n.state.selection).content(),{dom:l,text:u,slice:f}=O_(n,a);(!t.dataTransfer.files.length||!Fs||Y4>120)&&t.dataTransfer.clearData(),t.dataTransfer.setData(Z0?"Text":"text/html",l.innerHTML),t.dataTransfer.effectAllowed="copyMove",Z0||t.dataTransfer.setData("text/plain",u),n.dragging=new S5(f,C5(n,t),o)};Li.dragend=n=>{let e=n.dragging;window.setTimeout(()=>{n.dragging==e&&(n.dragging=null)},50)};Oi.dragover=Oi.dragenter=(n,e)=>e.preventDefault();Oi.drop=(n,e)=>{try{EZ(n,e,n.dragging)}finally{n.dragging=null}};function EZ(n,e,t){if(!e.dataTransfer)return;let s=n.posAtCoords(LS(e));if(!s)return;let i=n.state.doc.resolve(s.pos),r=t&&t.slice;r?n.someProp("transformPasted",b=>{r=b(r,n,!1)}):r=h5(n,k5(e.dataTransfer),Z0?null:e.dataTransfer.getData("text/html"),!1,i);let o=!!(t&&C5(n,e));if(n.someProp("handleDrop",b=>b(n,e,r||Ve.empty,o))){e.preventDefault();return}if(!r)return;e.preventDefault();let a=r?F4(n.state.doc,i.pos,r):i.pos;a==null&&(a=i.pos);let l=n.state.tr;if(o){let{node:b}=t;b?b.replace(l):l.deleteSelection()}let u=l.mapping.map(a),f=r.openStart==0&&r.openEnd==0&&r.content.childCount==1,p=l.doc;if(f?l.replaceRangeWith(u,u,r.content.firstChild):l.replaceRange(u,u,r),l.doc.eq(p))return;let g=l.doc.resolve(u);if(f&&dt.isSelectable(r.content.firstChild)&&g.nodeAfter&&g.nodeAfter.sameMarkup(r.content.firstChild))l.setSelection(new dt(g));else{let b=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((w,S,N,C)=>b=C),l.setSelection(L_(n,g,l.doc.resolve(b)))}n.focus(),n.dispatch(l.setMeta("uiEvent","drop"))}Li.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&Wl(n)},20))};Li.blur=(n,e)=>{let t=e;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),t.relatedTarget&&n.dom.contains(t.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)};Li.beforeinput=(n,e)=>{if(Fs&&$l&&e.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:s}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=s||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",r=>r(n,ku(8,"Backspace")))))return;let{$cursor:i}=n.state.selection;i&&i.pos>0&&n.dispatch(n.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let n in Oi)Li[n]=Oi[n];function tx(n,e){if(n==e)return!0;for(let t in n)if(n[t]!==e[t])return!1;for(let t in e)if(!(t in n))return!1;return!0}class lk{constructor(e,t){this.toDOM=e,this.spec=t||Ph,this.side=this.spec.side||0}map(e,t,s,i){let{pos:r,deleted:o}=e.mapResult(t.from+i,this.side<0?-1:1);return o?null:new yi(r-s,r-s,this)}valid(){return!0}eq(e){return this==e||e instanceof lk&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&tx(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Dd{constructor(e,t){this.attrs=e,this.spec=t||Ph}map(e,t,s,i){let r=e.map(t.from+i,this.spec.inclusiveStart?-1:1)-s,o=e.map(t.to+i,this.spec.inclusiveEnd?1:-1)-s;return r>=o?null:new yi(r,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof Dd&&tx(this.attrs,e.attrs)&&tx(this.spec,e.spec)}static is(e){return e.type instanceof Dd}destroy(){}}class U_{constructor(e,t){this.attrs=e,this.spec=t||Ph}map(e,t,s,i){let r=e.mapResult(t.from+i,1);if(r.deleted)return null;let o=e.mapResult(t.to+i,-1);return o.deleted||o.pos<=r.pos?null:new yi(r.pos-s,o.pos-s,this)}valid(e,t){let{index:s,offset:i}=e.content.findIndex(t.from),r;return i==t.from&&!(r=e.child(s)).isText&&i+r.nodeSize==t.to}eq(e){return this==e||e instanceof U_&&tx(this.attrs,e.attrs)&&tx(this.spec,e.spec)}destroy(){}}class yi{constructor(e,t,s){this.from=e,this.to=t,this.type=s}copy(e,t){return new yi(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,s){return this.type.map(e,this,t,s)}static widget(e,t,s){return new yi(e,e,new lk(t,s))}static inline(e,t,s,i){return new yi(e,t,new Dd(s,i))}static node(e,t,s,i){return new yi(e,t,new U_(s,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Dd}get widget(){return this.type instanceof lk}}const Xf=[],Ph={};class Bn{constructor(e,t){this.local=e.length?e:Xf,this.children=t.length?t:Xf}static create(e,t){return t.length?ck(t,e,0,Ph):mi}find(e,t,s){let i=[];return this.findInner(e??0,t??1e9,i,0,s),i}findInner(e,t,s,i,r){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=t&&a.to>=e&&(!r||r(a.spec))&&s.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,t-a,s,i+a,r)}}map(e,t,s){return this==mi||e.maps.length==0?this:this.mapInner(e,t,0,0,s||Ph)}mapInner(e,t,s,i,r){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,s,i);l&&l.type.valid(t,l)?(o||(o=[])).push(l):r.onRemove&&r.onRemove(this.local[a].spec)}return this.children.length?TZ(this.children,o||[],e,t,s,i,r):o?new Bn(o.sort(Lh),Xf):mi}add(e,t){return t.length?this==mi?Bn.create(e,t):this.addInner(e,t,0):this}addInner(e,t,s){let i,r=0;e.forEach((a,l)=>{let u=l+s,f;if(f=N5(t,a,u)){for(i||(i=this.children.slice());r<i.length&&i[r]<l;)r+=3;i[r]==l?i[r+2]=i[r+2].addInner(a,f,u+1):i.splice(r,0,l,l+a.nodeSize,ck(f,a,u+1,Ph)),r+=3}});let o=A5(r?E5(t):t,-s);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new Bn(o.length?this.local.concat(o).sort(Lh):this.local,i||this.children)}remove(e){return e.length==0||this==mi?this:this.removeInner(e,0)}removeInner(e,t){let s=this.children,i=this.local;for(let r=0;r<s.length;r+=3){let o,a=s[r]+t,l=s[r+1]+t;for(let f=0,p;f<e.length;f++)(p=e[f])&&p.from>a&&p.to<l&&(e[f]=null,(o||(o=[])).push(p));if(!o)continue;s==this.children&&(s=this.children.slice());let u=s[r+2].removeInner(o,a+1);u!=mi?s[r+2]=u:(s.splice(r,3),r-=3)}if(i.length){for(let r=0,o;r<e.length;r++)if(o=e[r])for(let a=0;a<i.length;a++)i[a].eq(o,t)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return s==this.children&&i==this.local?this:i.length||s.length?new Bn(i,s):mi}forChild(e,t){if(this==mi)return this;if(t.isLeaf)return Bn.empty;let s,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(s=this.children[a+2]);break}let r=e+1,o=r+t.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>r&&l.type instanceof Dd){let u=Math.max(r,l.from)-r,f=Math.min(o,l.to)-r;u<f&&(i||(i=[])).push(l.copy(u,f))}}if(i){let a=new Bn(i.sort(Lh),Xf);return s?new qc([a,s]):a}return s||mi}eq(e){if(this==e)return!0;if(!(e instanceof Bn)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return $_(this.localsInner(e))}localsInner(e){if(this==mi)return Xf;if(e.inlineContent||!this.local.some(Dd.is))return this.local;let t=[];for(let s=0;s<this.local.length;s++)this.local[s].type instanceof Dd||t.push(this.local[s]);return t}forEachSet(e){e(this)}}Bn.empty=new Bn([],[]);Bn.removeOverlap=$_;const mi=Bn.empty;class qc{constructor(e){this.members=e}map(e,t){const s=this.members.map(i=>i.map(e,t,Ph));return qc.from(s)}forChild(e,t){if(t.isLeaf)return Bn.empty;let s=[];for(let i=0;i<this.members.length;i++){let r=this.members[i].forChild(e,t);r!=mi&&(r instanceof qc?s=s.concat(r.members):s.push(r))}return qc.from(s)}eq(e){if(!(e instanceof qc)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,s=!0;for(let i=0;i<this.members.length;i++){let r=this.members[i].localsInner(e);if(r.length)if(!t)t=r;else{s&&(t=t.slice(),s=!1);for(let o=0;o<r.length;o++)t.push(r[o])}}return t?$_(s?t:t.sort(Lh)):Xf}static from(e){switch(e.length){case 0:return mi;case 1:return e[0];default:return new qc(e.every(t=>t instanceof Bn)?e:e.reduce((t,s)=>t.concat(s instanceof Bn?s:s.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function TZ(n,e,t,s,i,r,o){let a=n.slice();for(let u=0,f=r;u<t.maps.length;u++){let p=0;t.maps[u].forEach((g,b,w,S)=>{let N=S-w-(b-g);for(let C=0;C<a.length;C+=3){let M=a[C+1];if(M<0||g>M+f-p)continue;let R=a[C]+f-p;b>=R?a[C+1]=g<=R?-2:-1:g>=f&&N&&(a[C]+=N,a[C+1]+=N)}p+=N}),f=t.maps[u].map(f,-1)}let l=!1;for(let u=0;u<a.length;u+=3)if(a[u+1]<0){if(a[u+1]==-2){l=!0,a[u+1]=-1;continue}let f=t.map(n[u]+r),p=f-i;if(p<0||p>=s.content.size){l=!0;continue}let g=t.map(n[u+1]+r,-1),b=g-i,{index:w,offset:S}=s.content.findIndex(p),N=s.maybeChild(w);if(N&&S==p&&S+N.nodeSize==b){let C=a[u+2].mapInner(t,N,f+1,n[u]+r+1,o);C!=mi?(a[u]=p,a[u+1]=b,a[u+2]=C):(a[u+1]=-2,l=!0)}else l=!0}if(l){let u=_Z(a,n,e,t,i,r,o),f=ck(u,s,0,o);e=f.local;for(let p=0;p<a.length;p+=3)a[p+1]<0&&(a.splice(p,3),p-=3);for(let p=0,g=0;p<f.children.length;p+=3){let b=f.children[p];for(;g<a.length&&a[g]<b;)g+=3;a.splice(g,0,f.children[p],f.children[p+1],f.children[p+2])}}return new Bn(e.sort(Lh),a)}function A5(n,e){if(!e||!n.length)return n;let t=[];for(let s=0;s<n.length;s++){let i=n[s];t.push(new yi(i.from+e,i.to+e,i.type))}return t}function _Z(n,e,t,s,i,r,o){function a(l,u){for(let f=0;f<l.local.length;f++){let p=l.local[f].map(s,i,u);p?t.push(p):o.onRemove&&o.onRemove(l.local[f].spec)}for(let f=0;f<l.children.length;f+=3)a(l.children[f+2],l.children[f]+u+1)}for(let l=0;l<n.length;l+=3)n[l+1]==-1&&a(n[l+2],e[l]+r+1);return t}function N5(n,e,t){if(e.isLeaf)return null;let s=t+e.nodeSize,i=null;for(let r=0,o;r<n.length;r++)(o=n[r])&&o.from>t&&o.to<s&&((i||(i=[])).push(o),n[r]=null);return i}function E5(n){let e=[];for(let t=0;t<n.length;t++)n[t]!=null&&e.push(n[t]);return e}function ck(n,e,t,s){let i=[],r=!1;e.forEach((a,l)=>{let u=N5(n,a,l+t);if(u){r=!0;let f=ck(u,a,t+l+1,s);f!=mi&&i.push(l,l+a.nodeSize,f)}});let o=A5(r?E5(n):n,-t).sort(Lh);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(s.onRemove&&s.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new Bn(o,i):mi}function Lh(n,e){return n.from-e.from||n.to-e.to}function $_(n){let e=n;for(let t=0;t<e.length-1;t++){let s=e[t];if(s.from!=s.to)for(let i=t+1;i<e.length;i++){let r=e[i];if(r.from==s.from){r.to!=s.to&&(e==n&&(e=n.slice()),e[i]=r.copy(r.from,s.to),jP(e,i+1,r.copy(s.to,r.to)));continue}else{r.from<s.to&&(e==n&&(e=n.slice()),e[t]=s.copy(s.from,r.from),jP(e,i,s.copy(r.from,s.to)));break}}}return e}function jP(n,e,t){for(;e<n.length&&Lh(t,n[e])>0;)e++;n.splice(e,0,t)}function OA(n){let e=[];return n.someProp("decorations",t=>{let s=t(n.state);s&&s!=mi&&e.push(s)}),n.cursorWrapper&&e.push(Bn.create(n.state.doc,[n.cursorWrapper.deco])),qc.from(e)}const MZ={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},RZ=er&&Id<=11;class IZ{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class zZ{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new IZ,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(s=>{for(let i=0;i<s.length;i++)this.queue.push(s[i]);er&&Id<=11&&s.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),RZ&&(this.onCharData=s=>{this.queue.push({target:s.target,type:"characterData",oldValue:s.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,MZ)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(EP(this.view)){if(this.suppressingSelectionUpdates)return Wl(this.view);if(er&&Id<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Vh(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,s;for(let r=e.focusNode;r;r=_m(r))t.add(r);for(let r=e.anchorNode;r;r=_m(r))if(t.has(r)){s=r;break}let i=s&&this.view.docView.nearestDesc(s);if(i&&i.ignoreMutation({type:"selection",target:s.nodeType==3?s.parentNode:s}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let s=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(s)&&EP(e)&&!this.ignoreSelectionChange(s),r=-1,o=-1,a=!1,l=[];if(e.editable)for(let f=0;f<t.length;f++){let p=this.registerMutation(t[f],l);p&&(r=r<0?p.from:Math.min(p.from,r),o=o<0?p.to:Math.max(p.to,o),p.typeOver&&(a=!0))}if(lo&&l.length){let f=l.filter(p=>p.nodeName=="BR");if(f.length==2){let[p,g]=f;p.parentNode&&p.parentNode.parentNode==g.parentNode?g.remove():p.remove()}else{let{focusNode:p}=this.currentSelection;for(let g of f){let b=g.parentNode;b&&b.nodeName=="LI"&&(!p||PZ(e,p)!=b)&&g.remove()}}}else if((Fs||vi)&&l.some(f=>f.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let f of l)if(f.nodeName=="BR"&&f.parentNode){let p=f.nextSibling;p&&p.nodeType==1&&p.contentEditable=="false"&&f.parentNode.removeChild(f)}}let u=null;r<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&jS(s)&&(u=P_(e))&&u.eq(mt.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Wl(e),this.currentSelection.set(s),e.scrollToSelection()):(r>-1||i)&&(r>-1&&(e.docView.markDirty(r,o),DZ(e)),this.handleDOMChange(r,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(s)||Wl(e),this.currentSelection.set(s))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let s=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(s==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!s||s.ignoreMutation(e))return null;if(e.type=="childList"){for(let f=0;f<e.addedNodes.length;f++){let p=e.addedNodes[f];t.push(p),p.nodeType==3&&(this.lastChangedTextNode=p)}if(s.contentDOM&&s.contentDOM!=s.dom&&!s.contentDOM.contains(e.target))return{from:s.posBefore,to:s.posAfter};let i=e.previousSibling,r=e.nextSibling;if(er&&Id<=11&&e.addedNodes.length)for(let f=0;f<e.addedNodes.length;f++){let{previousSibling:p,nextSibling:g}=e.addedNodes[f];(!p||Array.prototype.indexOf.call(e.addedNodes,p)<0)&&(i=p),(!g||Array.prototype.indexOf.call(e.addedNodes,g)<0)&&(r=g)}let o=i&&i.parentNode==e.target?si(i)+1:0,a=s.localPosFromDOM(e.target,o,-1),l=r&&r.parentNode==e.target?si(r):e.target.childNodes.length,u=s.localPosFromDOM(e.target,l,1);return{from:a,to:u}}else return e.type=="attributes"?{from:s.posAtStart-s.border,to:s.posAtEnd+s.border}:(this.lastChangedTextNode=e.target,{from:s.posAtStart,to:s.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let PP=new WeakMap,LP=!1;function DZ(n){if(!PP.has(n)&&(PP.set(n,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(n.dom).whiteSpace)!==-1)){if(n.requiresGeckoHackNode=lo,LP)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),LP=!0}}function OP(n,e){let t=e.startContainer,s=e.startOffset,i=e.endContainer,r=e.endOffset,o=n.domAtPos(n.state.selection.anchor);return Vh(o.node,o.offset,i,r)&&([t,s,i,r]=[i,r,t,s]),{anchorNode:t,anchorOffset:s,focusNode:i,focusOffset:r}}function jZ(n,e){if(e.getComposedRanges){let i=e.getComposedRanges(n.root)[0];if(i)return OP(n,i)}let t;function s(i){i.preventDefault(),i.stopImmediatePropagation(),t=i.getTargetRanges()[0]}return n.dom.addEventListener("beforeinput",s,!0),document.execCommand("indent"),n.dom.removeEventListener("beforeinput",s,!0),t?OP(n,t):null}function PZ(n,e){for(let t=e.parentNode;t&&t!=n.dom;t=t.parentNode){let s=n.docView.nearestDesc(t,!0);if(s&&s.node.isBlock)return t}return null}function LZ(n,e,t){let{node:s,fromOffset:i,toOffset:r,from:o,to:a}=n.docView.parseRange(e,t),l=n.domSelectionRange(),u,f=l.anchorNode;if(f&&n.dom.contains(f.nodeType==1?f:f.parentNode)&&(u=[{node:f,offset:l.anchorOffset}],jS(l)||u.push({node:l.focusNode,offset:l.focusOffset})),Fs&&n.input.lastKeyCode===8)for(let N=r;N>i;N--){let C=s.childNodes[N-1],M=C.pmViewDesc;if(C.nodeName=="BR"&&!M){r=N;break}if(!M||M.size)break}let p=n.state.doc,g=n.someProp("domParser")||C0.fromSchema(n.state.schema),b=p.resolve(o),w=null,S=g.parse(s,{topNode:b.parent,topMatch:b.parent.contentMatchAt(b.index()),topOpen:!0,from:i,to:r,preserveWhitespace:b.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:OZ,context:b});if(u&&u[0].pos!=null){let N=u[0].pos,C=u[1]&&u[1].pos;C==null&&(C=N),w={anchor:N+o,head:C+o}}return{doc:S,sel:w,from:o,to:a}}function OZ(n){let e=n.pmViewDesc;if(e)return e.parseRule();if(n.nodeName=="BR"&&n.parentNode){if(vi&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(n.parentNode.lastChild==n||vi&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if(n.nodeName=="IMG"&&n.getAttribute("mark-placeholder"))return{ignore:!0};return null}const BZ=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function FZ(n,e,t,s,i){let r=n.input.compositionPendingChanges||(n.composing?n.input.compositionID:0);if(n.input.compositionPendingChanges=0,e<0){let D=n.input.lastSelectionTime>Date.now()-50?n.input.lastSelectionOrigin:null,U=P_(n,D);if(U&&!n.state.selection.eq(U)){if(Fs&&$l&&n.input.lastKeyCode===13&&Date.now()-100<n.input.lastKeyCodeTime&&n.someProp("handleKeyDown",q=>q(n,ku(13,"Enter"))))return;let V=n.state.tr.setSelection(U);D=="pointer"?V.setMeta("pointer",!0):D=="key"&&V.scrollIntoView(),r&&V.setMeta("composition",r),n.dispatch(V)}return}let o=n.state.doc.resolve(e),a=o.sharedDepth(t);e=o.before(a+1),t=n.state.doc.resolve(t).after(a+1);let l=n.state.selection,u=LZ(n,e,t),f=n.state.doc,p=f.slice(u.from,u.to),g,b;n.input.lastKeyCode===8&&Date.now()-100<n.input.lastKeyCodeTime?(g=n.state.selection.to,b="end"):(g=n.state.selection.from,b="start"),n.input.lastKeyCode=null;let w=$Z(p.content,u.doc.content,u.from,g,b);if(w&&n.input.domChangeCount++,(Mm&&n.input.lastIOSEnter>Date.now()-225||$l)&&i.some(D=>D.nodeType==1&&!BZ.test(D.nodeName))&&(!w||w.endA>=w.endB)&&n.someProp("handleKeyDown",D=>D(n,ku(13,"Enter")))){n.input.lastIOSEnter=0;return}if(!w)if(s&&l instanceof ut&&!l.empty&&l.$head.sameParent(l.$anchor)&&!n.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))w={start:l.from,endA:l.to,endB:l.to};else{if(u.sel){let D=BP(n,n.state.doc,u.sel);if(D&&!D.eq(n.state.selection)){let U=n.state.tr.setSelection(D);r&&U.setMeta("composition",r),n.dispatch(U)}}return}n.state.selection.from<n.state.selection.to&&w.start==w.endB&&n.state.selection instanceof ut&&(w.start>n.state.selection.from&&w.start<=n.state.selection.from+2&&n.state.selection.from>=u.from?w.start=n.state.selection.from:w.endA<n.state.selection.to&&w.endA>=n.state.selection.to-2&&n.state.selection.to<=u.to&&(w.endB+=n.state.selection.to-w.endA,w.endA=n.state.selection.to)),er&&Id<=11&&w.endB==w.start+1&&w.endA==w.start&&w.start>u.from&&u.doc.textBetween(w.start-u.from-1,w.start-u.from+1)==" "&&(w.start--,w.endA--,w.endB--);let S=u.doc.resolveNoCache(w.start-u.from),N=u.doc.resolveNoCache(w.endB-u.from),C=f.resolve(w.start),M=S.sameParent(N)&&S.parent.inlineContent&&C.end()>=w.endA;if((Mm&&n.input.lastIOSEnter>Date.now()-225&&(!M||i.some(D=>D.nodeName=="DIV"||D.nodeName=="P"))||!M&&S.pos<u.doc.content.size&&(!S.sameParent(N)||!S.parent.inlineContent)&&S.pos<N.pos&&!/\S/.test(u.doc.textBetween(S.pos,N.pos,"","")))&&n.someProp("handleKeyDown",D=>D(n,ku(13,"Enter")))){n.input.lastIOSEnter=0;return}if(n.state.selection.anchor>w.start&&UZ(f,w.start,w.endA,S,N)&&n.someProp("handleKeyDown",D=>D(n,ku(8,"Backspace")))){$l&&Fs&&n.domObserver.suppressSelectionUpdates();return}Fs&&w.endB==w.start&&(n.input.lastChromeDelete=Date.now()),$l&&!M&&S.start()!=N.start()&&N.parentOffset==0&&S.depth==N.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==w.endA&&(w.endB-=2,N=u.doc.resolveNoCache(w.endB-u.from),setTimeout(()=>{n.someProp("handleKeyDown",function(D){return D(n,ku(13,"Enter"))})},20));let R=w.start,_=w.endA,j=D=>{let U=D||n.state.tr.replace(R,_,u.doc.slice(w.start-u.from,w.endB-u.from));if(u.sel){let V=BP(n,U.doc,u.sel);V&&!(Fs&&n.composing&&V.empty&&(w.start!=w.endB||n.input.lastChromeDelete<Date.now()-100)&&(V.head==R||V.head==U.mapping.map(_)-1)||er&&V.empty&&V.head==R)&&U.setSelection(V)}return r&&U.setMeta("composition",r),U.scrollIntoView()},P;if(M)if(S.pos==N.pos){er&&Id<=11&&S.parentOffset==0&&(n.domObserver.suppressSelectionUpdates(),setTimeout(()=>Wl(n),20));let D=j(n.state.tr.delete(R,_)),U=f.resolve(w.start).marksAcross(f.resolve(w.endA));U&&D.ensureMarks(U),n.dispatch(D)}else if(w.endA==w.endB&&(P=HZ(S.parent.content.cut(S.parentOffset,N.parentOffset),C.parent.content.cut(C.parentOffset,w.endA-C.start())))){let D=j(n.state.tr);P.type=="add"?D.addMark(R,_,P.mark):D.removeMark(R,_,P.mark),n.dispatch(D)}else if(S.parent.child(S.index()).isText&&S.index()==N.index()-(N.textOffset?0:1)){let D=S.parent.textBetween(S.parentOffset,N.parentOffset),U=()=>j(n.state.tr.insertText(D,R,_));n.someProp("handleTextInput",V=>V(n,R,_,D,U))||n.dispatch(U())}else n.dispatch(j());else n.dispatch(j())}function BP(n,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:L_(n,e.resolve(t.anchor),e.resolve(t.head))}function HZ(n,e){let t=n.firstChild.marks,s=e.firstChild.marks,i=t,r=s,o,a,l;for(let f=0;f<s.length;f++)i=s[f].removeFromSet(i);for(let f=0;f<t.length;f++)r=t[f].removeFromSet(r);if(i.length==1&&r.length==0)a=i[0],o="add",l=f=>f.mark(a.addToSet(f.marks));else if(i.length==0&&r.length==1)a=r[0],o="remove",l=f=>f.mark(a.removeFromSet(f.marks));else return null;let u=[];for(let f=0;f<e.childCount;f++)u.push(l(e.child(f)));if(Ie.from(u).eq(n))return{mark:a,type:o}}function UZ(n,e,t,s,i){if(t-e<=i.pos-s.pos||BA(s,!0,!1)<i.pos)return!1;let r=n.resolve(e);if(!s.parent.isTextblock){let a=r.nodeAfter;return a!=null&&t==e+a.nodeSize}if(r.parentOffset<r.parent.content.size||!r.parent.isTextblock)return!1;let o=n.resolve(BA(r,!0,!0));return!o.parent.isTextblock||o.pos>t||BA(o,!0,!1)<t?!1:s.parent.content.cut(s.parentOffset).eq(o.parent.content)}function BA(n,e,t){let s=n.depth,i=e?n.end():n.pos;for(;s>0&&(e||n.indexAfter(s)==n.node(s).childCount);)s--,i++,e=!1;if(t){let r=n.node(s).maybeChild(n.indexAfter(s));for(;r&&!r.isLeaf;)r=r.firstChild,i++}return i}function $Z(n,e,t,s,i){let r=n.findDiffStart(e,t);if(r==null)return null;let{a:o,b:a}=n.findDiffEnd(e,t+n.size,t+e.size);if(i=="end"){let l=Math.max(0,r-Math.min(o,a));s-=o+l-r}if(o<r&&n.size<e.size){let l=s<=r&&s>=o?r-s:0;r-=l,r&&r<e.size&&FP(e.textBetween(r-1,r+1))&&(r+=l?1:-1),a=r+(a-o),o=r}else if(a<r){let l=s<=r&&s>=a?r-s:0;r-=l,r&&r<n.size&&FP(n.textBetween(r-1,r+1))&&(r+=l?1:-1),o=r+(o-a),a=r}return{start:r,endA:o,endB:a}}function FP(n){if(n.length!=2)return!1;let e=n.charCodeAt(0),t=n.charCodeAt(1);return e>=56320&&e<=57343&&t>=55296&&t<=56319}class T5{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new oZ,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(VP),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=$P(this),UP(this),this.nodeViews=GP(this),this.docView=wP(this.state.doc,HP(this),OA(this),this.dom,this),this.domObserver=new zZ(this,(s,i,r,o)=>FZ(this,s,i,r,o)),this.domObserver.start(),aZ(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&dE(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(VP),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let s in this._props)t[s]=this._props[s];t.state=this.state;for(let s in e)t[s]=e[s];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var s;let i=this.state,r=!1,o=!1;e.storedMarks&&this.composing&&(w5(this),o=!0),this.state=e;let a=i.plugins!=e.plugins||this._props.plugins!=t.plugins;if(a||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let b=GP(this);VZ(b,this.nodeViews)&&(this.nodeViews=b,r=!0)}(a||t.handleDOMEvents!=this._props.handleDOMEvents)&&dE(this),this.editable=$P(this),UP(this);let l=OA(this),u=HP(this),f=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",p=r||!this.docView.matchesNode(e.doc,u,l);(p||!e.selection.eq(i.selection))&&(o=!0);let g=f=="preserve"&&o&&this.dom.style.overflowAnchor==null&&wQ(this);if(o){this.domObserver.stop();let b=p&&(er||Fs)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&GZ(i.selection,e.selection);if(p){let w=Fs?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=wZ(this)),(r||!this.docView.update(e.doc,u,l,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=wP(e.doc,u,l,this.dom,this)),w&&!this.trackWrites&&(b=!0)}b||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&VQ(this))?Wl(this,b):(c5(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((s=this.dragging)===null||s===void 0)&&s.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),f=="reset"?this.dom.scrollTop=0:f=="to selection"?this.scrollToSelection():g&&kQ(g)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof dt){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&mP(this,t.getBoundingClientRect(),e)}else mP(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let s=this.directPlugins[t];s.spec.view&&this.pluginViews.push(s.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let s=this.state.plugins[t];s.spec.view&&this.pluginViews.push(s.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let s=this.pluginViews[t];s.update&&s.update(this,e)}}updateDraggedNode(e,t){let s=e.node,i=-1;if(this.state.doc.nodeAt(s.from)==s.node)i=s.from;else{let r=s.from+(this.state.doc.content.size-t.doc.content.size);(r>0&&this.state.doc.nodeAt(r))==s.node&&(i=r)}this.dragging=new S5(e.slice,e.move,i<0?void 0:dt.create(this.state.doc,i))}someProp(e,t){let s=this._props&&this._props[e],i;if(s!=null&&(i=t?t(s):s))return i;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(i=t?t(a):a))return i}let r=this.state.plugins;if(r)for(let o=0;o<r.length;o++){let a=r[o].props[e];if(a!=null&&(i=t?t(a):a))return i}}hasFocus(){if(er){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&SQ(this.dom),Wl(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}updateRoot(){this._root=null}posAtCoords(e){return TQ(this,e)}coordsAtPos(e,t=1){return t5(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,s=-1){let i=this.docView.posFromDOM(e,t,s);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,t){return zQ(this,t||this.state,e)}pasteHTML(e,t){return ex(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return ex(this,e,null,!0,t||new ClipboardEvent("paste"))}serializeForClipboard(e){return O_(this,e)}destroy(){this.docView&&(lZ(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],OA(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,uQ())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return dZ(this,e)}domSelectionRange(){let e=this.domSelection();return e?vi&&this.root.nodeType===11&&gQ(this.dom.ownerDocument)==this.dom&&jZ(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}T5.prototype.dispatch=function(n){let e=this._props.dispatchTransaction;e?e.call(this,n):this.updateState(this.state.apply(n))};function HP(n){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(n.editable),n.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(n.state)),t)for(let s in t)s=="class"?e.class+=" "+t[s]:s=="style"?e.style=(e.style?e.style+";":"")+t[s]:!e[s]&&s!="contenteditable"&&s!="nodeName"&&(e[s]=String(t[s]))}),e.translate||(e.translate="no"),[yi.node(0,n.state.doc.content.size,e)]}function UP(n){if(n.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),n.cursorWrapper={dom:e,deco:yi.widget(n.state.selection.from,e,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function $P(n){return!n.someProp("editable",e=>e(n.state)===!1)}function GZ(n,e){let t=Math.min(n.$anchor.sharedDepth(n.head),e.$anchor.sharedDepth(e.head));return n.$anchor.start(t)!=e.$anchor.start(t)}function GP(n){let e=Object.create(null);function t(s){for(let i in s)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=s[i])}return n.someProp("nodeViews",t),n.someProp("markViews",t),e}function VZ(n,e){let t=0,s=0;for(let i in n){if(n[i]!=e[i])return!0;t++}for(let i in e)s++;return t!=s}function VP(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Pd={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},dk={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},qZ=typeof navigator<"u"&&/Mac/.test(navigator.platform),WZ=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var ii=0;ii<10;ii++)Pd[48+ii]=Pd[96+ii]=String(ii);for(var ii=1;ii<=24;ii++)Pd[ii+111]="F"+ii;for(var ii=65;ii<=90;ii++)Pd[ii]=String.fromCharCode(ii+32),dk[ii]=String.fromCharCode(ii);for(var FA in Pd)dk.hasOwnProperty(FA)||(dk[FA]=Pd[FA]);function KZ(n){var e=qZ&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||WZ&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",t=!e&&n.key||(n.shiftKey?dk:Pd)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}const YZ=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),JZ=typeof navigator<"u"&&/Win/.test(navigator.platform);function XZ(n){let e=n.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let s,i,r,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))s=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))r=!0;else if(/^mod$/i.test(l))YZ?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return s&&(t="Alt-"+t),i&&(t="Ctrl-"+t),o&&(t="Meta-"+t),r&&(t="Shift-"+t),t}function QZ(n){let e=Object.create(null);for(let t in n)e[XZ(t)]=n[t];return e}function HA(n,e,t=!0){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t&&e.shiftKey&&(n="Shift-"+n),n}function ZZ(n){return new Jn({props:{handleKeyDown:G_(n)}})}function G_(n){let e=QZ(n);return function(t,s){let i=KZ(s),r,o=e[HA(i,s)];if(o&&o(t.state,t.dispatch,t))return!0;if(i.length==1&&i!=" "){if(s.shiftKey){let a=e[HA(i,s,!1)];if(a&&a(t.state,t.dispatch,t))return!0}if((s.altKey||s.metaKey||s.ctrlKey)&&!(JZ&&s.ctrlKey&&s.altKey)&&(r=Pd[s.keyCode])&&r!=i){let a=e[HA(r,s)];if(a&&a(t.state,t.dispatch,t))return!0}}return!1}}const V_=(n,e)=>n.selection.empty?!1:(e&&e(n.tr.deleteSelection().scrollIntoView()),!0);function _5(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("backward",n):t.parentOffset>0)?null:t}const M5=(n,e,t)=>{let s=_5(n,t);if(!s)return!1;let i=q_(s);if(!i){let o=s.blockRange(),a=o&&Gm(o);return a==null?!1:(e&&e(n.tr.lift(o,a).scrollIntoView()),!0)}let r=i.nodeBefore;if(B5(n,i,e,-1))return!0;if(s.parent.content.size==0&&(Rm(r,"end")||dt.isSelectable(r)))for(let o=s.depth;;o--){let a=zS(n.doc,s.before(o),s.after(o),Ve.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=n.tr.step(a);l.setSelection(Rm(r,"end")?mt.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):dt.create(l.doc,i.pos-r.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||s.node(o-1).childCount>1)break}return r.isAtom&&i.depth==s.depth-1?(e&&e(n.tr.delete(i.pos-r.nodeSize,i.pos).scrollIntoView()),!0):!1},eee=(n,e,t)=>{let s=_5(n,t);if(!s)return!1;let i=q_(s);return i?R5(n,i,e):!1},tee=(n,e,t)=>{let s=z5(n,t);if(!s)return!1;let i=W_(s);return i?R5(n,i,e):!1};function R5(n,e,t){let s=e.nodeBefore,i=s,r=e.pos-1;for(;!i.isTextblock;r--){if(i.type.spec.isolating)return!1;let f=i.lastChild;if(!f)return!1;i=f}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let f=a.firstChild;if(!f)return!1;a=f}let u=zS(n.doc,r,l,Ve.empty);if(!u||u.from!=r||u instanceof Bs&&u.slice.size>=l-r)return!1;if(t){let f=n.tr.step(u);f.setSelection(ut.create(f.doc,r)),t(f.scrollIntoView())}return!0}function Rm(n,e,t=!1){for(let s=n;s;s=e=="start"?s.firstChild:s.lastChild){if(s.isTextblock)return!0;if(t&&s.childCount!=1)return!1}return!1}const I5=(n,e,t)=>{let{$head:s,empty:i}=n.selection,r=s;if(!i)return!1;if(s.parent.isTextblock){if(t?!t.endOfTextblock("backward",n):s.parentOffset>0)return!1;r=q_(s)}let o=r&&r.nodeBefore;return!o||!dt.isSelectable(o)?!1:(e&&e(n.tr.setSelection(dt.create(n.doc,r.pos-o.nodeSize)).scrollIntoView()),!0)};function q_(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){if(n.index(e)>0)return n.doc.resolve(n.before(e+1));if(n.node(e).type.spec.isolating)break}return null}function z5(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("forward",n):t.parentOffset<t.parent.content.size)?null:t}const D5=(n,e,t)=>{let s=z5(n,t);if(!s)return!1;let i=W_(s);if(!i)return!1;let r=i.nodeAfter;if(B5(n,i,e,1))return!0;if(s.parent.content.size==0&&(Rm(r,"start")||dt.isSelectable(r))){let o=zS(n.doc,s.before(),s.after(),Ve.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=n.tr.step(o);a.setSelection(Rm(r,"start")?mt.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):dt.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}}return r.isAtom&&i.depth==s.depth-1?(e&&e(n.tr.delete(i.pos,i.pos+r.nodeSize).scrollIntoView()),!0):!1},j5=(n,e,t)=>{let{$head:s,empty:i}=n.selection,r=s;if(!i)return!1;if(s.parent.isTextblock){if(t?!t.endOfTextblock("forward",n):s.parentOffset<s.parent.content.size)return!1;r=W_(s)}let o=r&&r.nodeAfter;return!o||!dt.isSelectable(o)?!1:(e&&e(n.tr.setSelection(dt.create(n.doc,r.pos)).scrollIntoView()),!0)};function W_(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){let t=n.node(e);if(n.index(e)+1<t.childCount)return n.doc.resolve(n.after(e+1));if(t.type.spec.isolating)break}return null}const nee=(n,e)=>{let t=n.selection,s=t instanceof dt,i;if(s){if(t.node.isTextblock||!$d(n.doc,t.from))return!1;i=t.from}else if(i=IS(n.doc,t.from,-1),i==null)return!1;if(e){let r=n.tr.join(i);s&&r.setSelection(dt.create(r.doc,i-n.doc.resolve(i).nodeBefore.nodeSize)),e(r.scrollIntoView())}return!0},see=(n,e)=>{let t=n.selection,s;if(t instanceof dt){if(t.node.isTextblock||!$d(n.doc,t.to))return!1;s=t.to}else if(s=IS(n.doc,t.to,1),s==null)return!1;return e&&e(n.tr.join(s).scrollIntoView()),!0},iee=(n,e)=>{let{$from:t,$to:s}=n.selection,i=t.blockRange(s),r=i&&Gm(i);return r==null?!1:(e&&e(n.tr.lift(i,r).scrollIntoView()),!0)},P5=(n,e)=>{let{$head:t,$anchor:s}=n.selection;return!t.parent.type.spec.code||!t.sameParent(s)?!1:(e&&e(n.tr.insertText(`
`).scrollIntoView()),!0)};function K_(n){for(let e=0;e<n.edgeCount;e++){let{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}const ree=(n,e)=>{let{$head:t,$anchor:s}=n.selection;if(!t.parent.type.spec.code||!t.sameParent(s))return!1;let i=t.node(-1),r=t.indexAfter(-1),o=K_(i.contentMatchAt(r));if(!o||!i.canReplaceWith(r,r,o))return!1;if(e){let a=t.after(),l=n.tr.replaceWith(a,a,o.createAndFill());l.setSelection(mt.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},L5=(n,e)=>{let t=n.selection,{$from:s,$to:i}=t;if(t instanceof Ir||s.parent.inlineContent||i.parent.inlineContent)return!1;let r=K_(i.parent.contentMatchAt(i.indexAfter()));if(!r||!r.isTextblock)return!1;if(e){let o=(!s.parentOffset&&i.index()<i.parent.childCount?s:i).pos,a=n.tr.insert(o,r.createAndFill());a.setSelection(ut.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},O5=(n,e)=>{let{$cursor:t}=n.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let r=t.before();if(ql(n.doc,r))return e&&e(n.tr.split(r).scrollIntoView()),!0}let s=t.blockRange(),i=s&&Gm(s);return i==null?!1:(e&&e(n.tr.lift(s,i).scrollIntoView()),!0)};function oee(n){return(e,t)=>{let{$from:s,$to:i}=e.selection;if(e.selection instanceof dt&&e.selection.node.isBlock)return!s.parentOffset||!ql(e.doc,s.pos)?!1:(t&&t(e.tr.split(s.pos).scrollIntoView()),!0);if(!s.depth)return!1;let r=[],o,a,l=!1,u=!1;for(let b=s.depth;;b--)if(s.node(b).isBlock){l=s.end(b)==s.pos+(s.depth-b),u=s.start(b)==s.pos-(s.depth-b),a=K_(s.node(b-1).contentMatchAt(s.indexAfter(b-1))),r.unshift(l&&a?{type:a}:null),o=b;break}else{if(b==1)return!1;r.unshift(null)}let f=e.tr;(e.selection instanceof ut||e.selection instanceof Ir)&&f.deleteSelection();let p=f.mapping.map(s.pos),g=ql(f.doc,p,r.length,r);if(g||(r[0]=a?{type:a}:null,g=ql(f.doc,p,r.length,r)),!g)return!1;if(f.split(p,r.length,r),!l&&u&&s.node(o).type!=a){let b=f.mapping.map(s.before(o)),w=f.doc.resolve(b);a&&s.node(o-1).canReplaceWith(w.index(),w.index()+1,a)&&f.setNodeMarkup(f.mapping.map(s.before(o)),a)}return t&&t(f.scrollIntoView()),!0}}const aee=oee(),lee=(n,e)=>{let{$from:t,to:s}=n.selection,i,r=t.sharedDepth(s);return r==0?!1:(i=t.before(r),e&&e(n.tr.setSelection(dt.create(n.doc,i))),!0)};function cee(n,e,t){let s=e.nodeBefore,i=e.nodeAfter,r=e.index();return!s||!i||!s.type.compatibleContent(i.type)?!1:!s.content.size&&e.parent.canReplace(r-1,r)?(t&&t(n.tr.delete(e.pos-s.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(r,r+1)||!(i.isTextblock||$d(n.doc,e.pos))?!1:(t&&t(n.tr.join(e.pos).scrollIntoView()),!0)}function B5(n,e,t,s){let i=e.nodeBefore,r=e.nodeAfter,o,a,l=i.type.spec.isolating||r.type.spec.isolating;if(!l&&cee(n,e,t))return!0;let u=!l&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(o=(a=i.contentMatchAt(i.childCount)).findWrapping(r.type))&&a.matchType(o[0]||r.type).validEnd){if(t){let b=e.pos+r.nodeSize,w=Ie.empty;for(let C=o.length-1;C>=0;C--)w=Ie.from(o[C].create(null,w));w=Ie.from(i.copy(w));let S=n.tr.step(new Hs(e.pos-1,b,e.pos,b,new Ve(w,1,0),o.length,!0)),N=S.doc.resolve(b+2*o.length);N.nodeAfter&&N.nodeAfter.type==i.type&&$d(S.doc,N.pos)&&S.join(N.pos),t(S.scrollIntoView())}return!0}let f=r.type.spec.isolating||s>0&&l?null:mt.findFrom(e,1),p=f&&f.$from.blockRange(f.$to),g=p&&Gm(p);if(g!=null&&g>=e.depth)return t&&t(n.tr.lift(p,g).scrollIntoView()),!0;if(u&&Rm(r,"start",!0)&&Rm(i,"end")){let b=i,w=[];for(;w.push(b),!b.isTextblock;)b=b.lastChild;let S=r,N=1;for(;!S.isTextblock;S=S.firstChild)N++;if(b.canReplace(b.childCount,b.childCount,S.content)){if(t){let C=Ie.empty;for(let R=w.length-1;R>=0;R--)C=Ie.from(w[R].copy(C));let M=n.tr.step(new Hs(e.pos-w.length,e.pos+r.nodeSize,e.pos+N,e.pos+r.nodeSize-N,new Ve(C,w.length,0),0,!0));t(M.scrollIntoView())}return!0}}return!1}function F5(n){return function(e,t){let s=e.selection,i=n<0?s.$from:s.$to,r=i.depth;for(;i.node(r).isInline;){if(!r)return!1;r--}return i.node(r).isTextblock?(t&&t(e.tr.setSelection(ut.create(e.doc,n<0?i.start(r):i.end(r)))),!0):!1}}const dee=F5(-1),uee=F5(1);function hee(n,e=null){return function(t,s){let{$from:i,$to:r}=t.selection,o=i.blockRange(r),a=o&&I_(o,n,e);return a?(s&&s(t.tr.wrap(o,a).scrollIntoView()),!0):!1}}function qP(n,e=null){return function(t,s){let i=!1;for(let r=0;r<t.selection.ranges.length&&!i;r++){let{$from:{pos:o},$to:{pos:a}}=t.selection.ranges[r];t.doc.nodesBetween(o,a,(l,u)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(n,e)))if(l.type==n)i=!0;else{let f=t.doc.resolve(u),p=f.index();i=f.parent.canReplaceWith(p,p+1,n)}})}if(!i)return!1;if(s){let r=t.tr;for(let o=0;o<t.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=t.selection.ranges[o];r.setBlockType(a,l,n,e)}s(r.scrollIntoView())}return!0}}function Y_(...n){return function(e,t,s){for(let i=0;i<n.length;i++)if(n[i](e,t,s))return!0;return!1}}Y_(V_,M5,I5);Y_(V_,D5,j5);Y_(P5,L5,O5,aee);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function fee(n,e=null){return function(t,s){let{$from:i,$to:r}=t.selection,o=i.blockRange(r);if(!o)return!1;let a=s?t.tr:null;return pee(a,o,n,e)?(s&&s(a.scrollIntoView()),!0):!1}}function pee(n,e,t,s=null){let i=!1,r=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(t)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);r=new sk(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new sk(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let a=I_(r,t,s,e);return a?(n&&mee(n,e,a,i,t),!0):!1}function mee(n,e,t,s,i){let r=Ie.empty;for(let f=t.length-1;f>=0;f--)r=Ie.from(t[f].type.create(t[f].attrs,r));n.step(new Hs(e.start-(s?2:0),e.end,e.start,e.end,new Ve(r,0,0),t.length,!0));let o=0;for(let f=0;f<t.length;f++)t[f].type==i&&(o=f+1);let a=t.length-o,l=e.start+t.length-(s?2:0),u=e.parent;for(let f=e.startIndex,p=e.endIndex,g=!0;f<p;f++,g=!1)!g&&ql(n.doc,l,a)&&(n.split(l,a),l+=2*a),l+=u.child(f).nodeSize;return n}function gee(n){return function(e,t){let{$from:s,$to:i}=e.selection,r=s.blockRange(i,o=>o.childCount>0&&o.firstChild.type==n);return r?t?s.node(r.depth-1).type==n?xee(e,t,n,r):bee(e,t,r):!0:!1}}function xee(n,e,t,s){let i=n.tr,r=s.end,o=s.$to.end(s.depth);r<o&&(i.step(new Hs(r-1,o,r,o,new Ve(Ie.from(t.create(null,s.parent.copy())),1,0),1,!0)),s=new sk(i.doc.resolve(s.$from.pos),i.doc.resolve(o),s.depth));const a=Gm(s);if(a==null)return!1;i.lift(s,a);let l=i.doc.resolve(i.mapping.map(r,-1)-1);return $d(i.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&i.join(l.pos),e(i.scrollIntoView()),!0}function bee(n,e,t){let s=n.tr,i=t.parent;for(let b=t.end,w=t.endIndex-1,S=t.startIndex;w>S;w--)b-=i.child(w).nodeSize,s.delete(b-1,b+1);let r=s.doc.resolve(t.start),o=r.nodeAfter;if(s.mapping.map(t.end)!=t.start+r.nodeAfter.nodeSize)return!1;let a=t.startIndex==0,l=t.endIndex==i.childCount,u=r.node(-1),f=r.index(-1);if(!u.canReplace(f+(a?0:1),f+1,o.content.append(l?Ie.empty:Ie.from(i))))return!1;let p=r.pos,g=p+o.nodeSize;return s.step(new Hs(p-(a?1:0),g+(l?1:0),p+1,g-1,new Ve((a?Ie.empty:Ie.from(i.copy(Ie.empty))).append(l?Ie.empty:Ie.from(i.copy(Ie.empty))),a?0:1,l?0:1),a?0:1)),e(s.scrollIntoView()),!0}function yee(n){return function(e,t){let{$from:s,$to:i}=e.selection,r=s.blockRange(i,u=>u.childCount>0&&u.firstChild.type==n);if(!r)return!1;let o=r.startIndex;if(o==0)return!1;let a=r.parent,l=a.child(o-1);if(l.type!=n)return!1;if(t){let u=l.lastChild&&l.lastChild.type==a.type,f=Ie.from(u?n.create():null),p=new Ve(Ie.from(n.create(null,Ie.from(a.type.create(null,f)))),u?3:1,0),g=r.start,b=r.end;t(e.tr.step(new Hs(g-(u?3:1),b,g,b,p,1,!0)).scrollIntoView())}return!0}}function OS(n){const{state:e,transaction:t}=n;let{selection:s}=t,{doc:i}=t,{storedMarks:r}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return r},get selection(){return s},get doc(){return i},get tr(){return s=t.selection,i=t.doc,r=t.storedMarks,t}}}let BS=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:s}=this,{view:i}=t,{tr:r}=s,o=this.buildProps(r);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...f)=>{const p=l(...f)(o);return!r.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(r),p}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:s,editor:i,state:r}=this,{view:o}=i,a=[],l=!!e,u=e||r.tr,f=()=>(!l&&t&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(u),a.every(g=>g===!0)),p={...Object.fromEntries(Object.entries(s).map(([g,b])=>[g,(...S)=>{const N=this.buildProps(u,t),C=b(...S)(N);return a.push(C),p}])),run:f};return p}createCan(e){const{rawCommands:t,state:s}=this,i=!1,r=e||s.tr,o=this.buildProps(r,i);return{...Object.fromEntries(Object.entries(t).map(([l,u])=>[l,(...f)=>u(...f)({...o,dispatch:void 0})])),chain:()=>this.createChain(r,i)}}buildProps(e,t=!0){const{rawCommands:s,editor:i,state:r}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:OS({state:r,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(s).map(([l,u])=>[l,(...f)=>u(...f)(a)]))}};return a}};class vee{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const s=this.callbacks[e];return s&&s.forEach(i=>i.apply(this,t)),this}off(e,t){const s=this.callbacks[e];return s&&(t?this.callbacks[e]=s.filter(i=>i!==t):delete this.callbacks[e]),this}once(e,t){const s=(...i)=>{this.off(e,s),t.apply(this,i)};return this.on(e,s)}removeAllListeners(){this.callbacks={}}}function nt(n,e,t){return n.config[e]===void 0&&n.parent?nt(n.parent,e,t):typeof n.config[e]=="function"?n.config[e].bind({...t,parent:n.parent?nt(n.parent,e,t):null}):n.config[e]}function FS(n){const e=n.filter(i=>i.type==="extension"),t=n.filter(i=>i.type==="node"),s=n.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:s}}function H5(n){const e=[],{nodeExtensions:t,markExtensions:s}=FS(n),i=[...t,...s],r={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return n.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:i},l=nt(o,"addGlobalAttributes",a);if(!l)return;l().forEach(f=>{f.types.forEach(p=>{Object.entries(f.attributes).forEach(([g,b])=>{e.push({type:p,name:g,attribute:{...r,...b}})})})})}),i.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=nt(o,"addAttributes",a);if(!l)return;const u=l();Object.entries(u).forEach(([f,p])=>{const g={...r,...p};typeof(g==null?void 0:g.default)=="function"&&(g.default=g.default()),g!=null&&g.isRequired&&(g==null?void 0:g.default)===void 0&&delete g.default,e.push({type:o.name,name:f,attribute:g})})}),e}function $s(n,e){if(typeof n=="string"){if(!e.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return e.nodes[n]}return n}function an(...n){return n.filter(e=>!!e).reduce((e,t)=>{const s={...e};return Object.entries(t).forEach(([i,r])=>{if(!s[i]){s[i]=r;return}if(i==="class"){const a=r?String(r).split(" "):[],l=s[i]?s[i].split(" "):[],u=a.filter(f=>!l.includes(f));s[i]=[...l,...u].join(" ")}else if(i==="style"){const a=r?r.split(";").map(f=>f.trim()).filter(Boolean):[],l=s[i]?s[i].split(";").map(f=>f.trim()).filter(Boolean):[],u=new Map;l.forEach(f=>{const[p,g]=f.split(":").map(b=>b.trim());u.set(p,g)}),a.forEach(f=>{const[p,g]=f.split(":").map(b=>b.trim());u.set(p,g)}),s[i]=Array.from(u.entries()).map(([f,p])=>`${f}: ${p}`).join("; ")}else s[i]=r}),s},{})}function uE(n,e){return e.filter(t=>t.type===n.type.name).filter(t=>t.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(n.attrs)||{}:{[t.name]:n.attrs[t.name]}).reduce((t,s)=>an(t,s),{})}function U5(n){return typeof n=="function"}function Tt(n,e=void 0,...t){return U5(n)?e?n.bind(e)(...t):n(...t):n}function wee(n={}){return Object.keys(n).length===0&&n.constructor===Object}function kee(n){return typeof n!="string"?n:n.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(n):n==="true"?!0:n==="false"?!1:n}function WP(n,e){return"style"in n?n:{...n,getAttrs:t=>{const s=n.getAttrs?n.getAttrs(t):n.attrs;if(s===!1)return!1;const i=e.reduce((r,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(t):kee(t.getAttribute(o.name));return a==null?r:{...r,[o.name]:a}},{});return{...s,...i}}}}function KP(n){return Object.fromEntries(Object.entries(n).filter(([e,t])=>e==="attrs"&&wee(t)?!1:t!=null))}function See(n,e){var t;const s=H5(n),{nodeExtensions:i,markExtensions:r}=FS(n),o=(t=i.find(u=>nt(u,"topNode")))===null||t===void 0?void 0:t.name,a=Object.fromEntries(i.map(u=>{const f=s.filter(C=>C.type===u.name),p={name:u.name,options:u.options,storage:u.storage,editor:e},g=n.reduce((C,M)=>{const R=nt(M,"extendNodeSchema",p);return{...C,...R?R(u):{}}},{}),b=KP({...g,content:Tt(nt(u,"content",p)),marks:Tt(nt(u,"marks",p)),group:Tt(nt(u,"group",p)),inline:Tt(nt(u,"inline",p)),atom:Tt(nt(u,"atom",p)),selectable:Tt(nt(u,"selectable",p)),draggable:Tt(nt(u,"draggable",p)),code:Tt(nt(u,"code",p)),whitespace:Tt(nt(u,"whitespace",p)),linebreakReplacement:Tt(nt(u,"linebreakReplacement",p)),defining:Tt(nt(u,"defining",p)),isolating:Tt(nt(u,"isolating",p)),attrs:Object.fromEntries(f.map(C=>{var M;return[C.name,{default:(M=C==null?void 0:C.attribute)===null||M===void 0?void 0:M.default}]}))}),w=Tt(nt(u,"parseHTML",p));w&&(b.parseDOM=w.map(C=>WP(C,f)));const S=nt(u,"renderHTML",p);S&&(b.toDOM=C=>S({node:C,HTMLAttributes:uE(C,f)}));const N=nt(u,"renderText",p);return N&&(b.toText=N),[u.name,b]})),l=Object.fromEntries(r.map(u=>{const f=s.filter(N=>N.type===u.name),p={name:u.name,options:u.options,storage:u.storage,editor:e},g=n.reduce((N,C)=>{const M=nt(C,"extendMarkSchema",p);return{...N,...M?M(u):{}}},{}),b=KP({...g,inclusive:Tt(nt(u,"inclusive",p)),excludes:Tt(nt(u,"excludes",p)),group:Tt(nt(u,"group",p)),spanning:Tt(nt(u,"spanning",p)),code:Tt(nt(u,"code",p)),attrs:Object.fromEntries(f.map(N=>{var C;return[N.name,{default:(C=N==null?void 0:N.attribute)===null||C===void 0?void 0:C.default}]}))}),w=Tt(nt(u,"parseHTML",p));w&&(b.parseDOM=w.map(N=>WP(N,f)));const S=nt(u,"renderHTML",p);return S&&(b.toDOM=N=>S({mark:N,HTMLAttributes:uE(N,f)})),[u.name,b]}));return new _4({topNode:o,nodes:a,marks:l})}function UA(n,e){return e.nodes[n]||e.marks[n]||null}function YP(n,e){return Array.isArray(e)?e.some(t=>(typeof t=="string"?t:t.name)===n.name):e}function J_(n,e){const t=sf.fromSchema(e).serializeFragment(n),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(t),i.innerHTML}const Cee=(n,e=500)=>{let t="";const s=n.parentOffset;return n.parent.nodesBetween(Math.max(0,s-e),s,(i,r,o,a)=>{var l,u;const f=((u=(l=i.type.spec).toText)===null||u===void 0?void 0:u.call(l,{node:i,pos:r,parent:o,index:a}))||i.textContent||"%leaf%";t+=i.isAtom&&!i.isText?f:f.slice(0,Math.max(0,s-r))}),t};function X_(n){return Object.prototype.toString.call(n)==="[object RegExp]"}class HS{constructor(e){this.find=e.find,this.handler=e.handler}}const Aee=(n,e)=>{if(X_(e))return e.exec(n);const t=e(n);if(!t)return null;const s=[t.text];return s.index=t.index,s.input=n,s.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),s.push(t.replaceWith)),s};function Ev(n){var e;const{editor:t,from:s,to:i,text:r,rules:o,plugin:a}=n,{view:l}=t;if(l.composing)return!1;const u=l.state.doc.resolve(s);if(u.parent.type.spec.code||!((e=u.nodeBefore||u.nodeAfter)===null||e===void 0)&&e.marks.find(g=>g.type.spec.code))return!1;let f=!1;const p=Cee(u)+r;return o.forEach(g=>{if(f)return;const b=Aee(p,g.find);if(!b)return;const w=l.state.tr,S=OS({state:l.state,transaction:w}),N={from:s-(b[0].length-r.length),to:i},{commands:C,chain:M,can:R}=new BS({editor:t,state:S});g.handler({state:S,range:N,match:b,commands:C,chain:M,can:R})===null||!w.steps.length||(w.setMeta(a,{transform:w,from:s,to:i,text:r}),l.dispatch(w),f=!0)}),f}function Nee(n){const{editor:e,rules:t}=n,s=new Jn({state:{init(){return null},apply(i,r,o){const a=i.getMeta(s);if(a)return a;const l=i.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:f}=l;typeof f=="string"?f=f:f=J_(Ie.from(f),o.schema);const{from:p}=l,g=p+f.length;Ev({editor:e,from:p,to:g,text:f,rules:t,plugin:s})}),i.selectionSet||i.docChanged?null:r}},props:{handleTextInput(i,r,o,a){return Ev({editor:e,from:r,to:o,text:a,rules:t,plugin:s})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:r}=i.state.selection;r&&Ev({editor:e,from:r.pos,to:r.pos,text:"",rules:t,plugin:s})}),!1)},handleKeyDown(i,r){if(r.key!=="Enter")return!1;const{$cursor:o}=i.state.selection;return o?Ev({editor:e,from:o.pos,to:o.pos,text:`
`,rules:t,plugin:s}):!1}},isInputRules:!0});return s}function Eee(n){return Object.prototype.toString.call(n).slice(8,-1)}function Tv(n){return Eee(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function US(n,e){const t={...n};return Tv(n)&&Tv(e)&&Object.keys(e).forEach(s=>{Tv(e[s])&&Tv(n[s])?t[s]=US(n[s],e[s]):t[s]=e[s]}),t}class ir{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Tt(nt(this,"addOptions",{name:this.name}))),this.storage=Tt(nt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ir(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>US(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new ir(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=Tt(nt(t,"addOptions",{name:t.name})),t.storage=Tt(nt(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){const{tr:s}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(u=>(u==null?void 0:u.type.name)===t.name))return!1;const l=o.find(u=>(u==null?void 0:u.type.name)===t.name);return l&&s.removeStoredMark(l),s.insertText(" ",i.pos),e.view.dispatch(s),!0}return!1}}function Tee(n){return typeof n=="number"}class _ee{constructor(e){this.find=e.find,this.handler=e.handler}}const Mee=(n,e,t)=>{if(X_(e))return[...n.matchAll(e)];const s=e(n,t);return s?s.map(i=>{const r=[i.text];return r.index=i.index,r.input=n,r.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),r.push(i.replaceWith)),r}):[]};function Ree(n){const{editor:e,state:t,from:s,to:i,rule:r,pasteEvent:o,dropEvent:a}=n,{commands:l,chain:u,can:f}=new BS({editor:e,state:t}),p=[];return t.doc.nodesBetween(s,i,(b,w)=>{if(!b.isTextblock||b.type.spec.code)return;const S=Math.max(s,w),N=Math.min(i,w+b.content.size),C=b.textBetween(S-w,N-w,void 0,"");Mee(C,r.find,o).forEach(R=>{if(R.index===void 0)return;const _=S+R.index+1,j=_+R[0].length,P={from:t.tr.mapping.map(_),to:t.tr.mapping.map(j)},D=r.handler({state:t,range:P,match:R,commands:l,chain:u,can:f,pasteEvent:o,dropEvent:a});p.push(D)})}),p.every(b=>b!==null)}let _v=null;const Iee=n=>{var e;const t=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=t.clipboardData)===null||e===void 0||e.setData("text/html",n),t};function zee(n){const{editor:e,rules:t}=n;let s=null,i=!1,r=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:f,from:p,to:g,rule:b,pasteEvt:w})=>{const S=f.tr,N=OS({state:f,transaction:S});if(!(!Ree({editor:e,state:N,from:Math.max(p-1,0),to:g.b-1,rule:b,pasteEvent:w,dropEvent:a})||!S.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,S}};return t.map(f=>new Jn({view(p){const g=w=>{var S;s=!((S=p.dom.parentElement)===null||S===void 0)&&S.contains(w.target)?p.dom.parentElement:null,s&&(_v=e)},b=()=>{_v&&(_v=null)};return window.addEventListener("dragstart",g),window.addEventListener("dragend",b),{destroy(){window.removeEventListener("dragstart",g),window.removeEventListener("dragend",b)}}},props:{handleDOMEvents:{drop:(p,g)=>{if(r=s===p.dom.parentElement,a=g,!r){const b=_v;b!=null&&b.isEditable&&setTimeout(()=>{const w=b.state.selection;w&&b.commands.deleteRange({from:w.from,to:w.to})},10)}return!1},paste:(p,g)=>{var b;const w=(b=g.clipboardData)===null||b===void 0?void 0:b.getData("text/html");return o=g,i=!!(w!=null&&w.includes("data-pm-slice")),!1}}},appendTransaction:(p,g,b)=>{const w=p[0],S=w.getMeta("uiEvent")==="paste"&&!i,N=w.getMeta("uiEvent")==="drop"&&!r,C=w.getMeta("applyPasteRules"),M=!!C;if(!S&&!N&&!M)return;if(M){let{text:j}=C;typeof j=="string"?j=j:j=J_(Ie.from(j),b.schema);const{from:P}=C,D=P+j.length,U=Iee(j);return l({rule:f,state:b,from:P,to:{b:D},pasteEvt:U})}const R=g.doc.content.findDiffStart(b.doc.content),_=g.doc.content.findDiffEnd(b.doc.content);if(!(!Tee(R)||!_||R===_.b))return l({rule:f,state:b,from:R,to:_,pasteEvt:o})}}))}function Dee(n){const e=n.filter((t,s)=>n.indexOf(t)!==s);return Array.from(new Set(e))}class up{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=up.resolve(e),this.schema=See(this.extensions,t),this.setupExtensions()}static resolve(e){const t=up.sort(up.flatten(e)),s=Dee(t.map(i=>i.name));return s.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${s.map(i=>`'${i}'`).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map(t=>{const s={name:t.name,options:t.options,storage:t.storage},i=nt(t,"addExtensions",s);return i?[t,...this.flatten(i())]:t}).flat(10)}static sort(e){return e.sort((s,i)=>{const r=nt(s,"priority")||100,o=nt(i,"priority")||100;return r>o?-1:r<o?1:0})}get commands(){return this.extensions.reduce((e,t)=>{const s={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:UA(t.name,this.schema)},i=nt(t,"addCommands",s);return i?{...e,...i()}:e},{})}get plugins(){const{editor:e}=this,t=up.sort([...this.extensions].reverse()),s=[],i=[],r=t.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:UA(o.name,this.schema)},l=[],u=nt(o,"addKeyboardShortcuts",a);let f={};if(o.type==="mark"&&nt(o,"exitable",a)&&(f.ArrowRight=()=>ir.handleExit({editor:e,mark:o})),u){const S=Object.fromEntries(Object.entries(u()).map(([N,C])=>[N,()=>C({editor:e})]));f={...f,...S}}const p=ZZ(f);l.push(p);const g=nt(o,"addInputRules",a);YP(o,e.options.enableInputRules)&&g&&s.push(...g());const b=nt(o,"addPasteRules",a);YP(o,e.options.enablePasteRules)&&b&&i.push(...b());const w=nt(o,"addProseMirrorPlugins",a);if(w){const S=w();l.push(...S)}return l}).flat();return[Nee({editor:e,rules:s}),...zee({editor:e,rules:i}),...r]}get attributes(){return H5(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=FS(this.extensions);return Object.fromEntries(t.filter(s=>!!nt(s,"addNodeView")).map(s=>{const i=this.attributes.filter(l=>l.type===s.name),r={name:s.name,options:s.options,storage:s.storage,editor:e,type:$s(s.name,this.schema)},o=nt(s,"addNodeView",r);if(!o)return[];const a=(l,u,f,p,g)=>{const b=uE(l,i);return o()({node:l,view:u,getPos:f,decorations:p,innerDecorations:g,editor:e,extension:s,HTMLAttributes:b})};return[s.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var t;this.editor.extensionStorage[e.name]=e.storage;const s={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:UA(e.name,this.schema)};e.type==="mark"&&(!((t=Tt(nt(e,"keepOnSplit",s)))!==null&&t!==void 0)||t)&&this.splittableMarks.push(e.name);const i=nt(e,"onBeforeCreate",s),r=nt(e,"onCreate",s),o=nt(e,"onUpdate",s),a=nt(e,"onSelectionUpdate",s),l=nt(e,"onTransaction",s),u=nt(e,"onFocus",s),f=nt(e,"onBlur",s),p=nt(e,"onDestroy",s);i&&this.editor.on("beforeCreate",i),r&&this.editor.on("create",r),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),u&&this.editor.on("focus",u),f&&this.editor.on("blur",f),p&&this.editor.on("destroy",p)})}}class bs{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Tt(nt(this,"addOptions",{name:this.name}))),this.storage=Tt(nt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new bs(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>US(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new bs({...this.config,...e});return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=Tt(nt(t,"addOptions",{name:t.name})),t.storage=Tt(nt(t,"addStorage",{name:t.name,options:t.options})),t}}function $5(n,e,t){const{from:s,to:i}=e,{blockSeparator:r=`

`,textSerializers:o={}}=t||{};let a="";return n.nodesBetween(s,i,(l,u,f,p)=>{var g;l.isBlock&&u>s&&(a+=r);const b=o==null?void 0:o[l.type.name];if(b)return f&&(a+=b({node:l,pos:u,parent:f,index:p,range:e})),!1;l.isText&&(a+=(g=l==null?void 0:l.text)===null||g===void 0?void 0:g.slice(Math.max(s,u)-u,i-u))}),a}function Q_(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}const jee=bs.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Jn({key:new Ts("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:n}=this,{state:e,schema:t}=n,{doc:s,selection:i}=e,{ranges:r}=i,o=Math.min(...r.map(f=>f.$from.pos)),a=Math.max(...r.map(f=>f.$to.pos)),l=Q_(t);return $5(s,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),Pee=()=>({editor:n,view:e})=>(requestAnimationFrame(()=>{var t;n.isDestroyed||(e.dom.blur(),(t=window==null?void 0:window.getSelection())===null||t===void 0||t.removeAllRanges())}),!0),Lee=(n=!1)=>({commands:e})=>e.setContent("",n),Oee=()=>({state:n,tr:e,dispatch:t})=>{const{selection:s}=e,{ranges:i}=s;return t&&i.forEach(({$from:r,$to:o})=>{n.doc.nodesBetween(r.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:u,mapping:f}=e,p=u.resolve(f.map(l)),g=u.resolve(f.map(l+a.nodeSize)),b=p.blockRange(g);if(!b)return;const w=Gm(b);if(a.type.isTextblock){const{defaultType:S}=p.parent.contentMatchAt(p.index());e.setNodeMarkup(b.start,S)}(w||w===0)&&e.lift(b,w)})}),!0},Bee=n=>e=>n(e),Fee=()=>({state:n,dispatch:e})=>L5(n,e),Hee=(n,e)=>({editor:t,tr:s})=>{const{state:i}=t,r=i.doc.slice(n.from,n.to);s.deleteRange(n.from,n.to);const o=s.mapping.map(e);return s.insert(o,r.content),s.setSelection(new ut(s.doc.resolve(Math.max(o-1,0)))),!0},Uee=()=>({tr:n,dispatch:e})=>{const{selection:t}=n,s=t.$anchor.node();if(s.content.size>0)return!1;const i=n.selection.$anchor;for(let r=i.depth;r>0;r-=1)if(i.node(r).type===s.type){if(e){const a=i.before(r),l=i.after(r);n.delete(a,l).scrollIntoView()}return!0}return!1},$ee=n=>({tr:e,state:t,dispatch:s})=>{const i=$s(n,t.schema),r=e.selection.$anchor;for(let o=r.depth;o>0;o-=1)if(r.node(o).type===i){if(s){const l=r.before(o),u=r.after(o);e.delete(l,u).scrollIntoView()}return!0}return!1},Gee=n=>({tr:e,dispatch:t})=>{const{from:s,to:i}=n;return t&&e.delete(s,i),!0},Vee=()=>({state:n,dispatch:e})=>V_(n,e),qee=()=>({commands:n})=>n.keyboardShortcut("Enter"),Wee=()=>({state:n,dispatch:e})=>ree(n,e);function uk(n,e,t={strict:!0}){const s=Object.keys(e);return s.length?s.every(i=>t.strict?e[i]===n[i]:X_(e[i])?e[i].test(n[i]):e[i]===n[i]):!0}function G5(n,e,t={}){return n.find(s=>s.type===e&&uk(Object.fromEntries(Object.keys(t).map(i=>[i,s.attrs[i]])),t))}function JP(n,e,t={}){return!!G5(n,e,t)}function Z_(n,e,t){var s;if(!n||!e)return;let i=n.parent.childAfter(n.parentOffset);if((!i.node||!i.node.marks.some(f=>f.type===e))&&(i=n.parent.childBefore(n.parentOffset)),!i.node||!i.node.marks.some(f=>f.type===e)||(t=t||((s=i.node.marks[0])===null||s===void 0?void 0:s.attrs),!G5([...i.node.marks],e,t)))return;let o=i.index,a=n.start()+i.offset,l=o+1,u=a+i.node.nodeSize;for(;o>0&&JP([...n.parent.child(o-1).marks],e,t);)o-=1,a-=n.parent.child(o).nodeSize;for(;l<n.parent.childCount&&JP([...n.parent.child(l).marks],e,t);)u+=n.parent.child(l).nodeSize,l+=1;return{from:a,to:u}}function Vd(n,e){if(typeof n=="string"){if(!e.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return e.marks[n]}return n}const Kee=(n,e={})=>({tr:t,state:s,dispatch:i})=>{const r=Vd(n,s.schema),{doc:o,selection:a}=t,{$from:l,from:u,to:f}=a;if(i){const p=Z_(l,r,e);if(p&&p.from<=u&&p.to>=f){const g=ut.create(o,p.from,p.to);t.setSelection(g)}}return!0},Yee=n=>e=>{const t=typeof n=="function"?n(e):n;for(let s=0;s<t.length;s+=1)if(t[s](e))return!0;return!1};function e2(n){return n instanceof ut}function Gl(n=0,e=0,t=0){return Math.min(Math.max(n,e),t)}function V5(n,e=null){if(!e)return null;const t=mt.atStart(n),s=mt.atEnd(n);if(e==="start"||e===!0)return t;if(e==="end")return s;const i=t.from,r=s.to;return e==="all"?ut.create(n,Gl(0,i,r),Gl(n.content.size,i,r)):ut.create(n,Gl(e,i,r),Gl(e,i,r))}function Jee(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function t2(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const Xee=(n=null,e={})=>({editor:t,view:s,tr:i,dispatch:r})=>{e={scrollIntoView:!0,...e};const o=()=>{(t2()||Jee())&&s.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(s.focus(),e!=null&&e.scrollIntoView&&t.commands.scrollIntoView())})};if(s.hasFocus()&&n===null||n===!1)return!0;if(r&&n===null&&!e2(t.state.selection))return o(),!0;const a=V5(i.doc,n)||t.state.selection,l=t.state.selection.eq(a);return r&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},Qee=(n,e)=>t=>n.every((s,i)=>e(s,{...t,index:i})),Zee=(n,e)=>({tr:t,commands:s})=>s.insertContentAt({from:t.selection.from,to:t.selection.to},n,e),q5=n=>{const e=n.childNodes;for(let t=e.length-1;t>=0;t-=1){const s=e[t];s.nodeType===3&&s.nodeValue&&/^(\n\s\s|\n)$/.test(s.nodeValue)?n.removeChild(s):s.nodeType===1&&q5(s)}return n};function Mv(n){const e=`<body>${n}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return q5(t)}function nx(n,e,t){if(n instanceof Rd||n instanceof Ie)return n;t={slice:!0,parseOptions:{},...t};const s=typeof n=="object"&&n!==null,i=typeof n=="string";if(s)try{if(Array.isArray(n)&&n.length>0)return Ie.fromArray(n.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(n);return t.errorOnInvalidContent&&o.check(),o}catch(r){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:r});return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",r),nx("",e,t)}if(i){if(t.errorOnInvalidContent){let o=!1,a="";const l=new _4({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(o=!0,a=typeof u=="string"?u:u.outerHTML,null)}]}})});if(t.slice?C0.fromSchema(l).parseSlice(Mv(n),t.parseOptions):C0.fromSchema(l).parse(Mv(n),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const r=C0.fromSchema(e);return t.slice?r.parseSlice(Mv(n),t.parseOptions).content:r.parse(Mv(n),t.parseOptions)}return nx("",e,t)}function ete(n,e,t){const s=n.steps.length-1;if(s<e)return;const i=n.steps[s];if(!(i instanceof Bs||i instanceof Hs))return;const r=n.mapping.maps[s];let o=0;r.forEach((a,l,u,f)=>{o===0&&(o=f)}),n.setSelection(mt.near(n.doc.resolve(o),t))}const tte=n=>!("type"in n),nte=(n,e,t)=>({tr:s,dispatch:i,editor:r})=>{var o;if(i){t={parseOptions:r.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const l=N=>{r.emit("contentError",{editor:r,error:N,disableCollaboration:()=>{r.storage.collaboration&&(r.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!r.options.enableContentCheck&&r.options.emitContentError)try{nx(e,r.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(N){l(N)}try{a=nx(e,r.schema,{parseOptions:u,errorOnInvalidContent:(o=t.errorOnInvalidContent)!==null&&o!==void 0?o:r.options.enableContentCheck})}catch(N){return l(N),!1}let{from:f,to:p}=typeof n=="number"?{from:n,to:n}:{from:n.from,to:n.to},g=!0,b=!0;if((tte(a)?a:[a]).forEach(N=>{N.check(),g=g?N.isText&&N.marks.length===0:!1,b=b?N.isBlock:!1}),f===p&&b){const{parent:N}=s.doc.resolve(f);N.isTextblock&&!N.type.spec.code&&!N.childCount&&(f-=1,p+=1)}let S;if(g){if(Array.isArray(e))S=e.map(N=>N.text||"").join("");else if(e instanceof Ie){let N="";e.forEach(C=>{C.text&&(N+=C.text)}),S=N}else typeof e=="object"&&e&&e.text?S=e.text:S=e;s.insertText(S,f,p)}else S=a,s.replaceWith(f,p,S);t.updateSelection&&ete(s,s.steps.length-1,-1),t.applyInputRules&&s.setMeta("applyInputRules",{from:f,text:S}),t.applyPasteRules&&s.setMeta("applyPasteRules",{from:f,text:S})}return!0},ste=()=>({state:n,dispatch:e})=>nee(n,e),ite=()=>({state:n,dispatch:e})=>see(n,e),rte=()=>({state:n,dispatch:e})=>M5(n,e),ote=()=>({state:n,dispatch:e})=>D5(n,e),ate=()=>({state:n,dispatch:e,tr:t})=>{try{const s=IS(n.doc,n.selection.$from.pos,-1);return s==null?!1:(t.join(s,2),e&&e(t),!0)}catch{return!1}},lte=()=>({state:n,dispatch:e,tr:t})=>{try{const s=IS(n.doc,n.selection.$from.pos,1);return s==null?!1:(t.join(s,2),e&&e(t),!0)}catch{return!1}},cte=()=>({state:n,dispatch:e})=>eee(n,e),dte=()=>({state:n,dispatch:e})=>tee(n,e);function W5(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function ute(n){const e=n.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let s,i,r,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))s=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))r=!0;else if(/^mod$/i.test(l))t2()||W5()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return s&&(t=`Alt-${t}`),i&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),r&&(t=`Shift-${t}`),t}const hte=n=>({editor:e,view:t,tr:s,dispatch:i})=>{const r=ute(n).split(/-(?!$)/),o=r.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:r.includes("Alt"),ctrlKey:r.includes("Ctrl"),metaKey:r.includes("Meta"),shiftKey:r.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",u=>u(t,a))});return l==null||l.steps.forEach(u=>{const f=u.map(s.mapping);f&&i&&s.maybeStep(f)}),!0};function sx(n,e,t={}){const{from:s,to:i,empty:r}=n.selection,o=e?$s(e,n.schema):null,a=[];n.doc.nodesBetween(s,i,(p,g)=>{if(p.isText)return;const b=Math.max(s,g),w=Math.min(i,g+p.nodeSize);a.push({node:p,from:b,to:w})});const l=i-s,u=a.filter(p=>o?o.name===p.node.type.name:!0).filter(p=>uk(p.node.attrs,t,{strict:!1}));return r?!!u.length:u.reduce((p,g)=>p+g.to-g.from,0)>=l}const fte=(n,e={})=>({state:t,dispatch:s})=>{const i=$s(n,t.schema);return sx(t,i,e)?iee(t,s):!1},pte=()=>({state:n,dispatch:e})=>O5(n,e),mte=n=>({state:e,dispatch:t})=>{const s=$s(n,e.schema);return gee(s)(e,t)},gte=()=>({state:n,dispatch:e})=>P5(n,e);function $S(n,e){return e.nodes[n]?"node":e.marks[n]?"mark":null}function XP(n,e){const t=typeof e=="string"?[e]:e;return Object.keys(n).reduce((s,i)=>(t.includes(i)||(s[i]=n[i]),s),{})}const xte=(n,e)=>({tr:t,state:s,dispatch:i})=>{let r=null,o=null;const a=$S(typeof n=="string"?n:n.name,s.schema);return a?(a==="node"&&(r=$s(n,s.schema)),a==="mark"&&(o=Vd(n,s.schema)),i&&t.selection.ranges.forEach(l=>{s.doc.nodesBetween(l.$from.pos,l.$to.pos,(u,f)=>{r&&r===u.type&&t.setNodeMarkup(f,void 0,XP(u.attrs,e)),o&&u.marks.length&&u.marks.forEach(p=>{o===p.type&&t.addMark(f,f+u.nodeSize,o.create(XP(p.attrs,e)))})})}),!0):!1},bte=()=>({tr:n,dispatch:e})=>(e&&n.scrollIntoView(),!0),yte=()=>({tr:n,dispatch:e})=>{if(e){const t=new Ir(n.doc);n.setSelection(t)}return!0},vte=()=>({state:n,dispatch:e})=>I5(n,e),wte=()=>({state:n,dispatch:e})=>j5(n,e),kte=()=>({state:n,dispatch:e})=>lee(n,e),Ste=()=>({state:n,dispatch:e})=>uee(n,e),Cte=()=>({state:n,dispatch:e})=>dee(n,e);function hE(n,e,t={},s={}){return nx(n,e,{slice:!1,parseOptions:t,errorOnInvalidContent:s.errorOnInvalidContent})}const Ate=(n,e=!1,t={},s={})=>({editor:i,tr:r,dispatch:o,commands:a})=>{var l,u;const{doc:f}=r;if(t.preserveWhitespace!=="full"){const p=hE(n,i.schema,t,{errorOnInvalidContent:(l=s.errorOnInvalidContent)!==null&&l!==void 0?l:i.options.enableContentCheck});return o&&r.replaceWith(0,f.content.size,p).setMeta("preventUpdate",!e),!0}return o&&r.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:f.content.size},n,{parseOptions:t,errorOnInvalidContent:(u=s.errorOnInvalidContent)!==null&&u!==void 0?u:i.options.enableContentCheck})};function K5(n,e){const t=Vd(e,n.schema),{from:s,to:i,empty:r}=n.selection,o=[];r?(n.storedMarks&&o.push(...n.storedMarks),o.push(...n.selection.$head.marks())):n.doc.nodesBetween(s,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function Nte(n,e){const t=new z_(n);return e.forEach(s=>{s.steps.forEach(i=>{t.step(i)})}),t}function Ete(n){for(let e=0;e<n.edgeCount;e+=1){const{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function Tte(n,e,t){const s=[];return n.nodesBetween(e.from,e.to,(i,r)=>{t(i)&&s.push({node:i,pos:r})}),s}function Y5(n,e){for(let t=n.depth;t>0;t-=1){const s=n.node(t);if(e(s))return{pos:t>0?n.before(t):0,start:n.start(t),depth:t,node:s}}}function n2(n){return e=>Y5(e.$from,n)}function J5(n,e){const t={from:0,to:n.content.size};return $5(n,t,e)}function _te(n,e){const t=$s(e,n.schema),{from:s,to:i}=n.selection,r=[];n.doc.nodesBetween(s,i,a=>{r.push(a)});const o=r.reverse().find(a=>a.type.name===t.name);return o?{...o.attrs}:{}}function X5(n,e){const t=$S(typeof e=="string"?e:e.name,n.schema);return t==="node"?_te(n,e):t==="mark"?K5(n,e):{}}function Mte(n,e=JSON.stringify){const t={};return n.filter(s=>{const i=e(s);return Object.prototype.hasOwnProperty.call(t,i)?!1:t[i]=!0})}function Rte(n){const e=Mte(n);return e.length===1?e:e.filter((t,s)=>!e.filter((r,o)=>o!==s).some(r=>t.oldRange.from>=r.oldRange.from&&t.oldRange.to<=r.oldRange.to&&t.newRange.from>=r.newRange.from&&t.newRange.to<=r.newRange.to))}function Ite(n){const{mapping:e,steps:t}=n,s=[];return e.maps.forEach((i,r)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=t[r];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const u=e.slice(r).map(a,-1),f=e.slice(r).map(l),p=e.invert().map(u,-1),g=e.invert().map(f);s.push({oldRange:{from:p,to:g},newRange:{from:u,to:f}})})}),Rte(s)}function s2(n,e,t){const s=[];return n===e?t.resolve(n).marks().forEach(i=>{const r=t.resolve(n),o=Z_(r,i.type);o&&s.push({mark:i,...o})}):t.nodesBetween(n,e,(i,r)=>{!i||(i==null?void 0:i.nodeSize)===void 0||s.push(...i.marks.map(o=>({from:r,to:r+i.nodeSize,mark:o})))}),s}function Qv(n,e,t){return Object.fromEntries(Object.entries(t).filter(([s])=>{const i=n.find(r=>r.type===e&&r.name===s);return i?i.attribute.keepOnSplit:!1}))}function fE(n,e,t={}){const{empty:s,ranges:i}=n.selection,r=e?Vd(e,n.schema):null;if(s)return!!(n.storedMarks||n.selection.$from.marks()).filter(p=>r?r.name===p.type.name:!0).find(p=>uk(p.attrs,t,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:p,$to:g})=>{const b=p.pos,w=g.pos;n.doc.nodesBetween(b,w,(S,N)=>{if(!S.isText&&!S.marks.length)return;const C=Math.max(b,N),M=Math.min(w,N+S.nodeSize),R=M-C;o+=R,a.push(...S.marks.map(_=>({mark:_,from:C,to:M})))})}),o===0)return!1;const l=a.filter(p=>r?r.name===p.mark.type.name:!0).filter(p=>uk(p.mark.attrs,t,{strict:!1})).reduce((p,g)=>p+g.to-g.from,0),u=a.filter(p=>r?p.mark.type!==r&&p.mark.type.excludes(r):!0).reduce((p,g)=>p+g.to-g.from,0);return(l>0?l+u:l)>=o}function zte(n,e,t={}){if(!e)return sx(n,null,t)||fE(n,null,t);const s=$S(e,n.schema);return s==="node"?sx(n,e,t):s==="mark"?fE(n,e,t):!1}function QP(n,e){const{nodeExtensions:t}=FS(e),s=t.find(o=>o.name===n);if(!s)return!1;const i={name:s.name,options:s.options,storage:s.storage},r=Tt(nt(s,"group",i));return typeof r!="string"?!1:r.split(" ").includes("list")}function i2(n,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var s;if(t){if(n.type.name==="hardBreak")return!0;if(n.isText)return/^\s*$/m.test((s=n.text)!==null&&s!==void 0?s:"")}if(n.isText)return!n.text;if(n.isAtom||n.isLeaf)return!1;if(n.content.childCount===0)return!0;if(e){let i=!0;return n.content.forEach(r=>{i!==!1&&(i2(r,{ignoreWhitespace:t,checkChildren:e})||(i=!1))}),i}return!1}function Q5(n){return n instanceof dt}function Z5(n,e,t){const i=n.state.doc.content.size,r=Gl(e,0,i),o=Gl(t,0,i),a=n.coordsAtPos(r),l=n.coordsAtPos(o,-1),u=Math.min(a.top,l.top),f=Math.max(a.bottom,l.bottom),p=Math.min(a.left,l.left),g=Math.max(a.right,l.right),b=g-p,w=f-u,C={top:u,bottom:f,left:p,right:g,width:b,height:w,x:p,y:u};return{...C,toJSON:()=>C}}function Dte(n,e,t){var s;const{selection:i}=e;let r=null;if(e2(i)&&(r=i.$cursor),r){const a=(s=n.storedMarks)!==null&&s!==void 0?s:r.marks();return!!t.isInSet(a)||!a.some(l=>l.type.excludes(t))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let u=a.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(t):!1;return n.doc.nodesBetween(a.pos,l.pos,(f,p,g)=>{if(u)return!1;if(f.isInline){const b=!g||g.type.allowsMarkType(t),w=!!t.isInSet(f.marks)||!f.marks.some(S=>S.type.excludes(t));u=b&&w}return!u}),u})}const jte=(n,e={})=>({tr:t,state:s,dispatch:i})=>{const{selection:r}=t,{empty:o,ranges:a}=r,l=Vd(n,s.schema);if(i)if(o){const u=K5(s,l);t.addStoredMark(l.create({...u,...e}))}else a.forEach(u=>{const f=u.$from.pos,p=u.$to.pos;s.doc.nodesBetween(f,p,(g,b)=>{const w=Math.max(b,f),S=Math.min(b+g.nodeSize,p);g.marks.find(C=>C.type===l)?g.marks.forEach(C=>{l===C.type&&t.addMark(w,S,l.create({...C.attrs,...e}))}):t.addMark(w,S,l.create(e))})});return Dte(s,t,l)},Pte=(n,e)=>({tr:t})=>(t.setMeta(n,e),!0),Lte=(n,e={})=>({state:t,dispatch:s,chain:i})=>{const r=$s(n,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),r.isTextblock?i().command(({commands:a})=>qP(r,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>qP(r,{...o,...e})(a,s)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Ote=n=>({tr:e,dispatch:t})=>{if(t){const{doc:s}=e,i=Gl(n,0,s.content.size),r=dt.create(s,i);e.setSelection(r)}return!0},Bte=n=>({tr:e,dispatch:t})=>{if(t){const{doc:s}=e,{from:i,to:r}=typeof n=="number"?{from:n,to:n}:n,o=ut.atStart(s).from,a=ut.atEnd(s).to,l=Gl(i,o,a),u=Gl(r,o,a),f=ut.create(s,l,u);e.setSelection(f)}return!0},Fte=n=>({state:e,dispatch:t})=>{const s=$s(n,e.schema);return yee(s)(e,t)};function ZP(n,e){const t=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(t){const s=t.filter(i=>e==null?void 0:e.includes(i.type.name));n.tr.ensureMarks(s)}}const Hte=({keepMarks:n=!0}={})=>({tr:e,state:t,dispatch:s,editor:i})=>{const{selection:r,doc:o}=e,{$from:a,$to:l}=r,u=i.extensionManager.attributes,f=Qv(u,a.node().type.name,a.node().attrs);if(r instanceof dt&&r.node.isBlock)return!a.parentOffset||!ql(o,a.pos)?!1:(s&&(n&&ZP(t,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const p=l.parentOffset===l.parent.content.size,g=a.depth===0?void 0:Ete(a.node(-1).contentMatchAt(a.indexAfter(-1)));let b=p&&g?[{type:g,attrs:f}]:void 0,w=ql(e.doc,e.mapping.map(a.pos),1,b);if(!b&&!w&&ql(e.doc,e.mapping.map(a.pos),1,g?[{type:g}]:void 0)&&(w=!0,b=g?[{type:g,attrs:f}]:void 0),s){if(w&&(r instanceof ut&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,b),g&&!p&&!a.parentOffset&&a.parent.type!==g)){const S=e.mapping.map(a.before()),N=e.doc.resolve(S);a.node(-1).canReplaceWith(N.index(),N.index()+1,g)&&e.setNodeMarkup(e.mapping.map(a.before()),g)}n&&ZP(t,i.extensionManager.splittableMarks),e.scrollIntoView()}return w},Ute=(n,e={})=>({tr:t,state:s,dispatch:i,editor:r})=>{var o;const a=$s(n,s.schema),{$from:l,$to:u}=s.selection,f=s.selection.node;if(f&&f.isBlock||l.depth<2||!l.sameParent(u))return!1;const p=l.node(-1);if(p.type!==a)return!1;const g=r.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let C=Ie.empty;const M=l.index(-1)?1:l.index(-2)?2:3;for(let U=l.depth-M;U>=l.depth-3;U-=1)C=Ie.from(l.node(U).copy(C));const R=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,_={...Qv(g,l.node().type.name,l.node().attrs),...e},j=((o=a.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(_))||void 0;C=C.append(Ie.from(a.createAndFill(null,j)||void 0));const P=l.before(l.depth-(M-1));t.replace(P,l.after(-R),new Ve(C,4-M,0));let D=-1;t.doc.nodesBetween(P,t.doc.content.size,(U,V)=>{if(D>-1)return!1;U.isTextblock&&U.content.size===0&&(D=V+1)}),D>-1&&t.setSelection(ut.near(t.doc.resolve(D))),t.scrollIntoView()}return!0}const b=u.pos===l.end()?p.contentMatchAt(0).defaultType:null,w={...Qv(g,p.type.name,p.attrs),...e},S={...Qv(g,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,u.pos);const N=b?[{type:a,attrs:w},{type:b,attrs:S}]:[{type:a,attrs:w}];if(!ql(t.doc,l.pos,2))return!1;if(i){const{selection:C,storedMarks:M}=s,{splittableMarks:R}=r.extensionManager,_=M||C.$to.parentOffset&&C.$from.marks();if(t.split(l.pos,2,N).scrollIntoView(),!_||!i)return!0;const j=_.filter(P=>R.includes(P.type.name));t.ensureMarks(j)}return!0},$A=(n,e)=>{const t=n2(o=>o.type===e)(n.selection);if(!t)return!0;const s=n.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(s===void 0)return!0;const i=n.doc.nodeAt(s);return t.node.type===(i==null?void 0:i.type)&&$d(n.doc,t.pos)&&n.join(t.pos),!0},GA=(n,e)=>{const t=n2(o=>o.type===e)(n.selection);if(!t)return!0;const s=n.doc.resolve(t.start).after(t.depth);if(s===void 0)return!0;const i=n.doc.nodeAt(s);return t.node.type===(i==null?void 0:i.type)&&$d(n.doc,s)&&n.join(s),!0},$te=(n,e,t,s={})=>({editor:i,tr:r,state:o,dispatch:a,chain:l,commands:u,can:f})=>{const{extensions:p,splittableMarks:g}=i.extensionManager,b=$s(n,o.schema),w=$s(e,o.schema),{selection:S,storedMarks:N}=o,{$from:C,$to:M}=S,R=C.blockRange(M),_=N||S.$to.parentOffset&&S.$from.marks();if(!R)return!1;const j=n2(P=>QP(P.type.name,p))(S);if(R.depth>=1&&j&&R.depth-j.depth<=1){if(j.node.type===b)return u.liftListItem(w);if(QP(j.node.type.name,p)&&b.validContent(j.node.content)&&a)return l().command(()=>(r.setNodeMarkup(j.pos,b),!0)).command(()=>$A(r,b)).command(()=>GA(r,b)).run()}return!t||!_||!a?l().command(()=>f().wrapInList(b,s)?!0:u.clearNodes()).wrapInList(b,s).command(()=>$A(r,b)).command(()=>GA(r,b)).run():l().command(()=>{const P=f().wrapInList(b,s),D=_.filter(U=>g.includes(U.type.name));return r.ensureMarks(D),P?!0:u.clearNodes()}).wrapInList(b,s).command(()=>$A(r,b)).command(()=>GA(r,b)).run()},Gte=(n,e={},t={})=>({state:s,commands:i})=>{const{extendEmptyMarkRange:r=!1}=t,o=Vd(n,s.schema);return fE(s,o,e)?i.unsetMark(o,{extendEmptyMarkRange:r}):i.setMark(o,e)},Vte=(n,e,t={})=>({state:s,commands:i})=>{const r=$s(n,s.schema),o=$s(e,s.schema),a=sx(s,r,t);let l;return s.selection.$anchor.sameParent(s.selection.$head)&&(l=s.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(r,{...l,...t})},qte=(n,e={})=>({state:t,commands:s})=>{const i=$s(n,t.schema);return sx(t,i,e)?s.lift(i):s.wrapIn(i,e)},Wte=()=>({state:n,dispatch:e})=>{const t=n.plugins;for(let s=0;s<t.length;s+=1){const i=t[s];let r;if(i.spec.isInputRules&&(r=i.getState(n))){if(e){const o=n.tr,a=r.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(r.text){const l=o.doc.resolve(r.from).marks();o.replaceWith(r.from,r.to,n.schema.text(r.text,l))}else o.delete(r.from,r.to)}return!0}}return!1},Kte=()=>({tr:n,dispatch:e})=>{const{selection:t}=n,{empty:s,ranges:i}=t;return s||e&&i.forEach(r=>{n.removeMark(r.$from.pos,r.$to.pos)}),!0},Yte=(n,e={})=>({tr:t,state:s,dispatch:i})=>{var r;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=Vd(n,s.schema),{$from:u,empty:f,ranges:p}=a;if(!i)return!0;if(f&&o){let{from:g,to:b}=a;const w=(r=u.marks().find(N=>N.type===l))===null||r===void 0?void 0:r.attrs,S=Z_(u,l,w);S&&(g=S.from,b=S.to),t.removeMark(g,b,l)}else p.forEach(g=>{t.removeMark(g.$from.pos,g.$to.pos,l)});return t.removeStoredMark(l),!0},Jte=(n,e={})=>({tr:t,state:s,dispatch:i})=>{let r=null,o=null;const a=$S(typeof n=="string"?n:n.name,s.schema);return a?(a==="node"&&(r=$s(n,s.schema)),a==="mark"&&(o=Vd(n,s.schema)),i&&t.selection.ranges.forEach(l=>{const u=l.$from.pos,f=l.$to.pos;let p,g,b,w;t.selection.empty?s.doc.nodesBetween(u,f,(S,N)=>{r&&r===S.type&&(b=Math.max(N,u),w=Math.min(N+S.nodeSize,f),p=N,g=S)}):s.doc.nodesBetween(u,f,(S,N)=>{N<u&&r&&r===S.type&&(b=Math.max(N,u),w=Math.min(N+S.nodeSize,f),p=N,g=S),N>=u&&N<=f&&(r&&r===S.type&&t.setNodeMarkup(N,void 0,{...S.attrs,...e}),o&&S.marks.length&&S.marks.forEach(C=>{if(o===C.type){const M=Math.max(N,u),R=Math.min(N+S.nodeSize,f);t.addMark(M,R,o.create({...C.attrs,...e}))}}))}),g&&(p!==void 0&&t.setNodeMarkup(p,void 0,{...g.attrs,...e}),o&&g.marks.length&&g.marks.forEach(S=>{o===S.type&&t.addMark(b,w,o.create({...S.attrs,...e}))}))}),!0):!1},Xte=(n,e={})=>({state:t,dispatch:s})=>{const i=$s(n,t.schema);return hee(i,e)(t,s)},Qte=(n,e={})=>({state:t,dispatch:s})=>{const i=$s(n,t.schema);return fee(i,e)(t,s)};var Zte=Object.freeze({__proto__:null,blur:Pee,clearContent:Lee,clearNodes:Oee,command:Bee,createParagraphNear:Fee,cut:Hee,deleteCurrentNode:Uee,deleteNode:$ee,deleteRange:Gee,deleteSelection:Vee,enter:qee,exitCode:Wee,extendMarkRange:Kee,first:Yee,focus:Xee,forEach:Qee,insertContent:Zee,insertContentAt:nte,joinBackward:rte,joinDown:ite,joinForward:ote,joinItemBackward:ate,joinItemForward:lte,joinTextblockBackward:cte,joinTextblockForward:dte,joinUp:ste,keyboardShortcut:hte,lift:fte,liftEmptyBlock:pte,liftListItem:mte,newlineInCode:gte,resetAttributes:xte,scrollIntoView:bte,selectAll:yte,selectNodeBackward:vte,selectNodeForward:wte,selectParentNode:kte,selectTextblockEnd:Ste,selectTextblockStart:Cte,setContent:Ate,setMark:jte,setMeta:Pte,setNode:Lte,setNodeSelection:Ote,setTextSelection:Bte,sinkListItem:Fte,splitBlock:Hte,splitListItem:Ute,toggleList:$te,toggleMark:Gte,toggleNode:Vte,toggleWrap:qte,undoInputRule:Wte,unsetAllMarks:Kte,unsetMark:Yte,updateAttributes:Jte,wrapIn:Xte,wrapInList:Qte});const ene=bs.create({name:"commands",addCommands(){return{...Zte}}}),tne=bs.create({name:"drop",addProseMirrorPlugins(){return[new Jn({key:new Ts("tiptapDrop"),props:{handleDrop:(n,e,t,s)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:s})}}})]}}),nne=bs.create({name:"editable",addProseMirrorPlugins(){return[new Jn({key:new Ts("editable"),props:{editable:()=>this.editor.options.editable}})]}}),sne=new Ts("focusEvents"),ine=bs.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:n}=this;return[new Jn({key:sne,props:{handleDOMEvents:{focus:(e,t)=>{n.isFocused=!0;const s=n.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(s),!1},blur:(e,t)=>{n.isFocused=!1;const s=n.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(s),!1}}}})]}}),rne=bs.create({name:"keymap",addKeyboardShortcuts(){const n=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:u}=a,{empty:f,$anchor:p}=l,{pos:g,parent:b}=p,w=p.parent.isTextblock&&g>0?a.doc.resolve(g-1):p,S=w.parent.type.spec.isolating,N=p.pos-p.parentOffset,C=S&&w.parent.childCount===1?N===p.pos:mt.atStart(u).from===g;return!f||!b.type.isTextblock||b.textContent.length||!C||C&&p.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),s={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...s},r={...s,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return t2()||W5()?r:i},addProseMirrorPlugins(){return[new Jn({key:new Ts("clearDocument"),appendTransaction:(n,e,t)=>{if(n.some(S=>S.getMeta("composition")))return;const s=n.some(S=>S.docChanged)&&!e.doc.eq(t.doc),i=n.some(S=>S.getMeta("preventClearDocument"));if(!s||i)return;const{empty:r,from:o,to:a}=e.selection,l=mt.atStart(e.doc).from,u=mt.atEnd(e.doc).to;if(r||!(o===l&&a===u)||!i2(t.doc))return;const g=t.tr,b=OS({state:t,transaction:g}),{commands:w}=new BS({editor:this.editor,state:b});if(w.clearNodes(),!!g.steps.length)return g}})]}}),one=bs.create({name:"paste",addProseMirrorPlugins(){return[new Jn({key:new Ts("tiptapPaste"),props:{handlePaste:(n,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),ane=bs.create({name:"tabindex",addProseMirrorPlugins(){return[new Jn({key:new Ts("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class Su{get name(){return this.node.type.name}constructor(e,t,s=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=s,this.resolvedPos=e,this.editor=t,this.currentNode=i}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let t=this.from,s=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}t=this.from+1,s=this.to-1}this.editor.commands.insertContentAt({from:t,to:s},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),t=this.resolvedPos.doc.resolve(e);return new Su(t,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Su(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Su(e,this.editor)}get children(){const e=[];return this.node.content.forEach((t,s)=>{const i=t.isBlock&&!t.isTextblock,r=t.isAtom&&!t.isText,o=this.pos+s+(r?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!i&&a.depth<=this.depth)return;const l=new Su(a,this.editor,i,i?t:null);i&&(l.actualDepth=this.depth+1),e.push(new Su(a,this.editor,i,i?t:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,t={}){let s=null,i=this.parent;for(;i&&!s;){if(i.node.type.name===e)if(Object.keys(t).length>0){const r=i.node.attrs,o=Object.keys(t);for(let a=0;a<o.length;a+=1){const l=o[a];if(r[l]!==t[l])break}}else s=i;i=i.parent}return s}querySelector(e,t={}){return this.querySelectorAll(e,t,!0)[0]||null}querySelectorAll(e,t={},s=!1){let i=[];if(!this.children||this.children.length===0)return i;const r=Object.keys(t);return this.children.forEach(o=>{s&&i.length>0||(o.node.type.name===e&&r.every(l=>t[l]===o.node.attrs[l])&&i.push(o),!(s&&i.length>0)&&(i=i.concat(o.querySelectorAll(e,t,s))))}),i}setAttribute(e){const{tr:t}=this.editor.state;t.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(t)}}const lne=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function cne(n,e,t){const s=document.querySelector("style[data-tiptap-style]");if(s!==null)return s;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(i),i}class dne extends vee{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:t})=>{throw t},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:t,slice:s,moved:i})=>this.options.onDrop(t,s,i)),this.on("paste",({event:t,slice:s})=>this.options.onPaste(t,s)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=cne(lne,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const s=U5(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:s});return this.view.updateState(i),i}unregisterPlugin(e){if(this.isDestroyed)return;const t=this.state.plugins;let s=t;if([].concat(e).forEach(r=>{const o=typeof r=="string"?`${r}$`:r.key;s=s.filter(a=>!a.key.startsWith(o))}),t.length===s.length)return;const i=this.state.reconfigure({plugins:s});return this.view.updateState(i),i}createExtensionManager(){var e,t;const i=[...this.options.enableCoreExtensions?[nne,jee.configure({blockSeparator:(t=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||t===void 0?void 0:t.blockSeparator}),ene,ine,rne,ane,tne,one].filter(r=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[r.name]!==!1:!0):[],...this.options.extensions].filter(r=>["extension","node","mark"].includes(r==null?void 0:r.type));this.extensionManager=new up(i,this)}createCommandManager(){this.commandManager=new BS({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let t;try{t=hE(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),t=hE(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const s=V5(t,this.options.autofocus);this.view=new T5(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:dp.create({doc:t,selection:s||void 0})});const i=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(i),this.createNodeViews(),this.prependClass();const r=this.view.dom;r.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const t=this.state.apply(e),s=!this.state.selection.eq(t.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:t}),this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),s&&this.emit("selectionUpdate",{editor:this,transaction:e});const i=e.getMeta("focus"),r=e.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:e}),r&&this.emit("blur",{editor:this,event:r.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return X5(this.state,e)}isActive(e,t){const s=typeof e=="string"?e:null,i=typeof e=="string"?t:e;return zte(this.state,s,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return J_(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t=`

`,textSerializers:s={}}=e||{};return J5(this.state.doc,{blockSeparator:t,textSerializers:{...Q_(this.schema),...s}})}get isEmpty(){return i2(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,t){var s;return((s=this.$doc)===null||s===void 0?void 0:s.querySelector(e,t))||null}$nodes(e,t){var s;return((s=this.$doc)===null||s===void 0?void 0:s.querySelectorAll(e,t))||null}$pos(e){const t=this.state.doc.resolve(e);return new Su(t,this)}get $doc(){return this.$pos(0)}}function Wh(n){return new HS({find:n.find,handler:({state:e,range:t,match:s})=>{const i=Tt(n.getAttributes,void 0,s);if(i===!1||i===null)return null;const{tr:r}=e,o=s[s.length-1],a=s[0];if(o){const l=a.search(/\S/),u=t.from+a.indexOf(o),f=u+o.length;if(s2(t.from,t.to,e.doc).filter(b=>b.mark.type.excluded.find(S=>S===n.type&&S!==b.mark.type)).filter(b=>b.to>u).length)return null;f<t.to&&r.delete(f,t.to),u>t.from&&r.delete(t.from+l,u);const g=t.from+l+o.length;r.addMark(t.from+l,g,n.type.create(i||{})),r.removeStoredMark(n.type)}}})}function eB(n){return new HS({find:n.find,handler:({state:e,range:t,match:s})=>{const i=Tt(n.getAttributes,void 0,s)||{},{tr:r}=e,o=t.from;let a=t.to;const l=n.type.create(i);if(s[1]){const u=s[0].lastIndexOf(s[1]);let f=o+u;f>a?f=a:a=f+s[1].length;const p=s[0][s[0].length-1];r.insertText(p,o+s[0].length-1),r.replaceWith(f,a,l)}else if(s[0]){const u=n.type.isInline?o:o-1;r.insert(u,n.type.create(i)).delete(r.mapping.map(o),r.mapping.map(a))}r.scrollIntoView()}})}function pE(n){return new HS({find:n.find,handler:({state:e,range:t,match:s})=>{const i=e.doc.resolve(t.from),r=Tt(n.getAttributes,void 0,s)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),n.type))return null;e.tr.delete(t.from,t.to).setBlockType(t.from,t.from,n.type,r)}})}function Im(n){return new HS({find:n.find,handler:({state:e,range:t,match:s,chain:i})=>{const r=Tt(n.getAttributes,void 0,s)||{},o=e.tr.delete(t.from,t.to),l=o.doc.resolve(t.from).blockRange(),u=l&&I_(l,n.type,r);if(!u)return null;if(o.wrap(l,u),n.keepMarks&&n.editor){const{selection:p,storedMarks:g}=e,{splittableMarks:b}=n.editor.extensionManager,w=g||p.$to.parentOffset&&p.$from.marks();if(w){const S=w.filter(N=>b.includes(N.type.name));o.ensureMarks(S)}}if(n.keepAttributes){const p=n.type.name==="bulletList"||n.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(p,r).run()}const f=o.doc.resolve(t.from-1).nodeBefore;f&&f.type===n.type&&$d(o.doc,t.from-1)&&(!n.joinPredicate||n.joinPredicate(s,f))&&o.join(t.from-1)}})}let Vs=class mE{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Tt(nt(this,"addOptions",{name:this.name}))),this.storage=Tt(nt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new mE(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>US(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new mE(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=Tt(nt(t,"addOptions",{name:t.name})),t.storage=Tt(nt(t,"addStorage",{name:t.name,options:t.options})),t}};function Ld(n){return new _ee({find:n.find,handler:({state:e,range:t,match:s,pasteEvent:i})=>{const r=Tt(n.getAttributes,void 0,s,i);if(r===!1||r===null)return null;const{tr:o}=e,a=s[s.length-1],l=s[0];let u=t.to;if(a){const f=l.search(/\S/),p=t.from+l.indexOf(a),g=p+a.length;if(s2(t.from,t.to,e.doc).filter(w=>w.mark.type.excluded.find(N=>N===n.type&&N!==w.mark.type)).filter(w=>w.to>p).length)return null;g<t.to&&o.delete(g,t.to),p>t.from&&o.delete(t.from+f,p),u=t.from+f+a.length,o.addMark(t.from+f,u,n.type.create(r||{})),o.removeStoredMark(n.type)}}})}function une(n,e){const{selection:t}=n,{$from:s}=t;if(t instanceof dt){const r=s.index();return s.parent.canReplaceWith(r,r+1,e)}let i=s.depth;for(;i>=0;){const r=s.index(i);if(s.node(i).contentMatchAt(r).matchType(e))return!0;i-=1}return!1}var tr="top",po="bottom",mo="right",nr="left",r2="auto",Gb=[tr,po,mo,nr],zm="start",ix="end",hne="clippingParents",tB="viewport",qg="popper",fne="reference",eL=Gb.reduce(function(n,e){return n.concat([e+"-"+zm,e+"-"+ix])},[]),nB=[].concat(Gb,[r2]).reduce(function(n,e){return n.concat([e,e+"-"+zm,e+"-"+ix])},[]),pne="beforeRead",mne="read",gne="afterRead",xne="beforeMain",bne="main",yne="afterMain",vne="beforeWrite",wne="write",kne="afterWrite",Sne=[pne,mne,gne,xne,bne,yne,vne,wne,kne];function Pa(n){return n?(n.nodeName||"").toLowerCase():null}function jr(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function Kh(n){var e=jr(n).Element;return n instanceof e||n instanceof Element}function uo(n){var e=jr(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function o2(n){if(typeof ShadowRoot>"u")return!1;var e=jr(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function Cne(n){var e=n.state;Object.keys(e.elements).forEach(function(t){var s=e.styles[t]||{},i=e.attributes[t]||{},r=e.elements[t];!uo(r)||!Pa(r)||(Object.assign(r.style,s),Object.keys(i).forEach(function(o){var a=i[o];a===!1?r.removeAttribute(o):r.setAttribute(o,a===!0?"":a)}))})}function Ane(n){var e=n.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(s){var i=e.elements[s],r=e.attributes[s]||{},o=Object.keys(e.styles.hasOwnProperty(s)?e.styles[s]:t[s]),a=o.reduce(function(l,u){return l[u]="",l},{});!uo(i)||!Pa(i)||(Object.assign(i.style,a),Object.keys(r).forEach(function(l){i.removeAttribute(l)}))})}}const sB={name:"applyStyles",enabled:!0,phase:"write",fn:Cne,effect:Ane,requires:["computeStyles"]};function Ia(n){return n.split("-")[0]}var Oh=Math.max,hk=Math.min,Dm=Math.round;function gE(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function iB(){return!/^((?!chrome|android).)*safari/i.test(gE())}function jm(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var s=n.getBoundingClientRect(),i=1,r=1;e&&uo(n)&&(i=n.offsetWidth>0&&Dm(s.width)/n.offsetWidth||1,r=n.offsetHeight>0&&Dm(s.height)/n.offsetHeight||1);var o=Kh(n)?jr(n):window,a=o.visualViewport,l=!iB()&&t,u=(s.left+(l&&a?a.offsetLeft:0))/i,f=(s.top+(l&&a?a.offsetTop:0))/r,p=s.width/i,g=s.height/r;return{width:p,height:g,top:f,right:u+p,bottom:f+g,left:u,x:u,y:f}}function a2(n){var e=jm(n),t=n.offsetWidth,s=n.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-s)<=1&&(s=e.height),{x:n.offsetLeft,y:n.offsetTop,width:t,height:s}}function rB(n,e){var t=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(t&&o2(t)){var s=e;do{if(s&&n.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function Xl(n){return jr(n).getComputedStyle(n)}function Nne(n){return["table","td","th"].indexOf(Pa(n))>=0}function qd(n){return((Kh(n)?n.ownerDocument:n.document)||window.document).documentElement}function GS(n){return Pa(n)==="html"?n:n.assignedSlot||n.parentNode||(o2(n)?n.host:null)||qd(n)}function tL(n){return!uo(n)||Xl(n).position==="fixed"?null:n.offsetParent}function Ene(n){var e=/firefox/i.test(gE()),t=/Trident/i.test(gE());if(t&&uo(n)){var s=Xl(n);if(s.position==="fixed")return null}var i=GS(n);for(o2(i)&&(i=i.host);uo(i)&&["html","body"].indexOf(Pa(i))<0;){var r=Xl(i);if(r.transform!=="none"||r.perspective!=="none"||r.contain==="paint"||["transform","perspective"].indexOf(r.willChange)!==-1||e&&r.willChange==="filter"||e&&r.filter&&r.filter!=="none")return i;i=i.parentNode}return null}function Vb(n){for(var e=jr(n),t=tL(n);t&&Nne(t)&&Xl(t).position==="static";)t=tL(t);return t&&(Pa(t)==="html"||Pa(t)==="body"&&Xl(t).position==="static")?e:t||Ene(n)||e}function l2(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function T0(n,e,t){return Oh(n,hk(e,t))}function Tne(n,e,t){var s=T0(n,e,t);return s>t?t:s}function oB(){return{top:0,right:0,bottom:0,left:0}}function aB(n){return Object.assign({},oB(),n)}function lB(n,e){return e.reduce(function(t,s){return t[s]=n,t},{})}var _ne=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,aB(typeof e!="number"?e:lB(e,Gb))};function Mne(n){var e,t=n.state,s=n.name,i=n.options,r=t.elements.arrow,o=t.modifiersData.popperOffsets,a=Ia(t.placement),l=l2(a),u=[nr,mo].indexOf(a)>=0,f=u?"height":"width";if(!(!r||!o)){var p=_ne(i.padding,t),g=a2(r),b=l==="y"?tr:nr,w=l==="y"?po:mo,S=t.rects.reference[f]+t.rects.reference[l]-o[l]-t.rects.popper[f],N=o[l]-t.rects.reference[l],C=Vb(r),M=C?l==="y"?C.clientHeight||0:C.clientWidth||0:0,R=S/2-N/2,_=p[b],j=M-g[f]-p[w],P=M/2-g[f]/2+R,D=T0(_,P,j),U=l;t.modifiersData[s]=(e={},e[U]=D,e.centerOffset=D-P,e)}}function Rne(n){var e=n.state,t=n.options,s=t.element,i=s===void 0?"[data-popper-arrow]":s;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||rB(e.elements.popper,i)&&(e.elements.arrow=i))}const Ine={name:"arrow",enabled:!0,phase:"main",fn:Mne,effect:Rne,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Pm(n){return n.split("-")[1]}var zne={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Dne(n,e){var t=n.x,s=n.y,i=e.devicePixelRatio||1;return{x:Dm(t*i)/i||0,y:Dm(s*i)/i||0}}function nL(n){var e,t=n.popper,s=n.popperRect,i=n.placement,r=n.variation,o=n.offsets,a=n.position,l=n.gpuAcceleration,u=n.adaptive,f=n.roundOffsets,p=n.isFixed,g=o.x,b=g===void 0?0:g,w=o.y,S=w===void 0?0:w,N=typeof f=="function"?f({x:b,y:S}):{x:b,y:S};b=N.x,S=N.y;var C=o.hasOwnProperty("x"),M=o.hasOwnProperty("y"),R=nr,_=tr,j=window;if(u){var P=Vb(t),D="clientHeight",U="clientWidth";if(P===jr(t)&&(P=qd(t),Xl(P).position!=="static"&&a==="absolute"&&(D="scrollHeight",U="scrollWidth")),P=P,i===tr||(i===nr||i===mo)&&r===ix){_=po;var V=p&&P===j&&j.visualViewport?j.visualViewport.height:P[D];S-=V-s.height,S*=l?1:-1}if(i===nr||(i===tr||i===po)&&r===ix){R=mo;var q=p&&P===j&&j.visualViewport?j.visualViewport.width:P[U];b-=q-s.width,b*=l?1:-1}}var G=Object.assign({position:a},u&&zne),ee=f===!0?Dne({x:b,y:S},jr(t)):{x:b,y:S};if(b=ee.x,S=ee.y,l){var W;return Object.assign({},G,(W={},W[_]=M?"0":"",W[R]=C?"0":"",W.transform=(j.devicePixelRatio||1)<=1?"translate("+b+"px, "+S+"px)":"translate3d("+b+"px, "+S+"px, 0)",W))}return Object.assign({},G,(e={},e[_]=M?S+"px":"",e[R]=C?b+"px":"",e.transform="",e))}function jne(n){var e=n.state,t=n.options,s=t.gpuAcceleration,i=s===void 0?!0:s,r=t.adaptive,o=r===void 0?!0:r,a=t.roundOffsets,l=a===void 0?!0:a,u={placement:Ia(e.placement),variation:Pm(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,nL(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,nL(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const Pne={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:jne,data:{}};var Rv={passive:!0};function Lne(n){var e=n.state,t=n.instance,s=n.options,i=s.scroll,r=i===void 0?!0:i,o=s.resize,a=o===void 0?!0:o,l=jr(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return r&&u.forEach(function(f){f.addEventListener("scroll",t.update,Rv)}),a&&l.addEventListener("resize",t.update,Rv),function(){r&&u.forEach(function(f){f.removeEventListener("scroll",t.update,Rv)}),a&&l.removeEventListener("resize",t.update,Rv)}}const One={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Lne,data:{}};var Bne={left:"right",right:"left",bottom:"top",top:"bottom"};function Zv(n){return n.replace(/left|right|bottom|top/g,function(e){return Bne[e]})}var Fne={start:"end",end:"start"};function sL(n){return n.replace(/start|end/g,function(e){return Fne[e]})}function c2(n){var e=jr(n),t=e.pageXOffset,s=e.pageYOffset;return{scrollLeft:t,scrollTop:s}}function d2(n){return jm(qd(n)).left+c2(n).scrollLeft}function Hne(n,e){var t=jr(n),s=qd(n),i=t.visualViewport,r=s.clientWidth,o=s.clientHeight,a=0,l=0;if(i){r=i.width,o=i.height;var u=iB();(u||!u&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:r,height:o,x:a+d2(n),y:l}}function Une(n){var e,t=qd(n),s=c2(n),i=(e=n.ownerDocument)==null?void 0:e.body,r=Oh(t.scrollWidth,t.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=Oh(t.scrollHeight,t.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-s.scrollLeft+d2(n),l=-s.scrollTop;return Xl(i||t).direction==="rtl"&&(a+=Oh(t.clientWidth,i?i.clientWidth:0)-r),{width:r,height:o,x:a,y:l}}function u2(n){var e=Xl(n),t=e.overflow,s=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+i+s)}function cB(n){return["html","body","#document"].indexOf(Pa(n))>=0?n.ownerDocument.body:uo(n)&&u2(n)?n:cB(GS(n))}function _0(n,e){var t;e===void 0&&(e=[]);var s=cB(n),i=s===((t=n.ownerDocument)==null?void 0:t.body),r=jr(s),o=i?[r].concat(r.visualViewport||[],u2(s)?s:[]):s,a=e.concat(o);return i?a:a.concat(_0(GS(o)))}function xE(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function $ne(n,e){var t=jm(n,!1,e==="fixed");return t.top=t.top+n.clientTop,t.left=t.left+n.clientLeft,t.bottom=t.top+n.clientHeight,t.right=t.left+n.clientWidth,t.width=n.clientWidth,t.height=n.clientHeight,t.x=t.left,t.y=t.top,t}function iL(n,e,t){return e===tB?xE(Hne(n,t)):Kh(e)?$ne(e,t):xE(Une(qd(n)))}function Gne(n){var e=_0(GS(n)),t=["absolute","fixed"].indexOf(Xl(n).position)>=0,s=t&&uo(n)?Vb(n):n;return Kh(s)?e.filter(function(i){return Kh(i)&&rB(i,s)&&Pa(i)!=="body"}):[]}function Vne(n,e,t,s){var i=e==="clippingParents"?Gne(n):[].concat(e),r=[].concat(i,[t]),o=r[0],a=r.reduce(function(l,u){var f=iL(n,u,s);return l.top=Oh(f.top,l.top),l.right=hk(f.right,l.right),l.bottom=hk(f.bottom,l.bottom),l.left=Oh(f.left,l.left),l},iL(n,o,s));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function dB(n){var e=n.reference,t=n.element,s=n.placement,i=s?Ia(s):null,r=s?Pm(s):null,o=e.x+e.width/2-t.width/2,a=e.y+e.height/2-t.height/2,l;switch(i){case tr:l={x:o,y:e.y-t.height};break;case po:l={x:o,y:e.y+e.height};break;case mo:l={x:e.x+e.width,y:a};break;case nr:l={x:e.x-t.width,y:a};break;default:l={x:e.x,y:e.y}}var u=i?l2(i):null;if(u!=null){var f=u==="y"?"height":"width";switch(r){case zm:l[u]=l[u]-(e[f]/2-t[f]/2);break;case ix:l[u]=l[u]+(e[f]/2-t[f]/2);break}}return l}function rx(n,e){e===void 0&&(e={});var t=e,s=t.placement,i=s===void 0?n.placement:s,r=t.strategy,o=r===void 0?n.strategy:r,a=t.boundary,l=a===void 0?hne:a,u=t.rootBoundary,f=u===void 0?tB:u,p=t.elementContext,g=p===void 0?qg:p,b=t.altBoundary,w=b===void 0?!1:b,S=t.padding,N=S===void 0?0:S,C=aB(typeof N!="number"?N:lB(N,Gb)),M=g===qg?fne:qg,R=n.rects.popper,_=n.elements[w?M:g],j=Vne(Kh(_)?_:_.contextElement||qd(n.elements.popper),l,f,o),P=jm(n.elements.reference),D=dB({reference:P,element:R,placement:i}),U=xE(Object.assign({},R,D)),V=g===qg?U:P,q={top:j.top-V.top+C.top,bottom:V.bottom-j.bottom+C.bottom,left:j.left-V.left+C.left,right:V.right-j.right+C.right},G=n.modifiersData.offset;if(g===qg&&G){var ee=G[i];Object.keys(q).forEach(function(W){var Q=[mo,po].indexOf(W)>=0?1:-1,Z=[tr,po].indexOf(W)>=0?"y":"x";q[W]+=ee[Z]*Q})}return q}function qne(n,e){e===void 0&&(e={});var t=e,s=t.placement,i=t.boundary,r=t.rootBoundary,o=t.padding,a=t.flipVariations,l=t.allowedAutoPlacements,u=l===void 0?nB:l,f=Pm(s),p=f?a?eL:eL.filter(function(w){return Pm(w)===f}):Gb,g=p.filter(function(w){return u.indexOf(w)>=0});g.length===0&&(g=p);var b=g.reduce(function(w,S){return w[S]=rx(n,{placement:S,boundary:i,rootBoundary:r,padding:o})[Ia(S)],w},{});return Object.keys(b).sort(function(w,S){return b[w]-b[S]})}function Wne(n){if(Ia(n)===r2)return[];var e=Zv(n);return[sL(n),e,sL(e)]}function Kne(n){var e=n.state,t=n.options,s=n.name;if(!e.modifiersData[s]._skip){for(var i=t.mainAxis,r=i===void 0?!0:i,o=t.altAxis,a=o===void 0?!0:o,l=t.fallbackPlacements,u=t.padding,f=t.boundary,p=t.rootBoundary,g=t.altBoundary,b=t.flipVariations,w=b===void 0?!0:b,S=t.allowedAutoPlacements,N=e.options.placement,C=Ia(N),M=C===N,R=l||(M||!w?[Zv(N)]:Wne(N)),_=[N].concat(R).reduce(function(pe,ue){return pe.concat(Ia(ue)===r2?qne(e,{placement:ue,boundary:f,rootBoundary:p,padding:u,flipVariations:w,allowedAutoPlacements:S}):ue)},[]),j=e.rects.reference,P=e.rects.popper,D=new Map,U=!0,V=_[0],q=0;q<_.length;q++){var G=_[q],ee=Ia(G),W=Pm(G)===zm,Q=[tr,po].indexOf(ee)>=0,Z=Q?"width":"height",$=rx(e,{placement:G,boundary:f,rootBoundary:p,altBoundary:g,padding:u}),Y=Q?W?mo:nr:W?po:tr;j[Z]>P[Z]&&(Y=Zv(Y));var he=Zv(Y),Re=[];if(r&&Re.push($[ee]<=0),a&&Re.push($[Y]<=0,$[he]<=0),Re.every(function(pe){return pe})){V=G,U=!1;break}D.set(G,Re)}if(U)for(var ze=w?3:1,F=function(ue){var ke=_.find(function(re){var Ge=D.get(re);if(Ge)return Ge.slice(0,ue).every(function(Je){return Je})});if(ke)return V=ke,"break"},J=ze;J>0;J--){var ie=F(J);if(ie==="break")break}e.placement!==V&&(e.modifiersData[s]._skip=!0,e.placement=V,e.reset=!0)}}const Yne={name:"flip",enabled:!0,phase:"main",fn:Kne,requiresIfExists:["offset"],data:{_skip:!1}};function rL(n,e,t){return t===void 0&&(t={x:0,y:0}),{top:n.top-e.height-t.y,right:n.right-e.width+t.x,bottom:n.bottom-e.height+t.y,left:n.left-e.width-t.x}}function oL(n){return[tr,mo,po,nr].some(function(e){return n[e]>=0})}function Jne(n){var e=n.state,t=n.name,s=e.rects.reference,i=e.rects.popper,r=e.modifiersData.preventOverflow,o=rx(e,{elementContext:"reference"}),a=rx(e,{altBoundary:!0}),l=rL(o,s),u=rL(a,i,r),f=oL(l),p=oL(u);e.modifiersData[t]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:f,hasPopperEscaped:p},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":f,"data-popper-escaped":p})}const Xne={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Jne};function Qne(n,e,t){var s=Ia(n),i=[nr,tr].indexOf(s)>=0?-1:1,r=typeof t=="function"?t(Object.assign({},e,{placement:n})):t,o=r[0],a=r[1];return o=o||0,a=(a||0)*i,[nr,mo].indexOf(s)>=0?{x:a,y:o}:{x:o,y:a}}function Zne(n){var e=n.state,t=n.options,s=n.name,i=t.offset,r=i===void 0?[0,0]:i,o=nB.reduce(function(f,p){return f[p]=Qne(p,e.rects,r),f},{}),a=o[e.placement],l=a.x,u=a.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[s]=o}const ese={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Zne};function tse(n){var e=n.state,t=n.name;e.modifiersData[t]=dB({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const nse={name:"popperOffsets",enabled:!0,phase:"read",fn:tse,data:{}};function sse(n){return n==="x"?"y":"x"}function ise(n){var e=n.state,t=n.options,s=n.name,i=t.mainAxis,r=i===void 0?!0:i,o=t.altAxis,a=o===void 0?!1:o,l=t.boundary,u=t.rootBoundary,f=t.altBoundary,p=t.padding,g=t.tether,b=g===void 0?!0:g,w=t.tetherOffset,S=w===void 0?0:w,N=rx(e,{boundary:l,rootBoundary:u,padding:p,altBoundary:f}),C=Ia(e.placement),M=Pm(e.placement),R=!M,_=l2(C),j=sse(_),P=e.modifiersData.popperOffsets,D=e.rects.reference,U=e.rects.popper,V=typeof S=="function"?S(Object.assign({},e.rects,{placement:e.placement})):S,q=typeof V=="number"?{mainAxis:V,altAxis:V}:Object.assign({mainAxis:0,altAxis:0},V),G=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,ee={x:0,y:0};if(P){if(r){var W,Q=_==="y"?tr:nr,Z=_==="y"?po:mo,$=_==="y"?"height":"width",Y=P[_],he=Y+N[Q],Re=Y-N[Z],ze=b?-U[$]/2:0,F=M===zm?D[$]:U[$],J=M===zm?-U[$]:-D[$],ie=e.elements.arrow,pe=b&&ie?a2(ie):{width:0,height:0},ue=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:oB(),ke=ue[Q],re=ue[Z],Ge=T0(0,D[$],pe[$]),Je=R?D[$]/2-ze-Ge-ke-q.mainAxis:F-Ge-ke-q.mainAxis,Qe=R?-D[$]/2+ze+Ge+re+q.mainAxis:J+Ge+re+q.mainAxis,je=e.elements.arrow&&Vb(e.elements.arrow),ye=je?_==="y"?je.clientTop||0:je.clientLeft||0:0,Fe=(W=G==null?void 0:G[_])!=null?W:0,Ne=Y+Je-Fe-ye,ve=Y+Qe-Fe,Pe=T0(b?hk(he,Ne):he,Y,b?Oh(Re,ve):Re);P[_]=Pe,ee[_]=Pe-Y}if(a){var ot,Gt=_==="x"?tr:nr,bn=_==="x"?po:mo,qt=P[j],jt=j==="y"?"height":"width",yn=qt+N[Gt],_t=qt-N[bn],Qt=[tr,nr].indexOf(C)!==-1,_s=(ot=G==null?void 0:G[j])!=null?ot:0,Se=Qt?yn:qt-D[jt]-U[jt]-_s+q.altAxis,Me=Qt?qt+D[jt]+U[jt]-_s-q.altAxis:_t,He=b&&Qt?Tne(Se,qt,Me):T0(b?Se:yn,qt,b?Me:_t);P[j]=He,ee[j]=He-qt}e.modifiersData[s]=ee}}const rse={name:"preventOverflow",enabled:!0,phase:"main",fn:ise,requiresIfExists:["offset"]};function ose(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function ase(n){return n===jr(n)||!uo(n)?c2(n):ose(n)}function lse(n){var e=n.getBoundingClientRect(),t=Dm(e.width)/n.offsetWidth||1,s=Dm(e.height)/n.offsetHeight||1;return t!==1||s!==1}function cse(n,e,t){t===void 0&&(t=!1);var s=uo(e),i=uo(e)&&lse(e),r=qd(e),o=jm(n,i,t),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(s||!s&&!t)&&((Pa(e)!=="body"||u2(r))&&(a=ase(e)),uo(e)?(l=jm(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):r&&(l.x=d2(r))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function dse(n){var e=new Map,t=new Set,s=[];n.forEach(function(r){e.set(r.name,r)});function i(r){t.add(r.name);var o=[].concat(r.requires||[],r.requiresIfExists||[]);o.forEach(function(a){if(!t.has(a)){var l=e.get(a);l&&i(l)}}),s.push(r)}return n.forEach(function(r){t.has(r.name)||i(r)}),s}function use(n){var e=dse(n);return Sne.reduce(function(t,s){return t.concat(e.filter(function(i){return i.phase===s}))},[])}function hse(n){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(n())})})),e}}function fse(n){var e=n.reduce(function(t,s){var i=t[s.name];return t[s.name]=i?Object.assign({},i,s,{options:Object.assign({},i.options,s.options),data:Object.assign({},i.data,s.data)}):s,t},{});return Object.keys(e).map(function(t){return e[t]})}var aL={placement:"bottom",modifiers:[],strategy:"absolute"};function lL(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return!e.some(function(s){return!(s&&typeof s.getBoundingClientRect=="function")})}function pse(n){n===void 0&&(n={});var e=n,t=e.defaultModifiers,s=t===void 0?[]:t,i=e.defaultOptions,r=i===void 0?aL:i;return function(a,l,u){u===void 0&&(u=r);var f={placement:"bottom",orderedModifiers:[],options:Object.assign({},aL,r),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},p=[],g=!1,b={state:f,setOptions:function(C){var M=typeof C=="function"?C(f.options):C;S(),f.options=Object.assign({},r,f.options,M),f.scrollParents={reference:Kh(a)?_0(a):a.contextElement?_0(a.contextElement):[],popper:_0(l)};var R=use(fse([].concat(s,f.options.modifiers)));return f.orderedModifiers=R.filter(function(_){return _.enabled}),w(),b.update()},forceUpdate:function(){if(!g){var C=f.elements,M=C.reference,R=C.popper;if(lL(M,R)){f.rects={reference:cse(M,Vb(R),f.options.strategy==="fixed"),popper:a2(R)},f.reset=!1,f.placement=f.options.placement,f.orderedModifiers.forEach(function(q){return f.modifiersData[q.name]=Object.assign({},q.data)});for(var _=0;_<f.orderedModifiers.length;_++){if(f.reset===!0){f.reset=!1,_=-1;continue}var j=f.orderedModifiers[_],P=j.fn,D=j.options,U=D===void 0?{}:D,V=j.name;typeof P=="function"&&(f=P({state:f,options:U,name:V,instance:b})||f)}}}},update:hse(function(){return new Promise(function(N){b.forceUpdate(),N(f)})}),destroy:function(){S(),g=!0}};if(!lL(a,l))return b;b.setOptions(u).then(function(N){!g&&u.onFirstUpdate&&u.onFirstUpdate(N)});function w(){f.orderedModifiers.forEach(function(N){var C=N.name,M=N.options,R=M===void 0?{}:M,_=N.effect;if(typeof _=="function"){var j=_({state:f,name:C,instance:b,options:R}),P=function(){};p.push(j||P)}})}function S(){p.forEach(function(N){return N()}),p=[]}return b}}var mse=[One,nse,Pne,sB,ese,Yne,rse,Ine,Xne],gse=pse({defaultModifiers:mse}),xse="tippy-box",uB="tippy-content",bse="tippy-backdrop",hB="tippy-arrow",fB="tippy-svg-arrow",bu={passive:!0,capture:!0},pB=function(){return document.body};function VA(n,e,t){if(Array.isArray(n)){var s=n[e];return s??(Array.isArray(t)?t[e]:t)}return n}function h2(n,e){var t={}.toString.call(n);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function mB(n,e){return typeof n=="function"?n.apply(void 0,e):n}function cL(n,e){if(e===0)return n;var t;return function(s){clearTimeout(t),t=setTimeout(function(){n(s)},e)}}function yse(n){return n.split(/\s+/).filter(Boolean)}function Qf(n){return[].concat(n)}function dL(n,e){n.indexOf(e)===-1&&n.push(e)}function vse(n){return n.filter(function(e,t){return n.indexOf(e)===t})}function wse(n){return n.split("-")[0]}function fk(n){return[].slice.call(n)}function uL(n){return Object.keys(n).reduce(function(e,t){return n[t]!==void 0&&(e[t]=n[t]),e},{})}function M0(){return document.createElement("div")}function VS(n){return["Element","Fragment"].some(function(e){return h2(n,e)})}function kse(n){return h2(n,"NodeList")}function Sse(n){return h2(n,"MouseEvent")}function Cse(n){return!!(n&&n._tippy&&n._tippy.reference===n)}function Ase(n){return VS(n)?[n]:kse(n)?fk(n):Array.isArray(n)?n:fk(document.querySelectorAll(n))}function qA(n,e){n.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function hL(n,e){n.forEach(function(t){t&&t.setAttribute("data-state",e)})}function Nse(n){var e,t=Qf(n),s=t[0];return s!=null&&(e=s.ownerDocument)!=null&&e.body?s.ownerDocument:document}function Ese(n,e){var t=e.clientX,s=e.clientY;return n.every(function(i){var r=i.popperRect,o=i.popperState,a=i.props,l=a.interactiveBorder,u=wse(o.placement),f=o.modifiersData.offset;if(!f)return!0;var p=u==="bottom"?f.top.y:0,g=u==="top"?f.bottom.y:0,b=u==="right"?f.left.x:0,w=u==="left"?f.right.x:0,S=r.top-s+p>l,N=s-r.bottom-g>l,C=r.left-t+b>l,M=t-r.right-w>l;return S||N||C||M})}function WA(n,e,t){var s=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){n[s](i,t)})}function fL(n,e){for(var t=e;t;){var s;if(n.contains(t))return!0;t=t.getRootNode==null||(s=t.getRootNode())==null?void 0:s.host}return!1}var Ta={isTouch:!1},pL=0;function Tse(){Ta.isTouch||(Ta.isTouch=!0,window.performance&&document.addEventListener("mousemove",gB))}function gB(){var n=performance.now();n-pL<20&&(Ta.isTouch=!1,document.removeEventListener("mousemove",gB)),pL=n}function _se(){var n=document.activeElement;if(Cse(n)){var e=n._tippy;n.blur&&!e.state.isVisible&&n.blur()}}function Mse(){document.addEventListener("touchstart",Tse,bu),window.addEventListener("blur",_se)}var Rse=typeof window<"u"&&typeof document<"u",Ise=Rse?!!window.msCrypto:!1,zse={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},Dse={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Oo=Object.assign({appendTo:pB,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},zse,Dse),jse=Object.keys(Oo),Pse=function(e){var t=Object.keys(e);t.forEach(function(s){Oo[s]=e[s]})};function xB(n){var e=n.plugins||[],t=e.reduce(function(s,i){var r=i.name,o=i.defaultValue;if(r){var a;s[r]=n[r]!==void 0?n[r]:(a=Oo[r])!=null?a:o}return s},{});return Object.assign({},n,t)}function Lse(n,e){var t=e?Object.keys(xB(Object.assign({},Oo,{plugins:e}))):jse,s=t.reduce(function(i,r){var o=(n.getAttribute("data-tippy-"+r)||"").trim();if(!o)return i;if(r==="content")i[r]=o;else try{i[r]=JSON.parse(o)}catch{i[r]=o}return i},{});return s}function mL(n,e){var t=Object.assign({},e,{content:mB(e.content,[n])},e.ignoreAttributes?{}:Lse(n,e.plugins));return t.aria=Object.assign({},Oo.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var Ose=function(){return"innerHTML"};function bE(n,e){n[Ose()]=e}function gL(n){var e=M0();return n===!0?e.className=hB:(e.className=fB,VS(n)?e.appendChild(n):bE(e,n)),e}function xL(n,e){VS(e.content)?(bE(n,""),n.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?bE(n,e.content):n.textContent=e.content)}function yE(n){var e=n.firstElementChild,t=fk(e.children);return{box:e,content:t.find(function(s){return s.classList.contains(uB)}),arrow:t.find(function(s){return s.classList.contains(hB)||s.classList.contains(fB)}),backdrop:t.find(function(s){return s.classList.contains(bse)})}}function bB(n){var e=M0(),t=M0();t.className=xse,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var s=M0();s.className=uB,s.setAttribute("data-state","hidden"),xL(s,n.props),e.appendChild(t),t.appendChild(s),i(n.props,n.props);function i(r,o){var a=yE(e),l=a.box,u=a.content,f=a.arrow;o.theme?l.setAttribute("data-theme",o.theme):l.removeAttribute("data-theme"),typeof o.animation=="string"?l.setAttribute("data-animation",o.animation):l.removeAttribute("data-animation"),o.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?l.setAttribute("role",o.role):l.removeAttribute("role"),(r.content!==o.content||r.allowHTML!==o.allowHTML)&&xL(u,n.props),o.arrow?f?r.arrow!==o.arrow&&(l.removeChild(f),l.appendChild(gL(o.arrow))):l.appendChild(gL(o.arrow)):f&&l.removeChild(f)}return{popper:e,onUpdate:i}}bB.$$tippy=!0;var Bse=1,Iv=[],KA=[];function Fse(n,e){var t=mL(n,Object.assign({},Oo,xB(uL(e)))),s,i,r,o=!1,a=!1,l=!1,u=!1,f,p,g,b=[],w=cL(Ne,t.interactiveDebounce),S,N=Bse++,C=null,M=vse(t.plugins),R={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},_={id:N,reference:n,popper:M0(),popperInstance:C,props:t,state:R,plugins:M,clearDelayTimeouts:Se,setProps:Me,setContent:He,show:Pt,hide:Sn,hideWithInteractivity:as,enable:Qt,disable:_s,unmount:Xn,destroy:De};if(!t.render)return _;var j=t.render(_),P=j.popper,D=j.onUpdate;P.setAttribute("data-tippy-root",""),P.id="tippy-"+_.id,_.popper=P,n._tippy=_,P._tippy=_;var U=M.map(function(se){return se.fn(_)}),V=n.hasAttribute("aria-expanded");return je(),ze(),Y(),he("onCreate",[_]),t.showOnCreate&&yn(),P.addEventListener("mouseenter",function(){_.props.interactive&&_.state.isVisible&&_.clearDelayTimeouts()}),P.addEventListener("mouseleave",function(){_.props.interactive&&_.props.trigger.indexOf("mouseenter")>=0&&Q().addEventListener("mousemove",w)}),_;function q(){var se=_.props.touch;return Array.isArray(se)?se:[se,0]}function G(){return q()[0]==="hold"}function ee(){var se;return!!((se=_.props.render)!=null&&se.$$tippy)}function W(){return S||n}function Q(){var se=W().parentNode;return se?Nse(se):document}function Z(){return yE(P)}function $(se){return _.state.isMounted&&!_.state.isVisible||Ta.isTouch||f&&f.type==="focus"?0:VA(_.props.delay,se?0:1,Oo.delay)}function Y(se){se===void 0&&(se=!1),P.style.pointerEvents=_.props.interactive&&!se?"":"none",P.style.zIndex=""+_.props.zIndex}function he(se,Oe,Ke){if(Ke===void 0&&(Ke=!0),U.forEach(function(xe){xe[se]&&xe[se].apply(xe,Oe)}),Ke){var me;(me=_.props)[se].apply(me,Oe)}}function Re(){var se=_.props.aria;if(se.content){var Oe="aria-"+se.content,Ke=P.id,me=Qf(_.props.triggerTarget||n);me.forEach(function(xe){var Le=xe.getAttribute(Oe);if(_.state.isVisible)xe.setAttribute(Oe,Le?Le+" "+Ke:Ke);else{var Ue=Le&&Le.replace(Ke,"").trim();Ue?xe.setAttribute(Oe,Ue):xe.removeAttribute(Oe)}})}}function ze(){if(!(V||!_.props.aria.expanded)){var se=Qf(_.props.triggerTarget||n);se.forEach(function(Oe){_.props.interactive?Oe.setAttribute("aria-expanded",_.state.isVisible&&Oe===W()?"true":"false"):Oe.removeAttribute("aria-expanded")})}}function F(){Q().removeEventListener("mousemove",w),Iv=Iv.filter(function(se){return se!==w})}function J(se){if(!(Ta.isTouch&&(l||se.type==="mousedown"))){var Oe=se.composedPath&&se.composedPath()[0]||se.target;if(!(_.props.interactive&&fL(P,Oe))){if(Qf(_.props.triggerTarget||n).some(function(Ke){return fL(Ke,Oe)})){if(Ta.isTouch||_.state.isVisible&&_.props.trigger.indexOf("click")>=0)return}else he("onClickOutside",[_,se]);_.props.hideOnClick===!0&&(_.clearDelayTimeouts(),_.hide(),a=!0,setTimeout(function(){a=!1}),_.state.isMounted||ke())}}}function ie(){l=!0}function pe(){l=!1}function ue(){var se=Q();se.addEventListener("mousedown",J,!0),se.addEventListener("touchend",J,bu),se.addEventListener("touchstart",pe,bu),se.addEventListener("touchmove",ie,bu)}function ke(){var se=Q();se.removeEventListener("mousedown",J,!0),se.removeEventListener("touchend",J,bu),se.removeEventListener("touchstart",pe,bu),se.removeEventListener("touchmove",ie,bu)}function re(se,Oe){Je(se,function(){!_.state.isVisible&&P.parentNode&&P.parentNode.contains(P)&&Oe()})}function Ge(se,Oe){Je(se,Oe)}function Je(se,Oe){var Ke=Z().box;function me(xe){xe.target===Ke&&(WA(Ke,"remove",me),Oe())}if(se===0)return Oe();WA(Ke,"remove",p),WA(Ke,"add",me),p=me}function Qe(se,Oe,Ke){Ke===void 0&&(Ke=!1);var me=Qf(_.props.triggerTarget||n);me.forEach(function(xe){xe.addEventListener(se,Oe,Ke),b.push({node:xe,eventType:se,handler:Oe,options:Ke})})}function je(){G()&&(Qe("touchstart",Fe,{passive:!0}),Qe("touchend",ve,{passive:!0})),yse(_.props.trigger).forEach(function(se){if(se!=="manual")switch(Qe(se,Fe),se){case"mouseenter":Qe("mouseleave",ve);break;case"focus":Qe(Ise?"focusout":"blur",Pe);break;case"focusin":Qe("focusout",Pe);break}})}function ye(){b.forEach(function(se){var Oe=se.node,Ke=se.eventType,me=se.handler,xe=se.options;Oe.removeEventListener(Ke,me,xe)}),b=[]}function Fe(se){var Oe,Ke=!1;if(!(!_.state.isEnabled||ot(se)||a)){var me=((Oe=f)==null?void 0:Oe.type)==="focus";f=se,S=se.currentTarget,ze(),!_.state.isVisible&&Sse(se)&&Iv.forEach(function(xe){return xe(se)}),se.type==="click"&&(_.props.trigger.indexOf("mouseenter")<0||o)&&_.props.hideOnClick!==!1&&_.state.isVisible?Ke=!0:yn(se),se.type==="click"&&(o=!Ke),Ke&&!me&&_t(se)}}function Ne(se){var Oe=se.target,Ke=W().contains(Oe)||P.contains(Oe);if(!(se.type==="mousemove"&&Ke)){var me=jt().concat(P).map(function(xe){var Le,Ue=xe._tippy,lt=(Le=Ue.popperInstance)==null?void 0:Le.state;return lt?{popperRect:xe.getBoundingClientRect(),popperState:lt,props:t}:null}).filter(Boolean);Ese(me,se)&&(F(),_t(se))}}function ve(se){var Oe=ot(se)||_.props.trigger.indexOf("click")>=0&&o;if(!Oe){if(_.props.interactive){_.hideWithInteractivity(se);return}_t(se)}}function Pe(se){_.props.trigger.indexOf("focusin")<0&&se.target!==W()||_.props.interactive&&se.relatedTarget&&P.contains(se.relatedTarget)||_t(se)}function ot(se){return Ta.isTouch?G()!==se.type.indexOf("touch")>=0:!1}function Gt(){bn();var se=_.props,Oe=se.popperOptions,Ke=se.placement,me=se.offset,xe=se.getReferenceClientRect,Le=se.moveTransition,Ue=ee()?yE(P).arrow:null,lt=xe?{getBoundingClientRect:xe,contextElement:xe.contextElement||W()}:n,Mt={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Zt){var Pn=Zt.state;if(ee()){var Hn=Z(),Bi=Hn.box;["placement","reference-hidden","escaped"].forEach(function(ys){ys==="placement"?Bi.setAttribute("data-placement",Pn.placement):Pn.attributes.popper["data-popper-"+ys]?Bi.setAttribute("data-"+ys,""):Bi.removeAttribute("data-"+ys)}),Pn.attributes.popper={}}}},Ht=[{name:"offset",options:{offset:me}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Le}},Mt];ee()&&Ue&&Ht.push({name:"arrow",options:{element:Ue,padding:3}}),Ht.push.apply(Ht,(Oe==null?void 0:Oe.modifiers)||[]),_.popperInstance=gse(lt,P,Object.assign({},Oe,{placement:Ke,onFirstUpdate:g,modifiers:Ht}))}function bn(){_.popperInstance&&(_.popperInstance.destroy(),_.popperInstance=null)}function qt(){var se=_.props.appendTo,Oe,Ke=W();_.props.interactive&&se===pB||se==="parent"?Oe=Ke.parentNode:Oe=mB(se,[Ke]),Oe.contains(P)||Oe.appendChild(P),_.state.isMounted=!0,Gt()}function jt(){return fk(P.querySelectorAll("[data-tippy-root]"))}function yn(se){_.clearDelayTimeouts(),se&&he("onTrigger",[_,se]),ue();var Oe=$(!0),Ke=q(),me=Ke[0],xe=Ke[1];Ta.isTouch&&me==="hold"&&xe&&(Oe=xe),Oe?s=setTimeout(function(){_.show()},Oe):_.show()}function _t(se){if(_.clearDelayTimeouts(),he("onUntrigger",[_,se]),!_.state.isVisible){ke();return}if(!(_.props.trigger.indexOf("mouseenter")>=0&&_.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(se.type)>=0&&o)){var Oe=$(!1);Oe?i=setTimeout(function(){_.state.isVisible&&_.hide()},Oe):r=requestAnimationFrame(function(){_.hide()})}}function Qt(){_.state.isEnabled=!0}function _s(){_.hide(),_.state.isEnabled=!1}function Se(){clearTimeout(s),clearTimeout(i),cancelAnimationFrame(r)}function Me(se){if(!_.state.isDestroyed){he("onBeforeUpdate",[_,se]),ye();var Oe=_.props,Ke=mL(n,Object.assign({},Oe,uL(se),{ignoreAttributes:!0}));_.props=Ke,je(),Oe.interactiveDebounce!==Ke.interactiveDebounce&&(F(),w=cL(Ne,Ke.interactiveDebounce)),Oe.triggerTarget&&!Ke.triggerTarget?Qf(Oe.triggerTarget).forEach(function(me){me.removeAttribute("aria-expanded")}):Ke.triggerTarget&&n.removeAttribute("aria-expanded"),ze(),Y(),D&&D(Oe,Ke),_.popperInstance&&(Gt(),jt().forEach(function(me){requestAnimationFrame(me._tippy.popperInstance.forceUpdate)})),he("onAfterUpdate",[_,se])}}function He(se){_.setProps({content:se})}function Pt(){var se=_.state.isVisible,Oe=_.state.isDestroyed,Ke=!_.state.isEnabled,me=Ta.isTouch&&!_.props.touch,xe=VA(_.props.duration,0,Oo.duration);if(!(se||Oe||Ke||me)&&!W().hasAttribute("disabled")&&(he("onShow",[_],!1),_.props.onShow(_)!==!1)){if(_.state.isVisible=!0,ee()&&(P.style.visibility="visible"),Y(),ue(),_.state.isMounted||(P.style.transition="none"),ee()){var Le=Z(),Ue=Le.box,lt=Le.content;qA([Ue,lt],0)}g=function(){var Ht;if(!(!_.state.isVisible||u)){if(u=!0,P.offsetHeight,P.style.transition=_.props.moveTransition,ee()&&_.props.animation){var Cn=Z(),Zt=Cn.box,Pn=Cn.content;qA([Zt,Pn],xe),hL([Zt,Pn],"visible")}Re(),ze(),dL(KA,_),(Ht=_.popperInstance)==null||Ht.forceUpdate(),he("onMount",[_]),_.props.animation&&ee()&&Ge(xe,function(){_.state.isShown=!0,he("onShown",[_])})}},qt()}}function Sn(){var se=!_.state.isVisible,Oe=_.state.isDestroyed,Ke=!_.state.isEnabled,me=VA(_.props.duration,1,Oo.duration);if(!(se||Oe||Ke)&&(he("onHide",[_],!1),_.props.onHide(_)!==!1)){if(_.state.isVisible=!1,_.state.isShown=!1,u=!1,o=!1,ee()&&(P.style.visibility="hidden"),F(),ke(),Y(!0),ee()){var xe=Z(),Le=xe.box,Ue=xe.content;_.props.animation&&(qA([Le,Ue],me),hL([Le,Ue],"hidden"))}Re(),ze(),_.props.animation?ee()&&re(me,_.unmount):_.unmount()}}function as(se){Q().addEventListener("mousemove",w),dL(Iv,w),w(se)}function Xn(){_.state.isVisible&&_.hide(),_.state.isMounted&&(bn(),jt().forEach(function(se){se._tippy.unmount()}),P.parentNode&&P.parentNode.removeChild(P),KA=KA.filter(function(se){return se!==_}),_.state.isMounted=!1,he("onHidden",[_]))}function De(){_.state.isDestroyed||(_.clearDelayTimeouts(),_.unmount(),ye(),delete n._tippy,_.state.isDestroyed=!0,he("onDestroy",[_]))}}function Vm(n,e){e===void 0&&(e={});var t=Oo.plugins.concat(e.plugins||[]);Mse();var s=Object.assign({},e,{plugins:t}),i=Ase(n),r=i.reduce(function(o,a){var l=a&&Fse(a,s);return l&&o.push(l),o},[]);return VS(n)?r[0]:r}Vm.defaultProps=Oo;Vm.setDefaultProps=Pse;Vm.currentInput=Ta;Object.assign({},sB,{effect:function(e){var t=e.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow)}});Vm.setDefaultProps({render:bB});class Hse{constructor({editor:e,element:t,view:s,tippyOptions:i={},updateDelay:r=250,shouldShow:o}){this.preventHide=!1,this.shouldShow=({view:a,state:l,from:u,to:f})=>{const{doc:p,selection:g}=l,{empty:b}=g,w=!p.textBetween(u,f).length&&e2(l.selection),S=this.element.contains(document.activeElement);return!(!(a.hasFocus()||S)||b||w||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:a})=>{var l;if(this.preventHide){this.preventHide=!1;return}a!=null&&a.relatedTarget&&(!((l=this.element.parentNode)===null||l===void 0)&&l.contains(a.relatedTarget))||(a==null?void 0:a.relatedTarget)!==this.editor.view.dom&&this.hide()},this.tippyBlurHandler=a=>{this.blurHandler({event:a})},this.handleDebouncedUpdate=(a,l)=>{const u=!(l!=null&&l.selection.eq(a.state.selection)),f=!(l!=null&&l.doc.eq(a.state.doc));!u&&!f||(this.updateDebounceTimer&&clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=window.setTimeout(()=>{this.updateHandler(a,u,f,l)},this.updateDelay))},this.updateHandler=(a,l,u,f)=>{var p,g,b;const{state:w,composing:S}=a,{selection:N}=w;if(S||!l&&!u)return;this.createTooltip();const{ranges:M}=N,R=Math.min(...M.map(P=>P.$from.pos)),_=Math.max(...M.map(P=>P.$to.pos));if(!((p=this.shouldShow)===null||p===void 0?void 0:p.call(this,{editor:this.editor,element:this.element,view:a,state:w,oldState:f,from:R,to:_}))){this.hide();return}(g=this.tippy)===null||g===void 0||g.setProps({getReferenceClientRect:((b=this.tippyOptions)===null||b===void 0?void 0:b.getReferenceClientRect)||(()=>{if(Q5(w.selection)){let P=a.nodeDOM(R);if(P){const D=P.dataset.nodeViewWrapper?P:P.querySelector("[data-node-view-wrapper]");if(D&&(P=D.firstChild),P)return P.getBoundingClientRect()}}return Z5(a,R,_)})}),this.show()},this.editor=e,this.element=t,this.view=s,this.updateDelay=r,o&&(this.shouldShow=o),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=i,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,t=!!e.parentElement;this.element.tabIndex=0,!(this.tippy||!t)&&(this.tippy=Vm(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e,t){const{state:s}=e,i=s.selection.from!==s.selection.to;if(this.updateDelay>0&&i){this.handleDebouncedUpdate(e,t);return}const r=!(t!=null&&t.selection.eq(e.state.selection)),o=!(t!=null&&t.doc.eq(e.state.doc));this.updateHandler(e,r,o,t)}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e,t;!((e=this.tippy)===null||e===void 0)&&e.popper.firstChild&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),(t=this.tippy)===null||t===void 0||t.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const yB=n=>new Jn({key:typeof n.pluginKey=="string"?new Ts(n.pluginKey):n.pluginKey,view:e=>new Hse({view:e,...n})}),vB=bs.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",updateDelay:void 0,shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[yB({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,updateDelay:this.options.updateDelay,shouldShow:this.options.shouldShow})]:[]}});class Use{getTextContent(e){return J5(e,{textSerializers:Q_(this.editor.schema)})}constructor({editor:e,element:t,view:s,tippyOptions:i={},shouldShow:r}){this.preventHide=!1,this.shouldShow=({view:o,state:a})=>{const{selection:l}=a,{$anchor:u,empty:f}=l,p=u.depth===1,g=u.parent.isTextblock&&!u.parent.type.spec.code&&!u.parent.textContent&&u.parent.childCount===0&&!this.getTextContent(u.parent);return!(!o.hasFocus()||!f||!p||!g||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:o})=>{var a;if(this.preventHide){this.preventHide=!1;return}o!=null&&o.relatedTarget&&(!((a=this.element.parentNode)===null||a===void 0)&&a.contains(o.relatedTarget))||(o==null?void 0:o.relatedTarget)!==this.editor.view.dom&&this.hide()},this.tippyBlurHandler=o=>{this.blurHandler({event:o})},this.editor=e,this.element=t,this.view=s,r&&(this.shouldShow=r),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=i,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,t=!!e.parentElement;this.element.tabIndex=0,!(this.tippy||!t)&&(this.tippy=Vm(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e,t){var s,i,r;const{state:o}=e,{doc:a,selection:l}=o,{from:u,to:f}=l;if(t&&t.doc.eq(a)&&t.selection.eq(l))return;if(this.createTooltip(),!((s=this.shouldShow)===null||s===void 0?void 0:s.call(this,{editor:this.editor,view:e,state:o,oldState:t}))){this.hide();return}(i=this.tippy)===null||i===void 0||i.setProps({getReferenceClientRect:((r=this.tippyOptions)===null||r===void 0?void 0:r.getReferenceClientRect)||(()=>Z5(e,u,f))}),this.show()}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e,t;!((e=this.tippy)===null||e===void 0)&&e.popper.firstChild&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),(t=this.tippy)===null||t===void 0||t.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const wB=n=>new Jn({key:typeof n.pluginKey=="string"?new Ts(n.pluginKey):n.pluginKey,view:e=>new Use({view:e,...n})}),kB=bs.create({name:"floatingMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"floatingMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[wB({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});function $se(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var SB={exports:{}},YA={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bL;function Gse(){if(bL)return YA;bL=1;var n=Kn;function e(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var t=typeof Object.is=="function"?Object.is:e,s=n.useState,i=n.useEffect,r=n.useLayoutEffect,o=n.useDebugValue;function a(p,g){var b=g(),w=s({inst:{value:b,getSnapshot:g}}),S=w[0].inst,N=w[1];return r(function(){S.value=b,S.getSnapshot=g,l(S)&&N({inst:S})},[p,b,g]),i(function(){return l(S)&&N({inst:S}),p(function(){l(S)&&N({inst:S})})},[p]),o(b),b}function l(p){var g=p.getSnapshot;p=p.value;try{var b=g();return!t(p,b)}catch{return!0}}function u(p,g){return g()}var f=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:a;return YA.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:f,YA}SB.exports=Gse();var f2=SB.exports;const Vse=(...n)=>e=>{n.forEach(t=>{typeof t=="function"?t(e):t&&(t.current=e)})},qse=({contentComponent:n})=>{const e=f2.useSyncExternalStore(n.subscribe,n.getSnapshot,n.getServerSnapshot);return Kn.createElement(Kn.Fragment,null,Object.values(e))};function Wse(){const n=new Set;let e={};return{subscribe(t){return n.add(t),()=>{n.delete(t)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(t,s){e={...e,[t]:y$.createPortal(s.reactElement,s.element,t)},n.forEach(i=>i())},removeRenderer(t){const s={...e};delete s[t],e=s,n.forEach(i=>i())}}}class Kse extends Kn.Component{constructor(e){var t;super(e),this.editorContentRef=Kn.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!(!((t=e.editor)===null||t===void 0)&&t.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const e=this.props.editor;if(e&&!e.isDestroyed&&e.options.element){if(e.contentComponent)return;const t=this.editorContentRef.current;t.append(...e.options.element.childNodes),e.setOptions({element:t}),e.contentComponent=Wse(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(s=>s.hasContentComponentInitialized?s:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){const e=this.props.editor;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null,!e.options.element.firstChild))return;const t=document.createElement("div");t.append(...e.options.element.childNodes),e.setOptions({element:t})}render(){const{editor:e,innerRef:t,...s}=this.props;return Kn.createElement(Kn.Fragment,null,Kn.createElement("div",{ref:Vse(t,this.editorContentRef),...s}),(e==null?void 0:e.contentComponent)&&Kn.createElement(qse,{contentComponent:e.contentComponent}))}}const Yse=T.forwardRef((n,e)=>{const t=Kn.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[n.editor]);return Kn.createElement(Kse,{key:t,innerRef:e,...n})}),CB=Kn.memo(Yse);var Jse=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var s,i,r;if(Array.isArray(e)){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!n(e[i],t[i]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(i of e.entries())if(!t.has(i[0]))return!1;for(i of e.entries())if(!n(i[1],t.get(i[0])))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(i of e.entries())if(!t.has(i[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(e[i]!==t[i])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(r=Object.keys(e),s=r.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!Object.prototype.hasOwnProperty.call(t,r[i]))return!1;for(i=s;i--!==0;){var o=r[i];if(!(o==="_owner"&&e.$$typeof)&&!n(e[o],t[o]))return!1}return!0}return e!==e&&t!==t},Xse=$se(Jse),AB={exports:{}},JA={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yL;function Qse(){if(yL)return JA;yL=1;var n=Kn,e=f2;function t(u,f){return u===f&&(u!==0||1/u===1/f)||u!==u&&f!==f}var s=typeof Object.is=="function"?Object.is:t,i=e.useSyncExternalStore,r=n.useRef,o=n.useEffect,a=n.useMemo,l=n.useDebugValue;return JA.useSyncExternalStoreWithSelector=function(u,f,p,g,b){var w=r(null);if(w.current===null){var S={hasValue:!1,value:null};w.current=S}else S=w.current;w=a(function(){function C(P){if(!M){if(M=!0,R=P,P=g(P),b!==void 0&&S.hasValue){var D=S.value;if(b(D,P))return _=D}return _=P}if(D=_,s(R,P))return D;var U=g(P);return b!==void 0&&b(D,U)?D:(R=P,_=U)}var M=!1,R,_,j=p===void 0?null:p;return[function(){return C(f())},j===null?void 0:function(){return C(j())}]},[f,p,g,b]);var N=i(u,w[0],w[1]);return o(function(){S.hasValue=!0,S.value=N},[N]),l(N),N},JA}AB.exports=Qse();var Zse=AB.exports;const eie=typeof window<"u"?T.useLayoutEffect:T.useEffect;class tie{constructor(e){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=e,this.lastSnapshot={editor:e,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}watch(e){if(this.editor=e,this.editor){const t=()=>{this.transactionNumber+=1,this.subscribers.forEach(i=>i())},s=this.editor;return s.on("transaction",t),()=>{s.off("transaction",t)}}}}function nie(n){var e;const[t]=T.useState(()=>new tie(n.editor)),s=Zse.useSyncExternalStoreWithSelector(t.subscribe,t.getSnapshot,t.getServerSnapshot,n.selector,(e=n.equalityFn)!==null&&e!==void 0?e:Xse);return eie(()=>t.watch(n.editor),[n.editor,t]),T.useDebugValue(s),s}const sie=!1,vE=typeof window>"u",iie=vE||!!(typeof window<"u"&&window.next);class p2{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(t=>t())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?vE||iie?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...s)=>{var i,r;return(r=(i=this.options.current).onBeforeCreate)===null||r===void 0?void 0:r.call(i,...s)},onBlur:(...s)=>{var i,r;return(r=(i=this.options.current).onBlur)===null||r===void 0?void 0:r.call(i,...s)},onCreate:(...s)=>{var i,r;return(r=(i=this.options.current).onCreate)===null||r===void 0?void 0:r.call(i,...s)},onDestroy:(...s)=>{var i,r;return(r=(i=this.options.current).onDestroy)===null||r===void 0?void 0:r.call(i,...s)},onFocus:(...s)=>{var i,r;return(r=(i=this.options.current).onFocus)===null||r===void 0?void 0:r.call(i,...s)},onSelectionUpdate:(...s)=>{var i,r;return(r=(i=this.options.current).onSelectionUpdate)===null||r===void 0?void 0:r.call(i,...s)},onTransaction:(...s)=>{var i,r;return(r=(i=this.options.current).onTransaction)===null||r===void 0?void 0:r.call(i,...s)},onUpdate:(...s)=>{var i,r;return(r=(i=this.options.current).onUpdate)===null||r===void 0?void 0:r.call(i,...s)},onContentError:(...s)=>{var i,r;return(r=(i=this.options.current).onContentError)===null||r===void 0?void 0:r.call(i,...s)},onDrop:(...s)=>{var i,r;return(r=(i=this.options.current).onDrop)===null||r===void 0?void 0:r.call(i,...s)},onPaste:(...s)=>{var i,r;return(r=(i=this.options.current).onPaste)===null||r===void 0?void 0:r.call(i,...s)}};return new dne(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,t){return Object.keys(e).every(s=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(s)?!0:s==="extensions"&&e.extensions&&t.extensions?e.extensions.length!==t.extensions.length?!1:e.extensions.every((i,r)=>{var o;return i===((o=t.extensions)===null||o===void 0?void 0:o[r])}):e[s]===t[s])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?p2.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((s,i)=>s===e[i]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,t=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){t&&t.setOptions(this.options.current);return}t&&!t.isDestroyed&&(t.destroy(),this.instanceId===e&&this.setEditor(null))},1)}}function NB(n={},e=[]){const t=T.useRef(n);t.current=n;const[s]=T.useState(()=>new p2(t)),i=f2.useSyncExternalStore(s.subscribe,s.getEditor,s.getServerSnapshot);return T.useDebugValue(i),T.useEffect(s.onRender(e)),nie({editor:i,selector:({transactionNumber:r})=>n.shouldRerenderOnTransaction===!1?null:n.immediatelyRender&&r===0?0:r+1}),i}const EB=T.createContext({editor:null});EB.Consumer;const TB=()=>T.useContext(EB),_B=n=>{const[e,t]=T.useState(null),{editor:s}=TB();return T.useEffect(()=>{var i;if(!e||!((i=n.editor)===null||i===void 0)&&i.isDestroyed||s!=null&&s.isDestroyed)return;const{pluginKey:r="bubbleMenu",editor:o,tippyOptions:a={},updateDelay:l,shouldShow:u=null}=n,f=o||s;if(!f){console.warn("BubbleMenu component is not rendered inside of an editor component or does not have editor prop.");return}const p=yB({updateDelay:l,editor:f,element:e,pluginKey:r,shouldShow:u,tippyOptions:a});return f.registerPlugin(p),()=>{f.unregisterPlugin(r)}},[n.editor,s,e]),Kn.createElement("div",{ref:t,className:n.className,style:{visibility:"hidden"}},n.children)},rie=n=>{const[e,t]=T.useState(null),{editor:s}=TB();return T.useEffect(()=>{var i;if(!e||!((i=n.editor)===null||i===void 0)&&i.isDestroyed||s!=null&&s.isDestroyed)return;const{pluginKey:r="floatingMenu",editor:o,tippyOptions:a={},shouldShow:l=null}=n,u=o||s;if(!u){console.warn("FloatingMenu component is not rendered inside of an editor component or does not have editor prop.");return}const f=wB({pluginKey:r,editor:u,element:e,tippyOptions:a,shouldShow:l});return u.registerPlugin(f),()=>{u.unregisterPlugin(r)}},[n.editor,s,e]),Kn.createElement("div",{ref:t,className:n.className,style:{visibility:"hidden"}},n.children)},oie=T.createContext({onDragStart:void 0}),aie=()=>T.useContext(oie);Kn.forwardRef((n,e)=>{const{onDragStart:t}=aie(),s=n.as||"div";return Kn.createElement(s,{...n,ref:e,"data-node-view-wrapper":"",onDragStart:t,style:{whiteSpace:"normal",...n.style}})});const lie=/^\s*>\s$/,cie=Vs.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:n}){return["blockquote",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setBlockquote:()=>({commands:n})=>n.wrapIn(this.name),toggleBlockquote:()=>({commands:n})=>n.toggleWrap(this.name),unsetBlockquote:()=>({commands:n})=>n.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Im({find:lie,type:this.type})]}}),die=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,uie=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,hie=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,fie=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,pie=ir.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:n=>n.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:n=>n.type.name===this.name},{style:"font-weight",getAttrs:n=>/^(bold(er)?|[5-9]\d{2,})$/.test(n)&&null}]},renderHTML({HTMLAttributes:n}){return["strong",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setBold:()=>({commands:n})=>n.setMark(this.name),toggleBold:()=>({commands:n})=>n.toggleMark(this.name),unsetBold:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Wh({find:die,type:this.type}),Wh({find:hie,type:this.type})]},addPasteRules(){return[Ld({find:uie,type:this.type}),Ld({find:fie,type:this.type})]}}),mie="listItem",vL="textStyle",wL=/^\s*([-+*])\s$/,gie=Vs.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:n}){return["ul",an(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleBulletList:()=>({commands:n,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(mie,this.editor.getAttributes(vL)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let n=Im({find:wL,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(n=Im({find:wL,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(vL),editor:this.editor})),[n]}}),xie=/(^|[^`])`([^`]+)`(?!`)/,bie=/(^|[^`])`([^`]+)`(?!`)/g,yie=ir.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:n}){return["code",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setCode:()=>({commands:n})=>n.setMark(this.name),toggleCode:()=>({commands:n})=>n.toggleMark(this.name),unsetCode:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Wh({find:xie,type:this.type})]},addPasteRules(){return[Ld({find:bie,type:this.type})]}}),vie=/^```([a-z]+)?[\s\n]$/,wie=/^~~~([a-z]+)?[\s\n]$/,kie=Vs.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:n=>{var e;const{languageClassPrefix:t}=this.options,r=[...((e=n.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(t)).map(o=>o.replace(t,""))[0];return r||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:n,HTMLAttributes:e}){return["pre",an(this.options.HTMLAttributes,e),["code",{class:n.attrs.language?this.options.languageClassPrefix+n.attrs.language:null},0]]},addCommands(){return{setCodeBlock:n=>({commands:e})=>e.setNode(this.name,n),toggleCodeBlock:n=>({commands:e})=>e.toggleNode(this.name,"paragraph",n)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:n,$anchor:e}=this.editor.state.selection,t=e.pos===1;return!n||e.parent.type.name!==this.name?!1:t||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:n})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=n,{selection:t}=e,{$from:s,empty:i}=t;if(!i||s.parent.type!==this.type)return!1;const r=s.parentOffset===s.parent.nodeSize-2,o=s.parent.textContent.endsWith(`

`);return!r||!o?!1:n.chain().command(({tr:a})=>(a.delete(s.pos-2,s.pos),!0)).exitCode().run()},ArrowDown:({editor:n})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=n,{selection:t,doc:s}=e,{$from:i,empty:r}=t;if(!r||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();return a===void 0?!1:s.nodeAt(a)?n.commands.command(({tr:u})=>(u.setSelection(mt.near(s.resolve(a))),!0)):n.commands.exitCode()}}},addInputRules(){return[pE({find:vie,type:this.type,getAttributes:n=>({language:n[1]})}),pE({find:wie,type:this.type,getAttributes:n=>({language:n[1]})})]},addProseMirrorPlugins(){return[new Jn({key:new Ts("codeBlockVSCodeHandler"),props:{handlePaste:(n,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const t=e.clipboardData.getData("text/plain"),s=e.clipboardData.getData("vscode-editor-data"),i=s?JSON.parse(s):void 0,r=i==null?void 0:i.mode;if(!t||!r)return!1;const{tr:o,schema:a}=n.state,l=a.text(t.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:r},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(ut.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),n.dispatch(o),!0}}})]}}),Sie=Vs.create({name:"doc",topNode:!0,content:"block+"});function Cie(n={}){return new Jn({view(e){return new Aie(e,n)}})}class Aie{constructor(e,t){var s;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(s=t.width)!==null&&s!==void 0?s:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let r=o=>{this[i](o)};return e.dom.addEventListener(i,r),{name:i,handler:r}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,s,i=this.editorView.dom,r=i.getBoundingClientRect(),o=r.width/i.offsetWidth,a=r.height/i.offsetHeight;if(t){let p=e.nodeBefore,g=e.nodeAfter;if(p||g){let b=this.editorView.nodeDOM(this.cursorPos-(p?p.nodeSize:0));if(b){let w=b.getBoundingClientRect(),S=p?w.bottom:w.top;p&&g&&(S=(S+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let N=this.width/2*a;s={left:w.left,right:w.right,top:S-N,bottom:S+N}}}}if(!s){let p=this.editorView.coordsAtPos(this.cursorPos),g=this.width/2*o;s={left:p.left-g,right:p.left+g,top:p.top,bottom:p.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let u,f;if(!l||l==document.body&&getComputedStyle(l).position=="static")u=-pageXOffset,f=-pageYOffset;else{let p=l.getBoundingClientRect(),g=p.width/l.offsetWidth,b=p.height/l.offsetHeight;u=p.left-l.scrollLeft*g,f=p.top-l.scrollTop*b}this.element.style.left=(s.left-u)/o+"px",this.element.style.top=(s.top-f)/a+"px",this.element.style.width=(s.right-s.left)/o+"px",this.element.style.height=(s.bottom-s.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),s=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),i=s&&s.type.spec.disableDropCursor,r=typeof i=="function"?i(this.editorView,t,e):i;if(t&&!r){let o=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=F4(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const Nie=bs.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Cie(this.options)]}});class Wn extends mt{constructor(e){super(e,e)}map(e,t){let s=e.resolve(t.map(this.head));return Wn.valid(s)?new Wn(s):mt.near(s)}content(){return Ve.empty}eq(e){return e instanceof Wn&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Wn(e.resolve(t.pos))}getBookmark(){return new m2(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!Eie(e)||!Tie(e))return!1;let s=t.type.spec.allowGapCursor;if(s!=null)return s;let i=t.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,t,s=!1){e:for(;;){if(!s&&Wn.valid(e))return e;let i=e.pos,r=null;for(let o=e.depth;;o--){let a=e.node(o);if(t>0?e.indexAfter(o)<a.childCount:e.index(o)>0){r=a.child(t>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=t;let l=e.doc.resolve(i);if(Wn.valid(l))return l}for(;;){let o=t>0?r.firstChild:r.lastChild;if(!o){if(r.isAtom&&!r.isText&&!dt.isSelectable(r)){e=e.doc.resolve(i+r.nodeSize*t),s=!1;continue e}break}r=o,i+=t;let a=e.doc.resolve(i);if(Wn.valid(a))return a}return null}}}Wn.prototype.visible=!1;Wn.findFrom=Wn.findGapCursorFrom;mt.jsonID("gapcursor",Wn);class m2{constructor(e){this.pos=e}map(e){return new m2(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return Wn.valid(t)?new Wn(t):mt.near(t)}}function MB(n){return n.isAtom||n.spec.isolating||n.spec.createGapCursor}function Eie(n){for(let e=n.depth;e>=0;e--){let t=n.index(e),s=n.node(e);if(t==0){if(s.type.spec.isolating)return!0;continue}for(let i=s.child(t-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||MB(i.type))return!0;if(i.inlineContent)return!1}}return!0}function Tie(n){for(let e=n.depth;e>=0;e--){let t=n.indexAfter(e),s=n.node(e);if(t==s.childCount){if(s.type.spec.isolating)return!0;continue}for(let i=s.child(t);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||MB(i.type))return!0;if(i.inlineContent)return!1}}return!0}function _ie(){return new Jn({props:{decorations:zie,createSelectionBetween(n,e,t){return e.pos==t.pos&&Wn.valid(t)?new Wn(t):null},handleClick:Rie,handleKeyDown:Mie,handleDOMEvents:{beforeinput:Iie}}})}const Mie=G_({ArrowLeft:zv("horiz",-1),ArrowRight:zv("horiz",1),ArrowUp:zv("vert",-1),ArrowDown:zv("vert",1)});function zv(n,e){const t=n=="vert"?e>0?"down":"up":e>0?"right":"left";return function(s,i,r){let o=s.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof ut){if(!r.endOfTextblock(t)||a.depth==0)return!1;l=!1,a=s.doc.resolve(e>0?a.after():a.before())}let u=Wn.findGapCursorFrom(a,e,l);return u?(i&&i(s.tr.setSelection(new Wn(u))),!0):!1}}function Rie(n,e,t){if(!n||!n.editable)return!1;let s=n.state.doc.resolve(e);if(!Wn.valid(s))return!1;let i=n.posAtCoords({left:t.clientX,top:t.clientY});return i&&i.inside>-1&&dt.isSelectable(n.state.doc.nodeAt(i.inside))?!1:(n.dispatch(n.state.tr.setSelection(new Wn(s))),!0)}function Iie(n,e){if(e.inputType!="insertCompositionText"||!(n.state.selection instanceof Wn))return!1;let{$from:t}=n.state.selection,s=t.parent.contentMatchAt(t.index()).findWrapping(n.state.schema.nodes.text);if(!s)return!1;let i=Ie.empty;for(let o=s.length-1;o>=0;o--)i=Ie.from(s[o].createAndFill(null,i));let r=n.state.tr.replace(t.pos,t.pos,new Ve(i,0,0));return r.setSelection(ut.near(r.doc.resolve(t.pos+1))),n.dispatch(r),!1}function zie(n){if(!(n.selection instanceof Wn))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",Bn.create(n.doc,[yi.widget(n.selection.head,e,{key:"gapcursor"})])}const Die=bs.create({name:"gapCursor",addProseMirrorPlugins(){return[_ie()]},extendNodeSchema(n){var e;const t={name:n.name,options:n.options,storage:n.storage};return{allowGapCursor:(e=Tt(nt(n,"allowGapCursor",t)))!==null&&e!==void 0?e:null}}}),jie=Vs.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:n}){return["br",an(this.options.HTMLAttributes,n)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:n,chain:e,state:t,editor:s})=>n.first([()=>n.exitCode(),()=>n.command(()=>{const{selection:i,storedMarks:r}=t;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=s.extensionManager,l=r||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:f})=>{if(f&&l&&o){const p=l.filter(g=>a.includes(g.type.name));u.ensureMarks(p)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Pie=Vs.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(n=>({tag:`h${n}`,attrs:{level:n}}))},renderHTML({node:n,HTMLAttributes:e}){return[`h${this.options.levels.includes(n.attrs.level)?n.attrs.level:this.options.levels[0]}`,an(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:n=>({commands:e})=>this.options.levels.includes(n.level)?e.setNode(this.name,n):!1,toggleHeading:n=>({commands:e})=>this.options.levels.includes(n.level)?e.toggleNode(this.name,"paragraph",n):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((n,e)=>({...n,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(n=>pE({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${n}})\\s$`),type:this.type,getAttributes:{level:n}}))}});var pk=200,Us=function(){};Us.prototype.append=function(e){return e.length?(e=Us.from(e),!this.length&&e||e.length<pk&&this.leafAppend(e)||this.length<pk&&e.leafPrepend(this)||this.appendInner(e)):this};Us.prototype.prepend=function(e){return e.length?Us.from(e).append(this):this};Us.prototype.appendInner=function(e){return new Lie(this,e)};Us.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?Us.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};Us.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Us.prototype.forEach=function(e,t,s){t===void 0&&(t=0),s===void 0&&(s=this.length),t<=s?this.forEachInner(e,t,s,0):this.forEachInvertedInner(e,t,s,0)};Us.prototype.map=function(e,t,s){t===void 0&&(t=0),s===void 0&&(s=this.length);var i=[];return this.forEach(function(r,o){return i.push(e(r,o))},t,s),i};Us.from=function(e){return e instanceof Us?e:e&&e.length?new RB(e):Us.empty};var RB=(function(n){function e(s){n.call(this),this.values=s}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,r){return i==0&&r==this.length?this:new e(this.values.slice(i,r))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,r,o,a){for(var l=r;l<o;l++)if(i(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,r,o,a){for(var l=r-1;l>=o;l--)if(i(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=pk)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=pk)return new e(i.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e})(Us);Us.empty=new RB([]);var Lie=(function(n){function e(t,s){n.call(this),this.left=t,this.right=s,this.length=t.length+s.length,this.depth=Math.max(t.depth,s.depth)+1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(s){return s<this.left.length?this.left.get(s):this.right.get(s-this.left.length)},e.prototype.forEachInner=function(s,i,r,o){var a=this.left.length;if(i<a&&this.left.forEachInner(s,i,Math.min(r,a),o)===!1||r>a&&this.right.forEachInner(s,Math.max(i-a,0),Math.min(this.length,r)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,r,o){var a=this.left.length;if(i>a&&this.right.forEachInvertedInner(s,i-a,Math.max(r,a)-a,o+a)===!1||r<a&&this.left.forEachInvertedInner(s,Math.min(i,a),r,o)===!1)return!1},e.prototype.sliceInner=function(s,i){if(s==0&&i==this.length)return this;var r=this.left.length;return i<=r?this.left.slice(s,i):s>=r?this.right.slice(s-r,i-r):this.left.slice(s,r).append(this.right.slice(0,i-r))},e.prototype.leafAppend=function(s){var i=this.right.leafAppend(s);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(s){var i=this.left.leafPrepend(s);if(i)return new e(i,this.right)},e.prototype.appendInner=function(s){return this.left.depth>=Math.max(this.right.depth,s.depth)+1?new e(this.left,new e(this.right,s)):new e(this,s)},e})(Us);const Oie=500;class Lo{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let s=this.items.length;for(;;s--)if(this.items.get(s-1).selection){--s;break}let i,r;t&&(i=this.remapping(s,this.items.length),r=i.maps.length);let o=e.tr,a,l,u=[],f=[];return this.items.forEach((p,g)=>{if(!p.step){i||(i=this.remapping(s,g+1),r=i.maps.length),r--,f.push(p);return}if(i){f.push(new la(p.map));let b=p.step.map(i.slice(r)),w;b&&o.maybeStep(b).doc&&(w=o.mapping.maps[o.mapping.maps.length-1],u.push(new la(w,void 0,void 0,u.length+f.length))),r--,w&&i.appendMap(w,r)}else o.maybeStep(p.step);if(p.selection)return a=i?p.selection.map(i.slice(r)):p.selection,l=new Lo(this.items.slice(0,s).append(f.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,t,s,i){let r=[],o=this.eventCount,a=this.items,l=!i&&a.length?a.get(a.length-1):null;for(let f=0;f<e.steps.length;f++){let p=e.steps[f].invert(e.docs[f]),g=new la(e.mapping.maps[f],p,t),b;(b=l&&l.merge(g))&&(g=b,f?r.pop():a=a.slice(0,a.length-1)),r.push(g),t&&(o++,t=void 0),i||(l=g)}let u=o-s.depth;return u>Fie&&(a=Bie(a,u),o-=u),new Lo(a.append(r),o)}remapping(e,t){let s=new X0;return this.items.forEach((i,r)=>{let o=i.mirrorOffset!=null&&r-i.mirrorOffset>=e?s.maps.length-i.mirrorOffset:void 0;s.appendMap(i.map,o)},e,t),s}addMaps(e){return this.eventCount==0?this:new Lo(this.items.append(e.map(t=>new la(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let s=[],i=Math.max(0,this.items.length-t),r=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(g=>{g.selection&&a--},i);let l=t;this.items.forEach(g=>{let b=r.getMirror(--l);if(b==null)return;o=Math.min(o,b);let w=r.maps[b];if(g.step){let S=e.steps[b].invert(e.docs[b]),N=g.selection&&g.selection.map(r.slice(l+1,b));N&&a++,s.push(new la(w,S,N))}else s.push(new la(w))},i);let u=[];for(let g=t;g<o;g++)u.push(new la(r.maps[g]));let f=this.items.slice(0,i).append(u).append(s),p=new Lo(f,a);return p.emptyItemCount()>Oie&&(p=p.compress(this.items.length-s.length)),p}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),s=t.maps.length,i=[],r=0;return this.items.forEach((o,a)=>{if(a>=e)i.push(o),o.selection&&r++;else if(o.step){let l=o.step.map(t.slice(s)),u=l&&l.getMap();if(s--,u&&t.appendMap(u,s),l){let f=o.selection&&o.selection.map(t.slice(s));f&&r++;let p=new la(u.invert(),l,f),g,b=i.length-1;(g=i.length&&i[b].merge(p))?i[b]=g:i.push(p)}}else o.map&&s--},this.items.length,0),new Lo(Us.from(i.reverse()),r)}}Lo.empty=new Lo(Us.empty,0);function Bie(n,e){let t;return n.forEach((s,i)=>{if(s.selection&&e--==0)return t=i,!1}),n.slice(t)}class la{constructor(e,t,s,i){this.map=e,this.step=t,this.selection=s,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new la(t.getMap().invert(),t,this.selection)}}}class Gc{constructor(e,t,s,i,r){this.done=e,this.undone=t,this.prevRanges=s,this.prevTime=i,this.prevComposition=r}}const Fie=20;function Hie(n,e,t,s){let i=t.getMeta(Bh),r;if(i)return i.historyState;t.getMeta(Gie)&&(n=new Gc(n.done,n.undone,null,0,-1));let o=t.getMeta("appendedTransaction");if(t.steps.length==0)return n;if(o&&o.getMeta(Bh))return o.getMeta(Bh).redo?new Gc(n.done.addTransform(t,void 0,s,ew(e)),n.undone,kL(t.mapping.maps),n.prevTime,n.prevComposition):new Gc(n.done,n.undone.addTransform(t,void 0,s,ew(e)),null,n.prevTime,n.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=t.getMeta("composition"),l=n.prevTime==0||!o&&n.prevComposition!=a&&(n.prevTime<(t.time||0)-s.newGroupDelay||!Uie(t,n.prevRanges)),u=o?XA(n.prevRanges,t.mapping):kL(t.mapping.maps);return new Gc(n.done.addTransform(t,l?e.selection.getBookmark():void 0,s,ew(e)),Lo.empty,u,t.time,a??n.prevComposition)}else return(r=t.getMeta("rebased"))?new Gc(n.done.rebased(t,r),n.undone.rebased(t,r),XA(n.prevRanges,t.mapping),n.prevTime,n.prevComposition):new Gc(n.done.addMaps(t.mapping.maps),n.undone.addMaps(t.mapping.maps),XA(n.prevRanges,t.mapping),n.prevTime,n.prevComposition)}function Uie(n,e){if(!e)return!1;if(!n.docChanged)return!0;let t=!1;return n.mapping.maps[0].forEach((s,i)=>{for(let r=0;r<e.length;r+=2)s<=e[r+1]&&i>=e[r]&&(t=!0)}),t}function kL(n){let e=[];for(let t=n.length-1;t>=0&&e.length==0;t--)n[t].forEach((s,i,r,o)=>e.push(r,o));return e}function XA(n,e){if(!n)return null;let t=[];for(let s=0;s<n.length;s+=2){let i=e.map(n[s],1),r=e.map(n[s+1],-1);i<=r&&t.push(i,r)}return t}function $ie(n,e,t){let s=ew(e),i=Bh.get(e).spec.config,r=(t?n.undone:n.done).popEvent(e,s);if(!r)return null;let o=r.selection.resolve(r.transform.doc),a=(t?n.done:n.undone).addTransform(r.transform,e.selection.getBookmark(),i,s),l=new Gc(t?a:r.remaining,t?r.remaining:a,null,0,-1);return r.transform.setSelection(o).setMeta(Bh,{redo:t,historyState:l})}let QA=!1,SL=null;function ew(n){let e=n.plugins;if(SL!=e){QA=!1,SL=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){QA=!0;break}}return QA}const Bh=new Ts("history"),Gie=new Ts("closeHistory");function Vie(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new Jn({key:Bh,state:{init(){return new Gc(Lo.empty,Lo.empty,null,0,-1)},apply(e,t,s){return Hie(t,s,e,n)}},config:n,props:{handleDOMEvents:{beforeinput(e,t){let s=t.inputType,i=s=="historyUndo"?zB:s=="historyRedo"?DB:null;return!i||!e.editable?!1:(t.preventDefault(),i(e.state,e.dispatch))}}}})}function IB(n,e){return(t,s)=>{let i=Bh.getState(t);if(!i||(n?i.undone:i.done).eventCount==0)return!1;if(s){let r=$ie(i,t,n);r&&s(e?r.scrollIntoView():r)}return!0}}const zB=IB(!1,!0),DB=IB(!0,!0),qie=bs.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:n,dispatch:e})=>zB(n,e),redo:()=>({state:n,dispatch:e})=>DB(n,e)}},addProseMirrorPlugins(){return[Vie(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),Wie=Vs.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:n}){return["hr",an(this.options.HTMLAttributes,n)]},addCommands(){return{setHorizontalRule:()=>({chain:n,state:e})=>{if(!une(e,e.schema.nodes[this.name]))return!1;const{selection:t}=e,{$from:s,$to:i}=t,r=n();return s.parentOffset===0?r.insertContentAt({from:Math.max(s.pos-1,0),to:i.pos},{type:this.name}):Q5(t)?r.insertContentAt(i.pos,{type:this.name}):r.insertContent({type:this.name}),r.command(({tr:o,dispatch:a})=>{var l;if(a){const{$to:u}=o.selection,f=u.end();if(u.nodeAfter)u.nodeAfter.isTextblock?o.setSelection(ut.create(o.doc,u.pos+1)):u.nodeAfter.isBlock?o.setSelection(dt.create(o.doc,u.pos)):o.setSelection(ut.create(o.doc,u.pos));else{const p=(l=u.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();p&&(o.insert(f,p),o.setSelection(ut.create(o.doc,f+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[eB({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),Kie=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,Yie=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Jie=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,Xie=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Qie=ir.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:n=>n.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:n=>n.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:n}){return["em",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setItalic:()=>({commands:n})=>n.setMark(this.name),toggleItalic:()=>({commands:n})=>n.toggleMark(this.name),unsetItalic:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Wh({find:Kie,type:this.type}),Wh({find:Jie,type:this.type})]},addPasteRules(){return[Ld({find:Yie,type:this.type}),Ld({find:Xie,type:this.type})]}}),Zie=Vs.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:n}){return["li",an(this.options.HTMLAttributes,n),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),ere="listItem",CL="textStyle",AL=/^(\d+)\.\s$/,tre=Vs.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:n=>n.hasAttribute("start")?parseInt(n.getAttribute("start")||"",10):1},type:{default:null,parseHTML:n=>n.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:n}){const{start:e,...t}=n;return e===1?["ol",an(this.options.HTMLAttributes,t),0]:["ol",an(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleOrderedList:()=>({commands:n,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ere,this.editor.getAttributes(CL)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let n=Im({find:AL,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(n=Im({find:AL,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(CL)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[n]}}),nre=Vs.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),sre=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,ire=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,rre=ir.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["s",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setStrike:()=>({commands:n})=>n.setMark(this.name),toggleStrike:()=>({commands:n})=>n.toggleMark(this.name),unsetStrike:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Wh({find:sre,type:this.type})]},addPasteRules(){return[Ld({find:ire,type:this.type})]}}),ore=Vs.create({name:"text",group:"inline"}),jB=bs.create({name:"starterKit",addExtensions(){const n=[];return this.options.bold!==!1&&n.push(pie.configure(this.options.bold)),this.options.blockquote!==!1&&n.push(cie.configure(this.options.blockquote)),this.options.bulletList!==!1&&n.push(gie.configure(this.options.bulletList)),this.options.code!==!1&&n.push(yie.configure(this.options.code)),this.options.codeBlock!==!1&&n.push(kie.configure(this.options.codeBlock)),this.options.document!==!1&&n.push(Sie.configure(this.options.document)),this.options.dropcursor!==!1&&n.push(Nie.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&n.push(Die.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&n.push(jie.configure(this.options.hardBreak)),this.options.heading!==!1&&n.push(Pie.configure(this.options.heading)),this.options.history!==!1&&n.push(qie.configure(this.options.history)),this.options.horizontalRule!==!1&&n.push(Wie.configure(this.options.horizontalRule)),this.options.italic!==!1&&n.push(Qie.configure(this.options.italic)),this.options.listItem!==!1&&n.push(Zie.configure(this.options.listItem)),this.options.orderedList!==!1&&n.push(tre.configure(this.options.orderedList)),this.options.paragraph!==!1&&n.push(nre.configure(this.options.paragraph)),this.options.strike!==!1&&n.push(rre.configure(this.options.strike)),this.options.text!==!1&&n.push(ore.configure(this.options.text)),n}}),are=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,PB=Vs.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:n}){return["img",an(this.options.HTMLAttributes,n)]},addCommands(){return{setImage:n=>({commands:e})=>e.insertContent({type:this.name,attrs:n})}},addInputRules(){return[eB({find:are,type:this.type,getAttributes:n=>{const[,,e,t,s]=n;return{src:t,alt:e,title:s}}})]}}),LB=ir.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["u",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setUnderline:()=>({commands:n})=>n.setMark(this.name),toggleUnderline:()=>({commands:n})=>n.toggleMark(this.name),unsetUnderline:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),OB=bs.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:null}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:n=>{const e=n.style.textAlign;return this.options.alignments.includes(e)?e:this.options.defaultAlignment},renderHTML:n=>n.textAlign?{style:`text-align: ${n.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:n=>({commands:e})=>this.options.alignments.includes(n)?this.options.types.map(t=>e.updateAttributes(t,{textAlign:n})).every(t=>t):!1,unsetTextAlign:()=>({commands:n})=>this.options.types.map(e=>n.resetAttributes(e,"textAlign")).every(e=>e),toggleTextAlign:n=>({editor:e,commands:t})=>this.options.alignments.includes(n)?e.isActive({textAlign:n})?t.unsetTextAlign():t.setTextAlign(n):!1}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}}),BB=ir.create({name:"subscript",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"sub"},{style:"vertical-align",getAttrs(n){return n!=="sub"?!1:null}}]},renderHTML({HTMLAttributes:n}){return["sub",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setSubscript:()=>({commands:n})=>n.setMark(this.name),toggleSubscript:()=>({commands:n})=>n.toggleMark(this.name),unsetSubscript:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-,":()=>this.editor.commands.toggleSubscript()}}}),FB=ir.create({name:"superscript",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"sup"},{style:"vertical-align",getAttrs(n){return n!=="super"?!1:null}}]},renderHTML({HTMLAttributes:n}){return["sup",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setSuperscript:()=>({commands:n})=>n.setMark(this.name),toggleSuperscript:()=>({commands:n})=>n.toggleMark(this.name),unsetSuperscript:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-.":()=>this.editor.commands.toggleSuperscript()}}});let wE,kE;if(typeof WeakMap<"u"){let n=new WeakMap;wE=e=>n.get(e),kE=(e,t)=>(n.set(e,t),t)}else{const n=[];let t=0;wE=s=>{for(let i=0;i<n.length;i+=2)if(n[i]==s)return n[i+1]},kE=(s,i)=>(t==10&&(t=0),n[t++]=s,n[t++]=i)}var Yn=class{constructor(n,e,t,s){this.width=n,this.height=e,this.map=t,this.problems=s}findCell(n){for(let e=0;e<this.map.length;e++){const t=this.map[e];if(t!=n)continue;const s=e%this.width,i=e/this.width|0;let r=s+1,o=i+1;for(let a=1;r<this.width&&this.map[e+a]==t;a++)r++;for(let a=1;o<this.height&&this.map[e+this.width*a]==t;a++)o++;return{left:s,top:i,right:r,bottom:o}}throw new RangeError(`No cell with offset ${n} found`)}colCount(n){for(let e=0;e<this.map.length;e++)if(this.map[e]==n)return e%this.width;throw new RangeError(`No cell with offset ${n} found`)}nextCell(n,e,t){const{left:s,right:i,top:r,bottom:o}=this.findCell(n);return e=="horiz"?(t<0?s==0:i==this.width)?null:this.map[r*this.width+(t<0?s-1:i)]:(t<0?r==0:o==this.height)?null:this.map[s+this.width*(t<0?r-1:o)]}rectBetween(n,e){const{left:t,right:s,top:i,bottom:r}=this.findCell(n),{left:o,right:a,top:l,bottom:u}=this.findCell(e);return{left:Math.min(t,o),top:Math.min(i,l),right:Math.max(s,a),bottom:Math.max(r,u)}}cellsInRect(n){const e=[],t={};for(let s=n.top;s<n.bottom;s++)for(let i=n.left;i<n.right;i++){const r=s*this.width+i,o=this.map[r];t[o]||(t[o]=!0,!(i==n.left&&i&&this.map[r-1]==o||s==n.top&&s&&this.map[r-this.width]==o)&&e.push(o))}return e}positionAt(n,e,t){for(let s=0,i=0;;s++){const r=i+t.child(s).nodeSize;if(s==n){let o=e+n*this.width;const a=(n+1)*this.width;for(;o<a&&this.map[o]<i;)o++;return o==a?r-1:this.map[o]}i=r}}static get(n){return wE(n)||kE(n,lre(n))}};function lre(n){if(n.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+n.type.name);const e=cre(n),t=n.childCount,s=[];let i=0,r=null;const o=[];for(let u=0,f=e*t;u<f;u++)s[u]=0;for(let u=0,f=0;u<t;u++){const p=n.child(u);f++;for(let w=0;;w++){for(;i<s.length&&s[i]!=0;)i++;if(w==p.childCount)break;const S=p.child(w),{colspan:N,rowspan:C,colwidth:M}=S.attrs;for(let R=0;R<C;R++){if(R+u>=t){(r||(r=[])).push({type:"overlong_rowspan",pos:f,n:C-R});break}const _=i+R*e;for(let j=0;j<N;j++){s[_+j]==0?s[_+j]=f:(r||(r=[])).push({type:"collision",row:u,pos:f,n:N-j});const P=M&&M[j];if(P){const D=(_+j)%e*2,U=o[D];U==null||U!=P&&o[D+1]==1?(o[D]=P,o[D+1]=1):U==P&&o[D+1]++}}}i+=N,f+=S.nodeSize}const g=(u+1)*e;let b=0;for(;i<g;)s[i++]==0&&b++;b&&(r||(r=[])).push({type:"missing",row:u,n:b}),f++}(e===0||t===0)&&(r||(r=[])).push({type:"zero_sized"});const a=new Yn(e,t,s,r);let l=!1;for(let u=0;!l&&u<o.length;u+=2)o[u]!=null&&o[u+1]<t&&(l=!0);return l&&dre(a,o,n),a}function cre(n){let e=-1,t=!1;for(let s=0;s<n.childCount;s++){const i=n.child(s);let r=0;if(t)for(let o=0;o<s;o++){const a=n.child(o);for(let l=0;l<a.childCount;l++){const u=a.child(l);o+u.attrs.rowspan>s&&(r+=u.attrs.colspan)}}for(let o=0;o<i.childCount;o++){const a=i.child(o);r+=a.attrs.colspan,a.attrs.rowspan>1&&(t=!0)}e==-1?e=r:e!=r&&(e=Math.max(e,r))}return e}function dre(n,e,t){n.problems||(n.problems=[]);const s={};for(let i=0;i<n.map.length;i++){const r=n.map[i];if(s[r])continue;s[r]=!0;const o=t.nodeAt(r);if(!o)throw new RangeError(`No cell with offset ${r} found`);let a=null;const l=o.attrs;for(let u=0;u<l.colspan;u++){const f=e[(i+u)%n.width*2];f!=null&&(!l.colwidth||l.colwidth[u]!=f)&&((a||(a=ure(l)))[u]=f)}a&&n.problems.unshift({type:"colwidth mismatch",pos:r,colwidth:a})}}function ure(n){if(n.colwidth)return n.colwidth.slice();const e=[];for(let t=0;t<n.colspan;t++)e.push(0);return e}function wi(n){let e=n.cached.tableNodeTypes;if(!e){e=n.cached.tableNodeTypes={};for(const t in n.nodes){const s=n.nodes[t],i=s.spec.tableRole;i&&(e[i]=s)}}return e}const Wc=new Ts("selectingCells");function qm(n){for(let e=n.depth-1;e>0;e--)if(n.node(e).type.spec.tableRole=="row")return n.node(0).resolve(n.before(e+1));return null}function hre(n){for(let e=n.depth;e>0;e--){const t=n.node(e).type.spec.tableRole;if(t==="cell"||t==="header_cell")return n.node(e)}return null}function Vo(n){const e=n.selection.$head;for(let t=e.depth;t>0;t--)if(e.node(t).type.spec.tableRole=="row")return!0;return!1}function qS(n){const e=n.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&e.node.type.spec.tableRole=="cell")return e.$anchor;const t=qm(e.$head)||fre(e.$head);if(t)return t;throw new RangeError(`No cell found around position ${e.head}`)}function fre(n){for(let e=n.nodeAfter,t=n.pos;e;e=e.firstChild,t++){const s=e.type.spec.tableRole;if(s=="cell"||s=="header_cell")return n.doc.resolve(t)}for(let e=n.nodeBefore,t=n.pos;e;e=e.lastChild,t--){const s=e.type.spec.tableRole;if(s=="cell"||s=="header_cell")return n.doc.resolve(t-e.nodeSize)}}function SE(n){return n.parent.type.spec.tableRole=="row"&&!!n.nodeAfter}function pre(n){return n.node(0).resolve(n.pos+n.nodeAfter.nodeSize)}function g2(n,e){return n.depth==e.depth&&n.pos>=e.start(-1)&&n.pos<=e.end(-1)}function HB(n,e,t){const s=n.node(-1),i=Yn.get(s),r=n.start(-1),o=i.nextCell(n.pos-r,e,t);return o==null?null:n.node(0).resolve(r+o)}function Yh(n,e,t=1){const s={...n,colspan:n.colspan-t};return s.colwidth&&(s.colwidth=s.colwidth.slice(),s.colwidth.splice(e,t),s.colwidth.some(i=>i>0)||(s.colwidth=null)),s}function UB(n,e,t=1){const s={...n,colspan:n.colspan+t};if(s.colwidth){s.colwidth=s.colwidth.slice();for(let i=0;i<t;i++)s.colwidth.splice(e,0,0)}return s}function mre(n,e,t){const s=wi(e.type.schema).header_cell;for(let i=0;i<n.height;i++)if(e.nodeAt(n.map[t+i*n.width]).type!=s)return!1;return!0}var kn=class ll extends mt{constructor(e,t=e){const s=e.node(-1),i=Yn.get(s),r=e.start(-1),o=i.rectBetween(e.pos-r,t.pos-r),a=e.node(0),l=i.cellsInRect(o).filter(f=>f!=t.pos-r);l.unshift(t.pos-r);const u=l.map(f=>{const p=s.nodeAt(f);if(!p)throw new RangeError(`No cell with offset ${f} found`);const g=r+f+1;return new V4(a.resolve(g),a.resolve(g+p.content.size))});super(u[0].$from,u[0].$to,u),this.$anchorCell=e,this.$headCell=t}map(e,t){const s=e.resolve(t.map(this.$anchorCell.pos)),i=e.resolve(t.map(this.$headCell.pos));if(SE(s)&&SE(i)&&g2(s,i)){const r=this.$anchorCell.node(-1)!=s.node(-1);return r&&this.isRowSelection()?ll.rowSelection(s,i):r&&this.isColSelection()?ll.colSelection(s,i):new ll(s,i)}return ut.between(s,i)}content(){const e=this.$anchorCell.node(-1),t=Yn.get(e),s=this.$anchorCell.start(-1),i=t.rectBetween(this.$anchorCell.pos-s,this.$headCell.pos-s),r={},o=[];for(let l=i.top;l<i.bottom;l++){const u=[];for(let f=l*t.width+i.left,p=i.left;p<i.right;p++,f++){const g=t.map[f];if(r[g])continue;r[g]=!0;const b=t.findCell(g);let w=e.nodeAt(g);if(!w)throw new RangeError(`No cell with offset ${g} found`);const S=i.left-b.left,N=b.right-i.right;if(S>0||N>0){let C=w.attrs;if(S>0&&(C=Yh(C,0,S)),N>0&&(C=Yh(C,C.colspan-N,N)),b.left<i.left){if(w=w.type.createAndFill(C),!w)throw new RangeError(`Could not create cell with attrs ${JSON.stringify(C)}`)}else w=w.type.create(C,w.content)}if(b.top<i.top||b.bottom>i.bottom){const C={...w.attrs,rowspan:Math.min(b.bottom,i.bottom)-Math.max(b.top,i.top)};b.top<i.top?w=w.type.createAndFill(C):w=w.type.create(C,w.content)}u.push(w)}o.push(e.child(l).copy(Ie.from(u)))}const a=this.isColSelection()&&this.isRowSelection()?e:o;return new Ve(Ie.from(a),1,1)}replace(e,t=Ve.empty){const s=e.steps.length,i=this.ranges;for(let o=0;o<i.length;o++){const{$from:a,$to:l}=i[o],u=e.mapping.slice(s);e.replace(u.map(a.pos),u.map(l.pos),o?Ve.empty:t)}const r=mt.findFrom(e.doc.resolve(e.mapping.slice(s).map(this.to)),-1);r&&e.setSelection(r)}replaceWith(e,t){this.replace(e,new Ve(Ie.from(t),0,0))}forEachCell(e){const t=this.$anchorCell.node(-1),s=Yn.get(t),i=this.$anchorCell.start(-1),r=s.cellsInRect(s.rectBetween(this.$anchorCell.pos-i,this.$headCell.pos-i));for(let o=0;o<r.length;o++)e(t.nodeAt(r[o]),i+r[o])}isColSelection(){const e=this.$anchorCell.index(-1),t=this.$headCell.index(-1);if(Math.min(e,t)>0)return!1;const s=e+this.$anchorCell.nodeAfter.attrs.rowspan,i=t+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(s,i)==this.$headCell.node(-1).childCount}static colSelection(e,t=e){const s=e.node(-1),i=Yn.get(s),r=e.start(-1),o=i.findCell(e.pos-r),a=i.findCell(t.pos-r),l=e.node(0);return o.top<=a.top?(o.top>0&&(e=l.resolve(r+i.map[o.left])),a.bottom<i.height&&(t=l.resolve(r+i.map[i.width*(i.height-1)+a.right-1]))):(a.top>0&&(t=l.resolve(r+i.map[a.left])),o.bottom<i.height&&(e=l.resolve(r+i.map[i.width*(i.height-1)+o.right-1]))),new ll(e,t)}isRowSelection(){const e=this.$anchorCell.node(-1),t=Yn.get(e),s=this.$anchorCell.start(-1),i=t.colCount(this.$anchorCell.pos-s),r=t.colCount(this.$headCell.pos-s);if(Math.min(i,r)>0)return!1;const o=i+this.$anchorCell.nodeAfter.attrs.colspan,a=r+this.$headCell.nodeAfter.attrs.colspan;return Math.max(o,a)==t.width}eq(e){return e instanceof ll&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,t=e){const s=e.node(-1),i=Yn.get(s),r=e.start(-1),o=i.findCell(e.pos-r),a=i.findCell(t.pos-r),l=e.node(0);return o.left<=a.left?(o.left>0&&(e=l.resolve(r+i.map[o.top*i.width])),a.right<i.width&&(t=l.resolve(r+i.map[i.width*(a.top+1)-1]))):(a.left>0&&(t=l.resolve(r+i.map[a.top*i.width])),o.right<i.width&&(e=l.resolve(r+i.map[i.width*(o.top+1)-1]))),new ll(e,t)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,t){return new ll(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,s=t){return new ll(e.resolve(t),e.resolve(s))}getBookmark(){return new gre(this.$anchorCell.pos,this.$headCell.pos)}};kn.prototype.visible=!1;mt.jsonID("cell",kn);var gre=class $B{constructor(e,t){this.anchor=e,this.head=t}map(e){return new $B(e.map(this.anchor),e.map(this.head))}resolve(e){const t=e.resolve(this.anchor),s=e.resolve(this.head);return t.parent.type.spec.tableRole=="row"&&s.parent.type.spec.tableRole=="row"&&t.index()<t.parent.childCount&&s.index()<s.parent.childCount&&g2(t,s)?new kn(t,s):mt.near(s,1)}};function xre(n){if(!(n.selection instanceof kn))return null;const e=[];return n.selection.forEachCell((t,s)=>{e.push(yi.node(s,s+t.nodeSize,{class:"selectedCell"}))}),Bn.create(n.doc,e)}function bre({$from:n,$to:e}){if(n.pos==e.pos||n.pos<e.pos-6)return!1;let t=n.pos,s=e.pos,i=n.depth;for(;i>=0&&!(n.after(i+1)<n.end(i));i--,t++);for(let r=e.depth;r>=0&&!(e.before(r+1)>e.start(r));r--,s--);return t==s&&/row|table/.test(n.node(i).type.spec.tableRole)}function yre({$from:n,$to:e}){let t,s;for(let i=n.depth;i>0;i--){const r=n.node(i);if(r.type.spec.tableRole==="cell"||r.type.spec.tableRole==="header_cell"){t=r;break}}for(let i=e.depth;i>0;i--){const r=e.node(i);if(r.type.spec.tableRole==="cell"||r.type.spec.tableRole==="header_cell"){s=r;break}}return t!==s&&e.parentOffset===0}function vre(n,e,t){const s=(e||n).selection,i=(e||n).doc;let r,o;if(s instanceof dt&&(o=s.node.type.spec.tableRole)){if(o=="cell"||o=="header_cell")r=kn.create(i,s.from);else if(o=="row"){const a=i.resolve(s.from+1);r=kn.rowSelection(a,a)}else if(!t){const a=Yn.get(s.node),l=s.from+1,u=l+a.map[a.width*a.height-1];r=kn.create(i,l+1,u)}}else s instanceof ut&&bre(s)?r=ut.create(i,s.from):s instanceof ut&&yre(s)&&(r=ut.create(i,s.$from.start(),s.$from.end()));return r&&(e||(e=n.tr)).setSelection(r),e}const wre=new Ts("fix-tables");function GB(n,e,t,s){const i=n.childCount,r=e.childCount;e:for(let o=0,a=0;o<r;o++){const l=e.child(o);for(let u=a,f=Math.min(i,o+3);u<f;u++)if(n.child(u)==l){a=u+1,t+=l.nodeSize;continue e}s(l,t),a<i&&n.child(a).sameMarkup(l)?GB(n.child(a),l,t+1,s):l.nodesBetween(0,l.content.size,s,t+1),t+=l.nodeSize}}function VB(n,e){let t;const s=(i,r)=>{i.type.spec.tableRole=="table"&&(t=kre(n,i,r,t))};return e?e.doc!=n.doc&&GB(e.doc,n.doc,0,s):n.doc.descendants(s),t}function kre(n,e,t,s){const i=Yn.get(e);if(!i.problems)return s;s||(s=n.tr);const r=[];for(let l=0;l<i.height;l++)r.push(0);for(let l=0;l<i.problems.length;l++){const u=i.problems[l];if(u.type=="collision"){const f=e.nodeAt(u.pos);if(!f)continue;const p=f.attrs;for(let g=0;g<p.rowspan;g++)r[u.row+g]+=u.n;s.setNodeMarkup(s.mapping.map(t+1+u.pos),null,Yh(p,p.colspan-u.n,u.n))}else if(u.type=="missing")r[u.row]+=u.n;else if(u.type=="overlong_rowspan"){const f=e.nodeAt(u.pos);if(!f)continue;s.setNodeMarkup(s.mapping.map(t+1+u.pos),null,{...f.attrs,rowspan:f.attrs.rowspan-u.n})}else if(u.type=="colwidth mismatch"){const f=e.nodeAt(u.pos);if(!f)continue;s.setNodeMarkup(s.mapping.map(t+1+u.pos),null,{...f.attrs,colwidth:u.colwidth})}else if(u.type=="zero_sized"){const f=s.mapping.map(t);s.delete(f,f+e.nodeSize)}}let o,a;for(let l=0;l<r.length;l++)r[l]&&(o==null&&(o=l),a=l);for(let l=0,u=t+1;l<i.height;l++){const f=e.child(l),p=u+f.nodeSize,g=r[l];if(g>0){let b="cell";f.firstChild&&(b=f.firstChild.type.spec.tableRole);const w=[];for(let N=0;N<g;N++){const C=wi(n.schema)[b].createAndFill();C&&w.push(C)}const S=(l==0||o==l-1)&&a==l?u+1:p-1;s.insert(s.mapping.map(S),w)}u=p}return s.setMeta(wre,{fixTables:!0})}function Ba(n){const e=n.selection,t=qS(n),s=t.node(-1),i=t.start(-1),r=Yn.get(s);return{...e instanceof kn?r.rectBetween(e.$anchorCell.pos-i,e.$headCell.pos-i):r.findCell(t.pos-i),tableStart:i,map:r,table:s}}function qB(n,{map:e,tableStart:t,table:s},i){let r=i>0?-1:0;mre(e,s,i+r)&&(r=i==0||i==e.width?null:0);for(let o=0;o<e.height;o++){const a=o*e.width+i;if(i>0&&i<e.width&&e.map[a-1]==e.map[a]){const l=e.map[a],u=s.nodeAt(l);n.setNodeMarkup(n.mapping.map(t+l),null,UB(u.attrs,i-e.colCount(l))),o+=u.attrs.rowspan-1}else{const l=r==null?wi(s.type.schema).cell:s.nodeAt(e.map[a+r]).type,u=e.positionAt(o,i,s);n.insert(n.mapping.map(t+u),l.createAndFill())}}return n}function Sre(n,e){if(!Vo(n))return!1;if(e){const t=Ba(n);e(qB(n.tr,t,t.left))}return!0}function Cre(n,e){if(!Vo(n))return!1;if(e){const t=Ba(n);e(qB(n.tr,t,t.right))}return!0}function Are(n,{map:e,table:t,tableStart:s},i){const r=n.mapping.maps.length;for(let o=0;o<e.height;){const a=o*e.width+i,l=e.map[a],u=t.nodeAt(l),f=u.attrs;if(i>0&&e.map[a-1]==l||i<e.width-1&&e.map[a+1]==l)n.setNodeMarkup(n.mapping.slice(r).map(s+l),null,Yh(f,i-e.colCount(l)));else{const p=n.mapping.slice(r).map(s+l);n.delete(p,p+u.nodeSize)}o+=f.rowspan}}function Nre(n,e){if(!Vo(n))return!1;if(e){const t=Ba(n),s=n.tr;if(t.left==0&&t.right==t.map.width)return!1;for(let i=t.right-1;Are(s,t,i),i!=t.left;i--){const r=t.tableStart?s.doc.nodeAt(t.tableStart-1):s.doc;if(!r)throw new RangeError("No table found");t.table=r,t.map=Yn.get(r)}e(s)}return!0}function Ere(n,e,t){var s;const i=wi(e.type.schema).header_cell;for(let r=0;r<n.width;r++)if(((s=e.nodeAt(n.map[r+t*n.width]))===null||s===void 0?void 0:s.type)!=i)return!1;return!0}function WB(n,{map:e,tableStart:t,table:s},i){let r=t;for(let u=0;u<i;u++)r+=s.child(u).nodeSize;const o=[];let a=i>0?-1:0;Ere(e,s,i+a)&&(a=i==0||i==e.height?null:0);for(let u=0,f=e.width*i;u<e.width;u++,f++)if(i>0&&i<e.height&&e.map[f]==e.map[f-e.width]){const p=e.map[f],g=s.nodeAt(p).attrs;n.setNodeMarkup(t+p,null,{...g,rowspan:g.rowspan+1}),u+=g.colspan-1}else{var l;const p=a==null?wi(s.type.schema).cell:(l=s.nodeAt(e.map[f+a*e.width]))===null||l===void 0?void 0:l.type,g=p==null?void 0:p.createAndFill();g&&o.push(g)}return n.insert(r,wi(s.type.schema).row.create(null,o)),n}function Tre(n,e){if(!Vo(n))return!1;if(e){const t=Ba(n);e(WB(n.tr,t,t.top))}return!0}function _re(n,e){if(!Vo(n))return!1;if(e){const t=Ba(n);e(WB(n.tr,t,t.bottom))}return!0}function Mre(n,{map:e,table:t,tableStart:s},i){let r=0;for(let u=0;u<i;u++)r+=t.child(u).nodeSize;const o=r+t.child(i).nodeSize,a=n.mapping.maps.length;n.delete(r+s,o+s);const l=new Set;for(let u=0,f=i*e.width;u<e.width;u++,f++){const p=e.map[f];if(!l.has(p)){if(l.add(p),i>0&&p==e.map[f-e.width]){const g=t.nodeAt(p).attrs;n.setNodeMarkup(n.mapping.slice(a).map(p+s),null,{...g,rowspan:g.rowspan-1}),u+=g.colspan-1}else if(i<e.height&&p==e.map[f+e.width]){const g=t.nodeAt(p),b=g.attrs,w=g.type.create({...b,rowspan:g.attrs.rowspan-1},g.content),S=e.positionAt(i+1,u,t);n.insert(n.mapping.slice(a).map(s+S),w),u+=b.colspan-1}}}}function Rre(n,e){if(!Vo(n))return!1;if(e){const t=Ba(n),s=n.tr;if(t.top==0&&t.bottom==t.map.height)return!1;for(let i=t.bottom-1;Mre(s,t,i),i!=t.top;i--){const r=t.tableStart?s.doc.nodeAt(t.tableStart-1):s.doc;if(!r)throw new RangeError("No table found");t.table=r,t.map=Yn.get(t.table)}e(s)}return!0}function NL(n){const e=n.content;return e.childCount==1&&e.child(0).isTextblock&&e.child(0).childCount==0}function Ire({width:n,height:e,map:t},s){let i=s.top*n+s.left,r=i,o=(s.bottom-1)*n+s.left,a=i+(s.right-s.left-1);for(let l=s.top;l<s.bottom;l++){if(s.left>0&&t[r]==t[r-1]||s.right<n&&t[a]==t[a+1])return!0;r+=n,a+=n}for(let l=s.left;l<s.right;l++){if(s.top>0&&t[i]==t[i-n]||s.bottom<e&&t[o]==t[o+n])return!0;i++,o++}return!1}function EL(n,e){const t=n.selection;if(!(t instanceof kn)||t.$anchorCell.pos==t.$headCell.pos)return!1;const s=Ba(n),{map:i}=s;if(Ire(i,s))return!1;if(e){const r=n.tr,o={};let a=Ie.empty,l,u;for(let f=s.top;f<s.bottom;f++)for(let p=s.left;p<s.right;p++){const g=i.map[f*i.width+p],b=s.table.nodeAt(g);if(!(o[g]||!b))if(o[g]=!0,l==null)l=g,u=b;else{NL(b)||(a=a.append(b.content));const w=r.mapping.map(g+s.tableStart);r.delete(w,w+b.nodeSize)}}if(l==null||u==null)return!0;if(r.setNodeMarkup(l+s.tableStart,null,{...UB(u.attrs,u.attrs.colspan,s.right-s.left-u.attrs.colspan),rowspan:s.bottom-s.top}),a.size>0){const f=l+1+u.content.size,p=NL(u)?l+1:f;r.replaceWith(p+s.tableStart,f+s.tableStart,a)}r.setSelection(new kn(r.doc.resolve(l+s.tableStart))),e(r)}return!0}function TL(n,e){const t=wi(n.schema);return zre(({node:s})=>t[s.type.spec.tableRole])(n,e)}function zre(n){return(e,t)=>{const s=e.selection;let i,r;if(s instanceof kn){if(s.$anchorCell.pos!=s.$headCell.pos)return!1;i=s.$anchorCell.nodeAfter,r=s.$anchorCell.pos}else{var o;if(i=hre(s.$from),!i)return!1;r=(o=qm(s.$from))===null||o===void 0?void 0:o.pos}if(i==null||r==null||i.attrs.colspan==1&&i.attrs.rowspan==1)return!1;if(t){let a=i.attrs;const l=[],u=a.colwidth;a.rowspan>1&&(a={...a,rowspan:1}),a.colspan>1&&(a={...a,colspan:1});const f=Ba(e),p=e.tr;for(let b=0;b<f.right-f.left;b++)l.push(u?{...a,colwidth:u&&u[b]?[u[b]]:null}:a);let g;for(let b=f.top;b<f.bottom;b++){let w=f.map.positionAt(b,f.left,f.table);b==f.top&&(w+=i.nodeSize);for(let S=f.left,N=0;S<f.right;S++,N++)S==f.left&&b==f.top||p.insert(g=p.mapping.map(w+f.tableStart,1),n({node:i,row:b,col:S}).createAndFill(l[N]))}p.setNodeMarkup(r,n({node:i,row:f.top,col:f.left}),l[0]),s instanceof kn&&p.setSelection(new kn(p.doc.resolve(s.$anchorCell.pos),g?p.doc.resolve(g):void 0)),t(p)}return!0}}function Dre(n,e){return function(t,s){if(!Vo(t))return!1;const i=qS(t);if(i.nodeAfter.attrs[n]===e)return!1;if(s){const r=t.tr;t.selection instanceof kn?t.selection.forEachCell((o,a)=>{o.attrs[n]!==e&&r.setNodeMarkup(a,null,{...o.attrs,[n]:e})}):r.setNodeMarkup(i.pos,null,{...i.nodeAfter.attrs,[n]:e}),s(r)}return!0}}function jre(n){return function(e,t){if(!Vo(e))return!1;if(t){const s=wi(e.schema),i=Ba(e),r=e.tr,o=i.map.cellsInRect(n=="column"?{left:i.left,top:0,right:i.right,bottom:i.map.height}:n=="row"?{left:0,top:i.top,right:i.map.width,bottom:i.bottom}:i),a=o.map(l=>i.table.nodeAt(l));for(let l=0;l<o.length;l++)a[l].type==s.header_cell&&r.setNodeMarkup(i.tableStart+o[l],s.cell,a[l].attrs);if(r.steps.length===0)for(let l=0;l<o.length;l++)r.setNodeMarkup(i.tableStart+o[l],s.header_cell,a[l].attrs);t(r)}return!0}}function _L(n,e,t){const s=e.map.cellsInRect({left:0,top:0,right:n=="row"?e.map.width:1,bottom:n=="column"?e.map.height:1});for(let i=0;i<s.length;i++){const r=e.table.nodeAt(s[i]);if(r&&r.type!==t.header_cell)return!1}return!0}function ox(n,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?jre(n):function(t,s){if(!Vo(t))return!1;if(s){const i=wi(t.schema),r=Ba(t),o=t.tr,a=_L("row",r,i),l=_L("column",r,i),u=(n==="column"?a:n==="row"&&l)?1:0,f=n=="column"?{left:0,top:u,right:1,bottom:r.map.height}:n=="row"?{left:u,top:0,right:r.map.width,bottom:1}:r,p=n=="column"?l?i.cell:i.header_cell:n=="row"?a?i.cell:i.header_cell:i.cell;r.map.cellsInRect(f).forEach(g=>{const b=g+r.tableStart,w=o.doc.nodeAt(b);w&&o.setNodeMarkup(b,p,w.attrs)}),s(o)}return!0}}ox("row",{useDeprecatedLogic:!0});ox("column",{useDeprecatedLogic:!0});const Pre=ox("cell",{useDeprecatedLogic:!0});function Lre(n,e){if(e<0){const t=n.nodeBefore;if(t)return n.pos-t.nodeSize;for(let s=n.index(-1)-1,i=n.before();s>=0;s--){const r=n.node(-1).child(s),o=r.lastChild;if(o)return i-1-o.nodeSize;i-=r.nodeSize}}else{if(n.index()<n.parent.childCount-1)return n.pos+n.nodeAfter.nodeSize;const t=n.node(-1);for(let s=n.indexAfter(-1),i=n.after();s<t.childCount;s++){const r=t.child(s);if(r.childCount)return i+1;i+=r.nodeSize}}return null}function ML(n){return function(e,t){if(!Vo(e))return!1;const s=Lre(qS(e),n);if(s==null)return!1;if(t){const i=e.doc.resolve(s);t(e.tr.setSelection(ut.between(i,pre(i))).scrollIntoView())}return!0}}function Ore(n,e){const t=n.selection.$anchor;for(let s=t.depth;s>0;s--)if(t.node(s).type.spec.tableRole=="table")return e&&e(n.tr.delete(t.before(s),t.after(s)).scrollIntoView()),!0;return!1}function Dv(n,e){const t=n.selection;if(!(t instanceof kn))return!1;if(e){const s=n.tr,i=wi(n.schema).cell.createAndFill().content;t.forEachCell((r,o)=>{r.content.eq(i)||s.replace(s.mapping.map(o+1),s.mapping.map(o+r.nodeSize-1),new Ve(i,0,0))}),s.docChanged&&e(s)}return!0}function Bre(n){if(n.size===0)return null;let{content:e,openStart:t,openEnd:s}=n;for(;e.childCount==1&&(t>0&&s>0||e.child(0).type.spec.tableRole=="table");)t--,s--,e=e.child(0).content;const i=e.child(0),r=i.type.spec.tableRole,o=i.type.schema,a=[];if(r=="row")for(let l=0;l<e.childCount;l++){let u=e.child(l).content;const f=l?0:Math.max(0,t-1),p=l<e.childCount-1?0:Math.max(0,s-1);(f||p)&&(u=CE(wi(o).row,new Ve(u,f,p)).content),a.push(u)}else if(r=="cell"||r=="header_cell")a.push(t||s?CE(wi(o).row,new Ve(e,t,s)).content:e);else return null;return Fre(o,a)}function Fre(n,e){const t=[];for(let i=0;i<e.length;i++){const r=e[i];for(let o=r.childCount-1;o>=0;o--){const{rowspan:a,colspan:l}=r.child(o).attrs;for(let u=i;u<i+a;u++)t[u]=(t[u]||0)+l}}let s=0;for(let i=0;i<t.length;i++)s=Math.max(s,t[i]);for(let i=0;i<t.length;i++)if(i>=e.length&&e.push(Ie.empty),t[i]<s){const r=wi(n).cell.createAndFill(),o=[];for(let a=t[i];a<s;a++)o.push(r);e[i]=e[i].append(Ie.from(o))}return{height:e.length,width:s,rows:e}}function CE(n,e){const t=n.createAndFill();return new z_(t).replace(0,t.content.size,e).doc}function Hre({width:n,height:e,rows:t},s,i){if(n!=s){const r=[],o=[];for(let a=0;a<t.length;a++){const l=t[a],u=[];for(let f=r[a]||0,p=0;f<s;p++){let g=l.child(p%l.childCount);f+g.attrs.colspan>s&&(g=g.type.createChecked(Yh(g.attrs,g.attrs.colspan,f+g.attrs.colspan-s),g.content)),u.push(g),f+=g.attrs.colspan;for(let b=1;b<g.attrs.rowspan;b++)r[a+b]=(r[a+b]||0)+g.attrs.colspan}o.push(Ie.from(u))}t=o,n=s}if(e!=i){const r=[];for(let o=0,a=0;o<i;o++,a++){const l=[],u=t[a%e];for(let f=0;f<u.childCount;f++){let p=u.child(f);o+p.attrs.rowspan>i&&(p=p.type.create({...p.attrs,rowspan:Math.max(1,i-p.attrs.rowspan)},p.content)),l.push(p)}r.push(Ie.from(l))}t=r,e=i}return{width:n,height:e,rows:t}}function Ure(n,e,t,s,i,r,o){const a=n.doc.type.schema,l=wi(a);let u,f;if(i>e.width)for(let p=0,g=0;p<e.height;p++){const b=t.child(p);g+=b.nodeSize;const w=[];let S;b.lastChild==null||b.lastChild.type==l.cell?S=u||(u=l.cell.createAndFill()):S=f||(f=l.header_cell.createAndFill());for(let N=e.width;N<i;N++)w.push(S);n.insert(n.mapping.slice(o).map(g-1+s),w)}if(r>e.height){const p=[];for(let w=0,S=(e.height-1)*e.width;w<Math.max(e.width,i);w++){const N=w>=e.width?!1:t.nodeAt(e.map[S+w]).type==l.header_cell;p.push(N?f||(f=l.header_cell.createAndFill()):u||(u=l.cell.createAndFill()))}const g=l.row.create(null,Ie.from(p)),b=[];for(let w=e.height;w<r;w++)b.push(g);n.insert(n.mapping.slice(o).map(s+t.nodeSize-2),b)}return!!(u||f)}function RL(n,e,t,s,i,r,o,a){if(o==0||o==e.height)return!1;let l=!1;for(let u=i;u<r;u++){const f=o*e.width+u,p=e.map[f];if(e.map[f-e.width]==p){l=!0;const g=t.nodeAt(p),{top:b,left:w}=e.findCell(p);n.setNodeMarkup(n.mapping.slice(a).map(p+s),null,{...g.attrs,rowspan:o-b}),n.insert(n.mapping.slice(a).map(e.positionAt(o,w,t)),g.type.createAndFill({...g.attrs,rowspan:b+g.attrs.rowspan-o})),u+=g.attrs.colspan-1}}return l}function IL(n,e,t,s,i,r,o,a){if(o==0||o==e.width)return!1;let l=!1;for(let u=i;u<r;u++){const f=u*e.width+o,p=e.map[f];if(e.map[f-1]==p){l=!0;const g=t.nodeAt(p),b=e.colCount(p),w=n.mapping.slice(a).map(p+s);n.setNodeMarkup(w,null,Yh(g.attrs,o-b,g.attrs.colspan-(o-b))),n.insert(w+g.nodeSize,g.type.createAndFill(Yh(g.attrs,0,o-b))),u+=g.attrs.rowspan-1}}return l}function zL(n,e,t,s,i){let r=t?n.doc.nodeAt(t-1):n.doc;if(!r)throw new Error("No table found");let o=Yn.get(r);const{top:a,left:l}=s,u=l+i.width,f=a+i.height,p=n.tr;let g=0;function b(){if(r=t?p.doc.nodeAt(t-1):p.doc,!r)throw new Error("No table found");o=Yn.get(r),g=p.mapping.maps.length}Ure(p,o,r,t,u,f,g)&&b(),RL(p,o,r,t,l,u,a,g)&&b(),RL(p,o,r,t,l,u,f,g)&&b(),IL(p,o,r,t,a,f,l,g)&&b(),IL(p,o,r,t,a,f,u,g)&&b();for(let w=a;w<f;w++){const S=o.positionAt(w,l,r),N=o.positionAt(w,u,r);p.replace(p.mapping.slice(g).map(S+t),p.mapping.slice(g).map(N+t),new Ve(i.rows[w-a],0,0))}b(),p.setSelection(new kn(p.doc.resolve(t+o.positionAt(a,l,r)),p.doc.resolve(t+o.positionAt(f-1,u-1,r)))),e(p)}const $re=G_({ArrowLeft:jv("horiz",-1),ArrowRight:jv("horiz",1),ArrowUp:jv("vert",-1),ArrowDown:jv("vert",1),"Shift-ArrowLeft":Pv("horiz",-1),"Shift-ArrowRight":Pv("horiz",1),"Shift-ArrowUp":Pv("vert",-1),"Shift-ArrowDown":Pv("vert",1),Backspace:Dv,"Mod-Backspace":Dv,Delete:Dv,"Mod-Delete":Dv});function tw(n,e,t){return t.eq(n.selection)?!1:(e&&e(n.tr.setSelection(t).scrollIntoView()),!0)}function jv(n,e){return(t,s,i)=>{if(!i)return!1;const r=t.selection;if(r instanceof kn)return tw(t,s,mt.near(r.$headCell,e));if(n!="horiz"&&!r.empty)return!1;const o=KB(i,n,e);if(o==null)return!1;if(n=="horiz")return tw(t,s,mt.near(t.doc.resolve(r.head+e),e));{const a=t.doc.resolve(o),l=HB(a,n,e);let u;return l?u=mt.near(l,1):e<0?u=mt.near(t.doc.resolve(a.before(-1)),-1):u=mt.near(t.doc.resolve(a.after(-1)),1),tw(t,s,u)}}}function Pv(n,e){return(t,s,i)=>{if(!i)return!1;const r=t.selection;let o;if(r instanceof kn)o=r;else{const l=KB(i,n,e);if(l==null)return!1;o=new kn(t.doc.resolve(l))}const a=HB(o.$headCell,n,e);return a?tw(t,s,new kn(o.$anchorCell,a)):!1}}function Gre(n,e){const t=n.state.doc,s=qm(t.resolve(e));return s?(n.dispatch(n.state.tr.setSelection(new kn(s))),!0):!1}function Vre(n,e,t){if(!Vo(n.state))return!1;let s=Bre(t);const i=n.state.selection;if(i instanceof kn){s||(s={width:1,height:1,rows:[Ie.from(CE(wi(n.state.schema).cell,t))]});const r=i.$anchorCell.node(-1),o=i.$anchorCell.start(-1),a=Yn.get(r).rectBetween(i.$anchorCell.pos-o,i.$headCell.pos-o);return s=Hre(s,a.right-a.left,a.bottom-a.top),zL(n.state,n.dispatch,o,a,s),!0}else if(s){const r=qS(n.state),o=r.start(-1);return zL(n.state,n.dispatch,o,Yn.get(r.node(-1)).findCell(r.pos-o),s),!0}else return!1}function qre(n,e){var t;if(e.ctrlKey||e.metaKey)return;const s=DL(n,e.target);let i;if(e.shiftKey&&n.state.selection instanceof kn)r(n.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&s&&(i=qm(n.state.selection.$anchor))!=null&&((t=ZA(n,e))===null||t===void 0?void 0:t.pos)!=i.pos)r(i,e),e.preventDefault();else if(!s)return;function r(l,u){let f=ZA(n,u);const p=Wc.getState(n.state)==null;if(!f||!g2(l,f))if(p)f=l;else return;const g=new kn(l,f);if(p||!n.state.selection.eq(g)){const b=n.state.tr.setSelection(g);p&&b.setMeta(Wc,l.pos),n.dispatch(b)}}function o(){n.root.removeEventListener("mouseup",o),n.root.removeEventListener("dragstart",o),n.root.removeEventListener("mousemove",a),Wc.getState(n.state)!=null&&n.dispatch(n.state.tr.setMeta(Wc,-1))}function a(l){const u=l,f=Wc.getState(n.state);let p;if(f!=null)p=n.state.doc.resolve(f);else if(DL(n,u.target)!=s&&(p=ZA(n,e),!p))return o();p&&r(p,u)}n.root.addEventListener("mouseup",o),n.root.addEventListener("dragstart",o),n.root.addEventListener("mousemove",a)}function KB(n,e,t){if(!(n.state.selection instanceof ut))return null;const{$head:s}=n.state.selection;for(let i=s.depth-1;i>=0;i--){const r=s.node(i);if((t<0?s.index(i):s.indexAfter(i))!=(t<0?0:r.childCount))return null;if(r.type.spec.tableRole=="cell"||r.type.spec.tableRole=="header_cell"){const o=s.before(i),a=e=="vert"?t>0?"down":"up":t>0?"right":"left";return n.endOfTextblock(a)?o:null}}return null}function DL(n,e){for(;e&&e!=n.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function ZA(n,e){const t=n.posAtCoords({left:e.clientX,top:e.clientY});if(!t)return null;const s=t.inside>=0?t.inside:t.pos;return qm(n.state.doc.resolve(s))}var Wre=class{constructor(e,t){this.node=e,this.defaultCellMinWidth=t,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${t}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),AE(e,this.colgroup,this.table,t),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,AE(e,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}};function AE(n,e,t,s,i,r){let o=0,a=!0,l=e.firstChild;const u=n.firstChild;if(u){for(let p=0,g=0;p<u.childCount;p++){const{colspan:b,colwidth:w}=u.child(p).attrs;for(let S=0;S<b;S++,g++){const N=i==g?r:w&&w[S],C=N?N+"px":"";if(o+=N||s,N||(a=!1),l)l.style.width!=C&&(l.style.width=C),l=l.nextSibling;else{const M=document.createElement("col");M.style.width=C,e.appendChild(M)}}}for(;l;){var f;const p=l.nextSibling;(f=l.parentNode)===null||f===void 0||f.removeChild(l),l=p}a?(t.style.width=o+"px",t.style.minWidth=""):(t.style.width="",t.style.minWidth=o+"px")}}const Mr=new Ts("tableColumnResizing");function Kre({handleWidth:n=5,cellMinWidth:e=25,defaultCellMinWidth:t=100,View:s=Wre,lastColumnResizable:i=!0}={}){const r=new Jn({key:Mr,state:{init(o,a){var l;const u=(l=r.spec)===null||l===void 0||(l=l.props)===null||l===void 0?void 0:l.nodeViews,f=wi(a.schema).table.name;return s&&u&&(u[f]=(p,g)=>new s(p,t,g)),new Yre(-1,!1)},apply(o,a){return a.apply(o)}},props:{attributes:o=>{const a=Mr.getState(o);return a&&a.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(o,a)=>{Jre(o,a,n,i)},mouseleave:o=>{Xre(o)},mousedown:(o,a)=>{Qre(o,a,e,t)}},decorations:o=>{const a=Mr.getState(o);if(a&&a.activeHandle>-1)return soe(o,a.activeHandle)},nodeViews:{}}});return r}var Yre=class nw{constructor(e,t){this.activeHandle=e,this.dragging=t}apply(e){const t=this,s=e.getMeta(Mr);if(s&&s.setHandle!=null)return new nw(s.setHandle,!1);if(s&&s.setDragging!==void 0)return new nw(t.activeHandle,s.setDragging);if(t.activeHandle>-1&&e.docChanged){let i=e.mapping.map(t.activeHandle,-1);return SE(e.doc.resolve(i))||(i=-1),new nw(i,t.dragging)}return t}};function Jre(n,e,t,s){if(!n.editable)return;const i=Mr.getState(n.state);if(i&&!i.dragging){const r=eoe(e.target);let o=-1;if(r){const{left:a,right:l}=r.getBoundingClientRect();e.clientX-a<=t?o=jL(n,e,"left",t):l-e.clientX<=t&&(o=jL(n,e,"right",t))}if(o!=i.activeHandle){if(!s&&o!==-1){const a=n.state.doc.resolve(o),l=a.node(-1),u=Yn.get(l),f=a.start(-1);if(u.colCount(a.pos-f)+a.nodeAfter.attrs.colspan-1==u.width-1)return}YB(n,o)}}}function Xre(n){if(!n.editable)return;const e=Mr.getState(n.state);e&&e.activeHandle>-1&&!e.dragging&&YB(n,-1)}function Qre(n,e,t,s){var i;if(!n.editable)return!1;const r=(i=n.dom.ownerDocument.defaultView)!==null&&i!==void 0?i:window,o=Mr.getState(n.state);if(!o||o.activeHandle==-1||o.dragging)return!1;const a=n.state.doc.nodeAt(o.activeHandle),l=Zre(n,o.activeHandle,a.attrs);n.dispatch(n.state.tr.setMeta(Mr,{setDragging:{startX:e.clientX,startWidth:l}}));function u(p){r.removeEventListener("mouseup",u),r.removeEventListener("mousemove",f);const g=Mr.getState(n.state);g!=null&&g.dragging&&(toe(n,g.activeHandle,PL(g.dragging,p,t)),n.dispatch(n.state.tr.setMeta(Mr,{setDragging:null})))}function f(p){if(!p.which)return u(p);const g=Mr.getState(n.state);if(g&&g.dragging){const b=PL(g.dragging,p,t);LL(n,g.activeHandle,b,s)}}return LL(n,o.activeHandle,l,s),r.addEventListener("mouseup",u),r.addEventListener("mousemove",f),e.preventDefault(),!0}function Zre(n,e,{colspan:t,colwidth:s}){const i=s&&s[s.length-1];if(i)return i;const r=n.domAtPos(e);let o=r.node.childNodes[r.offset].offsetWidth,a=t;if(s)for(let l=0;l<t;l++)s[l]&&(o-=s[l],a--);return o/a}function eoe(n){for(;n&&n.nodeName!="TD"&&n.nodeName!="TH";)n=n.classList&&n.classList.contains("ProseMirror")?null:n.parentNode;return n}function jL(n,e,t,s){const i=t=="right"?-s:s,r=n.posAtCoords({left:e.clientX+i,top:e.clientY});if(!r)return-1;const{pos:o}=r,a=qm(n.state.doc.resolve(o));if(!a)return-1;if(t=="right")return a.pos;const l=Yn.get(a.node(-1)),u=a.start(-1),f=l.map.indexOf(a.pos-u);return f%l.width==0?-1:u+l.map[f-1]}function PL(n,e,t){const s=e.clientX-n.startX;return Math.max(t,n.startWidth+s)}function YB(n,e){n.dispatch(n.state.tr.setMeta(Mr,{setHandle:e}))}function toe(n,e,t){const s=n.state.doc.resolve(e),i=s.node(-1),r=Yn.get(i),o=s.start(-1),a=r.colCount(s.pos-o)+s.nodeAfter.attrs.colspan-1,l=n.state.tr;for(let u=0;u<r.height;u++){const f=u*r.width+a;if(u&&r.map[f]==r.map[f-r.width])continue;const p=r.map[f],g=i.nodeAt(p).attrs,b=g.colspan==1?0:a-r.colCount(p);if(g.colwidth&&g.colwidth[b]==t)continue;const w=g.colwidth?g.colwidth.slice():noe(g.colspan);w[b]=t,l.setNodeMarkup(o+p,null,{...g,colwidth:w})}l.docChanged&&n.dispatch(l)}function LL(n,e,t,s){const i=n.state.doc.resolve(e),r=i.node(-1),o=i.start(-1),a=Yn.get(r).colCount(i.pos-o)+i.nodeAfter.attrs.colspan-1;let l=n.domAtPos(i.start(-1)).node;for(;l&&l.nodeName!="TABLE";)l=l.parentNode;l&&AE(r,l.firstChild,l,s,a,t)}function noe(n){return Array(n).fill(0)}function soe(n,e){const t=[],s=n.doc.resolve(e),i=s.node(-1);if(!i)return Bn.empty;const r=Yn.get(i),o=s.start(-1),a=r.colCount(s.pos-o)+s.nodeAfter.attrs.colspan-1;for(let u=0;u<r.height;u++){const f=a+u*r.width;if((a==r.width-1||r.map[f]!=r.map[f+1])&&(u==0||r.map[f]!=r.map[f-r.width])){var l;const p=r.map[f],g=o+p+i.nodeAt(p).nodeSize-1,b=document.createElement("div");b.className="column-resize-handle",!((l=Mr.getState(n))===null||l===void 0)&&l.dragging&&t.push(yi.node(o+p,o+p+i.nodeAt(p).nodeSize,{class:"column-resize-dragging"})),t.push(yi.widget(g,b))}}return Bn.create(n.doc,t)}function ioe({allowTableNodeSelection:n=!1}={}){return new Jn({key:Wc,state:{init(){return null},apply(e,t){const s=e.getMeta(Wc);if(s!=null)return s==-1?null:s;if(t==null||!e.docChanged)return t;const{deleted:i,pos:r}=e.mapping.mapResult(t);return i?null:r}},props:{decorations:xre,handleDOMEvents:{mousedown:qre},createSelectionBetween(e){return Wc.getState(e.state)!=null?e.state.selection:null},handleTripleClick:Gre,handleKeyDown:$re,handlePaste:Vre},appendTransaction(e,t,s){return vre(s,VB(s,t),n)}})}function NE(n,e){return e?["width",`${Math.max(e,n)}px`]:["min-width",`${n}px`]}function OL(n,e,t,s,i,r){var o;let a=0,l=!0,u=e.firstChild;const f=n.firstChild;if(f!==null)for(let p=0,g=0;p<f.childCount;p+=1){const{colspan:b,colwidth:w}=f.child(p).attrs;for(let S=0;S<b;S+=1,g+=1){const N=i===g?r:w&&w[S],C=N?`${N}px`:"";if(a+=N||s,N||(l=!1),u){if(u.style.width!==C){const[M,R]=NE(s,N);u.style.setProperty(M,R)}u=u.nextSibling}else{const M=document.createElement("col"),[R,_]=NE(s,N);M.style.setProperty(R,_),e.appendChild(M)}}}for(;u;){const p=u.nextSibling;(o=u.parentNode)===null||o===void 0||o.removeChild(u),u=p}l?(t.style.width=`${a}px`,t.style.minWidth=""):(t.style.width="",t.style.minWidth=`${a}px`)}class roe{constructor(e,t){this.node=e,this.cellMinWidth=t,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),OL(e,this.colgroup,this.table,t),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!==this.node.type?!1:(this.node=e,OL(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return e.type==="attributes"&&(e.target===this.table||this.colgroup.contains(e.target))}}function ooe(n,e,t,s){let i=0,r=!0;const o=[],a=n.firstChild;if(!a)return{};for(let p=0,g=0;p<a.childCount;p+=1){const{colspan:b,colwidth:w}=a.child(p).attrs;for(let S=0;S<b;S+=1,g+=1){const N=t===g?s:w&&w[S];i+=N||e,N||(r=!1);const[C,M]=NE(e,N);o.push(["col",{style:`${C}: ${M}`}])}}const l=r?`${i}px`:"",u=r?"":`${i}px`;return{colgroup:["colgroup",{},...o],tableWidth:l,tableMinWidth:u}}function BL(n,e){return n.createAndFill()}function aoe(n){if(n.cached.tableNodeTypes)return n.cached.tableNodeTypes;const e={};return Object.keys(n.nodes).forEach(t=>{const s=n.nodes[t];s.spec.tableRole&&(e[s.spec.tableRole]=s)}),n.cached.tableNodeTypes=e,e}function loe(n,e,t,s,i){const r=aoe(n),o=[],a=[];for(let u=0;u<t;u+=1){const f=BL(r.cell);if(f&&a.push(f),s){const p=BL(r.header_cell);p&&o.push(p)}}const l=[];for(let u=0;u<e;u+=1)l.push(r.row.createChecked(null,s&&u===0?o:a));return r.table.createChecked(null,l)}function coe(n){return n instanceof kn}const Lv=({editor:n})=>{const{selection:e}=n.state;if(!coe(e))return!1;let t=0;const s=Y5(e.ranges[0].$from,r=>r.type.name==="table");return s==null||s.node.descendants(r=>{if(r.type.name==="table")return!1;["tableCell","tableHeader"].includes(r.type.name)&&(t+=1)}),t===e.ranges.length?(n.commands.deleteTable(),!0):!1},JB=Vs.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,renderWrapper:!1,handleWidth:5,cellMinWidth:25,View:roe,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:n,HTMLAttributes:e}){const{colgroup:t,tableWidth:s,tableMinWidth:i}=ooe(n,this.options.cellMinWidth),r=["table",an(this.options.HTMLAttributes,e,{style:s?`width: ${s}`:`min-width: ${i}`}),t,["tbody",0]];return this.options.renderWrapper?["div",{class:"tableWrapper"},r]:r},addCommands(){return{insertTable:({rows:n=3,cols:e=3,withHeaderRow:t=!0}={})=>({tr:s,dispatch:i,editor:r})=>{const o=loe(r.schema,n,e,t);if(i){const a=s.selection.from+1;s.replaceSelectionWith(o).scrollIntoView().setSelection(ut.near(s.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:n,dispatch:e})=>Sre(n,e),addColumnAfter:()=>({state:n,dispatch:e})=>Cre(n,e),deleteColumn:()=>({state:n,dispatch:e})=>Nre(n,e),addRowBefore:()=>({state:n,dispatch:e})=>Tre(n,e),addRowAfter:()=>({state:n,dispatch:e})=>_re(n,e),deleteRow:()=>({state:n,dispatch:e})=>Rre(n,e),deleteTable:()=>({state:n,dispatch:e})=>Ore(n,e),mergeCells:()=>({state:n,dispatch:e})=>EL(n,e),splitCell:()=>({state:n,dispatch:e})=>TL(n,e),toggleHeaderColumn:()=>({state:n,dispatch:e})=>ox("column")(n,e),toggleHeaderRow:()=>({state:n,dispatch:e})=>ox("row")(n,e),toggleHeaderCell:()=>({state:n,dispatch:e})=>Pre(n,e),mergeOrSplit:()=>({state:n,dispatch:e})=>EL(n,e)?!0:TL(n,e),setCellAttribute:(n,e)=>({state:t,dispatch:s})=>Dre(n,e)(t,s),goToNextCell:()=>({state:n,dispatch:e})=>ML(1)(n,e),goToPreviousCell:()=>({state:n,dispatch:e})=>ML(-1)(n,e),fixTables:()=>({state:n,dispatch:e})=>(e&&VB(n),!0),setCellSelection:n=>({tr:e,dispatch:t})=>{if(t){const s=kn.create(e.doc,n.anchorCell,n.headCell);e.setSelection(s)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:Lv,"Mod-Backspace":Lv,Delete:Lv,"Mod-Delete":Lv}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[Kre({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],ioe({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(n){const e={name:n.name,options:n.options,storage:n.storage};return{tableRole:Tt(nt(n,"tableRole",e))}}}),XB=Vs.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:n}){return["tr",an(this.options.HTMLAttributes,n),0]}}),QB=Vs.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:n=>{const e=n.getAttribute("colwidth");return e?e.split(",").map(s=>parseInt(s,10)):null}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:n}){return["td",an(this.options.HTMLAttributes,n),0]}}),ZB=Vs.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:n=>{const e=n.getAttribute("colwidth");return e?e.split(",").map(s=>parseInt(s,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:n}){return["th",an(this.options.HTMLAttributes,n),0]}}),eF=Vs.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:n}){return["ul",an(this.options.HTMLAttributes,n,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:n})=>n.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),doe=/^\s*(\[([( |x])?\])\s$/,tF=Vs.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:n=>{const e=n.getAttribute("data-checked");return e===""||e==="true"},renderHTML:n=>({"data-checked":n.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:n,HTMLAttributes:e}){return["li",an(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:n.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const n={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...n,Tab:()=>this.editor.commands.sinkListItem(this.name)}:n},addNodeView(){return({node:n,HTMLAttributes:e,getPos:t,editor:s})=>{const i=document.createElement("li"),r=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),u=()=>{var f,p;a.ariaLabel=((p=(f=this.options.a11y)===null||f===void 0?void 0:f.checkboxLabel)===null||p===void 0?void 0:p.call(f,n,a.checked))||`Task item checkbox for ${n.textContent||"empty task item"}`};return u(),r.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",f=>f.preventDefault()),a.addEventListener("change",f=>{if(!s.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:p}=f.target;s.isEditable&&typeof t=="function"&&s.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:g})=>{const b=t();if(typeof b!="number")return!1;const w=g.doc.nodeAt(b);return g.setNodeMarkup(b,void 0,{...w==null?void 0:w.attrs,checked:p}),!0}).run(),!s.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(n,p)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([f,p])=>{i.setAttribute(f,p)}),i.dataset.checked=n.attrs.checked,a.checked=n.attrs.checked,r.append(a,o),i.append(r,l),Object.entries(e).forEach(([f,p])=>{i.setAttribute(f,p)}),{dom:i,contentDOM:l,update:f=>f.type!==this.type?!1:(i.dataset.checked=f.attrs.checked,a.checked=f.attrs.checked,u(),!0)}}},addInputRules(){return[Im({find:doe,type:this.type,getAttributes:n=>({checked:n[n.length-1]==="x"})})]}}),uoe="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",hoe="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",EE="numeric",TE="ascii",_E="alpha",R0="asciinumeric",s0="alphanumeric",ME="domain",nF="emoji",foe="scheme",poe="slashscheme",eN="whitespace";function moe(n,e){return n in e||(e[n]=[]),e[n]}function _u(n,e,t){e[EE]&&(e[R0]=!0,e[s0]=!0),e[TE]&&(e[R0]=!0,e[_E]=!0),e[R0]&&(e[s0]=!0),e[_E]&&(e[s0]=!0),e[s0]&&(e[ME]=!0),e[nF]&&(e[ME]=!0);for(const s in e){const i=moe(s,t);i.indexOf(n)<0&&i.push(n)}}function goe(n,e){const t={};for(const s in e)e[s].indexOf(n)>=0&&(t[s]=!0);return t}function Zi(n=null){this.j={},this.jr=[],this.jd=null,this.t=n}Zi.groups={};Zi.prototype={accepts(){return!!this.t},go(n){const e=this,t=e.j[n];if(t)return t;for(let s=0;s<e.jr.length;s++){const i=e.jr[s][0],r=e.jr[s][1];if(r&&i.test(n))return r}return e.jd},has(n,e=!1){return e?n in this.j:!!this.go(n)},ta(n,e,t,s){for(let i=0;i<n.length;i++)this.tt(n[i],e,t,s)},tr(n,e,t,s){s=s||Zi.groups;let i;return e&&e.j?i=e:(i=new Zi(e),t&&s&&_u(e,t,s)),this.jr.push([n,i]),i},ts(n,e,t,s){let i=this;const r=n.length;if(!r)return i;for(let o=0;o<r-1;o++)i=i.tt(n[o]);return i.tt(n[r-1],e,t,s)},tt(n,e,t,s){s=s||Zi.groups;const i=this;if(e&&e.j)return i.j[n]=e,e;const r=e;let o,a=i.go(n);if(a?(o=new Zi,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Zi,r){if(s)if(o.t&&typeof o.t=="string"){const l=Object.assign(goe(o.t,s),t);_u(r,l,s)}else t&&_u(r,t,s);o.t=r}return i.j[n]=o,o}};const Nt=(n,e,t,s,i)=>n.ta(e,t,s,i),Vn=(n,e,t,s,i)=>n.tr(e,t,s,i),FL=(n,e,t,s,i)=>n.ts(e,t,s,i),Be=(n,e,t,s,i)=>n.tt(e,t,s,i),cl="WORD",RE="UWORD",sF="ASCIINUMERICAL",iF="ALPHANUMERICAL",ax="LOCALHOST",IE="TLD",zE="UTLD",sw="SCHEME",Zf="SLASH_SCHEME",x2="NUM",DE="WS",b2="NL",I0="OPENBRACE",z0="CLOSEBRACE",mk="OPENBRACKET",gk="CLOSEBRACKET",xk="OPENPAREN",bk="CLOSEPAREN",yk="OPENANGLEBRACKET",vk="CLOSEANGLEBRACKET",wk="FULLWIDTHLEFTPAREN",kk="FULLWIDTHRIGHTPAREN",Sk="LEFTCORNERBRACKET",Ck="RIGHTCORNERBRACKET",Ak="LEFTWHITECORNERBRACKET",Nk="RIGHTWHITECORNERBRACKET",Ek="FULLWIDTHLESSTHAN",Tk="FULLWIDTHGREATERTHAN",_k="AMPERSAND",Mk="APOSTROPHE",Rk="ASTERISK",Vc="AT",Ik="BACKSLASH",zk="BACKTICK",Dk="CARET",Kc="COLON",y2="COMMA",jk="DOLLAR",ca="DOT",Pk="EQUALS",v2="EXCLAMATION",Wr="HYPHEN",D0="PERCENT",Lk="PIPE",Ok="PLUS",Bk="POUND",j0="QUERY",w2="QUOTE",rF="FULLWIDTHMIDDLEDOT",k2="SEMI",da="SLASH",P0="TILDE",Fk="UNDERSCORE",oF="EMOJI",Hk="SYM";var aF=Object.freeze({__proto__:null,ALPHANUMERICAL:iF,AMPERSAND:_k,APOSTROPHE:Mk,ASCIINUMERICAL:sF,ASTERISK:Rk,AT:Vc,BACKSLASH:Ik,BACKTICK:zk,CARET:Dk,CLOSEANGLEBRACKET:vk,CLOSEBRACE:z0,CLOSEBRACKET:gk,CLOSEPAREN:bk,COLON:Kc,COMMA:y2,DOLLAR:jk,DOT:ca,EMOJI:oF,EQUALS:Pk,EXCLAMATION:v2,FULLWIDTHGREATERTHAN:Tk,FULLWIDTHLEFTPAREN:wk,FULLWIDTHLESSTHAN:Ek,FULLWIDTHMIDDLEDOT:rF,FULLWIDTHRIGHTPAREN:kk,HYPHEN:Wr,LEFTCORNERBRACKET:Sk,LEFTWHITECORNERBRACKET:Ak,LOCALHOST:ax,NL:b2,NUM:x2,OPENANGLEBRACKET:yk,OPENBRACE:I0,OPENBRACKET:mk,OPENPAREN:xk,PERCENT:D0,PIPE:Lk,PLUS:Ok,POUND:Bk,QUERY:j0,QUOTE:w2,RIGHTCORNERBRACKET:Ck,RIGHTWHITECORNERBRACKET:Nk,SCHEME:sw,SEMI:k2,SLASH:da,SLASH_SCHEME:Zf,SYM:Hk,TILDE:P0,TLD:IE,UNDERSCORE:Fk,UTLD:zE,UWORD:RE,WORD:cl,WS:DE});const ol=/[a-z]/,Wg=new RegExp("\\p{L}","u"),tN=new RegExp("\\p{Emoji}","u"),al=/\d/,nN=/\s/,HL="\r",sN=`
`,xoe="",boe="",iN="";let Ov=null,Bv=null;function yoe(n=[]){const e={};Zi.groups=e;const t=new Zi;Ov==null&&(Ov=UL(uoe)),Bv==null&&(Bv=UL(hoe)),Be(t,"'",Mk),Be(t,"{",I0),Be(t,"}",z0),Be(t,"[",mk),Be(t,"]",gk),Be(t,"(",xk),Be(t,")",bk),Be(t,"<",yk),Be(t,">",vk),Be(t,"",wk),Be(t,"",kk),Be(t,"",Sk),Be(t,"",Ck),Be(t,"",Ak),Be(t,"",Nk),Be(t,"",Ek),Be(t,"",Tk),Be(t,"&",_k),Be(t,"*",Rk),Be(t,"@",Vc),Be(t,"`",zk),Be(t,"^",Dk),Be(t,":",Kc),Be(t,",",y2),Be(t,"$",jk),Be(t,".",ca),Be(t,"=",Pk),Be(t,"!",v2),Be(t,"-",Wr),Be(t,"%",D0),Be(t,"|",Lk),Be(t,"+",Ok),Be(t,"#",Bk),Be(t,"?",j0),Be(t,'"',w2),Be(t,"/",da),Be(t,";",k2),Be(t,"~",P0),Be(t,"_",Fk),Be(t,"\\",Ik),Be(t,"",rF);const s=Vn(t,al,x2,{[EE]:!0});Vn(s,al,s);const i=Vn(s,ol,sF,{[R0]:!0}),r=Vn(s,Wg,iF,{[s0]:!0}),o=Vn(t,ol,cl,{[TE]:!0});Vn(o,al,i),Vn(o,ol,o),Vn(i,al,i),Vn(i,ol,i);const a=Vn(t,Wg,RE,{[_E]:!0});Vn(a,ol),Vn(a,al,r),Vn(a,Wg,a),Vn(r,al,r),Vn(r,ol),Vn(r,Wg,r);const l=Be(t,sN,b2,{[eN]:!0}),u=Be(t,HL,DE,{[eN]:!0}),f=Vn(t,nN,DE,{[eN]:!0});Be(t,iN,f),Be(u,sN,l),Be(u,iN,f),Vn(u,nN,f),Be(f,HL),Be(f,sN),Vn(f,nN,f),Be(f,iN,f);const p=Vn(t,tN,oF,{[nF]:!0});Be(p,"#"),Vn(p,tN,p),Be(p,xoe,p);const g=Be(p,boe);Be(g,"#"),Vn(g,tN,p);const b=[[ol,o],[al,i]],w=[[ol,null],[Wg,a],[al,r]];for(let S=0;S<Ov.length;S++)Oc(t,Ov[S],IE,cl,b);for(let S=0;S<Bv.length;S++)Oc(t,Bv[S],zE,RE,w);_u(IE,{tld:!0,ascii:!0},e),_u(zE,{utld:!0,alpha:!0},e),Oc(t,"file",sw,cl,b),Oc(t,"mailto",sw,cl,b),Oc(t,"http",Zf,cl,b),Oc(t,"https",Zf,cl,b),Oc(t,"ftp",Zf,cl,b),Oc(t,"ftps",Zf,cl,b),_u(sw,{scheme:!0,ascii:!0},e),_u(Zf,{slashscheme:!0,ascii:!0},e),n=n.sort((S,N)=>S[0]>N[0]?1:-1);for(let S=0;S<n.length;S++){const N=n[S][0],M=n[S][1]?{[foe]:!0}:{[poe]:!0};N.indexOf("-")>=0?M[ME]=!0:ol.test(N)?al.test(N)?M[R0]=!0:M[TE]=!0:M[EE]=!0,FL(t,N,N,M)}return FL(t,"localhost",ax,{ascii:!0}),t.jd=new Zi(Hk),{start:t,tokens:Object.assign({groups:e},aF)}}function lF(n,e){const t=voe(e.replace(/[A-Z]/g,a=>a.toLowerCase())),s=t.length,i=[];let r=0,o=0;for(;o<s;){let a=n,l=null,u=0,f=null,p=-1,g=-1;for(;o<s&&(l=a.go(t[o]));)a=l,a.accepts()?(p=0,g=0,f=a):p>=0&&(p+=t[o].length,g++),u+=t[o].length,r+=t[o].length,o++;r-=p,o-=g,u-=p,i.push({t:f.t,v:e.slice(r-u,r),s:r-u,e:r})}return i}function voe(n){const e=[],t=n.length;let s=0;for(;s<t;){let i=n.charCodeAt(s),r,o=i<55296||i>56319||s+1===t||(r=n.charCodeAt(s+1))<56320||r>57343?n[s]:n.slice(s,s+2);e.push(o),s+=o.length}return e}function Oc(n,e,t,s,i){let r;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];n.j[l]?r=n.j[l]:(r=new Zi(s),r.jr=i.slice(),n.j[l]=r),n=r}return r=new Zi(t),r.jr=i.slice(),n.j[e[o-1]]=r,r}function UL(n){const e=[],t=[];let s=0,i="0123456789";for(;s<n.length;){let r=0;for(;i.indexOf(n[s+r])>=0;)r++;if(r>0){e.push(t.join(""));for(let o=parseInt(n.substring(s,s+r),10);o>0;o--)t.pop();s+=r}else t.push(n[s]),s++}return e}const lx={defaultProtocol:"http",events:null,format:$L,formatHref:$L,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function S2(n,e=null){let t=Object.assign({},lx);n&&(t=Object.assign(t,n instanceof S2?n.o:n));const s=t.ignoreTags,i=[];for(let r=0;r<s.length;r++)i.push(s[r].toUpperCase());this.o=t,e&&(this.defaultRender=e),this.ignoreTags=i}S2.prototype={o:lx,ignoreTags:[],defaultRender(n){return n},check(n){return this.get("validate",n.toString(),n)},get(n,e,t){const s=e!=null;let i=this.o[n];return i&&(typeof i=="object"?(i=t.t in i?i[t.t]:lx[n],typeof i=="function"&&s&&(i=i(e,t))):typeof i=="function"&&s&&(i=i(e,t.t,t)),i)},getObj(n,e,t){let s=this.o[n];return typeof s=="function"&&e!=null&&(s=s(e,t.t,t)),s},render(n){const e=n.render(this);return(this.get("render",null,n)||this.defaultRender)(e,n.t,n)}};function $L(n){return n}function cF(n,e){this.t="token",this.v=n,this.tk=e}cF.prototype={isLink:!1,toString(){return this.v},toHref(n){return this.toString()},toFormattedString(n){const e=this.toString(),t=n.get("truncate",e,this),s=n.get("format",e,this);return t&&s.length>t?s.substring(0,t)+"":s},toFormattedHref(n){return n.get("formatHref",this.toHref(n.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(n=lx.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(n),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(n){return{type:this.t,value:this.toFormattedString(n),isLink:this.isLink,href:this.toFormattedHref(n),start:this.startIndex(),end:this.endIndex()}},validate(n){return n.get("validate",this.toString(),this)},render(n){const e=this,t=this.toHref(n.get("defaultProtocol")),s=n.get("formatHref",t,this),i=n.get("tagName",t,e),r=this.toFormattedString(n),o={},a=n.get("className",t,e),l=n.get("target",t,e),u=n.get("rel",t,e),f=n.getObj("attributes",t,e),p=n.getObj("events",t,e);return o.href=s,a&&(o.class=a),l&&(o.target=l),u&&(o.rel=u),f&&Object.assign(o,f),{tagName:i,attributes:o,content:r,eventListeners:p}}};function WS(n,e){class t extends cF{constructor(i,r){super(i,r),this.t=n}}for(const s in e)t.prototype[s]=e[s];return t.t=n,t}const GL=WS("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),VL=WS("text"),woe=WS("nl"),Fv=WS("url",{isLink:!0,toHref(n=lx.defaultProtocol){return this.hasProtocol()?this.v:`${n}://${this.v}`},hasProtocol(){const n=this.tk;return n.length>=2&&n[0].t!==ax&&n[1].t===Kc}}),Vr=n=>new Zi(n);function koe({groups:n}){const e=n.domain.concat([_k,Rk,Vc,Ik,zk,Dk,jk,Pk,Wr,x2,D0,Lk,Ok,Bk,da,Hk,P0,Fk]),t=[Mk,Kc,y2,ca,v2,D0,j0,w2,k2,yk,vk,I0,z0,gk,mk,xk,bk,wk,kk,Sk,Ck,Ak,Nk,Ek,Tk],s=[_k,Mk,Rk,Ik,zk,Dk,jk,Pk,Wr,I0,z0,D0,Lk,Ok,Bk,j0,da,Hk,P0,Fk],i=Vr(),r=Be(i,P0);Nt(r,s,r),Nt(r,n.domain,r);const o=Vr(),a=Vr(),l=Vr();Nt(i,n.domain,o),Nt(i,n.scheme,a),Nt(i,n.slashscheme,l),Nt(o,s,r),Nt(o,n.domain,o);const u=Be(o,Vc);Be(r,Vc,u),Be(a,Vc,u),Be(l,Vc,u);const f=Be(r,ca);Nt(f,s,r),Nt(f,n.domain,r);const p=Vr();Nt(u,n.domain,p),Nt(p,n.domain,p);const g=Be(p,ca);Nt(g,n.domain,p);const b=Vr(GL);Nt(g,n.tld,b),Nt(g,n.utld,b),Be(u,ax,b);const w=Be(p,Wr);Be(w,Wr,w),Nt(w,n.domain,p),Nt(b,n.domain,p),Be(b,ca,g),Be(b,Wr,w);const S=Be(b,Kc);Nt(S,n.numeric,GL);const N=Be(o,Wr),C=Be(o,ca);Be(N,Wr,N),Nt(N,n.domain,o),Nt(C,s,r),Nt(C,n.domain,o);const M=Vr(Fv);Nt(C,n.tld,M),Nt(C,n.utld,M),Nt(M,n.domain,o),Nt(M,s,r),Be(M,ca,C),Be(M,Wr,N),Be(M,Vc,u);const R=Be(M,Kc),_=Vr(Fv);Nt(R,n.numeric,_);const j=Vr(Fv),P=Vr();Nt(j,e,j),Nt(j,t,P),Nt(P,e,j),Nt(P,t,P),Be(M,da,j),Be(_,da,j);const D=Be(a,Kc),U=Be(l,Kc),V=Be(U,da),q=Be(V,da);Nt(a,n.domain,o),Be(a,ca,C),Be(a,Wr,N),Nt(l,n.domain,o),Be(l,ca,C),Be(l,Wr,N),Nt(D,n.domain,j),Be(D,da,j),Be(D,j0,j),Nt(q,n.domain,j),Nt(q,e,j),Be(q,da,j);const G=[[I0,z0],[mk,gk],[xk,bk],[yk,vk],[wk,kk],[Sk,Ck],[Ak,Nk],[Ek,Tk]];for(let ee=0;ee<G.length;ee++){const[W,Q]=G[ee],Z=Be(j,W);Be(P,W,Z),Be(Z,Q,j);const $=Vr(Fv);Nt(Z,e,$);const Y=Vr();Nt(Z,t),Nt($,e,$),Nt($,t,Y),Nt(Y,e,$),Nt(Y,t,Y),Be($,Q,j),Be(Y,Q,j)}return Be(i,ax,M),Be(i,b2,woe),{start:i,tokens:aF}}function Soe(n,e,t){let s=t.length,i=0,r=[],o=[];for(;i<s;){let a=n,l=null,u=null,f=0,p=null,g=-1;for(;i<s&&!(l=a.go(t[i].t));)o.push(t[i++]);for(;i<s&&(u=l||a.go(t[i].t));)l=null,a=u,a.accepts()?(g=0,p=a):g>=0&&g++,i++,f++;if(g<0)i-=f,i<s&&(o.push(t[i]),i++);else{o.length>0&&(r.push(rN(VL,e,o)),o=[]),i-=g,f-=g;const b=p.t,w=t.slice(i-f,i);r.push(rN(b,e,w))}}return o.length>0&&r.push(rN(VL,e,o)),r}function rN(n,e,t){const s=t[0].s,i=t[t.length-1].e,r=e.slice(s,i);return new n(r,t)}const Coe=typeof console<"u"&&console&&console.warn||(()=>{}),Aoe="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",_n={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Noe(){return Zi.groups={},_n.scanner=null,_n.parser=null,_n.tokenQueue=[],_n.pluginQueue=[],_n.customSchemes=[],_n.initialized=!1,_n}function qL(n,e=!1){if(_n.initialized&&Coe(`linkifyjs: already initialized - will not register custom scheme "${n}" ${Aoe}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(n))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);_n.customSchemes.push([n,e])}function Eoe(){_n.scanner=yoe(_n.customSchemes);for(let n=0;n<_n.tokenQueue.length;n++)_n.tokenQueue[n][1]({scanner:_n.scanner});_n.parser=koe(_n.scanner.tokens);for(let n=0;n<_n.pluginQueue.length;n++)_n.pluginQueue[n][1]({scanner:_n.scanner,parser:_n.parser});return _n.initialized=!0,_n}function C2(n){return _n.initialized||Eoe(),Soe(_n.parser.start,n,lF(_n.scanner.start,n))}C2.scan=lF;function dF(n,e=null,t=null){if(e&&typeof e=="object"){if(t)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);t=e,e=null}const s=new S2(t),i=C2(n),r=[];for(let o=0;o<i.length;o++){const a=i[o];a.isLink&&(!e||a.t===e)&&s.check(a)&&r.push(a.toFormattedObject(s))}return r}const A2="[\0- -\u2029]",Toe=new RegExp(A2),_oe=new RegExp(`${A2}$`),Moe=new RegExp(A2,"g");function Roe(n){return n.length===1?n[0].isLink:n.length===3&&n[1].isLink?["()","[]"].includes(n[0].value+n[2].value):!1}function Ioe(n){return new Jn({key:new Ts("autolink"),appendTransaction:(e,t,s)=>{const i=e.some(u=>u.docChanged)&&!t.doc.eq(s.doc),r=e.some(u=>u.getMeta("preventAutolink"));if(!i||r)return;const{tr:o}=s,a=Nte(t.doc,[...e]);if(Ite(a).forEach(({newRange:u})=>{const f=Tte(s.doc,u,b=>b.isTextblock);let p,g;if(f.length>1)p=f[0],g=s.doc.textBetween(p.pos,p.pos+p.node.nodeSize,void 0," ");else if(f.length){const b=s.doc.textBetween(u.from,u.to," "," ");if(!_oe.test(b))return;p=f[0],g=s.doc.textBetween(p.pos,u.to,void 0," ")}if(p&&g){const b=g.split(Toe).filter(Boolean);if(b.length<=0)return!1;const w=b[b.length-1],S=p.pos+g.lastIndexOf(w);if(!w)return!1;const N=C2(w).map(C=>C.toObject(n.defaultProtocol));if(!Roe(N))return!1;N.filter(C=>C.isLink).map(C=>({...C,from:S+C.start+1,to:S+C.end+1})).filter(C=>s.schema.marks.code?!s.doc.rangeHasMark(C.from,C.to,s.schema.marks.code):!0).filter(C=>n.validate(C.value)).filter(C=>n.shouldAutoLink(C.value)).forEach(C=>{s2(C.from,C.to,s.doc).some(M=>M.mark.type===n.type)||o.addMark(C.from,C.to,n.type.create({href:C.href}))})}}),!!o.steps.length)return o}})}function zoe(n){return new Jn({key:new Ts("handleClickLink"),props:{handleClick:(e,t,s)=>{var i,r;if(s.button!==0||!e.editable)return!1;let o=s.target;const a=[];for(;o.nodeName!=="DIV";)a.push(o),o=o.parentNode;if(!a.find(g=>g.nodeName==="A"))return!1;const l=X5(e.state,n.type.name),u=s.target,f=(i=u==null?void 0:u.href)!==null&&i!==void 0?i:l.href,p=(r=u==null?void 0:u.target)!==null&&r!==void 0?r:l.target;return u&&f?(window.open(f,p),!0):!1}}})}function Doe(n){return new Jn({key:new Ts("handlePasteLink"),props:{handlePaste:(e,t,s)=>{const{state:i}=e,{selection:r}=i,{empty:o}=r;if(o)return!1;let a="";s.content.forEach(u=>{a+=u.textContent});const l=dF(a,{defaultProtocol:n.defaultProtocol}).find(u=>u.isLink&&u.value===a);return!a||!l?!1:n.editor.commands.setMark(n.type,{href:l.href})}}})}function mu(n,e){const t=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(s=>{const i=typeof s=="string"?s:s.scheme;i&&t.push(i)}),!n||n.replace(Moe,"").match(new RegExp(`^(?:(?:${t.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const uF=ir.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(n=>{if(typeof n=="string"){qL(n);return}qL(n.scheme,n.optionalSlashes)})},onDestroy(){Noe()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(n,e)=>!!mu(n,e.protocols),validate:n=>!!n,shouldAutoLink:n=>!!n}},addAttributes(){return{href:{default:null,parseHTML(n){return n.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:n=>{const e=n.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:t=>!!mu(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:n}){return this.options.isAllowedUri(n.href,{defaultValidate:e=>!!mu(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",an(this.options.HTMLAttributes,n),0]:["a",an(this.options.HTMLAttributes,{...n,href:""}),0]},addCommands(){return{setLink:n=>({chain:e})=>{const{href:t}=n;return this.options.isAllowedUri(t,{defaultValidate:s=>!!mu(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,n).setMeta("preventAutolink",!0).run():!1},toggleLink:n=>({chain:e})=>{const{href:t}=n;return this.options.isAllowedUri(t,{defaultValidate:s=>!!mu(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().toggleMark(this.name,n,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run():!1},unsetLink:()=>({chain:n})=>n().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Ld({find:n=>{const e=[];if(n){const{protocols:t,defaultProtocol:s}=this.options,i=dF(n).filter(r=>r.isLink&&this.options.isAllowedUri(r.value,{defaultValidate:o=>!!mu(o,t),protocols:t,defaultProtocol:s}));i.length&&i.forEach(r=>e.push({text:r.value,data:{href:r.href},index:r.start}))}return e},type:this.type,getAttributes:n=>{var e;return{href:(e=n.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const n=[],{protocols:e,defaultProtocol:t}=this.options;return this.options.autolink&&n.push(Ioe({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:s=>this.options.isAllowedUri(s,{defaultValidate:i=>!!mu(i,e),protocols:e,defaultProtocol:t}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&n.push(zoe({type:this.type})),this.options.linkOnPaste&&n.push(Doe({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),n}}),joe=n=>{if(!n.children.length)return;const e=n.querySelectorAll("span");e&&e.forEach(t=>{var s,i;const r=t.getAttribute("style"),o=(i=(s=t.parentElement)===null||s===void 0?void 0:s.closest("span"))===null||i===void 0?void 0:i.getAttribute("style");t.setAttribute("style",`${o};${r}`)})},hF=ir.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!1}},parseHTML(){return[{tag:"span",getAttrs:n=>n.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&joe(n),{}):!1}]},renderHTML({HTMLAttributes:n}){return["span",an(this.options.HTMLAttributes,n),0]},addCommands(){return{removeEmptyTextStyle:()=>({tr:n})=>{const{selection:e}=n;return n.doc.nodesBetween(e.from,e.to,(t,s)=>{if(t.isTextblock)return!0;t.marks.filter(i=>i.type===this.type).some(i=>Object.values(i.attrs).some(r=>!!r))||n.removeMark(s,s+t.nodeSize,this.type)}),!0}}}}),fF=bs.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:n=>{var e;return(e=n.style.color)===null||e===void 0?void 0:e.replace(/['"]+/g,"")},renderHTML:n=>n.color?{style:`color: ${n.color}`}:{}}}}]},addCommands(){return{setColor:n=>({chain:e})=>e().setMark("textStyle",{color:n}).run(),unsetColor:()=>({chain:n})=>n().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),Poe=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,Loe=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,pF=ir.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:n=>n.getAttribute("data-color")||n.style.backgroundColor,renderHTML:n=>n.color?{"data-color":n.color,style:`background-color: ${n.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:n}){return["mark",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setHighlight:n=>({commands:e})=>e.setMark(this.name,n),toggleHighlight:n=>({commands:e})=>e.toggleMark(this.name,n),unsetHighlight:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[Wh({find:Poe,type:this.type})]},addPasteRules(){return[Ld({find:Loe,type:this.type})]}}),mF=({editor:n,viewMode:e,onViewChange:t})=>{const[s,i]=T.useState(""),r=n&&e==="visual",o=(p,g=!1)=>`p-1.5 rounded-md transition-colors flex items-center justify-center h-8 w-8 ${g?"opacity-30 cursor-not-allowed text-zinc-400 dark:text-zinc-600":p?"bg-indigo-600 text-white shadow-sm":"text-zinc-600 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700"}`,a=p=>`px-3 py-1 text-xs font-medium transition-colors ${e===p?"bg-white dark:bg-zinc-600 text-indigo-600 dark:text-indigo-300 shadow-sm":"text-zinc-500 dark:text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200"}`,l=()=>d.jsx("div",{className:"w-[1px] h-5 bg-zinc-300 dark:bg-zinc-600 mx-1 self-center"}),u=()=>{if(!n)return;const p=n.getAttributes("link").href,g=window.prompt("URL",p);if(g!==null){if(g===""){n.chain().focus().extendMarkRange("link").unsetLink().run();return}n.chain().focus().extendMarkRange("link").setLink({href:g}).run()}},f=()=>{if(!n)return;const p=window.prompt("Enter image URL");p&&n.chain().focus().setImage({src:p}).run()};return d.jsxs("div",{className:"sticky top-20 z-20 bg-zinc-50/95 dark:bg-zinc-800/95 backdrop-blur-md p-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700 mb-4 flex flex-wrap items-center gap-1 shadow-sm",children:[r&&d.jsxs(d.Fragment,{children:[d.jsx("button",{onClick:()=>n.chain().focus().undo().run(),disabled:!n.can().undo(),className:o(!1,!n.can().undo()),"aria-label":"Undo",title:"Undo (Ctrl+Z)",children:d.jsx(H,{name:"UNDO",className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>n.chain().focus().redo().run(),disabled:!n.can().redo(),className:o(!1,!n.can().redo()),"aria-label":"Redo",title:"Redo (Ctrl+Y)",children:d.jsx(H,{name:"REDO",className:"w-4 h-4"})}),d.jsx(l,{}),d.jsx("button",{onClick:()=>n.chain().focus().setParagraph().run(),className:o(n.isActive("paragraph")),"aria-label":"Paragraph",title:"Paragraph",children:d.jsx("span",{className:"font-serif font-bold text-xs",children:"P"})}),d.jsx("button",{onClick:()=>n.chain().focus().toggleHeading({level:1}).run(),className:o(n.isActive("heading",{level:1})),title:"Heading 1",children:d.jsx("span",{className:"font-bold text-xs",children:"H1"})}),d.jsx("button",{onClick:()=>n.chain().focus().toggleHeading({level:2}).run(),className:o(n.isActive("heading",{level:2})),title:"Heading 2",children:d.jsx("span",{className:"font-bold text-xs",children:"H2"})}),d.jsx("button",{onClick:()=>n.chain().focus().toggleHeading({level:3}).run(),className:o(n.isActive("heading",{level:3})),title:"Heading 3",children:d.jsx("span",{className:"font-bold text-xs",children:"H3"})}),d.jsx("button",{onClick:()=>n.chain().focus().toggleHeading({level:4}).run(),className:o(n.isActive("heading",{level:4})),title:"Heading 4",children:d.jsx("span",{className:"font-bold text-xs",children:"H4"})}),d.jsx("button",{onClick:()=>n.chain().focus().toggleHeading({level:5}).run(),className:o(n.isActive("heading",{level:5})),title:"Heading 5",children:d.jsx("span",{className:"font-bold text-xs",children:"H5"})}),d.jsx("button",{onClick:()=>n.chain().focus().toggleHeading({level:6}).run(),className:o(n.isActive("heading",{level:6})),title:"Heading 6",children:d.jsx("span",{className:"font-bold text-xs",children:"H6"})}),d.jsx(l,{}),d.jsx("button",{onClick:()=>n.chain().focus().toggleBold().run(),disabled:!n.can().toggleBold(),className:o(n.isActive("bold")),title:"Bold (Ctrl+B)",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("path",{d:"M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"}),d.jsx("path",{d:"M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"})]})}),d.jsx("button",{onClick:()=>n.chain().focus().toggleItalic().run(),disabled:!n.can().toggleItalic(),className:o(n.isActive("italic")),title:"Italic (Ctrl+I)",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("line",{x1:"19",y1:"4",x2:"10",y2:"4"}),d.jsx("line",{x1:"14",y1:"20",x2:"5",y2:"20"}),d.jsx("line",{x1:"15",y1:"4",x2:"9",y2:"20"})]})}),d.jsx("button",{onClick:()=>n.chain().focus().toggleUnderline().run(),className:o(n.isActive("underline")),title:"Underline (Ctrl+U)",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("path",{d:"M6 4v6a6 6 0 0 0 12 0V4"}),d.jsx("line",{x1:"4",y1:"20",x2:"20",y2:"20"})]})}),d.jsx("button",{onClick:()=>n.chain().focus().toggleHighlight().run(),className:o(n.isActive("highlight")),title:"Highlight",children:d.jsx(H,{name:"HIGHLIGHT",className:"w-4 h-4"})}),d.jsx(l,{}),d.jsx("button",{onClick:()=>n.chain().focus().toggleBulletList().run(),className:o(n.isActive("bulletList")),title:"Bullet List",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),d.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),d.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),d.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),d.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),d.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]})}),d.jsx("button",{onClick:()=>n.chain().focus().toggleOrderedList().run(),className:o(n.isActive("orderedList")),title:"Ordered List",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("line",{x1:"10",y1:"6",x2:"21",y2:"6"}),d.jsx("line",{x1:"10",y1:"12",x2:"21",y2:"12"}),d.jsx("line",{x1:"10",y1:"18",x2:"21",y2:"18"}),d.jsx("path",{d:"M4 6h1v4"}),d.jsx("path",{d:"M4 10h2"}),d.jsx("path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"})]})}),d.jsx("button",{onClick:()=>n.chain().focus().toggleTaskList().run(),className:o(n.isActive("taskList")),title:"Checklist",children:d.jsx(H,{name:"CHECK_SQUARE",className:"w-4 h-4"})}),d.jsx(l,{}),d.jsx("button",{onClick:()=>n.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run(),className:o(!1),title:"Insert Table",children:d.jsx(H,{name:"TABLE",className:"w-4 h-4"})}),d.jsx("button",{onClick:f,className:o(!1),title:"Insert Image",children:d.jsx(H,{name:"IMAGE",className:"w-4 h-4"})}),d.jsx("button",{onClick:u,className:o(n.isActive("link")),title:"Link",children:d.jsx(H,{name:"LINK",className:"w-4 h-4"})}),d.jsx(l,{}),d.jsx("button",{onClick:()=>n.chain().focus().setTextAlign("left").run(),className:o(n.isActive({textAlign:"left"})),title:"Align Left",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("line",{x1:"17",y1:"10",x2:"3",y2:"10"}),d.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),d.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),d.jsx("line",{x1:"17",y1:"18",x2:"3",y2:"18"})]})}),d.jsx("button",{onClick:()=>n.chain().focus().setTextAlign("center").run(),className:o(n.isActive({textAlign:"center"})),title:"Align Center",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),d.jsx("line",{x1:"17",y1:"10",x2:"7",y2:"10"}),d.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),d.jsx("line",{x1:"17",y1:"18",x2:"7",y2:"18"})]})}),d.jsx("button",{onClick:()=>n.chain().focus().setTextAlign("justify").run(),className:o(n.isActive({textAlign:"justify"})),title:"Justify",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),d.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"}),d.jsx("line",{x1:"3",y1:"14",x2:"21",y2:"14"}),d.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}),d.jsx(l,{}),d.jsx("button",{onClick:()=>n.chain().focus().unsetAllMarks().run(),className:o(!1),title:"Clear Formatting",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("path",{d:"M18 11l-5-5-5 5"}),d.jsx("path",{d:"M18 21l-5-5-5 5"}),d.jsx("line",{x1:"3",y1:"3",x2:"21",y2:"21"})]})})]}),d.jsx("div",{className:"flex-grow flex justify-end",children:d.jsxs("div",{className:"flex bg-zinc-100 dark:bg-zinc-700/50 p-0.5 rounded-md border border-zinc-200 dark:border-zinc-600",children:[d.jsxs("button",{onClick:()=>t("visual"),className:a("visual"),title:"Rich Text Editor",children:[d.jsx(H,{name:"PEN_TOOL",className:"w-3 h-3 inline mr-1"}),"Visual"]}),d.jsxs("button",{onClick:()=>t("markdown"),className:a("markdown"),title:"Markdown Editor",children:[d.jsx(H,{name:"CODE",className:"w-3 h-3 inline mr-1"}),"MD"]}),d.jsxs("button",{onClick:()=>t("html"),className:a("html"),title:"HTML Source",children:[d.jsx("span",{className:"font-mono font-bold mr-1 text-[10px]",children:"</>"}),"HTML"]})]})})]})},Ooe=_B,gF=({editor:n})=>{if(!n)return null;const e=({editor:i})=>i.isActive("table"),t="p-1.5 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-100 dark:hover:bg-zinc-700 rounded transition-colors",s="p-1.5 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 rounded transition-colors";return d.jsxs(Ooe,{editor:n,tippyOptions:{duration:100,placement:"top",maxWidth:500},shouldShow:e,className:"flex items-center gap-1 bg-white dark:bg-zinc-800 p-1 rounded-lg shadow-xl border border-zinc-200 dark:border-zinc-700",children:[d.jsxs("div",{className:"flex items-center p-1 border-r border-zinc-200 dark:border-zinc-700 gap-1",children:[d.jsx("button",{onClick:()=>n.chain().focus().addRowBefore().run(),className:t,title:"Add Row Before",children:d.jsx(H,{name:"ROW_PLUS",className:"w-4 h-4 rotate-180"})}),d.jsx("button",{onClick:()=>n.chain().focus().addRowAfter().run(),className:t,title:"Add Row After",children:d.jsx(H,{name:"ROW_PLUS",className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>n.chain().focus().deleteRow().run(),className:s,title:"Delete Row",children:d.jsx(H,{name:"DELETE_ROW",className:"w-4 h-4"})})]}),d.jsxs("div",{className:"flex items-center p-1 border-r border-zinc-200 dark:border-zinc-700 gap-1",children:[d.jsx("button",{onClick:()=>n.chain().focus().addColumnBefore().run(),className:t,title:"Add Col Before",children:d.jsx(H,{name:"COL_PLUS",className:"w-4 h-4 rotate-180"})}),d.jsx("button",{onClick:()=>n.chain().focus().addColumnAfter().run(),className:t,title:"Add Col After",children:d.jsx(H,{name:"COL_PLUS",className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>n.chain().focus().deleteColumn().run(),className:s,title:"Delete Column",children:d.jsx(H,{name:"DELETE_COL",className:"w-4 h-4"})})]}),d.jsxs("div",{className:"flex items-center p-1 gap-1",children:[d.jsx("button",{onClick:()=>n.chain().focus().mergeCells().run(),className:t,title:"Merge Cells",children:d.jsx(H,{name:"MERGE",className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>n.chain().focus().splitCell().run(),className:t,title:"Split Cell",children:d.jsx(H,{name:"MERGE",className:"w-4 h-4 rotate-90"})}),d.jsx("div",{className:"w-px h-4 bg-zinc-200 dark:bg-zinc-700 mx-1"}),d.jsx("button",{onClick:()=>n.chain().focus().deleteTable().run(),className:s,title:"Delete Table",children:d.jsx(H,{name:"TRASH",className:"w-4 h-4"})})]})]})},Boe=({content:n,onUpdate:e})=>{const[t,s]=T.useState("visual"),i=T.useMemo(()=>[jB.configure({heading:{levels:[1,2,3,4,5,6]}}),PB.configure({inline:!1,allowBase64:!0}),LB,BB,FB,OB.configure({types:["heading","paragraph"]}),JB.configure({resizable:!0}),XB,ZB,QB,eF,tF.configure({nested:!0}),uF.configure({openOnClick:!1,autolink:!0}),hF,fF,pF.configure({multicolor:!0}),vB,kB],[]),r=T.useMemo(()=>({attributes:{class:"prose-base dark:prose-invert max-w-none tiptap outline-none min-h-[200px] focus:outline-none"}}),[]),o=NB({extensions:i,content:n,onUpdate:({editor:a})=>{const l=a.getHTML();e(l)},editorProps:r},[i]);return T.useEffect(()=>{o&&n&&n!==o.getHTML()&&(o.isFocused||o.commands.setContent(n))},[n,o]),d.jsxs("div",{className:"flex flex-col h-full",children:[d.jsx("div",{className:"sticky top-0 z-40 bg-white dark:bg-zinc-900 px-4 py-2 border-b border-zinc-200 dark:border-zinc-800",children:d.jsx(mF,{editor:o,viewMode:t,onViewChange:s})}),d.jsx("div",{className:"flex-1 bg-zinc-100 dark:bg-zinc-900 overflow-y-auto p-4 sm:p-8 flex justify-center",children:d.jsx("div",{className:"bg-white dark:bg-zinc-800 w-full max-w-[816px] min-h-[1056px] shadow-lg p-8 sm:p-12 rounded-sm",children:o&&d.jsxs(d.Fragment,{children:[d.jsx(gF,{editor:o}),d.jsx(CB,{editor:o})]})})})]})},Foe=()=>{const{id:n}=_O(),e=Es(),{documents:t,updateDocument:s}=T.useContext(rs),[i,r]=T.useState(null),[o,a]=T.useState(""),[l,u]=T.useState(!1);T.useEffect(()=>{if(n){const g=t.find(b=>b.id===n);g?(r(g),a(g.title)):t.length>0}},[n,t,e]);const f=T.useCallback(g=>{i&&g!==i.content&&(u(!0),s({...i,content:g,title:o}).finally(()=>{setTimeout(()=>u(!1),800)}))},[i,o,s]),p=()=>{i&&o!==i.title&&s({...i,title:o})};return i?d.jsxs("div",{className:"flex flex-col h-screen bg-zinc-100 dark:bg-zinc-900",children:[d.jsxs("header",{className:"bg-white dark:bg-zinc-800 border-b border-zinc-200 dark:border-zinc-700 px-4 py-2 flex items-center justify-between flex-shrink-0 pt-[env(safe-area-inset-top)]",children:[d.jsxs("div",{className:"flex items-center space-x-4 flex-1 min-w-0",children:[d.jsx("button",{onClick:()=>e("/documents"),className:"p-2 rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-700 text-zinc-500 dark:text-zinc-400",children:d.jsx(H,{name:"CHEVRON_LEFT",className:"w-5 h-5"})}),d.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[d.jsx("div",{className:"p-1.5 bg-indigo-100 dark:bg-indigo-900/50 rounded text-indigo-600 dark:text-indigo-400",children:d.jsx(H,{name:"FILE_TEXT",className:"w-5 h-5"})}),d.jsx("input",{type:"text",value:o,onChange:g=>a(g.target.value),onBlur:p,className:"bg-transparent border-none focus:ring-0 font-bold text-lg text-zinc-800 dark:text-zinc-100 w-full truncate p-0",placeholder:"Untitled Document"})]})]}),d.jsx("div",{className:"flex items-center space-x-3 text-sm",children:d.jsx("span",{className:`text-xs font-medium transition-colors ${l?"text-zinc-500":"text-emerald-500"}`,children:l?"Saving...":"Saved"})})]}),d.jsx("div",{className:"flex-1 overflow-hidden",children:d.jsx(Boe,{content:i.content,onUpdate:f})})]}):d.jsx(sr,{message:"Loading document..."})},Hoe=({isOpen:n,onClose:e,currentImageUrl:t,imageGenerationInstructions:s,onRegenerate:i,isGenerating:r})=>{const[o,a]=T.useState("");if(!n)return null;const l=()=>{if(!o.trim()){te.info("Please provide some instructions to regenerate the image.");return}i(o)};return d.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:e,children:[r&&d.jsx(sr,{message:"Regenerating image..."}),d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-3xl max-h-[90vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:u=>u.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Edit Image"}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 overflow-y-auto pr-2 -mr-2",children:[d.jsxs("div",{className:"flex flex-col items-center",children:[d.jsx("p",{className:"text-sm font-semibold text-gray-600 dark:text-gray-300 mb-2",children:"Current Image"}),d.jsx("img",{src:t,alt:"Current image",className:"rounded-lg shadow-md w-full object-contain"})]}),d.jsxs("div",{className:"flex flex-col space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Book's Default Image Style"}),d.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400 p-2 bg-gray-50 dark:bg-gray-700/50 rounded-md border border-gray-200 dark:border-gray-600",children:s})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"newInstructions",className:"block text-sm font-semibold text-gray-700 dark:text-gray-300",children:"New Instructions"}),d.jsx("textarea",{id:"newInstructions",value:o,onChange:u=>a(u.target.value),rows:5,className:"mt-1 block w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., Change the person's shirt to red, add a tree in the background."}),d.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Describe the new image you want or the changes to make. This will be combined with the default style."})]})]})]}),d.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3",children:[d.jsx("button",{onClick:e,disabled:r,className:"bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors disabled:opacity-50",children:"Cancel"}),d.jsxs("button",{onClick:l,disabled:r,className:"bg-blue-600 text-white px-6 py-2 rounded-lg shadow font-semibold hover:bg-blue-700 transition-colors flex items-center space-x-2 disabled:opacity-50",children:[d.jsx(H,{name:"WAND",className:`w-5 h-5 ${r?"animate-spin":""}`}),d.jsx("span",{children:r?"Generating...":"Regenerate Image"})]})]})]})]})},Uoe=({isOpen:n,onClose:e,onExport:t,book:s})=>{const[i,r]=T.useState({includeToc:!0,includeCover:!!s.coverImage,customCss:""});if(!n)return null;const o=(l,u)=>{r(f=>({...f,[l]:u}))},a=()=>{t(i)};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-lg max-h-[90vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:l=>l.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Advanced ePub Export"}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("div",{className:"space-y-4 overflow-y-auto pr-2 -mr-2",children:[d.jsxs("div",{className:"flex items-center",children:[d.jsx("input",{id:"includeCover",type:"checkbox",checked:i.includeCover,onChange:l=>o("includeCover",l.target.checked),disabled:!s.coverImage,className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),d.jsxs("label",{htmlFor:"includeCover",className:"ml-3 block text-sm text-gray-900 dark:text-gray-200",children:["Include Cover Image",!s.coverImage&&d.jsx("span",{className:"text-xs text-gray-500",children:" (No cover generated)"})]})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("input",{id:"includeToc",type:"checkbox",checked:i.includeToc,onChange:l=>o("includeToc",l.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),d.jsx("label",{htmlFor:"includeToc",className:"ml-3 block text-sm text-gray-900 dark:text-gray-200",children:"Include Table of Contents"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"customCss",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Custom CSS"}),d.jsx("textarea",{id:"customCss",value:i.customCss,onChange:l=>o("customCss",l.target.value),rows:6,className:"mt-1 block w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 font-mono text-xs",placeholder:`/* Your custom CSS will be added here */

body {
  font-size: 1.1em;
}

h2 {
  color: #005588;
}`}),d.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Add your own CSS to override the default ePub styles."})]})]}),d.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3",children:[d.jsx("button",{onClick:e,className:"bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",children:"Cancel"}),d.jsxs("button",{onClick:a,className:"bg-purple-600 text-white px-6 py-2 rounded-lg shadow font-semibold hover:bg-purple-700 transition-colors flex items-center space-x-2",children:[d.jsx(H,{name:"DOWNLOAD",className:"w-5 h-5"}),d.jsx("span",{children:"Start Export"})]})]})]})})},$oe=()=>{const{isSnapshotsPanelOpen:n,setIsSnapshotsPanelOpen:e,snapshots:t,handleRestoreSnapshot:s,handleDeleteSnapshot:i}=Xt();return n?d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-40 p-4 animate-fade-in",onClick:()=>e(!1),children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-2xl max-h-[80vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:r=>r.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Book Snapshots"}),d.jsx("button",{onClick:()=>e(!1),className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-2xl leading-none",children:""})]}),d.jsx("div",{className:"overflow-y-auto space-y-3 flex-grow pr-2 -mr-2",children:t.length>0?t.map(r=>d.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg flex flex-col sm:flex-row justify-between items-start sm:items-center border border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"mb-2 sm:mb-0",children:[d.jsx("p",{className:"font-semibold text-gray-800 dark:text-gray-100",children:r.name}),d.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Created: ",new Date(r.createdAt).toLocaleString()]})]}),d.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[d.jsx("button",{onClick:()=>s(r),className:"px-3 py-1 text-sm font-semibold rounded-md bg-blue-600 text-white hover:bg-blue-700 transition-colors",children:"Restore"}),d.jsx("button",{onClick:()=>i(r.id),className:"p-2 rounded-full text-gray-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-gray-700 transition-colors",children:d.jsx(H,{name:"TRASH",className:"w-4 h-4"})})]})]},r.id)):d.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No snapshots created yet."})})]})}):null},Goe=()=>{const{book:n,handleInputChange:e,instructions:t,selectedInstruction:s,handleUpdateInstructions:i,handleSaveNewInstructionTemplate:r,handleUpdateInstructionTemplate:o,handleSuggestBookInstructionImprovement:a,isSuggestingInstructions:l,instructionSuggestion:u,setInstructionSuggestion:f,handleStartOutlineBrainstorm:p,isAiEnabled:g}=Xt();if(!n)return null;const b=t.find(C=>C.prompt===s),w=t.some(C=>C.prompt===n.instructions),S=b&&n.instructions!==s,N=n.instructions.trim()!==""&&!w;return d.jsxs("div",{className:"bg-white dark:bg-zinc-800 p-6 rounded-lg shadow-md border border-zinc-200 dark:border-zinc-700",children:[d.jsx("h2",{className:"text-xl font-bold mb-4",children:"1. Configure Your Book"}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"topic",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Book Topic"}),d.jsx("input",{type:"text",id:"topic",name:"topic",value:n.topic,onChange:e,className:"mt-1 block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Language"}),d.jsxs("select",{id:"language",name:"language",value:n.language||"en",onChange:e,className:"mt-1 block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",children:[d.jsx("option",{value:"en",children:"English"}),d.jsx("option",{value:"sv",children:"Swedish"})]})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"instructions",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Writing Style & Instructions"}),d.jsxs("select",{value:s,onChange:C=>i(C.target.value),className:"mt-1 block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",children:[d.jsx("option",{value:"",children:"-- Select or type custom --"}),t.map(C=>d.jsx("option",{value:C.prompt,children:C.name},C.id))]}),d.jsx("textarea",{name:"instructions",value:n.instructions,onChange:C=>i(C.target.value),rows:4,className:"mt-2 block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"e.g., Write in a humorous tone for beginners..."}),d.jsxs("div",{className:"mt-2 space-x-2 flex justify-end",children:[S&&b&&d.jsx("button",{onClick:()=>o(b),className:"px-3 py-1 text-xs font-semibold rounded-md bg-amber-500 text-white hover:bg-amber-600 transition-colors animate-fade-in",title:`Update the "${b.name}" template`,children:"Update Template"}),N&&d.jsx("button",{onClick:r,className:"px-3 py-1 text-xs font-semibold rounded-md bg-emerald-500 text-white hover:bg-emerald-600 transition-colors animate-fade-in",title:"Save current instructions as a new template",children:"Save as New Template"})]}),g&&d.jsx("div",{className:"mt-2 flex justify-end",children:d.jsxs("button",{onClick:a,disabled:l||n.topic.trim()===""||n.instructions.trim()==="",className:"flex items-center space-x-2 text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:n.topic.trim()===""?"Please enter a book topic first":n.instructions.trim()===""?"Please enter some instructions first":"Get an AI-powered suggestion",children:[d.jsx(H,{name:"WAND",className:`w-4 h-4 ${l?"animate-spin":""}`}),d.jsx("span",{children:l?"Generating...":"Suggest Improvement"})]})}),u&&d.jsxs("div",{className:"mt-4 p-4 bg-indigo-50 dark:bg-zinc-700/50 border border-indigo-200 dark:border-zinc-600 rounded-lg animate-fade-in-up",children:[d.jsx("h4",{className:"font-semibold text-zinc-800 dark:text-zinc-100 mb-2",children:"Suggestion:"}),d.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 whitespace-pre-wrap",children:u}),d.jsxs("div",{className:"mt-3 flex justify-end space-x-2",children:[d.jsx("button",{onClick:()=>f(null),className:"px-3 py-1 text-xs font-semibold rounded-md bg-zinc-200 dark:bg-zinc-600 text-zinc-800 dark:text-white hover:bg-zinc-300 dark:hover:bg-zinc-500",children:"Dismiss"}),d.jsx("button",{onClick:()=>{n&&(i(u),f(null))},className:"px-3 py-1 text-xs font-semibold rounded-md bg-indigo-600 text-white hover:bg-indigo-700",children:"Use this suggestion"})]})]})]}),d.jsxs("div",{children:[d.jsxs("label",{htmlFor:"wordCountGoal",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:["Approximate Word Count ",d.jsx("span",{className:"text-zinc-400 font-normal",children:"(Optional)"})]}),d.jsx("input",{type:"number",id:"wordCountGoal",name:"wordCountGoal",value:n.wordCountGoal||"",onChange:e,step:"1000",className:"mt-1 block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"e.g., 50000"})]}),g&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"flex items-center",children:[d.jsx("input",{id:"generateImages",name:"generateImages",type:"checkbox",checked:n.generateImages,onChange:e,className:"h-4 w-4 text-indigo-600 border-zinc-300 rounded focus:ring-indigo-500"}),d.jsx("label",{htmlFor:"generateImages",className:"ml-3 block text-sm text-zinc-900 dark:text-zinc-200",children:"Generate images for chapters"})]}),n.generateImages&&d.jsxs("div",{className:"animate-fade-in space-y-1",children:[d.jsx("label",{htmlFor:"imageGenerationInstructions",className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Image Generation Instructions"}),d.jsx("textarea",{id:"imageGenerationInstructions",name:"imageGenerationInstructions",value:n.imageGenerationInstructions,onChange:e,rows:4,className:"mt-1 block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"e.g., A minimalist line drawing, in the style of a vintage storybook..."})]}),d.jsxs("button",{onClick:p,className:"w-full flex justify-center items-center space-x-2 bg-indigo-600 text-white px-4 py-3 rounded-lg shadow-md font-semibold hover:bg-indigo-700 transition-colors",children:[d.jsx(H,{name:"WAND"}),d.jsx("span",{children:"Brainstorm Outline..."})]})]})]})]})},Voe=()=>{const{book:n,handleInputChange:e,isMetadataOpen:t,setIsMetadataOpen:s}=Xt();return n?d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-zinc-200 dark:border-zinc-700 overflow-hidden transition-all duration-200 hover:shadow-md",children:[d.jsxs("button",{onClick:()=>s(!t),className:"w-full flex items-center justify-between p-4 hover:bg-zinc-50 dark:hover:bg-zinc-700/30 transition-colors group",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/30 rounded-lg text-amber-600 dark:text-amber-400 group-hover:scale-110 transition-transform",children:d.jsx(H,{name:"INFO",className:"w-4 h-4"})}),d.jsx("span",{className:"font-semibold text-zinc-800 dark:text-zinc-100 text-sm",children:"Metadata"})]}),d.jsx(H,{name:"CHEVRON_LEFT",className:`w-4 h-4 text-zinc-400 transform transition-transform duration-300 ${t?"-rotate-90":"rotate-0"}`})]}),t&&d.jsx("div",{className:"p-4 pt-0 space-y-4 border-t border-zinc-100 dark:border-zinc-700/50 animate-slide-in-down bg-zinc-50/50 dark:bg-zinc-900/30",children:d.jsxs("div",{className:"space-y-3 mt-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-1.5",children:"Book Title"}),d.jsxs("div",{className:"relative",children:[d.jsx("input",{type:"text",id:"topic",name:"topic",value:n.topic,onChange:e,className:"w-full text-sm bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg px-3 py-2.5 pl-9 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all",placeholder:"Enter book title"}),d.jsx(H,{name:"BOOK",className:"w-4 h-4 text-zinc-400 absolute left-3 top-3"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-1.5",children:"Subtitle"}),d.jsx("input",{type:"text",id:"subtitle",name:"subtitle",value:n.subtitle||"",onChange:e,className:"w-full text-sm bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg px-3 py-2.5 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all",placeholder:"Enter book subtitle"})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-1.5",children:"Author"}),d.jsx("input",{type:"text",id:"author",name:"author",value:n.author||"",onChange:e,className:"w-full text-sm bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg px-3 py-2.5 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all",placeholder:"Author Name"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-1.5",children:"Publisher"}),d.jsx("input",{type:"text",id:"publisher",name:"publisher",value:n.publisher||"",onChange:e,className:"w-full text-sm bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg px-3 py-2.5 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all",placeholder:"Publisher"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-1.5",children:"Description"}),d.jsx("textarea",{id:"description",name:"description",value:n.description||"",onChange:e,rows:3,className:"w-full text-sm bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg px-3 py-2.5 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all resize-none",placeholder:"Brief synopsis or back cover text..."})]})]})})]}):null},qoe=n=>!n||!n.trim()?0:n.trim().split(/\s+/).filter(Boolean).length,Woe=({onSaveAndClose:n})=>{const{book:e,snapshots:t,handleGenerateChapters:s,handleGenerateFullBook:i,setIsSnapshotsPanelOpen:r,handleExportPdf:o,setIsEpubModalOpen:a,createSnapshot:l,isGeneratingChapter:u,isAiEnabled:f}=Xt(),p=T.useRef(null),[g,b]=T.useState(0);if(!e)return null;const w=e.outline.length,S=e.content.length,N=e.status==="complete",C=Math.round(S/w*100)||0,M=T.useMemo(()=>e.content.reduce((q,G)=>{if(!G)return q;const ee=document.createElement("div");ee.innerHTML=G.htmlContent;const W=ee.textContent||"";return q+qoe(W)},0),[e.content]);T.useEffect(()=>{p.current===null&&M>0&&(p.current=M),p.current!==null&&b(Math.max(0,M-p.current))},[M]);const R=e.wordCountGoal||0,_=R>0?Math.min(100,Math.round(M/R*100)):0,j=Math.ceil(M/250),P=j>60?`${Math.floor(j/60)}h ${j%60}m`:`${j} min`,D=async()=>{const q=await Mn.prompt({title:"Create Snapshot",message:"Enter a name for this snapshot to easily identify it later.",inputLabel:"Snapshot Name",initialValue:`Snapshot ${new Date().toLocaleString()}`});q&&await l(q)},U=q=>{const G=document.getElementById(`chapter-${q}`);G&&G.scrollIntoView({behavior:"smooth",block:"start"})},V=()=>{const q=e.content.map(G=>{const ee=document.createElement("div");return ee.innerHTML=G.htmlContent,ee.textContent||""}).join(`

`);navigator.clipboard.writeText(q).then(()=>{te.success("Full book text copied to clipboard!")}).catch(()=>{te.error("Failed to copy text.")})};return d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-lg shadow-md border border-zinc-200 dark:border-zinc-700 overflow-hidden flex flex-col",children:[d.jsxs("div",{className:"p-5 border-b border-zinc-100 dark:border-zinc-700/50 bg-zinc-50/50 dark:bg-zinc-800/50",children:[d.jsxs("h2",{className:"text-lg font-bold text-zinc-800 dark:text-zinc-100 mb-4 flex items-center",children:[d.jsx(H,{name:"GRID",className:"w-5 h-5 mr-2 text-indigo-500"}),"Project Status"]}),d.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[d.jsxs("div",{className:"bg-white dark:bg-zinc-700/50 p-2.5 rounded-lg border border-zinc-200 dark:border-zinc-700",children:[d.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-1",children:"Words"}),d.jsx("p",{className:"text-lg font-bold text-zinc-800 dark:text-zinc-100",children:M.toLocaleString()})]}),d.jsxs("div",{className:"bg-white dark:bg-zinc-700/50 p-2.5 rounded-lg border border-zinc-200 dark:border-zinc-700",children:[d.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-1",children:"Reading Time"}),d.jsx("p",{className:"text-lg font-bold text-zinc-800 dark:text-zinc-100",children:P})]}),d.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-2.5 rounded-lg border border-indigo-100 dark:border-indigo-900/30",children:[d.jsx("p",{className:"text-xs text-indigo-600 dark:text-indigo-300 uppercase tracking-wide mb-1",children:"Session"}),d.jsxs("p",{className:"text-lg font-bold text-indigo-700 dark:text-indigo-200",children:["+",g.toLocaleString()]})]}),d.jsxs("div",{className:"bg-white dark:bg-zinc-700/50 p-2.5 rounded-lg border border-zinc-200 dark:border-zinc-700",children:[d.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-1",children:"Goal"}),d.jsxs("p",{className:"text-lg font-bold text-zinc-800 dark:text-zinc-100",children:[_,"%"]})]})]}),d.jsx("div",{className:"space-y-2",children:d.jsxs("div",{className:"relative pt-1",children:[d.jsxs("div",{className:"flex mb-1 items-center justify-between",children:[d.jsx("span",{className:"text-xs font-semibold text-zinc-600 dark:text-zinc-300 py-1",children:"Chapter Completion"}),d.jsxs("span",{className:"text-xs font-semibold text-zinc-600 dark:text-zinc-300 py-1",children:[S,"/",w]})]}),d.jsx("div",{className:"overflow-hidden h-2 mb-1 text-xs flex rounded-full bg-zinc-200 dark:bg-zinc-700",children:d.jsx("div",{style:{width:`${C}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-indigo-500 transition-all duration-500"})})]})})]}),d.jsxs("div",{className:"p-5 space-y-6 flex-grow flex flex-col",children:[f&&!N?d.jsxs("div",{className:"space-y-2",children:[d.jsx("button",{onClick:()=>s(),disabled:u!==null,className:"w-full bg-indigo-600 text-white px-4 py-3 rounded-lg shadow-md font-bold hover:bg-indigo-700 transition-all transform active:scale-[0.98] disabled:bg-indigo-400 dark:disabled:bg-indigo-900 disabled:cursor-not-allowed flex items-center justify-center space-x-2 border border-transparent",children:u?d.jsxs(d.Fragment,{children:[d.jsx(H,{name:"ROTATE_CW",className:"animate-spin w-5 h-5"}),d.jsx("span",{children:"Writing..."})]}):d.jsxs(d.Fragment,{children:[d.jsx(H,{name:"WAND",className:"w-5 h-5"}),d.jsx("span",{children:"Write Next Chapter"})]})}),d.jsx("button",{onClick:()=>i(),disabled:u!==null,className:"w-full text-xs font-medium text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 hover:underline py-1 transition-colors text-center",children:"Auto-Generate Remaining Chapters"})]}):N&&d.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-100 dark:border-emerald-900 rounded-lg p-4 text-center",children:[d.jsx(H,{name:"SPARKLES",className:"w-8 h-8 mx-auto text-emerald-500 mb-2"}),d.jsx("p",{className:"text-emerald-700 dark:text-emerald-400 font-bold",children:"Book Draft Complete!"}),d.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-500 mt-1",children:"Time to edit and polish."})]}),d.jsxs("div",{className:"border border-zinc-200 dark:border-zinc-700 rounded-lg overflow-hidden flex-grow max-h-64 flex flex-col",children:[d.jsx("div",{className:"bg-zinc-50 dark:bg-zinc-900/50 px-3 py-2 border-b border-zinc-200 dark:border-zinc-700 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider flex-shrink-0",children:"Outline"}),d.jsx("ul",{className:"overflow-y-auto bg-white dark:bg-zinc-800 divide-y divide-zinc-100 dark:divide-zinc-700/50 flex-grow",children:e.outline.map((q,G)=>{const ee=G<S;return d.jsxs("li",{onClick:()=>ee&&U(G),className:`px-3 py-2 flex items-center space-x-3 text-sm transition-colors ${ee?"cursor-pointer hover:bg-zinc-50 dark:hover:bg-zinc-700/50":"opacity-50 cursor-default"}`,children:[d.jsx("span",{className:`flex-shrink-0 w-5 h-5 flex items-center justify-center rounded-full text-[10px] font-medium ${ee?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900 dark:text-emerald-300":"bg-zinc-100 text-zinc-500 dark:bg-zinc-700"}`,children:ee?"":G+1}),d.jsx("span",{className:`truncate flex-grow ${ee?"text-zinc-700 dark:text-zinc-200":"text-zinc-500 dark:text-zinc-500"}`,children:q.title})]},G)})})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-3",children:"Tools & Export"}),d.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[d.jsxs("button",{onClick:D,className:"flex flex-col items-center justify-center p-2 rounded-lg bg-zinc-50 dark:bg-zinc-700/30 hover:bg-zinc-100 dark:hover:bg-zinc-700 border border-zinc-200 dark:border-zinc-700 transition-all group",title:"Create Snapshot",children:[d.jsx(H,{name:"SAVE",className:"w-5 h-5 text-zinc-600 dark:text-zinc-400 group-hover:text-indigo-500 mb-1"}),d.jsx("span",{className:"text-[10px] font-medium text-zinc-600 dark:text-zinc-300",children:"Snap"})]}),d.jsxs("button",{onClick:()=>r(!0),className:"flex flex-col items-center justify-center p-2 rounded-lg bg-zinc-50 dark:bg-zinc-700/30 hover:bg-zinc-100 dark:hover:bg-zinc-700 border border-zinc-200 dark:border-zinc-700 transition-all group",title:"View History",children:[d.jsxs("div",{className:"relative",children:[d.jsx(H,{name:"HISTORY",className:"w-5 h-5 text-zinc-600 dark:text-zinc-400 group-hover:text-indigo-500 mb-1"}),t.length>0&&d.jsx("span",{className:"absolute -top-1 -right-1 bg-indigo-500 text-[8px] w-3 h-3 flex items-center justify-center rounded-full text-white",children:t.length})]}),d.jsx("span",{className:"text-[10px] font-medium text-zinc-600 dark:text-zinc-300",children:"History"})]}),d.jsxs("button",{onClick:o,className:"flex flex-col items-center justify-center p-2 rounded-lg bg-zinc-50 dark:bg-zinc-700/30 hover:bg-zinc-100 dark:hover:bg-zinc-700 border border-zinc-200 dark:border-zinc-700 transition-all group",title:"Export PDF",children:[d.jsx(H,{name:"DOWNLOAD",className:"w-5 h-5 text-zinc-600 dark:text-zinc-400 group-hover:text-indigo-500 mb-1"}),d.jsx("span",{className:"text-[10px] font-medium text-zinc-600 dark:text-zinc-300",children:"PDF"})]}),d.jsxs("button",{onClick:()=>a(!0),className:"flex flex-col items-center justify-center p-2 rounded-lg bg-zinc-50 dark:bg-zinc-700/30 hover:bg-zinc-100 dark:hover:bg-zinc-700 border border-zinc-200 dark:border-zinc-700 transition-all group",title:"Export ePub",children:[d.jsx(H,{name:"BOOK",className:"w-5 h-5 text-zinc-600 dark:text-zinc-400 group-hover:text-indigo-500 mb-1"}),d.jsx("span",{className:"text-[10px] font-medium text-zinc-600 dark:text-zinc-300",children:"ePub"})]})]}),d.jsxs("button",{onClick:V,className:"w-full mt-3 flex items-center justify-center space-x-2 p-2 rounded-lg bg-zinc-50 dark:bg-zinc-700/30 hover:bg-zinc-100 dark:hover:bg-zinc-700 border border-zinc-200 dark:border-zinc-700 transition-all text-xs font-medium text-zinc-600 dark:text-zinc-300 hover:text-indigo-600 dark:hover:text-indigo-300",children:[d.jsx(H,{name:"COPY",className:"w-4 h-4"}),d.jsx("span",{children:"Copy Full Text"})]})]}),d.jsxs("button",{onClick:n,className:"w-full bg-zinc-800 dark:bg-zinc-100 text-zinc-100 dark:text-zinc-900 px-4 py-3 rounded-lg font-bold shadow-sm hover:bg-zinc-700 dark:hover:bg-zinc-200 transition-colors flex items-center justify-center space-x-2 mt-auto",children:[d.jsx(H,{name:"SAVE",className:"w-5 h-5"}),d.jsx("span",{children:"Save & Exit"})]})]})]})},Koe=({status:n})=>{const[e,t]=T.useState("idle"),[s,i]=T.useState(null),[r,o]=T.useState("");T.useEffect(()=>U3(g=>{t(g.status),i(g.lastBackupTimestamp)}),[]),T.useEffect(()=>{if(!s){o("");return}const p=()=>{if(!s){o("");return}const b=Date.now(),w=Math.round((b-s)/1e3);w<10?o("just now"):w<60?o(`${w}s ago`):w<3600?o(`${Math.floor(w/60)}m ago`):w<86400?o(`${Math.floor(w/3600)}h ago`):o(`${Math.floor(w/86400)}d ago`)};p();const g=setInterval(p,5e3);return()=>clearInterval(g)},[s]);const a=()=>{switch(n){case"saving":return{icon:"ROTATE_CW",text:"Saving...",className:"animate-spin text-indigo-500 dark:text-indigo-400"};case"unsaved":return{icon:"EDIT",text:"Unsaved changes",className:"text-amber-600 dark:text-amber-400"};case"saved":switch(e){case"syncing":return{icon:"ROTATE_CW",text:"Backing up...",className:"animate-spin text-indigo-500 dark:text-indigo-400"};case"synced":return{icon:"CLOUD_CHECK",text:`Saved & backed up ${r}`,className:"text-emerald-600 dark:text-emerald-400"};case"failed":return{icon:"CLOUD_OFF",text:"Save OK, backup failed",className:"text-red-500 dark:text-red-400"};case"disabled":return{icon:"CLOUD_CHECK",text:"Saved locally",className:"text-emerald-600 dark:text-emerald-400"};case"idle":default:return{icon:"CLOUD_CHECK",text:"All changes saved",className:"text-emerald-600 dark:text-emerald-400"}}default:return{icon:"EDIT",text:"Unsaved changes",className:"text-amber-600 dark:text-amber-400"}}},{icon:l,text:u,className:f}=a();return d.jsxs("div",{className:"flex items-center space-x-2 text-sm transition-all duration-300 p-2 rounded-lg bg-zinc-100 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-700",children:[d.jsx(H,{name:l,className:`w-4 h-4 ${f}`}),d.jsx("span",{className:`font-medium ${f}`,children:u})]})},Yoe=()=>{const{book:n}=Xt(),[e,t]=T.useState(!1);if(!n||!n.creationConfig)return null;const{creationConfig:s}=n,i=r=>typeof r=="boolean"?r?"Yes":"No":typeof r>"u"||r===null||r===""?d.jsx("span",{className:"italic text-zinc-400 dark:text-zinc-500",children:"Not set"}):r.toString();return d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-zinc-200 dark:border-zinc-700 overflow-hidden transition-all duration-200 hover:shadow-md",children:[d.jsxs("button",{onClick:()=>t(!e),className:"w-full flex items-center justify-between p-4 hover:bg-zinc-50 dark:hover:bg-zinc-700/30 transition-colors group",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"p-2 bg-teal-100 dark:bg-teal-900/30 rounded-lg text-teal-600 dark:text-teal-400 group-hover:scale-110 transition-transform",children:d.jsx(H,{name:"SETTINGS",className:"w-4 h-4"})}),d.jsx("span",{className:"font-semibold text-zinc-800 dark:text-zinc-100 text-sm",children:"Generation Config"})]}),d.jsx(H,{name:"CHEVRON_LEFT",className:`w-4 h-4 text-zinc-400 transform transition-transform duration-300 ${e?"-rotate-90":"rotate-0"}`})]}),e&&d.jsxs("div",{className:"p-4 pt-0 space-y-3 border-t border-zinc-100 dark:border-zinc-700/50 animate-slide-in-down bg-zinc-50/50 dark:bg-zinc-900/30",children:[d.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"text-[10px] font-bold text-zinc-400 dark:text-zinc-500 uppercase tracking-wider mb-1",children:"Original Topic"}),d.jsx("p",{className:"text-xs font-medium text-zinc-800 dark:text-zinc-200 truncate",title:s.topic,children:s.topic})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-[10px] font-bold text-zinc-400 dark:text-zinc-500 uppercase tracking-wider mb-1",children:"Goal"}),d.jsxs("p",{className:"text-xs font-medium text-zinc-800 dark:text-zinc-200",children:[i(s.wordCountGoal)," words"]})]})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-[10px] font-bold text-zinc-400 dark:text-zinc-500 uppercase tracking-wider mb-1",children:"Instructions"}),d.jsx("div",{className:"text-xs text-zinc-600 dark:text-zinc-400 p-2 bg-white dark:bg-zinc-800 border border-zinc-100 dark:border-zinc-700 rounded-md max-h-20 overflow-y-auto scrollbar-thin",children:s.instructions})]}),s.generateImages&&d.jsxs("div",{children:[d.jsx("h4",{className:"text-[10px] font-bold text-zinc-400 dark:text-zinc-500 uppercase tracking-wider mb-1",children:"Image Style"}),d.jsx("div",{className:"text-xs text-zinc-600 dark:text-zinc-400 p-2 bg-white dark:bg-zinc-800 border border-zinc-100 dark:border-zinc-700 rounded-md max-h-20 overflow-y-auto scrollbar-thin",children:s.imageGenerationInstructions})]})]})]})},Joe=()=>{const[n,e]=T.useState(!1),[t,s]=T.useState(""),[i,r]=T.useState(!1),[o,a]=T.useState(null),[l,u]=T.useState(""),f=async p=>{if(p.preventDefault(),!!t.trim()){r(!0),u(""),a(null);try{const g=await fY(t);a(g)}catch(g){const b=g.message||"An error occurred during research.";u(b),te.error(b)}finally{r(!1)}}};return d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-zinc-200 dark:border-zinc-700 overflow-hidden transition-all duration-200 hover:shadow-md",children:[d.jsxs("button",{onClick:()=>e(!n),className:"w-full flex items-center justify-between p-4 hover:bg-zinc-50 dark:hover:bg-zinc-700/30 transition-colors group",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"p-2 bg-sky-100 dark:bg-sky-900/30 rounded-lg text-sky-600 dark:text-sky-400 group-hover:scale-110 transition-transform",children:d.jsx(H,{name:"SEARCH",className:"w-4 h-4"})}),d.jsx("span",{className:"font-semibold text-zinc-800 dark:text-zinc-100 text-sm",children:"Research Assistant"})]}),d.jsx(H,{name:"CHEVRON_LEFT",className:`w-4 h-4 text-zinc-400 transform transition-transform duration-300 ${n?"-rotate-90":"rotate-0"}`})]}),n&&d.jsxs("div",{className:"p-4 pt-0 space-y-4 border-t border-zinc-100 dark:border-zinc-700/50 animate-slide-in-down bg-zinc-50/50 dark:bg-zinc-900/30",children:[d.jsxs("form",{onSubmit:f,className:"flex gap-2 mt-4",children:[d.jsx("input",{type:"text",value:t,onChange:p=>s(p.target.value),placeholder:"Ask a question...",className:"flex-grow w-full text-sm bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all",disabled:i}),d.jsx("button",{type:"submit",className:"bg-indigo-600 text-white px-3 py-2 rounded-lg shadow-sm font-semibold hover:bg-indigo-700 transition-colors disabled:bg-indigo-400 text-sm flex-shrink-0",disabled:i||!t.trim(),children:i?d.jsx(H,{name:"ROTATE_CW",className:"w-4 h-4 animate-spin"}):"Ask"})]}),l&&d.jsx("p",{className:"text-red-500 text-xs p-2 bg-red-50 dark:bg-red-900/20 rounded-md border border-red-100 dark:border-red-900",children:l}),o&&d.jsxs("div",{className:"space-y-3",children:[d.jsx("div",{className:"p-3 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg max-h-60 overflow-y-auto shadow-sm",children:d.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 whitespace-pre-wrap leading-relaxed",children:o.text})}),o.sources.length>0&&d.jsxs("div",{className:"bg-zinc-100 dark:bg-zinc-700/30 p-2 rounded-md",children:[d.jsx("h4",{className:"font-bold text-[10px] text-zinc-500 dark:text-zinc-400 uppercase mb-1.5 tracking-wider",children:"Sources"}),d.jsx("ul",{className:"space-y-1",children:o.sources.map((p,g)=>d.jsx("li",{className:"truncate",children:d.jsxs("a",{href:p.web.uri,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline dark:text-blue-400 flex items-center",children:[d.jsx(H,{name:"LINK",className:"w-3 h-3 mr-1.5 flex-shrink-0 opacity-70"}),d.jsx("span",{className:"truncate",children:p.web.title||p.web.uri})]})},g))})]})]})]})]})},Xoe=()=>{const{book:n,setIsKnowledgeBaseOpen:e}=Xt();if(!n)return null;const t=n.knowledgeBase?n.knowledgeBase.length:0;return d.jsx("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-zinc-200 dark:border-zinc-700 overflow-hidden transition-all duration-200 hover:shadow-md hover:border-violet-200 dark:hover:border-violet-900/50 group",children:d.jsxs("button",{onClick:()=>e(!0),className:"w-full flex items-center justify-between p-4 hover:bg-zinc-50 dark:hover:bg-zinc-700/30 transition-colors",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"p-2 bg-violet-100 dark:bg-violet-900/30 rounded-lg text-violet-600 dark:text-violet-400 group-hover:scale-110 transition-transform",children:d.jsx(H,{name:"BRAIN",className:"w-4 h-4"})}),d.jsxs("div",{className:"text-left",children:[d.jsx("span",{className:"block font-semibold text-zinc-800 dark:text-zinc-100 text-sm",children:"Knowledge Base"}),d.jsxs("span",{className:"block text-xs text-zinc-500 dark:text-zinc-400 mt-0.5",children:[t," ",t===1?"entry":"entries"," defined"]})]})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[t===0&&d.jsx("span",{className:"text-[10px] font-bold text-violet-600 bg-violet-50 dark:bg-violet-900/20 px-2 py-1 rounded-full",children:"SETUP"}),d.jsx(H,{name:"CHEVRON_RIGHT",className:"w-4 h-4 text-zinc-300 group-hover:text-violet-500 transition-colors"})]})]})})},Qoe={Kore:"Female  Calm & Soothing",Puck:"Male  Playful & Expressive",Charon:"Male  Deep & Authoritative",Fenrir:"Male  Intense & Gripping",Zephyr:"Female  Gentle & Soft"},Zoe=()=>{var D,U;const{book:n,activeChapterIndex:e,geminiTTSVoices:t,audiobookState:s,handlePlayFullBook:i,handlePlayChapter:r,handleSetVoice:o,handlePauseAudiobook:a,handleResumeAudiobook:l,handleStopAudiobook:u,handleSkipChapter:f,handleDownloadAudiobook:p}=Xt(),[g,b]=T.useState(!0);if(!n)return null;const{selectedVoiceName:w,isPlaying:S,isPaused:N,isLoading:C,currentChapterIndex:M,progress:R}=s,_=S||N||C,j=((U=(D=n.content[e])==null?void 0:D.htmlContent)==null?void 0:U.trim().length)>0,P=n==null?void 0:n.outline[M];return d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-zinc-200 dark:border-zinc-700 overflow-hidden transition-all duration-200 hover:shadow-md hover:border-fuchsia-200 dark:hover:border-fuchsia-900/50 group",children:[d.jsxs("button",{onClick:()=>b(!g),className:"w-full flex items-center justify-between p-4 hover:bg-zinc-50 dark:hover:bg-zinc-700/30 transition-colors",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"p-2 bg-fuchsia-100 dark:bg-fuchsia-900/30 rounded-lg text-fuchsia-600 dark:text-fuchsia-400 group-hover:scale-110 transition-transform",children:d.jsx(H,{name:"HEADPHONES",className:"w-4 h-4"})}),d.jsx("span",{className:"font-semibold text-zinc-800 dark:text-zinc-100 text-sm",children:"Audiobook"})]}),d.jsx(H,{name:"CHEVRON_LEFT",className:`w-4 h-4 text-zinc-400 transform transition-transform duration-300 ${g?"-rotate-90":"rotate-0"}`})]}),g&&d.jsx("div",{className:"p-4 pt-0 space-y-4 border-t border-zinc-100 dark:border-zinc-700/50 animate-slide-in-down bg-zinc-50/50 dark:bg-zinc-900/30",children:_?d.jsxs("div",{className:"space-y-4 mt-4",children:[d.jsxs("div",{className:"bg-white dark:bg-zinc-800 p-3 rounded-lg border border-zinc-200 dark:border-zinc-700 shadow-sm",children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-indigo-600 dark:text-indigo-400",children:C?"Buffering...":S?"Now Playing":"Paused"}),S&&d.jsxs("div",{className:"flex space-x-0.5 h-3 items-end",children:[d.jsx("div",{className:"w-1 bg-indigo-500 animate-music-bar-1 h-full"}),d.jsx("div",{className:"w-1 bg-indigo-500 animate-music-bar-2 h-2"}),d.jsx("div",{className:"w-1 bg-indigo-500 animate-music-bar-3 h-3"})]})]}),d.jsx("p",{className:"font-semibold text-sm text-zinc-800 dark:text-zinc-100 truncate",title:P==null?void 0:P.title,children:(P==null?void 0:P.title)||"Audiobook"}),d.jsx("div",{className:"w-full bg-zinc-200 dark:bg-zinc-700 rounded-full h-1.5 mt-3 overflow-hidden",children:d.jsx("div",{className:"bg-indigo-500 h-full rounded-full transition-all duration-300 ease-linear",style:{width:`${R}%`}})})]}),d.jsxs("div",{className:"flex items-center justify-between px-4",children:[d.jsx("button",{onClick:()=>f("prev"),className:"text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200 transition-colors",title:"Previous Chapter",children:d.jsx(H,{name:"SKIP_BACK",className:"w-5 h-5"})}),d.jsx("button",{onClick:S?a:l,className:"w-12 h-12 flex items-center justify-center bg-indigo-600 text-white rounded-full shadow-md hover:bg-indigo-700 transition-transform hover:scale-105 active:scale-95",title:S?"Pause":"Play",children:d.jsx(H,{name:S?"PAUSE":"PLAY",className:"w-6 h-6 fill-current"})}),d.jsx("button",{onClick:()=>f("next"),className:"text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200 transition-colors",title:"Next Chapter",children:d.jsx(H,{name:"SKIP_FORWARD",className:"w-5 h-5"})})]}),d.jsx("button",{onClick:u,className:"w-full py-2 text-xs text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors font-medium",children:"Stop Playback"})]}):d.jsxs("div",{className:"space-y-4 mt-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-[10px] font-bold text-zinc-400 dark:text-zinc-500 uppercase tracking-wide mb-2",children:"Narrator Voice"}),d.jsx("div",{className:"grid grid-cols-1 gap-2",children:t.map(V=>{const q=w===V;return d.jsxs("button",{onClick:()=>o(V),className:`flex items-center justify-between p-3 rounded-lg border text-left transition-all ${q?"bg-white dark:bg-zinc-800 border-indigo-500 ring-1 ring-indigo-500 shadow-sm":"bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 hover:border-indigo-300 dark:hover:border-indigo-700 hover:bg-zinc-50 dark:hover:bg-zinc-700/50"}`,children:[d.jsxs("div",{children:[d.jsx("span",{className:`block text-sm font-bold ${q?"text-indigo-600 dark:text-indigo-400":"text-zinc-700 dark:text-zinc-300"}`,children:V}),d.jsx("span",{className:"block text-[10px] text-zinc-500 dark:text-zinc-400",children:Qoe[V]||"Standard Voice"})]}),q&&d.jsx("div",{className:"w-2 h-2 bg-indigo-500 rounded-full shadow-sm"})]},V)})})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2",children:[d.jsxs("button",{onClick:()=>r(e),disabled:!j,className:"flex flex-col items-center justify-center p-3 rounded-lg bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-700/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed group",children:[d.jsx(H,{name:"PLAY",className:"w-5 h-5 text-zinc-400 dark:text-zinc-500 mb-1 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors"}),d.jsx("span",{className:"text-xs font-semibold text-zinc-600 dark:text-zinc-300",children:"Current Chapter"})]}),d.jsxs("button",{onClick:i,className:"flex flex-col items-center justify-center p-3 rounded-lg bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-700/50 transition-colors group",children:[d.jsx(H,{name:"HEADPHONES",className:"w-5 h-5 text-zinc-400 dark:text-zinc-500 mb-1 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors"}),d.jsx("span",{className:"text-xs font-semibold text-zinc-600 dark:text-zinc-300",children:"Full Book"})]})]}),d.jsxs("button",{onClick:()=>p(void 0),className:"w-full flex justify-center items-center space-x-2 py-2.5 rounded-lg border border-zinc-300 dark:border-zinc-600 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-700 transition-colors text-xs font-semibold",children:[d.jsx(H,{name:"DOWNLOAD",className:"w-3 h-3"}),d.jsx("span",{children:"Advanced Download Options..."})]})]})})]})},eae=()=>{const{book:n}=Xt(),{books:e,series:t,reorderBooksInSeries:s,removeBookFromSeries:i}=T.useContext(rs),r=Es(),[o,a]=T.useState(null),[l,u]=T.useState(null),f=T.useMemo(()=>{if(!(n!=null&&n.seriesId))return null;const C=t.find(_=>_.id===n.seriesId);if(!C)return null;const M=new Map(e.map(_=>[_.id,_])),R=C.bookIds.map(_=>M.get(_)).filter(_=>_!==void 0);return{...C,books:R}},[n,e,t]);if(!f)return null;const p=(C,M)=>{C.dataTransfer.setData("text/plain",M.toString()),a(M)},g=()=>{a(null),u(null)},b=(C,M)=>{C.preventDefault(),o!==null&&o!==M&&u(M)},w=(C,M)=>{C.preventDefault(),o!==null&&(o!==M&&s(f.id,o,M),g())},S=C=>C===o?"opacity-30":C===l?o===null||C<o?"border-t-2 border-indigo-500":"border-b-2 border-indigo-500":"",N=async()=>{if(!n)return;await Mn.confirm({title:"Remove from Series?",message:`Are you sure you want to remove "${n.topic}" from the "${f.title}" series? If only one book remains, the series will be dissolved.`,confirmText:"Remove",danger:!0})&&i(n.id)};return d.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md border border-gray-200 dark:border-gray-700",children:[d.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2 overflow-hidden",children:[d.jsx(H,{name:"LINK",className:"w-5 h-5 text-gray-400 flex-shrink-0"}),d.jsxs("span",{className:"truncate",title:`Series: ${f.title}`,children:["Series: ",f.title]})]}),d.jsx("ul",{className:"space-y-1",children:f.books.map((C,M)=>{const R=C.id===(n==null?void 0:n.id);return d.jsxs("li",{draggable:!0,onDragStart:_=>p(_,M),onDragEnd:g,onDragOver:_=>b(_,M),onDragLeave:()=>u(null),onDrop:_=>w(_,M),className:`group transition-all duration-150 rounded-md cursor-grab active:cursor-grabbing flex items-center ${S(M)}`,children:[d.jsxs("button",{onClick:()=>r(`/editor/${C.id}`),disabled:R,className:`w-full text-left flex items-start space-x-3 p-2 rounded-md transition-colors text-sm ${R?"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-200 font-semibold":"text-zinc-600 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700"}`,children:[d.jsxs("span",{className:"flex-shrink-0 mt-0.5 w-5 text-center font-mono text-xs",children:[M+1,"."]}),d.jsx("span",{className:"flex-grow truncate",children:C.topic})]}),R&&d.jsx("button",{onClick:N,title:"Remove from series",className:"p-1 rounded-full text-zinc-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-zinc-700 opacity-0 group-hover:opacity-100 transition-opacity ml-1 flex-shrink-0",children:d.jsx(H,{name:"CLOSE",className:"w-4 h-4"})})]},C.id)})})]})},tae=()=>{const{book:n,macros:e,handleRunMacro:t}=Xt();return!n||e.length===0?null:d.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md border border-gray-200 dark:border-gray-700",children:[d.jsx("h2",{className:"text-xl font-bold mb-4",children:"Run Workflow Macro"}),d.jsx("div",{className:"space-y-2",children:e.map(s=>d.jsxs("button",{onClick:()=>t(s.id),className:"w-full flex items-center justify-between text-left p-3 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[d.jsx("span",{className:"font-semibold",children:s.name}),d.jsx(H,{name:"PLAY",className:"w-5 h-5 text-gray-500 dark:text-gray-400"})]},s.id))})]})},nae=()=>{const{book:n,imageSuggestions:e,openImageSuggestionModal:t}=Xt(),[s,i]=T.useState(!0);if(!n||!e||e.length===0)return null;const r=o=>{const a=document.querySelector(`span[data-suggestion-id="${o}"]`);if(a){a.scrollIntoView({behavior:"smooth",block:"center"});const l=a.style.backgroundColor;a.style.transition="background-color 0.5s ease-in-out",a.style.backgroundColor="rgba(79, 70, 229, 0.3)",setTimeout(()=>{a.style.backgroundColor=l},1500)}};return d.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md border border-gray-200 dark:border-gray-700",children:[d.jsxs("button",{onClick:()=>i(!s),className:"w-full text-left font-bold text-xl flex justify-between items-center text-gray-800 dark:text-gray-100",children:[d.jsxs("span",{className:"flex items-center space-x-2",children:[d.jsx(H,{name:"IMAGE",className:"w-6 h-6"}),d.jsxs("span",{children:["Image Suggestions (",e.length,")"]})]}),d.jsx(H,{name:"CHEVRON_LEFT",className:`w-6 h-6 transform transition-transform duration-300 ${s?"rotate-180":"rotate-0"}`})]}),s&&d.jsx("div",{className:"mt-4 space-y-3 max-h-64 overflow-y-auto pr-2 -mr-2 animate-fade-in",children:e.map(o=>{const a=n.outline[o.chapterIndex];return d.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-700",children:[d.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 cursor-pointer hover:underline",onClick:()=>r(o.id),title:"Click to jump to location",children:["In Chapter ",o.chapterIndex+1,': "',(a==null?void 0:a.title)||"Unknown Chapter",'"']}),d.jsx("p",{className:"mt-2 text-xs font-mono p-2 bg-white dark:bg-gray-800 rounded-md",children:o.prompt}),d.jsx("div",{className:"mt-2 flex justify-end",children:d.jsx("button",{onClick:()=>t(o),className:"px-3 py-1 text-xs font-semibold rounded-md bg-indigo-600 text-white hover:bg-indigo-700 transition-colors",children:"Generate..."})})]},o.id)})})]})},sae=()=>{const{activeEditorInstance:n}=Xt(),[e,t]=T.useState(!1),[s,i]=T.useState(""),[r,o]=T.useState(""),[a,l]=T.useState([]),[u,f]=T.useState(0),p=()=>{if(!n||!s){l([]);return}const C=[];n.state.doc.descendants((M,R)=>{if(M.isText&&M.text){const _=M.text,j=new RegExp(s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");let P;for(;(P=j.exec(_))!==null;)C.push({from:R+P.index,to:R+P.index+P[0].length})}}),l(C),f(0),C.length>0?g(C[0]):te.info("No matches found.")},g=C=>{n&&(n.commands.setTextSelection({from:C.from,to:C.to}),n.commands.scrollIntoView())},b=()=>{if(a.length===0)return;const C=(u+1)%a.length;f(C),g(a[C])},w=()=>{if(a.length===0)return;const C=(u-1+a.length)%a.length;f(C),g(a[C])},S=()=>{if(!n||a.length===0)return;const C=a[u];n.commands.insertContentAt({from:C.from,to:C.to},r),p()},N=()=>{if(!n||!s)return;const C=[];if(n.state.doc.descendants((R,_)=>{if(R.isText&&R.text){const j=R.text,P=new RegExp(s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");let D;for(;(D=P.exec(j))!==null;)C.push({from:_+D.index,to:_+D.index+D[0].length})}}),C.length===0){te.info("No matches found.");return}let M=n.state.tr;for(let R=C.length-1;R>=0;R--){const _=C[R];M=M.replaceWith(_.from,_.to,n.schema.text(r))}n.view.dispatch(M),l([]),te.success(`Replaced ${C.length} occurrences.`)};return n?d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-zinc-200 dark:border-zinc-700 overflow-hidden transition-all duration-200 hover:shadow-md hover:border-indigo-200 dark:hover:border-indigo-900/50",children:[d.jsxs("button",{onClick:()=>t(!e),className:"w-full flex items-center justify-between p-4 hover:bg-zinc-50 dark:hover:bg-zinc-700/30 transition-colors",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"p-2 bg-indigo-50 dark:bg-indigo-900/30 rounded-lg text-indigo-600 dark:text-indigo-400",children:d.jsx(H,{name:"SEARCH_REPLACE",className:"w-4 h-4"})}),d.jsx("span",{className:"font-semibold text-zinc-800 dark:text-zinc-100 text-sm",children:"Find & Replace"})]}),d.jsx(H,{name:"CHEVRON_LEFT",className:`w-4 h-4 text-zinc-400 transform transition-transform duration-300 ${e?"-rotate-90":"rotate-0"}`})]}),e&&d.jsx("div",{className:"p-4 pt-0 space-y-3 border-t border-zinc-100 dark:border-zinc-700/50 animate-slide-in-down bg-zinc-50/50 dark:bg-zinc-900/30",children:d.jsxs("div",{className:"flex flex-col space-y-2 mt-2",children:[d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{type:"text",value:s,onChange:C=>i(C.target.value),onKeyDown:C=>C.key==="Enter"&&p(),placeholder:"Find...",className:"flex-grow text-sm bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded-md px-2 py-1.5 focus:ring-1 focus:ring-indigo-500"}),d.jsx("button",{onClick:p,className:"px-3 py-1.5 bg-zinc-200 dark:bg-zinc-700 rounded-md text-xs font-semibold hover:bg-zinc-300 dark:hover:bg-zinc-600",children:"Find"})]}),d.jsx("div",{className:"flex gap-2",children:d.jsx("input",{type:"text",value:r,onChange:C=>o(C.target.value),placeholder:"Replace with...",className:"flex-grow text-sm bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded-md px-2 py-1.5 focus:ring-1 focus:ring-indigo-500"})}),a.length>0&&d.jsxs("div",{className:"flex items-center justify-between text-xs text-zinc-500 mt-1",children:[d.jsxs("span",{children:[u+1," / ",a.length]}),d.jsxs("div",{className:"flex space-x-1",children:[d.jsx("button",{onClick:w,className:"p-1 hover:bg-zinc-200 dark:hover:bg-zinc-700 rounded",children:d.jsx(H,{name:"CHEVRON_LEFT",className:"w-3 h-3"})}),d.jsx("button",{onClick:b,className:"p-1 hover:bg-zinc-200 dark:hover:bg-zinc-700 rounded",children:d.jsx(H,{name:"CHEVRON_RIGHT",className:"w-3 h-3"})})]})]}),d.jsxs("div",{className:"flex gap-2 pt-2",children:[d.jsx("button",{onClick:S,disabled:a.length===0,className:"flex-1 py-1.5 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded-md text-xs font-semibold hover:bg-indigo-200 dark:hover:bg-indigo-800 disabled:opacity-50",children:"Replace"}),d.jsx("button",{onClick:N,className:"flex-1 py-1.5 bg-indigo-600 text-white rounded-md text-xs font-semibold hover:bg-indigo-700 disabled:opacity-50",children:"Replace All"})]})]})})]}):null},iae=({isOpen:n,onClose:e})=>{const{customPersonas:t,addCustomPersona:s,deleteCustomPersona:i}=Xt(),[r,o]=T.useState("list"),[a,l]=T.useState(""),[u,f]=T.useState(""),[p,g]=T.useState("");if(!n)return null;const b=async()=>{if(!a.trim()||!p.trim()){te.error("Please provide a name and instructions.");return}await s({name:a.trim(),description:u.trim(),instructions:p.trim()}),S(),o("list")},w=async N=>{await i(N)},S=()=>{l(""),f(""),g("")};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[200] p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl p-6 w-full max-w-lg flex flex-col border border-zinc-200 dark:border-zinc-700 max-h-[85vh]",onClick:N=>N.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-zinc-200 dark:border-zinc-700",children:[d.jsxs("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100 flex items-center gap-2",children:[d.jsx(H,{name:"USER",className:"w-6 h-6 text-purple-500"}),"Manage Custom Personas"]}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700","aria-label":"Close",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),r==="list"?d.jsx("div",{className:"flex-grow overflow-y-auto pr-2",children:t.length===0?d.jsx("p",{className:"text-center text-zinc-500 py-8",children:"No custom personas created yet."}):d.jsx("div",{className:"space-y-3",children:t.map(N=>d.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-zinc-700/30 rounded-lg border border-zinc-200 dark:border-zinc-700 group relative",children:[d.jsxs("div",{className:"pr-8",children:[d.jsx("h3",{className:"font-bold text-zinc-800 dark:text-zinc-100",children:N.name}),N.description&&d.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mt-1",children:N.description}),d.jsxs("p",{className:"text-xs mt-2 italic text-zinc-600 dark:text-zinc-300 line-clamp-2",children:['"',N.instructions,'"']})]}),d.jsx("button",{onClick:()=>w(N.id),className:"absolute top-2 right-2 p-1.5 text-zinc-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 rounded transition-colors",title:"Delete Persona",children:d.jsx(H,{name:"TRASH",className:"w-4 h-4"})})]},N.id))})}):d.jsxs("div",{className:"flex-grow overflow-y-auto pr-2 space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-bold text-zinc-700 dark:text-zinc-300 mb-1",children:"Persona Name"}),d.jsx("input",{type:"text",value:a,onChange:N=>l(N.target.value),className:"w-full bg-white dark:bg-zinc-700 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 text-sm",placeholder:"e.g. Grumpy Historian"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-bold text-zinc-700 dark:text-zinc-300 mb-1",children:"Short Description (Optional)"}),d.jsx("input",{type:"text",value:u,onChange:N=>f(N.target.value),className:"w-full bg-white dark:bg-zinc-700 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 text-sm",placeholder:"e.g. Focuses on historical accuracy"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-bold text-zinc-700 dark:text-zinc-300 mb-1",children:"Instructions"}),d.jsx("textarea",{value:p,onChange:N=>g(N.target.value),rows:5,className:"w-full bg-white dark:bg-zinc-700 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 text-sm",placeholder:"Describe how the AI should behave. e.g., 'You are a grumpy historian. Correct any anachronisms rudely but accurately.'"})]})]}),d.jsx("div",{className:"mt-6 pt-4 border-t border-zinc-200 dark:border-zinc-700 flex justify-end gap-2",children:r==="list"?d.jsxs("button",{onClick:()=>o("add"),className:"bg-purple-600 text-white px-4 py-2 rounded-lg shadow font-semibold hover:bg-purple-700 transition-colors flex items-center gap-2",children:[d.jsx(H,{name:"PLUS",className:"w-4 h-4"}),"Create New"]}):d.jsxs(d.Fragment,{children:[d.jsx("button",{onClick:()=>o("list"),className:"px-4 py-2 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-100 dark:hover:bg-zinc-700 rounded-lg transition-colors",children:"Cancel"}),d.jsx("button",{onClick:b,className:"bg-green-600 text-white px-4 py-2 rounded-lg shadow font-semibold hover:bg-green-700 transition-colors",children:"Save Persona"})]})})]})})},rae=Object.keys(U0),oae=()=>{const{book:n,handleUpdatePersona:e,isAutocompleteEnabled:t,toggleAutocomplete:s,customPersonas:i}=Xt(),[r,o]=T.useState(!1),[a,l]=T.useState(!1);return n?d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-zinc-200 dark:border-zinc-700 overflow-hidden transition-all duration-200 hover:shadow-md hover:border-purple-200 dark:hover:border-purple-900/50 group",children:[d.jsxs("button",{onClick:()=>o(!r),className:"w-full flex items-center justify-between p-4 hover:bg-zinc-50 dark:hover:bg-zinc-700/30 transition-colors",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg text-purple-600 dark:text-purple-400 group-hover:scale-110 transition-transform",children:d.jsx(H,{name:"SPARKLES",className:"w-4 h-4"})}),d.jsxs("div",{className:"text-left",children:[d.jsx("span",{className:"block font-semibold text-zinc-800 dark:text-zinc-100 text-sm",children:"AI Assistant"}),d.jsx("span",{className:"block text-xs text-zinc-500 dark:text-zinc-400 mt-0.5",children:n.aiPersona||"Standard"})]})]}),d.jsx(H,{name:"CHEVRON_LEFT",className:`w-4 h-4 text-zinc-400 transform transition-transform duration-300 ${r?"-rotate-90":"rotate-0"}`})]}),r&&d.jsxs("div",{className:"p-4 pt-0 space-y-4 border-t border-zinc-100 dark:border-zinc-700/50 animate-slide-in-down bg-zinc-50/50 dark:bg-zinc-900/30",children:[d.jsxs("div",{className:"mt-4",children:[d.jsxs("div",{className:"flex justify-between items-center mb-2",children:[d.jsx("label",{className:"text-xs font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide",children:"AI Persona"}),d.jsxs("button",{onClick:()=>l(!0),className:"text-[10px] font-semibold text-purple-600 dark:text-purple-400 hover:underline flex items-center gap-1",children:[d.jsx(H,{name:"SETTINGS",className:"w-3 h-3"}),"Manage"]})]}),d.jsxs("select",{value:n.aiPersona||"Standard Co-Author",onChange:u=>e(u.target.value),className:"w-full text-sm bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded-lg p-2 focus:ring-purple-500 focus:border-purple-500",children:[d.jsx("optgroup",{label:"Standard Personas",children:rae.map(u=>d.jsx("option",{value:u,children:u},u))}),i.length>0&&d.jsx("optgroup",{label:"Custom Personas",children:i.map(u=>d.jsx("option",{value:u.name,children:u.name},u.id))})]}),d.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:"Changes the tone of chat and analysis."})]}),d.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-zinc-200 dark:border-zinc-700",children:[d.jsxs("div",{children:[d.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200 block",children:"Ghost Text Autocomplete"}),d.jsx("span",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:"Suggest text as you type"})]}),d.jsx("button",{onClick:s,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 ${t?"bg-purple-600":"bg-zinc-200 dark:bg-zinc-700"}`,children:d.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${t?"translate-x-6":"translate-x-1"}`})})]})]}),d.jsx(iae,{isOpen:a,onClose:()=>l(!1)})]}):null},WL=({onSaveAndClose:n})=>{const{book:e,saveStatus:t,isAiEnabled:s,handleAnalyzeCharacterVoice:i,isAnalyzingCharacterVoice:r,handleAnalyzePlotHoles:o,isAnalyzingPlotHoles:a,handleAnalyzeLoreConsistency:l,isAnalyzingLore:u}=Xt();if(!e)return null;const f=e.outline.length>0;return d.jsxs("div",{className:"flex flex-col gap-5 pb-10",children:[!f&&d.jsx(Goe,{}),f&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsx(Koe,{status:t}),d.jsx(Woe,{onSaveAndClose:n})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex items-center space-x-2 px-1 pb-2 border-b border-zinc-200 dark:border-zinc-700/50",children:[d.jsx(H,{name:"COMMAND",className:"w-4 h-4 text-zinc-400"}),d.jsx("h3",{className:"text-xs font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",children:"Project Tools"})]}),d.jsxs("div",{className:"grid gap-4",children:[s&&d.jsx(oae,{}),d.jsx(sae,{}),s&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-zinc-200 dark:border-zinc-700 overflow-hidden transition-all duration-200 hover:shadow-md hover:border-indigo-200 dark:hover:border-indigo-900/50",children:d.jsxs("button",{onClick:i,disabled:r,className:"w-full flex items-center justify-between p-4 hover:bg-zinc-50 dark:hover:bg-zinc-700/30 transition-colors group disabled:opacity-50",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"p-2 bg-indigo-50 dark:bg-indigo-900/30 rounded-lg text-indigo-600 dark:text-indigo-400 group-hover:scale-110 transition-transform",children:d.jsx(H,{name:r?"ROTATE_CW":"USER",className:`w-4 h-4 ${r?"animate-spin":""}`})}),d.jsx("span",{className:"font-semibold text-zinc-800 dark:text-zinc-100 text-sm",children:r?"Analyzing...":"Check Character Voice"})]}),d.jsx(H,{name:"CHEVRON_RIGHT",className:"w-4 h-4 text-zinc-400 group-hover:text-indigo-500 transition-colors"})]})}),d.jsx("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-zinc-200 dark:border-zinc-700 overflow-hidden transition-all duration-200 hover:shadow-md hover:border-amber-200 dark:hover:border-amber-900/50",children:d.jsxs("button",{onClick:o,disabled:a,className:"w-full flex items-center justify-between p-4 hover:bg-zinc-50 dark:hover:bg-zinc-700/30 transition-colors group disabled:opacity-50",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"p-2 bg-amber-50 dark:bg-amber-900/30 rounded-lg text-amber-600 dark:text-amber-400 group-hover:scale-110 transition-transform",children:d.jsx(H,{name:a?"ROTATE_CW":"ALERT_TRIANGLE",className:`w-4 h-4 ${a?"animate-spin":""}`})}),d.jsx("span",{className:"font-semibold text-zinc-800 dark:text-zinc-100 text-sm",children:a?"Analyzing...":"Detect Plot Holes"})]}),d.jsx(H,{name:"CHEVRON_RIGHT",className:"w-4 h-4 text-zinc-400 group-hover:text-amber-500 transition-colors"})]})}),d.jsx("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-zinc-200 dark:border-zinc-700 overflow-hidden transition-all duration-200 hover:shadow-md hover:border-teal-200 dark:hover:border-teal-900/50",children:d.jsxs("button",{onClick:l,disabled:u,className:"w-full flex items-center justify-between p-4 hover:bg-zinc-50 dark:hover:bg-zinc-700/30 transition-colors group disabled:opacity-50",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"p-2 bg-teal-50 dark:bg-teal-900/30 rounded-lg text-teal-600 dark:text-teal-400 group-hover:scale-110 transition-transform",children:d.jsx(H,{name:u?"ROTATE_CW":"BRAIN",className:`w-4 h-4 ${u?"animate-spin":""}`})}),d.jsx("span",{className:"font-semibold text-zinc-800 dark:text-zinc-100 text-sm",children:u?"Analyzing...":"Check Lore Consistency"})]}),d.jsx(H,{name:"CHEVRON_RIGHT",className:"w-4 h-4 text-zinc-400 group-hover:text-teal-500 transition-colors"})]})})]}),s&&d.jsx(nae,{}),d.jsx(Voe,{}),e.seriesId&&d.jsx(eae,{}),d.jsx(Xoe,{}),s&&d.jsx(Yoe,{}),s&&d.jsx(Joe,{}),s&&d.jsx(tae,{}),s&&d.jsx(Zoe,{})]})]})]})]})},aae=_B,lae=({editor:n})=>{const{handleAssistantAction:e,isAssistantLoading:t,isAiEnabled:s,handleOpenTextToImage:i}=Xt(),[r,o]=T.useState(!1);if(!n||n.isDestroyed)return null;const a="p-2 rounded-md transition-colors hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",l="bg-gray-200 dark:bg-gray-700 text-indigo-600 dark:text-indigo-400",u=g=>{e(g)},f=g=>{e({type:"tone",tone:g}),o(!1)},p=()=>{i(n)};return d.jsx(aae,{editor:n,tippyOptions:{duration:100,placement:"top-start"},children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 p-1.5 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 flex items-center gap-1",children:[d.jsx("button",{onClick:()=>n.chain().focus().toggleBold().run(),className:`${a} ${n.isActive("bold")?l:""}`,title:"Bold",children:d.jsx(H,{name:"BOLD",className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>n.chain().focus().toggleItalic().run(),className:`${a} ${n.isActive("italic")?l:""}`,title:"Italic",children:d.jsx(H,{name:"ITALIC",className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>n.chain().focus().toggleUnderline().run(),className:`${a} ${n.isActive("underline")?l:""}`,title:"Underline",children:d.jsx(H,{name:"UNDERLINE",className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>n.chain().focus().toggleHighlight().run(),className:`${a} ${n.isActive("highlight")?l:""}`,title:"Highlight",children:d.jsx(H,{name:"HIGHLIGHT",className:"w-4 h-4"})}),s&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"w-px h-5 bg-zinc-300 dark:bg-zinc-600 mx-1"}),t?d.jsx("div",{className:"flex items-center space-x-2 px-2",children:d.jsx(H,{name:"ROTATE_CW",className:"w-4 h-4 text-blue-500 animate-spin"})}):d.jsxs(d.Fragment,{children:[d.jsx("button",{onClick:()=>u("rephrase"),className:a,title:"Rephrase",children:d.jsx(H,{name:"REPHRASE",className:"w-5 h-5"})}),d.jsx("button",{onClick:()=>u("expand"),className:a,title:"Expand",children:d.jsx(H,{name:"EXPAND",className:"w-5 h-5"})}),d.jsx("button",{onClick:()=>u("summarize"),className:a,title:"Summarize",children:d.jsx(H,{name:"SUMMARIZE",className:"w-5 h-5"})}),d.jsxs("div",{className:"relative",children:[d.jsx("button",{onClick:()=>o(g=>!g),className:a,title:"Change Tone",children:d.jsx(H,{name:"TONE",className:"w-5 h-5"})}),r&&d.jsxs("div",{className:"absolute bottom-full mb-2 w-32 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-10 animate-fade-in-up",children:[d.jsx("button",{onClick:()=>f("Formal"),className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700",children:"Formal"}),d.jsx("button",{onClick:()=>f("Casual"),className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700",children:"Casual"}),d.jsx("button",{onClick:()=>f("Humorous"),className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700",children:"Humorous"}),d.jsx("button",{onClick:()=>f("Concise"),className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700",children:"Concise"})]})]}),d.jsx("div",{className:"w-px h-5 bg-zinc-300 dark:bg-zinc-600 mx-1"}),d.jsx("button",{onClick:p,className:a,title:"Generate Illustration",children:d.jsx(H,{name:"IMAGE_PLUS",className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"})})]})]})]})})},cae=rie,dae=({editor:n})=>{const{handleAssistantAction:e,isAssistantLoading:t,isAiEnabled:s}=Xt();if(!n||n.isDestroyed||!s)return null;const i=({state:r})=>{const{$from:o}=r.selection,a=o.pos===1,l=o.parent.isEmpty,u=o.pos===o.end();return(a||l)&&u};return d.jsx(cae,{editor:n,tippyOptions:{duration:100,placement:"right-start"},shouldShow:i,children:d.jsxs("button",{onClick:()=>e("suggest"),disabled:t,className:"flex items-center space-x-2 text-sm font-semibold text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors bg-white dark:bg-gray-800 px-3 py-1.5 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[d.jsx(H,{name:t?"ROTATE_CW":"WAND",className:`w-4 h-4 ${t?"animate-spin":""}`}),d.jsx("span",{children:t?"Generating...":"Continue writing"})]})})};function uae(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)t.hasOwnProperty(s)&&(n[s]=t[s])}return n}function jE(n,e){return Array(e+1).join(n)}function hae(n){return n.replace(/^\n*/,"")}function fae(n){for(var e=n.length;e>0&&n[e-1]===`
`;)e--;return n.substring(0,e)}var pae=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function N2(n){return E2(n,pae)}var xF=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function bF(n){return E2(n,xF)}function mae(n){return vF(n,xF)}var yF=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function gae(n){return E2(n,yF)}function xae(n){return vF(n,yF)}function E2(n,e){return e.indexOf(n.nodeName)>=0}function vF(n,e){return n.getElementsByTagName&&e.some(function(t){return n.getElementsByTagName(t).length})}var Si={};Si.paragraph={filter:"p",replacement:function(n){return`

`+n+`

`}};Si.lineBreak={filter:"br",replacement:function(n,e,t){return t.br+`
`}};Si.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(n,e,t){var s=Number(e.nodeName.charAt(1));if(t.headingStyle==="setext"&&s<3){var i=jE(s===1?"=":"-",n.length);return`

`+n+`
`+i+`

`}else return`

`+jE("#",s)+" "+n+`

`}};Si.blockquote={filter:"blockquote",replacement:function(n){return n=n.replace(/^\n+|\n+$/g,""),n=n.replace(/^/gm,"> "),`

`+n+`

`}};Si.list={filter:["ul","ol"],replacement:function(n,e){var t=e.parentNode;return t.nodeName==="LI"&&t.lastElementChild===e?`
`+n:`

`+n+`

`}};Si.listItem={filter:"li",replacement:function(n,e,t){n=n.replace(/^\n+/,"").replace(/\n+$/,`
`).replace(/\n/gm,`
    `);var s=t.bulletListMarker+"   ",i=e.parentNode;if(i.nodeName==="OL"){var r=i.getAttribute("start"),o=Array.prototype.indexOf.call(i.children,e);s=(r?Number(r)+o:o+1)+".  "}return s+n+(e.nextSibling&&!/\n$/.test(n)?`
`:"")}};Si.indentedCodeBlock={filter:function(n,e){return e.codeBlockStyle==="indented"&&n.nodeName==="PRE"&&n.firstChild&&n.firstChild.nodeName==="CODE"},replacement:function(n,e,t){return`

    `+e.firstChild.textContent.replace(/\n/g,`
    `)+`

`}};Si.fencedCodeBlock={filter:function(n,e){return e.codeBlockStyle==="fenced"&&n.nodeName==="PRE"&&n.firstChild&&n.firstChild.nodeName==="CODE"},replacement:function(n,e,t){for(var s=e.firstChild.getAttribute("class")||"",i=(s.match(/language-(\S+)/)||[null,""])[1],r=e.firstChild.textContent,o=t.fence.charAt(0),a=3,l=new RegExp("^"+o+"{3,}","gm"),u;u=l.exec(r);)u[0].length>=a&&(a=u[0].length+1);var f=jE(o,a);return`

`+f+i+`
`+r.replace(/\n$/,"")+`
`+f+`

`}};Si.horizontalRule={filter:"hr",replacement:function(n,e,t){return`

`+t.hr+`

`}};Si.inlineLink={filter:function(n,e){return e.linkStyle==="inlined"&&n.nodeName==="A"&&n.getAttribute("href")},replacement:function(n,e){var t=e.getAttribute("href"),s=Uk(e.getAttribute("title"));return s&&(s=' "'+s+'"'),"["+n+"]("+t+s+")"}};Si.referenceLink={filter:function(n,e){return e.linkStyle==="referenced"&&n.nodeName==="A"&&n.getAttribute("href")},replacement:function(n,e,t){var s=e.getAttribute("href"),i=Uk(e.getAttribute("title"));i&&(i=' "'+i+'"');var r,o;switch(t.linkReferenceStyle){case"collapsed":r="["+n+"][]",o="["+n+"]: "+s+i;break;case"shortcut":r="["+n+"]",o="["+n+"]: "+s+i;break;default:var a=this.references.length+1;r="["+n+"]["+a+"]",o="["+a+"]: "+s+i}return this.references.push(o),r},references:[],append:function(n){var e="";return this.references.length&&(e=`

`+this.references.join(`
`)+`

`,this.references=[]),e}};Si.emphasis={filter:["em","i"],replacement:function(n,e,t){return n.trim()?t.emDelimiter+n+t.emDelimiter:""}};Si.strong={filter:["strong","b"],replacement:function(n,e,t){return n.trim()?t.strongDelimiter+n+t.strongDelimiter:""}};Si.code={filter:function(n){var e=n.previousSibling||n.nextSibling,t=n.parentNode.nodeName==="PRE"&&!e;return n.nodeName==="CODE"&&!t},replacement:function(n){if(!n)return"";n=n.replace(/\r?\n|\r/g," ");for(var e=/^`|^ .*?[^ ].* $|`$/.test(n)?" ":"",t="`",s=n.match(/`+/gm)||[];s.indexOf(t)!==-1;)t=t+"`";return t+e+n+e+t}};Si.image={filter:"img",replacement:function(n,e){var t=Uk(e.getAttribute("alt")),s=e.getAttribute("src")||"",i=Uk(e.getAttribute("title")),r=i?' "'+i+'"':"";return s?"!["+t+"]("+s+r+")":""}};function Uk(n){return n?n.replace(/(\n+\s*)+/g,`
`):""}function wF(n){this.options=n,this._keep=[],this._remove=[],this.blankRule={replacement:n.blankReplacement},this.keepReplacement=n.keepReplacement,this.defaultRule={replacement:n.defaultReplacement},this.array=[];for(var e in n.rules)this.array.push(n.rules[e])}wF.prototype={add:function(n,e){this.array.unshift(e)},keep:function(n){this._keep.unshift({filter:n,replacement:this.keepReplacement})},remove:function(n){this._remove.unshift({filter:n,replacement:function(){return""}})},forNode:function(n){if(n.isBlank)return this.blankRule;var e;return(e=oN(this.array,n,this.options))||(e=oN(this._keep,n,this.options))||(e=oN(this._remove,n,this.options))?e:this.defaultRule},forEach:function(n){for(var e=0;e<this.array.length;e++)n(this.array[e],e)}};function oN(n,e,t){for(var s=0;s<n.length;s++){var i=n[s];if(bae(i,e,t))return i}}function bae(n,e,t){var s=n.filter;if(typeof s=="string"){if(s===e.nodeName.toLowerCase())return!0}else if(Array.isArray(s)){if(s.indexOf(e.nodeName.toLowerCase())>-1)return!0}else if(typeof s=="function"){if(s.call(n,e,t))return!0}else throw new TypeError("`filter` needs to be a string, array, or function")}function yae(n){var e=n.element,t=n.isBlock,s=n.isVoid,i=n.isPre||function(p){return p.nodeName==="PRE"};if(!(!e.firstChild||i(e))){for(var r=null,o=!1,a=null,l=KL(a,e,i);l!==e;){if(l.nodeType===3||l.nodeType===4){var u=l.data.replace(/[ \r\n\t]+/g," ");if((!r||/ $/.test(r.data))&&!o&&u[0]===" "&&(u=u.substr(1)),!u){l=aN(l);continue}l.data=u,r=l}else if(l.nodeType===1)t(l)||l.nodeName==="BR"?(r&&(r.data=r.data.replace(/ $/,"")),r=null,o=!1):s(l)||i(l)?(r=null,o=!0):r&&(o=!1);else{l=aN(l);continue}var f=KL(a,l,i);a=l,l=f}r&&(r.data=r.data.replace(/ $/,""),r.data||aN(r))}}function aN(n){var e=n.nextSibling||n.parentNode;return n.parentNode.removeChild(n),e}function KL(n,e,t){return n&&n.parentNode===e||t(e)?e.nextSibling||e.parentNode:e.firstChild||e.nextSibling||e.parentNode}var kF=typeof window<"u"?window:{};function vae(){var n=kF.DOMParser,e=!1;try{new n().parseFromString("","text/html")&&(e=!0)}catch{}return e}function wae(){var n=function(){};return kae()?n.prototype.parseFromString=function(e){var t=new window.ActiveXObject("htmlfile");return t.designMode="on",t.open(),t.write(e),t.close(),t}:n.prototype.parseFromString=function(e){var t=document.implementation.createHTMLDocument("");return t.open(),t.write(e),t.close(),t},n}function kae(){var n=!1;try{document.implementation.createHTMLDocument("").open()}catch{window.ActiveXObject&&(n=!0)}return n}var Sae=vae()?kF.DOMParser:wae();function Cae(n,e){var t;if(typeof n=="string"){var s=Aae().parseFromString('<x-turndown id="turndown-root">'+n+"</x-turndown>","text/html");t=s.getElementById("turndown-root")}else t=n.cloneNode(!0);return yae({element:t,isBlock:N2,isVoid:bF,isPre:e.preformattedCode?Nae:null}),t}var lN;function Aae(){return lN=lN||new Sae,lN}function Nae(n){return n.nodeName==="PRE"||n.nodeName==="CODE"}function Eae(n,e){return n.isBlock=N2(n),n.isCode=n.nodeName==="CODE"||n.parentNode.isCode,n.isBlank=Tae(n),n.flankingWhitespace=_ae(n,e),n}function Tae(n){return!bF(n)&&!gae(n)&&/^\s*$/i.test(n.textContent)&&!mae(n)&&!xae(n)}function _ae(n,e){if(n.isBlock||e.preformattedCode&&n.isCode)return{leading:"",trailing:""};var t=Mae(n.textContent);return t.leadingAscii&&YL("left",n,e)&&(t.leading=t.leadingNonAscii),t.trailingAscii&&YL("right",n,e)&&(t.trailing=t.trailingNonAscii),{leading:t.leading,trailing:t.trailing}}function Mae(n){var e=n.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:e[1],leadingAscii:e[2],leadingNonAscii:e[3],trailing:e[4],trailingNonAscii:e[5],trailingAscii:e[6]}}function YL(n,e,t){var s,i,r;return n==="left"?(s=e.previousSibling,i=/ $/):(s=e.nextSibling,i=/^ /),s&&(s.nodeType===3?r=i.test(s.nodeValue):t.preformattedCode&&s.nodeName==="CODE"?r=!1:s.nodeType===1&&!N2(s)&&(r=i.test(s.textContent))),r}var Rae=Array.prototype.reduce,Iae=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function $k(n){if(!(this instanceof $k))return new $k(n);var e={rules:Si,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(t,s){return s.isBlock?`

`:""},keepReplacement:function(t,s){return s.isBlock?`

`+s.outerHTML+`

`:s.outerHTML},defaultReplacement:function(t,s){return s.isBlock?`

`+t+`

`:t}};this.options=uae({},e,n),this.rules=new wF(this.options)}$k.prototype={turndown:function(n){if(!jae(n))throw new TypeError(n+" is not a string, or an element/document/fragment node.");if(n==="")return"";var e=SF.call(this,new Cae(n,this.options));return zae.call(this,e)},use:function(n){if(Array.isArray(n))for(var e=0;e<n.length;e++)this.use(n[e]);else if(typeof n=="function")n(this);else throw new TypeError("plugin must be a Function or an Array of Functions");return this},addRule:function(n,e){return this.rules.add(n,e),this},keep:function(n){return this.rules.keep(n),this},remove:function(n){return this.rules.remove(n),this},escape:function(n){return Iae.reduce(function(e,t){return e.replace(t[0],t[1])},n)}};function SF(n){var e=this;return Rae.call(n.childNodes,function(t,s){s=new Eae(s,e.options);var i="";return s.nodeType===3?i=s.isCode?s.nodeValue:e.escape(s.nodeValue):s.nodeType===1&&(i=Dae.call(e,s)),CF(t,i)},"")}function zae(n){var e=this;return this.rules.forEach(function(t){typeof t.append=="function"&&(n=CF(n,t.append(e.options)))}),n.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function Dae(n){var e=this.rules.forNode(n),t=SF.call(this,n),s=n.flankingWhitespace;return(s.leading||s.trailing)&&(t=t.trim()),s.leading+e.replacement(t,n,this.options)+s.trailing}function CF(n,e){var t=fae(n),s=hae(e),i=Math.max(n.length-t.length,e.length-s.length),r=`

`.substring(0,i);return t+r+s}function jae(n){return n!=null&&(typeof n=="string"||n.nodeType&&(n.nodeType===1||n.nodeType===9||n.nodeType===11))}var JL=/highlight-(?:text|source)-([a-z0-9]+)/;function Pae(n){n.addRule("highlightedCodeBlock",{filter:function(e){var t=e.firstChild;return e.nodeName==="DIV"&&JL.test(e.className)&&t&&t.nodeName==="PRE"},replacement:function(e,t,s){var i=t.className||"",r=(i.match(JL)||[null,""])[1];return`

`+s.fence+r+`
`+t.firstChild.textContent+`
`+s.fence+`

`}})}function Lae(n){n.addRule("strikethrough",{filter:["del","s","strike"],replacement:function(e){return"~"+e+"~"}})}var Oae=Array.prototype.indexOf,Bae=Array.prototype.every,Lm={};Lm.tableCell={filter:["th","td"],replacement:function(n,e){return AF(n,e)}};Lm.tableRow={filter:"tr",replacement:function(n,e){var t="",s={left:":--",right:"--:",center:":-:"};if(T2(e))for(var i=0;i<e.childNodes.length;i++){var r="---",o=(e.childNodes[i].getAttribute("align")||"").toLowerCase();o&&(r=s[o]||r),t+=AF(r,e.childNodes[i])}return`
`+n+(t?`
`+t:"")}};Lm.table={filter:function(n){return n.nodeName==="TABLE"&&T2(n.rows[0])},replacement:function(n){return n=n.replace(`

`,`
`),`

`+n+`

`}};Lm.tableSection={filter:["thead","tbody","tfoot"],replacement:function(n){return n}};function T2(n){var e=n.parentNode;return e.nodeName==="THEAD"||e.firstChild===n&&(e.nodeName==="TABLE"||Fae(e))&&Bae.call(n.childNodes,function(t){return t.nodeName==="TH"})}function Fae(n){var e=n.previousSibling;return n.nodeName==="TBODY"&&(!e||e.nodeName==="THEAD"&&/^\s*$/i.test(e.textContent))}function AF(n,e){var t=Oae.call(e.parentNode.childNodes,e),s=" ";return t===0&&(s="| "),s+n+" |"}function Hae(n){n.keep(function(t){return t.nodeName==="TABLE"&&!T2(t.rows[0])});for(var e in Lm)n.addRule(e,Lm[e])}function Uae(n){n.addRule("taskListItems",{filter:function(e){return e.type==="checkbox"&&e.parentNode.nodeName==="LI"},replacement:function(e,t){return(t.checked?"[x]":"[ ]")+" "}})}function $ae(n){n.use([Pae,Lae,Hae,Uae])}const Gae=bs.create({name:"ghostText",addOptions(){return{enabled:!1,bookInstructions:""}},addProseMirrorPlugins(){let n;const e=new Ts("ghostText");return[new Jn({key:e,state:{init(){return{decoration:null,suggestion:null,loading:!1}},apply(t,s){var r;const i=t.getMeta(e);if(i&&i.type==="setSuggestion"){if(!i.suggestion)return{decoration:null,suggestion:null,loading:!1};const o=t.selection.from,a=document.createElement("span");return a.textContent=i.suggestion,a.className="ghost-text opacity-50 pointer-events-none text-zinc-400 font-serif italic ml-1",{decoration:Bn.create(t.doc,[yi.widget(o,a,{side:1})]),suggestion:i.suggestion,loading:!1}}return i&&i.type==="clear"?{decoration:null,suggestion:null,loading:!1}:t.docChanged?{decoration:null,suggestion:null,loading:!1}:{decoration:(r=s.decoration)==null?void 0:r.map(t.mapping,t.doc),suggestion:s.suggestion,loading:s.loading}}},props:{decorations(t){return this.getState(t).decoration},handleKeyDown(t,s){const i=this.getState(t.state);return i.suggestion&&s.key==="Tab"?(s.preventDefault(),t.dispatch(t.state.tr.insertText(i.suggestion).setMeta(e,{type:"clear"})),!0):(i.suggestion&&(s.key==="Escape"||s.key.length===1)&&t.dispatch(t.state.tr.setMeta(e,{type:"clear"})),!1)}},view(t){return{update:(s,i)=>{if(!this.options.enabled)return;const r=e.getState(s.state);r.suggestion||r.loading||(clearTimeout(n),!(s.state.doc.content.size>0&&!s.state.selection.empty)&&(n=setTimeout(async()=>{const{from:o}=s.state.selection,a=s.state.doc.textBetween(Math.max(0,o-1e3),o," ");if(a.trim().length>10)try{const l=await M3(a,this.options.bookInstructions);l&&s.dom&&s.dispatch(s.state.tr.setMeta(e,{type:"setSuggestion",suggestion:l}))}catch{}},2e3)))}}}})]}}),Vae=({chapter:n,chapterIndex:e,onUpdate:t,onEditImage:s,isGenerating:i})=>{const r=T.useRef(null),{setActiveEditorInstance:o,registerEditor:a,unregisterEditor:l,activeEditorInstance:u,isAutocompleteEnabled:f,book:p}=Xt(),[g,b]=T.useState("visual"),[w,S]=T.useState(""),N=T.useRef(!1),C=T.useMemo(()=>{const D=new $k({headingStyle:"atx",codeBlockStyle:"fenced",emDelimiter:"*"});return D.use($ae),D.keep(["table","tbody","tr","td","th","thead","tfoot","span","div","iframe","sub","sup","u","img","video","audio"]),D},[]),M=T.useMemo(()=>[jB.configure({heading:{levels:[1,2,3,4,5,6]}}),PB.configure({inline:!1,allowBase64:!0}),LB,BB,FB,OB.configure({types:["heading","paragraph"]}),JB.configure({resizable:!0}),XB,ZB,QB,eF,tF.configure({nested:!0}),uF.configure({openOnClick:!1,autolink:!0}),hF,fF,pF.configure({multicolor:!0}),vB,kB,Gae.configure({enabled:f,bookInstructions:(p==null?void 0:p.instructions)||""})],[f,p==null?void 0:p.instructions]),R=T.useMemo(()=>({attributes:{class:"prose-base dark:prose-invert max-w-none tiptap outline-none min-h-[200px]"}}),[]),_=NB({extensions:M,content:n.htmlContent,onUpdate:({editor:D})=>{if(g==="visual"){N.current=!0;const U=D.getHTML();t(U)}},onFocus:({editor:D})=>{o(D)},onSelectionUpdate:({editor:D})=>{o(D)},editorProps:R},[M,R]);T.useEffect(()=>{if(_&&!_.isDestroyed)return a(e,_),()=>l(e)},[_,e,a,l]),T.useEffect(()=>{_&&_.isDestroyed},[f,p==null?void 0:p.instructions]),T.useEffect(()=>{var D;if(_&&!_.isDestroyed){const U="prose-base dark:prose-invert max-w-none tiptap outline-none min-h-[200px]",V=(D=_.options.editorProps.attributes)==null?void 0:D.class,q=i?`${U} is-ai-writing`:U;V!==q&&_.setOptions({editorProps:{attributes:{class:q}}})}},[i,_]),T.useEffect(()=>{if(!(!_||_.isDestroyed)&&g==="visual"){if(N.current){N.current=!1;return}const D=_.getHTML(),U=n.htmlContent;if(D===U)return;if(!i){const{from:V,to:q}=_.state.selection;_.commands.setContent(U,{emitUpdate:!1}),_.commands.setTextSelection({from:V,to:q})}}},[n.htmlContent,_,i,g]),T.useEffect(()=>{const D=r.current;if(!D||!_)return;const U=q=>{const G=q.target;if(G.tagName==="IMG"){const ee=G;s({chapterIndex:e,src:ee.src,alt:ee.alt})}},V=D.querySelector(".ProseMirror");return V==null||V.addEventListener("click",U),()=>{V==null||V.removeEventListener("click",U)}},[_,e,s]);const j=async D=>{if(D===g)return;let U="";if(g==="visual"?U=(_==null?void 0:_.getHTML())||"":g==="markdown"?U=await Bt.parse(w):U=w,D==="visual")_==null||_.commands.setContent(U,{emitUpdate:!0}),t(U);else if(D==="markdown"){const V=C.turndown(U);S(V)}else S(U);b(D)},P=async D=>{const U=D.target.value;if(S(U),g==="html")t(U);else if(g==="markdown"){const V=await Bt.parse(U);t(V)}};return d.jsxs("div",{ref:r,className:"relative group/editor-wrapper",children:[d.jsx(mF,{editor:_,viewMode:g,onViewChange:j}),d.jsx("div",{style:{display:g==="visual"?"block":"none"},children:_&&d.jsxs(d.Fragment,{children:[d.jsx(lae,{editor:_}),d.jsx(gF,{editor:_}),d.jsx(dae,{editor:_}),d.jsx(CB,{editor:_})]})}),g!=="visual"&&d.jsx("textarea",{value:w,onChange:P,className:"w-full min-h-[600px] p-4 font-mono text-sm bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-700 rounded-md focus:ring-indigo-500 focus:border-indigo-500 resize-y outline-none",placeholder:g==="markdown"?"Type markdown here...":"Type HTML here...",spellCheck:!1})]})},qae=({chapterIndex:n})=>{var M;const{book:e,handleGenerateSubSection:t,generatingSubSection:s,handleUpdateSubSectionPrompt:i,handleRemoveSubSection:r,handleAnalyzePlanCompleteness:o,isAnalyzingPlan:a,isGeneratingChapter:l}=Xt(),u=(M=e==null?void 0:e.outline[n])==null?void 0:M.subSections,f=(u==null?void 0:u.findIndex(R=>!R.isGenerated))??-1,p=a===n,g=l===n,b=g||p,[w,S]=T.useState("");T.useEffect(()=>{f!==-1&&u&&S(u[f].prompt)},[f,u]);const N=()=>{f!==-1&&u&&w!==u[f].prompt&&i(n,f,w)};if(!e||!u||f===-1&&!g)return null;const C=(s==null?void 0:s.chapter)===n&&(s==null?void 0:s.section)===f;return d.jsxs("div",{className:"space-y-4 my-6 p-4 bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-200 dark:border-zinc-700 rounded-lg",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("h4",{className:"font-bold text-lg text-zinc-800 dark:text-zinc-100",children:"Chapter Writing Plan"}),f===-1?d.jsx("span",{className:"text-sm font-semibold text-green-600",children:" All sections written"}):d.jsxs("button",{onClick:()=>o(n),disabled:b,className:"flex items-center space-x-2 text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Use AI to check which sections are already written in the content below.",children:[d.jsx(H,{name:p?"ROTATE_CW":"SPARKLES",className:`w-4 h-4 ${p?"animate-spin":""}`}),d.jsx("span",{children:p?"Analyzing...":"Analyze Plan"})]})]}),d.jsx("ol",{className:"space-y-3",children:u.map((R,_)=>{const j=R.isGenerated,P=_===f;return d.jsxs("li",{className:`relative p-2 rounded-md transition-colors group ${P?"bg-indigo-50 dark:bg-indigo-900/30":""}`,children:[d.jsxs("div",{className:"flex items-start space-x-3",children:[d.jsx("div",{className:"flex-shrink-0 pt-1",children:j?d.jsx("div",{className:"w-5 h-5 rounded-full bg-emerald-500 flex items-center justify-center text-white",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:d.jsx("polyline",{points:"20 6 9 17 4 12"})})}):P?d.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-indigo-500 bg-white dark:bg-indigo-900 flex items-center justify-center",children:d.jsx("div",{className:"w-2 h-2 bg-indigo-500 rounded-full"})}):d.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-zinc-300 dark:border-zinc-600"})}),d.jsxs("div",{className:`flex-1 ${j?"text-zinc-400 dark:text-zinc-500 line-through":"text-zinc-700 dark:text-zinc-300"}`,children:[d.jsxs("span",{className:"font-semibold text-sm",children:["Section ",_+1]}),d.jsx("p",{className:"text-sm",children:R.prompt})]})]}),!j&&d.jsx("button",{onClick:()=>r(n,_),className:"absolute top-2 right-2 p-1 rounded-full text-zinc-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-zinc-700 opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-0",title:"Remove section from plan",disabled:b,"aria-label":"Remove section",children:d.jsx(H,{name:"TRASH",className:"w-4 h-4"})})]},_)})}),f!==-1&&d.jsxs("div",{className:"mt-6 pt-4 border-t border-zinc-200 dark:border-zinc-700 space-y-3",children:[d.jsxs("label",{htmlFor:`prompt-editor-${n}`,className:"block text-sm font-semibold text-zinc-800 dark:text-zinc-200",children:["Next Step: Edit the prompt for Section ",f+1]}),d.jsx("textarea",{id:`prompt-editor-${n}`,value:w,onChange:R=>S(R.target.value),onBlur:N,rows:3,className:"w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",disabled:b}),d.jsxs("button",{onClick:()=>t(n,f),disabled:b,className:"flex items-center justify-center w-full space-x-2 bg-indigo-600 text-white px-4 py-2 rounded-lg shadow font-semibold hover:bg-indigo-700 transition-colors disabled:bg-indigo-400 dark:disabled:bg-indigo-800 disabled:cursor-not-allowed",children:[d.jsx(H,{name:C?"ROTATE_CW":"WAND",className:`w-5 h-5 ${C?"animate-spin":""}`}),d.jsx("span",{children:C?"Writing...":f===0?"Generate First Section":"Generate Next Section"})]})]})]})},XL=({viewSettings:n})=>{const{book:e,handleTitleChange:t,handleSubtitleChange:s,handleChapterTitleChange:i,handleContentChange:r,handleEditImage:o,activeChapterIndex:a,setActiveChapterIndex:l,handleGenerateChapterBreakdown:u,handleOpenAnalysisModal:f,handleDeleteChapter:p,handleMergeChapters:g,isGeneratingChapter:b,setImageSuggestions:w,openImageSuggestionModal:S,handleAnalyzeChapterStyle:N,handleDownloadAudiobook:C,handleAddChapter:M,handleUpdatePart:R,handleUpdatePartContent:_,isAiEnabled:j}=Xt(),P=T.useRef(null),[D,U]=T.useState(null);if(T.useEffect(()=>{var W;const G=new IntersectionObserver(Q=>{Q.forEach(Z=>{if(Z.isIntersecting){const $=parseInt(Z.target.getAttribute("data-chapter-index")||"0",10);l($)}})},{root:null,rootMargin:"-40% 0px -60% 0px",threshold:0}),ee=(W=P.current)==null?void 0:W.querySelectorAll("article[data-chapter-index]");return ee&&ee.forEach(Q=>G.observe(Q)),()=>{ee&&ee.forEach(Q=>G.unobserve(Q))}},[e,l]),T.useEffect(()=>{if(!P.current)return;const G=()=>{if(!P.current)return;const W=P.current.querySelectorAll("span[data-ai-image-suggestion]"),Q=[];W.forEach((Z,$)=>{const Y=Z.closest("article[data-chapter-index]"),he=parseInt((Y==null?void 0:Y.getAttribute("data-chapter-index"))||"-1",10),Re=Z.getAttribute("data-ai-image-suggestion")||"";if(he!==-1&&Re){const ze=`suggestion-${he}-${$}-${Re.substring(0,16).replace(/[^a-z0-9]/gi,"")}`;Z.getAttribute("data-suggestion-id")!==ze&&Z.setAttribute("data-suggestion-id",ze),Q.push({id:ze,chapterIndex:he,prompt:Re})}}),w(Z=>Z.length===Q.length&&Z.every((Y,he)=>Y.id===Q[he].id&&Y.chapterIndex===Q[he].chapterIndex&&Y.prompt===Q[he].prompt)?Z:Q)},ee=new MutationObserver(G);return ee.observe(P.current,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-ai-image-suggestion"]}),G(),()=>ee.disconnect()},[e==null?void 0:e.content,w]),T.useEffect(()=>{const G=W=>{const Z=W.target.closest("span[data-ai-image-suggestion]");if(Z){const $=Z.getAttribute("data-suggestion-id"),Y=Z.getAttribute("data-ai-image-suggestion")||"",he=Z.closest("article[data-chapter-index]"),Re=parseInt((he==null?void 0:he.getAttribute("data-chapter-index"))||"-1",10);$&&Re!==-1&&S({id:$,chapterIndex:Re,prompt:Y})}},ee=P.current;return ee==null||ee.addEventListener("click",G),()=>ee==null?void 0:ee.removeEventListener("click",G)},[S]),!e)return null;const V=T.useMemo(()=>{switch(n==null?void 0:n.width){case"narrow":return"max-w-2xl mx-auto";case"wide":return"max-w-none";default:return"max-w-4xl mx-auto"}},[n==null?void 0:n.width]),q=(n==null?void 0:n.font)==="sans"?"font-sans":"font-serif";return d.jsx("div",{ref:P,className:"w-full space-y-6",children:d.jsx("div",{className:`bg-white dark:bg-zinc-800 p-6 sm:p-10 rounded-lg shadow-md border border-zinc-200 dark:border-zinc-700 min-h-[80vh] ${e.outline.length===0?"empty-state-bg":""} ${q}`,children:e.outline.length>0?d.jsxs("div",{className:`prose-base dark:prose-invert ${V} transition-all duration-300`,children:[d.jsxs("div",{className:"text-center mb-16",children:[d.jsx("h1",{contentEditable:!0,suppressContentEditableWarning:!0,onBlur:t,className:"hover:bg-zinc-100 dark:hover:bg-zinc-700/50 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-md px-2 -mx-2 cursor-text mb-2 inline-block",children:e.topic}),d.jsx("h2",{className:"text-2xl text-zinc-500 dark:text-zinc-400 font-light mt-0 hover:bg-zinc-100 dark:hover:bg-zinc-700/50 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-md px-2 -mx-2 cursor-text inline-block empty:before:content-['Add_subtitle...'] empty:before:text-zinc-300 dark:empty:before:text-zinc-600",contentEditable:!0,suppressContentEditableWarning:!0,onBlur:s,children:e.subtitle})]}),(()=>{let G="";return((e.content.length===e.outline.length?e.outline:[...e.outline.slice(0,e.content.length),e.outline[e.content.length]])||e.outline).map((W,Q)=>{const Z=e.content[Q];if(!W)return null;const $=W.part&&W.part!==G;$&&(G=W.part);const Y=W.id||`chapter-${Q}`;return d.jsxs(Kn.Fragment,{children:[$&&d.jsxs("div",{className:"mt-16 mb-12",children:[d.jsx("h2",{className:"text-center text-3xl font-bold text-zinc-400 dark:text-zinc-600 pb-4 border-b border-zinc-200 dark:border-zinc-700 outline-none hover:text-zinc-500 dark:hover:text-zinc-500 focus:text-zinc-700 dark:focus:text-zinc-300 transition-colors cursor-text",contentEditable:!0,suppressContentEditableWarning:!0,onBlur:he=>R(Q,he.currentTarget.textContent||""),children:G}),d.jsx("div",{className:"mt-6 text-lg italic text-zinc-600 dark:text-zinc-400 text-center max-w-2xl mx-auto whitespace-pre-wrap outline-none border border-transparent hover:border-zinc-200 dark:hover:border-zinc-700 focus:border-indigo-300 rounded px-4 py-2 transition-colors empty:before:content-['Add_description...'] empty:before:text-zinc-300 dark:empty:before:text-zinc-600 cursor-text",contentEditable:!0,suppressContentEditableWarning:!0,onBlur:he=>_(Q,he.currentTarget.textContent||""),children:W.partContent||""})]}),d.jsxs("article",{"data-chapter-index":Q,className:"mb-16",children:[d.jsxs("div",{className:"relative group mb-6",children:[d.jsx("h3",{id:`chapter-${Q}`,className:"scroll-mt-24 hover:bg-zinc-100 dark:hover:bg-zinc-700/50 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-md px-2 -mx-2 cursor-text font-bold text-2xl",contentEditable:!0,suppressContentEditableWarning:!0,onBlur:he=>i(he,Q),children:W.title}),Z&&Z.htmlContent.trim()!==""&&d.jsxs("div",{className:`absolute top-1/2 right-0 -translate-y-1/2 transition-opacity z-40 ${D===Q?"opacity-100":"opacity-0 group-hover:opacity-100"}`,children:[d.jsx("button",{onClick:()=>U(D===Q?null:Q),className:"p-2 rounded-full bg-zinc-100 dark:bg-zinc-700 hover:bg-zinc-200 dark:hover:bg-zinc-600 shadow-sm",children:d.jsx(H,{name:"MORE_VERTICAL",className:"w-5 h-5"})}),D===Q&&d.jsxs("div",{className:"absolute right-0 top-full mt-2 w-56 bg-white dark:bg-zinc-800 rounded-md shadow-lg border border-zinc-200 dark:border-zinc-700 z-30 animate-fade-in-up font-sans overflow-hidden",children:[j&&d.jsxs(d.Fragment,{children:[d.jsxs("button",{onClick:()=>{f(Q),U(null)},className:"w-full text-left flex items-center space-x-2 px-4 py-2 text-sm text-zinc-700 dark:text-zinc-200 hover:bg-zinc-100 dark:hover:bg-zinc-700",children:[d.jsx(H,{name:"SPARKLES",className:"w-4 h-4"}),d.jsx("span",{children:"Analyze Content"})]}),d.jsxs("button",{onClick:()=>{N(Q),U(null)},className:"w-full text-left flex items-center space-x-2 px-4 py-2 text-sm text-zinc-700 dark:text-zinc-200 hover:bg-zinc-100 dark:hover:bg-zinc-700",children:[d.jsx(H,{name:"TONE",className:"w-4 h-4"}),d.jsx("span",{children:"Analyze Style & Tone"})]}),d.jsxs("button",{onClick:()=>{C(Q),U(null)},className:"w-full text-left flex items-center space-x-2 px-4 py-2 text-sm text-zinc-700 dark:text-zinc-200 hover:bg-zinc-100 dark:hover:bg-zinc-700",children:[d.jsx(H,{name:"DOWNLOAD",className:"w-4 h-4"}),d.jsx("span",{children:"Download Audio"})]}),d.jsx("div",{className:"my-1 border-t border-zinc-100 dark:border-zinc-700"})]}),d.jsxs("button",{onClick:()=>{M(Q,"before"),U(null)},className:"w-full text-left flex items-center space-x-2 px-4 py-2 text-sm text-zinc-700 dark:text-zinc-200 hover:bg-zinc-100 dark:hover:bg-zinc-700",children:[d.jsx(H,{name:"PLUS",className:"w-4 h-4"}),d.jsx("span",{children:"Insert Chapter Above"})]}),d.jsxs("button",{onClick:()=>{M(Q,"after"),U(null)},className:"w-full text-left flex items-center space-x-2 px-4 py-2 text-sm text-zinc-700 dark:text-zinc-200 hover:bg-zinc-100 dark:hover:bg-zinc-700",children:[d.jsx(H,{name:"PLUS",className:"w-4 h-4"}),d.jsx("span",{children:"Insert Chapter Below"})]}),d.jsx("div",{className:"my-1 border-t border-zinc-100 dark:border-zinc-700"}),Q<e.outline.length-1&&d.jsxs("button",{onClick:()=>{g(Q),U(null)},className:"w-full text-left flex items-center space-x-2 px-4 py-2 text-sm text-zinc-700 dark:text-zinc-200 hover:bg-zinc-100 dark:hover:bg-zinc-700",children:[d.jsx(H,{name:"EXPAND",className:"w-4 h-4",style:{transform:"rotate(45deg)"}}),d.jsx("span",{children:"Merge with Next Chapter"})]}),d.jsxs("button",{onClick:()=>{p(Q),U(null)},className:"w-full text-left flex items-center space-x-2 px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/50",children:[d.jsx(H,{name:"TRASH",className:"w-4 h-4"}),d.jsx("span",{children:"Delete Chapter"})]})]})]})]}),W.subSections&&d.jsx(qae,{chapterIndex:Q}),Z?d.jsx(Vae,{chapter:Z,chapterIndex:Q,isGenerating:b===Q,onUpdate:he=>r(Q,he),onEditImage:o}):W.subSections?null:d.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-zinc-200 dark:border-zinc-700 rounded-lg",children:[d.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"This chapter has no content yet."}),j&&d.jsx("button",{onClick:()=>u(Q),className:"mt-4 bg-indigo-600 text-white px-4 py-2 rounded-lg shadow-md font-semibold hover:bg-indigo-700 transition-colors",children:"Break Down Chapter into Sections"})]})]})]},Y)})})()]}):d.jsxs("div",{className:"text-center py-20 text-zinc-500 dark:text-zinc-400 h-full flex flex-col justify-center items-center",children:[d.jsx(H,{name:"PEN_TOOL",className:"w-20 h-20 mx-auto text-zinc-300 dark:text-zinc-600"}),d.jsx("h3",{className:"mt-4 text-2xl font-semibold text-zinc-800 dark:text-zinc-100",children:"Your book will appear here"}),d.jsxs("p",{className:"mt-2 max-w-md",children:["Fill out the details on the left ",j?"and generate an outline":""," to begin your creative journey."]})]})})})},Wae=({isOpen:n,setIsOpen:e})=>{const{book:t,activeChapterIndex:s,handleMoveChapter:i}=Xt(),[r,o]=T.useState(null),[a,l]=T.useState(null);if(!t||!t.outline.length)return null;const u=g=>{const b=document.getElementById(`chapter-${g}`);b&&b.scrollIntoView({behavior:"smooth",block:"start"})},f=g=>g===r?"opacity-30":g===a?"border-t-2 border-indigo-500":"";let p="";return d.jsxs("aside",{className:`transition-all duration-300 ease-in-out bg-zinc-50 dark:bg-zinc-900 border-r border-zinc-200 dark:border-zinc-700 flex flex-col flex-shrink-0 ${n?"w-72":"w-16"}`,children:[d.jsxs("div",{className:`p-3 flex items-center border-b border-zinc-200 dark:border-zinc-700 ${n?"justify-between":"justify-center"}`,children:[n&&d.jsx("h3",{className:"font-bold text-lg text-zinc-800 dark:text-zinc-100 animate-fade-in",children:"Outline"}),d.jsx("button",{onClick:()=>e(!n),className:"p-2 rounded-md hover:bg-zinc-200 dark:hover:bg-zinc-700",children:d.jsx(H,{name:"CHEVRON_LEFT",className:`w-5 h-5 block transform transition-transform ${n?"":"rotate-180"}`})})]}),d.jsx("nav",{className:"flex-1 overflow-y-auto",children:d.jsx("ul",{className:"space-y-1 p-2",children:t.outline.map((g,b)=>{const w=g.part&&g.part!==p;return w&&(p=g.part),d.jsxs(Kn.Fragment,{children:[w&&n&&d.jsx("li",{className:"pt-4 pb-2 pl-2 text-xs font-bold text-zinc-400 dark:text-zinc-500 uppercase tracking-wider",children:g.part}),d.jsx("li",{draggable:!0,onDragStart:S=>{S.dataTransfer.setData("text/plain",b.toString()),o(b)},onDragOver:S=>{S.preventDefault(),r!==null&&r!==b&&l(b)},onDragLeave:()=>l(null),onDrop:S=>{S.preventDefault();const N=parseInt(S.dataTransfer.getData("text/plain"),10);i(N,b),l(null)},onDragEnd:()=>{o(null),l(null)},className:`transition-all duration-150 ${f(b)}`,children:d.jsxs("button",{onClick:()=>u(b),title:g.title,className:`w-full text-left flex items-start space-x-3 p-2 rounded-md transition-colors text-sm border-l-4 ${s===b?"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-200 font-semibold border-indigo-500":"text-zinc-600 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700 border-transparent"}`,children:[d.jsx("span",{className:`flex-shrink-0 mt-0.5 w-5 text-center font-mono text-xs ${s===b?"text-indigo-500 dark:text-indigo-300":"text-zinc-400 dark:text-zinc-500"}`,children:b+1}),n&&d.jsx("span",{className:"flex-grow truncate",children:g.title.replace(/Part \w+:.*? - /,"")})]})})]},g.title+b)})})})]})},Kae=({isOpen:n,onClose:e,book:t,onOutlineGenerated:s})=>{const[i,r]=T.useState("framework"),[o,a]=T.useState("none"),[l,u]=T.useState(""),[f,p]=T.useState(""),[g,b]=T.useState([]),[w,S]=T.useState([]),[N,C]=T.useState([]),[M,R]=T.useState(""),[_,j]=T.useState([]),[P,D]=T.useState([]),[U,V]=T.useState([]),[q,G]=T.useState([]),[ee,W]=T.useState(!1),[Q,Z]=T.useState(""),[$,Y]=T.useState(""),he=T.useCallback(()=>{r("framework"),a("none"),u(""),p(""),b([]),S([]),C([]),R(""),j([]),D([]),V([]),G([]),W(!1),Z(""),Y("")},[]),Re=T.useCallback(async()=>{W(!0),Z("Brainstorming creative angles..."),Y("");try{const Se=await wA(t.topic,t.instructions,o,l,f);b(Se),S(new Array(Se.length).fill(!1)),C(new Array(Se.length).fill(!1))}catch(Se){Y(Se.message),r("error")}finally{W(!1)}},[t.topic,t.instructions,o,l,f]),ze=async()=>{W(!0),Z("Brainstorming new angles..."),Y("");try{const Se=g.filter((as,Xn)=>w[Xn]),Me=g.length-Se.length;if(Me<=0){te.info("All angles are locked. Nothing to regenerate."),W(!1);return}const He=await wA(t.topic,t.instructions,o,l,f,Se,Me);let Pt=0;const Sn=g.map((as,Xn)=>w[Xn]?as:He[Pt++]||"Failed to generate new angle");b(Sn)}catch(Se){Y(Se.message),r("error")}finally{W(!1)}},F=async()=>{W(!0),Z("Brainstorming more angles...");try{const Se=await wA(t.topic,t.instructions,o,l,f,g,3);b(Me=>[...Me,...Se]),S(Me=>[...Me,...new Array(Se.length).fill(!1)]),C(Me=>[...Me,...new Array(Se.length).fill(!1)])}catch(Se){Y(Se.message),r("error")}finally{W(!1)}},J=async()=>{const Se=g.filter((Me,He)=>N[He]);if(Se.length<2){te.info("Please select at least two angles to synthesize.");return}W(!0),Z("Synthesizing selected angles...");try{const Me=await pY(t.topic,t.instructions,o,l,f,Se);b(He=>[...He,Me]),S(He=>[...He,!1]),C(He=>[...He,!1]),C(He=>He.map(()=>!1))}catch(Me){Y(Me.message),r("error")}finally{W(!1)}},ie=T.useCallback(async()=>{if(M){W(!0),Z("Structuring high-level parts..."),Y("");try{const Se=await kA(t.topic,t.instructions,M,o,l,f);j(Se),D(new Array(Se.length).fill(!1)),V(new Array(Se.length).fill(!1));const Me=t.wordCountGoal?Math.ceil(t.wordCountGoal/2500):12,He=Se.length>0?Se.length:1,Pt=Math.floor(Me/He),Sn=Me%He,as=Se.map((Xn,De)=>Pt+(De<Sn?1:0));G(as)}catch(Se){Y(Se.message),r("error")}finally{W(!1)}}},[t.topic,t.instructions,t.wordCountGoal,M,o,l,f]),pe=async()=>{if(M){W(!0),Z("Generating new parts..."),Y("");try{const Se=_.filter((as,Xn)=>P[Xn]),Me=_.length-Se.length;if(Me<=0){te.info("All parts are locked. Nothing to regenerate."),W(!1);return}const He=await kA(t.topic,t.instructions,M,o,l,f,Se,Me);let Pt=0;const Sn=_.map((as,Xn)=>P[Xn]?as:He[Pt++]||"Failed to generate new part");j(Sn)}catch(Se){Y(Se.message),r("error")}finally{W(!1)}}},ue=async()=>{W(!0),Z("Brainstorming more parts...");try{const Se=await kA(t.topic,t.instructions,M,o,l,f,_,3);j(Me=>[...Me,...Se]),D(Me=>[...Me,...new Array(Se.length).fill(!1)]),V(Me=>[...Me,...new Array(Se.length).fill(!1)]),G(Me=>[...Me,...new Array(Se.length).fill(3)])}catch(Se){Y(Se.message),r("error")}finally{W(!1)}},ke=async()=>{const Se=_.filter((Me,He)=>U[He]);if(Se.length<2){te.info("Please select at least two parts to synthesize.");return}W(!0),Z("Synthesizing selected parts...");try{const Me=await mY(t.topic,t.instructions,M,o,l,f,Se);j(He=>[...He,Me]),D(He=>[...He,!1]),V(He=>[...He,!1]),G(He=>[...He,3]),V(He=>He.map(()=>!1))}catch(Me){Y(Me.message),r("error")}finally{W(!1)}};T.useEffect(()=>{n&&he()},[n,he]),T.useEffect(()=>{i==="parts"&&M&&_.length===0&&ie()},[i,M,_.length,ie]);const re=Se=>{R(Se),r("parts")},Ge=(Se,Me)=>{const He=[...g];He[Se]=Me,b(He)},Je=Se=>{b(Me=>Me.filter((He,Pt)=>Pt!==Se)),S(Me=>Me.filter((He,Pt)=>Pt!==Se)),C(Me=>Me.filter((He,Pt)=>Pt!==Se))},Qe=()=>{b(Se=>[...Se,"A new custom angle"]),S(Se=>[...Se,!1]),C(Se=>[...Se,!1])},je=Se=>{S(Me=>{const He=[...Me];return He[Se]=!He[Se],He})},ye=Se=>{C(Me=>{const He=[...Me];return He[Se]=!He[Se],He})},Fe=(Se,Me)=>{const He=[..._];He[Se]=Me,j(He)},Ne=(Se,Me)=>{if(isNaN(Me)||Me<1)return;const He=[...q];He[Se]=Me,G(He)},ve=Se=>{j(Me=>Me.filter((He,Pt)=>Pt!==Se)),G(Me=>Me.filter((He,Pt)=>Pt!==Se)),D(Me=>Me.filter((He,Pt)=>Pt!==Se)),V(Me=>Me.filter((He,Pt)=>Pt!==Se))},Pe=()=>{j(Se=>[...Se,"New Custom Part"]),G(Se=>[...Se,3]),D(Se=>[...Se,!1]),V(Se=>[...Se,!1])},ot=Se=>{D(Me=>{const He=[...Me];return He[Se]=!He[Se],He})},Gt=Se=>{V(Me=>{const He=[...Me];return He[Se]=!He[Se],He})},bn=async()=>{if(!(!M||_.length===0)){W(!0),r("generating"),Z("Generating the full, detailed outline..."),Y("");try{const Se=_.map((Pt,Sn)=>({title:Pt,chapters:q[Sn]||3})),Me=await gY(t.topic,t.instructions,M,o,Se,l,f);let He=t.topic;if(Me&&Me.length>0){const Sn=Me[0].title.split(": ");Sn.length>1&&(He=Sn.slice(1).join(": ").trim())}s(Me,He)}catch(Se){Y(Se.message),r("error")}finally{W(!1)}}},qt=()=>d.jsxs("div",{className:"flex flex-col items-center justify-center p-8 min-h-[300px]",children:[d.jsx("div",{className:"w-12 h-12 border-4 border-t-indigo-500 border-gray-200 rounded-full animate-spin"}),d.jsx("p",{className:"mt-4 font-semibold text-gray-700 dark:text-gray-300",children:Q})]}),jt=()=>d.jsxs("div",{className:"p-4",children:[d.jsx("h3",{className:"text-xl font-bold text-red-600 dark:text-red-400",children:"An Error Occurred"}),d.jsx("p",{className:"my-4 text-gray-600 dark:text-gray-400",children:$}),d.jsxs("div",{className:"flex justify-end space-x-2",children:[d.jsx("button",{onClick:e,className:"bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 px-4 py-2 rounded-lg font-semibold",children:"Close"}),d.jsx("button",{onClick:()=>{r("angles"),Re()},className:"bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold",children:"Try Again"})]})]}),yn=()=>d.jsxs(d.Fragment,{children:[d.jsx("h3",{className:"text-lg font-semibold mb-1 text-gray-800 dark:text-gray-100",children:"Step 1: Provide Context (Optional)"}),d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Guide the AI with a structural framework, source material, or a stylistic influence."}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"framework",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Structural Framework"}),d.jsxs("select",{id:"framework",value:o,onChange:Se=>a(Se.target.value),className:"mt-1 block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",children:[d.jsx("option",{value:"none",children:"None (Freestyle Brainstorm)"}),Object.entries(xJ).map(([Se,Me])=>d.jsx("optgroup",{label:Se,children:Me.map(He=>d.jsx("option",{value:He,children:He},He))},Se))]})]}),d.jsxs("div",{className:"mt-4",children:[d.jsx("label",{htmlFor:"source-material",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Source Material"}),d.jsx("textarea",{id:"source-material",value:l,onChange:Se=>u(Se.target.value),rows:6,className:"mt-1 block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Paste research notes, articles, a rough draft, or other source material here..."})]}),d.jsxs("div",{className:"mt-4",children:[d.jsx("label",{htmlFor:"writing-style",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:'"In The Style Of..."'}),d.jsx("input",{type:"text",id:"writing-style",value:f,onChange:Se=>p(Se.target.value),className:"mt-1 block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"e.g., Malcolm Gladwell, Bren Brown, The Martian by Andy Weir"})]}),d.jsx("div",{className:"mt-6 flex justify-end",children:d.jsxs("button",{onClick:()=>{r("angles"),Re()},className:"bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold flex items-center space-x-2",children:[d.jsx("span",{children:"Continue to Angles"}),d.jsx(H,{name:"CHEVRON_RIGHT",className:"w-5 h-5"})]})})]}),_t=()=>d.jsxs(d.Fragment,{children:[d.jsx("h3",{className:"text-lg font-semibold mb-1 text-gray-800 dark:text-gray-100",children:"Step 2: Choose or Refine a Creative Angle"}),d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Select an angle to proceed, or edit the text to create your own."}),d.jsx("div",{className:"space-y-3",children:g.map((Se,Me)=>d.jsxs("div",{className:`flex items-center space-x-2 group transition-colors p-1 -m-1 rounded-md ${w[Me]?"bg-zinc-100 dark:bg-zinc-700/50":""}`,children:[d.jsx("input",{type:"checkbox",checked:N[Me],onChange:()=>ye(Me),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),d.jsx("button",{type:"button",onClick:()=>je(Me),className:"p-2 rounded-full text-zinc-400 hover:text-indigo-500 hover:bg-indigo-100 dark:hover:bg-zinc-700","aria-label":w[Me]?"Unlock angle":"Lock angle",children:d.jsx(H,{name:w[Me]?"LOCK":"UNLOCK",className:"w-4 h-4"})}),d.jsx("input",{type:"text",value:Se,onChange:He=>Ge(Me,He.target.value),className:"flex-grow bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 disabled:bg-zinc-100 dark:disabled:bg-zinc-700/50 disabled:cursor-not-allowed",disabled:w[Me]}),d.jsx("button",{onClick:()=>re(Se),className:"px-4 py-2 text-sm font-semibold rounded-md bg-indigo-600 text-white hover:bg-indigo-700 transition-colors flex-shrink-0",children:"Select"}),d.jsx("button",{onClick:()=>Je(Me),className:"p-2 rounded-full text-zinc-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-zinc-700 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0","aria-label":"Delete angle",children:d.jsx(H,{name:"TRASH",className:"w-4 h-4"})})]},Me))}),d.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("button",{onClick:()=>r("framework"),className:"text-sm font-semibold text-gray-600 dark:text-gray-400 hover:underline p-2",children:" Back"}),d.jsxs("button",{onClick:Qe,className:"flex items-center justify-center space-x-2 text-sm font-semibold py-2 px-3 rounded-md bg-zinc-100 text-zinc-700 dark:bg-zinc-700 dark:text-zinc-200 hover:bg-zinc-200 dark:hover:bg-zinc-600",children:[d.jsx(H,{name:"PLUS",className:"w-4 h-4"}),d.jsx("span",{children:"Add Angle"})]})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsxs("button",{onClick:J,disabled:N.filter(Boolean).length<2,className:"flex items-center space-x-2 text-sm font-semibold py-2 px-3 rounded-md bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[d.jsx(H,{name:"SYNTHESIZE",className:"w-4 h-4"}),d.jsx("span",{children:"Synthesize"})]}),d.jsx("button",{onClick:F,className:"text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:underline",children:"Generate 3 More"}),d.jsx("button",{onClick:ze,className:"text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:underline",children:"Regenerate Unlocked"})]})]})]}),Qt=()=>d.jsxs(d.Fragment,{children:[d.jsx("h3",{className:"text-lg font-semibold mb-1 text-gray-800 dark:text-gray-100",children:"Step 3: Edit the Book Structure"}),d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"Adjust these high-level parts and their chapter counts. The AI will write chapters within this structure."}),d.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4 p-2 bg-gray-50 dark:bg-gray-700/50 rounded-md",children:[d.jsx("strong",{children:"Selected Angle:"})," ",M]}),d.jsxs("div",{className:"space-y-2",children:[_.map((Se,Me)=>d.jsxs("div",{className:`flex items-center space-x-2 group transition-colors p-1 -m-1 rounded-md ${P[Me]?"bg-zinc-100 dark:bg-zinc-700/50":""}`,children:[d.jsx("input",{type:"checkbox",checked:U[Me],onChange:()=>Gt(Me),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),d.jsx("button",{type:"button",onClick:()=>ot(Me),className:"p-2 rounded-full text-zinc-400 hover:text-indigo-500 hover:bg-indigo-100 dark:hover:bg-zinc-700","aria-label":P[Me]?"Unlock part":"Lock part",children:d.jsx(H,{name:P[Me]?"LOCK":"UNLOCK",className:"w-4 h-4"})}),d.jsx("input",{type:"text",value:Se,onChange:He=>Fe(Me,He.target.value),className:"flex-grow bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 disabled:bg-zinc-100 dark:disabled:bg-zinc-700/50 disabled:cursor-not-allowed",disabled:P[Me]}),d.jsx("input",{type:"number",min:"1",value:q[Me]||"",onChange:He=>Ne(Me,parseInt(He.target.value,10)),className:"w-20 text-center bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 disabled:bg-zinc-100 dark:disabled:bg-zinc-700/50 disabled:cursor-not-allowed","aria-label":`Number of chapters for ${Se}`,disabled:P[Me]}),d.jsx("span",{className:"text-sm text-zinc-500 dark:text-zinc-400 flex-shrink-0",children:"chapters"}),d.jsx("button",{onClick:()=>ve(Me),className:"p-2 rounded-full text-zinc-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-zinc-700 opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Delete part",children:d.jsx(H,{name:"TRASH",className:"w-4 h-4"})})]},Me)),d.jsxs("button",{onClick:Pe,className:"w-full flex items-center justify-center space-x-2 text-sm font-semibold py-2 px-3 rounded-md bg-zinc-100 text-zinc-700 dark:bg-zinc-700 dark:text-zinc-200 hover:bg-zinc-200 dark:hover:bg-zinc-600 mt-2",children:[d.jsx(H,{name:"PLUS",className:"w-4 h-4"}),d.jsx("span",{children:"Add Part"})]})]}),d.jsxs("div",{className:"mt-6 flex justify-between items-center",children:[d.jsx("button",{onClick:()=>{j([]),r("angles")},className:"text-sm font-semibold text-gray-600 dark:text-gray-400 hover:underline",children:" Back to Angles"}),d.jsxs("div",{className:"flex space-x-2",children:[d.jsxs("button",{onClick:ke,disabled:U.filter(Boolean).length<2,className:"flex items-center space-x-2 text-sm font-semibold py-2 px-3 rounded-md bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[d.jsx(H,{name:"SYNTHESIZE",className:"w-4 h-4"}),d.jsx("span",{children:"Synthesize"})]}),d.jsx("button",{onClick:ue,className:"text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:underline",children:"Generate 3 More"}),d.jsx("button",{onClick:pe,className:"text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:underline",children:"Regenerate Unlocked"}),d.jsxs("button",{onClick:bn,className:"bg-green-600 text-white px-4 py-2 rounded-lg font-semibold flex items-center space-x-2",children:[d.jsx(H,{name:"WAND"}),d.jsx("span",{children:"Approve & Generate Outline"})]})]})]})]}),_s=()=>ee?qt():i==="error"?jt():i==="framework"?yn():i==="angles"?_t():i==="parts"?Qt():i==="generating"?qt():null;return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:Se=>Se.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Outline Brainstorm"}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsx("div",{className:"overflow-y-auto pr-2 -mr-2",children:_s()})]})})},Yae=({isOpen:n,onClose:e,chapterTitle:t,analysisResult:s,isLoading:i,onExecuteAction:r})=>{if(!n)return null;const o=()=>d.jsxs("div",{className:"flex flex-col items-center justify-center p-8 min-h-[300px]",children:[d.jsx("div",{className:"w-12 h-12 border-4 border-t-indigo-500 border-gray-200 rounded-full animate-spin"}),d.jsx("p",{className:"mt-4 font-semibold text-gray-700 dark:text-gray-300",children:"Analyzing chapter..."})]}),a=()=>d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-lg text-gray-800 dark:text-gray-100 mb-2",children:"Editor's Feedback"}),d.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg max-h-80 overflow-y-auto",children:d.jsx("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:s==null?void 0:s.feedback})})]}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-lg text-gray-800 dark:text-gray-100 mb-2",children:"Suggested Actions"}),d.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:s==null?void 0:s.suggestions.map((l,u)=>d.jsxs("button",{onClick:()=>r(l.prompt),className:"w-full text-left p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/50 hover:border-indigo-500 transition-all group",children:[d.jsxs("h4",{className:"font-semibold text-indigo-700 dark:text-indigo-300 flex items-center",children:[d.jsx(H,{name:"WAND",className:"w-5 h-5 mr-2"}),l.title]}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:l.description})]},u))})]})]});return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:l=>l.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Chapter Analysis"}),d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:t})]}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsx("div",{className:"overflow-y-auto pr-2 -mr-2",children:i||!s?o():a()})]})})},Jae=({isOpen:n,onClose:e,chapterTitle:t,analysisResult:s,isLoading:i,onApplySuggestion:r})=>{if(!n)return null;const o=()=>d.jsxs("div",{className:"flex flex-col items-center justify-center p-8 min-h-[300px]",children:[d.jsx("div",{className:"w-12 h-12 border-4 border-t-indigo-500 border-gray-200 rounded-full animate-spin"}),d.jsx("p",{className:"mt-4 font-semibold text-gray-700 dark:text-gray-300",children:"Analyzing style and tone..."})]}),a=()=>d.jsx("div",{className:"space-y-4",children:s&&s.length>0?s.map((l,u)=>d.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[d.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/30",children:[d.jsx("h4",{className:"font-semibold text-sm text-red-700 dark:text-red-300",children:"Original Passage:"}),d.jsxs("p",{className:"italic text-gray-600 dark:text-gray-400 text-sm mt-1",children:['"',l.originalPassage,'"']})]}),d.jsxs("div",{className:"p-3 border-t border-gray-200 dark:border-gray-700 bg-green-50 dark:bg-green-900/30",children:[d.jsx("h4",{className:"font-semibold text-sm text-green-700 dark:text-green-300",children:"Suggested Rewrite:"}),d.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm mt-1",children:l.suggestedRewrite})]}),d.jsxs("div",{className:"p-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50",children:[d.jsx("h4",{className:"font-semibold text-sm text-gray-700 dark:text-gray-300",children:"Explanation:"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1",children:l.explanation})]}),d.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-700/50 flex justify-end",children:d.jsxs("button",{onClick:()=>r(l.originalPassage,l.suggestedRewrite),className:"px-3 py-1 text-xs font-semibold rounded-md bg-indigo-600 text-white hover:bg-indigo-700 transition-colors flex items-center space-x-1",children:[d.jsx(H,{name:"WAND",className:"w-3 h-3"}),d.jsx("span",{children:"Apply Suggestion"})]})})]},u)):d.jsxs("div",{className:"text-center py-10",children:[d.jsx(H,{name:"CLOUD_CHECK",className:"w-16 h-16 mx-auto text-green-500"}),d.jsx("p",{className:"mt-4 font-semibold text-gray-700 dark:text-gray-300",children:"Great work!"}),d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"The AI found no major style or tone inconsistencies with your instructions."})]})});return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[51] p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:l=>l.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Style & Tone Analysis"}),d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:t})]}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsx("div",{className:"overflow-y-auto pr-2 -mr-2",children:i?o():a()})]})})},Xae=()=>{const{setIsChatOpen:n,isAiEnabled:e}=Xt();return e?d.jsx("button",{onClick:()=>n(!0),className:"fixed bottom-24 right-6 z-50 bg-indigo-600 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center hover:bg-indigo-700 transition-all transform hover:scale-110","aria-label":"Open AI Assistant Chat",title:"Open AI Assistant Chat",children:d.jsx(H,{name:"MESSAGE_CIRCLE",className:"w-8 h-8"})}):null},Qae=({isOpen:n,onClose:e,chapterTitle:t,changeDescription:s,newContent:i,onApply:r})=>n?d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[70] p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:o=>o.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-start mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[d.jsxs("div",{children:[d.jsxs("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2",children:[d.jsx(H,{name:"EDIT",className:"w-5 h-5 text-indigo-500"}),"Review Changes"]}),d.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["For Chapter: ",d.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-300",children:t})]})]}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/30 p-3 rounded-lg border border-indigo-100 dark:border-indigo-800 mb-4 flex-shrink-0",children:[d.jsx("h4",{className:"text-xs font-bold text-indigo-600 dark:text-indigo-400 uppercase tracking-wide mb-1",children:"Change Summary"}),d.jsx("p",{className:"text-sm text-indigo-900 dark:text-indigo-100",children:s})]}),d.jsx("div",{className:"flex-grow overflow-y-auto bg-zinc-50 dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-700 p-6 shadow-inner",children:d.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert font-serif",dangerouslySetInnerHTML:{__html:i}})}),d.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3 flex-shrink-0",children:[d.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Discard"}),d.jsxs("button",{onClick:r,className:"px-6 py-2 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 shadow-md transition-colors flex items-center space-x-2",children:[d.jsx(H,{name:"CLOUD_CHECK",className:"w-5 h-5"}),d.jsx("span",{children:"Apply Changes"})]})]})]})}):null,Zae=["Summarize the current chapter","Analyze the tone of this section","Suggest 3 ideas for what happens next","Identify any plot holes in the outline","Describe the character's motivation here","Rewrite the last paragraph to be more descriptive"],ele=({isOpen:n,onClose:e,messages:t,onSendMessage:s,isLoading:i})=>{var P;const{chatMessages:r,book:o,handleApplyEdit:a,handleExecuteTool:l}=Xt(),[u,f]=T.useState(""),p=T.useRef(null),g=T.useRef(!0),b=T.useRef(null),[w,S]=T.useState(null),N=r||t,C=()=>{const D=p.current;if(D){const U=D.scrollHeight-D.clientHeight<=D.scrollTop+20;g.current=U}};T.useEffect(()=>{if(n){const D=p.current;D&&g.current&&(D.scrollTop=D.scrollHeight)}},[N,n,i]);const M=D=>{D==null||D.preventDefault(),u.trim()&&!i&&(g.current=!0,s(u.trim()),f(""),b.current&&(b.current.style.height="40px"))},R=D=>{g.current=!0,s(D)},_=D=>{f(D.target.value),D.target.style.height="auto",D.target.style.height=`${Math.min(D.target.scrollHeight,120)}px`},j=()=>{w&&(a(w.chapterIndex,w.newContent),S(null))};return n?d.jsxs(d.Fragment,{children:[w&&o&&d.jsx(Qae,{isOpen:!!w,onClose:()=>S(null),chapterTitle:((P=o.outline[w.chapterIndex])==null?void 0:P.title)||`Chapter ${w.chapterIndex+1}`,changeDescription:w.description,newContent:w.newContent,onApply:j}),d.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-[60]",onClick:e}),d.jsxs("div",{className:"fixed inset-y-0 right-0 w-full sm:w-96 bg-white dark:bg-zinc-900 shadow-2xl z-[61] flex flex-col border-l border-zinc-200 dark:border-zinc-800 transform transition-transform duration-300 ease-out animate-slide-in-up",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50/80 dark:bg-zinc-900/80 backdrop-blur-md sticky top-0 z-10",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"p-2 bg-indigo-100 dark:bg-indigo-900/50 rounded-lg text-indigo-600 dark:text-indigo-400",children:d.jsx(H,{name:"MESSAGE_CIRCLE",className:"w-5 h-5"})}),d.jsxs("div",{children:[d.jsx("h2",{className:"font-bold text-zinc-800 dark:text-zinc-100",children:"Co-Author Chat"}),d.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:"Ask me anything about your book"})]})]}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-800 text-zinc-500 dark:text-zinc-400 transition-colors",children:d.jsx(H,{name:"CLOSE",className:"w-5 h-5"})})]}),d.jsxs("div",{ref:p,onScroll:C,className:"flex-grow overflow-y-auto p-4 space-y-6 bg-white dark:bg-zinc-900",children:[N.length===0?d.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-zinc-400 space-y-4",children:[d.jsx(H,{name:"SPARKLES",className:"w-12 h-12 text-zinc-300 dark:text-zinc-700"}),d.jsxs("p",{children:["No messages yet.",d.jsx("br",{}),"Start a conversation with your AI editor."]})]}):N.map((D,U)=>{const V=D.role==="user",q=D.parts&&D.parts.length>0?D.parts[0]:null;if(q&&"functionCall"in q&&q.functionCall){const W=q.functionCall,Q=W.args;if(W.name==="updateChapter")return d.jsx("div",{className:"flex justify-start w-full",children:d.jsxs("div",{className:"max-w-[90%] bg-white dark:bg-zinc-800 rounded-2xl rounded-tl-none border-2 border-indigo-100 dark:border-indigo-900/50 p-4 shadow-md",children:[d.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[d.jsx("div",{className:"p-1.5 bg-indigo-100 dark:bg-indigo-900 rounded-full text-indigo-600 dark:text-indigo-300",children:d.jsx(H,{name:"EDIT",className:"w-4 h-4"})}),d.jsx("h3",{className:"font-bold text-zinc-800 dark:text-zinc-100 text-sm",children:"Proposed Edit"})]}),d.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-3",children:Q.changeDescription}),d.jsxs("button",{onClick:()=>S({chapterIndex:Q.chapterIndex,newContent:Q.newContent,description:Q.changeDescription}),className:"w-full py-2 bg-indigo-600 text-white text-sm font-semibold rounded-lg hover:bg-indigo-700 transition-colors flex items-center justify-center space-x-2",children:[d.jsx("span",{children:"Review Changes"}),d.jsx(H,{name:"CHEVRON_RIGHT",className:"w-4 h-4"})]})]})},U);let Z="Unknown Action";return W.name==="updateBookMetadata"?Z=`Update book details: ${[Q.topic,Q.subtitle].filter(Boolean).join(", ")}`:W.name==="updateChapterMetadata"?Z=`Update Chapter ${Q.chapterIndex+1}: ${[Q.title,Q.part].filter(Boolean).join(", ")}`:W.name==="addChapter"?Z=`Add new chapter: "${Q.title}"`:W.name==="deleteChapter"&&(Z=`Delete Chapter ${Q.chapterIndex+1}`),d.jsx("div",{className:"flex justify-start w-full",children:d.jsxs("div",{className:"max-w-[90%] bg-white dark:bg-zinc-800 rounded-2xl rounded-tl-none border-2 border-indigo-100 dark:border-indigo-900/50 p-4 shadow-md",children:[d.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[d.jsx("div",{className:"p-1.5 bg-indigo-100 dark:bg-indigo-900 rounded-full text-indigo-600 dark:text-indigo-300",children:d.jsx(H,{name:"COMMAND",className:"w-4 h-4"})}),d.jsx("h3",{className:"font-bold text-zinc-800 dark:text-zinc-100 text-sm",children:"Proposed Action"})]}),d.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-3",children:Z}),d.jsxs("button",{onClick:()=>l(W),className:"w-full py-2 bg-indigo-600 text-white text-sm font-semibold rounded-lg hover:bg-indigo-700 transition-colors flex items-center justify-center space-x-2",children:[d.jsx("span",{children:"Approve"}),d.jsx(H,{name:"CLOUD_CHECK",className:"w-4 h-4"})]})]})},U)}const G=q&&"text"in q?q.text:"";if(!G&&!i)return null;const ee=Bt.parse(G||"",{breaks:!0});return d.jsx("div",{className:`flex ${V?"justify-end":"justify-start"}`,children:d.jsx("div",{className:`max-w-[90%] rounded-2xl p-4 shadow-sm ${V?"bg-indigo-600 text-white rounded-tr-none":"bg-zinc-100 dark:bg-zinc-800 text-zinc-800 dark:text-zinc-200 rounded-tl-none border border-zinc-200 dark:border-zinc-700"}`,children:d.jsx("div",{className:`prose prose-sm max-w-none leading-relaxed break-words ${V?"prose-user-bubble":"dark:prose-invert"}`,dangerouslySetInnerHTML:{__html:ee||""}})})},U)}),i&&d.jsx("div",{className:"flex justify-start",children:d.jsxs("div",{className:"bg-zinc-100 dark:bg-zinc-800 p-3 rounded-2xl rounded-tl-none border border-zinc-200 dark:border-zinc-700 flex items-center space-x-1",children:[d.jsx("div",{className:"w-1.5 h-1.5 bg-zinc-400 rounded-full animate-bounce"}),d.jsx("div",{className:"w-1.5 h-1.5 bg-zinc-400 rounded-full animate-bounce",style:{animationDelay:"0.15s"}}),d.jsx("div",{className:"w-1.5 h-1.5 bg-zinc-400 rounded-full animate-bounce",style:{animationDelay:"0.3s"}})]})})]}),d.jsxs("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 sticky bottom-0",children:[N.length<2&&d.jsx("div",{className:"flex gap-2 overflow-x-auto pb-3 mb-1 no-scrollbar mask-fade-right",children:Zae.map((D,U)=>d.jsx("button",{onClick:()=>R(D),disabled:i,className:"whitespace-nowrap px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 text-xs font-medium text-zinc-600 dark:text-zinc-300 hover:text-indigo-600 dark:hover:text-indigo-300 border border-zinc-200 dark:border-zinc-700 hover:border-indigo-200 dark:hover:border-indigo-800 rounded-full transition-colors",children:D},U))}),d.jsxs("form",{onSubmit:M,className:"relative flex items-end gap-2 bg-zinc-100 dark:bg-zinc-800 p-2 rounded-xl border border-transparent focus-within:border-indigo-500 dark:focus-within:border-indigo-500 focus-within:ring-1 focus-within:ring-indigo-500 transition-all",children:[d.jsx("textarea",{ref:b,value:u,onChange:_,onKeyDown:D=>{D.key==="Enter"&&!D.shiftKey&&(D.preventDefault(),M())},placeholder:"Ask about your story...",className:"flex-grow bg-transparent border-none focus:ring-0 text-sm text-zinc-800 dark:text-zinc-100 placeholder-zinc-400 resize-none max-h-32 py-2.5 px-2",rows:1,disabled:i,style:{minHeight:"40px"}}),d.jsx("button",{type:"submit",disabled:i||!u.trim(),className:"p-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-zinc-300 dark:disabled:bg-zinc-700 disabled:cursor-not-allowed transition-colors mb-[1px]",children:d.jsx(H,{name:i?"ROTATE_CW":"MESSAGE_CIRCLE",className:`w-5 h-5 ${i?"animate-spin":""}`})})]})]})]})]}):null},tle=({isOpen:n,onClose:e,chapterTitle:t,analysisType:s,analysisData:i,onApplySuggestion:r})=>{if(!n)return null;const o=l=>d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-lg text-gray-800 dark:text-gray-100 mb-2",children:"Pacing & Flow Analysis"}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Sentence Length Distribution"}),d.jsx("div",{className:"space-y-2 text-sm",children:l.sentenceLengthHistogram.map((u,f)=>{const p=Math.max(...l.sentenceLengthHistogram.map(b=>b.count)),g=p>0?u.count/p*100:0;return d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"w-24 flex-shrink-0 text-gray-600 dark:text-gray-400",children:u.range}),d.jsx("div",{className:"flex-grow bg-gray-200 dark:bg-gray-700 rounded-full h-4",children:d.jsx("div",{className:"bg-blue-500 h-4 rounded-full text-white text-xs flex items-center justify-end pr-2",style:{width:`${g}%`},children:u.count})})]},f)})})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Dialogue Ratio"}),d.jsxs("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-6 flex items-center text-xs font-bold",children:[d.jsxs("div",{className:"bg-green-500 h-6 rounded-l-full flex items-center justify-center",style:{width:`${l.dialogueRatio*100}%`},children:[Math.round(l.dialogueRatio*100),"%"]}),d.jsxs("div",{className:"bg-purple-500 h-6 rounded-r-full flex-grow flex items-center justify-center text-white",children:[100-Math.round(l.dialogueRatio*100),"%"]})]}),d.jsxs("div",{className:"flex justify-between text-xs mt-1",children:[d.jsx("span",{className:"text-green-700 dark:text-green-300",children:"Dialogue"}),d.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"Narration"})]}),d.jsx("h4",{className:"font-semibold text-gray-700 dark:text-gray-300 mt-4 mb-2",children:"AI Pacing Feedback"}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 whitespace-pre-wrap",children:l.pacingFeedback})]})]})]}),a=l=>d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-lg text-gray-800 dark:text-gray-100 mb-4",children:`"Show, Don't Tell" Analysis`}),d.jsx("div",{className:"space-y-4",children:l.length>0?l.map((u,f)=>d.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[d.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/30",children:[d.jsx("h4",{className:"font-semibold text-sm text-red-700 dark:text-red-300",children:"Telling Passage:"}),d.jsxs("p",{className:"italic text-gray-600 dark:text-gray-400 text-sm mt-1",children:['"',u.passage,'"']})]}),d.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/30",children:[d.jsx("h4",{className:"font-semibold text-sm text-green-700 dark:text-green-300",children:"Showing Suggestion:"}),d.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm mt-1",children:u.suggestion})]}),d.jsx("div",{className:"p-2 bg-gray-50 dark:bg-gray-700/50 flex justify-end",children:d.jsx("button",{onClick:()=>r(u.passage,u.suggestion),className:"px-3 py-1 text-xs font-semibold rounded-md bg-indigo-600 text-white hover:bg-indigo-700 transition-colors",children:"Apply Suggestion"})})]},f)):d.jsx("p",{className:"text-center text-gray-500",children:'No "telling" passages found. Great job!'})})]});return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[51] p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:l=>l.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Deep Analysis"}),d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:t})]}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsx("div",{className:"overflow-y-auto pr-2 -mr-2",children:i?s==="pacing"?o(i):s==="show_tell"?a(i):d.jsx("p",{children:"Unknown analysis type."}):d.jsxs("div",{className:"flex flex-col items-center justify-center p-8 min-h-[300px]",children:[d.jsx("div",{className:"w-12 h-12 border-4 border-t-indigo-500 border-gray-200 rounded-full animate-spin"}),d.jsx("p",{className:"mt-4 font-semibold text-gray-700 dark:text-gray-300",children:"Performing deep analysis..."})]})})]})})},nle=({data:n})=>d.jsxs("div",{children:[d.jsx("h4",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Pacing & Flow Analysis"}),d.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-700",children:[d.jsx("h5",{className:"font-semibold text-sm mb-2",children:"Sentence Length"}),d.jsx("div",{className:"space-y-1 text-xs",children:n.sentenceLengthHistogram.map((e,t)=>{const s=Math.max(...n.sentenceLengthHistogram.map(r=>r.count)),i=s>0?e.count/s*100:0;return d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"w-20 flex-shrink-0 text-gray-600 dark:text-gray-400",children:e.range}),d.jsx("div",{className:"flex-grow bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:d.jsx("div",{className:"bg-blue-500 h-3 rounded-full text-white text-xs flex items-center justify-end pr-1",style:{width:`${i}%`},children:e.count})})]},t)})}),d.jsx("h5",{className:"font-semibold text-sm mt-3 mb-2",children:"AI Feedback"}),d.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 whitespace-pre-wrap",children:n.pacingFeedback})]})]}),sle=({data:n,onApply:e})=>d.jsxs("div",{children:[d.jsx("h4",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2",children:`"Show, Don't Tell" Analysis`}),d.jsx("div",{className:"space-y-3",children:n.map((t,s)=>d.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg",children:[d.jsxs("p",{className:"p-2 text-xs italic bg-red-50 dark:bg-red-900/30 text-red-800 dark:text-red-300",children:['"',t.passage,'"']}),d.jsxs("div",{className:"p-2 border-t border-gray-200 dark:border-gray-700 bg-green-50 dark:bg-green-900/30",children:[d.jsx("p",{className:"text-xs text-green-800 dark:text-green-300",children:t.suggestion}),d.jsx("div",{className:"flex justify-end mt-1",children:d.jsx("button",{onClick:()=>e(t.passage,t.suggestion),className:"text-xs font-semibold text-indigo-600 hover:underline",children:"Apply"})})]})]},s))})]}),ile=({data:n,onApply:e})=>d.jsxs("div",{children:[d.jsx("h4",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Alternative Openings"}),d.jsx("div",{className:"space-y-2",children:n.map((t,s)=>d.jsxs("div",{className:"p-2 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-900/50",children:[d.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-300",children:t}),d.jsx("div",{className:"flex justify-end mt-1",children:d.jsx("button",{onClick:()=>e(t),className:"text-xs font-semibold text-indigo-600 hover:underline",children:"Use this opening"})})]},s))})]}),rle=({data:n})=>d.jsxs("div",{children:[d.jsx("h4",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Series Consistency Analysis"}),n.length>0?d.jsx("div",{className:"space-y-3",children:n.map((e,t)=>d.jsxs("div",{className:"border border-yellow-300 dark:border-yellow-700 rounded-lg",children:[d.jsx("div",{className:"p-2 bg-yellow-50 dark:bg-yellow-900/30",children:d.jsxs("p",{className:"text-xs italic text-yellow-800 dark:text-yellow-300",children:['"',e.inconsistentPassage,'"']})}),d.jsxs("div",{className:"p-2 border-t border-yellow-300 dark:border-yellow-700 text-xs",children:[d.jsxs("p",{children:[d.jsx("strong",{className:"text-gray-600 dark:text-gray-400",children:"Source of Contradiction:"})," ",e.contradictionSource]}),d.jsxs("p",{className:"mt-1",children:[d.jsx("strong",{className:"text-gray-600 dark:text-gray-400",children:"Explanation:"})," ",e.explanation]})]})]},t))}):d.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:" No inconsistencies found."})]}),ole=({isOpen:n,onClose:e,results:t,onApplyShowTellSuggestion:s,onApplyOpeningSuggestion:i})=>n?d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[51] p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:r=>r.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Macro Results"}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsx("div",{className:"overflow-y-auto pr-2 -mr-2 space-y-4",children:t.map(r=>d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-gray-100 border-b border-gray-200 dark:border-gray-700 pb-1 mb-2",children:r.actionName}),r.error?d.jsxs("p",{className:"text-red-500 text-sm",children:["Error: ",r.error]}):r.type==="analyze_pacing"?d.jsx(nle,{data:r.result}):r.type==="analyze_show_dont_tell"?d.jsx(sle,{data:r.result,onApply:s}):r.type==="generate_alt_openings"?d.jsx(ile,{data:r.result,onApply:i}):r.type==="analyze_series_consistency"?d.jsx(rle,{data:r.result}):r.type==="rewrite_with_prompt"?d.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400",children:[" ",r.result]}):d.jsx("p",{className:"text-sm text-gray-500",children:"No viewable result for this action."})]},r.actionId))})]})}):null,ale=({activeView:n,setActiveView:e})=>{const t=[{id:"editor",name:"Manuscript",icon:"PEN_TOOL"},{id:"corkboard",name:"Corkboard",icon:"LAYOUT"},{id:"outliner",name:"Outliner",icon:"LIST"}],s=i=>`flex items-center space-x-2 px-3 py-1.5 text-xs sm:text-sm font-medium rounded-md transition-all ${i?"bg-white dark:bg-zinc-700 text-indigo-600 dark:text-indigo-300 shadow-sm":"text-zinc-500 dark:text-zinc-400 hover:text-zinc-800 dark:hover:text-zinc-200 hover:bg-zinc-200/50 dark:hover:bg-zinc-700/50"}`;return d.jsx("div",{className:"bg-zinc-100/50 dark:bg-zinc-800/50 p-1 rounded-lg border border-zinc-200 dark:border-zinc-700 flex items-center justify-center space-x-1",children:t.map(i=>d.jsxs("button",{onClick:()=>e(i.id),className:s(n===i.id),title:i.name,children:[d.jsx(H,{name:i.icon,className:"w-4 h-4 sm:w-5 sm:h-5"}),d.jsx("span",{className:"hidden sm:inline",children:i.name})]},i.id))})},lle=({chapter:n,index:e})=>{var N;const{handleUpdateChapterOutline:t,handleMoveChapter:s}=Xt(),[i,r]=T.useState(n.title),[o,a]=T.useState(n.summary),[l,u]=T.useState(!1),f=["gray","red","yellow","green","blue","indigo","purple","pink"],p={gray:"bg-gray-400",red:"bg-red-400",yellow:"bg-yellow-400",green:"bg-green-400",blue:"bg-blue-400",indigo:"bg-indigo-400",purple:"bg-purple-400",pink:"bg-pink-400"},g={todo:"bg-gray-200 text-gray-800",in_progress:"bg-blue-200 text-blue-800",done:"bg-green-200 text-green-800"},b=C=>{C.dataTransfer.setData("text/plain",e.toString()),C.currentTarget.style.opacity="0.4"},w=C=>{C.currentTarget.style.opacity="1",u(!1)},S=C=>{C.preventDefault();const M=parseInt(C.dataTransfer.getData("text/plain"),10);s(M,e),u(!1)};return d.jsxs("div",{draggable:!0,onDragStart:b,onDragEnd:w,onDragOver:C=>{C.preventDefault(),u(!0)},onDragLeave:()=>u(!1),onDrop:S,className:`w-72 h-80 bg-white dark:bg-zinc-800 rounded-lg shadow-lg border border-zinc-200 dark:border-zinc-700 flex flex-col cursor-grab active:cursor-grabbing transition-all ${l?"ring-2 ring-indigo-500":""}`,children:[d.jsx("div",{className:`h-2 w-full rounded-t-lg ${p[n.color]||"bg-gray-300"}`}),d.jsxs("div",{className:"p-4 flex-grow flex flex-col overflow-hidden",children:[d.jsxs("div",{className:"flex justify-between items-start mb-2",children:[d.jsx("span",{className:`px-2 py-0.5 text-xs font-semibold rounded-full ${g[n.status]||g.todo}`,children:((N=n.status)==null?void 0:N.replace("_"," "))||"To Do"}),d.jsxs("select",{value:n.status||"todo",onChange:C=>t(e,{status:C.target.value}),className:"text-xs bg-transparent dark:bg-zinc-800 border-none focus:ring-0",children:[d.jsx("option",{value:"todo",children:"To Do"}),d.jsx("option",{value:"in_progress",children:"In Progress"}),d.jsx("option",{value:"done",children:"Done"})]})]}),d.jsx("input",{value:i,onChange:C=>r(C.target.value),onBlur:()=>t(e,{title:i}),className:"font-bold text-lg bg-transparent focus:outline-none focus:ring-1 focus:ring-indigo-500 rounded-sm -ml-1 p-1 w-full"}),d.jsx("textarea",{value:o,onChange:C=>a(C.target.value),onBlur:()=>t(e,{summary:o}),className:"text-sm text-zinc-600 dark:text-zinc-400 mt-2 flex-grow resize-none bg-transparent focus:outline-none focus:ring-1 focus:ring-indigo-500 rounded-sm -ml-1 p-1 w-full"}),d.jsxs("div",{className:"flex-shrink-0 mt-2 flex items-center justify-between",children:[d.jsx("div",{className:"flex space-x-1",children:f.map(C=>d.jsx("button",{onClick:()=>t(e,{color:C}),className:`w-5 h-5 rounded-full ${p[C]} ${n.color===C?"ring-2 ring-offset-2 ring-indigo-500 dark:ring-offset-zinc-800":""}`,"aria-label":`Set color to ${C}`},C))}),d.jsxs("span",{className:"text-xs font-mono text-zinc-400",children:["Ch. ",e+1]})]})]})]})},cle=()=>{const{book:n}=Xt();return n?d.jsx("div",{className:"flex flex-wrap gap-6 p-4 bg-zinc-100 dark:bg-zinc-900 rounded-lg min-h-screen",children:n.outline.map((e,t)=>d.jsx(lle,{chapter:e,index:t},e.id||`chapter-${t}`))}):null},dle=({scene:n,chapterIndex:e,sceneIndex:t})=>{const{handleUpdateScene:s,handleDeleteScene:i}=Xt(),[r,o]=T.useState(n.title),[a,l]=T.useState(n.summary);return d.jsxs("li",{draggable:!0,onDragStart:u=>{u.stopPropagation(),u.dataTransfer.setData("text/plain",JSON.stringify({type:"scene",chapterIndex:e,sceneIndex:t})),u.currentTarget.style.opacity="0.4"},onDragEnd:u=>u.currentTarget.style.opacity="1",className:"ml-8 p-3 bg-white dark:bg-zinc-800 rounded-md border border-zinc-200 dark:border-zinc-700 cursor-grab group",children:[d.jsxs("div",{className:"flex justify-between items-start",children:[d.jsx("input",{value:r,onChange:u=>o(u.target.value),onBlur:()=>s(e,n.id,{title:r}),className:"font-semibold bg-transparent focus:outline-none focus:ring-1 focus:ring-indigo-500 rounded-sm -ml-1 p-1 w-full"}),d.jsx("button",{onClick:()=>i(e,n.id),className:"p-1 rounded-full text-zinc-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-zinc-700 opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Delete scene",children:d.jsx(H,{name:"TRASH",className:"w-4 h-4"})})]}),d.jsx("textarea",{value:a,onChange:u=>l(u.target.value),onBlur:()=>s(e,n.id,{summary:a}),placeholder:"Scene summary...",rows:2,className:"text-sm text-zinc-600 dark:text-zinc-400 mt-1 w-full resize-none bg-transparent focus:outline-none focus:ring-1 focus:ring-indigo-500 rounded-sm -ml-1 p-1"})]})},ule=()=>{const{book:n,handleMoveChapter:e,handleAddScene:t,handleUpdateChapterOutline:s,handleMoveScene:i,handleAddChapter:r,handlePropagatePart:o}=Xt(),[a,l]=T.useState(null);if(!n)return null;const u=(p,g,b)=>{p.preventDefault(),p.stopPropagation();const w=JSON.parse(p.dataTransfer.getData("text/plain"));w.type==="chapter"&&b===void 0?e(w.chapterIndex,g):w.type==="scene"&&b!==void 0&&w.chapterIndex===g&&i(g,w.sceneIndex,b),l(null)};let f="";return d.jsxs("div",{className:"p-4 bg-zinc-100 dark:bg-zinc-900 rounded-lg min-h-screen",children:[d.jsx("ul",{className:"space-y-4",children:n.outline.map((p,g)=>{var w;const b=p.part&&p.part!==f;return b&&(f=p.part),d.jsx("li",{draggable:!0,onDragStart:S=>{S.dataTransfer.setData("text/plain",JSON.stringify({type:"chapter",chapterIndex:g})),S.currentTarget.style.opacity="0.4"},onDragEnd:S=>S.currentTarget.style.opacity="1",onDragOver:S=>{S.preventDefault(),l({type:"chapter",chapterIndex:g})},onDragLeave:()=>l(null),onDrop:S=>u(S,g),className:`bg-zinc-50 dark:bg-zinc-800/50 rounded-lg border border-zinc-200 dark:border-zinc-700 transition-all ${(a==null?void 0:a.type)==="chapter"&&a.chapterIndex===g?"ring-2 ring-indigo-500":""}`,children:d.jsxs("details",{open:!0,className:"group",children:[d.jsxs("summary",{className:"p-3 cursor-pointer flex justify-between items-center font-bold text-lg text-zinc-800 dark:text-zinc-100",children:[d.jsx("div",{className:"flex-grow mr-2",children:d.jsx("input",{value:p.title,onChange:S=>s(g,{title:S.target.value}),onClick:S=>S.preventDefault(),className:"bg-transparent focus:outline-none focus:ring-1 focus:ring-indigo-500 rounded-sm -ml-1 p-1 w-full cursor-text"})}),d.jsxs("div",{className:"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[d.jsx("button",{onClick:S=>{S.preventDefault(),r(g,"before")},className:"p-1.5 rounded-full text-zinc-400 hover:text-indigo-500 hover:bg-indigo-100 dark:hover:bg-zinc-700",title:"Insert Chapter Above",children:d.jsx(H,{name:"CHEVRON_LEFT",className:"w-5 h-5 rotate-90"})}),d.jsx("button",{onClick:S=>{S.preventDefault(),r(g,"after")},className:"p-1.5 rounded-full text-zinc-400 hover:text-indigo-500 hover:bg-indigo-100 dark:hover:bg-zinc-700",title:"Insert Chapter Below",children:d.jsx(H,{name:"PLUS",className:"w-5 h-5"})}),d.jsx("button",{onClick:S=>{S.preventDefault(),t(g)},className:"p-1.5 rounded-full text-zinc-400 hover:text-indigo-500 hover:bg-indigo-100 dark:hover:bg-zinc-700",title:"Add Scene",children:d.jsx(H,{name:"LIST",className:"w-5 h-5"})})]})]}),d.jsxs("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-700",children:[d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-xs font-bold text-zinc-400 dark:text-zinc-500 uppercase tracking-wider mb-1",children:"Part / Section"}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{value:p.part||"",onChange:S=>s(g,{part:S.target.value}),className:"flex-grow text-sm bg-white dark:bg-zinc-700 border border-zinc-300 dark:border-zinc-600 rounded-md px-2 py-1 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"e.g. Part 1: The Beginning"}),d.jsx("button",{onClick:()=>o(g),className:"p-1.5 bg-zinc-200 dark:bg-zinc-600 text-zinc-600 dark:text-zinc-300 rounded-md hover:bg-zinc-300 dark:hover:bg-zinc-500 transition-colors",title:"Fill Down: Apply this part name to subsequent chapters in this section",children:d.jsx(H,{name:"CHEVRON_LEFT",className:"w-4 h-4 -rotate-90"})})]})]}),b&&d.jsxs("div",{className:"mb-4 p-3 bg-zinc-100 dark:bg-zinc-700/30 rounded-md border border-zinc-200 dark:border-zinc-600/50",children:[d.jsx("label",{className:"block text-xs font-bold text-zinc-400 dark:text-zinc-500 uppercase tracking-wider mb-1",children:"Part Intro / Description"}),d.jsx("textarea",{value:p.partContent||"",onChange:S=>s(g,{partContent:S.target.value}),rows:3,className:"w-full text-sm text-zinc-600 dark:text-zinc-400 bg-transparent focus:outline-none focus:ring-1 focus:ring-indigo-500 rounded-sm -ml-1 p-1 placeholder-zinc-400",placeholder:`Introduction for ${p.part}...`})]}),d.jsx("label",{className:"block text-xs font-bold text-zinc-400 dark:text-zinc-500 uppercase tracking-wider mb-1",children:"Summary"}),d.jsx("textarea",{value:p.summary,onChange:S=>s(g,{summary:S.target.value}),rows:3,className:"w-full text-sm text-zinc-600 dark:text-zinc-400 bg-transparent focus:outline-none focus:ring-1 focus:ring-indigo-500 rounded-sm -ml-1 p-1"}),d.jsx("h4",{className:"text-sm font-semibold mt-4 mb-2 text-zinc-500 dark:text-zinc-400",children:"Scenes"}),d.jsxs("ul",{className:"space-y-2",children:[(w=p.scenes)==null?void 0:w.map((S,N)=>d.jsx("div",{onDragOver:C=>{C.preventDefault(),C.stopPropagation(),l({type:"scene",chapterIndex:g,sceneIndex:N})},onDragLeave:C=>{C.stopPropagation(),l(null)},onDrop:C=>u(C,g,N),className:`transition-all ${(a==null?void 0:a.type)==="scene"&&a.chapterIndex===g&&a.sceneIndex===N?"pt-2 border-t-2 border-indigo-500":""}`,children:d.jsx(dle,{scene:S,chapterIndex:g,sceneIndex:N})},S.id)),(!p.scenes||p.scenes.length===0)&&d.jsx("p",{className:"text-center text-sm text-zinc-400 py-4",children:"No scenes yet. Click the list icon to add one."})]})]})]})},p.id||`chapter-${g}`)})}),d.jsxs("button",{onClick:()=>r(n.outline.length-1,"after"),className:"w-full mt-4 py-3 bg-white dark:bg-zinc-800 border border-dashed border-zinc-300 dark:border-zinc-700 text-zinc-500 dark:text-zinc-400 hover:text-indigo-600 dark:hover:text-indigo-400 hover:border-indigo-300 dark:hover:border-indigo-700 rounded-lg flex items-center justify-center space-x-2 transition-all",children:[d.jsx(H,{name:"PLUS",className:"w-5 h-5"}),d.jsx("span",{children:"Add New Chapter at End"})]})]})},hle=-800,Hv=.08,QL=.01,ZL=.95,eO=12,NF=({sheets:n,onNodeClick:e})=>{const t=T.useRef(null),[s,i]=T.useState([]),[r,o]=T.useState([]),[a,l]=T.useState({x:-500,y:-500,w:1e3,h:1e3}),[u,f]=T.useState(null),[p,g]=T.useState(!1),[b,w]=T.useState({x:0,y:0}),[S,N]=T.useState(null),C=T.useMemo(()=>{if(!S)return new Set;const U=new Set([S]);return r.forEach(V=>{V.source===S&&U.add(V.target),V.target===S&&U.add(V.source)}),U},[S,r]);T.useEffect(()=>{const U=new Map(n.map(G=>[G.name.trim().toLowerCase(),G])),V=[],q=new Set;n.forEach(G=>{const ee=/\[\[(.*?)\]\]/g;let W;for(;(W=ee.exec(G.content))!==null;){const Q=W[1].trim().toLowerCase(),Z=U.get(Q);Z&&Z.id!==G.id&&(V.push({source:G.id,target:Z.id}),q.add(G.id),q.add(Z.id))}}),o(V),i(n.map(G=>({id:G.id,name:G.name,category:G.category,isOrphan:!q.has(G.id),x:Math.random()*500-250,y:Math.random()*500-250,vx:0,vy:0})))},[n]),T.useEffect(()=>{let U;const V=()=>{i(q=>{const G=q.map(W=>({...W})),ee=new Map(G.map(W=>[W.id,W]));for(let W=0;W<G.length;W++){const Q=G[W];for(let Y=W+1;Y<G.length;Y++){const he=G[Y],Re=he.x-Q.x,ze=he.y-Q.y,F=Math.sqrt(Re*Re+ze*ze)||1,J=hle/(F*F),ie=Re/F*J,pe=ze/F*J;Q.vx+=ie,Q.vy+=pe,he.vx-=ie,he.vy-=pe}const Z=-Q.x,$=-Q.y;Q.vx+=Z*QL,Q.vy+=$*QL}for(const W of r){const Q=ee.get(W.source),Z=ee.get(W.target);if(Q&&Z){const $=Z.x-Q.x,Y=Z.y-Q.y;Q.vx+=$*Hv,Q.vy+=Y*Hv,Z.vx-=$*Hv,Z.vy-=Y*Hv}}for(const W of G)W.id!==u&&(W.vx*=ZL,W.vy*=ZL,W.x+=W.vx,W.y+=W.vy);return G}),U=requestAnimationFrame(V)};return U=requestAnimationFrame(V),()=>cancelAnimationFrame(U)},[r,u]);const M=U=>{if(!t.current)return{x:0,y:0};const V=t.current.createSVGPoint();V.x=U.clientX,V.y=U.clientY;const q=t.current.getScreenCTM();return q?V.matrixTransform(q.inverse()):V},R=U=>{U.preventDefault();const V=1.1,{x:q,y:G}=M(U),{w:ee,h:W}=a,Q=U.deltaY>0?ee*V:ee/V,Z=U.deltaY>0?W*V:W/V;l({x:q-(q-a.x)*(Q/ee),y:G-(G-a.y)*(Z/W),w:Q,h:Z})},_=U=>{U.target===t.current&&(g(!0),w(M(U)))},j=(U,V)=>{U.stopPropagation(),f(V),w(M(U))},P=U=>{if(!p&&!u)return;const V=M(U),q=V.x-b.x,G=V.y-b.y;p?l(ee=>({...ee,x:ee.x-q,y:ee.y-G})):u&&(i(ee=>ee.map(W=>W.id===u?{...W,x:W.x+q,y:W.y+G,vx:0,vy:0}:W)),w(V))},D=()=>{f(null),g(!1)};return d.jsx("div",{className:"flex-grow bg-zinc-50 dark:bg-zinc-900 overflow-hidden cursor-grab active:cursor-grabbing",children:d.jsxs("svg",{ref:t,width:"100%",height:"100%",viewBox:`${a.x} ${a.y} ${a.w} ${a.h}`,onWheel:R,onMouseDown:_,onMouseMove:P,onMouseUp:D,onMouseLeave:D,children:[d.jsx("defs",{children:d.jsx("style",{children:`
                        .node-text {
                            font-size: 5px;
                            paint-order: stroke;
                            stroke: #ffffff;
                            stroke-width: 1.5px;
                            stroke-linecap: butt;
                            stroke-linejoin: miter;
                            fill: #18181b;
                        }
                        .dark .node-text {
                             stroke: #27272a;
                             fill: #f4f4f5;
                        }
                    `})}),d.jsx("g",{children:r.map(({source:U,target:V},q)=>{const G=s.find(Q=>Q.id===U),ee=s.find(Q=>Q.id===V);if(!G||!ee)return null;const W=S===U||S===V;return d.jsx("line",{x1:G.x,y1:G.y,x2:ee.x,y2:ee.y,stroke:W?"#4f46e5":"#d4d4d8",className:"dark:stroke-zinc-600 dark:group-hover:stroke-indigo-400 transition-all",strokeWidth:W?1.5:.5,opacity:S&&!W?.2:1},`${U}-${V}-${q}`)})}),d.jsx("g",{children:s.map(U=>d.jsxs("g",{transform:`translate(${U.x}, ${U.y})`,onMouseDown:V=>j(V,U.id),onClick:()=>e(U.id),onMouseEnter:()=>N(U.id),onMouseLeave:()=>N(null),className:"cursor-pointer group",children:[d.jsx("circle",{r:eO,fill:C.has(U.id)?"#818cf8":"#f4f4f5",stroke:C.has(U.id)?"#4f46e5":"#a1a1aa",strokeWidth:S===U.id?2:U.isOrphan?1:.5,strokeDasharray:U.isOrphan?"2 2":"none",opacity:S&&!C.has(U.id)?.3:1,className:"dark:fill-zinc-700 dark:stroke-zinc-500 dark:group-hover:stroke-indigo-400 transition-all duration-200"}),d.jsx("text",{textAnchor:"middle",y:eO+7,className:"node-text select-none",opacity:S&&!C.has(U.id)?.3:1,children:U.name})]},U.id))})]})})},fle=({isOpen:n,onClose:e})=>{const{book:t,handleKnowledgeBaseUpdate:s,handleAutoFillKnowledgeBase:i,isAutoFillingKb:r,isAiEnabled:o}=Xt(),[a,l]=T.useState([]),[u,f]=T.useState(null),[p,g]=T.useState(!1);if(T.useEffect(()=>{t!=null&&t.knowledgeBase&&(l(t.knowledgeBase),t.knowledgeBase.length>0&&!u?f(t.knowledgeBase[0].id):t.knowledgeBase.length===0&&f(null))},[t==null?void 0:t.knowledgeBase,u]),!n||!t)return null;const b=a.find(M=>M.id===u),w=(M,R,_)=>{const j=a.map(P=>P.id===M?{...P,[R]:_}:P);l(j)},S=()=>{s(a)},N=(M,R)=>{const _={id:crypto.randomUUID(),name:M?`New ${M}`:"New Sheet",content:R||"",category:M||"Other"};l([...a,_]),f(_.id),g(!1)},C=M=>{const R=a.filter(_=>_.id!==M);l(R),u===M&&f(R.length>0?R[0].id:null),s(R)};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl w-full max-w-6xl h-[90vh] flex flex-col border border-zinc-200 dark:border-zinc-700",onClick:M=>M.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-zinc-200 dark:border-zinc-700 flex-shrink-0",children:[d.jsxs("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100 flex items-center space-x-2",children:[d.jsx(H,{name:"BRAIN",className:"text-indigo-500"}),d.jsxs("span",{children:['Knowledge Base for "',t.topic,'"']})]}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("div",{className:"flex-grow flex overflow-hidden",children:[d.jsxs("div",{className:"w-1/4 flex flex-col border-r border-zinc-200 dark:border-zinc-700",children:[d.jsxs("div",{className:"p-2 flex-shrink-0 relative",children:[d.jsxs("button",{onClick:()=>g(M=>!M),className:"w-full text-sm font-semibold p-2 rounded-md bg-indigo-100 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-200 hover:bg-indigo-200 dark:hover:bg-indigo-900 flex items-center justify-center space-x-1",children:[d.jsx(H,{name:"PLUS",className:"w-4 h-4"}),d.jsx("span",{children:"Add New Sheet"})]}),p&&d.jsxs("div",{className:"absolute z-10 top-full mt-1 w-full bg-white dark:bg-zinc-700 rounded-md shadow-lg border border-zinc-200 dark:border-zinc-600 p-1",children:[d.jsx("button",{onClick:()=>N("Other",""),className:"w-full text-left text-sm p-2 rounded hover:bg-zinc-100 dark:hover:bg-zinc-600",children:"Blank Sheet"}),d.jsx("div",{className:"my-1 h-px bg-zinc-200 dark:bg-zinc-600"}),d.jsx("h4",{className:"px-2 py-1 text-xs font-semibold text-zinc-500 dark:text-zinc-400",children:"From Template..."}),d.jsx("button",{onClick:()=>N("Plot & Narrative Structure",CJ),className:"w-full text-left text-sm p-2 rounded hover:bg-zinc-100 dark:hover:bg-zinc-600",children:"Plot & Narrative"}),d.jsx("button",{onClick:()=>N("Theme & Tone",AJ),className:"w-full text-left text-sm p-2 rounded hover:bg-zinc-100 dark:hover:bg-zinc-600",children:"Theme & Tone"}),d.jsx("button",{onClick:()=>N("Value System & Beliefs",vJ),className:"w-full text-left text-sm p-2 rounded hover:bg-zinc-100 dark:hover:bg-zinc-600",children:"Value System"}),d.jsx("button",{onClick:()=>N("History & Timeline",SJ),className:"w-full text-left text-sm p-2 rounded hover:bg-zinc-100 dark:hover:bg-zinc-600",children:"History & Timeline"}),d.jsx("button",{onClick:()=>N("Culture & Society",kJ),className:"w-full text-left text-sm p-2 rounded hover:bg-zinc-100 dark:hover:bg-zinc-600",children:"Culture & Society"}),d.jsx("button",{onClick:()=>N("Technology & Magic Systems",wJ),className:"w-full text-left text-sm p-2 rounded hover:bg-zinc-100 dark:hover:bg-zinc-600",children:"Tech & Magic"})]})]}),d.jsx("ul",{className:"overflow-y-auto flex-grow p-2",children:a.map(M=>d.jsx("li",{children:d.jsx("button",{onClick:()=>f(M.id),className:`w-full text-left p-2 rounded-md text-sm truncate ${u===M.id?"bg-indigo-500 text-white":"hover:bg-zinc-100 dark:hover:bg-zinc-700"}`,children:M.name})},M.id))})]}),d.jsx("div",{className:"w-1/2 flex flex-col",children:b?d.jsxs("div",{className:"flex-grow flex flex-col p-4 space-y-2",children:[d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("input",{value:b.name,onChange:M=>w(b.id,"name",M.target.value),onBlur:S,className:"text-lg font-bold bg-transparent focus:outline-none focus:ring-1 focus:ring-indigo-500 rounded-sm p-1 w-full"}),d.jsx("select",{value:b.category||"Other",onChange:M=>w(b.id,"category",M.target.value),onBlur:S,className:"text-xs bg-zinc-100 dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",children:yJ.map(M=>d.jsx("option",{value:M,children:M},M))})]}),d.jsx("textarea",{value:b.content,onChange:M=>w(b.id,"content",M.target.value),onBlur:S,placeholder:"Enter details for this knowledge sheet. You can link to other sheets using [[Sheet Name]].",className:"text-sm text-zinc-600 dark:text-zinc-400 mt-2 flex-grow resize-none bg-transparent focus:outline-none focus:ring-1 focus:ring-indigo-500 rounded-sm p-1 w-full"}),d.jsx("button",{onClick:()=>C(b.id),className:"mt-2 text-red-500 text-xs self-start hover:underline",children:"Delete Sheet"})]}):d.jsx("div",{className:"flex items-center justify-center h-full text-zinc-500",children:d.jsx("p",{children:"Select or create a sheet to get started."})})}),d.jsx("div",{className:"w-1/4 border-l border-zinc-200 dark:border-zinc-700 flex flex-col",children:d.jsx(NF,{sheets:a,onNodeClick:f})})]}),d.jsxs("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-700 flex justify-between items-center flex-shrink-0",children:[o&&d.jsxs("button",{onClick:i,disabled:r,className:"flex items-center space-x-2 text-sm font-semibold py-2 px-3 rounded-md bg-indigo-100 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-200 hover:bg-indigo-200 dark:hover:bg-indigo-900 disabled:opacity-50",children:[d.jsx(H,{name:r?"ROTATE_CW":"WAND",className:`w-4 h-4 ${r?"animate-spin":""}`}),d.jsx("span",{children:r?"Analyzing...":"Auto-fill from Content"})]}),d.jsx("button",{onClick:e,className:"bg-indigo-600 text-white px-6 py-2 rounded-lg shadow font-semibold hover:bg-indigo-700",children:"Done"})]})]})})},cN=n=>!n||!n.trim()?0:n.trim().split(/\s+/).filter(Boolean).length,ple=()=>{const{book:n,activeEditorInstance:e,activeChapterIndex:t}=Xt(),[s,i]=T.useState(0);T.useEffect(()=>{var g;if(!e){const b=((g=n==null?void 0:n.content[t])==null?void 0:g.htmlContent)||"",w=document.createElement("div");w.innerHTML=b,i(cN(w.textContent||""));return}const p=()=>{const b=e.state.doc.textContent;i(cN(b))};return p(),e.on("update",p),()=>{e.off("update",p)}},[e,t,n==null?void 0:n.content]);const r=T.useMemo(()=>!n||!n.content?0:n.content.reduce((p,g)=>{if(!g)return p;const b=document.createElement("div");b.innerHTML=g.htmlContent;const w=b.textContent||"";return p+cN(w)},0),[n==null?void 0:n.content]);if(!n||n.outline.length===0)return null;const o=n.wordCountGoal||0,a=o>0?` / ${o.toLocaleString()}`:"",l=p=>{const g=document.getElementById(`chapter-${p}`);g&&g.scrollIntoView({behavior:"smooth",block:"start"})},u=()=>{t>0&&l(t-1)},f=()=>{t<n.outline.length-1&&l(t+1)};return d.jsx("div",{className:"flex-shrink-0 bg-white/90 dark:bg-zinc-800/90 backdrop-blur-md border-t border-zinc-200 dark:border-zinc-700 z-30",children:d.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:d.jsxs("div",{className:"flex items-center justify-between h-12 text-sm text-zinc-600 dark:text-zinc-400",children:[d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("button",{onClick:u,disabled:t===0,className:"p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 disabled:opacity-30",title:"Previous Chapter",children:d.jsx(H,{name:"CHEVRON_LEFT",className:"w-4 h-4"})}),d.jsxs("div",{className:"relative group",children:[d.jsx("select",{value:t,onChange:p=>l(parseInt(p.target.value)),className:"appearance-none bg-transparent border-none py-1 pl-2 pr-8 text-sm font-semibold focus:ring-0 cursor-pointer text-zinc-800 dark:text-zinc-200 hover:bg-zinc-100 dark:hover:bg-zinc-700 rounded-md transition-colors max-w-[12rem] sm:max-w-xs truncate",children:n.outline.map((p,g)=>d.jsxs("option",{value:g,children:[g+1,". ",p.title]},g))}),d.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none",children:d.jsx(H,{name:"CHEVRON_LEFT",className:"w-3 h-3 transform -rotate-90 opacity-50"})})]}),d.jsx("button",{onClick:f,disabled:t===n.outline.length-1,className:"p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 disabled:opacity-30",title:"Next Chapter",children:d.jsx(H,{name:"CHEVRON_RIGHT",className:"w-4 h-4"})})]}),d.jsxs("div",{className:"flex items-center space-x-4",children:[d.jsxs("span",{className:"hidden sm:inline text-xs",children:["Chapter: ",d.jsx("span",{className:"font-medium text-zinc-800 dark:text-zinc-200",children:s.toLocaleString()})," words"]}),d.jsx("div",{className:"h-4 w-px bg-zinc-300 dark:bg-zinc-600 hidden sm:block"}),d.jsxs("span",{className:"text-xs",children:["Total: ",d.jsx("span",{className:"font-medium text-zinc-800 dark:text-zinc-200",children:r.toLocaleString()}),a," words"]})]})]})})})},mle=()=>{const{suggestionToGenerate:n,closeImageSuggestionModal:e,book:t,isLoading:s,generateImageFromSuggestion:i}=Xt(),[r,o]=T.useState("");if(T.useEffect(()=>{n&&o(n.prompt)},[n]),!n||!t)return null;const a=()=>{r.trim()&&i(r)};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-2xl max-h-[90vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:l=>l.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Generate Image"}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Book's Default Image Style"}),d.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400 p-2 bg-gray-50 dark:bg-gray-700/50 rounded-md border border-gray-200 dark:border-gray-600",children:t.imageGenerationInstructions})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"prompt",className:"block text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Image Prompt"}),d.jsx("textarea",{id:"prompt",value:r,onChange:l=>o(l.target.value),rows:5,className:"mt-1 block w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., A towering, moss-covered castle at sunset..."}),d.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Refine the AI's suggested prompt before generating the image."})]})]}),d.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3",children:[d.jsx("button",{onClick:e,disabled:s,className:"bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors disabled:opacity-50",children:"Cancel"}),d.jsxs("button",{onClick:a,disabled:s,className:"bg-blue-600 text-white px-6 py-2 rounded-lg shadow font-semibold hover:bg-blue-700 transition-colors flex items-center space-x-2 disabled:opacity-50",children:[d.jsx(H,{name:"WAND",className:`w-5 h-5 ${s?"animate-spin":""}`}),d.jsx("span",{children:s?"Generating...":"Generate Image"})]})]})]})})},gle=({isOpen:n,onClose:e})=>n?d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[10003] p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl p-6 w-full max-w-2xl max-h-[90vh] flex flex-col border border-zinc-200 dark:border-zinc-700",onClick:t=>t.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-zinc-200 dark:border-zinc-700",children:[d.jsxs("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100 flex items-center gap-2",children:[d.jsx(H,{name:"INFO",className:"w-6 h-6 text-indigo-500"}),"Voice Prompting Guide"]}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700","aria-label":"Close",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("div",{className:"flex-grow overflow-y-auto pr-2 space-y-6 text-zinc-700 dark:text-zinc-300",children:[d.jsx("section",{children:d.jsx("p",{className:"mb-4",children:"You can guide the AI narrator's performance by providing specific instructions about the tone, pace, and emotion. Think of this like giving direction to a voice actor in a studio."})}),d.jsxs("section",{children:[d.jsx("h3",{className:"font-bold text-lg text-zinc-900 dark:text-zinc-100 mb-2",children:"Key Elements to Include"}),d.jsxs("ul",{className:"list-disc pl-5 space-y-1 text-sm",children:[d.jsxs("li",{children:[d.jsx("strong",{children:"Tone:"})," Cheerful, somber, sarcastic, authoritative, whispering, shouting."]}),d.jsxs("li",{children:[d.jsx("strong",{children:"Pace:"})," Fast, slow, erratic, steady."]}),d.jsxs("li",{children:[d.jsx("strong",{children:"Emotion:"})," Angry, sad, excited, fearful, bored."]}),d.jsxs("li",{children:[d.jsx("strong",{children:"Character:"}),' "Like an old wizard," "Like a news anchor," "Like a tired soldier."']})]})]}),d.jsxs("section",{children:[d.jsx("h3",{className:"font-bold text-lg text-zinc-900 dark:text-zinc-100 mb-3",children:"Example Prompts"}),d.jsxs("div",{className:"grid gap-3",children:[d.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-700/50 p-3 rounded-lg border border-zinc-200 dark:border-zinc-600",children:[d.jsx("span",{className:"block text-xs font-bold text-indigo-600 dark:text-indigo-400 uppercase mb-1",children:"Fiction / Fantasy"}),d.jsx("p",{className:"text-sm italic",children:'"Speak with a deep, gravelly voice, slowly and ominously, as if telling a ghost story around a campfire."'})]}),d.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-700/50 p-3 rounded-lg border border-zinc-200 dark:border-zinc-600",children:[d.jsx("span",{className:"block text-xs font-bold text-indigo-600 dark:text-indigo-400 uppercase mb-1",children:"Non-Fiction / Educational"}),d.jsx("p",{className:"text-sm italic",children:'"Use a clear, professional, and articulate tone. Maintain a steady pace suitable for teaching complex topics."'})]}),d.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-700/50 p-3 rounded-lg border border-zinc-200 dark:border-zinc-600",children:[d.jsx("span",{className:"block text-xs font-bold text-indigo-600 dark:text-indigo-400 uppercase mb-1",children:"Children's Book"}),d.jsx("p",{className:"text-sm italic",children:'"Narrate in a high-pitched, enthusiastic, and bouncy voice. Express exaggerated excitement and wonder."'})]}),d.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-700/50 p-3 rounded-lg border border-zinc-200 dark:border-zinc-600",children:[d.jsx("span",{className:"block text-xs font-bold text-indigo-600 dark:text-indigo-400 uppercase mb-1",children:"Thriller / Noir"}),d.jsx("p",{className:"text-sm italic",children:'"A hushed, gritty whisper. Fast-paced and urgent, conveying a sense of paranoia."'})]})]})]})]}),d.jsx("div",{className:"pt-6 mt-4 border-t border-zinc-200 dark:border-zinc-700 flex justify-end",children:d.jsx("button",{onClick:e,className:"bg-indigo-600 text-white px-6 py-2 rounded-lg shadow font-semibold hover:bg-indigo-700 transition-colors",children:"Got it"})})]})}):null;function xle(n){const e=atob(n),t=e.length,s=new Uint8Array(t);for(let i=0;i<t;i++)s[i]=e.charCodeAt(i);return s}function ble(n,e,t,s){const i=e*t*(s/8),r=t*(s/8),o=n.length,a=36+o,l=new ArrayBuffer(44+o),u=new DataView(l);u.setUint8(0,82),u.setUint8(1,73),u.setUint8(2,70),u.setUint8(3,70),u.setUint32(4,a,!0),u.setUint8(8,87),u.setUint8(9,65),u.setUint8(10,86),u.setUint8(11,69),u.setUint8(12,102),u.setUint8(13,109),u.setUint8(14,116),u.setUint8(15,32),u.setUint32(16,16,!0),u.setUint16(20,1,!0),u.setUint16(22,t,!0),u.setUint32(24,e,!0),u.setUint32(28,i,!0),u.setUint16(32,r,!0),u.setUint16(34,s,!0),u.setUint8(36,100),u.setUint8(37,97),u.setUint8(38,116),u.setUint8(39,97),u.setUint32(40,o,!0);const f=new Uint8Array(n.buffer);for(let p=0;p<o;p++)u.setUint8(44+p,f[p]);return new Blob([u],{type:"audio/wav"})}class yle{constructor(){this.state={status:"idle",progress:0,message:"",error:null,bookTitle:"",totalFiles:0,completedFiles:0},this.subscribers=new Set,this.abortController=null,this.currentZip=null}subscribe(e){return this.subscribers.add(e),e(this.state),()=>{this.subscribers.delete(e)}}notify(){this.subscribers.forEach(e=>e(this.state))}setState(e){this.state={...this.state,...e},this.notify()}async startDownload(e,t,s,i){if(this.state.status==="generating"||this.state.status==="zipping"){te.info("A download is already in progress.");return}this.currentZip=new JSZip,this.abortController=new AbortController,this.setState({status:"generating",progress:0,message:"Initializing...",error:null,bookTitle:e,totalFiles:t.length,completedFiles:0});try{for(let r=0;r<t.length;r++){if(this.abortController.signal.aborted){this.setState({status:"cancelled",message:"Download cancelled."});return}const o=t[r];this.setState({message:`Generating Chapter ${o.chapterIndex}: ${o.title}`,progress:r/t.length*100});const a=document.createElement("div");a.innerHTML=o.htmlContent;const l=Array.from(a.querySelectorAll("p, h1, h2, h3, h4, li")).map(u=>u.textContent).join(" ");if(l.trim()){const u=await h_(l,s,i);if(this.abortController.signal.aborted)return;const f=xle(u),p=ble(f,24e3,1,16),g=`Chapter_${String(o.chapterIndex).padStart(2,"0")}_${o.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.wav`;this.currentZip.file(g,p)}this.setState({completedFiles:r+1})}if(this.abortController.signal.aborted)return;this.setState({status:"zipping",message:"Zipping files...",progress:100}),await this.finalizeDownload()}catch(r){console.error("Audiobook generation failed:",r),this.setState({status:"error",error:r.message||"Unknown error occurred.",message:"Generation failed. You can download partial results."})}}async cancel(){this.abortController&&this.abortController.abort(),this.setState({status:"cancelled",message:"Cancelled by user."}),this.currentZip=null,setTimeout(()=>this.reset(),3e3)}async downloadPartial(){if(!this.currentZip||Object.keys(this.currentZip.files).length===0){te.info("No files were generated to download.");return}this.setState({status:"zipping",message:"Zipping partial files..."});try{await this.finalizeDownload()}catch(e){te.error("Failed to zip partial files."),this.setState({status:"error",error:e.message})}}reset(){this.currentZip=null,this.setState({status:"idle",progress:0,message:"",error:null,bookTitle:"",totalFiles:0,completedFiles:0})}async finalizeDownload(){if(!this.currentZip)return;const e=await this.currentZip.generateAsync({type:"blob"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=`${this.state.bookTitle.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_audiobook.zip`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(t.href),this.setState({status:"completed",message:"Download complete!"}),te.success("Audiobook download complete!"),setTimeout(()=>{this.state.status==="completed"&&this.reset()},5e3)}}const ep=new yle;function vle(n){const e=atob(n),t=e.length,s=new Uint8Array(t);for(let i=0;i<t;i++)s[i]=e.charCodeAt(i);return s}function wle(n,e,t,s){const i=e*t*(s/8),r=t*(s/8),o=n.length,a=36+o,l=new ArrayBuffer(44+o),u=new DataView(l);u.setUint8(0,82),u.setUint8(1,73),u.setUint8(2,70),u.setUint8(3,70),u.setUint32(4,a,!0),u.setUint8(8,87),u.setUint8(9,65),u.setUint8(10,86),u.setUint8(11,69),u.setUint8(12,102),u.setUint8(13,109),u.setUint8(14,116),u.setUint8(15,32),u.setUint32(16,16,!0),u.setUint16(20,1,!0),u.setUint16(22,t,!0),u.setUint32(24,e,!0),u.setUint32(28,i,!0),u.setUint16(32,r,!0),u.setUint16(34,s,!0),u.setUint8(36,100),u.setUint8(37,97),u.setUint8(38,116),u.setUint8(39,97),u.setUint32(40,o,!0);const f=new Uint8Array(n.buffer);for(let p=0;p<o;p++)u.setUint8(44+p,f[p]);return new Blob([u],{type:"audio/wav"})}const kle=()=>{const{isDownloadModalOpen:n,setIsDownloadModalOpen:e,book:t,geminiTTSVoices:s,downloadModalInitialSelection:i,handleUpdateVoiceStyle:r}=Xt(),[o,a]=T.useState(s[0]||"Kore"),[l,u]=T.useState(!1),[f,p]=T.useState(""),[g,b]=T.useState(!1),[w,S]=T.useState(!1),[N,C]=T.useState("all"),[M,R]=T.useState(new Set);if(T.useEffect(()=>{n&&t&&(t.voiceStyleInstructions&&p(t.voiceStyleInstructions),i&&i.length>0?(C("selection"),R(new Set(i))):(C("all"),R(new Set)))},[n,i,t]),!n||!t)return null;const _=()=>{f!==t.voiceStyleInstructions&&r(f),e(!1)},j=async()=>{if(!l){u(!0);try{const q=`This is a preview of the ${o} voice. ${f?"Checking style instructions.":""}`,G=await h_(q,o,f),ee=vle(G),W=wle(ee,24e3,1,16),Q=URL.createObjectURL(W);await new Audio(Q).play()}catch(q){te.error(`Preview failed: ${q.message}`)}finally{u(!1)}}},P=async()=>{if(t){b(!0);try{const q=t.content.find(W=>W&&W.htmlContent.length>100);let G="";if(q){const W=document.createElement("div");W.innerHTML=q.htmlContent,G=W.textContent||""}else G=t.description||t.instructions;const ee=await YK(t.topic,G);p(ee),te.success("Voice instructions generated!")}catch{te.error("Failed to generate instructions.")}finally{b(!1)}}},D=q=>{const G=new Set(M);G.has(q)?G.delete(q):G.add(q),R(G)},U=()=>{M.size===t.content.length?R(new Set):R(new Set(t.content.map((q,G)=>G)))},V=async()=>{f!==t.voiceStyleInstructions&&r(f);let q=[];if(N==="all"?q=t.content.map((ee,W)=>({content:ee,index:W})).filter(ee=>ee.content&&ee.content.htmlContent.trim()):q=t.content.map((ee,W)=>({content:ee,index:W})).filter(ee=>M.has(ee.index)&&ee.content&&ee.content.htmlContent.trim()),q.length===0){te.info("No chapters selected or content is empty.");return}const G=q.map(({content:ee,index:W})=>({chapterIndex:W+1,title:ee.title,htmlContent:ee.htmlContent}));await ep.startDownload(t.topic,G,o,f),te.success("Download started in background."),e(!1)};return d.jsxs(d.Fragment,{children:[d.jsx(gle,{isOpen:w,onClose:()=>S(!1)}),d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[10002] p-4 animate-fade-in",onClick:_,children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl p-6 w-full max-w-lg border border-zinc-200 dark:border-zinc-700 flex flex-col max-h-[90vh]",onClick:q=>q.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-zinc-200 dark:border-zinc-700 flex-shrink-0",children:[d.jsx("h2",{className:"text-2xl font-bold text-zinc-800 dark:text-zinc-100",children:"Download Audiobook"}),d.jsx("button",{onClick:_,className:"p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("div",{className:"flex-grow overflow-y-auto pr-1 space-y-5",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"voice-select",className:"block text-sm font-bold text-zinc-700 dark:text-zinc-300 mb-2",children:"Narrator Voice"}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("select",{id:"voice-select",value:o,onChange:q=>a(q.target.value),className:"flex-grow block w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",children:s.map(q=>d.jsx("option",{value:q,children:q},q))}),d.jsx("button",{onClick:j,disabled:l,className:"px-3 py-2 bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-200 rounded-md hover:bg-indigo-200 dark:hover:bg-indigo-800 transition-colors flex items-center disabled:opacity-50",title:"Preview Voice with current instructions",children:l?d.jsx(H,{name:"ROTATE_CW",className:"w-4 h-4 animate-spin"}):d.jsx(H,{name:"PLAY",className:"w-4 h-4"})})]})]}),d.jsxs("div",{children:[d.jsxs("div",{className:"flex justify-between items-center mb-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("label",{htmlFor:"voice-instructions",className:"text-sm font-bold text-zinc-700 dark:text-zinc-300",children:"Voice Style Instructions"}),d.jsx("button",{onClick:()=>S(!0),className:"text-zinc-400 hover:text-indigo-500 transition-colors",title:"How to write voice prompts",children:d.jsx(H,{name:"INFO",className:"w-4 h-4"})})]}),d.jsxs("button",{onClick:P,disabled:g,className:"flex items-center space-x-1 text-xs font-semibold text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 disabled:opacity-50",title:"Generate instructions based on book content",children:[d.jsx(H,{name:"WAND",className:`w-3 h-3 ${g?"animate-spin":""}`}),d.jsx("span",{children:"Auto-Generate"})]})]}),d.jsx("textarea",{id:"voice-instructions",value:f,onChange:q=>p(q.target.value),rows:3,className:"w-full bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm placeholder-zinc-400",placeholder:'e.g., "A deep, gravelly voice, slow and ominous."'})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-bold text-zinc-700 dark:text-zinc-300 mb-2",children:"Download Scope"}),d.jsxs("div",{className:"flex space-x-4 mb-3",children:[d.jsxs("label",{className:"flex items-center cursor-pointer",children:[d.jsx("input",{type:"radio",name:"downloadMode",checked:N==="all",onChange:()=>C("all"),className:"text-indigo-600 focus:ring-indigo-500"}),d.jsx("span",{className:"ml-2 text-sm text-zinc-700 dark:text-zinc-300",children:"Full Book"})]}),d.jsxs("label",{className:"flex items-center cursor-pointer",children:[d.jsx("input",{type:"radio",name:"downloadMode",checked:N==="selection",onChange:()=>C("selection"),className:"text-indigo-600 focus:ring-indigo-500"}),d.jsx("span",{className:"ml-2 text-sm text-zinc-700 dark:text-zinc-300",children:"Specific Chapters"})]})]}),N==="selection"&&d.jsxs("div",{className:"border border-zinc-200 dark:border-zinc-700 rounded-md p-2 max-h-48 overflow-y-auto bg-zinc-50 dark:bg-zinc-900/50",children:[d.jsxs("div",{className:"flex justify-between items-center px-2 pb-2 mb-2 border-b border-zinc-200 dark:border-zinc-700",children:[d.jsx("span",{className:"text-xs font-semibold text-zinc-500 uppercase",children:"Select Chapters"}),d.jsx("button",{onClick:U,className:"text-xs text-indigo-600 hover:underline",children:M.size===t.content.length?"Deselect All":"Select All"})]}),d.jsx("div",{className:"space-y-1",children:t.outline.map((q,G)=>d.jsxs("label",{className:"flex items-center space-x-3 p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:M.has(G),onChange:()=>D(G),className:"rounded border-zinc-300 text-indigo-600 focus:ring-indigo-500"}),d.jsxs("span",{className:"text-sm text-zinc-700 dark:text-zinc-300 truncate",children:[G+1,". ",q.title]})]},G))})]})]}),d.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 bg-zinc-50 dark:bg-zinc-700/30 p-3 rounded-md",children:"Audiobook generation will run in the background. You can continue working while it downloads."})]}),d.jsxs("div",{className:"mt-6 pt-4 border-t border-zinc-200 dark:border-zinc-700 flex justify-end space-x-3 flex-shrink-0",children:[d.jsx("button",{onClick:_,className:"bg-zinc-200 dark:bg-zinc-600 text-zinc-800 dark:text-zinc-100 px-4 py-2 rounded-lg font-semibold hover:bg-zinc-300 dark:hover:bg-zinc-500 transition-colors",children:"Cancel"}),d.jsxs("button",{onClick:V,disabled:N==="selection"&&M.size===0,className:"bg-teal-600 text-white px-6 py-2 rounded-lg shadow font-semibold hover:bg-teal-700 transition-colors flex items-center space-x-2 disabled:opacity-50 disabled:bg-teal-800",children:[d.jsx(H,{name:"DOWNLOAD",className:"w-5 h-5"}),d.jsx("span",{children:"Start Background Download"})]})]})]})})]})},Sle=()=>{const{isTextToImageModalOpen:n,setIsTextToImageModalOpen:e,textToImageContext:t,book:s,handleInsertGeneratedImage:i}=Xt(),[r,o]=T.useState(""),[a,l]=T.useState(""),[u,f]=T.useState("16:9"),[p,g]=T.useState(null),[b,w]=T.useState(!1),[S,N]=T.useState(""),[C,M]=T.useState(!1);if(T.useEffect(()=>{n&&t&&s&&(o(t.text),l(s.imageGenerationInstructions||"Photorealistic, cinematic lighting"),g(null),N(""))},[n,t,s]),!n||!t)return null;const R=async()=>{if(r.trim()){w(!0);try{const D=await yY(r,a,u);g(D)}catch(D){te.error(`Generation failed: ${D.message}`)}finally{w(!1)}}},_=async()=>{if(!(!p||!S.trim())){M(!0);try{const D=await vY(p,S);g(D),N(""),te.success("Image refined.")}catch(D){te.error(`Refinement failed: ${D.message}`)}finally{M(!1)}}},j=()=>{p&&i(p,r)},P=()=>{e(!1)};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[2000] p-4 animate-fade-in",onClick:P,children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col border border-zinc-200 dark:border-zinc-700",onClick:D=>D.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-zinc-200 dark:border-zinc-700 flex-shrink-0",children:[d.jsxs("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100 flex items-center gap-2",children:[d.jsx(H,{name:"IMAGE_PLUS",className:"w-6 h-6 text-indigo-500"}),"Generate Illustration from Text"]}),d.jsx("button",{onClick:P,className:"p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700","aria-label":"Close",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("div",{className:"flex-grow overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-6 pr-2",children:[d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-bold text-zinc-700 dark:text-zinc-300 mb-1",children:"Image Description"}),d.jsx("textarea",{value:r,onChange:D=>o(D.target.value),rows:4,className:"w-full bg-white dark:bg-zinc-700 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",placeholder:"Describe the scene..."})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-bold text-zinc-700 dark:text-zinc-300 mb-1",children:"Art Style"}),d.jsx("textarea",{value:a,onChange:D=>l(D.target.value),rows:2,className:"w-full bg-white dark:bg-zinc-700 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",placeholder:"e.g. Watercolor, Photorealistic..."})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-bold text-zinc-700 dark:text-zinc-300 mb-1",children:"Aspect Ratio"}),d.jsxs("select",{value:u,onChange:D=>f(D.target.value),className:"w-full bg-white dark:bg-zinc-700 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm p-2",children:[d.jsx("option",{value:"16:9",children:"Landscape (16:9)"}),d.jsx("option",{value:"1:1",children:"Square (1:1)"}),d.jsx("option",{value:"4:3",children:"Standard (4:3)"}),d.jsx("option",{value:"3:4",children:"Portrait (3:4)"})]})]}),d.jsx("button",{onClick:R,disabled:b||!r.trim(),className:"w-full bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition-colors flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:b?d.jsxs(d.Fragment,{children:[d.jsx(H,{name:"ROTATE_CW",className:"w-5 h-5 animate-spin"}),d.jsx("span",{children:"Generating..."})]}):d.jsxs(d.Fragment,{children:[d.jsx(H,{name:"WAND",className:"w-5 h-5"}),d.jsx("span",{children:p?"Regenerate":"Generate"})]})}),p&&d.jsxs("div",{className:"pt-4 border-t border-zinc-200 dark:border-zinc-700",children:[d.jsx("h3",{className:"text-sm font-bold text-zinc-700 dark:text-zinc-300 mb-2",children:"Fine-Tune Image"}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{type:"text",value:S,onChange:D=>N(D.target.value),placeholder:"e.g. Make it brighter, remove the tree...",className:"flex-grow bg-white dark:bg-zinc-700 border border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm text-sm px-3 py-2"}),d.jsx("button",{onClick:_,disabled:C||!S.trim(),className:"bg-zinc-200 dark:bg-zinc-600 text-zinc-800 dark:text-zinc-100 px-3 py-2 rounded-md hover:bg-zinc-300 dark:hover:bg-zinc-500 transition-colors disabled:opacity-50 text-sm font-medium",children:C?"...":"Refine"})]})]})]}),d.jsx("div",{className:"flex flex-col items-center justify-center bg-zinc-100 dark:bg-zinc-900/50 rounded-lg border border-zinc-200 dark:border-zinc-700 min-h-[300px] relative overflow-hidden",children:b?d.jsx(sr,{message:"Creating your illustration..."}):p?d.jsx("img",{src:p,alt:"Generated illustration",className:"max-w-full max-h-full object-contain shadow-lg rounded-md"}):d.jsxs("div",{className:"text-center text-zinc-400 dark:text-zinc-600 p-8",children:[d.jsx(H,{name:"IMAGE",className:"w-16 h-16 mx-auto mb-2 opacity-50"}),d.jsx("p",{children:"Preview will appear here"})]})})]}),p&&d.jsxs("div",{className:"pt-4 mt-4 border-t border-zinc-200 dark:border-zinc-700 flex justify-end space-x-3",children:[d.jsx("button",{onClick:P,className:"px-4 py-2 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-100 dark:hover:bg-zinc-700 rounded-lg transition-colors",children:"Cancel"}),d.jsxs("button",{onClick:j,className:"bg-green-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-green-700 shadow-md transition-colors flex items-center space-x-2",children:[d.jsx(H,{name:"CHECK_SQUARE",className:"w-5 h-5"}),d.jsx("span",{children:"Insert Image"})]})]})]})})},Cle=({isOpen:n,onClose:e,results:t,isLoading:s,onApplySuggestion:i})=>n?d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[51] p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:r=>r.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsxs("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2",children:[d.jsx(H,{name:"USER",className:"w-6 h-6 text-indigo-500"}),"Character Voice Analysis"]}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsx("div",{className:"overflow-y-auto pr-2 -mr-2 flex-grow",children:s?d.jsxs("div",{className:"flex flex-col items-center justify-center p-8 min-h-[300px]",children:[d.jsx("div",{className:"w-12 h-12 border-4 border-t-indigo-500 border-gray-200 rounded-full animate-spin"}),d.jsx("p",{className:"mt-4 font-semibold text-gray-700 dark:text-gray-300",children:"Analyzing dialogue consistency..."})]}):t&&t.length>0?d.jsx("div",{className:"space-y-4",children:t.map((r,o)=>d.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[d.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-700/30 p-3 border-b border-zinc-200 dark:border-zinc-700 flex items-center justify-between",children:[d.jsx("span",{className:"font-bold text-indigo-600 dark:text-indigo-400",children:r.characterName}),d.jsx("span",{className:"text-xs text-red-500 font-medium",children:"Inconsistency Detected"})]}),d.jsxs("div",{className:"p-4 space-y-3",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-xs font-bold text-zinc-500 uppercase mb-1",children:"Problematic Dialogue"}),d.jsxs("p",{className:"text-sm italic text-zinc-800 dark:text-zinc-200 bg-red-50 dark:bg-red-900/20 p-2 rounded border border-red-100 dark:border-red-900/30",children:['"',r.dialogue,'"']})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs font-bold text-zinc-500 uppercase mb-1",children:"Reason"}),d.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:r.inconsistencyReason})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs font-bold text-zinc-500 uppercase mb-1",children:"Suggested Fix"}),d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsxs("p",{className:"flex-grow text-sm font-medium text-green-700 dark:text-green-300 bg-green-50 dark:bg-green-900/20 p-2 rounded border border-green-100 dark:border-green-900/30",children:['"',r.suggestedFix,'"']}),d.jsx("button",{onClick:()=>i(r.dialogue,r.suggestedFix),className:"bg-indigo-600 text-white text-xs font-semibold px-3 py-2 rounded-lg hover:bg-indigo-700 transition-colors whitespace-nowrap shadow-sm",children:"Apply"})]})]})]})]},o))}):d.jsxs("div",{className:"text-center py-12",children:[d.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx(H,{name:"CLOUD_CHECK",className:"w-8 h-8 text-green-600 dark:text-green-400"})}),d.jsx("h3",{className:"text-lg font-bold text-zinc-800 dark:text-zinc-100",children:"Excellent!"}),d.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 mt-2 max-w-md mx-auto",children:"The AI didn't find any significant inconsistencies in character voice for this chapter."})]})})]})}):null,Ale=({isOpen:n,onClose:e,results:t,isLoading:s})=>{if(!n)return null;const i=r=>{switch(r){case"High":return"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 border-red-200 dark:border-red-800";case"Medium":return"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300 border-amber-200 dark:border-amber-800";case"Low":return"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 border-blue-200 dark:border-blue-800";default:return"bg-gray-100 text-gray-700"}};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[51] p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:r=>r.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsxs("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2",children:[d.jsx(H,{name:"ALERT_TRIANGLE",className:"w-6 h-6 text-amber-500"}),"Plot Hole Detector"]}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsx("div",{className:"overflow-y-auto pr-2 -mr-2 flex-grow",children:s?d.jsxs("div",{className:"flex flex-col items-center justify-center p-8 min-h-[300px]",children:[d.jsx("div",{className:"w-12 h-12 border-4 border-t-amber-500 border-gray-200 rounded-full animate-spin"}),d.jsx("p",{className:"mt-4 font-semibold text-gray-700 dark:text-gray-300",children:"Scanning for plot inconsistencies..."})]}):t&&t.length>0?d.jsx("div",{className:"space-y-4",children:t.map((r,o)=>d.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[d.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-700/30 p-3 border-b border-zinc-200 dark:border-zinc-700 flex items-center justify-between",children:[d.jsx("span",{className:"font-bold text-zinc-800 dark:text-zinc-100",children:r.issue}),d.jsxs("span",{className:`text-xs font-bold px-2 py-0.5 rounded-full border ${i(r.severity)}`,children:[r.severity," Priority"]})]}),d.jsxs("div",{className:"p-4 space-y-3",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-xs font-bold text-zinc-500 uppercase mb-1",children:"Location"}),d.jsxs("p",{className:"text-sm italic text-zinc-800 dark:text-zinc-200 bg-zinc-100 dark:bg-zinc-800 p-2 rounded border border-zinc-200 dark:border-zinc-700",children:['"',r.location,'"']})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs font-bold text-zinc-500 uppercase mb-1",children:"Explanation"}),d.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:r.explanation})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs font-bold text-zinc-500 uppercase mb-1",children:"Suggestion"}),d.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-100 dark:border-green-900/30 rounded-md",children:d.jsx("p",{className:"text-sm text-green-800 dark:text-green-200",children:r.suggestion})})]})]})]},o))}):d.jsxs("div",{className:"text-center py-12",children:[d.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx(H,{name:"CLOUD_CHECK",className:"w-8 h-8 text-green-600 dark:text-green-400"})}),d.jsx("h3",{className:"text-lg font-bold text-zinc-800 dark:text-zinc-100",children:"Solid Plot!"}),d.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 mt-2 max-w-md mx-auto",children:"The AI didn't detect any major logical inconsistencies or contradictions in this chapter."})]})})]})})},Nle=({isOpen:n,onClose:e,results:t,isLoading:s,onApplySuggestion:i})=>n?d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[51] p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:r=>r.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsxs("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2",children:[d.jsx(H,{name:"BRAIN",className:"w-6 h-6 text-indigo-500"}),"Lore Consistency Check"]}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsx("div",{className:"overflow-y-auto pr-2 -mr-2 flex-grow",children:s?d.jsxs("div",{className:"flex flex-col items-center justify-center p-8 min-h-[300px]",children:[d.jsx("div",{className:"w-12 h-12 border-4 border-t-indigo-500 border-gray-200 rounded-full animate-spin"}),d.jsx("p",{className:"mt-4 font-semibold text-gray-700 dark:text-gray-300",children:"Checking Knowledge Base..."})]}):t&&t.length>0?d.jsx("div",{className:"space-y-4",children:t.map((r,o)=>d.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[d.jsx("div",{className:"bg-zinc-50 dark:bg-zinc-700/30 p-3 border-b border-zinc-200 dark:border-zinc-700 flex items-center justify-between",children:d.jsxs("span",{className:"font-bold text-indigo-600 dark:text-indigo-400",children:["Conflict with: ",r.knowledgeSheetName]})}),d.jsxs("div",{className:"p-4 space-y-3",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-xs font-bold text-zinc-500 uppercase mb-1",children:"Passage"}),d.jsxs("p",{className:"text-sm italic text-zinc-800 dark:text-zinc-200 bg-red-50 dark:bg-red-900/20 p-2 rounded border border-red-100 dark:border-red-900/30",children:['"',r.passage,'"']})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs font-bold text-zinc-500 uppercase mb-1",children:"Contradiction"}),d.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:r.contradiction})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs font-bold text-zinc-500 uppercase mb-1",children:"Suggested Fix"}),d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsx("p",{className:"flex-grow text-sm font-medium text-green-700 dark:text-green-300 bg-green-50 dark:bg-green-900/20 p-2 rounded border border-green-100 dark:border-green-900/30",children:r.suggestion}),d.jsx("button",{onClick:()=>i(r.passage,r.suggestion),className:"bg-indigo-600 text-white text-xs font-semibold px-3 py-2 rounded-lg hover:bg-indigo-700 transition-colors whitespace-nowrap shadow-sm",children:"Fix"})]})]})]})]},o))}):d.jsxs("div",{className:"text-center py-12",children:[d.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx(H,{name:"CLOUD_CHECK",className:"w-8 h-8 text-green-600 dark:text-green-400"})}),d.jsx("h3",{className:"text-lg font-bold text-zinc-800 dark:text-zinc-100",children:"All Clear!"}),d.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 mt-2 max-w-md mx-auto",children:"The AI didn't find any contradictions between this chapter and your Knowledge Base."})]})})]})}):null,Ele=({onSave:n,onBack:e})=>{var ic,ri,Un;const{book:t,isLoading:s,loadingMessage:i,isImageModalOpen:r,setIsImageModalOpen:o,editingImageData:a,isRegeneratingImage:l,handleRegenerateImage:u,isEpubModalOpen:f,setIsEpubModalOpen:p,handleStartEpubExport:g,handleSaveToDB:b,saveStatus:w,handleSaveAndSync:S,isSyncing:N,isBrainstormModalOpen:C,setIsBrainstormModalOpen:M,handleBrainstormComplete:R,isAnalysisModalOpen:_,setIsAnalysisModalOpen:j,analysisData:P,isAnalyzing:D,handleExecuteAnalysisAction:U,isStyleAnalysisModalOpen:V,setIsStyleAnalysisModalOpen:q,styleAnalysisResult:G,isAnalyzingStyle:ee,handleApplyStyleSuggestion:W,analyzingStyleChapterIndex:Q,isChatOpen:Z,setIsChatOpen:$,handleSendChatMessage:Y,isChatLoading:he,activeEditorInstance:Re,handleAssistantAction:ze,handleExportPdf:F,createSnapshot:J,setIsSnapshotsPanelOpen:ie,handleGenerateChapters:pe,handleGenerateFullBook:ue,activeChapterIndex:ke,handleOpenAnalysisModal:re,handleAnalyzeChapterStyle:Ge,isDeepAnalysisModalOpen:Je,setIsDeepAnalysisModalOpen:Qe,deepAnalysisResult:je,deepAnalysisType:ye,handleApplyShowTellSuggestion:Fe,isMacroResultModalOpen:Ne,setIsMacroResultModalOpen:ve,macroResults:Pe,handleApplyMacroShowTellSuggestion:ot,handleApplyMacroOpeningSuggestion:Gt,isKnowledgeBaseOpen:bn,setIsKnowledgeBaseOpen:qt,suggestionToGenerate:jt,isDownloadModalOpen:yn,isAiEnabled:_t,isTextToImageModalOpen:Qt,isCharacterVoiceAnalysisModalOpen:_s,setIsCharacterVoiceAnalysisModalOpen:Se,characterVoiceAnalysisResult:Me,isAnalyzingCharacterVoice:He,handleApplyCharacterVoiceSuggestion:Pt,isPlotHoleModalOpen:Sn,setIsPlotHoleModalOpen:as,plotHoleResults:Xn,isAnalyzingPlotHoles:De,isLoreConsistencyModalOpen:se,setIsLoreConsistencyModalOpen:Oe,loreConsistencyResults:Ke,isAnalyzingLore:me,handleApplyLoreSuggestion:xe}=Xt(),{registerCommands:Le,unregisterCommands:Ue}=OY(),[lt,Mt]=T.useState("editor"),[Ht,Cn]=T.useState(!0),Zt=T.useRef(null),[Pn,Hn]=T.useState(!0),Bi=T.useRef(0),[ys,of]=T.useState(!1),[ls,rr]=T.useState(()=>{const at=localStorage.getItem("bookEditorViewSettings");return at?JSON.parse(at):{focusMode:!1,width:"standard",font:"serif"}});T.useEffect(()=>{localStorage.setItem("bookEditorViewSettings",JSON.stringify(ls))},[ls]);const qo=T.useCallback(async()=>{await b(),n()},[b,n]),[Wo,Fa]=T.useState(Re==null?void 0:Re.state.selection);T.useEffect(()=>{if(Re){const at=({editor:vn})=>{Fa(vn.state.selection)};return Re.on("selectionUpdate",at),Fa(Re.state.selection),()=>{Re.off("selectionUpdate",at)}}},[Re]);const af=T.useMemo(()=>{if(!Wo)return!0;const{from:at,to:vn}=Wo;return at===vn},[Wo]);return T.useEffect(()=>{if(!t)return;const at=[{id:"save-close",name:"Save and Close",section:"File",icon:Tn.SAVE,action:qo},{id:"export-pdf",name:"Export: Export as PDF",section:"Export",icon:Tn.DOWNLOAD,action:F},{id:"export-epub",name:"Export: Export as ePub",section:"Export",icon:Tn.BOOK,action:()=>p(!0)},{id:"snapshot-create",name:"Version: Create new snapshot",section:"Versioning",icon:Tn.SAVE,action:()=>{Mn.prompt({title:"Create Snapshot",inputLabel:"Snapshot Name",initialValue:`Snapshot ${new Date().toLocaleString()}`}).then(vn=>{vn&&J(vn)})}},{id:"snapshot-view",name:"Version: View version history",section:"Versioning",icon:Tn.HISTORY,action:()=>ie(!0)},{id:"focus-mode",name:"View: Toggle Focus Mode",section:"View",icon:Tn.LAYOUT,action:()=>rr(vn=>({...vn,focusMode:!vn.focusMode}))}];return _t&&(at.push({id:"chat-open",name:"AI: Open assistant chat",section:"AI Actions",icon:Tn.MESSAGE_CIRCLE,action:()=>$(!0)}),t.status!=="complete"&&at.push({id:"gen-next-chapter",name:"Generate: Write next chapter",section:"Generation",icon:Tn.WAND,action:()=>pe()},{id:"gen-full-book",name:"Generate: Write all remaining chapters",section:"Generation",icon:Tn.SPARKLES,action:()=>ue()}),t.content.length>0&&at.push({id:"analyze-chapter",name:`Analyze: Analyze Chapter ${ke+1}`,section:"AI Actions",icon:Tn.SPARKLES,action:()=>re(ke)}),af?at.push({id:"ai-suggest",name:"AI: Continue writing",keywords:"suggest",section:"AI Actions",icon:Tn.WAND,action:()=>ze("suggest")}):at.push({id:"ai-rephrase",name:"AI: Rephrase selection",section:"AI Actions",icon:Tn.REPHRASE,action:()=>ze("rephrase")},{id:"ai-expand",name:"AI: Expand selection",section:"AI Actions",icon:Tn.EXPAND,action:()=>ze("expand")},{id:"ai-summarize",name:"AI: Summarize selection",section:"AI Actions",icon:Tn.SUMMARIZE,action:()=>ze("summarize")},{id:"ai-tone-formal",name:"AI: Change tone to Formal",section:"AI Actions",icon:Tn.TONE,action:()=>ze({type:"tone",tone:"Formal"})},{id:"ai-tone-casual",name:"AI: Change tone to Casual",section:"AI Actions",icon:Tn.TONE,action:()=>ze({type:"tone",tone:"Casual"})})),Le(at),()=>Ue(at.map(vn=>vn.id))},[t==null?void 0:t.status,t==null?void 0:t.content.length,Wo,ke,Le,Ue,qo,F,p,J,ie,$,pe,ue,re,ze,_t]),T.useEffect(()=>{const at=Zt.current;if(!at)return;const vn=()=>{const Ko=at.scrollTop;Ko>Bi.current&&Ko>100?Pn&&Hn(!1):Pn||Hn(!0),Bi.current=Ko<=0?0:Ko};return at.addEventListener("scroll",vn,{passive:!0}),()=>{at.removeEventListener("scroll",vn)}},[Pn]),T.useEffect(()=>{const at=()=>of(!1);return ys&&window.addEventListener("click",at),()=>window.removeEventListener("click",at)},[ys]),t?d.jsxs("div",{className:"flex h-screen overflow-hidden",children:[s&&d.jsx(sr,{message:i}),r&&a&&d.jsx(Hoe,{isOpen:r,onClose:()=>o(!1),currentImageUrl:a.src,imageGenerationInstructions:t.imageGenerationInstructions,onRegenerate:u,isGenerating:l}),f&&d.jsx(Uoe,{isOpen:f,onClose:()=>p(!1),onExport:g,book:t}),C&&d.jsx(Kae,{isOpen:C,onClose:()=>M(!1),book:t,onOutlineGenerated:R}),_&&t&&d.jsx(Yae,{isOpen:_,onClose:()=>j(!1),chapterTitle:((ic=t.outline[P.chapterIndex])==null?void 0:ic.title)||"",analysisResult:P.result,isLoading:D,onExecuteAction:U}),V&&t&&d.jsx(Jae,{isOpen:V,onClose:()=>q(!1),chapterTitle:((ri=t.outline[Q??0])==null?void 0:ri.title)||"",analysisResult:G,isLoading:ee,onApplySuggestion:W}),Je&&t&&d.jsx(tle,{isOpen:Je,onClose:()=>Qe(!1),chapterTitle:((Un=t.outline[P.chapterIndex])==null?void 0:Un.title)||"",analysisType:ye,analysisData:je,onApplySuggestion:Fe}),_s&&t&&d.jsx(Cle,{isOpen:_s,onClose:()=>Se(!1),results:Me,isLoading:He,onApplySuggestion:Pt}),Sn&&t&&d.jsx(Ale,{isOpen:Sn,onClose:()=>as(!1),results:Xn,isLoading:De}),se&&t&&d.jsx(Nle,{isOpen:se,onClose:()=>Oe(!1),results:Ke,isLoading:me,onApplySuggestion:xe}),Ne&&d.jsx(ole,{isOpen:Ne,onClose:()=>ve(!1),results:Pe,onApplyShowTellSuggestion:ot,onApplyOpeningSuggestion:Gt}),t&&_t&&d.jsx(ele,{isOpen:Z,onClose:()=>$(!1),messages:t.bookChatHistory||[],onSendMessage:Y,isLoading:he}),jt&&d.jsx(mle,{}),yn&&d.jsx(kle,{}),Qt&&d.jsx(Sle,{}),d.jsx(fle,{isOpen:bn,onClose:()=>qt(!1)}),d.jsx($oe,{}),t.outline&&t.outline.length>0&&!ls.focusMode&&d.jsx(Wae,{isOpen:Ht,setIsOpen:Cn}),d.jsxs("div",{className:"flex-1 flex flex-col relative bg-zinc-50 dark:bg-zinc-900",children:[d.jsx("header",{className:`absolute top-0 left-0 right-0 z-20 bg-white/90 dark:bg-zinc-900/90 backdrop-blur-sm border-b border-zinc-200 dark:border-zinc-700 transition-transform duration-300 pt-[env(safe-area-inset-top)] ${Pn?"translate-y-0":"-translate-y-full"}`,children:d.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:d.jsxs("div",{className:"flex items-center justify-between h-16",children:[d.jsxs("div",{className:"flex items-center min-w-0 max-w-[30%]",children:[d.jsx("button",{onClick:e,"aria-label":"Back to dashboard",className:"p-3 mr-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 flex-shrink-0",children:d.jsx(H,{name:"CHEVRON_LEFT",className:"w-6 h-6"})}),d.jsx("h1",{className:"text-xl sm:text-2xl font-bold tracking-tight text-gray-900 dark:text-white truncate",children:t.topic||"New Book"})]}),t.outline.length>0&&d.jsx("div",{className:"flex-1 flex justify-center px-2",children:d.jsx(ale,{activeView:lt,setActiveView:Mt})}),d.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0 ml-4",children:[d.jsxs("div",{className:"relative",children:[d.jsxs("button",{onClick:at=>{at.stopPropagation(),of(!ys)},className:`p-2 rounded-lg text-sm font-medium transition-colors flex items-center space-x-1 ${ys?"bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-300":"hover:bg-gray-100 dark:hover:bg-zinc-800 text-gray-600 dark:text-gray-300"}`,title:"View Options",children:[d.jsx(H,{name:"LAYOUT",className:"w-5 h-5"}),d.jsx("span",{className:"hidden lg:inline",children:"Display"})]}),ys&&d.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-zinc-800 rounded-lg shadow-xl border border-zinc-200 dark:border-zinc-700 z-50 animate-fade-in-up p-2",onClick:at=>at.stopPropagation(),children:d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between px-2 py-1",children:[d.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Focus Mode"}),d.jsx("button",{onClick:()=>rr(at=>({...at,focusMode:!at.focusMode})),className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors ${ls.focusMode?"bg-indigo-600":"bg-gray-300 dark:bg-zinc-600"}`,children:d.jsx("span",{className:`inline-block h-3 w-3 transform rounded-full bg-white transition-transform ${ls.focusMode?"translate-x-5":"translate-x-1"}`})})]}),d.jsx("hr",{className:"border-zinc-200 dark:border-zinc-700"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 px-2 mb-1 uppercase tracking-wider",children:"Editor Width"}),d.jsx("div",{className:"flex bg-gray-100 dark:bg-zinc-700/50 rounded-md p-1",children:["narrow","standard","wide"].map(at=>d.jsx("button",{onClick:()=>rr(vn=>({...vn,width:at})),className:`flex-1 text-xs py-1.5 rounded-sm capitalize transition-all ${ls.width===at?"bg-white dark:bg-zinc-600 shadow-sm text-indigo-600 dark:text-indigo-300 font-semibold":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"}`,children:at},at))})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 px-2 mb-1 uppercase tracking-wider",children:"Typography"}),d.jsxs("div",{className:"flex bg-gray-100 dark:bg-zinc-700/50 rounded-md p-1",children:[d.jsx("button",{onClick:()=>rr(at=>({...at,font:"serif"})),className:`flex-1 text-xs py-1.5 rounded-sm transition-all font-serif ${ls.font==="serif"?"bg-white dark:bg-zinc-600 shadow-sm text-indigo-600 dark:text-indigo-300 font-semibold":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"}`,children:"Serif"}),d.jsx("button",{onClick:()=>rr(at=>({...at,font:"sans"})),className:`flex-1 text-xs py-1.5 rounded-sm transition-all font-sans ${ls.font==="sans"?"bg-white dark:bg-zinc-600 shadow-sm text-indigo-600 dark:text-indigo-300 font-semibold":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"}`,children:"Sans"})]})]})]})})]}),d.jsxs("button",{onClick:S,disabled:N||s,className:`hidden sm:flex items-center space-x-2 px-4 py-2 text-sm font-semibold rounded-lg shadow-sm transition-colors disabled:opacity-50
                            ${w==="unsaved"?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-zinc-200 dark:bg-zinc-700 text-zinc-800 dark:text-zinc-100 hover:bg-zinc-300 dark:hover:bg-zinc-600"}`,children:[d.jsx(H,{name:N?"ROTATE_CW":"CLOUD",className:`w-5 h-5 ${N?"animate-spin":""}`}),d.jsx("span",{children:N?"Syncing...":"Save & Sync"})]})]})]})})}),d.jsxs("div",{className:"flex-1 flex overflow-hidden pt-[calc(4rem+env(safe-area-inset-top))]",children:[!ls.focusMode&&d.jsx("aside",{className:"hidden lg:block w-[350px] h-full overflow-y-auto border-r border-zinc-200 dark:border-zinc-700 bg-zinc-50/50 dark:bg-zinc-900/50 p-6 scrollbar-thin scrollbar-thumb-zinc-300 dark:scrollbar-thumb-zinc-600",children:d.jsx(WL,{onSaveAndClose:qo})}),d.jsx("main",{ref:Zt,className:"flex-1 h-full overflow-y-auto scroll-smooth",children:d.jsxs("div",{className:`max-w-full mx-auto p-4 sm:p-6 lg:p-10 transition-all duration-300 ${ls.focusMode?"container":"lg:max-w-4xl"}`,children:[!ls.focusMode&&d.jsx("div",{className:"lg:hidden mb-8",children:d.jsx(WL,{onSaveAndClose:qo})}),d.jsx("div",{className:"space-y-6",children:t.outline.length>0?d.jsxs(d.Fragment,{children:[lt==="editor"&&d.jsx(XL,{viewSettings:ls}),lt==="corkboard"&&d.jsx(cle,{}),lt==="outliner"&&d.jsx(ule,{})]}):d.jsx(XL,{viewSettings:ls})})]})})]}),d.jsx(ple,{})]}),d.jsx(Xae,{})]}):d.jsx("div",{className:"text-center py-10",children:"Loading editor..."})},Tle=({isOpen:n,onClose:e,files:t,onRestore:s,onDelete:i})=>{if(!n)return null;const r=async o=>{await Mn.confirm({title:"Delete Backup?",message:"Are you sure you want to permanently delete this backup file from your Google Drive?",confirmText:"Delete",danger:!0})&&i(o)};return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-2xl max-h-[80vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:o=>o.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Restore from Google Drive"}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsx("div",{className:"overflow-y-auto space-y-3 flex-grow pr-2 -mr-2",children:t.length>0?t.map(o=>d.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg flex flex-col sm:flex-row justify-between items-start sm:items-center border border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"mb-2 sm:mb-0",children:[d.jsx("p",{className:"font-semibold text-gray-800 dark:text-gray-100",children:o.name}),d.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Saved: ",new Date(o.modifiedTime).toLocaleString()]})]}),d.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[d.jsx("button",{onClick:()=>s(o.id),className:"px-3 py-1 text-sm font-semibold rounded-md bg-blue-600 text-white hover:bg-blue-700 transition-colors",children:"Restore"}),d.jsx("button",{onClick:()=>r(o.id),className:"p-2 rounded-full text-gray-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-gray-700 transition-colors","aria-label":"Delete backup",children:d.jsx(H,{name:"TRASH",className:"w-5 h-5"})})]})]},o.id)):d.jsxs("div",{className:"text-center py-10",children:[d.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No backup files found in your Google Drive."}),d.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-2",children:"Create a backup first from the Settings page."})]})})]})})},_le=({isOpen:n,onClose:e,backups:t,onRestore:s,onDownload:i})=>{if(!n)return null;const r=f=>{if(f==="latest.json"||f==="latest.json.gz")return"Latest Auto-Backup";if(f.startsWith("daily_"))return"Daily Snapshot";if(f.startsWith("snapshot_")){const p=f.split("_");return p.length>=3?`Snapshot: ${p.slice(2).join("_").replace(".json","").replace(".gz","").replace(/_/g," ")}`:"Cloud Snapshot"}return"Unknown Backup"},o=t.find(f=>f.id==="latest.json"||f.id==="latest.json.gz"),a=t.filter(f=>f.id.startsWith("snapshot_")),l=t.filter(f=>f.id.startsWith("daily_")),u=t.filter(f=>f.id!=="latest.json"&&f.id!=="latest.json.gz"&&!f.id.startsWith("snapshot_")&&!f.id.startsWith("daily_"));return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-2xl max-h-[80vh] flex flex-col border border-gray-200 dark:border-gray-700",onClick:f=>f.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Restore from Cloud"}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("div",{className:"overflow-y-auto space-y-4 flex-grow pr-2 -mr-2",children:[o&&d.jsxs("div",{className:"mb-4",children:[d.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-2",children:"Current State"}),d.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-lg flex flex-col sm:flex-row justify-between items-start sm:items-center border border-emerald-200 dark:border-emerald-800",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"p-2 bg-emerald-100 dark:bg-emerald-800/50 rounded-full text-emerald-600 dark:text-emerald-300",children:d.jsx(H,{name:"CLOUD_CHECK",className:"w-5 h-5"})}),d.jsxs("div",{children:[d.jsx("p",{className:"font-bold text-gray-800 dark:text-gray-100",children:"Latest Auto-Backup"}),d.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(o.createdAt).toLocaleString()})]})]}),d.jsxs("div",{className:"flex items-center space-x-3 mt-3 sm:mt-0",children:[d.jsx("button",{onClick:()=>i(o.id),className:"p-2 text-zinc-500 hover:text-zinc-700 dark:text-zinc-400",title:"Download",children:d.jsx(H,{name:"DOWNLOAD",className:"w-5 h-5"})}),d.jsx("button",{onClick:()=>s(o.id),className:"px-3 py-1.5 text-sm font-semibold rounded-md bg-emerald-600 text-white hover:bg-emerald-700 shadow-sm",children:"Restore"})]})]})]}),a.length>0&&d.jsxs("div",{children:[d.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-2",children:"My Cloud Snapshots"}),d.jsx("div",{className:"space-y-2",children:a.map(f=>d.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/10 p-3 rounded-lg flex justify-between items-center border border-indigo-100 dark:border-indigo-900/30",children:[d.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[d.jsx(H,{name:"SAVE",className:"w-4 h-4 text-indigo-500 flex-shrink-0"}),d.jsxs("div",{className:"min-w-0",children:[d.jsx("p",{className:"font-semibold text-sm text-gray-800 dark:text-gray-100 truncate",children:r(f.id)}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(f.createdAt).toLocaleString()})]})]}),d.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[d.jsx("button",{onClick:()=>i(f.id),className:"p-1.5 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300",children:d.jsx(H,{name:"DOWNLOAD",className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>s(f.id),className:"px-3 py-1 text-xs font-semibold rounded bg-white dark:bg-zinc-700 border border-zinc-200 dark:border-zinc-600 hover:bg-zinc-50 dark:hover:bg-zinc-600",children:"Restore"})]})]},f.id))})]}),l.length>0&&d.jsxs("div",{children:[d.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-2",children:"Daily History"}),d.jsx("div",{className:"space-y-2",children:l.map(f=>d.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/30 p-3 rounded-lg flex justify-between items-center border border-gray-200 dark:border-gray-700",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(H,{name:"HISTORY",className:"w-4 h-4 text-zinc-400"}),d.jsxs("div",{children:[d.jsx("p",{className:"font-medium text-sm text-gray-800 dark:text-gray-100",children:new Date(f.createdAt).toLocaleDateString()}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(f.createdAt).toLocaleTimeString()})]})]}),d.jsx("button",{onClick:()=>s(f.id),className:"px-3 py-1 text-xs font-semibold rounded bg-white dark:bg-zinc-600 border border-zinc-200 dark:border-zinc-500 hover:bg-zinc-50",children:"Restore"})]},f.id))})]}),u.length>0&&d.jsxs("div",{children:[d.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-2",children:"Other Backups"}),d.jsx("div",{className:"space-y-2",children:u.map(f=>d.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-700/30 p-3 rounded-lg flex justify-between items-center border border-zinc-200 dark:border-zinc-700",children:[d.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[d.jsx(H,{name:"FILE_TEXT",className:"w-4 h-4 text-zinc-400 flex-shrink-0"}),d.jsxs("div",{className:"min-w-0",children:[d.jsx("p",{className:"font-medium text-sm text-gray-800 dark:text-gray-100 truncate",children:f.id}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(f.createdAt).toLocaleString()})]})]}),d.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[d.jsx("button",{onClick:()=>i(f.id),className:"p-1.5 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300",children:d.jsx(H,{name:"DOWNLOAD",className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>s(f.id),className:"px-3 py-1 text-xs font-semibold rounded bg-white dark:bg-zinc-600 border border-zinc-200 dark:border-zinc-500 hover:bg-zinc-50",children:"Restore"})]})]},f.id))})]}),t.length===0&&d.jsx("div",{className:"text-center py-10",children:d.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No backups found on the server."})})]})]})})};var L0={};L0.d=(n,e)=>{for(var t in e)L0.o(e,t)&&!L0.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})};L0.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var gt=globalThis.pdfjsLib={};L0.d(gt,{AbortException:()=>Od,AnnotationEditorLayer:()=>GT,AnnotationEditorParamsType:()=>$t,AnnotationEditorType:()=>Ct,AnnotationEditorUIManager:()=>Xh,AnnotationLayer:()=>Cde,AnnotationMode:()=>Yc,ColorPicker:()=>Yk,DOMSVGFactory:()=>L2,DrawLayer:()=>WT,FeatureTest:()=>zi,GlobalWorkerOptions:()=>Hl,ImageKind:()=>iw,InvalidPDFException:()=>LE,MissingPDFException:()=>cx,OPS:()=>So,OutputScale:()=>BE,PDFDataRangeTransport:()=>T6,PDFDateString:()=>z2,PDFWorker:()=>vp,PasswordResponses:()=>zle,PermissionFlag:()=>Ile,PixelsPerInch:()=>Bd,RenderingCancelledException:()=>R2,TextLayer:()=>dx,TouchManager:()=>Wk,UnexpectedResponseException:()=>Gk,Util:()=>rt,VerbosityLevel:()=>KS,XfaLayer:()=>M6,build:()=>ide,createValidAbsoluteUrl:()=>Lle,fetchData:()=>QS,getDocument:()=>Yce,getFilenameFromUrl:()=>qle,getPdfFilenameFromUrl:()=>Wle,getXfaPageViewport:()=>Kle,isDataScheme:()=>ZS,isPdfFile:()=>I2,noContextMenu:()=>Uo,normalizeUnicode:()=>$le,setLayerDimensions:()=>Jh,shadow:()=>It,stopEvent:()=>Rr,version:()=>sde});const xi=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),EF=[1,0,0,1,0,0],PE=[.001,0,0,.001,0,0],Mle=1e7,dN=1.35,Nr={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Yc={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Rle="pdfjs_internal_editor_",Ct={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},$t={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},Ile={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},li={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},iw={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ks={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},Kg={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},KS={ERRORS:0,WARNINGS:1,INFOS:5},So={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},zle={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let YS=KS.WARNINGS;function Dle(n){Number.isInteger(n)&&(YS=n)}function jle(){return YS}function JS(n){YS>=KS.INFOS&&console.log(`Info: ${n}`)}function At(n){YS>=KS.WARNINGS&&console.log(`Warning: ${n}`)}function xn(n){throw new Error(n)}function ms(n,e){n||xn(e)}function Ple(n){switch(n==null?void 0:n.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Lle(n,e=null,t=null){if(!n)return null;try{if(t&&typeof n=="string"){if(t.addDefaultProtocol&&n.startsWith("www.")){const i=n.match(/\./g);(i==null?void 0:i.length)>=2&&(n=`http://${n}`)}if(t.tryConvertEncoding)try{n=Ule(n)}catch{}}const s=e?new URL(n,e):new URL(n);if(Ple(s))return s}catch{}return null}function It(n,e,t,s=!1){return Object.defineProperty(n,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const Wd=(function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e})();class tO extends Wd{constructor(e,t){super(e,"PasswordException"),this.code=t}}class uN extends Wd{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class LE extends Wd{constructor(e){super(e,"InvalidPDFException")}}class cx extends Wd{constructor(e){super(e,"MissingPDFException")}}class Gk extends Wd{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class Ole extends Wd{constructor(e){super(e,"FormatError")}}class Od extends Wd{constructor(e){super(e,"AbortException")}}function TF(n){(typeof n!="object"||(n==null?void 0:n.length)===void 0)&&xn("Invalid argument for bytesToString");const e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);const s=[];for(let i=0;i<e;i+=t){const r=Math.min(i+t,e),o=n.subarray(i,r);s.push(String.fromCharCode.apply(null,o))}return s.join("")}function XS(n){typeof n!="string"&&xn("Invalid argument for stringToBytes");const e=n.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=n.charCodeAt(s)&255;return t}function Ble(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function _2(n){const e=Object.create(null);for(const[t,s]of n)e[t]=s;return e}function Fle(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function Hle(){try{return new Function(""),!0}catch{return!1}}class zi{static get isLittleEndian(){return It(this,"isLittleEndian",Fle())}static get isEvalSupported(){return It(this,"isEvalSupported",Hle())}static get isOffscreenCanvasSupported(){return It(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return It(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"?It(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):It(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return It(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const hN=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));var Kl,rw,OE;class rt{static makeHexColor(e,t,s){return`#${hN[e]}${hN[t]}${hN[s]}`}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){const s=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[s,i]}static applyInverseTransform(e,t){const s=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/s,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/s;return[i,r]}static getAxialAlignedBoundingBox(e,t){const s=this.applyTransform(e,t),i=this.applyTransform(e.slice(2,4),t),r=this.applyTransform([e[0],e[3]],t),o=this.applyTransform([e[2],e[1]],t);return[Math.min(s[0],i[0],r[0],o[0]),Math.min(s[1],i[1],r[1],o[1]),Math.max(s[0],i[0],r[0],o[0]),Math.max(s[1],i[1],r[1],o[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],s=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],o=e[2]*t[1]+e[3]*t[3],a=(s+o)/2,l=Math.sqrt((s+o)**2-4*(s*o-r*i))/2,u=a+l||1,f=a-l||1;return[Math.sqrt(u),Math.sqrt(f)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>i)return null;const r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>o?null:[s,r,i,o]}static bezierBoundingBox(e,t,s,i,r,o,a,l,u){return u?(u[0]=Math.min(u[0],e,a),u[1]=Math.min(u[1],t,l),u[2]=Math.max(u[2],e,a),u[3]=Math.max(u[3],t,l)):u=[Math.min(e,a),Math.min(t,l),Math.max(e,a),Math.max(t,l)],O(this,Kl,OE).call(this,e,s,r,a,t,i,o,l,3*(-e+3*(s-r)+a),6*(e-2*s+r),3*(s-e),u),O(this,Kl,OE).call(this,e,s,r,a,t,i,o,l,3*(-t+3*(i-o)+l),6*(t-2*i+o),3*(i-t),u),u}}Kl=new WeakSet,rw=function(e,t,s,i,r,o,a,l,u,f){if(u<=0||u>=1)return;const p=1-u,g=u*u,b=g*u,w=p*(p*(p*e+3*u*t)+3*g*s)+b*i,S=p*(p*(p*r+3*u*o)+3*g*a)+b*l;f[0]=Math.min(f[0],w),f[1]=Math.min(f[1],S),f[2]=Math.max(f[2],w),f[3]=Math.max(f[3],S)},OE=function(e,t,s,i,r,o,a,l,u,f,p,g){if(Math.abs(u)<1e-12){Math.abs(f)>=1e-12&&O(this,Kl,rw).call(this,e,t,s,i,r,o,a,l,-p/f,g);return}const b=f**2-4*p*u;if(b<0)return;const w=Math.sqrt(b),S=2*u;O(this,Kl,rw).call(this,e,t,s,i,r,o,a,l,(-f+w)/S,g),O(this,Kl,rw).call(this,e,t,s,i,r,o,a,l,(-f-w)/S,g)},L(rt,Kl);function Ule(n){return decodeURIComponent(escape(n))}let fN=null,nO=null;function $le(n){return fN||(fN=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,nO=new Map([["","t"]])),n.replaceAll(fN,(e,t,s)=>t?t.normalize("NFKC"):nO.get(s))}function Gle(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),TF(n)}const M2="pdfjs_internal_id_";function Vle(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(TF(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...e){return new Promise(t=>{t(n(...e))})});const dl="http://www.w3.org/2000/svg",Cu=class Cu{};We(Cu,"CSS",96),We(Cu,"PDF",72),We(Cu,"PDF_TO_CSS_UNITS",Cu.CSS/Cu.PDF);let Bd=Cu;async function QS(n,e="text"){if(i0(n,document.baseURI)){const t=await fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class qb{constructor({viewBox:e,userUnit:t,scale:s,rotation:i,offsetX:r=0,offsetY:o=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=i,this.offsetX=r,this.offsetY=o,s*=t;const l=(e[2]+e[0])/2,u=(e[3]+e[1])/2;let f,p,g,b;switch(i%=360,i<0&&(i+=360),i){case 180:f=-1,p=0,g=0,b=1;break;case 90:f=0,p=1,g=1,b=0;break;case 270:f=0,p=-1,g=-1,b=0;break;case 0:f=1,p=0,g=0,b=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(g=-g,b=-b);let w,S,N,C;f===0?(w=Math.abs(u-e[1])*s+r,S=Math.abs(l-e[0])*s+o,N=(e[3]-e[1])*s,C=(e[2]-e[0])*s):(w=Math.abs(l-e[0])*s+r,S=Math.abs(u-e[1])*s+o,N=(e[2]-e[0])*s,C=(e[3]-e[1])*s),this.transform=[f*s,p*s,g*s,b*s,w-f*s*l-g*s*u,S-p*s*l-b*s*u],this.width=N,this.height=C}get rawDims(){const{userUnit:e,viewBox:t}=this,s=t.map(i=>i*e);return It(this,"rawDims",{pageWidth:s[2]-s[0],pageHeight:s[3]-s[1],pageX:s[0],pageY:s[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new qb({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}convertToViewportPoint(e,t){return rt.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=rt.applyTransform([e[0],e[1]],this.transform),s=rt.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){return rt.applyInverseTransform([e,t],this.transform)}}class R2 extends Wd{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function ZS(n){const e=n.length;let t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function I2(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function qle(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function Wle(n,e="document.pdf"){if(typeof n!="string")return e;if(ZS(n))return At('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=t.exec(n);let r=s.exec(i[1])||s.exec(i[2])||s.exec(i[3]);if(r&&(r=r[0],r.includes("%")))try{r=s.exec(decodeURIComponent(r))[0]}catch{}return r||e}class sO{constructor(){We(this,"started",Object.create(null));We(this,"times",[])}time(e){e in this.started&&At(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||At(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:i,end:r}of this.times)e.push(`${s.padEnd(t)} ${r-i}ms
`);return e.join("")}}function i0(n,e){try{const{protocol:t}=e?new URL(n,e):new URL(n);return t==="http:"||t==="https:"}catch{return!1}}function Uo(n){n.preventDefault()}function Rr(n){n.preventDefault(),n.stopPropagation()}var hx;class z2{static toDateObject(e){if(!e||typeof e!="string")return null;y(this,hx)||z(this,hx,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=y(this,hx).exec(e);if(!t)return null;const s=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const u=t[7]||"Z";let f=parseInt(t[8],10);f=f>=0&&f<=23?f:0;let p=parseInt(t[9],10)||0;return p=p>=0&&p<=59?p:0,u==="-"?(o+=f,a+=p):u==="+"&&(o-=f,a-=p),new Date(Date.UTC(s,i,r,o,a,l))}}hx=new WeakMap,L(z2,hx);function Kle(n,{scale:e=1,rotation:t=0}){const{width:s,height:i}=n.attributes.style,r=[0,0,parseInt(s),parseInt(i)];return new qb({viewBox:r,userUnit:1,scale:e,rotation:t})}function D2(n){if(n.startsWith("#")){const e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(At(`Not a valid color format: "${n}"`),[0,0,0])}function Yle(n){const e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const t of n.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;n.set(t,D2(s))}e.remove()}function Dn(n){const{a:e,b:t,c:s,d:i,e:r,f:o}=n.getTransform();return[e,t,s,i,r,o]}function na(n){const{a:e,b:t,c:s,d:i,e:r,f:o}=n.getTransform().invertSelf();return[e,t,s,i,r,o]}function Jh(n,e,t=!1,s=!0){if(e instanceof qb){const{pageWidth:i,pageHeight:r}=e.rawDims,{style:o}=n,a=zi.isCSSRoundSupported,l=`var(--scale-factor) * ${i}px`,u=`var(--scale-factor) * ${r}px`,f=a?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,p=a?`round(down, ${u}, var(--scale-round-y, 1px))`:`calc(${u})`;!t||e.rotation%180===0?(o.width=f,o.height=p):(o.width=p,o.height=f)}s&&n.setAttribute("data-main-rotation",e.rotation)}class BE{constructor(){const e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}var Jc,Mu,Co,Ru,fx,px,Qk,_F,Di,MF,RF,ow,IF,HE;const pl=class pl{constructor(e){L(this,Di);L(this,Jc,null);L(this,Mu,null);L(this,Co);L(this,Ru,null);L(this,fx,null);z(this,Co,e),y(pl,px)||z(pl,px,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){const e=z(this,Jc,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=y(this,Co)._uiManager._signal;e.addEventListener("contextmenu",Uo,{signal:t}),e.addEventListener("pointerdown",O(pl,Qk,_F),{signal:t});const s=z(this,Ru,document.createElement("div"));s.className="buttons",e.append(s);const i=y(this,Co).toolbarPosition;if(i){const{style:r}=e,o=y(this,Co)._uiManager.direction==="ltr"?1-i[0]:i[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return O(this,Di,IF).call(this),e}get div(){return y(this,Jc)}hide(){var e;y(this,Jc).classList.add("hidden"),(e=y(this,Mu))==null||e.hideDropdown()}show(){var e;y(this,Jc).classList.remove("hidden"),(e=y(this,fx))==null||e.shown()}async addAltText(e){const t=await e.render();O(this,Di,ow).call(this,t),y(this,Ru).prepend(t,y(this,Di,HE)),z(this,fx,e)}addColorPicker(e){z(this,Mu,e);const t=e.renderButton();O(this,Di,ow).call(this,t),y(this,Ru).prepend(t,y(this,Di,HE))}remove(){var e;y(this,Jc).remove(),(e=y(this,Mu))==null||e.destroy(),z(this,Mu,null)}};Jc=new WeakMap,Mu=new WeakMap,Co=new WeakMap,Ru=new WeakMap,fx=new WeakMap,px=new WeakMap,Qk=new WeakSet,_F=function(e){e.stopPropagation()},Di=new WeakSet,MF=function(e){y(this,Co)._focusEventsAllowed=!1,Rr(e)},RF=function(e){y(this,Co)._focusEventsAllowed=!0,Rr(e)},ow=function(e){const t=y(this,Co)._uiManager._signal;e.addEventListener("focusin",O(this,Di,MF).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",O(this,Di,RF).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Uo,{signal:t})},IF=function(){const{editorType:e,_uiManager:t}=y(this,Co),s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",y(pl,px)[e]),O(this,Di,ow).call(this,s),s.addEventListener("click",i=>{t.delete()},{signal:t._signal}),y(this,Ru).append(s)},HE=function(){const e=document.createElement("div");return e.className="divider",e},L(pl,Qk),L(pl,px,null);let FE=pl;var mx,Iu,zu,Fd,zF,DF,jF;class Jle{constructor(e){L(this,Fd);L(this,mx,null);L(this,Iu,null);L(this,zu);z(this,zu,e)}show(e,t,s){const[i,r]=O(this,Fd,DF).call(this,t,s),{style:o}=y(this,Iu)||z(this,Iu,O(this,Fd,zF).call(this));e.append(y(this,Iu)),o.insetInlineEnd=`${100*i}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){y(this,Iu).remove()}}mx=new WeakMap,Iu=new WeakMap,zu=new WeakMap,Fd=new WeakSet,zF=function(){const e=z(this,Iu,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Uo,{signal:y(this,zu)._signal});const t=z(this,mx,document.createElement("div"));return t.className="buttons",e.append(t),O(this,Fd,jF).call(this),e},DF=function(e,t){let s=0,i=0;for(const r of e){const o=r.y+r.height;if(o<s)continue;const a=r.x+(t?r.width:0);if(o>s){i=a,s=o;continue}t?a>i&&(i=a):a<i&&(i=a)}return[t?1-i:i,s]},jF=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=y(this,zu)._signal;e.addEventListener("contextmenu",Uo,{signal:s}),e.addEventListener("click",()=>{y(this,zu).highlightSelection("floating_button")},{signal:s}),y(this,mx).append(e)};function Vk(n,e,t){for(const s of t)e.addEventListener(s,n[s].bind(n))}var Zk;class Xle{constructor(){L(this,Zk,0)}get id(){return`${Rle}${Ni(this,Zk)._++}`}}Zk=new WeakMap;var wp,gx,ui,kp,aw;const B2=class B2{constructor(){L(this,kp);L(this,wp,Gle());L(this,gx,0);L(this,ui,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const r=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return It(this,"_isSVGFittingCanvas",r)}async getFromFile(e){const{lastModified:t,name:s,size:i,type:r}=e;return O(this,kp,aw).call(this,`${t}_${s}_${i}_${r}`,e)}async getFromUrl(e){return O(this,kp,aw).call(this,e,e)}async getFromBlob(e,t){const s=await t;return O(this,kp,aw).call(this,e,s)}async getFromId(e){y(this,ui)||z(this,ui,new Map);const t=y(this,ui).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){y(this,ui)||z(this,ui,new Map);let s=y(this,ui).get(e);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${y(this,wp)}_${Ni(this,gx)._++}`,refCounter:1,isSvg:!1},y(this,ui).set(e,s),y(this,ui).set(s.id,s),s}getSvgUrl(e){const t=y(this,ui).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;y(this,ui)||z(this,ui,new Map);const t=y(this,ui).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(s.width,s.height);r.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=r.convertToBlob()}(i=s.close)==null||i.call(s),t.bitmap=null}isValidId(e){return e.startsWith(`image_${y(this,wp)}_`)}};wp=new WeakMap,gx=new WeakMap,ui=new WeakMap,kp=new WeakSet,aw=async function(e,t){y(this,ui)||z(this,ui,new Map);let s=y(this,ui).get(e);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${y(this,wp)}_${Ni(this,gx)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(s.url=t,i=await QS(t,"blob")):t instanceof File?i=s.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const r=B2._isSVGFittingCanvas,o=new FileReader,a=new Image,l=new Promise((u,f)=>{a.onload=()=>{s.bitmap=a,s.isSvg=!0,u()},o.onload=async()=>{const p=s.svgUrl=o.result;a.src=await r?`${p}#svgView(preserveAspectRatio(none))`:p},a.onerror=o.onerror=f});o.readAsDataURL(i),await l}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){At(i),s=null}return y(this,ui).set(e,s),s&&y(this,ui).set(s.id,s),s};let UE=B2;var ts,Xc,xx,Ln;class Qle{constructor(e=128){L(this,ts,[]);L(this,Xc,!1);L(this,xx);L(this,Ln,-1);z(this,xx,e)}add({cmd:e,undo:t,post:s,mustExec:i,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(i&&e(),y(this,Xc))return;const l={cmd:e,undo:t,post:s,type:r};if(y(this,Ln)===-1){y(this,ts).length>0&&(y(this,ts).length=0),z(this,Ln,0),y(this,ts).push(l);return}if(o&&y(this,ts)[y(this,Ln)].type===r){a&&(l.undo=y(this,ts)[y(this,Ln)].undo),y(this,ts)[y(this,Ln)]=l;return}const u=y(this,Ln)+1;u===y(this,xx)?y(this,ts).splice(0,1):(z(this,Ln,u),u<y(this,ts).length&&y(this,ts).splice(u)),y(this,ts).push(l)}undo(){if(y(this,Ln)===-1)return;z(this,Xc,!0);const{undo:e,post:t}=y(this,ts)[y(this,Ln)];e(),t==null||t(),z(this,Xc,!1),z(this,Ln,y(this,Ln)-1)}redo(){if(y(this,Ln)<y(this,ts).length-1){z(this,Ln,y(this,Ln)+1),z(this,Xc,!0);const{cmd:e,post:t}=y(this,ts)[y(this,Ln)];e(),t==null||t(),z(this,Xc,!1)}}hasSomethingToUndo(){return y(this,Ln)!==-1}hasSomethingToRedo(){return y(this,Ln)<y(this,ts).length-1}cleanType(e){if(y(this,Ln)!==-1){for(let t=y(this,Ln);t>=0;t--)if(y(this,ts)[t].type!==e){y(this,ts).splice(t+1,y(this,Ln)-t),z(this,Ln,t);return}y(this,ts).length=0,z(this,Ln,-1)}}destroy(){z(this,ts,null)}}ts=new WeakMap,Xc=new WeakMap,xx=new WeakMap,Ln=new WeakMap;var eS,PF;class Wb{constructor(e){L(this,eS);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=zi.platform;for(const[s,i,r={}]of e)for(const o of s){const a=o.startsWith("mac+");t&&a?(this.callbacks.set(o.slice(4),{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1))):!t&&!a&&(this.callbacks.set(o,{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(O(this,eS,PF).call(this,t));if(!s)return;const{callback:i,options:{bubbles:r=!1,args:o=[],checker:a=null}}=s;a&&!a(e,t)||(i.bind(e,...o,t)(),r||Rr(t))}}eS=new WeakSet,PF=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const tS=class tS{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return Yle(e),It(this,"_colors",e)}convert(e){const t=D2(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,i]of this._colors)if(i.every((r,o)=>r===t[o]))return tS._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?rt.makeHexColor(...t):e}};We(tS,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let $E=tS;var Sp,pr,Cs,Js,Cp,gl,Ap,Kr,Qc,Du,Np,ju,ua,Ao,Pu,bx,yx,Ep,vx,ha,Zc,Tp,ed,fa,nS,td,wx,nd,Lu,kx,Sx,zs,rn,xl,Ou,Cx,Ax,sd,pa,bl,Nx,Yr,qe,lw,GE,LF,OF,cw,BF,FF,HF,VE,UF,qE,WE,$F,Ei,ul,GF,VF,KE,qF,r0,YE;const hp=class hp{constructor(e,t,s,i,r,o,a,l,u,f,p,g,b){L(this,qe);L(this,Sp,new AbortController);L(this,pr,null);L(this,Cs,new Map);L(this,Js,new Map);L(this,Cp,null);L(this,gl,null);L(this,Ap,null);L(this,Kr,new Qle);L(this,Qc,null);L(this,Du,null);L(this,Np,0);L(this,ju,new Set);L(this,ua,null);L(this,Ao,null);L(this,Pu,new Set);We(this,"_editorUndoBar",null);L(this,bx,!1);L(this,yx,!1);L(this,Ep,!1);L(this,vx,null);L(this,ha,null);L(this,Zc,null);L(this,Tp,null);L(this,ed,!1);L(this,fa,null);L(this,nS,new Xle);L(this,td,!1);L(this,wx,!1);L(this,nd,null);L(this,Lu,null);L(this,kx,null);L(this,Sx,null);L(this,zs,Ct.NONE);L(this,rn,new Set);L(this,xl,null);L(this,Ou,null);L(this,Cx,null);L(this,Ax,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});L(this,sd,[0,0]);L(this,pa,null);L(this,bl,null);L(this,Nx,null);L(this,Yr,null);const w=this._signal=y(this,Sp).signal;z(this,bl,e),z(this,Nx,t),z(this,Cp,s),this._eventBus=i,i._on("editingaction",this.onEditingAction.bind(this),{signal:w}),i._on("pagechanging",this.onPageChanging.bind(this),{signal:w}),i._on("scalechanging",this.onScaleChanging.bind(this),{signal:w}),i._on("rotationchanging",this.onRotationChanging.bind(this),{signal:w}),i._on("setpreference",this.onSetPreference.bind(this),{signal:w}),i._on("switchannotationeditorparams",S=>this.updateParams(S.type,S.value),{signal:w}),O(this,qe,BF).call(this),O(this,qe,$F).call(this),O(this,qe,VE).call(this),z(this,gl,r.annotationStorage),z(this,vx,r.filterFactory),z(this,Ou,o),z(this,Tp,a||null),z(this,bx,l),z(this,yx,u),z(this,Ep,f),z(this,Sx,p||null),this.viewParameters={realScale:Bd.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=b!==!1}static get _keyboardManager(){const e=hp.prototype,t=o=>y(o,bl).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),s=(o,{target:a})=>{if(a instanceof HTMLInputElement){const{type:l}=a;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return It(this,"_keyboardManager",new Wb([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&y(o,bl).contains(a)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&y(o,bl).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){var e,t,s,i,r;(e=y(this,Yr))==null||e.resolve(),z(this,Yr,null),(t=y(this,Sp))==null||t.abort(),z(this,Sp,null),this._signal=null;for(const o of y(this,Js).values())o.destroy();y(this,Js).clear(),y(this,Cs).clear(),y(this,Pu).clear(),z(this,pr,null),y(this,rn).clear(),y(this,Kr).destroy(),(s=y(this,Cp))==null||s.destroy(),(i=y(this,fa))==null||i.hide(),z(this,fa,null),y(this,ha)&&(clearTimeout(y(this,ha)),z(this,ha,null)),y(this,pa)&&(clearTimeout(y(this,pa)),z(this,pa,null)),(r=this._editorUndoBar)==null||r.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return y(this,Sx)}get useNewAltTextFlow(){return y(this,yx)}get useNewAltTextWhenAddingImage(){return y(this,Ep)}get hcmFilter(){return It(this,"hcmFilter",y(this,Ou)?y(this,vx).addHCMFilter(y(this,Ou).foreground,y(this,Ou).background):"none")}get direction(){return It(this,"direction",getComputedStyle(y(this,bl)).direction)}get highlightColors(){return It(this,"highlightColors",y(this,Tp)?new Map(y(this,Tp).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return It(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),z(this,Du,e)}setMainHighlightColorPicker(e){z(this,kx,e)}editAltText(e,t=!1){var s;(s=y(this,Cp))==null||s.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":z(this,Ep,t);break}}onPageChanging({pageNumber:e}){z(this,Np,e-1)}focusMainContainer(){y(this,bl).focus()}findParent(e,t){for(const s of y(this,Js).values()){const{x:i,y:r,width:o,height:a}=s.div.getBoundingClientRect();if(e>=i&&e<=i+o&&t>=r&&t<=r+a)return s}return null}disableUserSelect(e=!1){y(this,Nx).classList.toggle("noUserSelect",e)}addShouldRescale(e){y(this,Pu).add(e)}removeShouldRescale(e){y(this,Pu).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*Bd.PDF_TO_CSS_UNITS;for(const s of y(this,Pu))s.onScaleChanging();(t=y(this,Du))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:s,anchorOffset:i,focusNode:r,focusOffset:o}=t,a=t.toString(),u=O(this,qe,lw).call(this,t).closest(".textLayer"),f=this.getSelectionBoxes(u);if(!f)return;t.empty();const p=O(this,qe,GE).call(this,u),g=y(this,zs)===Ct.NONE,b=()=>{p==null||p.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:f,anchorNode:s,anchorOffset:i,focusNode:r,focusOffset:o,text:a}),g&&this.showAllEditors("highlight",!0,!0)};if(g){this.switchToMode(Ct.HIGHLIGHT,b);return}b()}addToAnnotationStorage(e){!e.isEmpty()&&y(this,gl)&&!y(this,gl).has(e.id)&&y(this,gl).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,y(this,ed)&&(z(this,ed,!1),O(this,qe,cw).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of y(this,rn))if(t.div.contains(e)){z(this,Lu,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!y(this,Lu))return;const[e,t]=y(this,Lu);z(this,Lu,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){O(this,qe,VE).call(this),O(this,qe,qE).call(this)}removeEditListeners(){O(this,qe,UF).call(this),O(this,qe,WE).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of y(this,Ao))if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of y(this,Ao))if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var s;if(e.preventDefault(),(s=y(this,pr))==null||s.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of y(this,rn)){const r=i.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const o of y(this,Ao))if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(r){At(`paste: "${r.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const r=[];for(const l of s){const u=await i.deserialize(l);if(!u)return;r.push(u)}const o=()=>{for(const l of r)O(this,qe,KE).call(this,l);O(this,qe,YE).call(this,r)},a=()=>{for(const l of r)l.remove()};this.addCommands({cmd:o,undo:a,mustExec:!0})}catch(r){At(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),y(this,zs)!==Ct.NONE&&!this.isEditorHandlingKeyboard&&hp._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,y(this,ed)&&(z(this,ed,!1),O(this,qe,cw).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(O(this,qe,FF).call(this),O(this,qe,qE).call(this),O(this,qe,Ei).call(this,{isEditing:y(this,zs)!==Ct.NONE,isEmpty:O(this,qe,r0).call(this),hasSomethingToUndo:y(this,Kr).hasSomethingToUndo(),hasSomethingToRedo:y(this,Kr).hasSomethingToRedo(),hasSelectedEditor:!1})):(O(this,qe,HF).call(this),O(this,qe,WE).call(this),O(this,qe,Ei).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!y(this,Ao)){z(this,Ao,e);for(const t of y(this,Ao))O(this,qe,ul).call(this,t.defaultPropertiesToUpdate)}}getId(){return y(this,nS).id}get currentLayer(){return y(this,Js).get(y(this,Np))}getLayer(e){return y(this,Js).get(e)}get currentPageIndex(){return y(this,Np)}addLayer(e){y(this,Js).set(e.pageIndex,e),y(this,td)?e.enable():e.disable()}removeLayer(e){y(this,Js).delete(e.pageIndex)}async updateMode(e,t=null,s=!1){var i;if(y(this,zs)!==e&&!(y(this,Yr)&&(await y(this,Yr).promise,!y(this,Yr)))){if(z(this,Yr,Promise.withResolvers()),z(this,zs,e),e===Ct.NONE){this.setEditingState(!1),O(this,qe,VF).call(this),(i=this._editorUndoBar)==null||i.hide(),y(this,Yr).resolve();return}this.setEditingState(!0),await O(this,qe,GF).call(this),this.unselectAll();for(const r of y(this,Js).values())r.updateMode(e);if(!t){s&&this.addNewEditorFromKeyboard(),y(this,Yr).resolve();return}for(const r of y(this,Cs).values())r.annotationElementId===t?(this.setSelected(r),r.enterInEditMode()):r.unselect();y(this,Yr).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==y(this,zs)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var s;if(y(this,Ao)){switch(e){case $t.CREATE:this.currentLayer.addNewEditor();return;case $t.HIGHLIGHT_DEFAULT_COLOR:(s=y(this,kx))==null||s.updateColor(t);break;case $t.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(y(this,Cx)||z(this,Cx,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const i of y(this,rn))i.updateParams(e,t);for(const i of y(this,Ao))i.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){var r;for(const o of y(this,Cs).values())o.editorType===e&&o.show(t);(((r=y(this,Cx))==null?void 0:r.get($t.HIGHLIGHT_SHOW_ALL))??!0)!==t&&O(this,qe,ul).call(this,[[$t.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(y(this,wx)!==e){z(this,wx,e);for(const t of y(this,Js).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const s of y(this,Cs).values())s.pageIndex===e&&t.push(s);return t}getEditor(e){return y(this,Cs).get(e)}addEditor(e){y(this,Cs).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(y(this,ha)&&clearTimeout(y(this,ha)),z(this,ha,setTimeout(()=>{this.focusMainContainer(),z(this,ha,null)},0))),y(this,Cs).delete(e.id),this.unselect(e),(!e.annotationElementId||!y(this,ju).has(e.annotationElementId))&&((t=y(this,gl))==null||t.remove(e.id))}addDeletedAnnotationElement(e){y(this,ju).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return y(this,ju).has(e)}removeDeletedAnnotationElement(e){y(this,ju).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){y(this,pr)!==e&&(z(this,pr,e),e&&O(this,qe,ul).call(this,e.propertiesToUpdate))}updateUI(e){y(this,qe,qF)===e&&O(this,qe,ul).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){O(this,qe,ul).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(y(this,rn).has(e)){y(this,rn).delete(e),e.unselect(),O(this,qe,Ei).call(this,{hasSelectedEditor:this.hasSelection});return}y(this,rn).add(e),e.select(),O(this,qe,ul).call(this,e.propertiesToUpdate),O(this,qe,Ei).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=y(this,Du))==null||t.commitOrRemove();for(const s of y(this,rn))s!==e&&s.unselect();y(this,rn).clear(),y(this,rn).add(e),e.select(),O(this,qe,ul).call(this,e.propertiesToUpdate),O(this,qe,Ei).call(this,{hasSelectedEditor:!0})}isSelected(e){return y(this,rn).has(e)}get firstSelectedEditor(){return y(this,rn).values().next().value}unselect(e){e.unselect(),y(this,rn).delete(e),O(this,qe,Ei).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return y(this,rn).size!==0}get isEnterHandled(){return y(this,rn).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;y(this,Kr).undo(),O(this,qe,Ei).call(this,{hasSomethingToUndo:y(this,Kr).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:O(this,qe,r0).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){y(this,Kr).redo(),O(this,qe,Ei).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:y(this,Kr).hasSomethingToRedo(),isEmpty:O(this,qe,r0).call(this)})}addCommands(e){y(this,Kr).add(e),O(this,qe,Ei).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:O(this,qe,r0).call(this)})}cleanUndoStack(e){y(this,Kr).cleanType(e)}delete(){var r;this.commitOrRemove();const e=(r=this.currentLayer)==null?void 0:r.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...y(this,rn)],s=()=>{var o;(o=this._editorUndoBar)==null||o.show(i,t.length===1?t[0].editorType:t.length);for(const a of t)a.remove()},i=()=>{for(const o of t)O(this,qe,KE).call(this,o)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){var e;(e=y(this,pr))==null||e.commitOrRemove()}hasSomethingToControl(){return y(this,pr)||this.hasSelection}selectAll(){for(const e of y(this,rn))e.commit();O(this,qe,YE).call(this,y(this,Cs).values())}unselectAll(){var e;if(!(y(this,pr)&&(y(this,pr).commitOrRemove(),y(this,zs)!==Ct.NONE))&&!((e=y(this,Du))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of y(this,rn))t.unselect();y(this,rn).clear(),O(this,qe,Ei).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;y(this,sd)[0]+=e,y(this,sd)[1]+=t;const[i,r]=y(this,sd),o=[...y(this,rn)],a=1e3;y(this,pa)&&clearTimeout(y(this,pa)),z(this,pa,setTimeout(()=>{z(this,pa,null),y(this,sd)[0]=y(this,sd)[1]=0,this.addCommands({cmd:()=>{for(const l of o)y(this,Cs).has(l.id)&&l.translateInPage(i,r)},undo:()=>{for(const l of o)y(this,Cs).has(l.id)&&l.translateInPage(-i,-r)},mustExec:!1})},a));for(const l of o)l.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),z(this,ua,new Map);for(const e of y(this,rn))y(this,ua).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!y(this,ua))return!1;this.disableUserSelect(!1);const e=y(this,ua);z(this,ua,null);let t=!1;for(const[{x:i,y:r,pageIndex:o},a]of e)a.newX=i,a.newY=r,a.newPageIndex=o,t||(t=i!==a.savedX||r!==a.savedY||o!==a.savedPageIndex);if(!t)return!1;const s=(i,r,o,a)=>{if(y(this,Cs).has(i.id)){const l=y(this,Js).get(a);l?i._setParentAndPosition(l,r,o):(i.pageIndex=a,i.x=r,i.y=o)}};return this.addCommands({cmd:()=>{for(const[i,{newX:r,newY:o,newPageIndex:a}]of e)s(i,r,o,a)},undo:()=>{for(const[i,{savedX:r,savedY:o,savedPageIndex:a}]of e)s(i,r,o,a)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(y(this,ua))for(const s of y(this,ua).keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||y(this,rn).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return y(this,pr)===e}getActive(){return y(this,pr)}getMode(){return y(this,zs)}get imageManager(){return It(this,"imageManager",new UE)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let u=0,f=t.rangeCount;u<f;u++)if(!e.contains(t.getRangeAt(u).commonAncestorContainer))return null;const{x:s,y:i,width:r,height:o}=e.getBoundingClientRect();let a;switch(e.getAttribute("data-main-rotation")){case"90":a=(u,f,p,g)=>({x:(f-i)/o,y:1-(u+p-s)/r,width:g/o,height:p/r});break;case"180":a=(u,f,p,g)=>({x:1-(u+p-s)/r,y:1-(f+g-i)/o,width:p/r,height:g/o});break;case"270":a=(u,f,p,g)=>({x:1-(f+g-i)/o,y:(u-s)/r,width:g/o,height:p/r});break;default:a=(u,f,p,g)=>({x:(u-s)/r,y:(f-i)/o,width:p/r,height:g/o});break}const l=[];for(let u=0,f=t.rangeCount;u<f;u++){const p=t.getRangeAt(u);if(!p.collapsed)for(const{x:g,y:b,width:w,height:S}of p.getClientRects())w===0||S===0||l.push(a(g,b,w,S))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(y(this,Ap)||z(this,Ap,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=y(this,Ap))==null||t.delete(e)}renderAnnotationElement(e){var i;const t=(i=y(this,Ap))==null?void 0:i.get(e.data.id);if(!t)return;const s=y(this,gl).getRawValue(t);s&&(y(this,zs)===Ct.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}};Sp=new WeakMap,pr=new WeakMap,Cs=new WeakMap,Js=new WeakMap,Cp=new WeakMap,gl=new WeakMap,Ap=new WeakMap,Kr=new WeakMap,Qc=new WeakMap,Du=new WeakMap,Np=new WeakMap,ju=new WeakMap,ua=new WeakMap,Ao=new WeakMap,Pu=new WeakMap,bx=new WeakMap,yx=new WeakMap,Ep=new WeakMap,vx=new WeakMap,ha=new WeakMap,Zc=new WeakMap,Tp=new WeakMap,ed=new WeakMap,fa=new WeakMap,nS=new WeakMap,td=new WeakMap,wx=new WeakMap,nd=new WeakMap,Lu=new WeakMap,kx=new WeakMap,Sx=new WeakMap,zs=new WeakMap,rn=new WeakMap,xl=new WeakMap,Ou=new WeakMap,Cx=new WeakMap,Ax=new WeakMap,sd=new WeakMap,pa=new WeakMap,bl=new WeakMap,Nx=new WeakMap,Yr=new WeakMap,qe=new WeakSet,lw=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},GE=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of y(this,Js).values())if(s.hasTextLayer(e))return s;return null},LF=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=O(this,qe,lw).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(y(this,fa)||z(this,fa,new Jle(this)),y(this,fa).show(s,i,this.direction==="ltr"))},OF=function(){var r,o,a;const e=document.getSelection();if(!e||e.isCollapsed){y(this,xl)&&((r=y(this,fa))==null||r.hide(),z(this,xl,null),O(this,qe,Ei).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===y(this,xl))return;const i=O(this,qe,lw).call(this,e).closest(".textLayer");if(!i){y(this,xl)&&((o=y(this,fa))==null||o.hide(),z(this,xl,null),O(this,qe,Ei).call(this,{hasSelectedText:!1}));return}if((a=y(this,fa))==null||a.hide(),z(this,xl,t),O(this,qe,Ei).call(this,{hasSelectedText:!0}),!(y(this,zs)!==Ct.HIGHLIGHT&&y(this,zs)!==Ct.NONE)&&(y(this,zs)===Ct.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),z(this,ed,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=y(this,zs)===Ct.HIGHLIGHT?O(this,qe,GE).call(this,i):null;l==null||l.toggleDrawing();const u=new AbortController,f=this.combinedSignal(u),p=g=>{g.type==="pointerup"&&g.button!==0||(u.abort(),l==null||l.toggleDrawing(!0),g.type==="pointerup"&&O(this,qe,cw).call(this,"main_toolbar"))};window.addEventListener("pointerup",p,{signal:f}),window.addEventListener("blur",p,{signal:f})}},cw=function(e=""){y(this,zs)===Ct.HIGHLIGHT?this.highlightSelection(e):y(this,bx)&&O(this,qe,LF).call(this)},BF=function(){document.addEventListener("selectionchange",O(this,qe,OF).bind(this),{signal:this._signal})},FF=function(){if(y(this,Zc))return;z(this,Zc,new AbortController);const e=this.combinedSignal(y(this,Zc));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},HF=function(){var e;(e=y(this,Zc))==null||e.abort(),z(this,Zc,null)},VE=function(){if(y(this,nd))return;z(this,nd,new AbortController);const e=this.combinedSignal(y(this,nd));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},UF=function(){var e;(e=y(this,nd))==null||e.abort(),z(this,nd,null)},qE=function(){if(y(this,Qc))return;z(this,Qc,new AbortController);const e=this.combinedSignal(y(this,Qc));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},WE=function(){var e;(e=y(this,Qc))==null||e.abort(),z(this,Qc,null)},$F=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Ei=function(e){Object.entries(e).some(([s,i])=>y(this,Ax)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(y(this,Ax),e)}),y(this,zs)===Ct.HIGHLIGHT&&e.hasSelectedEditor===!1&&O(this,qe,ul).call(this,[[$t.HIGHLIGHT_FREE,!0]]))},ul=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},GF=async function(){if(!y(this,td)){z(this,td,!0);const e=[];for(const t of y(this,Js).values())e.push(t.enable());await Promise.all(e);for(const t of y(this,Cs).values())t.enable()}},VF=function(){if(this.unselectAll(),y(this,td)){z(this,td,!1);for(const e of y(this,Js).values())e.disable();for(const e of y(this,Cs).values())e.disable()}},KE=function(e){const t=y(this,Js).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},qF=function(){let e=null;for(e of y(this,rn));return e},r0=function(){if(y(this,Cs).size===0)return!0;if(y(this,Cs).size===1)for(const e of y(this,Cs).values())return e.isEmpty();return!1},YE=function(e){for(const t of y(this,rn))t.unselect();y(this,rn).clear();for(const t of e)t.isEmpty()||(y(this,rn).add(t),t.select());O(this,qe,Ei).call(this,{hasSelectedEditor:this.hasSelection})},We(hp,"TRANSLATE_SMALL",1),We(hp,"TRANSLATE_BIG",10);let Xh=hp;var Ds,ma,No,_p,ga,mr,Mp,xa,Yi,yl,Bu,ba,id,Bo,o0,dw;const Ti=class Ti{constructor(e){L(this,Bo);L(this,Ds,null);L(this,ma,!1);L(this,No,null);L(this,_p,null);L(this,ga,null);L(this,mr,null);L(this,Mp,!1);L(this,xa,null);L(this,Yi,null);L(this,yl,null);L(this,Bu,null);L(this,ba,!1);z(this,Yi,e),z(this,ba,e._uiManager.useNewAltTextFlow),y(Ti,id)||z(Ti,id,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){Ti._l10n??(Ti._l10n=e)}async render(){const e=z(this,No,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=z(this,_p,document.createElement("span"));e.append(t),y(this,ba)?(e.classList.add("new"),e.setAttribute("data-l10n-id",y(Ti,id).missing),t.setAttribute("data-l10n-id",y(Ti,id)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=y(this,Yi)._uiManager._signal;e.addEventListener("contextmenu",Uo,{signal:s}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),y(this,Yi)._uiManager.editAltText(y(this,Yi)),y(this,ba)&&y(this,Yi)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:y(this,Bo,o0)}})};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(z(this,Mp,!0),i(r))},{signal:s}),await O(this,Bo,dw).call(this),e}finish(){y(this,No)&&(y(this,No).focus({focusVisible:y(this,Mp)}),z(this,Mp,!1))}isEmpty(){return y(this,ba)?y(this,Ds)===null:!y(this,Ds)&&!y(this,ma)}hasData(){return y(this,ba)?y(this,Ds)!==null||!!y(this,yl):this.isEmpty()}get guessedText(){return y(this,yl)}async setGuessedText(e){y(this,Ds)===null&&(z(this,yl,e),z(this,Bu,await Ti._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),O(this,Bo,dw).call(this))}toggleAltTextBadge(e=!1){var t;if(!y(this,ba)||y(this,Ds)){(t=y(this,xa))==null||t.remove(),z(this,xa,null);return}if(!y(this,xa)){const s=z(this,xa,document.createElement("div"));s.className="noAltTextBadge",y(this,Yi).div.append(s)}y(this,xa).classList.toggle("hidden",!e)}serialize(e){let t=y(this,Ds);return!e&&y(this,yl)===t&&(t=y(this,Bu)),{altText:t,decorative:y(this,ma),guessedText:y(this,yl),textWithDisclaimer:y(this,Bu)}}get data(){return{altText:y(this,Ds),decorative:y(this,ma)}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:i,cancel:r=!1}){s&&(z(this,yl,s),z(this,Bu,i)),!(y(this,Ds)===e&&y(this,ma)===t)&&(r||(z(this,Ds,e),z(this,ma,t)),O(this,Bo,dw).call(this))}toggle(e=!1){y(this,No)&&(!e&&y(this,mr)&&(clearTimeout(y(this,mr)),z(this,mr,null)),y(this,No).disabled=!e)}shown(){y(this,Yi)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:y(this,Bo,o0)}})}destroy(){var e,t;(e=y(this,No))==null||e.remove(),z(this,No,null),z(this,_p,null),z(this,ga,null),(t=y(this,xa))==null||t.remove(),z(this,xa,null)}};Ds=new WeakMap,ma=new WeakMap,No=new WeakMap,_p=new WeakMap,ga=new WeakMap,mr=new WeakMap,Mp=new WeakMap,xa=new WeakMap,Yi=new WeakMap,yl=new WeakMap,Bu=new WeakMap,ba=new WeakMap,id=new WeakMap,Bo=new WeakSet,o0=function(){return y(this,Ds)&&"added"||y(this,Ds)===null&&this.guessedText&&"review"||"missing"},dw=async function(){var i,r,o;const e=y(this,No);if(!e)return;if(y(this,ba)){if(e.classList.toggle("done",!!y(this,Ds)),e.setAttribute("data-l10n-id",y(Ti,id)[y(this,Bo,o0)]),(i=y(this,_p))==null||i.setAttribute("data-l10n-id",y(Ti,id)[`${y(this,Bo,o0)}-label`]),!y(this,Ds)){(r=y(this,ga))==null||r.remove();return}}else{if(!y(this,Ds)&&!y(this,ma)){e.classList.remove("done"),(o=y(this,ga))==null||o.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=y(this,ga);if(!t){z(this,ga,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${y(this,Yi).id}`;const a=100,l=y(this,Yi)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(y(this,mr)),z(this,mr,null)},{once:!0}),e.addEventListener("mouseenter",()=>{z(this,mr,setTimeout(()=>{z(this,mr,null),y(this,ga).classList.add("show"),y(this,Yi)._reportTelemetry({action:"alt_text_tooltip"})},a))},{signal:l}),e.addEventListener("mouseleave",()=>{var u;y(this,mr)&&(clearTimeout(y(this,mr)),z(this,mr,null)),(u=y(this,ga))==null||u.classList.remove("show")},{signal:l})}y(this,ma)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=y(this,Ds)),t.parentNode||e.append(t);const s=y(this,Yi).getImageForAltText();s==null||s.setAttribute("aria-describedby",t.id)},L(Ti,id,null),We(Ti,"_l10n",null);let qk=Ti;var Ex,Fu,Tx,_x,Mx,Rx,Ix,Rp,vl,Hu,rd,Zl,WF,KF,JE;const F2=class F2{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:r=null,onPinchEnd:o=null,signal:a}){L(this,Zl);L(this,Ex);L(this,Fu,!1);L(this,Tx,null);L(this,_x);L(this,Mx);L(this,Rx);L(this,Ix);L(this,Rp);L(this,vl,null);L(this,Hu);L(this,rd,null);z(this,Ex,e),z(this,Tx,s),z(this,_x,t),z(this,Mx,i),z(this,Rx,r),z(this,Ix,o),z(this,Hu,new AbortController),z(this,Rp,AbortSignal.any([a,y(this,Hu).signal])),e.addEventListener("touchstart",O(this,Zl,WF).bind(this),{passive:!1,signal:y(this,Rp)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return It(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var e;(e=y(this,Hu))==null||e.abort(),z(this,Hu,null)}};Ex=new WeakMap,Fu=new WeakMap,Tx=new WeakMap,_x=new WeakMap,Mx=new WeakMap,Rx=new WeakMap,Ix=new WeakMap,Rp=new WeakMap,vl=new WeakMap,Hu=new WeakMap,rd=new WeakMap,Zl=new WeakSet,WF=function(e){var i,r,o;if((i=y(this,_x))!=null&&i.call(this)||e.touches.length<2)return;if(!y(this,rd)){z(this,rd,new AbortController);const a=AbortSignal.any([y(this,Rp),y(this,rd).signal]),l=y(this,Ex),u={signal:a,passive:!1};l.addEventListener("touchmove",O(this,Zl,KF).bind(this),u),l.addEventListener("touchend",O(this,Zl,JE).bind(this),u),l.addEventListener("touchcancel",O(this,Zl,JE).bind(this),u),(r=y(this,Mx))==null||r.call(this)}if(Rr(e),e.touches.length!==2||(o=y(this,Tx))!=null&&o.call(this)){z(this,vl,null);return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),z(this,vl,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY})},KF=function(e){var _;if(!y(this,vl)||e.touches.length!==2)return;let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:i,screenY:r}=t,{screenX:o,screenY:a}=s,l=y(this,vl),{touch0X:u,touch0Y:f,touch1X:p,touch1Y:g}=l,b=p-u,w=g-f,S=o-i,N=a-r,C=Math.hypot(S,N)||1,M=Math.hypot(b,w)||1;if(!y(this,Fu)&&Math.abs(M-C)<=F2.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=r,l.touch1X=o,l.touch1Y=a,e.preventDefault(),!y(this,Fu)){z(this,Fu,!0);return}const R=[(i+o)/2,(r+a)/2];(_=y(this,Rx))==null||_.call(this,R,M,C)},JE=function(e){var t;y(this,rd).abort(),z(this,rd,null),(t=y(this,Ix))==null||t.call(this),y(this,vl)&&(e.preventDefault(),z(this,vl,null),z(this,Fu,!1))};let Wk=F2;var Uu,Eo,En,Ip,od,zx,$u,Xs,Gu,wl,ad,Dx,Vu,gr,jx,qu,kl,ya,zp,Dp,Jr,Wu,Px,sS,pt,XE,Lx,QE,uw,YF,JF,ZE,hw,eT,XF,QF,ZF,tT,e6,nT,t6,n6,s6,sT,a0;const Et=class Et{constructor(e){L(this,pt);L(this,Uu,null);L(this,Eo,null);L(this,En,null);L(this,Ip,!1);L(this,od,null);L(this,zx,"");L(this,$u,!1);L(this,Xs,null);L(this,Gu,null);L(this,wl,null);L(this,ad,null);L(this,Dx,"");L(this,Vu,!1);L(this,gr,null);L(this,jx,!1);L(this,qu,!1);L(this,kl,!1);L(this,ya,null);L(this,zp,0);L(this,Dp,0);L(this,Jr,null);L(this,Wu,null);We(this,"_editToolbar",null);We(this,"_initialOptions",Object.create(null));We(this,"_initialData",null);We(this,"_isVisible",!0);We(this,"_uiManager",null);We(this,"_focusEventsAllowed",!0);L(this,Px,!1);L(this,sS,Et._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[r,o];const[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=Et.prototype._resizeWithKeyboard,t=Xh.TRANSLATE_SMALL,s=Xh.TRANSLATE_BIG;return It(this,"_resizerKeyboardManager",new Wb([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],Et.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return It(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new Zle({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(Et._l10n??(Et._l10n=e),Et._l10nResizer||(Et._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),Et._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);Et._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){xn("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return y(this,Px)}set _isDraggable(e){var t;z(this,Px,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=y(this,sS)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):O(this,pt,a0).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(y(this,Vu)?z(this,Vu,!1):this.parent.setSelected(this))}focusout(e){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,i){const[r,o]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(e+s)/r,this.y=(t+i)/o,this.fixAndSetPosition()}translate(e,t){O(this,pt,XE).call(this,this.parentDimensions,e,t)}translateInPage(e,t){y(this,gr)||z(this,gr,[this.x,this.y,this.width,this.height]),O(this,pt,XE).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){y(this,gr)||z(this,gr,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[i,r]}=this;if(this.x+=e/i,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:p,y:g}=this.div.getBoundingClientRect();this.parent.findNewParent(this,p,g)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:a}=this;const[l,u]=this.getBaseTranslation();o+=l,a+=u;const{style:f}=s;f.left=`${(100*o).toFixed(2)}%`,f.top=`${(100*a).toFixed(2)}%`,this._onTranslating(o,a),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!y(this,gr)&&(y(this,gr)[0]!==this.x||y(this,gr)[1]!==this.y)}get _hasBeenResized(){return!!y(this,gr)&&(y(this,gr)[2]!==this.width||y(this,gr)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=Et,i=s/e,r=s/t;switch(this.rotation){case 90:return[-i,r];case 180:return[i,r];case 270:return[i,-r];default:return[-i,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,i]}=this;let{x:r,y:o,width:a,height:l}=this;if(a*=s,l*=i,r*=s,o*=i,this._mustFixPosition)switch(e){case 0:r=Math.max(0,Math.min(s-a,r)),o=Math.max(0,Math.min(i-l,o));break;case 90:r=Math.max(0,Math.min(s-l,r)),o=Math.min(i,Math.max(a,o));break;case 180:r=Math.min(s,Math.max(a,r)),o=Math.min(i,Math.max(l,o));break;case 270:r=Math.min(s,Math.max(l,r)),o=Math.max(0,Math.min(i-a,o));break}this.x=r/=s,this.y=o/=i;const[u,f]=this.getBaseTranslation();r+=u,o+=f,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var s;return O(s=Et,Lx,QE).call(s,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var s;return O(s=Et,Lx,QE).call(s,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(e,t){const[s,i]=this.parentDimensions,{style:r}=this.div;r.width=`${(100*e/s).toFixed(2)}%`,y(this,$u)||(r.height=`${(100*t/i).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:s}=e,i=s.endsWith("%"),r=!y(this,$u)&&t.endsWith("%");if(i&&r)return;const[o,a]=this.parentDimensions;i||(e.width=`${(100*parseFloat(s)/o).toFixed(2)}%`),!y(this,$u)&&!r&&(e.height=`${(100*parseFloat(t)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=y(this,En))==null||e.finish()}async addEditToolbar(){return this._editToolbar||y(this,qu)?this._editToolbar:(this._editToolbar=new FE(this),this.div.append(this._editToolbar.render()),y(this,En)&&await this._editToolbar.addAltText(y(this,En)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=y(this,En))==null||e.destroy())}addContainer(e){var s;const t=(s=this._editToolbar)==null?void 0:s.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){y(this,En)||(qk.initialize(Et._l10n),z(this,En,new qk(this)),y(this,Uu)&&(y(this,En).data=y(this,Uu),z(this,Uu,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=y(this,En))==null?void 0:e.data}set altTextData(e){y(this,En)&&(y(this,En).data=e)}get guessedAltText(){var e;return(e=y(this,En))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=y(this,En))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=y(this,En))==null?void 0:t.serialize(e)}hasAltText(){return!!y(this,En)&&!y(this,En).isEmpty()}hasAltTextData(){var e;return((e=y(this,En))==null?void 0:e.hasData())??!1}render(){var r;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=y(this,Ip)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),O(this,pt,nT).call(this);const[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);const[s,i]=this.getInitialTranslation();return this.translate(s,i),Vk(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(y(this,Wu)||z(this,Wu,new Wk({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:O(this,pt,XF).bind(this),onPinching:O(this,pt,QF).bind(this),onPinchEnd:O(this,pt,ZF).bind(this),signal:this._uiManager._signal}))),(r=this._uiManager._editorUndoBar)==null||r.hide(),this.div}pointerdown(e){const{isMac:t}=zi.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(z(this,Vu,!0),this._isDraggable){O(this,pt,e6).call(this,e);return}O(this,pt,tT).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){y(this,ya)&&clearTimeout(y(this,ya)),z(this,ya,setTimeout(()=>{var e;z(this,ya,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const i=this.parentScale,[r,o]=this.pageDimensions,[a,l]=this.pageTranslation,u=e/i,f=t/i,p=this.x*r,g=this.y*o,b=this.width*r,w=this.height*o;switch(s){case 0:return[p+u+a,o-g-f-w+l,p+u+b+a,o-g-f+l];case 90:return[p+f+a,o-g+u+l,p+f+w+a,o-g+u+b+l];case 180:return[p-u-b+a,o-g+f+l,p-u+a,o-g+f+w+l];case 270:return[p-f-w+a,o-g-u-b+l,p-f+a,o-g-u+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,i,r,o]=e,a=r-s,l=o-i;switch(this.rotation){case 0:return[s,t-o,a,l];case 90:return[s,t-i,l,a];case 180:return[r,t-i,a,l];case 270:return[r,t-o,l,a];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){z(this,qu,!0)}disableEditMode(){z(this,qu,!1)}isInEditMode(){return y(this,qu)}shouldGetKeyboardEvents(){return y(this,kl)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return t<o&&i>0&&e<r&&s>0}rebuild(){O(this,pt,nT).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){xn("An editor must be serializable")}static async deserialize(e,t,s){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s});i.rotation=e.rotation,z(i,Uu,e.accessibilityData);const[r,o]=i.pageDimensions,[a,l,u,f]=i.getRectInCurrentCoords(e.rect,o);return i.x=a/r,i.y=l/o,i.width=u/r,i.height=f/o,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=y(this,ad))==null||e.abort(),z(this,ad,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),y(this,ya)&&(clearTimeout(y(this,ya)),z(this,ya,null)),O(this,pt,a0).call(this),this.removeEditToolbar(),y(this,Jr)){for(const s of y(this,Jr).values())clearTimeout(s);z(this,Jr,null)}this.parent=null,(t=y(this,Wu))==null||t.destroy(),z(this,Wu,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(O(this,pt,YF).call(this),y(this,Xs).classList.remove("hidden"),Vk(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),z(this,wl,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=y(this,Xs).children;if(!y(this,Eo)){z(this,Eo,Array.from(t));const o=O(this,pt,t6).bind(this),a=O(this,pt,n6).bind(this),l=this._uiManager._signal;for(const u of y(this,Eo)){const f=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",o,{signal:l}),u.addEventListener("blur",a,{signal:l}),u.addEventListener("focus",O(this,pt,s6).bind(this,f),{signal:l}),u.setAttribute("data-l10n-id",Et._l10nResizer[f])}}const s=y(this,Eo)[0];let i=0;for(const o of t){if(o===s)break;i++}const r=(360-this.rotation+this.parentRotation)%360/90*(y(this,Eo).length/4);if(r!==i){if(r<i)for(let a=0;a<i-r;a++)y(this,Xs).append(y(this,Xs).firstChild);else if(r>i)for(let a=0;a<r-i;a++)y(this,Xs).firstChild.before(y(this,Xs).lastChild);let o=0;for(const a of t){const u=y(this,Eo)[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",Et._l10nResizer[u])}}O(this,pt,sT).call(this,0),z(this,kl,!0),y(this,Xs).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){y(this,kl)&&O(this,pt,eT).call(this,y(this,Dx),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){O(this,pt,a0).call(this),this.div.focus()}select(){var e,t,s;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,r;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(t=this._editToolbar)==null||t.show(),(s=y(this,En))==null||s.toggleAltTextBadge(!1)}unselect(){var e,t,s,i,r;(e=y(this,Xs))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(r=y(this,En))==null||r.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return y(this,jx)}set isEditing(e){z(this,jx,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){z(this,$u,!0);const s=e/t,{style:i}=this.div;i.aspectRatio=s,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){y(this,Jr)||z(this,Jr,new Map);const{action:s}=e;let i=y(this,Jr).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),y(this,Jr).delete(s),y(this,Jr).size===0&&z(this,Jr,null)},Et._telemetryTimeout),y(this,Jr).set(s,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),z(this,Ip,!1)}disable(){this.div&&(this.div.tabIndex=-1),z(this,Ip,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Uu=new WeakMap,Eo=new WeakMap,En=new WeakMap,Ip=new WeakMap,od=new WeakMap,zx=new WeakMap,$u=new WeakMap,Xs=new WeakMap,Gu=new WeakMap,wl=new WeakMap,ad=new WeakMap,Dx=new WeakMap,Vu=new WeakMap,gr=new WeakMap,jx=new WeakMap,qu=new WeakMap,kl=new WeakMap,ya=new WeakMap,zp=new WeakMap,Dp=new WeakMap,Jr=new WeakMap,Wu=new WeakMap,Px=new WeakMap,sS=new WeakMap,pt=new WeakSet,XE=function([e,t],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Lx=new WeakSet,QE=function(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},uw=function(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}},YF=function(){if(y(this,Xs))return;z(this,Xs,document.createElement("div")),y(this,Xs).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const i=document.createElement("div");y(this,Xs).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",O(this,pt,JF).bind(this,s),{signal:t}),i.addEventListener("contextmenu",Uo,{signal:t}),i.tabIndex=-1}this.div.prepend(y(this,Xs))},JF=function(e,t){var f;t.preventDefault();const{isMac:s}=zi.platform;if(t.button!==0||t.ctrlKey&&s)return;(f=y(this,En))==null||f.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,z(this,Gu,[t.screenX,t.screenY]);const r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",O(this,pt,eT).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",Rr,{passive:!1,signal:o}),window.addEventListener("contextmenu",Uo,{signal:o}),z(this,wl,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const u=()=>{var p;r.abort(),this.parent.togglePointerEvents(!0),(p=y(this,En))==null||p.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=l,O(this,pt,hw).call(this)};window.addEventListener("pointerup",u,{signal:o}),window.addEventListener("blur",u,{signal:o})},ZE=function(e,t,s,i){this.width=s,this.height=i,this.x=e,this.y=t;const[r,o]=this.parentDimensions;this.setDims(r*s,o*i),this.fixAndSetPosition(),this._onResized()},hw=function(){if(!y(this,wl))return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:i}=y(this,wl);z(this,wl,null);const r=this.x,o=this.y,a=this.width,l=this.height;r===e&&o===t&&a===s&&l===i||this.addCommands({cmd:O(this,pt,ZE).bind(this,r,o,a,l),undo:O(this,pt,ZE).bind(this,e,t,s,i),mustExec:!0})},eT=function(e,t){const[s,i]=this.parentDimensions,r=this.x,o=this.y,a=this.width,l=this.height,u=Et.MIN_SIZE/s,f=Et.MIN_SIZE/i,p=O(this,pt,uw).call(this,this.rotation),g=($,Y)=>[p[0]*$+p[2]*Y,p[1]*$+p[3]*Y],b=O(this,pt,uw).call(this,360-this.rotation),w=($,Y)=>[b[0]*$+b[2]*Y,b[1]*$+b[3]*Y];let S,N,C=!1,M=!1;switch(e){case"topLeft":C=!0,S=($,Y)=>[0,0],N=($,Y)=>[$,Y];break;case"topMiddle":S=($,Y)=>[$/2,0],N=($,Y)=>[$/2,Y];break;case"topRight":C=!0,S=($,Y)=>[$,0],N=($,Y)=>[0,Y];break;case"middleRight":M=!0,S=($,Y)=>[$,Y/2],N=($,Y)=>[0,Y/2];break;case"bottomRight":C=!0,S=($,Y)=>[$,Y],N=($,Y)=>[0,0];break;case"bottomMiddle":S=($,Y)=>[$/2,Y],N=($,Y)=>[$/2,0];break;case"bottomLeft":C=!0,S=($,Y)=>[0,Y],N=($,Y)=>[$,0];break;case"middleLeft":M=!0,S=($,Y)=>[0,Y/2],N=($,Y)=>[$,Y/2];break}const R=S(a,l),_=N(a,l);let j=g(..._);const P=Et._round(r+j[0]),D=Et._round(o+j[1]);let U=1,V=1,q,G;if(t.fromKeyboard)({deltaX:q,deltaY:G}=t);else{const{screenX:$,screenY:Y}=t,[he,Re]=y(this,Gu);[q,G]=this.screenToPageTranslation($-he,Y-Re),y(this,Gu)[0]=$,y(this,Gu)[1]=Y}if([q,G]=w(q/s,G/i),C){const $=Math.hypot(a,l);U=V=Math.max(Math.min(Math.hypot(_[0]-R[0]-q,_[1]-R[1]-G)/$,1/a,1/l),u/a,f/l)}else M?U=Math.max(u,Math.min(1,Math.abs(_[0]-R[0]-q)))/a:V=Math.max(f,Math.min(1,Math.abs(_[1]-R[1]-G)))/l;const ee=Et._round(a*U),W=Et._round(l*V);j=g(...N(ee,W));const Q=P-j[0],Z=D-j[1];y(this,gr)||z(this,gr,[this.x,this.y,this.width,this.height]),this.width=ee,this.height=W,this.x=Q,this.y=Z,this.setDims(s*ee,i*W),this.fixAndSetPosition(),this._onResizing()},XF=function(){var e;z(this,wl,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=y(this,En))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},QF=function(e,t,s){let r=.7*(s/t)+1-.7;if(r===1)return;const o=O(this,pt,uw).call(this,this.rotation),a=(P,D)=>[o[0]*P+o[2]*D,o[1]*P+o[3]*D],[l,u]=this.parentDimensions,f=this.x,p=this.y,g=this.width,b=this.height,w=Et.MIN_SIZE/l,S=Et.MIN_SIZE/u;r=Math.max(Math.min(r,1/g,1/b),w/g,S/b);const N=Et._round(g*r),C=Et._round(b*r);if(N===g&&C===b)return;y(this,gr)||z(this,gr,[f,p,g,b]);const M=a(g/2,b/2),R=Et._round(f+M[0]),_=Et._round(p+M[1]),j=a(N/2,C/2);this.x=R-j[0],this.y=_-j[1],this.width=N,this.height=C,this.setDims(l*N,u*C),this.fixAndSetPosition(),this._onResizing()},ZF=function(){var e;(e=y(this,En))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),O(this,pt,hw).call(this)},tT=function(e){const{isMac:t}=zi.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},e6=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,r=this._uiManager.combinedSignal(i),o={capture:!0,passive:!1,signal:r},a=u=>{i.abort(),z(this,od,null),z(this,Vu,!1),this._uiManager.endDragSession()||O(this,pt,tT).call(this,u),s&&this._onStopDragging()};t&&(z(this,zp,e.clientX),z(this,Dp,e.clientY),z(this,od,e.pointerId),z(this,zx,e.pointerType),window.addEventListener("pointermove",u=>{s||(s=!0,this._onStartDragging());const{clientX:f,clientY:p,pointerId:g}=u;if(g!==y(this,od)){Rr(u);return}const[b,w]=this.screenToPageTranslation(f-y(this,zp),p-y(this,Dp));z(this,zp,f),z(this,Dp,p),this._uiManager.dragSelectedEditors(b,w)},o),window.addEventListener("touchmove",Rr,o),window.addEventListener("pointerdown",u=>{u.pointerType===y(this,zx)&&(y(this,Wu)||u.isPrimary)&&a(u),Rr(u)},o));const l=u=>{if(!y(this,od)||y(this,od)===u.pointerId){a(u);return}Rr(u)};window.addEventListener("pointerup",l,{signal:r}),window.addEventListener("blur",l,{signal:r})},nT=function(){if(y(this,ad)||!this.div)return;z(this,ad,new AbortController);const e=this._uiManager.combinedSignal(y(this,ad));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},t6=function(e){Et._resizerKeyboardManager.exec(this,e)},n6=function(e){var t;y(this,kl)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==y(this,Xs)&&O(this,pt,a0).call(this)},s6=function(e){z(this,Dx,y(this,kl)?e:"")},sT=function(e){if(y(this,Eo))for(const t of y(this,Eo))t.tabIndex=e},a0=function(){z(this,kl,!1),O(this,pt,sT).call(this,-1),O(this,pt,hw).call(this)},L(Et,Lx),We(Et,"_l10n",null),We(Et,"_l10nResizer",null),We(Et,"_borderLineWidth",-1),We(Et,"_colorManager",new $E),We(Et,"_zIndex",1),We(Et,"_telemetryTimeout",1e3);let Fn=Et;class Zle extends Fn{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const iO=3285377520,qr=4294901760,sa=65535;class i6{constructor(e){this.h1=e?e&4294967295:iO,this.h2=e?e&4294967295:iO}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let S=0,N=e.length;S<N;S++){const C=e.charCodeAt(S);C<=255?t[s++]=C:(t[s++]=C>>>8,t[s++]=C&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,r=s-i*4,o=new Uint32Array(t.buffer,0,i);let a=0,l=0,u=this.h1,f=this.h2;const p=3432918353,g=461845907,b=p&sa,w=g&sa;for(let S=0;S<i;S++)S&1?(a=o[S],a=a*p&qr|a*b&sa,a=a<<15|a>>>17,a=a*g&qr|a*w&sa,u^=a,u=u<<13|u>>>19,u=u*5+3864292196):(l=o[S],l=l*p&qr|l*b&sa,l=l<<15|l>>>17,l=l*g&qr|l*w&sa,f^=l,f=f<<13|f>>>19,f=f*5+3864292196);switch(a=0,r){case 3:a^=t[i*4+2]<<16;case 2:a^=t[i*4+1]<<8;case 1:a^=t[i*4],a=a*p&qr|a*b&sa,a=a<<15|a>>>17,a=a*g&qr|a*w&sa,i&1?u^=a:f^=a}this.h1=u,this.h2=f}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&qr|e*36045&sa,t=t*4283543511&qr|((t<<16|e>>>16)*2950163797&qr)>>>16,e^=t>>>1,e=e*444984403&qr|e*60499&sa,t=t*3301882366&qr|((t<<16|e>>>16)*3120437893&qr)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const iT=Object.freeze({map:null,hash:"",transfer:void 0});var Ku,Yu,js,iS,r6;class j2{constructor(){L(this,iS);L(this,Ku,!1);L(this,Yu,null);L(this,js,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=y(this,js).get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return y(this,js).get(e)}remove(e){if(y(this,js).delete(e),y(this,js).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of y(this,js).values())if(t instanceof Fn)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=y(this,js).get(e);let i=!1;if(s!==void 0)for(const[r,o]of Object.entries(t))s[r]!==o&&(i=!0,s[r]=o);else i=!0,y(this,js).set(e,t);i&&O(this,iS,r6).call(this),t instanceof Fn&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return y(this,js).has(e)}getAll(){return y(this,js).size>0?_2(y(this,js)):null}setAll(e){for(const[t,s]of Object.entries(e))this.setValue(t,s)}get size(){return y(this,js).size}resetModified(){y(this,Ku)&&(z(this,Ku,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new o6(this)}get serializable(){if(y(this,js).size===0)return iT;const e=new Map,t=new i6,s=[],i=Object.create(null);let r=!1;for(const[o,a]of y(this,js)){const l=a instanceof Fn?a.serialize(!1,i):a;l&&(e.set(o,l),t.update(`${o}:${JSON.stringify(l)}`),r||(r=!!l.bitmap))}if(r)for(const o of e.values())o.bitmap&&s.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:iT}get editorStats(){let e=null;const t=new Map;for(const s of y(this,js).values()){if(!(s instanceof Fn))continue;const i=s.telemetryFinalData;if(!i)continue;const{type:r}=i;t.has(r)||t.set(r,Object.getPrototypeOf(s).constructor),e||(e=Object.create(null));const o=e[r]||(e[r]=new Map);for(const[a,l]of Object.entries(i)){if(a==="type")continue;let u=o.get(a);u||(u=new Map,o.set(a,u));const f=u.get(l)??0;u.set(l,f+1)}}for(const[s,i]of t)e[s]=i.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){z(this,Yu,null)}get modifiedIds(){if(y(this,Yu))return y(this,Yu);const e=[];for(const t of y(this,js).values())!(t instanceof Fn)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return z(this,Yu,{ids:new Set(e),hash:e.join(",")})}}Ku=new WeakMap,Yu=new WeakMap,js=new WeakMap,iS=new WeakSet,r6=function(){y(this,Ku)||(z(this,Ku,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Ox;class o6 extends j2{constructor(t){super();L(this,Ox);const{map:s,hash:i,transfer:r}=t.serializable,o=structuredClone(s,r?{transfer:r}:null);z(this,Ox,{map:o,hash:i,transfer:r})}get print(){xn("Should not call PrintAnnotationStorage.print")}get serializable(){return y(this,Ox)}get modifiedIds(){return It(this,"modifiedIds",{ids:new Set,hash:""})}}Ox=new WeakMap;var jp;class ece{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){L(this,jp,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),y(this,jp).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||y(this,jp).has(e.loadedName))){if(ms(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:i,style:r}=e,o=new FontFace(s,i,r);this.addNativeFontFace(o);try{await o.load(),y(this,jp).add(s),t==null||t(e)}catch{At(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}xn("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw At(`Failed to load font '${s.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return It(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(xi||typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),It(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(ms(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const r=s.shift();setTimeout(r.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:t,callback:e};return s.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return It(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(_,j){return _.charCodeAt(j)<<24|_.charCodeAt(j+1)<<16|_.charCodeAt(j+2)<<8|_.charCodeAt(j+3)&255}function i(_,j,P,D){const U=_.substring(0,j),V=_.substring(j+P);return U+D+V}let r,o;const a=this._document.createElement("canvas");a.width=1,a.height=1;const l=a.getContext("2d");let u=0;function f(_,j){if(++u>30){At("Load test font never loaded."),j();return}if(l.font="30px "+_,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){j();return}setTimeout(f.bind(null,_,j))}const p=`lt${Date.now()}${this.loadTestFontId++}`;let g=this._loadTestFont;g=i(g,976,p.length,p);const w=16,S=1482184792;let N=s(g,w);for(r=0,o=p.length-3;r<o;r+=4)N=N-S+s(p,r)|0;r<p.length&&(N=N-S+s(p+"XXX",r)|0),g=i(g,w,4,Ble(N));const C=`url(data:font/opentype;base64,${btoa(g)});`,M=`@font-face {font-family:"${p}";src:${C}}`;this.insertRule(M);const R=this._document.createElement("div");R.style.visibility="hidden",R.style.width=R.style.height="10px",R.style.position="absolute",R.style.top=R.style.left="0px";for(const _ of[e.loadedName,p]){const j=this._document.createElement("span");j.textContent="Hi",j.style.fontFamily=_,R.append(j)}this._document.body.append(R),f(p,()=>{R.remove(),t.complete()})}}jp=new WeakMap;class tce{constructor(e,{disableFontFace:t=!1,fontExtraProperties:s=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(const r in e)this[r]=e[r];this.disableFontFace=t===!0,this.fontExtraProperties=s===!0,this._inspectFont=i}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${Vle(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(s=this._inspectFont)==null||s.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let i;try{i=e.get(s)}catch(o){At(`getPathGenerator - ignoring character: "${o}".`)}const r=new Path2D(i||"");return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=r}}const Uv={DATA:1,ERROR:2},ps={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function rO(){}function Wi(n){if(n instanceof Od||n instanceof LE||n instanceof cx||n instanceof tO||n instanceof Gk||n instanceof uN)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||xn('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new Od(n.message);case"InvalidPDFException":return new LE(n.message);case"MissingPDFException":return new cx(n.message);case"PasswordException":return new tO(n.message,n.code);case"UnexpectedResponseException":return new Gk(n.message,n.status);case"UnknownErrorException":return new uN(n.message,n.details)}return new uN(n.message,n.toString())}var Pp,ho,a6,l6,c6,fw;class l0{constructor(e,t,s){L(this,ho);L(this,Pp,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",O(this,ho,a6).bind(this),{signal:y(this,Pp).signal})}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const i=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[i]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},s)}catch(o){r.reject(o)}return r.promise}sendWithStream(e,t,s,i){const r=this.streamId++,o=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:u=>{const f=Promise.withResolvers();return this.streamControllers[r]={controller:u,startCall:f,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:o,targetName:a,action:e,streamId:r,data:t,desiredSize:u.desiredSize},i),f.promise},pull:u=>{const f=Promise.withResolvers();return this.streamControllers[r].pullCall=f,l.postMessage({sourceName:o,targetName:a,stream:ps.PULL,streamId:r,desiredSize:u.desiredSize}),f.promise},cancel:u=>{ms(u instanceof Error,"cancel must have a valid reason");const f=Promise.withResolvers();return this.streamControllers[r].cancelCall=f,this.streamControllers[r].isClosed=!0,l.postMessage({sourceName:o,targetName:a,stream:ps.CANCEL,streamId:r,reason:Wi(u)}),f.promise}},s)}destroy(){var e;(e=y(this,Pp))==null||e.abort(),z(this,Pp,null)}}Pp=new WeakMap,ho=new WeakSet,a6=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){O(this,ho,c6).call(this,e);return}if(e.callback){const s=e.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===Uv.DATA)i.resolve(e.data);else if(e.callback===Uv.ERROR)i.reject(Wi(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,i=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(o){r.postMessage({sourceName:s,targetName:i,callback:Uv.DATA,callbackId:e.callbackId,data:o})},function(o){r.postMessage({sourceName:s,targetName:i,callback:Uv.ERROR,callbackId:e.callbackId,reason:Wi(o)})});return}if(e.streamId){O(this,ho,l6).call(this,e);return}t(e.data)},l6=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,o=this,a=this.actionHandler[e.action],l={enqueue(u,f=1,p){if(this.isCancelled)return;const g=this.desiredSize;this.desiredSize-=f,g>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:s,targetName:i,stream:ps.ENQUEUE,streamId:t,chunk:u},p)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:ps.CLOSE,streamId:t}),delete o.streamSinks[t])},error(u){ms(u instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:ps.ERROR,streamId:t,reason:Wi(u)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(a,e.data,l).then(function(){r.postMessage({sourceName:s,targetName:i,stream:ps.START_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:s,targetName:i,stream:ps.START_COMPLETE,streamId:t,reason:Wi(u)})})},c6=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,o=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case ps.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(Wi(e.reason));break;case ps.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(Wi(e.reason));break;case ps.PULL:if(!a){r.postMessage({sourceName:s,targetName:i,stream:ps.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||rO).then(function(){r.postMessage({sourceName:s,targetName:i,stream:ps.PULL_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:s,targetName:i,stream:ps.PULL_COMPLETE,streamId:t,reason:Wi(u)})});break;case ps.ENQUEUE:if(ms(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case ps.CLOSE:if(ms(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),O(this,ho,fw).call(this,o,t);break;case ps.ERROR:ms(o,"error should have stream controller"),o.controller.error(Wi(e.reason)),O(this,ho,fw).call(this,o,t);break;case ps.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(Wi(e.reason)),O(this,ho,fw).call(this,o,t);break;case ps.CANCEL:if(!a)break;const l=Wi(e.reason);Promise.try(a.onCancel||rO,l).then(function(){r.postMessage({sourceName:s,targetName:i,stream:ps.CANCEL_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:s,targetName:i,stream:ps.CANCEL_COMPLETE,streamId:t,reason:Wi(u)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},fw=async function(e,t){var s,i,r;await Promise.allSettled([(s=e.startCall)==null?void 0:s.promise,(i=e.pullCall)==null?void 0:i.promise,(r=e.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[t]};var Bx;class d6{constructor({enableHWA:e=!1}){L(this,Bx,!1);z(this,Bx,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!y(this,Bx)})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){xn("Abstract method `_createCanvas` called.")}}Bx=new WeakMap;class nce extends d6{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class u6{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){xn("Abstract method `_fetch` called.")}}class h6 extends u6{async _fetch(e){const t=await QS(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):XS(t)}}class f6{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,i,r){return"none"}destroy(e=!1){}}var Ju,Lp,Sl,Cl,hi,Xu,Qu,Xe,ci,c0,tp,pw,np,p6,rT,sp,d0,u0,oT,h0;class sce extends f6{constructor({docId:t,ownerDocument:s=globalThis.document}){super();L(this,Xe);L(this,Ju);L(this,Lp);L(this,Sl);L(this,Cl);L(this,hi);L(this,Xu);L(this,Qu,0);z(this,Cl,t),z(this,hi,s)}addFilter(t){if(!t)return"none";let s=y(this,Xe,ci).get(t);if(s)return s;const[i,r,o]=O(this,Xe,pw).call(this,t),a=t.length===1?i:`${i}${r}${o}`;if(s=y(this,Xe,ci).get(a),s)return y(this,Xe,ci).set(t,s),s;const l=`g_${y(this,Cl)}_transfer_map_${Ni(this,Qu)._++}`,u=O(this,Xe,np).call(this,l);y(this,Xe,ci).set(t,u),y(this,Xe,ci).set(a,u);const f=O(this,Xe,sp).call(this,l);return O(this,Xe,u0).call(this,i,r,o,f),u}addHCMFilter(t,s){var w;const i=`${t}-${s}`,r="base";let o=y(this,Xe,c0).get(r);if((o==null?void 0:o.key)===i||(o?((w=o.filter)==null||w.remove(),o.key=i,o.url="none",o.filter=null):(o={key:i,url:"none",filter:null},y(this,Xe,c0).set(r,o)),!t||!s))return o.url;const a=O(this,Xe,h0).call(this,t);t=rt.makeHexColor(...a);const l=O(this,Xe,h0).call(this,s);if(s=rt.makeHexColor(...l),y(this,Xe,tp).style.color="",t==="#000000"&&s==="#ffffff"||t===s)return o.url;const u=new Array(256);for(let S=0;S<=255;S++){const N=S/255;u[S]=N<=.03928?N/12.92:((N+.055)/1.055)**2.4}const f=u.join(","),p=`g_${y(this,Cl)}_hcm_filter`,g=o.filter=O(this,Xe,sp).call(this,p);O(this,Xe,u0).call(this,f,f,f,g),O(this,Xe,rT).call(this,g);const b=(S,N)=>{const C=a[S]/255,M=l[S]/255,R=new Array(N+1);for(let _=0;_<=N;_++)R[_]=C+_/N*(M-C);return R.join(",")};return O(this,Xe,u0).call(this,b(0,5),b(1,5),b(2,5),g),o.url=O(this,Xe,np).call(this,p),o.url}addAlphaFilter(t){let s=y(this,Xe,ci).get(t);if(s)return s;const[i]=O(this,Xe,pw).call(this,[t]),r=`alpha_${i}`;if(s=y(this,Xe,ci).get(r),s)return y(this,Xe,ci).set(t,s),s;const o=`g_${y(this,Cl)}_alpha_map_${Ni(this,Qu)._++}`,a=O(this,Xe,np).call(this,o);y(this,Xe,ci).set(t,a),y(this,Xe,ci).set(r,a);const l=O(this,Xe,sp).call(this,o);return O(this,Xe,oT).call(this,i,l),a}addLuminosityFilter(t){let s=y(this,Xe,ci).get(t||"luminosity");if(s)return s;let i,r;if(t?([i]=O(this,Xe,pw).call(this,[t]),r=`luminosity_${i}`):r="luminosity",s=y(this,Xe,ci).get(r),s)return y(this,Xe,ci).set(t,s),s;const o=`g_${y(this,Cl)}_luminosity_map_${Ni(this,Qu)._++}`,a=O(this,Xe,np).call(this,o);y(this,Xe,ci).set(t,a),y(this,Xe,ci).set(r,a);const l=O(this,Xe,sp).call(this,o);return O(this,Xe,p6).call(this,l),t&&O(this,Xe,oT).call(this,i,l),a}addHighlightHCMFilter(t,s,i,r,o){var M;const a=`${s}-${i}-${r}-${o}`;let l=y(this,Xe,c0).get(t);if((l==null?void 0:l.key)===a||(l?((M=l.filter)==null||M.remove(),l.key=a,l.url="none",l.filter=null):(l={key:a,url:"none",filter:null},y(this,Xe,c0).set(t,l)),!s||!i))return l.url;const[u,f]=[s,i].map(O(this,Xe,h0).bind(this));let p=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),g=Math.round(.2126*f[0]+.7152*f[1]+.0722*f[2]),[b,w]=[r,o].map(O(this,Xe,h0).bind(this));g<p&&([p,g,b,w]=[g,p,w,b]),y(this,Xe,tp).style.color="";const S=(R,_,j)=>{const P=new Array(256),D=(g-p)/j,U=R/255,V=(_-R)/(255*j);let q=0;for(let G=0;G<=j;G++){const ee=Math.round(p+G*D),W=U+G*V;for(let Q=q;Q<=ee;Q++)P[Q]=W;q=ee+1}for(let G=q;G<256;G++)P[G]=P[q-1];return P.join(",")},N=`g_${y(this,Cl)}_hcm_${t}_filter`,C=l.filter=O(this,Xe,sp).call(this,N);return O(this,Xe,rT).call(this,C),O(this,Xe,u0).call(this,S(b[0],w[0],5),S(b[1],w[1],5),S(b[2],w[2],5),C),l.url=O(this,Xe,np).call(this,N),l.url}destroy(t=!1){var s,i,r,o;t&&((s=y(this,Xu))!=null&&s.size)||((i=y(this,Sl))==null||i.parentNode.parentNode.remove(),z(this,Sl,null),(r=y(this,Lp))==null||r.clear(),z(this,Lp,null),(o=y(this,Xu))==null||o.clear(),z(this,Xu,null),z(this,Qu,0))}}Ju=new WeakMap,Lp=new WeakMap,Sl=new WeakMap,Cl=new WeakMap,hi=new WeakMap,Xu=new WeakMap,Qu=new WeakMap,Xe=new WeakSet,ci=function(){return y(this,Lp)||z(this,Lp,new Map)},c0=function(){return y(this,Xu)||z(this,Xu,new Map)},tp=function(){if(!y(this,Sl)){const t=y(this,hi).createElement("div"),{style:s}=t;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=y(this,hi).createElementNS(dl,"svg");i.setAttribute("width",0),i.setAttribute("height",0),z(this,Sl,y(this,hi).createElementNS(dl,"defs")),t.append(i),i.append(y(this,Sl)),y(this,hi).body.append(t)}return y(this,Sl)},pw=function(t){if(t.length===1){const u=t[0],f=new Array(256);for(let g=0;g<256;g++)f[g]=u[g]/255;const p=f.join(",");return[p,p,p]}const[s,i,r]=t,o=new Array(256),a=new Array(256),l=new Array(256);for(let u=0;u<256;u++)o[u]=s[u]/255,a[u]=i[u]/255,l[u]=r[u]/255;return[o.join(","),a.join(","),l.join(",")]},np=function(t){if(y(this,Ju)===void 0){z(this,Ju,"");const s=y(this,hi).URL;s!==y(this,hi).baseURI&&(ZS(s)?At('#createUrl: ignore "data:"-URL for performance reasons.'):z(this,Ju,s.split("#",1)[0]))}return`url(${y(this,Ju)}#${t})`},p6=function(t){const s=y(this,hi).createElementNS(dl,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(s)},rT=function(t){const s=y(this,hi).createElementNS(dl,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(s)},sp=function(t){const s=y(this,hi).createElementNS(dl,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",t),y(this,Xe,tp).append(s),s},d0=function(t,s,i){const r=y(this,hi).createElementNS(dl,s);r.setAttribute("type","discrete"),r.setAttribute("tableValues",i),t.append(r)},u0=function(t,s,i,r){const o=y(this,hi).createElementNS(dl,"feComponentTransfer");r.append(o),O(this,Xe,d0).call(this,o,"feFuncR",t),O(this,Xe,d0).call(this,o,"feFuncG",s),O(this,Xe,d0).call(this,o,"feFuncB",i)},oT=function(t,s){const i=y(this,hi).createElementNS(dl,"feComponentTransfer");s.append(i),O(this,Xe,d0).call(this,i,"feFuncA",t)},h0=function(t){return y(this,Xe,tp).style.color=t,D2(getComputedStyle(y(this,Xe,tp)).getPropertyValue("color"))};class m6{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){xn("Abstract method `_fetch` called.")}}class g6 extends m6{async _fetch(e){const t=await QS(e,"arraybuffer");return new Uint8Array(t)}}xi&&At("Please use the `legacy` build in Node.js environments.");async function x6(n){const t=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(t)}class ice extends f6{}class rce extends d6{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class oce extends u6{async _fetch(e){return x6(e)}}class ace extends m6{async _fetch(e){return x6(e)}}const gi={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function aT(n,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,s),n.clip(i)}class P2{getPattern(){xn("Abstract method `getPattern` called.")}}class lce extends P2{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)t.addColorStop(s[0],s[1]);return t}getPattern(e,t,s,i){let r;if(i===gi.STROKE||i===gi.FILL){const o=t.current.getClippedPathBoundingBox(i,Dn(e))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,l=Math.ceil(o[3]-o[1])||1,u=t.cachedCanvases.getCanvas("pattern",a,l),f=u.context;f.clearRect(0,0,f.canvas.width,f.canvas.height),f.beginPath(),f.rect(0,0,f.canvas.width,f.canvas.height),f.translate(-o[0],-o[1]),s=rt.transform(s,[1,0,0,1,o[0],o[1]]),f.transform(...t.baseTransform),this.matrix&&f.transform(...this.matrix),aT(f,this._bbox),f.fillStyle=this._createGradient(f),f.fill(),r=e.createPattern(u.canvas,"no-repeat");const p=new DOMMatrix(s);r.setTransform(p)}else aT(e,this._bbox),r=this._createGradient(e);return r}}function pN(n,e,t,s,i,r,o,a){const l=e.coords,u=e.colors,f=n.data,p=n.width*4;let g;l[t+1]>l[s+1]&&(g=t,t=s,s=g,g=r,r=o,o=g),l[s+1]>l[i+1]&&(g=s,s=i,i=g,g=o,o=a,a=g),l[t+1]>l[s+1]&&(g=t,t=s,s=g,g=r,r=o,o=g);const b=(l[t]+e.offsetX)*e.scaleX,w=(l[t+1]+e.offsetY)*e.scaleY,S=(l[s]+e.offsetX)*e.scaleX,N=(l[s+1]+e.offsetY)*e.scaleY,C=(l[i]+e.offsetX)*e.scaleX,M=(l[i+1]+e.offsetY)*e.scaleY;if(w>=M)return;const R=u[r],_=u[r+1],j=u[r+2],P=u[o],D=u[o+1],U=u[o+2],V=u[a],q=u[a+1],G=u[a+2],ee=Math.round(w),W=Math.round(M);let Q,Z,$,Y,he,Re,ze,F;for(let J=ee;J<=W;J++){if(J<N){const re=J<w?0:(w-J)/(w-N);Q=b-(b-S)*re,Z=R-(R-P)*re,$=_-(_-D)*re,Y=j-(j-U)*re}else{let re;J>M?re=1:N===M?re=0:re=(N-J)/(N-M),Q=S-(S-C)*re,Z=P-(P-V)*re,$=D-(D-q)*re,Y=U-(U-G)*re}let ie;J<w?ie=0:J>M?ie=1:ie=(w-J)/(w-M),he=b-(b-C)*ie,Re=R-(R-V)*ie,ze=_-(_-q)*ie,F=j-(j-G)*ie;const pe=Math.round(Math.min(Q,he)),ue=Math.round(Math.max(Q,he));let ke=p*J+pe*4;for(let re=pe;re<=ue;re++)ie=(Q-re)/(Q-he),ie<0?ie=0:ie>1&&(ie=1),f[ke++]=Z-(Z-Re)*ie|0,f[ke++]=$-($-ze)*ie|0,f[ke++]=Y-(Y-F)*ie|0,f[ke++]=255}}function cce(n,e,t){const s=e.coords,i=e.colors;let r,o;switch(e.type){case"lattice":const a=e.verticesPerRow,l=Math.floor(s.length/a)-1,u=a-1;for(r=0;r<l;r++){let f=r*a;for(let p=0;p<u;p++,f++)pN(n,t,s[f],s[f+1],s[f+a],i[f],i[f+1],i[f+a]),pN(n,t,s[f+a+1],s[f+1],s[f+a],i[f+a+1],i[f+1],i[f+a])}break;case"triangles":for(r=0,o=s.length;r<o;r+=3)pN(n,t,s[r],s[r+1],s[r+2],i[r],i[r+1],i[r+2]);break;default:throw new Error("illegal figure")}}class dce extends P2{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,s){const a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-a,f=Math.ceil(this._bounds[3])-l,p=Math.min(Math.ceil(Math.abs(u*e[0]*1.1)),3e3),g=Math.min(Math.ceil(Math.abs(f*e[1]*1.1)),3e3),b=u/p,w=f/g,S={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/b,scaleY:1/w},N=p+4,C=g+4,M=s.getCanvas("mesh",N,C),R=M.context,_=R.createImageData(p,g);if(t){const P=_.data;for(let D=0,U=P.length;D<U;D+=4)P[D]=t[0],P[D+1]=t[1],P[D+2]=t[2],P[D+3]=255}for(const P of this._figures)cce(_,P,S);return R.putImageData(_,2,2),{canvas:M.canvas,offsetX:a-2*b,offsetY:l-2*w,scaleX:b,scaleY:w}}getPattern(e,t,s,i){aT(e,this._bbox);let r;if(i===gi.SHADING)r=rt.singularValueDecompose2dScale(Dn(e));else if(r=rt.singularValueDecompose2dScale(t.baseTransform),this.matrix){const a=rt.singularValueDecompose2dScale(this.matrix);r=[r[0]*a[0],r[1]*a[1]]}const o=this._createMeshCanvas(r,i===gi.SHADING?null:this._background,t.cachedCanvases);return i!==gi.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class uce extends P2{getPattern(){return"hotpink"}}function hce(n){switch(n[0]){case"RadialAxial":return new lce(n);case"Mesh":return new dce(n);case"Dummy":return new uce}throw new Error(`Unknown IR type: ${n[0]}`)}const oO={COLORED:1,UNCOLORED:2},rS=class rS{constructor(e,t,s,i,r){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=s,this.canvasGraphicsFactory=i,this.baseTransform=r}createPatternCanvas(e){const{bbox:t,operatorList:s,paintType:i,tilingType:r,color:o,canvasGraphicsFactory:a}=this;let{xstep:l,ystep:u}=this;l=Math.abs(l),u=Math.abs(u),JS("TilingType: "+r);const f=t[0],p=t[1],g=t[2],b=t[3],w=g-f,S=b-p,N=rt.singularValueDecompose2dScale(this.matrix),C=rt.singularValueDecompose2dScale(this.baseTransform),M=N[0]*C[0],R=N[1]*C[1];let _=w,j=S,P=!1,D=!1;const U=Math.ceil(l*M),V=Math.ceil(u*R),q=Math.ceil(w*M),G=Math.ceil(S*R);U>=q?_=l:P=!0,V>=G?j=u:D=!0;const ee=this.getSizeAndScale(_,this.ctx.canvas.width,M),W=this.getSizeAndScale(j,this.ctx.canvas.height,R),Q=e.cachedCanvases.getCanvas("pattern",ee.size,W.size),Z=Q.context,$=a.createCanvasGraphics(Z);if($.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext($,i,o),Z.translate(-ee.scale*f,-W.scale*p),$.transform(ee.scale,0,0,W.scale,0,0),Z.save(),this.clipBbox($,f,p,g,b),$.baseTransform=Dn($.ctx),$.executeOperatorList(s),$.endDrawing(),Z.restore(),P||D){const Y=Q.canvas;P&&(_=l),D&&(j=u);const he=this.getSizeAndScale(_,this.ctx.canvas.width,M),Re=this.getSizeAndScale(j,this.ctx.canvas.height,R),ze=he.size,F=Re.size,J=e.cachedCanvases.getCanvas("pattern-workaround",ze,F),ie=J.context,pe=P?Math.floor(w/l):0,ue=D?Math.floor(S/u):0;for(let ke=0;ke<=pe;ke++)for(let re=0;re<=ue;re++)ie.drawImage(Y,ze*ke,F*re,ze,F,0,0,ze,F);return{canvas:J.canvas,scaleX:he.scale,scaleY:Re.scale,offsetX:f,offsetY:p}}return{canvas:Q.canvas,scaleX:ee.scale,scaleY:W.scale,offsetX:f,offsetY:p}}getSizeAndScale(e,t,s){const i=Math.max(rS.MAX_PATTERN_SIZE,t);let r=Math.ceil(e*s);return r>=i?r=i:s=r/e,{scale:s,size:r}}clipBbox(e,t,s,i,r){const o=i-t,a=r-s;e.ctx.rect(t,s,o,a),e.current.updateRectMinMax(Dn(e.ctx),[t,s,i,r]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const i=e.ctx,r=e.current;switch(t){case oO.COLORED:const o=this.ctx;i.fillStyle=o.fillStyle,i.strokeStyle=o.strokeStyle,r.fillColor=o.fillStyle,r.strokeColor=o.strokeStyle;break;case oO.UNCOLORED:const a=rt.makeHexColor(s[0],s[1],s[2]);i.fillStyle=a,i.strokeStyle=a,r.fillColor=a,r.strokeColor=a;break;default:throw new Ole(`Unsupported paint type: ${t}`)}}getPattern(e,t,s,i){let r=s;i!==gi.SHADING&&(r=rt.transform(r,t.baseTransform),this.matrix&&(r=rt.transform(r,this.matrix)));const o=this.createPatternCanvas(t);let a=new DOMMatrix(r);a=a.translate(o.offsetX,o.offsetY),a=a.scale(1/o.scaleX,1/o.scaleY);const l=e.createPattern(o.canvas,"repeat");return l.setTransform(a),l}};We(rS,"MAX_PATTERN_SIZE",3e3);let lT=rS;function fce({src:n,srcPos:e=0,dest:t,width:s,height:i,nonBlackColor:r=4294967295,inverseDecode:o=!1}){const a=zi.isLittleEndian?4278190080:255,[l,u]=o?[r,a]:[a,r],f=s>>3,p=s&7,g=n.length;t=new Uint32Array(t.buffer);let b=0;for(let w=0;w<i;w++){for(const N=e+f;e<N;e++){const C=e<g?n[e]:255;t[b++]=C&128?u:l,t[b++]=C&64?u:l,t[b++]=C&32?u:l,t[b++]=C&16?u:l,t[b++]=C&8?u:l,t[b++]=C&4?u:l,t[b++]=C&2?u:l,t[b++]=C&1?u:l}if(p===0)continue;const S=e<g?n[e++]:255;for(let N=0;N<p;N++)t[b++]=S&1<<7-N?u:l}return{srcPos:e,destPos:b}}const aO=16,lO=100,pce=15,cO=10,dO=1e3,Qi=16;function mce(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(s,i){e.translate(s,i),this.__originalTranslate(s,i)},n.scale=function(s,i){e.scale(s,i),this.__originalScale(s,i)},n.transform=function(s,i,r,o,a,l){e.transform(s,i,r,o,a,l),this.__originalTransform(s,i,r,o,a,l)},n.setTransform=function(s,i,r,o,a,l){e.setTransform(s,i,r,o,a,l),this.__originalSetTransform(s,i,r,o,a,l)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(s){e.rotate(s),this.__originalRotate(s)},n.clip=function(s){e.clip(s),this.__originalClip(s)},n.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},n.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},n.bezierCurveTo=function(t,s,i,r,o,a){e.bezierCurveTo(t,s,i,r,o,a),this.__originalBezierCurveTo(t,s,i,r,o,a)},n.rect=function(t,s,i,r){e.rect(t,s,i,r),this.__originalRect(t,s,i,r)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class gce{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,s)):(i=this.canvasFactory.create(t,s),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function $v(n,e,t,s,i,r,o,a,l,u){const[f,p,g,b,w,S]=Dn(n);if(p===0&&g===0){const M=o*f+w,R=Math.round(M),_=a*b+S,j=Math.round(_),P=(o+l)*f+w,D=Math.abs(Math.round(P)-R)||1,U=(a+u)*b+S,V=Math.abs(Math.round(U)-j)||1;return n.setTransform(Math.sign(f),0,0,Math.sign(b),R,j),n.drawImage(e,t,s,i,r,0,0,D,V),n.setTransform(f,p,g,b,w,S),[D,V]}if(f===0&&b===0){const M=a*g+w,R=Math.round(M),_=o*p+S,j=Math.round(_),P=(a+u)*g+w,D=Math.abs(Math.round(P)-R)||1,U=(o+l)*p+S,V=Math.abs(Math.round(U)-j)||1;return n.setTransform(0,Math.sign(p),Math.sign(g),0,R,j),n.drawImage(e,t,s,i,r,0,0,V,D),n.setTransform(f,p,g,b,w,S),[V,D]}n.drawImage(e,t,s,i,r,o,a,l,u);const N=Math.hypot(f,p),C=Math.hypot(g,b);return[N*l,C*u]}function xce(n){const{width:e,height:t}=n;if(e>dO||t>dO)return null;const s=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),r=e+1;let o=new Uint8Array(r*(t+1)),a,l,u;const f=e+7&-8;let p=new Uint8Array(f*t),g=0;for(const C of n.data){let M=128;for(;M>0;)p[g++]=C&M?0:255,M>>=1}let b=0;for(g=0,p[g]!==0&&(o[0]=1,++b),l=1;l<e;l++)p[g]!==p[g+1]&&(o[l]=p[g]?2:1,++b),g++;for(p[g]!==0&&(o[l]=2,++b),a=1;a<t;a++){g=a*f,u=a*r,p[g-f]!==p[g]&&(o[u]=p[g]?1:8,++b);let C=(p[g]?4:0)+(p[g-f]?8:0);for(l=1;l<e;l++)C=(C>>2)+(p[g+1]?4:0)+(p[g-f+1]?8:0),i[C]&&(o[u+l]=i[C],++b),g++;if(p[g-f]!==p[g]&&(o[u+l]=p[g]?2:4,++b),b>s)return null}for(g=f*(t-1),u=a*r,p[g]!==0&&(o[u]=8,++b),l=1;l<e;l++)p[g]!==p[g+1]&&(o[u+l]=p[g]?4:8,++b),g++;if(p[g]!==0&&(o[u+l]=4,++b),b>s)return null;const w=new Int32Array([0,r,-1,0,-r,0,0,0,1]),S=new Path2D;for(a=0;b&&a<=t;a++){let C=a*r;const M=C+e;for(;C<M&&!o[C];)C++;if(C===M)continue;S.moveTo(C%r,a);const R=C;let _=o[C];do{const j=w[_];do C+=j;while(!o[C]);const P=o[C];P!==5&&P!==10?(_=P,o[C]=0):(_=P&51*_>>4,o[C]&=_>>2|_<<2),S.lineTo(C%r,C/r|0),o[C]||--b}while(R!==C);--a}return p=null,o=null,function(C){C.save(),C.scale(1/e,-1/t),C.translate(0,-t),C.fill(S),C.beginPath(),C.restore()}}class uO{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=EF,this.textMatrixScale=1,this.fontMatrix=PE,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=li.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,s){[t,s]=rt.applyTransform([t,s],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(e,t){const s=rt.applyTransform(t,e),i=rt.applyTransform(t.slice(2),e),r=rt.applyTransform([t[0],t[3]],e),o=rt.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,s[0],i[0],r[0],o[0]),this.minY=Math.min(this.minY,s[1],i[1],r[1],o[1]),this.maxX=Math.max(this.maxX,s[0],i[0],r[0],o[0]),this.maxY=Math.max(this.maxY,s[1],i[1],r[1],o[1])}updateScalingPathMinMax(e,t){rt.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,s,i,r,o,a,l,u,f){const p=rt.bezierBoundingBox(t,s,i,r,o,a,l,u,f);f||this.updateRectMinMax(e,p)}getPathBoundingBox(e=gi.FILL,t=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(e===gi.STROKE){t||xn("Stroke bounding box must include transform.");const i=rt.singularValueDecompose2dScale(t),r=i[0]*this.lineWidth/2,o=i[1]*this.lineWidth/2;s[0]-=r,s[1]-=o,s[2]+=r,s[3]+=o}return s}updateClipFromPath(){const e=rt.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=gi.FILL,t=null){return rt.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function hO(n,e){if(e instanceof ImageData){n.putImageData(e,0,0);return}const t=e.height,s=e.width,i=t%Qi,r=(t-i)/Qi,o=i===0?r:r+1,a=n.createImageData(s,Qi);let l=0,u;const f=e.data,p=a.data;let g,b,w,S;if(e.kind===iw.GRAYSCALE_1BPP){const N=f.byteLength,C=new Uint32Array(p.buffer,0,p.byteLength>>2),M=C.length,R=s+7>>3,_=4294967295,j=zi.isLittleEndian?4278190080:255;for(g=0;g<o;g++){for(w=g<r?Qi:i,u=0,b=0;b<w;b++){const P=N-l;let D=0;const U=P>R?s:P*8-7,V=U&-8;let q=0,G=0;for(;D<V;D+=8)G=f[l++],C[u++]=G&128?_:j,C[u++]=G&64?_:j,C[u++]=G&32?_:j,C[u++]=G&16?_:j,C[u++]=G&8?_:j,C[u++]=G&4?_:j,C[u++]=G&2?_:j,C[u++]=G&1?_:j;for(;D<U;D++)q===0&&(G=f[l++],q=128),C[u++]=G&q?_:j,q>>=1}for(;u<M;)C[u++]=0;n.putImageData(a,0,g*Qi)}}else if(e.kind===iw.RGBA_32BPP){for(b=0,S=s*Qi*4,g=0;g<r;g++)p.set(f.subarray(l,l+S)),l+=S,n.putImageData(a,0,b),b+=Qi;g<o&&(S=s*i*4,p.set(f.subarray(l,l+S)),n.putImageData(a,0,b))}else if(e.kind===iw.RGB_24BPP)for(w=Qi,S=s*w,g=0;g<o;g++){for(g>=r&&(w=i,S=s*w),u=0,b=S;b--;)p[u++]=f[l++],p[u++]=f[l++],p[u++]=f[l++],p[u++]=255;n.putImageData(a,0,g*Qi)}else throw new Error(`bad image kind: ${e.kind}`)}function fO(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,i=t%Qi,r=(t-i)/Qi,o=i===0?r:r+1,a=n.createImageData(s,Qi);let l=0;const u=e.data,f=a.data;for(let p=0;p<o;p++){const g=p<r?Qi:i;({srcPos:l}=fce({src:u,srcPos:l,dest:f,width:s,height:g,nonBlackColor:0})),n.putImageData(a,0,p*Qi)}}function Yg(n,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)n[s]!==void 0&&(e[s]=n[s]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function Gv(n){if(n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0),!xi){const{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}}function pO(n,e){if(e)return!0;const t=rt.singularValueDecompose2dScale(n);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*Bd.PDF_TO_CSS_UNITS);return t[0]<=s&&t[1]<=s}const bce=["butt","round","square"],yce=["miter","round","bevel"],vce={},mO={};var $o,cT,dT,uT;const H2=class H2{constructor(e,t,s,i,r,{optionalContentConfig:o,markedContentStack:a=null},l,u){L(this,$o);this.ctx=e,this.current=new uO(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=i,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new gce(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=u,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:i=null}){const r=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=a,s){const l=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Dn(this.compositeCtx))}this.ctx.save(),Gv(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Dn(this.ctx)}executeOperatorList(e,t,s,i){const r=e.argsArray,o=e.fnArray;let a=t||0;const l=r.length;if(l===a)return a;const u=l-a>cO&&typeof s=="function",f=u?Date.now()+pce:0;let p=0;const g=this.commonObjs,b=this.objs;let w;for(;;){if(i!==void 0&&a===i.nextBreakPoint)return i.breakIt(a,s),a;if(w=o[a],w!==So.dependency)this[w].apply(this,r[a]);else for(const S of r[a]){const N=S.startsWith("g_")?g:b;if(!N.has(S))return N.get(S,s),a}if(a++,a===l)return a;if(u&&++p>cO){if(Date.now()>f)return s(),a;p=0}}}endDrawing(){O(this,$o,cT).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),O(this,$o,dT).call(this)}_scaleImage(e,t){const s=e.width??e.displayWidth,i=e.height??e.displayHeight;let r=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),a=s,l=i,u="prescale1",f,p;for(;r>2&&a>1||o>2&&l>1;){let g=a,b=l;r>2&&a>1&&(g=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),r/=a/g),o>2&&l>1&&(b=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,o/=l/b),f=this.cachedCanvases.getCanvas(u,g,b),p=f.context,p.clearRect(0,0,g,b),p.drawImage(e,0,0,a,l,0,0,g,b),e=f.canvas,a=g,l=b,u=u==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:s,height:i}=e,r=this.current.fillColor,o=this.current.patternFill,a=Dn(t);let l,u,f,p;if((e.bitmap||e.data)&&e.count>1){const U=e.bitmap||e.data.buffer;u=JSON.stringify(o?a:[a.slice(0,4),r]),l=this._cachedBitmapsMap.get(U),l||(l=new Map,this._cachedBitmapsMap.set(U,l));const V=l.get(u);if(V&&!o){const q=Math.round(Math.min(a[0],a[2])+a[4]),G=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:V,offsetX:q,offsetY:G}}f=V}f||(p=this.cachedCanvases.getCanvas("maskCanvas",s,i),fO(p.context,e));let g=rt.transform(a,[1/s,0,0,-1/i,0,0]);g=rt.transform(g,[1,0,0,1,0,-i]);const[b,w,S,N]=rt.getAxialAlignedBoundingBox([0,0,s,i],g),C=Math.round(S-b)||1,M=Math.round(N-w)||1,R=this.cachedCanvases.getCanvas("fillCanvas",C,M),_=R.context,j=b,P=w;_.translate(-j,-P),_.transform(...g),f||(f=this._scaleImage(p.canvas,na(_)),f=f.img,l&&o&&l.set(u,f)),_.imageSmoothingEnabled=pO(Dn(_),e.interpolate),$v(_,f,0,0,f.width,f.height,0,0,s,i),_.globalCompositeOperation="source-in";const D=rt.transform(na(_),[1,0,0,1,-j,-P]);return _.fillStyle=o?r.getPattern(t,this,D,gi.FILL):r,_.fillRect(0,0,s,i),l&&!o&&(this.cachedCanvases.delete("fillCanvas"),l.set(u,R.canvas)),{canvas:R.canvas,offsetX:Math.round(j),offsetY:Math.round(P)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=bce[e]}setLineJoin(e){this.ctx.lineJoin=yce[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(e),s.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,s]of e)switch(t){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(s,e,t);this.suspendedCtx=this.ctx,this.ctx=i.context;const r=this.ctx;r.setTransform(...Dn(this.suspendedCtx)),Yg(this.suspendedCtx,r),mce(r,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Yg(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,i){const r=i[0],o=i[1],a=i[2]-r,l=i[3]-o;a===0||l===0||(this.genericComposeSMask(t.context,s,a,l,t.subtype,t.backdrop,t.transferMap,r,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,i,r,o,a,l,u,f,p){let g=e.canvas,b=l-f,w=u-p;if(o){const N=rt.makeHexColor(...o);if(b<0||w<0||b+s>g.width||w+i>g.height){const C=this.cachedCanvases.getCanvas("maskExtension",s,i),M=C.context;M.drawImage(g,-b,-w),M.globalCompositeOperation="destination-atop",M.fillStyle=N,M.fillRect(0,0,s,i),M.globalCompositeOperation="source-over",g=C.canvas,b=w=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const C=new Path2D;C.rect(b,w,s,i),e.clip(C),e.globalCompositeOperation="destination-atop",e.fillStyle=N,e.fillRect(b,w,s,i),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));const S=new Path2D;S.rect(l,u,s,i),t.clip(S),t.globalCompositeOperation="destination-in",t.drawImage(g,b,w,s,i,l,u,s,i),t.restore()}save(){this.inSMaskMode?(Yg(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Yg(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,s,i,r,o){this.ctx.transform(e,t,s,i,r,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s){const i=this.ctx,r=this.current;let o=r.x,a=r.y,l,u;const f=Dn(i),p=f[0]===0&&f[3]===0||f[1]===0&&f[2]===0,g=p?s.slice(0):null;for(let b=0,w=0,S=e.length;b<S;b++)switch(e[b]|0){case So.rectangle:o=t[w++],a=t[w++];const N=t[w++],C=t[w++],M=o+N,R=a+C;i.moveTo(o,a),N===0||C===0?i.lineTo(M,R):(i.lineTo(M,a),i.lineTo(M,R),i.lineTo(o,R)),p||r.updateRectMinMax(f,[o,a,M,R]),i.closePath();break;case So.moveTo:o=t[w++],a=t[w++],i.moveTo(o,a),p||r.updatePathMinMax(f,o,a);break;case So.lineTo:o=t[w++],a=t[w++],i.lineTo(o,a),p||r.updatePathMinMax(f,o,a);break;case So.curveTo:l=o,u=a,o=t[w+4],a=t[w+5],i.bezierCurveTo(t[w],t[w+1],t[w+2],t[w+3],o,a),r.updateCurvePathMinMax(f,l,u,t[w],t[w+1],t[w+2],t[w+3],o,a,g),w+=6;break;case So.curveTo2:l=o,u=a,i.bezierCurveTo(o,a,t[w],t[w+1],t[w+2],t[w+3]),r.updateCurvePathMinMax(f,l,u,o,a,t[w],t[w+1],t[w+2],t[w+3],g),o=t[w+2],a=t[w+3],w+=4;break;case So.curveTo3:l=o,u=a,o=t[w+2],a=t[w+3],i.bezierCurveTo(t[w],t[w+1],o,a,o,a),r.updateCurvePathMinMax(f,l,u,t[w],t[w+1],o,a,o,a,g),w+=4;break;case So.closePath:i.closePath();break}p&&r.updateScalingPathMinMax(f,g),r.setCurrentPoint(o,a)}closePath(){this.ctx.closePath()}stroke(e=!0){const t=this.ctx,s=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&(s!=null&&s.getPattern)?(t.save(),t.strokeStyle=s.getPattern(t,this,na(t),gi.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const t=this.ctx,s=this.current.fillColor,i=this.current.patternFill;let r=!1;i&&(t.save(),t.fillStyle=s.getPattern(t,this,na(t),gi.FILL),r=!0);const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),r&&t.restore(),e&&this.consumePath(o)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=vce}eoClip(){this.pendingClip=mO}beginText(){this.current.textMatrix=EF,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}const s=new Path2D,i=t.getTransform().invertSelf();for(const{transform:r,x:o,y:a,fontSize:l,path:u}of e)s.addPath(u,new DOMMatrix(r).preMultiplySelf(i).translate(o,a).scale(l,-l));t.clip(s),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var f;const s=this.commonObjs.get(e),i=this.current;if(!s)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=s.fontMatrix||PE,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&At("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=s,this.current.fontSize=t,s.isType3Font)return;const r=s.loadedName||"sans-serif",o=((f=s.systemFontInfo)==null?void 0:f.css)||`"${r}", ${s.fallbackName}`;let a="normal";s.black?a="900":s.bold&&(a="bold");const l=s.italic?"italic":"normal";let u=t;t<aO?u=aO:t>lO&&(u=lO),this.current.fontSizeScale=t/u,this.ctx.font=`${l} ${a} ${u}px ${o}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,s,i,r,o){this.current.textMatrix=[e,t,s,i,r,o],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,s,i,r){const o=this.ctx,a=this.current,l=a.font,u=a.textRenderingMode,f=a.fontSize/a.fontSizeScale,p=u&li.FILL_STROKE_MASK,g=!!(u&li.ADD_TO_PATH_FLAG),b=a.patternFill&&!l.missingFile,w=a.patternStroke&&!l.missingFile;let S;if((l.disableFontFace||g||b||w)&&(S=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||b||w){if(o.save(),o.translate(t,s),o.scale(f,-f),p===li.FILL||p===li.FILL_STROKE)if(i){const N=o.getTransform();o.setTransform(...i),o.fill(O(this,$o,uT).call(this,S,N,i))}else o.fill(S);if(p===li.STROKE||p===li.FILL_STROKE)if(r){const N=o.getTransform();o.setTransform(...r),o.stroke(O(this,$o,uT).call(this,S,N,r))}else o.lineWidth/=f,o.stroke(S);o.restore()}else(p===li.FILL||p===li.FILL_STROKE)&&o.fillText(e,t,s),(p===li.STROKE||p===li.FILL_STROKE)&&o.strokeText(e,t,s);g&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Dn(o),x:t,y:s,fontSize:f,path:S})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){s=!0;break}return It(this,"isFontSubpixelAAEnabled",s)}showText(e){const t=this.current,s=t.font;if(s.isType3Font)return this.showType3Text(e);const i=t.fontSize;if(i===0)return;const r=this.ctx,o=t.fontSizeScale,a=t.charSpacing,l=t.wordSpacing,u=t.fontDirection,f=t.textHScale*u,p=e.length,g=s.vertical,b=g?1:-1,w=s.defaultVMetrics,S=i*t.fontMatrix[0],N=t.textRenderingMode===li.FILL&&!s.disableFontFace&&!t.patternFill;r.save(),r.transform(...t.textMatrix),r.translate(t.x,t.y+t.textRise),u>0?r.scale(f,-1):r.scale(f,1);let C,M;if(t.patternFill){r.save();const D=t.fillColor.getPattern(r,this,na(r),gi.FILL);C=Dn(r),r.restore(),r.fillStyle=D}if(t.patternStroke){r.save();const D=t.strokeColor.getPattern(r,this,na(r),gi.STROKE);M=Dn(r),r.restore(),r.strokeStyle=D}let R=t.lineWidth;const _=t.textMatrixScale;if(_===0||R===0){const D=t.textRenderingMode&li.FILL_STROKE_MASK;(D===li.STROKE||D===li.FILL_STROKE)&&(R=this.getSinglePixelWidth())}else R/=_;if(o!==1&&(r.scale(o,o),R/=o),r.lineWidth=R,s.isInvalidPDFjsFont){const D=[];let U=0;for(const V of e)D.push(V.unicode),U+=V.width;r.fillText(D.join(""),0,0),t.x+=U*S*f,r.restore(),this.compose();return}let j=0,P;for(P=0;P<p;++P){const D=e[P];if(typeof D=="number"){j+=b*D*i/1e3;continue}let U=!1;const V=(D.isSpace?l:0)+a,q=D.fontChar,G=D.accent;let ee,W,Q=D.width;if(g){const $=D.vmetric||w,Y=-(D.vmetric?$[1]:Q*.5)*S,he=$[2]*S;Q=$?-$[0]:Q,ee=Y/o,W=(j+he)/o}else ee=j/o,W=0;if(s.remeasure&&Q>0){const $=r.measureText(q).width*1e3/i*o;if(Q<$&&this.isFontSubpixelAAEnabled){const Y=Q/$;U=!0,r.save(),r.scale(Y,1),ee/=Y}else Q!==$&&(ee+=(Q-$)/2e3*i/o)}if(this.contentVisible&&(D.isInFont||s.missingFile)){if(N&&!G)r.fillText(q,ee,W);else if(this.paintChar(q,ee,W,C,M),G){const $=ee+i*G.offset.x/o,Y=W-i*G.offset.y/o;this.paintChar(G.fontChar,$,Y,C,M)}}const Z=g?Q*S-V*u:Q*S+V*u;j+=Z,U&&r.restore()}g?t.y-=j:t.x+=j*f,r.restore(),this.compose()}showType3Text(e){const t=this.ctx,s=this.current,i=s.font,r=s.fontSize,o=s.fontDirection,a=i.vertical?1:-1,l=s.charSpacing,u=s.wordSpacing,f=s.textHScale*o,p=s.fontMatrix||PE,g=e.length,b=s.textRenderingMode===li.INVISIBLE;let w,S,N,C;if(!(b||r===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...s.textMatrix),t.translate(s.x,s.y),t.scale(f,o),w=0;w<g;++w){if(S=e[w],typeof S=="number"){C=a*S*r/1e3,this.ctx.translate(C,0),s.x+=C*f;continue}const M=(S.isSpace?u:0)+l,R=i.charProcOperatorList[S.operatorListId];if(!R){At(`Type3 character "${S.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=S,this.save(),t.scale(r,r),t.transform(...p),this.executeOperatorList(R),this.restore()),N=rt.applyTransform([S.width,0],p)[0]*r+M,t.translate(N,0),s.x+=N*f}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,s,i,r,o){this.ctx.rect(s,i,r-s,o-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const s=e[1],i=this.baseTransform||Dn(this.ctx),r={createCanvasGraphics:o=>new H2(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new lT(e,s,this.ctx,r,i)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,s){this.ctx.strokeStyle=this.current.strokeColor=rt.makeHexColor(e,t,s),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,s){this.ctx.fillStyle=this.current.fillColor=rt.makeHexColor(e,t,s),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let s;return this.cachedPatterns.has(e)?s=this.cachedPatterns.get(e):(s=hce(this.getObject(e)),this.cachedPatterns.set(e,s)),t&&(s.matrix=t),s}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const s=this._getPattern(e);t.fillStyle=s.getPattern(t,this,na(t),gi.SHADING);const i=na(t);if(i){const{width:r,height:o}=t.canvas,[a,l,u,f]=rt.getAxialAlignedBoundingBox([0,0,r,o],i);this.ctx.fillRect(a,l,u-a,f-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){xn("Should not call beginInlineImage")}beginImageData(){xn("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=Dn(this.ctx),t)){const s=t[2]-t[0],i=t[3]-t[1];this.ctx.rect(t[0],t[1],s,i),this.current.updateRectMinMax(Dn(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||JS("TODO: Support non-isolated groups."),e.knockout&&At("Knockout groups not supported.");const s=Dn(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=rt.getAxialAlignedBoundingBox(e.bbox,Dn(t));const r=[0,0,t.canvas.width,t.canvas.height];i=rt.intersect(i,r)||[0,0,0,0];const o=Math.floor(i[0]),a=Math.floor(i[1]),l=Math.max(Math.ceil(i[2])-o,1),u=Math.max(Math.ceil(i[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,u]);let f="groupAt"+this.groupLevel;e.smask&&(f+="_smask_"+this.smaskCounter++%2);const p=this.cachedCanvases.getCanvas(f,l,u),g=p.context;g.translate(-o,-a),g.transform(...s),e.smask?this.smaskStack.push({canvas:p.canvas,context:g,offsetX:o,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(o,a),t.save()),Yg(t,g),this.ctx=g,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const i=Dn(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);const r=rt.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],i);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(e,t,s,i,r){if(O(this,$o,cT).call(this),Gv(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const o=t[2]-t[0],a=t[3]-t[1];if(r&&this.annotationCanvasMap){s=s.slice(),s[4]-=t[0],s[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=o,t[3]=a;const[l,u]=rt.singularValueDecompose2dScale(Dn(this.ctx)),{viewportScale:f}=this,p=Math.ceil(o*this.outputScaleX*f),g=Math.ceil(a*this.outputScaleY*f);this.annotationCanvas=this.canvasFactory.create(p,g);const{canvas:b,context:w}=this.annotationCanvas;this.annotationCanvasMap.set(e,b),this.annotationCanvas.savedCtx=this.ctx,this.ctx=w,this.ctx.save(),this.ctx.setTransform(l,0,0,-u,0,a*u),Gv(this.ctx)}else Gv(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],o,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new uO(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),O(this,$o,dT).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const s=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=xce(e)),i.compiled)){i.compiled(s);return}const r=this._createMaskCanvas(e),o=r.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(o,r.offsetX,r.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s=0,i=0,r,o){if(!this.contentVisible)return;e=this.getObject(e.data,e);const a=this.ctx;a.save();const l=Dn(a);a.transform(t,s,i,r,0,0);const u=this._createMaskCanvas(e);a.setTransform(1,0,0,1,u.offsetX-l[4],u.offsetY-l[5]);for(let f=0,p=o.length;f<p;f+=2){const g=rt.transform(l,[t,s,i,r,o[f],o[f+1]]),[b,w]=rt.applyTransform([0,0],g);a.drawImage(u.canvas,b,w)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,s=this.current.fillColor,i=this.current.patternFill;for(const r of e){const{data:o,width:a,height:l,transform:u}=r,f=this.cachedCanvases.getCanvas("maskCanvas",a,l),p=f.context;p.save();const g=this.getObject(o,r);fO(p,g),p.globalCompositeOperation="source-in",p.fillStyle=i?s.getPattern(p,this,na(t),gi.FILL):s,p.fillRect(0,0,a,l),p.restore(),t.save(),t.transform(...u),t.scale(1,-1),$v(t,f.canvas,0,0,a,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){At("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,s,i){if(!this.contentVisible)return;const r=this.getObject(e);if(!r){At("Dependent image isn't ready yet");return}const o=r.width,a=r.height,l=[];for(let u=0,f=i.length;u<f;u+=2)l.push({transform:[t,0,0,s,i[u],i[u+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(r,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:i}=e,r=this.cachedCanvases.getCanvas("inlineImage",s,i),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",r.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,s=e.height,i=this.ctx;if(this.save(),!xi){const{filter:a}=i;a!=="none"&&a!==""&&(i.filter="none")}i.scale(1/t,-1/s);let r;if(e.bitmap)r=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)r=e;else{const l=this.cachedCanvases.getCanvas("inlineImage",t,s).context;hO(l,e),r=this.applyTransferMapsToCanvas(l)}const o=this._scaleImage(r,na(i));i.imageSmoothingEnabled=pO(Dn(i),e.interpolate),$v(i,o.img,0,0,o.paintWidth,o.paintHeight,0,-s,t,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const s=this.ctx;let i;if(e.bitmap)i=e.bitmap;else{const r=e.width,o=e.height,l=this.cachedCanvases.getCanvas("inlineImage",r,o).context;hO(l,e),i=this.applyTransferMapsToCanvas(l)}for(const r of t)s.save(),s.transform(...r.transform),s.scale(1,-1),$v(s,i,r.x,r.y,r.w,r.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const s=this.ctx;this.pendingClip&&(t||(this.pendingClip===mO?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Dn(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:i,d:r}=this.ctx.getTransform();let o,a;if(s===0&&i===0){const l=Math.abs(t),u=Math.abs(r);if(l===u)if(e===0)o=a=1/l;else{const f=l*e;o=a=f<1?1/f:1}else if(e===0)o=1/l,a=1/u;else{const f=l*e,p=u*e;o=f<1?1/f:1,a=p<1?1/p:1}}else{const l=Math.abs(t*r-s*i),u=Math.hypot(t,s),f=Math.hypot(i,r);if(e===0)o=f/l,a=u/l;else{const p=e*l;o=f>p?f/p:1,a=u>p?u/p:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:s}=this.current,[i,r]=this.getScaleForStroking();if(t.lineWidth=s||1,i===1&&r===1){t.stroke();return}const o=t.getLineDash();if(e&&t.save(),t.scale(i,r),o.length>0){const a=Math.max(i,r);t.setLineDash(o.map(l=>l/a)),t.lineDashOffset/=a}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};$o=new WeakSet,cT=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},dT=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},uT=function(e,t,s){const i=new Path2D;return i.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),i};let yp=H2;for(const n in So)yp.prototype[n]!==void 0&&(yp.prototype[So[n]]=yp.prototype[n]);var Fx,Hx;class Hl{static get workerPort(){return y(this,Fx)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");z(this,Fx,e)}static get workerSrc(){return y(this,Hx)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");z(this,Hx,e)}}Fx=new WeakMap,Hx=new WeakMap,L(Hl,Fx,null),L(Hl,Hx,"");var Zu,Ux;class wce{constructor({parsedData:e,rawData:t}){L(this,Zu);L(this,Ux);z(this,Zu,e),z(this,Ux,t)}getRaw(){return y(this,Ux)}get(e){return y(this,Zu).get(e)??null}getAll(){return _2(y(this,Zu))}has(e){return y(this,Zu).has(e)}}Zu=new WeakMap,Ux=new WeakMap;const ip=Symbol("INTERNAL");var $x,Gx,Vx,Op;class kce{constructor(e,{name:t,intent:s,usage:i,rbGroups:r}){L(this,$x,!1);L(this,Gx,!1);L(this,Vx,!1);L(this,Op,!0);z(this,$x,!!(e&Nr.DISPLAY)),z(this,Gx,!!(e&Nr.PRINT)),this.name=t,this.intent=s,this.usage=i,this.rbGroups=r}get visible(){if(y(this,Vx))return y(this,Op);if(!y(this,Op))return!1;const{print:e,view:t}=this.usage;return y(this,$x)?(t==null?void 0:t.viewState)!=="OFF":y(this,Gx)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,s=!1){e!==ip&&xn("Internal method `_setVisible` called."),z(this,Vx,s),z(this,Op,t)}}$x=new WeakMap,Gx=new WeakMap,Vx=new WeakMap,Op=new WeakMap;var ld,on,Bp,Fp,qx,hT;class Sce{constructor(e,t=Nr.DISPLAY){L(this,qx);L(this,ld,null);L(this,on,new Map);L(this,Bp,null);L(this,Fp,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,z(this,Fp,e.order);for(const s of e.groups)y(this,on).set(s.id,new kce(t,s));if(e.baseState==="OFF")for(const s of y(this,on).values())s._setVisible(ip,!1);for(const s of e.on)y(this,on).get(s)._setVisible(ip,!0);for(const s of e.off)y(this,on).get(s)._setVisible(ip,!1);z(this,Bp,this.getHash())}}isVisible(e){if(y(this,on).size===0)return!0;if(!e)return JS("Optional content group not defined."),!0;if(e.type==="OCG")return y(this,on).has(e.id)?y(this,on).get(e.id).visible:(At(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return O(this,qx,hT).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!y(this,on).has(t))return At(`Optional content group not found: ${t}`),!0;if(y(this,on).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!y(this,on).has(t))return At(`Optional content group not found: ${t}`),!0;if(!y(this,on).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!y(this,on).has(t))return At(`Optional content group not found: ${t}`),!0;if(!y(this,on).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!y(this,on).has(t))return At(`Optional content group not found: ${t}`),!0;if(y(this,on).get(t).visible)return!1}return!0}return At(`Unknown optional content policy ${e.policy}.`),!0}return At(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){var r;const i=y(this,on).get(e);if(!i){At(`Optional content group not found: ${e}`);return}if(s&&t&&i.rbGroups.length)for(const o of i.rbGroups)for(const a of o)a!==e&&((r=y(this,on).get(a))==null||r._setVisible(ip,!1,!0));i._setVisible(ip,!!t,!0),z(this,ld,null)}setOCGState({state:e,preserveRB:t}){let s;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const r=y(this,on).get(i);if(r)switch(s){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!r.visible,t);break}}z(this,ld,null)}get hasInitialVisibility(){return y(this,Bp)===null||this.getHash()===y(this,Bp)}getOrder(){return y(this,on).size?y(this,Fp)?y(this,Fp).slice():[...y(this,on).keys()]:null}getGroups(){return y(this,on).size>0?_2(y(this,on)):null}getGroup(e){return y(this,on).get(e)||null}getHash(){if(y(this,ld)!==null)return y(this,ld);const e=new i6;for(const[t,s]of y(this,on))e.update(`${t}:${s.visible}`);return z(this,ld,e.hexdigest())}}ld=new WeakMap,on=new WeakMap,Bp=new WeakMap,Fp=new WeakMap,qx=new WeakSet,hT=function(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let i=1;i<t;i++){const r=e[i];let o;if(Array.isArray(r))o=O(this,qx,hT).call(this,r);else if(y(this,on).has(r))o=y(this,on).get(r).visible;else return At(`Optional content group not found: ${r}`),!0;switch(s){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return s==="And"};class Cce{constructor(e,{disableRange:t=!1,disableStream:s=!1}){ms(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:r,progressiveDone:o,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,(r==null?void 0:r.length)>0){const l=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,u)=>{this._onReceiveData({begin:l,chunk:u})}),e.addProgressListener((l,u)=>{this._onProgress({loaded:l,total:u})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(s),!0)});ms(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,s,i,r;e.total===void 0?(s=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||s.call(t,{loaded:e.loaded}):(r=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||r.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){ms(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new Ace(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Nce(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeReaders.slice(0))s.cancel(e);this._pdfDataRangeTransport.abort()}}class Ace{constructor(e,t,s=!1,i=null){this._stream=e,this._done=s||!1,this._filename=I2(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Nce{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Ece(n){let e=!0,t=s("filename\\*","i").exec(n);if(t){t=t[1];let f=a(t);return f=unescape(f),f=l(f),f=u(f),r(f)}if(t=o(n),t){const f=u(t);return r(f)}if(t=s("filename","i").exec(n),t){t=t[1];let f=a(t);return f=u(f),r(f)}function s(f,p){return new RegExp("(?:^|;)\\s*"+f+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',p)}function i(f,p){if(f){if(!/^[\x00-\xFF]+$/.test(p))return p;try{const g=new TextDecoder(f,{fatal:!0}),b=XS(p);p=g.decode(b),e=!1}catch{}}return p}function r(f){return e&&/[\x80-\xff]/.test(f)&&(f=i("utf-8",f),e&&(f=i("iso-8859-1",f))),f}function o(f){const p=[];let g;const b=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(g=b.exec(f))!==null;){let[,S,N,C]=g;if(S=parseInt(S,10),S in p){if(S===0)break;continue}p[S]=[N,C]}const w=[];for(let S=0;S<p.length&&S in p;++S){let[N,C]=p[S];C=a(C),N&&(C=unescape(C),S===0&&(C=l(C))),w.push(C)}return w.join("")}function a(f){if(f.startsWith('"')){const p=f.slice(1).split('\\"');for(let g=0;g<p.length;++g){const b=p[g].indexOf('"');b!==-1&&(p[g]=p[g].slice(0,b),p.length=g+1),p[g]=p[g].replaceAll(/\\(.)/g,"$1")}f=p.join('"')}return f}function l(f){const p=f.indexOf("'");if(p===-1)return f;const g=f.slice(0,p),w=f.slice(p+1).replace(/^[^']*'/,"");return i(g,w)}function u(f){return!f.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(f)?f:f.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(p,g,b,w){if(b==="q"||b==="Q")return w=w.replaceAll("_"," "),w=w.replaceAll(/=([0-9a-fA-F]{2})/g,function(S,N){return String.fromCharCode(parseInt(N,16))}),i(g,w);try{w=atob(w)}catch{}return i(g,w)})}return""}function b6(n,e){const t=new Headers;if(!n||!e||typeof e!="object")return t;for(const s in e){const i=e[s];i!==void 0&&t.append(s,i)}return t}function eC(n){try{return new URL(n).origin}catch{}return null}function y6({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(n.get("Content-Length"),10);return!Number.isInteger(r)||(i.suggestedLength=r,r<=2*t)||s||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function v6(n){const e=n.get("Content-Disposition");if(e){let t=Ece(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(I2(t))return t}return null}function tC(n,e){return n===404||n===0&&e.startsWith("file:")?new cx('Missing PDF "'+e+'".'):new Gk(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n)}function w6(n){return n===200||n===206}function k6(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function S6(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(At(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class gO{constructor(e){We(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=b6(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return ms(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Tce(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new _ce(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class Tce{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const s=new Headers(e.headers),i=t.url;fetch(i,k6(s,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=eC(r.url),!w6(r.status))throw tC(r.status,i);this._reader=r.body.getReader(),this._headersCapability.resolve();const o=r.headers,{allowRangeRequests:a,suggestedLength:l}=y6({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=v6(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Od("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:S6(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class _ce{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const r=new Headers(e.headers);r.append("Range",`bytes=${t}-${s-1}`);const o=i.url;fetch(o,k6(r,this._withCredentials,this._abortController)).then(a=>{const l=eC(a.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!w6(a.status))throw tC(a.status,o);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:S6(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const mN=200,gN=206;function Mce(n){const e=n.response;return typeof e!="string"?e:XS(e).buffer}class Rce{constructor({url:e,httpHeaders:t,withCredentials:s}){We(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=b6(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[r,o]of this.headers)t.setRequestHeader(r,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=gN):i.expectedStatus=mN,t.responseType="arraybuffer",ms(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){var i;const s=this.pendingRequests[e];s&&((i=s.onProgress)==null||i.call(s,t))}onStateChange(e,t){const s=this.pendingRequests[e];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){s.onError(i.status);return}const r=i.status||mN;if(!(r===mN&&s.expectedStatus===gN)&&r!==s.expectedStatus){s.onError(i.status);return}const a=Mce(i);if(r===gN){const l=i.getResponseHeader("Content-Range"),u=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);u?s.onDone({begin:parseInt(u[1],10),chunk:a}):(At('Missing or invalid "Content-Range" header.'),s.onError(0))}else a?s.onDone({begin:0,chunk:a}):s.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class Ice{constructor(e){this._source=e,this._manager=new Rce(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return ms(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new zce(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const s=new Dce(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class zce{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=eC(t.responseURL);const s=t.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[l,...u]=a.split(": ");return[l,u.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=y6({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=v6(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=tC(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Dce{constructor(e,t,s){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=eC((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=tC(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const jce=/^[a-z][a-z0-9\-+.]+:/i;function Pce(n){if(jce.test(n))return new URL(n);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(n))}class Lce{constructor(e){this.source=e,this.url=Pce(e.url),ms(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return ms(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Oce(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Bce(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class Oce{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=new cx(`Missing PDF "${this._url}".`)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Od("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Bce{constructor(e,t,s){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=e.source;this._isStreamingSupported=!i.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Fce=1e5,Vi=30,Hce=.8;var kO,cd,Ji,Wx,Kx,eh,Al,Yx,Jx,th,Hp,Up,dd,$p,Xx,Gp,nh,Qx,Zx,sh,ih,eb,ud,Vp,ec,C6,A6,fT,zr,mw,pT,N6,E6;const Ss=class Ss{constructor({textContentSource:e,container:t,viewport:s}){L(this,ec);L(this,cd,Promise.withResolvers());L(this,Ji,null);L(this,Wx,!1);L(this,Kx,!!((kO=globalThis.FontInspector)!=null&&kO.enabled));L(this,eh,null);L(this,Al,null);L(this,Yx,0);L(this,Jx,0);L(this,th,null);L(this,Hp,null);L(this,Up,0);L(this,dd,0);L(this,$p,Object.create(null));L(this,Xx,[]);L(this,Gp,null);L(this,nh,[]);L(this,Qx,new WeakMap);L(this,Zx,null);var l;if(e instanceof ReadableStream)z(this,Gp,e);else if(typeof e=="object")z(this,Gp,new ReadableStream({start(u){u.enqueue(e),u.close()}}));else throw new Error('No "textContentSource" parameter specified.');z(this,Ji,z(this,Hp,t)),z(this,dd,s.scale*(globalThis.devicePixelRatio||1)),z(this,Up,s.rotation),z(this,Al,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:r,pageX:o,pageY:a}=s.rawDims;z(this,Zx,[1,0,0,-1,-o,a+r]),z(this,Jx,i),z(this,Yx,r),O(l=Ss,zr,N6).call(l),Jh(t,s),y(this,cd).promise.finally(()=>{y(Ss,Vp).delete(this),z(this,Al,null),z(this,$p,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=zi.platform;return It(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{y(this,th).read().then(({value:t,done:s})=>{if(s){y(this,cd).resolve();return}y(this,eh)??z(this,eh,t.lang),Object.assign(y(this,$p),t.styles),O(this,ec,C6).call(this,t.items),e()},y(this,cd).reject)};return z(this,th,y(this,Gp).getReader()),y(Ss,Vp).add(this),e(),y(this,cd).promise}update({viewport:e,onBefore:t=null}){var r;const s=e.scale*(globalThis.devicePixelRatio||1),i=e.rotation;if(i!==y(this,Up)&&(t==null||t(),z(this,Up,i),Jh(y(this,Hp),{rotation:i})),s!==y(this,dd)){t==null||t(),z(this,dd,s);const o={div:null,properties:null,ctx:O(r=Ss,zr,mw).call(r,y(this,eh))};for(const a of y(this,nh))o.properties=y(this,Qx).get(a),o.div=a,O(this,ec,fT).call(this,o)}}cancel(){var t;const e=new Od("TextLayer task cancelled.");(t=y(this,th))==null||t.cancel(e).catch(()=>{}),z(this,th,null),y(this,cd).reject(e)}get textDivs(){return y(this,nh)}get textContentItemsStr(){return y(this,Xx)}static cleanup(){if(!(y(this,Vp).size>0)){y(this,sh).clear();for(const{canvas:e}of y(this,ih).values())e.remove();y(this,ih).clear()}}};cd=new WeakMap,Ji=new WeakMap,Wx=new WeakMap,Kx=new WeakMap,eh=new WeakMap,Al=new WeakMap,Yx=new WeakMap,Jx=new WeakMap,th=new WeakMap,Hp=new WeakMap,Up=new WeakMap,dd=new WeakMap,$p=new WeakMap,Xx=new WeakMap,Gp=new WeakMap,nh=new WeakMap,Qx=new WeakMap,Zx=new WeakMap,sh=new WeakMap,ih=new WeakMap,eb=new WeakMap,ud=new WeakMap,Vp=new WeakMap,ec=new WeakSet,C6=function(e){var i,r;if(y(this,Wx))return;(r=y(this,Al)).ctx??(r.ctx=O(i=Ss,zr,mw).call(i,y(this,eh)));const t=y(this,nh),s=y(this,Xx);for(const o of e){if(t.length>Fce){At("Ignoring additional textDivs for performance reasons."),z(this,Wx,!0);return}if(o.str===void 0){if(o.type==="beginMarkedContentProps"||o.type==="beginMarkedContent"){const a=y(this,Ji);z(this,Ji,document.createElement("span")),y(this,Ji).classList.add("markedContent"),o.id!==null&&y(this,Ji).setAttribute("id",`${o.id}`),a.append(y(this,Ji))}else o.type==="endMarkedContent"&&z(this,Ji,y(this,Ji).parentNode);continue}s.push(o.str),O(this,ec,A6).call(this,o)}},A6=function(e){var S;const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};y(this,nh).push(t);const i=rt.transform(y(this,Zx),e.transform);let r=Math.atan2(i[1],i[0]);const o=y(this,$p)[e.fontName];o.vertical&&(r+=Math.PI/2);let a=y(this,Kx)&&o.fontSubstitution||o.fontFamily;a=Ss.fontFamilyMap.get(a)||a;const l=Math.hypot(i[2],i[3]),u=l*O(S=Ss,zr,E6).call(S,a,y(this,eh));let f,p;r===0?(f=i[4],p=i[5]-u):(f=i[4]+u*Math.sin(r),p=i[5]-u*Math.cos(r));const g="calc(var(--scale-factor)*",b=t.style;y(this,Ji)===y(this,Hp)?(b.left=`${(100*f/y(this,Jx)).toFixed(2)}%`,b.top=`${(100*p/y(this,Yx)).toFixed(2)}%`):(b.left=`${g}${f.toFixed(2)}px)`,b.top=`${g}${p.toFixed(2)}px)`),b.fontSize=`${g}${(y(Ss,ud)*l).toFixed(2)}px)`,b.fontFamily=a,s.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,y(this,Kx)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),r!==0&&(s.angle=r*(180/Math.PI));let w=!1;if(e.str.length>1)w=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const N=Math.abs(e.transform[0]),C=Math.abs(e.transform[3]);N!==C&&Math.max(N,C)/Math.min(N,C)>1.5&&(w=!0)}if(w&&(s.canvasWidth=o.vertical?e.height:e.width),y(this,Qx).set(t,s),y(this,Al).div=t,y(this,Al).properties=s,O(this,ec,fT).call(this,y(this,Al)),s.hasText&&y(this,Ji).append(t),s.hasEOL){const N=document.createElement("br");N.setAttribute("role","presentation"),y(this,Ji).append(N)}},fT=function(e){var a;const{div:t,properties:s,ctx:i}=e,{style:r}=t;let o="";if(y(Ss,ud)>1&&(o=`scale(${1/y(Ss,ud)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:l}=r,{canvasWidth:u,fontSize:f}=s;O(a=Ss,zr,pT).call(a,i,f*y(this,dd),l);const{width:p}=i.measureText(t.textContent);p>0&&(o=`scaleX(${u*y(this,dd)/p}) ${o}`)}s.angle!==0&&(o=`rotate(${s.angle}deg) ${o}`),o.length>0&&(r.transform=o)},zr=new WeakSet,mw=function(e=null){let t=y(this,ih).get(e||(e=""));if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),y(this,ih).set(e,t),y(this,eb).set(t,{size:0,family:""})}return t},pT=function(e,t,s){const i=y(this,eb).get(e);t===i.size&&s===i.family||(e.font=`${t}px ${s}`,i.size=t,i.family=s)},N6=function(){if(y(this,ud)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),z(this,ud,e.getBoundingClientRect().height),e.remove()},E6=function(e,t){const s=y(this,sh).get(e);if(s)return s;const i=O(this,zr,mw).call(this,t);i.canvas.width=i.canvas.height=Vi,O(this,zr,pT).call(this,i,Vi,e);const r=i.measureText("");let o=r.fontBoundingBoxAscent,a=Math.abs(r.fontBoundingBoxDescent);if(o){const f=o/(o+a);return y(this,sh).set(e,f),i.canvas.width=i.canvas.height=0,f}i.strokeStyle="red",i.clearRect(0,0,Vi,Vi),i.strokeText("g",0,0);let l=i.getImageData(0,0,Vi,Vi).data;a=0;for(let f=l.length-1-3;f>=0;f-=4)if(l[f]>0){a=Math.ceil(f/4/Vi);break}i.clearRect(0,0,Vi,Vi),i.strokeText("A",0,Vi),l=i.getImageData(0,0,Vi,Vi).data,o=0;for(let f=0,p=l.length;f<p;f+=4)if(l[f]>0){o=Vi-Math.floor(f/4/Vi);break}i.canvas.width=i.canvas.height=0;const u=o?o/(o+a):Hce;return y(this,sh).set(e,u),u},L(Ss,zr),L(Ss,sh,new Map),L(Ss,ih,new Map),L(Ss,eb,new WeakMap),L(Ss,ud,null),L(Ss,Vp,new Set);let dx=Ss;class ux{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function i(r){var l;if(!r)return;let o=null;const a=r.name;if(a==="#text")o=r.value;else if(ux.shouldBuildText(a))(l=r==null?void 0:r.attributes)!=null&&l.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&t.push({str:o}),!!r.children)for(const u of r.children)i(u)}return i(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const Uce=65536,$ce=100,Gce=5e3,Vce=xi?rce:nce,qce=xi?oce:h6,Wce=xi?ice:sce,Kce=xi?ace:g6;function Yce(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const e=new mT,{docId:t}=e,s=n.url?Jce(n.url):null,i=n.data?Xce(n.data):null,r=n.httpHeaders||null,o=n.withCredentials===!0,a=n.password??null,l=n.range instanceof T6?n.range:null,u=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:Uce;let f=n.worker instanceof vp?n.worker:null;const p=n.verbosity,g=typeof n.docBaseUrl=="string"&&!ZS(n.docBaseUrl)?n.docBaseUrl:null,b=typeof n.cMapUrl=="string"?n.cMapUrl:null,w=n.cMapPacked!==!1,S=n.CMapReaderFactory||qce,N=typeof n.standardFontDataUrl=="string"?n.standardFontDataUrl:null,C=n.StandardFontDataFactory||Kce,M=n.stopAtErrors!==!0,R=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,_=n.isEvalSupported!==!1,j=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!xi,P=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!xi&&(zi.platform.isFirefox||!globalThis.chrome),D=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,U=typeof n.disableFontFace=="boolean"?n.disableFontFace:xi,V=n.fontExtraProperties===!0,q=n.enableXfa===!0,G=n.ownerDocument||globalThis.document,ee=n.disableRange===!0,W=n.disableStream===!0,Q=n.disableAutoFetch===!0,Z=n.pdfBug===!0,$=n.CanvasFactory||Vce,Y=n.FilterFactory||Wce,he=n.enableHWA===!0,Re=l?l.length:n.length??NaN,ze=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!xi&&!U,F=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:S===h6&&C===g6&&b&&N&&i0(b,document.baseURI)&&i0(N,document.baseURI),J=null;Dle(p);const ie={canvasFactory:new $({ownerDocument:G,enableHWA:he}),filterFactory:new Y({docId:t,ownerDocument:G}),cMapReaderFactory:F?null:new S({baseUrl:b,isCompressed:w}),standardFontDataFactory:F?null:new C({baseUrl:N})};if(!f){const ke={verbosity:p,port:Hl.workerPort};f=ke.port?vp.fromPort(ke):new vp(ke),e._worker=f}const pe={docId:t,apiVersion:"4.10.38",data:i,password:a,disableAutoFetch:Q,rangeChunkSize:u,length:Re,docBaseUrl:g,enableXfa:q,evaluatorOptions:{maxImageSize:R,disableFontFace:U,ignoreErrors:M,isEvalSupported:_,isOffscreenCanvasSupported:j,isImageDecoderSupported:P,canvasMaxAreaInBytes:D,fontExtraProperties:V,useSystemFonts:ze,cMapUrl:F?b:null,standardFontDataUrl:F?N:null}},ue={disableFontFace:U,fontExtraProperties:V,ownerDocument:G,pdfBug:Z,styleElement:J,loadingParams:{disableAutoFetch:Q,enableXfa:q}};return f.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(f.destroyed)throw new Error("Worker was destroyed");const ke=f.messageHandler.sendWithPromise("GetDocRequest",pe,i?[i.buffer]:null);let re;if(l)re=new Cce(l,{disableRange:ee,disableStream:W});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");let Ge;if(xi)if(i0(s)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");Ge=gO}else Ge=Lce;else Ge=i0(s)?gO:Ice;re=new Ge({url:s,length:Re,httpHeaders:r,withCredentials:o,rangeChunkSize:u,disableRange:ee,disableStream:W})}return ke.then(Ge=>{if(e.destroyed)throw new Error("Loading aborted");if(f.destroyed)throw new Error("Worker was destroyed");const Je=new l0(t,Ge,f.port),Qe=new tde(Je,e,re,ue,ie);e._transport=Qe,Je.send("Ready",null)})}).catch(e._capability.reject),e}function Jce(n){if(n instanceof URL)return n.href;try{return new URL(n,window.location).href}catch{if(xi&&typeof n=="string")return n}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Xce(n){if(xi&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return XS(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n==null?void 0:n.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function xO(n){return typeof n=="object"&&Number.isInteger(n==null?void 0:n.num)&&n.num>=0&&Number.isInteger(n==null?void 0:n.gen)&&n.gen>=0}var oS;const aS=class aS{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${Ni(aS,oS)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,s,i;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(r){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,r}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}};oS=new WeakMap,L(aS,oS,0);let mT=aS;class T6{constructor(e,t,s=!1,i=null){this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const s of this._rangeListeners)s(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const s of this._progressListeners)s(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){xn("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class Qce{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return It(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var hd,Nl,io,rp,gw;class Zce{constructor(e,t,s,i=!1){L(this,io);L(this,hd,null);L(this,Nl,!1);this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=i?new sO:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new _6,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:r=!1}={}){return new qb({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return It(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:s="display",annotationMode:i=Yc.ENABLE,transform:r=null,background:o=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:u=null,printAnnotationStorage:f=null,isEditing:p=!1}){var _,j;(_=this._stats)==null||_.time("Overall");const g=this._transport.getRenderingIntent(s,i,f,p),{renderingIntent:b,cacheKey:w}=g;z(this,Nl,!1),O(this,io,gw).call(this),a||(a=this._transport.getOptionalContentConfig(b));let S=this._intentStates.get(w);S||(S=Object.create(null),this._intentStates.set(w,S)),S.streamReaderCancelTimeout&&(clearTimeout(S.streamReaderCancelTimeout),S.streamReaderCancelTimeout=null);const N=!!(b&Nr.PRINT);S.displayReadyCapability||(S.displayReadyCapability=Promise.withResolvers(),S.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(j=this._stats)==null||j.time("Page Request"),this._pumpOperatorList(g));const C=P=>{var D;S.renderTasks.delete(M),(this._maybeCleanupAfterRender||N)&&z(this,Nl,!0),O(this,io,rp).call(this,!N),P?(M.capability.reject(P),this._abortOperatorList({intentState:S,reason:P instanceof Error?P:new Error(P)})):M.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(D=globalThis.Stats)!=null&&D.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},M=new xT({callback:C,params:{canvasContext:e,viewport:t,transform:r,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:S.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!N,pdfBug:this._pdfBug,pageColors:u});(S.renderTasks||(S.renderTasks=new Set)).add(M);const R=M.task;return Promise.all([S.displayReadyCapability.promise,a]).then(([P,D])=>{var U;if(this.destroyed){C();return}if((U=this._stats)==null||U.time("Rendering"),!(D.renderingIntent&b))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");M.initializeGraphics({transparency:P,optionalContentConfig:D}),M.operatorListChanged()}).catch(C),R}getOperatorList({intent:e="display",annotationMode:t=Yc.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var u;function r(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}const o=this._transport.getRenderingIntent(e,t,s,i,!0);let a=this._intentStates.get(o.cacheKey);a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=r,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||(a.renderTasks=new Set)).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(u=this._stats)==null||u.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>ux.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,i){function r(){o.read().then(function({value:l,done:u}){if(u){s(a);return}a.lang??(a.lang=l.lang),Object.assign(a.styles,l.styles),a.items.push(...l.items),r()},i)}const o=t.getReader(),a={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),z(this,Nl,!1),O(this,io,gw).call(this),Promise.all(e)}cleanup(e=!1){z(this,Nl,!0);const t=O(this,io,rp).call(this,!1);return e&&t&&this._stats&&(this._stats=new sO),t}_startRenderPage(e,t){var i,r;const s=this._intentStates.get(t);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(r=s.displayReadyCapability)==null||r.resolve(e))}_renderPageChunk(e,t){for(let s=0,i=e.length;s<i;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&O(this,io,rp).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:i}){const{map:r,transfer:o}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:i},o).getReader(),u=this._intentStates.get(t);u.streamReader=l;const f=()=>{l.read().then(({value:p,done:g})=>{if(g){u.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(p,u),f())},p=>{if(u.streamReader=null,!this._transport.destroyed){if(u.operatorList){u.operatorList.lastChunk=!0;for(const g of u.renderTasks)g.operatorListChanged();O(this,io,rp).call(this,!0)}if(u.displayReadyCapability)u.displayReadyCapability.reject(p);else if(u.opListReadCapability)u.opListReadCapability.reject(p);else throw p}})};f()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof R2){let i=$ce;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new Od(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,r]of this._intentStates)if(r===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}hd=new WeakMap,Nl=new WeakMap,io=new WeakSet,rp=function(e=!1){if(O(this,io,gw).call(this),!y(this,Nl)||this.destroyed)return!1;if(e)return z(this,hd,setTimeout(()=>{z(this,hd,null),O(this,io,rp).call(this,!1)},Gce)),!1;for(const{renderTasks:t,operatorList:s}of this._intentStates.values())if(t.size>0||!s.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),z(this,Nl,!1),!0},gw=function(){y(this,hd)&&(clearTimeout(y(this,hd)),z(this,hd,null))};var El,lS;class ede{constructor(){L(this,El,new Map);L(this,lS,Promise.resolve())}postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};y(this,lS).then(()=>{for(const[i]of y(this,El))i.call(this,s)})}addEventListener(e,t,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:r}=s;if(r.aborted){At("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);i=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}y(this,El).set(t,i)}removeEventListener(e,t){const s=y(this,El).get(t);s==null||s(),y(this,El).delete(t)}terminate(){for(const[,e]of y(this,El))e==null||e();y(this,El).clear()}}El=new WeakMap,lS=new WeakMap;var cS,rh,oh,qp,xw,Wp,bw;const zn=class zn{constructor({name:e=null,port:t=null,verbosity:s=jle()}={}){L(this,qp);var i;if(this.name=e,this.destroyed=!1,this.verbosity=s,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((i=y(zn,oh))!=null&&i.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(y(zn,oh)||z(zn,oh,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new l0("main","worker",e),this._messageHandler.on("ready",function(){}),O(this,qp,xw).call(this)}_initialize(){if(y(zn,rh)||y(zn,Wp,bw)){this._setupFakeWorker();return}let{workerSrc:e}=zn;try{zn._isSameOrigin(window.location.href,e)||(e=zn._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new l0("main","worker",t),i=()=>{r.abort(),s.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=new AbortController;t.addEventListener("error",()=>{this._webWorker||i()},{signal:r.signal}),s.on("test",a=>{if(r.abort(),this.destroyed||!a){i();return}this._messageHandler=s,this._port=t,this._webWorker=t,O(this,qp,xw).call(this)}),s.on("ready",a=>{if(r.abort(),this.destroyed){i();return}try{o()}catch{this._setupFakeWorker()}});const o=()=>{const a=new Uint8Array;s.send("test",a,[a.buffer])};o();return}catch{JS("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){y(zn,rh)||(At("Setting up fake worker."),z(zn,rh,!0)),zn._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new ede;this._port=t;const s=`fake${Ni(zn,cS)._++}`,i=new l0(s+"_worker",s,t);e.setup(i,t),this._messageHandler=new l0(s,s+"_worker",t),O(this,qp,xw).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e,t,s;this.destroyed=!0,(e=this._webWorker)==null||e.terminate(),this._webWorker=null,(t=y(zn,oh))==null||t.delete(this._port),this._port=null,(s=this._messageHandler)==null||s.destroy(),this._messageHandler=null}static fromPort(e){var s;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const t=(s=y(this,oh))==null?void 0:s.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new zn(e)}static get workerSrc(){if(Hl.workerSrc)return Hl.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return It(this,"_setupFakeWorkerGlobal",(async()=>y(this,Wp,bw)?y(this,Wp,bw):(await import(this.workerSrc)).WorkerMessageHandler)())}};cS=new WeakMap,rh=new WeakMap,oh=new WeakMap,qp=new WeakSet,xw=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},Wp=new WeakSet,bw=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},L(zn,Wp),L(zn,cS,0),L(zn,rh,!1),L(zn,oh),xi&&(z(zn,rh,!0),Hl.workerSrc||(Hl.workerSrc="./pdf.worker.mjs")),zn._isSameOrigin=(e,t)=>{let s;try{if(s=new URL(e),!s.origin||s.origin==="null")return!1}catch{return!1}const i=new URL(t,s);return s.origin===i.origin},zn._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};let vp=zn;var Tl,va,Kp,Yp,_l,ah,f0;class tde{constructor(e,t,s,i,r){L(this,ah);L(this,Tl,new Map);L(this,va,new Map);L(this,Kp,new Map);L(this,Yp,new Map);L(this,_l,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new _6,this.fontLoader=new ece({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return It(this,"annotationStorage",new j2)}getRenderingIntent(e,t=Yc.ENABLE,s=null,i=!1,r=!1){let o=Nr.DISPLAY,a=iT;switch(e){case"any":o=Nr.ANY;break;case"display":break;case"print":o=Nr.PRINT;break;default:At(`getRenderingIntent - invalid intent: ${e}`)}const l=o&Nr.PRINT&&s instanceof o6?s:this.annotationStorage;switch(t){case Yc.DISABLE:o+=Nr.ANNOTATIONS_DISABLE;break;case Yc.ENABLE:break;case Yc.ENABLE_FORMS:o+=Nr.ANNOTATIONS_FORMS;break;case Yc.ENABLE_STORAGE:o+=Nr.ANNOTATIONS_STORAGE,a=l.serializable;break;default:At(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(o+=Nr.IS_EDITING),r&&(o+=Nr.OPLIST);const{ids:u,hash:f}=l.modifiedIds,p=[o,a.hash,f];return{renderingIntent:o,cacheKey:p.join("_"),annotationStorageSerializable:a,modifiedIds:u}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=y(this,_l))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of y(this,va).values())e.push(i._destroy());y(this,va).clear(),y(this,Kp).clear(),y(this,Yp).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i,r;this.commonObjs.clear(),this.fontLoader.clear(),y(this,Tl).clear(),this.filterFactory.destroy(),dx.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new Od("Worker was terminated.")),(r=this.messageHandler)==null||r.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,i)=>{ms(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},i.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){i.close();return}ms(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{this._fullReader.cancel(r),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async s=>{var a;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:r,contentLength:o}=this._fullReader;return(!i||!r)&&(this._lastProgress&&((a=t.onProgress)==null||a.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var u;(u=t.onProgress)==null||u.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:i,isRangeSupported:r,contentLength:o}}),e.on("GetRangeReader",(s,i)=>{ms(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(s.begin,s.end);if(!r){i.close();return}i.onPull=()=>{r.read().then(function({value:o,done:a}){if(a){i.close();return}ms(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{r.cancel(o),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new Qce(s,this))}),e.on("DocException",s=>{t._capability.reject(Wi(s))}),e.on("PasswordRequest",s=>{z(this,_l,Promise.withResolvers());try{if(!t.onPassword)throw Wi(s);const i=r=>{r instanceof Error?y(this,_l).reject(r):y(this,_l).resolve({password:r})};t.onPassword(i,s.code)}catch(i){y(this,_l).reject(i)}return y(this,_l).promise}),e.on("DataLoaded",s=>{var i;(i=t.onProgress)==null||i.call(t,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;y(this,va).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,i,r])=>{var o;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":const{disableFontFace:a,fontExtraProperties:l,pdfBug:u}=this._params;if("error"in r){const b=r.error;At(`Error during font loading: ${b}`),this.commonObjs.resolve(s,b);break}const f=u&&((o=globalThis.FontInspector)!=null&&o.enabled)?(b,w)=>globalThis.FontInspector.fontAdded(b,w):null,p=new tce(r,{disableFontFace:a,fontExtraProperties:l,inspectFont:f});this.fontLoader.bind(p).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!l&&p.data&&(p.data=null),this.commonObjs.resolve(s,p)});break;case"CopyLocalImage":const{imageRef:g}=r;ms(g,"The imageRef must be defined.");for(const b of y(this,va).values())for(const[,w]of b.objs)if((w==null?void 0:w.ref)===g)return w.dataLen?(this.commonObjs.resolve(s,structuredClone(w)),w.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,r);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([s,i,r,o])=>{var l;if(this.destroyed)return;const a=y(this,va).get(i);if(!a.objs.has(s)){if(a._intentStates.size===0){(l=o==null?void 0:o.bitmap)==null||l.close();return}switch(r){case"Image":a.objs.resolve(s,o),(o==null?void 0:o.dataLen)>Mle&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(s,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",s=>{var i;this.destroyed||(i=t.onProgress)==null||i.call(t,{loaded:s.loaded,total:s.total})}),e.on("FetchBuiltInCMap",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(s)}),e.on("FetchStandardFontData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&At("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((s=this._fullReader)==null?void 0:s.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=y(this,Kp).get(t);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&y(this,Yp).set(r.refStr,e);const o=new Zce(t,r,this,this._params.pdfBug);return y(this,va).set(t,o),o});return y(this,Kp).set(t,i),i}getPageIndex(e){return xO(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return O(this,ah,f0).call(this,"GetFieldObjects")}hasJSActions(){return O(this,ah,f0).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return O(this,ah,f0).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return O(this,ah,f0).call(this,"GetOptionalContentConfig").then(t=>new Sce(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=y(this,Tl).get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(i=>{var r,o;return{info:i[0],metadata:i[1]?new wce(i[1]):null,contentDispositionFilename:((r=this._fullReader)==null?void 0:r.filename)??null,contentLength:((o=this._fullReader)==null?void 0:o.contentLength)??null}});return y(this,Tl).set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of y(this,va).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),y(this,Tl).clear(),this.filterFactory.destroy(!0),dx.cleanup()}}cachedPageNumber(e){if(!xO(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return y(this,Yp).get(t)??null}}Tl=new WeakMap,va=new WeakMap,Kp=new WeakMap,Yp=new WeakMap,_l=new WeakMap,ah=new WeakSet,f0=function(e,t=null){const s=y(this,Tl).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise(e,t);return y(this,Tl).set(e,i),i};const Jg=Symbol("INITIAL_DATA");var xr,tb,gT;class _6{constructor(){L(this,tb);L(this,xr,Object.create(null))}get(e,t=null){if(t){const i=O(this,tb,gT).call(this,e);return i.promise.then(()=>t(i.data)),null}const s=y(this,xr)[e];if(!s||s.data===Jg)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=y(this,xr)[e];return!!t&&t.data!==Jg}delete(e){const t=y(this,xr)[e];return!t||t.data===Jg?!1:(delete y(this,xr)[e],!0)}resolve(e,t=null){const s=O(this,tb,gT).call(this,e);s.data=t,s.resolve()}clear(){var e;for(const t in y(this,xr)){const{data:s}=y(this,xr)[t];(e=s==null?void 0:s.bitmap)==null||e.close()}z(this,xr,Object.create(null))}*[Symbol.iterator](){for(const e in y(this,xr)){const{data:t}=y(this,xr)[e];t!==Jg&&(yield[e,t])}}}xr=new WeakMap,tb=new WeakSet,gT=function(e){var t;return(t=y(this,xr))[e]||(t[e]={...Promise.withResolvers(),data:Jg})};var fd;class nde{constructor(e){L(this,fd,null);z(this,fd,e),this.onContinue=null}get promise(){return y(this,fd).capability.promise}cancel(e=0){y(this,fd).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=y(this,fd).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=y(this,fd);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}fd=new WeakMap;var pd,lh;const Au=class Au{constructor({callback:e,params:t,objs:s,commonObjs:i,annotationCanvasMap:r,operatorList:o,pageIndex:a,canvasFactory:l,filterFactory:u,useRequestAnimationFrame:f=!1,pdfBug:p=!1,pageColors:g=null}){L(this,pd,null);this.callback=e,this.params=t,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=u,this._pdfBug=p,this.pageColors=g,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=f===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new nde(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var a,l;if(this.cancelled)return;if(this._canvas){if(y(Au,lh).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");y(Au,lh).add(this._canvas)}this._pdfBug&&((a=globalThis.StepperManager)!=null&&a.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:s,viewport:i,transform:r,background:o}=this.params;this.gfx=new yp(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:i,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var s;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),y(this,pd)&&(window.cancelAnimationFrame(y(this,pd)),z(this,pd,null)),y(Au,lh).delete(this._canvas),this.callback(e||new R2(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?z(this,pd,window.requestAnimationFrame(()=>{z(this,pd,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),y(Au,lh).delete(this._canvas),this.callback())))}};pd=new WeakMap,lh=new WeakMap,L(Au,lh,new WeakSet);let xT=Au;const sde="4.10.38",ide="f9bea397f";function bO(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function Xg(n){return Math.max(0,Math.min(255,255*n))}class yO{static CMYK_G([e,t,s,i]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Xg(e),[e,e,e]}static G_HTML([e]){const t=bO(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(Xg)}static RGB_HTML(e){return`#${e.map(bO).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,s+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,s,i]){return[Xg(1-Math.min(1,e+i)),Xg(1-Math.min(1,s+i)),Xg(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const i=1-e,r=1-t,o=1-s,a=Math.min(i,r,o);return["CMYK",i,r,o,a]}}class rde{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){xn("Abstract method `_createSVG` called.")}}class L2 extends rde{_createSVG(e){return document.createElementNS(dl,e)}}class M6{static setupStorage(e,t,s,i,r){const o=i.getValue(t,{value:null});switch(s.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),r==="print")break;e.addEventListener("input",a=>{i.setValue(t,{value:a.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(o.value===s.attributes.xfaOn?e.setAttribute("checked",!0):o.value===s.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",a=>{i.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),r==="print")break;e.addEventListener("input",a=>{i.setValue(t,{value:a.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const a of s.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{const l=a.target.options,u=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(t,{value:u})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:i,linkService:r}){const{attributes:o}=t,a=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${i}`);for(const[l,u]of Object.entries(o))if(u!=null)switch(l){case"class":u.length&&e.setAttribute(l,u.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",u);break;case"style":Object.assign(e.style,u);break;case"textContent":e.textContent=u;break;default:(!a||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,u)}a&&r.addLinkAttributes(e,o.href,o.newWindow),s&&o.dataId&&this.setupStorage(e,o.dataId,t,s)}static render(e){var p,g;const t=e.annotationStorage,s=e.linkService,i=e.xfaHtml,r=e.intent||"display",o=document.createElement(i.name);i.attributes&&this.setAttributes({html:o,element:i,intent:r,linkService:s});const a=r!=="richText",l=e.div;if(l.append(o),e.viewport){const b=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=b}a&&l.setAttribute("class","xfaLayer xfaFont");const u=[];if(i.children.length===0){if(i.value){const b=document.createTextNode(i.value);o.append(b),a&&ux.shouldBuildText(i.name)&&u.push(b)}return{textDivs:u}}const f=[[i,-1,o]];for(;f.length>0;){const[b,w,S]=f.at(-1);if(w+1===b.children.length){f.pop();continue}const N=b.children[++f.at(-1)[1]];if(N===null)continue;const{name:C}=N;if(C==="#text"){const R=document.createTextNode(N.value);u.push(R),S.append(R);continue}const M=(p=N==null?void 0:N.attributes)!=null&&p.xmlns?document.createElementNS(N.attributes.xmlns,C):document.createElement(C);if(S.append(M),N.attributes&&this.setAttributes({html:M,element:N,storage:t,intent:r,linkService:s}),((g=N.children)==null?void 0:g.length)>0)f.push([N,-1,M]);else if(N.value){const R=document.createTextNode(N.value);a&&ux.shouldBuildText(C)&&u.push(R),M.append(R)}}for(const b of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))b.setAttribute("readOnly",!0);return{textDivs:u}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Kb=1e3,ode=9,Qh=new WeakSet;function jd(n){return{width:n[2]-n[0],height:n[3]-n[1]}}class ade{static create(e){switch(e.data.annotationType){case ks.LINK:return new R6(e);case ks.TEXT:return new lde(e);case ks.WIDGET:switch(e.data.fieldType){case"Tx":return new cde(e);case"Btn":return e.data.radioButton?new D6(e):e.data.checkBox?new ude(e):new hde(e);case"Ch":return new fde(e);case"Sig":return new dde(e)}return new rf(e);case ks.POPUP:return new yT(e);case ks.FREETEXT:return new B6(e);case ks.LINE:return new mde(e);case ks.SQUARE:return new gde(e);case ks.CIRCLE:return new xde(e);case ks.POLYLINE:return new F6(e);case ks.CARET:return new yde(e);case ks.INK:return new O2(e);case ks.POLYGON:return new bde(e);case ks.HIGHLIGHT:return new H6(e);case ks.UNDERLINE:return new vde(e);case ks.SQUIGGLY:return new wde(e);case ks.STRIKEOUT:return new kde(e);case ks.STAMP:return new U6(e);case ks.FILEATTACHMENT:return new Sde(e);default:return new is(e)}}}var ch,Jp,Xp,nb,bT;const U2=class U2{constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){L(this,nb);L(this,ch,null);L(this,Jp,!1);L(this,Xp,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:s}){return!!(e!=null&&e.str||t!=null&&t.str||s!=null&&s.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return U2._hasPopupData(this.data)}updateEdited(e){var s;if(!this.container)return;y(this,ch)||z(this,ch,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&O(this,nb,bT).call(this,t),(s=y(this,Xp))==null||s.popup.updateEdited(e)}resetEdited(){var e;y(this,ch)&&(O(this,nb,bT).call(this,y(this,ch).rect),(e=y(this,Xp))==null||e.popup.resetEdited(),z(this,ch,null))}_createContainer(e){const{data:t,parent:{page:s,viewport:i}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),this instanceof rf||(r.tabIndex=Kb);const{style:o}=r;if(o.zIndex=this.parent.zIndex++,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof yT){const{rotation:S}=t;return!t.hasOwnCanvas&&S!==0&&this.setRotation(S,r),r}const{width:a,height:l}=jd(t.rect);if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const S=t.borderStyle.horizontalCornerRadius,N=t.borderStyle.verticalCornerRadius;if(S>0||N>0){const M=`calc(${S}px * var(--scale-factor)) / calc(${N}px * var(--scale-factor))`;o.borderRadius=M}else if(this instanceof D6){const M=`calc(${a}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;o.borderRadius=M}switch(t.borderStyle.style){case Kg.SOLID:o.borderStyle="solid";break;case Kg.DASHED:o.borderStyle="dashed";break;case Kg.BEVELED:At("Unimplemented border style: beveled");break;case Kg.INSET:At("Unimplemented border style: inset");break;case Kg.UNDERLINE:o.borderBottomStyle="solid";break}const C=t.borderColor||null;C?(z(this,Jp,!0),o.borderColor=rt.makeHexColor(C[0]|0,C[1]|0,C[2]|0)):o.borderWidth=0}const u=rt.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:f,pageHeight:p,pageX:g,pageY:b}=i.rawDims;o.left=`${100*(u[0]-g)/f}%`,o.top=`${100*(u[1]-b)/p}%`;const{rotation:w}=t;return t.hasOwnCanvas||w===0?(o.width=`${100*a/f}%`,o.height=`${100*l/p}%`):this.setRotation(w,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims,{width:r,height:o}=jd(this.data.rect);let a,l;e%180===0?(a=100*r/s,l=100*o/i):(a=100*o/s,l=100*r/i),t.style.width=`${a}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,i)=>{const r=i.detail[t],o=r[0],a=r.slice(1);i.target.style[s]=yO[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[s]:yO[`${o}_rgb`](a)})};return It(this,"_commonActions",{display:t=>{const{display:s}=t.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const i of Object.keys(t.detail)){const r=e[i]||s[i];r==null||r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[i,r]of Object.entries(t)){const o=s[i];if(o){const a={detail:{[i]:r},target:e};o(a),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,i,r]=this.data.rect.map(S=>Math.fround(S));if(e.length===8){const[S,N,C,M]=e.subarray(2,6);if(i===S&&r===N&&t===C&&s===M)return}const{style:o}=this.container;let a;if(y(this,Jp)){const{borderColor:S,borderWidth:N}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${S}" stroke-width="${N}">`],this.container.classList.add("hasBorder")}const l=i-t,u=r-s,{svgFactory:f}=this,p=f.createElement("svg");p.classList.add("quadrilateralsContainer"),p.setAttribute("width",0),p.setAttribute("height",0);const g=f.createElement("defs");p.append(g);const b=f.createElement("clipPath"),w=`clippath_${this.data.id}`;b.setAttribute("id",w),b.setAttribute("clipPathUnits","objectBoundingBox"),g.append(b);for(let S=2,N=e.length;S<N;S+=8){const C=e[S],M=e[S+1],R=e[S+2],_=e[S+3],j=f.createElement("rect"),P=(R-t)/l,D=(r-M)/u,U=(C-R)/l,V=(M-_)/u;j.setAttribute("x",P),j.setAttribute("y",D),j.setAttribute("width",U),j.setAttribute("height",V),b.append(j),a==null||a.push(`<rect vector-effect="non-scaling-stroke" x="${P}" y="${D}" width="${U}" height="${V}"/>`)}y(this,Jp)&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(p),this.container.style.clipPath=`url(#${w})`}_createPopup(){const{data:e}=this,t=z(this,Xp,new yT({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){xn("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:r,id:o,exportValues:a}of i){if(r===-1||o===t)continue;const l=typeof a=="string"?a:null,u=document.querySelector(`[data-element-id="${o}"]`);if(u&&!Qh.has(u)){At(`_getElementsByName - element not allowed: ${o}`);continue}s.push({id:o,exportValue:l,domElement:u})}return s}for(const i of document.getElementsByName(e)){const{exportValue:r}=i,o=i.getAttribute("data-element-id");o!==t&&Qh.has(i)&&s.push({id:o,exportValue:r,domElement:i})}return s}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};ch=new WeakMap,Jp=new WeakMap,Xp=new WeakMap,nb=new WeakSet,bT=function(e){const{container:{style:t},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:l}}}}=this;s==null||s.splice(0,4,...e);const{width:u,height:f}=jd(e);t.left=`${100*(e[0]-a)/r}%`,t.top=`${100*(o-e[3]+l)/o}%`,i===0?(t.width=`${100*u/r}%`,t.height=`${100*f/o}%`):this.setRotation(i)};let is=U2;var Tr,yu,I6,z6;class R6 extends is{constructor(t,s=null){super(t,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});L(this,Tr);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let r=!1;return t.url?(s.addLinkAttributes(i,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(i,t.action),r=!0):t.attachment?(O(this,Tr,I6).call(this,i,t.attachment,t.attachmentDest),r=!0):t.setOCGState?(O(this,Tr,z6).call(this,i,t.setOCGState),r=!0):t.dest?(this._bindLink(i,t.dest),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),r=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(i,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&this.container.append(i),this.container}_bindLink(t,s){t.href=this.linkService.getDestinationHash(s),t.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&O(this,Tr,yu).call(this)}_bindNamedAction(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(s),!1),O(this,Tr,yu).call(this)}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(s.actions)){const o=i.get(r);o&&(t[o]=()=>{var a;return(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:r}}),!1})}t.onclick||(t.onclick=()=>!1),O(this,Tr,yu).call(this)}_bindResetFormAction(t,s){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),O(this,Tr,yu).call(this),!this._fieldObjects){At('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var p;i==null||i();const{fields:r,refs:o,include:a}=s,l=[];if(r.length!==0||o.length!==0){const g=new Set(o);for(const b of r){const w=this._fieldObjects[b]||[];for(const{id:S}of w)g.add(S)}for(const b of Object.values(this._fieldObjects))for(const w of b)g.has(w.id)===a&&l.push(w)}else for(const g of Object.values(this._fieldObjects))l.push(...g);const u=this.annotationStorage,f=[];for(const g of l){const{id:b}=g;switch(f.push(b),g.type){case"text":{const S=g.defaultValue||"";u.setValue(b,{value:S});break}case"checkbox":case"radiobutton":{const S=g.defaultValue===g.exportValues;u.setValue(b,{value:S});break}case"combobox":case"listbox":{const S=g.defaultValue||"";u.setValue(b,{value:S});break}default:continue}const w=document.querySelector(`[data-element-id="${b}"]`);if(w){if(!Qh.has(w)){At(`_bindResetFormAction - element not allowed: ${b}`);continue}}else continue;w.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:f,name:"ResetForm"}})),!1}}}Tr=new WeakSet,yu=function(){this.container.setAttribute("data-internal-link","")},I6=function(t,s,i=null){t.href=this.linkService.getAnchorUrl(""),s.description&&(t.title=s.description),t.onclick=()=>{var r;return(r=this.downloadManager)==null||r.openOrDownloadData(s.content,s.filename,i),!1},O(this,Tr,yu).call(this)},z6=function(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(s),!1),O(this,Tr,yu).call(this)};class lde extends is{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class rf extends is{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return zi.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,i,r){s.includes("mouse")?e.addEventListener(s,o=>{var a;(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(s,o=>{var a;if(s==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}r&&((a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o)}}))})}_setEventListeners(e,t,s,i){var r,o,a;for(const[l,u]of s)(u==="Action"||(r=this.data.actions)!=null&&r[u])&&((u==="Focus"||u==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,u,i),u==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(e,t,"blur","Blur",null):u==="Blur"&&!((a=this.data.actions)!=null&&a.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":rt.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||ode,r=e.style;let o;const a=2,l=u=>Math.round(10*u)/10;if(this.data.multiLine){const u=Math.abs(this.data.rect[3]-this.data.rect[1]-a),f=Math.round(u/(dN*i))||1,p=u/f;o=Math.min(i,l(p/dN))}else{const u=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(i,l(u/dN))}r.fontSize=`calc(${o}px * var(--scale-factor))`,r.color=rt.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class cde extends rf{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,i){const r=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=s),r.setValue(o.id,{[i]:s})}render(){var i,r;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const o=e.getValue(t,{value:this.data.fieldValue});let a=o.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&a.length>l&&(a=a.slice(0,l));let u=o.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;u&&this.data.comb&&(u=u.replaceAll(/\s+/g,""));const f={userValue:a,formattedValue:u,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=u??a,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type="text",s.setAttribute("value",u??a),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Qh.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=Kb,this._setRequired(s,this.data.required),l&&(s.maxLength=l),s.addEventListener("input",g=>{e.setValue(t,{value:g.target.value}),this.setPropertyOnSiblings(s,"value",g.target.value,"value"),f.formattedValue=null}),s.addEventListener("resetform",g=>{const b=this.data.defaultFieldValue??"";s.value=f.userValue=b,f.formattedValue=null});let p=g=>{const{formattedValue:b}=f;b!=null&&(g.target.value=b),g.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",b=>{var S;if(f.focused)return;const{target:w}=b;f.userValue&&(w.value=f.userValue),f.lastCommittedValue=w.value,f.commitKey=1,(S=this.data.actions)!=null&&S.Focus||(f.focused=!0)}),s.addEventListener("updatefromsandbox",b=>{this.showElementAndHideCanvas(b.target);const w={value(S){f.userValue=S.detail.value??"",e.setValue(t,{value:f.userValue.toString()}),S.target.value=f.userValue},formattedValue(S){const{formattedValue:N}=S.detail;f.formattedValue=N,N!=null&&S.target!==document.activeElement&&(S.target.value=N),e.setValue(t,{formattedValue:N})},selRange(S){S.target.setSelectionRange(...S.detail.selRange)},charLimit:S=>{var R;const{charLimit:N}=S.detail,{target:C}=S;if(N===0){C.removeAttribute("maxLength");return}C.setAttribute("maxLength",N);let M=f.userValue;!M||M.length<=N||(M=M.slice(0,N),C.value=f.userValue=M,e.setValue(t,{value:M}),(R=this.linkService.eventBus)==null||R.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:M,willCommit:!0,commitKey:1,selStart:C.selectionStart,selEnd:C.selectionEnd}}))}};this._dispatchEventFromSandbox(w,b)}),s.addEventListener("keydown",b=>{var N;f.commitKey=1;let w=-1;if(b.key==="Escape"?w=0:b.key==="Enter"&&!this.data.multiLine?w=2:b.key==="Tab"&&(f.commitKey=3),w===-1)return;const{value:S}=b.target;f.lastCommittedValue!==S&&(f.lastCommittedValue=S,f.userValue=S,(N=this.linkService.eventBus)==null||N.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:S,willCommit:!0,commitKey:w,selStart:b.target.selectionStart,selEnd:b.target.selectionEnd}}))});const g=p;p=null,s.addEventListener("blur",b=>{var S,N;if(!f.focused||!b.relatedTarget)return;(S=this.data.actions)!=null&&S.Blur||(f.focused=!1);const{value:w}=b.target;f.userValue=w,f.lastCommittedValue!==w&&((N=this.linkService.eventBus)==null||N.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:f.commitKey,selStart:b.target.selectionStart,selEnd:b.target.selectionEnd}})),g(b)}),(r=this.data.actions)!=null&&r.Keystroke&&s.addEventListener("beforeinput",b=>{var j;f.lastCommittedValue=null;const{data:w,target:S}=b,{value:N,selectionStart:C,selectionEnd:M}=S;let R=C,_=M;switch(b.inputType){case"deleteWordBackward":{const P=N.substring(0,C).match(/\w*[^\w]*$/);P&&(R-=P[0].length);break}case"deleteWordForward":{const P=N.substring(C).match(/^[^\w]*\w*/);P&&(_+=P[0].length);break}case"deleteContentBackward":C===M&&(R-=1);break;case"deleteContentForward":C===M&&(_+=1);break}b.preventDefault(),(j=this.linkService.eventBus)==null||j.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:N,change:w||"",willCommit:!1,selStart:R,selEnd:_}})}),this._setEventListeners(s,f,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],b=>b.target.value)}if(p&&s.addEventListener("blur",p),this.data.comb){const b=(this.data.rect[2]-this.data.rect[0])/l;s.classList.add("comb"),s.style.letterSpacing=`calc(${b}px * var(--scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class dde extends rf{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class ude extends rf{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return Qh.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=Kb,r.addEventListener("change",o=>{const{name:a,checked:l}=o.target;for(const u of this._getElementsByName(a,s)){const f=l&&u.exportValue===t.exportValue;u.domElement&&(u.domElement.checked=f),e.setValue(u.id,{value:f})}e.setValue(s,{value:l})}),r.addEventListener("resetform",o=>{const a=t.defaultFieldValue||"Off";o.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{const a={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class D6 extends rf{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(s,{value:i})),i)for(const o of this._getElementsByName(t.fieldName,s))e.setValue(o.id,{value:!1});const r=document.createElement("input");if(Qh.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=Kb,r.addEventListener("change",o=>{const{name:a,checked:l}=o.target;for(const u of this._getElementsByName(a,s))e.setValue(u.id,{value:!1});e.setValue(s,{value:l})}),r.addEventListener("resetform",o=>{const a=t.defaultFieldValue;o.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;r.addEventListener("updatefromsandbox",a=>{const l={value:u=>{const f=o===u.detail.value;for(const p of this._getElementsByName(u.target.name)){const g=f&&p.id===s;p.domElement&&(p.domElement.checked=g),e.setValue(p.id,{value:g})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class hde extends R6{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class fde extends rf{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Qh.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=Kb;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",f=>{const p=this.data.defaultFieldValue;for(const g of i.options)g.selected=g.value===p});for(const f of this.data.options){const p=document.createElement("option");p.textContent=f.displayValue,p.value=f.exportValue,s.value.includes(f.exportValue)&&(p.setAttribute("selected",!0),r=!1),i.append(p)}let o=null;if(r){const f=document.createElement("option");f.value=" ",f.setAttribute("hidden",!0),f.setAttribute("selected",!0),i.prepend(f),o=()=>{f.remove(),i.removeEventListener("input",o),o=null},i.addEventListener("input",o)}const a=f=>{const p=f?"value":"textContent",{options:g,multiple:b}=i;return b?Array.prototype.filter.call(g,w=>w.selected).map(w=>w[p]):g.selectedIndex===-1?null:g[g.selectedIndex][p]};let l=a(!1);const u=f=>{const p=f.target.options;return Array.prototype.map.call(p,g=>({displayValue:g.textContent,exportValue:g.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",f=>{const p={value(g){o==null||o();const b=g.detail.value,w=new Set(Array.isArray(b)?b:[b]);for(const S of i.options)S.selected=w.has(S.value);e.setValue(t,{value:a(!0)}),l=a(!1)},multipleSelection(g){i.multiple=!0},remove(g){const b=i.options,w=g.detail.remove;b[w].selected=!1,i.remove(w),b.length>0&&Array.prototype.findIndex.call(b,N=>N.selected)===-1&&(b[0].selected=!0),e.setValue(t,{value:a(!0),items:u(g)}),l=a(!1)},clear(g){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),l=a(!1)},insert(g){const{index:b,displayValue:w,exportValue:S}=g.detail.insert,N=i.children[b],C=document.createElement("option");C.textContent=w,C.value=S,N?N.before(C):i.append(C),e.setValue(t,{value:a(!0),items:u(g)}),l=a(!1)},items(g){const{items:b}=g.detail;for(;i.length!==0;)i.remove(0);for(const w of b){const{displayValue:S,exportValue:N}=w,C=document.createElement("option");C.textContent=S,C.value=N,i.append(C)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:a(!0),items:u(g)}),l=a(!1)},indices(g){const b=new Set(g.detail.indices);for(const w of g.target.options)w.selected=b.has(w.index);e.setValue(t,{value:a(!0)}),l=a(!1)},editable(g){g.target.disabled=!g.detail.editable}};this._dispatchEventFromSandbox(p,f)}),i.addEventListener("input",f=>{var b;const p=a(!0),g=a(!1);e.setValue(t,{value:p}),f.preventDefault(),(b=this.linkService.eventBus)==null||b.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:g,changeEx:p,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],f=>f.target.value)):i.addEventListener("input",function(f){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class yT extends is{constructor(e){const{data:t,elements:s}=e;super(e,{isRenderable:is._hasPopupData(t)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new pde({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",t.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(s=>`${M2}${s}`).join(",")),this.container}}var Qp,dS,uS,Zp,dh,qn,Ml,em,sb,ib,tm,Rl,To,Il,rb,zl,ob,uh,hh,fn,yw,vT,j6,P6,L6,O6,vw,ww,wT;class pde{constructor({container:e,color:t,elements:s,titleObj:i,modificationDate:r,contentsObj:o,richText:a,parent:l,rect:u,parentRect:f,open:p}){L(this,fn);L(this,Qp,O(this,fn,L6).bind(this));L(this,dS,O(this,fn,wT).bind(this));L(this,uS,O(this,fn,ww).bind(this));L(this,Zp,O(this,fn,vw).bind(this));L(this,dh,null);L(this,qn,null);L(this,Ml,null);L(this,em,null);L(this,sb,null);L(this,ib,null);L(this,tm,null);L(this,Rl,!1);L(this,To,null);L(this,Il,null);L(this,rb,null);L(this,zl,null);L(this,ob,null);L(this,uh,null);L(this,hh,!1);var g;z(this,qn,e),z(this,ob,i),z(this,Ml,o),z(this,zl,a),z(this,ib,l),z(this,dh,t),z(this,rb,u),z(this,tm,f),z(this,sb,s),z(this,em,z2.toDateObject(r)),this.trigger=s.flatMap(b=>b.getElementsToTriggerPopup());for(const b of this.trigger)b.addEventListener("click",y(this,Zp)),b.addEventListener("mouseenter",y(this,uS)),b.addEventListener("mouseleave",y(this,dS)),b.classList.add("popupTriggerArea");for(const b of s)(g=b.container)==null||g.addEventListener("keydown",y(this,Qp));y(this,qn).hidden=!0,p&&O(this,fn,vw).call(this)}render(){if(y(this,To))return;const e=z(this,To,document.createElement("div"));if(e.className="popup",y(this,dh)){const r=e.style.outlineColor=rt.makeHexColor(...y(this,dh));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`:e.style.backgroundColor=rt.makeHexColor(...y(this,dh).map(a=>Math.floor(.7*(255-a)+a)))}const t=document.createElement("span");t.className="header";const s=document.createElement("h1");if(t.append(s),{dir:s.dir,str:s.textContent}=y(this,ob),e.append(t),y(this,em)){const r=document.createElement("span");r.classList.add("popupDate"),r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:y(this,em).valueOf()})),t.append(r)}const i=y(this,fn,yw);if(i)M6.render({xfaHtml:i,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const r=this._formatContents(y(this,Ml));e.append(r)}y(this,qn).append(e)}_formatContents({str:e,dir:t}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=t;const i=e.split(/(?:\r\n?|\n)/);for(let r=0,o=i.length;r<o;++r){const a=i[r];s.append(document.createTextNode(a)),r<o-1&&s.append(document.createElement("br"))}return s}updateEdited({rect:e,popupContent:t}){var s;y(this,uh)||z(this,uh,{contentsObj:y(this,Ml),richText:y(this,zl)}),e&&z(this,Il,null),t&&(z(this,zl,O(this,fn,P6).call(this,t)),z(this,Ml,null)),(s=y(this,To))==null||s.remove(),z(this,To,null)}resetEdited(){var e;y(this,uh)&&({contentsObj:Ni(this,Ml)._,richText:Ni(this,zl)._}=y(this,uh),z(this,uh,null),(e=y(this,To))==null||e.remove(),z(this,To,null),z(this,Il,null))}forceHide(){z(this,hh,this.isVisible),y(this,hh)&&(y(this,qn).hidden=!0)}maybeShow(){y(this,hh)&&(y(this,To)||O(this,fn,ww).call(this),z(this,hh,!1),y(this,qn).hidden=!1)}get isVisible(){return y(this,qn).hidden===!1}}Qp=new WeakMap,dS=new WeakMap,uS=new WeakMap,Zp=new WeakMap,dh=new WeakMap,qn=new WeakMap,Ml=new WeakMap,em=new WeakMap,sb=new WeakMap,ib=new WeakMap,tm=new WeakMap,Rl=new WeakMap,To=new WeakMap,Il=new WeakMap,rb=new WeakMap,zl=new WeakMap,ob=new WeakMap,uh=new WeakMap,hh=new WeakMap,fn=new WeakSet,yw=function(){const e=y(this,zl),t=y(this,Ml);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&y(this,zl).html||null},vT=function(){var e,t,s;return((s=(t=(e=y(this,fn,yw))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.fontSize)||0},j6=function(){var e,t,s;return((s=(t=(e=y(this,fn,yw))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.color)||null},P6=function(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:y(this,fn,j6),fontSize:y(this,fn,vT)?`calc(${y(this,fn,vT)}px * var(--scale-factor))`:""}};for(const r of e.split(`
`))t.push({name:"span",value:r,attributes:i});return s},L6=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&y(this,Rl))&&O(this,fn,vw).call(this)},O6=function(){if(y(this,Il)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:i,pageY:r}}}=y(this,ib);let o=!!y(this,tm),a=o?y(this,tm):y(this,rb);for(const w of y(this,sb))if(!a||rt.intersect(w.data.rect,a)!==null){a=w.data.rect,o=!0;break}const l=rt.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),f=o?a[2]-a[0]+5:0,p=l[0]+f,g=l[1];z(this,Il,[100*(p-i)/t,100*(g-r)/s]);const{style:b}=y(this,qn);b.left=`${y(this,Il)[0]}%`,b.top=`${y(this,Il)[1]}%`},vw=function(){z(this,Rl,!y(this,Rl)),y(this,Rl)?(O(this,fn,ww).call(this),y(this,qn).addEventListener("click",y(this,Zp)),y(this,qn).addEventListener("keydown",y(this,Qp))):(O(this,fn,wT).call(this),y(this,qn).removeEventListener("click",y(this,Zp)),y(this,qn).removeEventListener("keydown",y(this,Qp)))},ww=function(){y(this,To)||this.render(),this.isVisible?y(this,Rl)&&y(this,qn).classList.add("focused"):(O(this,fn,O6).call(this),y(this,qn).hidden=!1,y(this,qn).style.zIndex=parseInt(y(this,qn).style.zIndex)+1e3)},wT=function(){y(this,qn).classList.remove("focused"),!(y(this,Rl)||!this.isVisible)&&(y(this,qn).hidden=!0,y(this,qn).style.zIndex=parseInt(y(this,qn).style.zIndex)-1e3)};class B6 extends is{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Ct.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var ab;class mde extends is{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});L(this,ab,null)}render(){this.container.classList.add("lineAnnotation");const t=this.data,{width:s,height:i}=jd(t.rect),r=this.svgFactory.create(s,i,!0),o=z(this,ab,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return y(this,ab)}addHighlightArea(){this.container.classList.add("highlightArea")}}ab=new WeakMap;var lb;class gde extends is{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});L(this,lb,null)}render(){this.container.classList.add("squareAnnotation");const t=this.data,{width:s,height:i}=jd(t.rect),r=this.svgFactory.create(s,i,!0),o=t.borderStyle.width,a=z(this,lb,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",o/2),a.setAttribute("y",o/2),a.setAttribute("width",s-o),a.setAttribute("height",i-o),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return y(this,lb)}addHighlightArea(){this.container.classList.add("highlightArea")}}lb=new WeakMap;var cb;class xde extends is{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});L(this,cb,null)}render(){this.container.classList.add("circleAnnotation");const t=this.data,{width:s,height:i}=jd(t.rect),r=this.svgFactory.create(s,i,!0),o=t.borderStyle.width,a=z(this,cb,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",s/2),a.setAttribute("cy",i/2),a.setAttribute("rx",s/2-o/2),a.setAttribute("ry",i/2-o/2),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return y(this,cb)}addHighlightArea(){this.container.classList.add("highlightArea")}}cb=new WeakMap;var db;class F6 extends is{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});L(this,db,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:i,popupRef:r}}=this;if(!s)return this.container;const{width:o,height:a}=jd(t),l=this.svgFactory.create(o,a,!0);let u=[];for(let p=0,g=s.length;p<g;p+=2){const b=s[p]-t[0],w=t[3]-s[p+1];u.push(`${b},${w}`)}u=u.join(" ");const f=z(this,db,this.svgFactory.createElement(this.svgElementName));return f.setAttribute("points",u),f.setAttribute("stroke-width",i.width||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),l.append(f),this.container.append(l),!r&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return y(this,db)}addHighlightArea(){this.container.classList.add("highlightArea")}}db=new WeakMap;class bde extends F6{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class yde extends is{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var ub,fh,hb,kT;class O2 extends is{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});L(this,hb);L(this,ub,null);L(this,fh,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Ct.HIGHLIGHT:Ct.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:s,inkLists:i,borderStyle:r,popupRef:o}}=this,{transform:a,width:l,height:u}=O(this,hb,kT).call(this,s,t),f=this.svgFactory.create(l,u,!0),p=z(this,ub,this.svgFactory.createElement("svg:g"));f.append(p),p.setAttribute("stroke-width",r.width||1),p.setAttribute("stroke-linecap","round"),p.setAttribute("stroke-linejoin","round"),p.setAttribute("stroke-miterlimit",10),p.setAttribute("stroke","transparent"),p.setAttribute("fill","transparent"),p.setAttribute("transform",a);for(let g=0,b=i.length;g<b;g++){const w=this.svgFactory.createElement(this.svgElementName);y(this,fh).push(w),w.setAttribute("points",i[g].join(",")),p.append(w)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(f),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:s,points:i,rect:r}=t,o=y(this,ub);if(s>=0&&o.setAttribute("stroke-width",s||1),i)for(let a=0,l=y(this,fh).length;a<l;a++)y(this,fh)[a].setAttribute("points",i[a].join(","));if(r){const{transform:a,width:l,height:u}=O(this,hb,kT).call(this,this.data.rotation,r);o.parentElement.setAttribute("viewBox",`0 0 ${l} ${u}`),o.setAttribute("transform",a)}}getElementsToTriggerPopup(){return y(this,fh)}addHighlightArea(){this.container.classList.add("highlightArea")}}ub=new WeakMap,fh=new WeakMap,hb=new WeakSet,kT=function(t,s){switch(t){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class H6 extends is{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Ct.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class vde extends is{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class wde extends is{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class kde extends is{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class U6 extends is{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Ct.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var fb,pb,ST;class Sde extends is{constructor(t){var i;super(t,{isRenderable:!0});L(this,pb);L(this,fb,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",O(this,pb,ST).bind(this)),z(this,fb,i);const{isMac:r}=zi.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&O(this,pb,ST).call(this)}),!s.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return y(this,fb)}addHighlightArea(){this.container.classList.add("highlightArea")}}fb=new WeakMap,pb=new WeakSet,ST=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var mb,ph,mh,gb,Zh,$6,CT;class Cde{constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:i,page:r,viewport:o,structTreeLayer:a}){L(this,Zh);L(this,mb,null);L(this,ph,null);L(this,mh,new Map);L(this,gb,null);this.div=e,z(this,mb,t),z(this,ph,s),z(this,gb,a||null),this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return y(this,mh).size>0}async render(e){var o;const{annotations:t}=e,s=this.div;Jh(s,this.viewport);const i=new Map,r={data:null,layer:s,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new L2,annotationStorage:e.annotationStorage||new j2,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const a of t){if(a.noHTML)continue;const l=a.annotationType===ks.POPUP;if(l){const p=i.get(a.id);if(!p)continue;r.elements=p}else{const{width:p,height:g}=jd(a.rect);if(p<=0||g<=0)continue}r.data=a;const u=ade.create(r);if(!u.isRenderable)continue;if(!l&&a.popupRef){const p=i.get(a.popupRef);p?p.push(u):i.set(a.popupRef,[u])}const f=u.render();a.hidden&&(f.style.visibility="hidden"),await O(this,Zh,$6).call(this,f,a.id),u._isEditable&&(y(this,mh).set(u.data.id,u),(o=this._annotationEditorUIManager)==null||o.renderAnnotationElement(u))}O(this,Zh,CT).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,Jh(t,{rotation:e.rotation}),O(this,Zh,CT).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(y(this,mh).values())}getEditableAnnotation(e){return y(this,mh).get(e)}}mb=new WeakMap,ph=new WeakMap,mh=new WeakMap,gb=new WeakMap,Zh=new WeakSet,$6=async function(e,t){var o,a;const s=e.firstChild||e,i=s.id=`${M2}${t}`,r=await((o=y(this,gb))==null?void 0:o.getAriaAttributes(i));if(r)for(const[l,u]of r)s.setAttribute(l,u);this.div.append(e),(a=y(this,mb))==null||a.moveElementInDOM(this.div,e,s,!1)},CT=function(){if(!y(this,ph))return;const e=this.div;for(const[t,s]of y(this,ph)){const i=e.querySelector(`[data-annotation-id="${t}"]`);if(!i)continue;s.className="annotationContent";const{firstChild:r}=i;r?r.nodeName==="CANVAS"?r.replaceWith(s):r.classList.contains("annotationContent")?r.after(s):r.before(s):i.append(s)}y(this,ph).clear()};const Vv=/\r\n?|\n/g;var _o,br,xb,gh,yr,xs,G6,V6,q6,kw,Yl,Sw,Cw,W6,NT,K6;const wn=class wn extends Fn{constructor(t){super({...t,name:"freeTextEditor"});L(this,xs);L(this,_o);L(this,br,"");L(this,xb,`${this.id}-editor`);L(this,gh,null);L(this,yr);z(this,_o,t.color||wn._defaultColor||Fn._defaultLineColor),z(this,yr,t.fontSize||wn._defaultFontSize)}static get _keyboardManager(){const t=wn.prototype,s=o=>o.isEmpty(),i=Xh.TRANSLATE_SMALL,r=Xh.TRANSLATE_BIG;return It(this,"_keyboardManager",new Wb([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:s}]]))}static initialize(t,s){Fn.initialize(t,s);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case $t.FREETEXT_SIZE:wn._defaultFontSize=s;break;case $t.FREETEXT_COLOR:wn._defaultColor=s;break}}updateParams(t,s){switch(t){case $t.FREETEXT_SIZE:O(this,xs,G6).call(this,s);break;case $t.FREETEXT_COLOR:O(this,xs,V6).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[$t.FREETEXT_SIZE,wn._defaultFontSize],[$t.FREETEXT_COLOR,wn._defaultColor||Fn._defaultLineColor]]}get propertiesToUpdate(){return[[$t.FREETEXT_SIZE,y(this,yr)],[$t.FREETEXT_COLOR,y(this,_o)]]}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,!0)}getInitialTranslation(){const t=this.parentScale;return[-wn._internalPadding*t,-(wn._internalPadding+y(this,yr))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Ct.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),z(this,gh,new AbortController);const t=this._uiManager.combinedSignal(y(this,gh));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",y(this,xb)),this._isDraggable=!0,(t=y(this,gh))==null||t.abort(),z(this,gh,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var s;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=y(this,br),s=z(this,br,O(this,xs,q6).call(this).trimEnd());if(t===s)return;const i=r=>{if(z(this,br,r),!r){this.remove();return}O(this,xs,Cw).call(this),this._uiManager.rebuild(this),O(this,xs,kw).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(t)},mustExec:!1}),O(this,xs,kw).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){wn._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,s;this.width&&(t=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",y(this,xb)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${y(this,yr)}px * var(--scale-factor))`,i.color=y(this,_o),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Vk(this,this.div,["dblclick","keydown"]),this.width){const[r,o]=this.parentDimensions;if(this.annotationElementId){const{position:a}=this._initialData;let[l,u]=this.getInitialTranslation();[l,u]=this.pageTranslationToScreen(l,u);const[f,p]=this.pageDimensions,[g,b]=this.pageTranslation;let w,S;switch(this.rotation){case 0:w=t+(a[0]-g)/f,S=s+this.height-(a[1]-b)/p;break;case 90:w=t+(a[0]-g)/f,S=s-(a[1]-b)/p,[l,u]=[u,-l];break;case 180:w=t-this.width+(a[0]-g)/f,S=s-(a[1]-b)/p,[l,u]=[-l,-u];break;case 270:w=t+(a[0]-g-this.height*p)/f,S=s+(a[1]-b-this.width*f)/p,[l,u]=[-u,l];break}this.setAt(w*r,S*o,l,u)}else this.setAt(t*r,s*o,this.width*r,this.height*o);O(this,xs,Cw).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var w,S,N;const s=t.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const r=O(w=wn,Yl,NT).call(w,s.getData("text")||"").replaceAll(Vv,`
`);if(!r)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const a=o.getRangeAt(0);if(!r.includes(`
`)){a.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:l,startOffset:u}=a,f=[],p=[];if(l.nodeType===Node.TEXT_NODE){const C=l.parentElement;if(p.push(l.nodeValue.slice(u).replaceAll(Vv,"")),C!==this.editorDiv){let M=f;for(const R of this.editorDiv.childNodes){if(R===C){M=p;continue}M.push(O(S=wn,Yl,Sw).call(S,R))}}f.push(l.nodeValue.slice(0,u).replaceAll(Vv,""))}else if(l===this.editorDiv){let C=f,M=0;for(const R of this.editorDiv.childNodes)M++===u&&(C=p),C.push(O(N=wn,Yl,Sw).call(N,R))}z(this,br,`${f.join(`
`)}${r}${p.join(`
`)}`),O(this,xs,Cw).call(this);const g=new Range;let b=f.reduce((C,M)=>C+M.length,0);for(const{firstChild:C}of this.editorDiv.childNodes)if(C.nodeType===Node.TEXT_NODE){const M=C.nodeValue.length;if(b<=M){g.setStart(C,b),g.setEnd(C,b);break}b-=M}o.removeAllRanges(),o.addRange(g)}get contentDiv(){return this.editorDiv}static async deserialize(t,s,i){var a;let r=null;if(t instanceof B6){const{data:{defaultAppearanceData:{fontSize:l,fontColor:u},rect:f,rotation:p,id:g,popupRef:b},textContent:w,textPosition:S,parent:{page:{pageNumber:N}}}=t;if(!w||w.length===0)return null;r=t={annotationType:Ct.FREETEXT,color:Array.from(u),fontSize:l,value:w.join(`
`),position:S,pageIndex:N-1,rect:f.slice(0),rotation:p,id:g,deleted:!1,popupRef:b}}const o=await super.deserialize(t,s,i);return z(o,yr,t.fontSize),z(o,_o,rt.makeHexColor(...t.color)),z(o,br,O(a=wn,Yl,NT).call(a,t.value)),o.annotationElementId=t.id||null,o._initialData=r,o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=wn._internalPadding*this.parentScale,i=this.getRect(s,s),r=Fn._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:y(this,_o)),o={annotationType:Ct.FREETEXT,color:r,fontSize:y(this,yr),value:O(this,xs,W6).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?o:this.annotationElementId&&!O(this,xs,K6).call(this,o)?null:(o.id=this.annotationElementId,o)}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(this.deleted)return s;const{style:i}=s;i.fontSize=`calc(${y(this,yr)}px * var(--scale-factor))`,i.color=y(this,_o),s.replaceChildren();for(const o of y(this,br).split(`
`)){const a=document.createElement("div");a.append(o?document.createTextNode(o):document.createElement("br")),s.append(a)}const r=wn._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(r,r),popupContent:y(this,br)}),s}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};_o=new WeakMap,br=new WeakMap,xb=new WeakMap,gh=new WeakMap,yr=new WeakMap,xs=new WeakSet,G6=function(t){const s=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--scale-factor))`,this.translate(0,-(r-y(this,yr))*this.parentScale),z(this,yr,r),O(this,xs,kw).call(this)},i=y(this,yr);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:$t.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},V6=function(t){const s=r=>{z(this,_o,this.editorDiv.style.color=r)},i=y(this,_o);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:$t.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},q6=function(){var i;const t=[];this.editorDiv.normalize();let s=null;for(const r of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(O(i=wn,Yl,Sw).call(i,r)),s=r);return t.join(`
`)},kw=function(){const[t,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:r,div:o}=this,a=o.style.display,l=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),i=o.getBoundingClientRect(),o.remove(),o.style.display=a,o.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/s):(this.width=i.height/t,this.height=i.width/s),this.fixAndSetPosition()},Yl=new WeakSet,Sw=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Vv,"")},Cw=function(){if(this.editorDiv.replaceChildren(),!!y(this,br))for(const t of y(this,br).split(`
`)){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(s)}},W6=function(){return y(this,br).replaceAll(""," ")},NT=function(t){return t.replaceAll(" ","")},K6=function(t){const{value:s,fontSize:i,color:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||t.value!==s||t.fontSize!==i||t.color.some((a,l)=>a!==r[l])||t.pageIndex!==o},L(wn,Yl),We(wn,"_freeTextDefaultContent",""),We(wn,"_internalPadding",0),We(wn,"_defaultColor",null),We(wn,"_defaultFontSize",10),We(wn,"_type","freetext"),We(wn,"_editorType",Ct.FREETEXT);let AT=wn;class Ze{toSVGPath(){xn("Abstract method `toSVGPath` must be implemented.")}get box(){xn("Abstract getter `box` must be implemented.")}serialize(e,t){xn("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,i,r,o){o||(o=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a]*i,o[a+1]=s+e[a+1]*r;return o}static _rescaleAndSwap(e,t,s,i,r,o){o||(o=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a+1]*i,o[a+1]=s+e[a]*r;return o}static _translate(e,t,s,i){i||(i=new Float32Array(e.length));for(let r=0,o=e.length;r<o;r+=2)i[r]=t+e[r],i[r+1]=s+e[r+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,i,r){switch(r){case 90:return[1-t/s,e/i];case 180:return[1-e/s,1-t/i];case 270:return[t/s,1-e/i];default:return[e/s,t/i]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,i,r,o){return[(e+5*s)/6,(t+5*i)/6,(5*s+r)/6,(5*i+o)/6,(s+r)/2,(i+o)/2]}}We(Ze,"PRECISION",1e-4);var vr,Mo,nm,sm,wa,Rt,xh,bh,bb,yb,im,rm,md,vb,hS,fS,Ns,p0,Y6,J6,X6,Q6,Z6,eH;const ml=class ml{constructor({x:e,y:t},s,i,r,o,a=0){L(this,Ns);L(this,vr);L(this,Mo,[]);L(this,nm);L(this,sm);L(this,wa,[]);L(this,Rt,new Float32Array(18));L(this,xh);L(this,bh);L(this,bb);L(this,yb);L(this,im);L(this,rm);L(this,md,[]);z(this,vr,s),z(this,rm,r*i),z(this,sm,o),y(this,Rt).set([NaN,NaN,NaN,NaN,e,t],6),z(this,nm,a),z(this,yb,y(ml,vb)*i),z(this,bb,y(ml,fS)*i),z(this,im,i),y(this,md).push(e,t)}isEmpty(){return isNaN(y(this,Rt)[8])}add({x:e,y:t}){var V;z(this,xh,e),z(this,bh,t);const[s,i,r,o]=y(this,vr);let[a,l,u,f]=y(this,Rt).subarray(8,12);const p=e-u,g=t-f,b=Math.hypot(p,g);if(b<y(this,bb))return!1;const w=b-y(this,yb),S=w/b,N=S*p,C=S*g;let M=a,R=l;a=u,l=f,u+=N,f+=C,(V=y(this,md))==null||V.push(e,t);const _=-C/w,j=N/w,P=_*y(this,rm),D=j*y(this,rm);return y(this,Rt).set(y(this,Rt).subarray(2,8),0),y(this,Rt).set([u+P,f+D],4),y(this,Rt).set(y(this,Rt).subarray(14,18),12),y(this,Rt).set([u-P,f-D],16),isNaN(y(this,Rt)[6])?(y(this,wa).length===0&&(y(this,Rt).set([a+P,l+D],2),y(this,wa).push(NaN,NaN,NaN,NaN,(a+P-s)/r,(l+D-i)/o),y(this,Rt).set([a-P,l-D],14),y(this,Mo).push(NaN,NaN,NaN,NaN,(a-P-s)/r,(l-D-i)/o)),y(this,Rt).set([M,R,a,l,u,f],6),!this.isEmpty()):(y(this,Rt).set([M,R,a,l,u,f],6),Math.abs(Math.atan2(R-l,M-a)-Math.atan2(C,N))<Math.PI/2?([a,l,u,f]=y(this,Rt).subarray(2,6),y(this,wa).push(NaN,NaN,NaN,NaN,((a+u)/2-s)/r,((l+f)/2-i)/o),[a,l,M,R]=y(this,Rt).subarray(14,18),y(this,Mo).push(NaN,NaN,NaN,NaN,((M+a)/2-s)/r,((R+l)/2-i)/o),!0):([M,R,a,l,u,f]=y(this,Rt).subarray(0,6),y(this,wa).push(((M+5*a)/6-s)/r,((R+5*l)/6-i)/o,((5*a+u)/6-s)/r,((5*l+f)/6-i)/o,((a+u)/2-s)/r,((l+f)/2-i)/o),[u,f,a,l,M,R]=y(this,Rt).subarray(12,18),y(this,Mo).push(((M+5*a)/6-s)/r,((R+5*l)/6-i)/o,((5*a+u)/6-s)/r,((5*l+f)/6-i)/o,((a+u)/2-s)/r,((l+f)/2-i)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=y(this,wa),t=y(this,Mo);if(isNaN(y(this,Rt)[6])&&!this.isEmpty())return O(this,Ns,Y6).call(this);const s=[];s.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);O(this,Ns,X6).call(this,s);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return O(this,Ns,J6).call(this,s),s.join(" ")}newFreeDrawOutline(e,t,s,i,r,o){return new tH(e,t,s,i,r,o)}getOutlines(){var p;const e=y(this,wa),t=y(this,Mo),s=y(this,Rt),[i,r,o,a]=y(this,vr),l=new Float32Array((((p=y(this,md))==null?void 0:p.length)??0)+2);for(let g=0,b=l.length-2;g<b;g+=2)l[g]=(y(this,md)[g]-i)/o,l[g+1]=(y(this,md)[g+1]-r)/a;if(l[l.length-2]=(y(this,xh)-i)/o,l[l.length-1]=(y(this,bh)-r)/a,isNaN(s[6])&&!this.isEmpty())return O(this,Ns,Q6).call(this,l);const u=new Float32Array(y(this,wa).length+24+y(this,Mo).length);let f=e.length;for(let g=0;g<f;g+=2){if(isNaN(e[g])){u[g]=u[g+1]=NaN;continue}u[g]=e[g],u[g+1]=e[g+1]}f=O(this,Ns,eH).call(this,u,f);for(let g=t.length-6;g>=6;g-=6)for(let b=0;b<6;b+=2){if(isNaN(t[g+b])){u[f]=u[f+1]=NaN,f+=2;continue}u[f]=t[g+b],u[f+1]=t[g+b+1],f+=2}return O(this,Ns,Z6).call(this,u,f),this.newFreeDrawOutline(u,l,y(this,vr),y(this,im),y(this,nm),y(this,sm))}};vr=new WeakMap,Mo=new WeakMap,nm=new WeakMap,sm=new WeakMap,wa=new WeakMap,Rt=new WeakMap,xh=new WeakMap,bh=new WeakMap,bb=new WeakMap,yb=new WeakMap,im=new WeakMap,rm=new WeakMap,md=new WeakMap,vb=new WeakMap,hS=new WeakMap,fS=new WeakMap,Ns=new WeakSet,p0=function(){const e=y(this,Rt).subarray(4,6),t=y(this,Rt).subarray(16,18),[s,i,r,o]=y(this,vr);return[(y(this,xh)+(e[0]-t[0])/2-s)/r,(y(this,bh)+(e[1]-t[1])/2-i)/o,(y(this,xh)+(t[0]-e[0])/2-s)/r,(y(this,bh)+(t[1]-e[1])/2-i)/o]},Y6=function(){const[e,t,s,i]=y(this,vr),[r,o,a,l]=O(this,Ns,p0).call(this);return`M${(y(this,Rt)[2]-e)/s} ${(y(this,Rt)[3]-t)/i} L${(y(this,Rt)[4]-e)/s} ${(y(this,Rt)[5]-t)/i} L${r} ${o} L${a} ${l} L${(y(this,Rt)[16]-e)/s} ${(y(this,Rt)[17]-t)/i} L${(y(this,Rt)[14]-e)/s} ${(y(this,Rt)[15]-t)/i} Z`},J6=function(e){const t=y(this,Mo);e.push(`L${t[4]} ${t[5]} Z`)},X6=function(e){const[t,s,i,r]=y(this,vr),o=y(this,Rt).subarray(4,6),a=y(this,Rt).subarray(16,18),[l,u,f,p]=O(this,Ns,p0).call(this);e.push(`L${(o[0]-t)/i} ${(o[1]-s)/r} L${l} ${u} L${f} ${p} L${(a[0]-t)/i} ${(a[1]-s)/r}`)},Q6=function(e){const t=y(this,Rt),[s,i,r,o]=y(this,vr),[a,l,u,f]=O(this,Ns,p0).call(this),p=new Float32Array(36);return p.set([NaN,NaN,NaN,NaN,(t[2]-s)/r,(t[3]-i)/o,NaN,NaN,NaN,NaN,(t[4]-s)/r,(t[5]-i)/o,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,u,f,NaN,NaN,NaN,NaN,(t[16]-s)/r,(t[17]-i)/o,NaN,NaN,NaN,NaN,(t[14]-s)/r,(t[15]-i)/o],0),this.newFreeDrawOutline(p,e,y(this,vr),y(this,im),y(this,nm),y(this,sm))},Z6=function(e,t){const s=y(this,Mo);return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6},eH=function(e,t){const s=y(this,Rt).subarray(4,6),i=y(this,Rt).subarray(16,18),[r,o,a,l]=y(this,vr),[u,f,p,g]=O(this,Ns,p0).call(this);return e.set([NaN,NaN,NaN,NaN,(s[0]-r)/a,(s[1]-o)/l,NaN,NaN,NaN,NaN,u,f,NaN,NaN,NaN,NaN,p,g,NaN,NaN,NaN,NaN,(i[0]-r)/a,(i[1]-o)/l],t),t+=24},L(ml,vb,8),L(ml,hS,2),L(ml,fS,y(ml,vb)+y(ml,hS));let Kk=ml;var om,yh,Dl,wb,wr,kb,ns,pS,nH;class tH extends Ze{constructor(t,s,i,r,o,a){super();L(this,pS);L(this,om);L(this,yh,new Float32Array(4));L(this,Dl);L(this,wb);L(this,wr);L(this,kb);L(this,ns);z(this,ns,t),z(this,wr,s),z(this,om,i),z(this,kb,r),z(this,Dl,o),z(this,wb,a),this.lastPoint=[NaN,NaN],O(this,pS,nH).call(this,a);const[l,u,f,p]=y(this,yh);for(let g=0,b=t.length;g<b;g+=2)t[g]=(t[g]-l)/f,t[g+1]=(t[g+1]-u)/p;for(let g=0,b=s.length;g<b;g+=2)s[g]=(s[g]-l)/f,s[g+1]=(s[g+1]-u)/p}toSVGPath(){const t=[`M${y(this,ns)[4]} ${y(this,ns)[5]}`];for(let s=6,i=y(this,ns).length;s<i;s+=6){if(isNaN(y(this,ns)[s])){t.push(`L${y(this,ns)[s+4]} ${y(this,ns)[s+5]}`);continue}t.push(`C${y(this,ns)[s]} ${y(this,ns)[s+1]} ${y(this,ns)[s+2]} ${y(this,ns)[s+3]} ${y(this,ns)[s+4]} ${y(this,ns)[s+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,s,i,r],o){const a=i-t,l=r-s;let u,f;switch(o){case 0:u=Ze._rescale(y(this,ns),t,r,a,-l),f=Ze._rescale(y(this,wr),t,r,a,-l);break;case 90:u=Ze._rescaleAndSwap(y(this,ns),t,s,a,l),f=Ze._rescaleAndSwap(y(this,wr),t,s,a,l);break;case 180:u=Ze._rescale(y(this,ns),i,s,-a,l),f=Ze._rescale(y(this,wr),i,s,-a,l);break;case 270:u=Ze._rescaleAndSwap(y(this,ns),i,r,-a,-l),f=Ze._rescaleAndSwap(y(this,wr),i,r,-a,-l);break}return{outline:Array.from(u),points:[Array.from(f)]}}get box(){return y(this,yh)}newOutliner(t,s,i,r,o,a=0){return new Kk(t,s,i,r,o,a)}getNewOutline(t,s){const[i,r,o,a]=y(this,yh),[l,u,f,p]=y(this,om),g=o*f,b=a*p,w=i*f+l,S=r*p+u,N=this.newOutliner({x:y(this,wr)[0]*g+w,y:y(this,wr)[1]*b+S},y(this,om),y(this,kb),t,y(this,wb),s??y(this,Dl));for(let C=2;C<y(this,wr).length;C+=2)N.add({x:y(this,wr)[C]*g+w,y:y(this,wr)[C+1]*b+S});return N.getOutlines()}}om=new WeakMap,yh=new WeakMap,Dl=new WeakMap,wb=new WeakMap,wr=new WeakMap,kb=new WeakMap,ns=new WeakMap,pS=new WeakSet,nH=function(t){const s=y(this,ns);let i=s[4],r=s[5],o=i,a=r,l=i,u=r,f=i,p=r;const g=t?Math.max:Math.min;for(let w=6,S=s.length;w<S;w+=6){if(isNaN(s[w]))o=Math.min(o,s[w+4]),a=Math.min(a,s[w+5]),l=Math.max(l,s[w+4]),u=Math.max(u,s[w+5]),p<s[w+5]?(f=s[w+4],p=s[w+5]):p===s[w+5]&&(f=g(f,s[w+4]));else{const N=rt.bezierBoundingBox(i,r,...s.slice(w,w+6));o=Math.min(o,N[0]),a=Math.min(a,N[1]),l=Math.max(l,N[2]),u=Math.max(u,N[3]),p<N[3]?(f=N[2],p=N[3]):p===N[3]&&(f=g(f,N[2]))}i=s[w+4],r=s[w+5]}const b=y(this,yh);b[0]=o-y(this,Dl),b[1]=a-y(this,Dl),b[2]=l-o+2*y(this,Dl),b[3]=u-a+2*y(this,Dl),this.lastPoint=[f,p]};var Sb,Cb,gd,Ro,ji,sH,Aw,iH,rH,TT;class ET{constructor(e,t=0,s=0,i=!0){L(this,ji);L(this,Sb);L(this,Cb);L(this,gd,[]);L(this,Ro,[]);let r=1/0,o=-1/0,a=1/0,l=-1/0;const u=10**-4;for(const{x:N,y:C,width:M,height:R}of e){const _=Math.floor((N-t)/u)*u,j=Math.ceil((N+M+t)/u)*u,P=Math.floor((C-t)/u)*u,D=Math.ceil((C+R+t)/u)*u,U=[_,P,D,!0],V=[j,P,D,!1];y(this,gd).push(U,V),r=Math.min(r,_),o=Math.max(o,j),a=Math.min(a,P),l=Math.max(l,D)}const f=o-r+2*s,p=l-a+2*s,g=r-s,b=a-s,w=y(this,gd).at(i?-1:-2),S=[w[0],w[2]];for(const N of y(this,gd)){const[C,M,R]=N;N[0]=(C-g)/f,N[1]=(M-b)/p,N[2]=(R-b)/p}z(this,Sb,new Float32Array([g,b,f,p])),z(this,Cb,S)}getOutlines(){y(this,gd).sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of y(this,gd))t[3]?(e.push(...O(this,ji,TT).call(this,t)),O(this,ji,iH).call(this,t)):(O(this,ji,rH).call(this,t),e.push(...O(this,ji,TT).call(this,t)));return O(this,ji,sH).call(this,e)}}Sb=new WeakMap,Cb=new WeakMap,gd=new WeakMap,Ro=new WeakMap,ji=new WeakSet,sH=function(e){const t=[],s=new Set;for(const o of e){const[a,l,u]=o;t.push([a,l,o],[a,u,o])}t.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=t.length;o<a;o+=2){const l=t[o][2],u=t[o+1][2];l.push(u),u.push(l),s.add(l),s.add(u)}const i=[];let r;for(;s.size>0;){const o=s.values().next().value;let[a,l,u,f,p]=o;s.delete(o);let g=a,b=l;for(r=[a,u],i.push(r);;){let w;if(s.has(f))w=f;else if(s.has(p))w=p;else break;s.delete(w),[a,l,u,f,p]=w,g!==a&&(r.push(g,b,a,b===l?l:u),g=a),b=b===l?u:l}r.push(g,b)}return new Ade(i,y(this,Sb),y(this,Cb))},Aw=function(e){const t=y(this,Ro);let s=0,i=t.length-1;for(;s<=i;){const r=s+i>>1,o=t[r][0];if(o===e)return r;o<e?s=r+1:i=r-1}return i+1},iH=function([,e,t]){const s=O(this,ji,Aw).call(this,e);y(this,Ro).splice(s,0,[e,t])},rH=function([,e,t]){const s=O(this,ji,Aw).call(this,e);for(let i=s;i<y(this,Ro).length;i++){const[r,o]=y(this,Ro)[i];if(r!==e)break;if(r===e&&o===t){y(this,Ro).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[r,o]=y(this,Ro)[i];if(r!==e)break;if(r===e&&o===t){y(this,Ro).splice(i,1);return}}},TT=function(e){const[t,s,i]=e,r=[[t,s,i]],o=O(this,ji,Aw).call(this,i);for(let a=0;a<o;a++){const[l,u]=y(this,Ro)[a];for(let f=0,p=r.length;f<p;f++){const[,g,b]=r[f];if(!(u<=g||b<=l)){if(g>=l){if(b>u)r[f][1]=u;else{if(p===1)return[];r.splice(f,1),f--,p--}continue}r[f][2]=l,b>u&&r.push([t,u,b])}}}return r};var Ab,am;class Ade extends Ze{constructor(t,s,i){super();L(this,Ab);L(this,am);z(this,am,t),z(this,Ab,s),this.lastPoint=i}toSVGPath(){const t=[];for(const s of y(this,am)){let[i,r]=s;t.push(`M${i} ${r}`);for(let o=2;o<s.length;o+=2){const a=s[o],l=s[o+1];a===i?(t.push(`V${l}`),r=l):l===r&&(t.push(`H${a}`),i=a)}t.push("Z")}return t.join(" ")}serialize([t,s,i,r],o){const a=[],l=i-t,u=r-s;for(const f of y(this,am)){const p=new Array(f.length);for(let g=0;g<f.length;g+=2)p[g]=t+f[g]*l,p[g+1]=r-f[g+1]*u;a.push(p)}return a}get box(){return y(this,Ab)}get classNamesForOutlining(){return["highlightOutline"]}}Ab=new WeakMap,am=new WeakMap;class _T extends Kk{newFreeDrawOutline(e,t,s,i,r,o){return new Nde(e,t,s,i,r,o)}}class Nde extends tH{newOutliner(e,t,s,i,r,o=0){return new _T(e,t,s,i,r,o)}}var Io,vh,lm,As,Nb,cm,Eb,Tb,xd,zo,dm,_b,hn,MT,RT,IT,vu,oH,Uc;const Ki=class Ki{constructor({editor:e=null,uiManager:t=null}){L(this,hn);L(this,Io,null);L(this,vh,null);L(this,lm);L(this,As,null);L(this,Nb,!1);L(this,cm,!1);L(this,Eb,null);L(this,Tb);L(this,xd,null);L(this,zo,null);L(this,dm);var s;e?(z(this,cm,!1),z(this,dm,$t.HIGHLIGHT_COLOR),z(this,Eb,e)):(z(this,cm,!0),z(this,dm,$t.HIGHLIGHT_DEFAULT_COLOR)),z(this,zo,(e==null?void 0:e._uiManager)||t),z(this,Tb,y(this,zo)._eventBus),z(this,lm,(e==null?void 0:e.color)||((s=y(this,zo))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),y(Ki,_b)||z(Ki,_b,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return It(this,"_keyboardManager",new Wb([[["Escape","mac+Escape"],Ki.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Ki.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Ki.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Ki.prototype._moveToPrevious],[["Home","mac+Home"],Ki.prototype._moveToBeginning],[["End","mac+End"],Ki.prototype._moveToEnd]]))}renderButton(){const e=z(this,Io,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=y(this,zo)._signal;e.addEventListener("click",O(this,hn,vu).bind(this),{signal:t}),e.addEventListener("keydown",O(this,hn,IT).bind(this),{signal:t});const s=z(this,vh,document.createElement("span"));return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=y(this,lm),e.append(s),e}renderMainDropdown(){const e=z(this,As,O(this,hn,MT).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===y(this,Io)){O(this,hn,vu).call(this,e);return}const t=e.target.getAttribute("data-color");t&&O(this,hn,RT).call(this,t,e)}_moveToNext(e){var t,s;if(!y(this,hn,Uc)){O(this,hn,vu).call(this,e);return}if(e.target===y(this,Io)){(t=y(this,As).firstChild)==null||t.focus();return}(s=e.target.nextSibling)==null||s.focus()}_moveToPrevious(e){var t,s;if(e.target===((t=y(this,As))==null?void 0:t.firstChild)||e.target===y(this,Io)){y(this,hn,Uc)&&this._hideDropdownFromKeyboard();return}y(this,hn,Uc)||O(this,hn,vu).call(this,e),(s=e.target.previousSibling)==null||s.focus()}_moveToBeginning(e){var t;if(!y(this,hn,Uc)){O(this,hn,vu).call(this,e);return}(t=y(this,As).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!y(this,hn,Uc)){O(this,hn,vu).call(this,e);return}(t=y(this,As).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=y(this,As))==null||e.classList.add("hidden"),(t=y(this,xd))==null||t.abort(),z(this,xd,null)}_hideDropdownFromKeyboard(){var e;if(!y(this,cm)){if(!y(this,hn,Uc)){(e=y(this,Eb))==null||e.unselect();return}this.hideDropdown(),y(this,Io).focus({preventScroll:!0,focusVisible:y(this,Nb)})}}updateColor(e){if(y(this,vh)&&(y(this,vh).style.backgroundColor=e),!y(this,As))return;const t=y(this,zo).highlightColors.values();for(const s of y(this,As).children)s.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=y(this,Io))==null||e.remove(),z(this,Io,null),z(this,vh,null),(t=y(this,As))==null||t.remove(),z(this,As,null)}};Io=new WeakMap,vh=new WeakMap,lm=new WeakMap,As=new WeakMap,Nb=new WeakMap,cm=new WeakMap,Eb=new WeakMap,Tb=new WeakMap,xd=new WeakMap,zo=new WeakMap,dm=new WeakMap,_b=new WeakMap,hn=new WeakSet,MT=function(){const e=document.createElement("div"),t=y(this,zo)._signal;e.addEventListener("contextmenu",Uo,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[s,i]of y(this,zo).highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",i),r.title=s,r.setAttribute("data-l10n-id",y(Ki,_b)[s]);const o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=i,r.setAttribute("aria-selected",i===y(this,lm)),r.addEventListener("click",O(this,hn,RT).bind(this,i),{signal:t}),e.append(r)}return e.addEventListener("keydown",O(this,hn,IT).bind(this),{signal:t}),e},RT=function(e,t){t.stopPropagation(),y(this,Tb).dispatch("switchannotationeditorparams",{source:this,type:y(this,dm),value:e})},IT=function(e){Ki._keyboardManager.exec(this,e)},vu=function(e){if(y(this,hn,Uc)){this.hideDropdown();return}if(z(this,Nb,e.detail===0),y(this,xd)||(z(this,xd,new AbortController),window.addEventListener("pointerdown",O(this,hn,oH).bind(this),{signal:y(this,zo).combinedSignal(y(this,xd))})),y(this,As)){y(this,As).classList.remove("hidden");return}const t=z(this,As,O(this,hn,MT).call(this));y(this,Io).append(t)},oH=function(e){var t;(t=y(this,As))!=null&&t.contains(e.target)||this.hideDropdown()},Uc=function(){return y(this,As)&&!y(this,As).classList.contains("hidden")},L(Ki,_b,null);let Yk=Ki;var um,Mb,jl,wh,hm,Xi,Rb,Ib,kh,Xr,kr,Qs,fm,Pl,fi,pm,Qr,zb,wt,zT,Nw,aH,lH,cH,DT,wu,ro,op,dH,Ew,m0,uH,hH,fH,pH,mH;const tn=class tn extends Fn{constructor(t){super({...t,name:"highlightEditor"});L(this,wt);L(this,um,null);L(this,Mb,0);L(this,jl);L(this,wh,null);L(this,hm,null);L(this,Xi,null);L(this,Rb,null);L(this,Ib,0);L(this,kh,null);L(this,Xr,null);L(this,kr,null);L(this,Qs,!1);L(this,fm,null);L(this,Pl);L(this,fi,null);L(this,pm,"");L(this,Qr);L(this,zb,"");this.color=t.color||tn._defaultColor,z(this,Qr,t.thickness||tn._defaultThickness),z(this,Pl,t.opacity||tn._defaultOpacity),z(this,jl,t.boxes||null),z(this,zb,t.methodOfCreation||""),z(this,pm,t.text||""),this._isDraggable=!1,t.highlightId>-1?(z(this,Qs,!0),O(this,wt,Nw).call(this,t),O(this,wt,wu).call(this)):y(this,jl)&&(z(this,um,t.anchorNode),z(this,Mb,t.anchorOffset),z(this,Rb,t.focusNode),z(this,Ib,t.focusOffset),O(this,wt,zT).call(this),O(this,wt,wu).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=tn.prototype;return It(this,"_keyboardManager",new Wb([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:y(this,Qs)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:y(this,Qr),methodOfCreation:y(this,zb)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,s){var i;Fn.initialize(t,s),tn._defaultColor||(tn._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,s){switch(t){case $t.HIGHLIGHT_DEFAULT_COLOR:tn._defaultColor=s;break;case $t.HIGHLIGHT_THICKNESS:tn._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return y(this,fm)}updateParams(t,s){switch(t){case $t.HIGHLIGHT_COLOR:O(this,wt,aH).call(this,s);break;case $t.HIGHLIGHT_THICKNESS:O(this,wt,lH).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[$t.HIGHLIGHT_DEFAULT_COLOR,tn._defaultColor],[$t.HIGHLIGHT_THICKNESS,tn._defaultThickness]]}get propertiesToUpdate(){return[[$t.HIGHLIGHT_COLOR,this.color||tn._defaultColor],[$t.HIGHLIGHT_THICKNESS,y(this,Qr)||tn._defaultThickness],[$t.HIGHLIGHT_FREE,y(this,Qs)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(z(this,hm,new Yk({editor:this})),t.addColorPicker(y(this,hm))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(O(this,wt,m0).call(this))}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,O(this,wt,m0).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){O(this,wt,DT).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(O(this,wt,wu).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?O(this,wt,DT).call(this):t&&(O(this,wt,wu).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var r,o,a;const{drawLayer:s}=this.parent;let i;y(this,Qs)?(t=(t-this.rotation+360)%360,i=O(r=tn,ro,op).call(r,y(this,Xr).box,t)):i=O(o=tn,ro,op).call(o,[this.x,this.y,this.width,this.height],t),s.updateProperties(y(this,kr),{bbox:i,root:{"data-main-rotation":t}}),s.updateProperties(y(this,fi),{bbox:O(a=tn,ro,op).call(a,y(this,Xi).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();y(this,pm)&&(t.setAttribute("aria-label",y(this,pm)),t.setAttribute("role","mark")),y(this,Qs)?t.classList.add("free"):this.div.addEventListener("keydown",O(this,wt,dH).bind(this),{signal:this._uiManager._signal});const s=z(this,kh,document.createElement("div"));t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=y(this,wh);const[i,r]=this.parentDimensions;return this.setDims(this.width*i,this.height*r),Vk(this,y(this,kh),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(y(this,fi),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(y(this,fi),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:O(this,wt,Ew).call(this,!0);break;case 1:case 3:O(this,wt,Ew).call(this,!1);break}}select(){var t;super.select(),y(this,fi)&&((t=this.parent)==null||t.drawLayer.updateProperties(y(this,fi),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),y(this,fi)&&((t=this.parent)==null||t.drawLayer.updateProperties(y(this,fi),{rootClass:{selected:!1}}),y(this,Qs)||O(this,wt,Ew).call(this,!1))}get _mustFixPosition(){return!y(this,Qs)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(y(this,kr),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(y(this,fi),{rootClass:{hidden:!t}}))}static startHighlighting(t,s,{target:i,x:r,y:o}){const{x:a,y:l,width:u,height:f}=i.getBoundingClientRect(),p=new AbortController,g=t.combinedSignal(p),b=w=>{p.abort(),O(this,ro,pH).call(this,t,w)};window.addEventListener("blur",b,{signal:g}),window.addEventListener("pointerup",b,{signal:g}),window.addEventListener("pointerdown",Rr,{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",Uo,{signal:g}),i.addEventListener("pointermove",O(this,ro,fH).bind(this,t),{signal:g}),this._freeHighlight=new _T({x:r,y:o},[a,l,u,f],t.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,s,i){var S,N,C,M;let r=null;if(t instanceof H6){const{data:{quadPoints:R,rect:_,rotation:j,id:P,color:D,opacity:U,popupRef:V},parent:{page:{pageNumber:q}}}=t;r=t={annotationType:Ct.HIGHLIGHT,color:Array.from(D),opacity:U,quadPoints:R,boxes:null,pageIndex:q-1,rect:_.slice(0),rotation:j,id:P,deleted:!1,popupRef:V}}else if(t instanceof O2){const{data:{inkLists:R,rect:_,rotation:j,id:P,color:D,borderStyle:{rawWidth:U},popupRef:V},parent:{page:{pageNumber:q}}}=t;r=t={annotationType:Ct.HIGHLIGHT,color:Array.from(D),thickness:U,inkLists:R,boxes:null,pageIndex:q-1,rect:_.slice(0),rotation:j,id:P,deleted:!1,popupRef:V}}const{color:o,quadPoints:a,inkLists:l,opacity:u}=t,f=await super.deserialize(t,s,i);f.color=rt.makeHexColor(...o),z(f,Pl,u||1),l&&z(f,Qr,t.thickness),f.annotationElementId=t.id||null,f._initialData=r;const[p,g]=f.pageDimensions,[b,w]=f.pageTranslation;if(a){const R=z(f,jl,[]);for(let _=0;_<a.length;_+=8)R.push({x:(a[_]-b)/p,y:1-(a[_+1]-w)/g,width:(a[_+2]-a[_])/p,height:(a[_+1]-a[_+5])/g});O(S=f,wt,zT).call(S),O(N=f,wt,wu).call(N),f.rotate(f.rotation)}else if(l){z(f,Qs,!0);const R=l[0],_={x:R[0]-b,y:g-(R[1]-w)},j=new _T(_,[0,0,p,g],1,y(f,Qr)/2,!0,.001);for(let U=0,V=R.length;U<V;U+=2)_.x=R[U]-b,_.y=g-(R[U+1]-w),j.add(_);const{id:P,clipPathId:D}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:f.color,"fill-opacity":f._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:j.toSVGPath()}},!0,!0);O(C=f,wt,Nw).call(C,{highlightOutlines:j.getOutlines(),highlightId:P,clipPathId:D}),O(M=f,wt,wu).call(M)}return f}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const s=this.getRect(0,0),i=Fn._colorManager.convert(this.color),r={annotationType:Ct.HIGHLIGHT,color:i,opacity:y(this,Pl),thickness:y(this,Qr),quadPoints:O(this,wt,uH).call(this),outlines:O(this,wt,hH).call(this,s),pageIndex:this.pageIndex,rect:s,rotation:O(this,wt,m0).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!O(this,wt,mH).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};um=new WeakMap,Mb=new WeakMap,jl=new WeakMap,wh=new WeakMap,hm=new WeakMap,Xi=new WeakMap,Rb=new WeakMap,Ib=new WeakMap,kh=new WeakMap,Xr=new WeakMap,kr=new WeakMap,Qs=new WeakMap,fm=new WeakMap,Pl=new WeakMap,fi=new WeakMap,pm=new WeakMap,Qr=new WeakMap,zb=new WeakMap,wt=new WeakSet,zT=function(){const t=new ET(y(this,jl),.001);z(this,Xr,t.getOutlines()),[this.x,this.y,this.width,this.height]=y(this,Xr).box;const s=new ET(y(this,jl),.0025,.001,this._uiManager.direction==="ltr");z(this,Xi,s.getOutlines());const{lastPoint:i}=y(this,Xi);z(this,fm,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])},Nw=function({highlightOutlines:t,highlightId:s,clipPathId:i}){var p,g;if(z(this,Xr,t),z(this,Xi,t.getNewOutline(y(this,Qr)/2+1.5,.0025)),s>=0)z(this,kr,s),z(this,wh,i),this.parent.drawLayer.finalizeDraw(s,{bbox:t.box,path:{d:t.toSVGPath()}}),z(this,fi,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:y(this,Xi).box,path:{d:y(this,Xi).toSVGPath()}},!0));else if(this.parent){const b=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(y(this,kr),{bbox:O(p=tn,ro,op).call(p,y(this,Xr).box,(b-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(y(this,fi),{bbox:O(g=tn,ro,op).call(g,y(this,Xi).box,b),path:{d:y(this,Xi).toSVGPath()}})}const[o,a,l,u]=t.box;switch(this.rotation){case 0:this.x=o,this.y=a,this.width=l,this.height=u;break;case 90:{const[b,w]=this.parentDimensions;this.x=a,this.y=1-o,this.width=l*w/b,this.height=u*b/w;break}case 180:this.x=1-o,this.y=1-a,this.width=l,this.height=u;break;case 270:{const[b,w]=this.parentDimensions;this.x=1-a,this.y=o,this.width=l*w/b,this.height=u*b/w;break}}const{lastPoint:f}=y(this,Xi);z(this,fm,[(f[0]-o)/l,(f[1]-a)/u])},aH=function(t){const s=(o,a)=>{var l,u;this.color=o,z(this,Pl,a),(l=this.parent)==null||l.drawLayer.updateProperties(y(this,kr),{root:{fill:o,"fill-opacity":a}}),(u=y(this,hm))==null||u.updateColor(o)},i=this.color,r=y(this,Pl);this.addCommands({cmd:s.bind(this,t,tn._defaultOpacity),undo:s.bind(this,i,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:$t.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},lH=function(t){const s=y(this,Qr),i=r=>{z(this,Qr,r),O(this,wt,cH).call(this,r)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:$t.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},cH=function(t){if(!y(this,Qs))return;O(this,wt,Nw).call(this,{highlightOutlines:y(this,Xr).getNewOutline(t/2)}),this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)},DT=function(){y(this,kr)===null||!this.parent||(this.parent.drawLayer.remove(y(this,kr)),z(this,kr,null),this.parent.drawLayer.remove(y(this,fi)),z(this,fi,null))},wu=function(t=this.parent){y(this,kr)===null&&({id:Ni(this,kr)._,clipPathId:Ni(this,wh)._}=t.drawLayer.draw({bbox:y(this,Xr).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":y(this,Pl)},rootClass:{highlight:!0,free:y(this,Qs)},path:{d:y(this,Xr).toSVGPath()}},!1,!0),z(this,fi,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:y(this,Qs)},bbox:y(this,Xi).box,path:{d:y(this,Xi).toSVGPath()}},y(this,Qs))),y(this,kh)&&(y(this,kh).style.clipPath=y(this,wh)))},ro=new WeakSet,op=function([t,s,i,r],o){switch(o){case 90:return[1-s-r,t,r,i];case 180:return[1-t-i,1-s-r,i,r];case 270:return[s,1-t-i,r,i]}return[t,s,i,r]},dH=function(t){tn._keyboardManager.exec(this,t)},Ew=function(t){if(!y(this,um))return;const s=window.getSelection();t?s.setPosition(y(this,um),y(this,Mb)):s.setPosition(y(this,Rb),y(this,Ib))},m0=function(){return y(this,Qs)?this.rotation:0},uH=function(){if(y(this,Qs))return null;const[t,s]=this.pageDimensions,[i,r]=this.pageTranslation,o=y(this,jl),a=new Float32Array(o.length*8);let l=0;for(const{x:u,y:f,width:p,height:g}of o){const b=u*t+i,w=(1-f)*s+r;a[l]=a[l+4]=b,a[l+1]=a[l+3]=w,a[l+2]=a[l+6]=b+p*t,a[l+5]=a[l+7]=w-g*s,l+=8}return a},hH=function(t){return y(this,Xr).serialize(t,O(this,wt,m0).call(this))},fH=function(t,s){this._freeHighlight.add(s)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},pH=function(t,s){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},mH=function(t){const{color:s}=this._initialData;return t.color.some((i,r)=>i!==s[r])},L(tn,ro),We(tn,"_defaultColor",null),We(tn,"_defaultOpacity",1),We(tn,"_defaultThickness",12),We(tn,"_type","highlight"),We(tn,"_editorType",Ct.HIGHLIGHT),We(tn,"_freeHighlightId",-1),We(tn,"_freeHighlight",null),We(tn,"_freeHighlightClipId","");let Jk=tn;var Sh;class Ede{constructor(){L(this,Sh,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))this.updateProperty(t,s)}updateSVGProperty(e,t){y(this,Sh)[e]=t}toSVGProperties(){const e=y(this,Sh);return z(this,Sh,Object.create(null)),{root:e}}reset(){z(this,Sh,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){xn("Not implemented")}}Sh=new WeakMap;var Sr,mm,Ps,Ch,Ah,bd,yd,vd,Nh,Vt,PT,LT,OT,g0,gH,Tw,x0,ap;const tt=class tt extends Fn{constructor(t){super(t);L(this,Vt);L(this,Sr,null);L(this,mm);We(this,"_drawId",null);z(this,mm,t.mustBeCommitted||!1),t.drawOutlines&&(O(this,Vt,PT).call(this,t),O(this,Vt,g0).call(this))}static _mergeSVGProperties(t,s){const i=new Set(Object.keys(t));for(const[r,o]of Object.entries(s))i.has(r)?Object.assign(t[r],o):t[r]=o;return t}static getDefaultDrawingOptions(t){xn("Not implemented")}static get typesMap(){xn("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,s){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,s),this._currentParent&&(y(tt,Ps).updateProperty(i,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,s){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,s)}static get defaultPropertiesToUpdate(){const t=[],s=this._defaultDrawingOptions;for(const[i,r]of this.typesMap)t.push([i,s[r]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:s}=this;for(const[i,r]of this.constructor.typesMap)t.push([i,s[r]]);return t}_updateProperty(t,s,i){const r=this._drawingOptions,o=r[s],a=l=>{var f;r.updateProperty(s,l);const u=y(this,Sr).updateProperty(s,l);u&&O(this,Vt,x0).call(this,u),(f=this.parent)==null||f.drawLayer.updateProperties(this._drawId,r.toSVGProperties())};this.addCommands({cmd:a.bind(this,i),undo:a.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,tt._mergeSVGProperties(y(this,Sr).getPathResizingSVGProperties(O(this,Vt,Tw).call(this)),{bbox:O(this,Vt,ap).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,tt._mergeSVGProperties(y(this,Sr).getPathResizedSVGProperties(O(this,Vt,Tw).call(this)),{bbox:O(this,Vt,ap).call(this)}))}_onTranslating(t,s){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:O(this,Vt,ap).call(this,t,s)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,tt._mergeSVGProperties(y(this,Sr).getPathTranslatedSVGProperties(O(this,Vt,Tw).call(this),this.parentDimensions),{bbox:O(this,Vt,ap).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,y(this,mm)&&(z(this,mm,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){O(this,Vt,OT).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(O(this,Vt,g0).call(this),O(this,Vt,x0).call(this,y(this,Sr).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),O(this,Vt,OT).call(this)):t&&(this._uiManager.addShouldRescale(this),O(this,Vt,g0).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,tt._mergeSVGProperties({bbox:O(this,Vt,ap).call(this)},y(this,Sr).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&O(this,Vt,x0).call(this,y(this,Sr).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;const t=super.render();t.classList.add("draw");const s=document.createElement("div");t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal";const[i,r]=this.parentDimensions;return this.setDims(this.width*i,this.height*r),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,s,i,r,o){xn("Not implemented")}static startDrawing(t,s,i,r){var N;const{target:o,offsetX:a,offsetY:l,pointerId:u,pointerType:f}=r;if(y(tt,yd)&&y(tt,yd)!==f)return;const{viewport:{rotation:p}}=t,{width:g,height:b}=o.getBoundingClientRect(),w=z(tt,Ch,new AbortController),S=t.combinedSignal(w);if(y(tt,bd)||z(tt,bd,u),y(tt,yd)??z(tt,yd,f),window.addEventListener("pointerup",C=>{var M;y(tt,bd)===C.pointerId?this._endDraw(C):(M=y(tt,vd))==null||M.delete(C.pointerId)},{signal:S}),window.addEventListener("pointercancel",C=>{var M;y(tt,bd)===C.pointerId?this._currentParent.endDrawingSession():(M=y(tt,vd))==null||M.delete(C.pointerId)},{signal:S}),window.addEventListener("pointerdown",C=>{y(tt,yd)===C.pointerType&&((y(tt,vd)||z(tt,vd,new Set)).add(C.pointerId),y(tt,Ps).isCancellable()&&(y(tt,Ps).removeLastElement(),y(tt,Ps).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:S}),window.addEventListener("contextmenu",Uo,{signal:S}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:S}),o.addEventListener("touchmove",C=>{C.timeStamp===y(tt,Nh)&&Rr(C)},{signal:S}),t.toggleDrawing(),(N=s._editorUndoBar)==null||N.hide(),y(tt,Ps)){t.drawLayer.updateProperties(this._currentDrawId,y(tt,Ps).startNew(a,l,g,b,p));return}s.updateUIForDefaultProperties(this),z(tt,Ps,this.createDrawerInstance(a,l,g,b,p)),z(tt,Ah,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(y(tt,Ah).toSVGProperties(),y(tt,Ps).defaultSVGProperties),!0,!1)}static _drawMove(t){var o;if(z(tt,Nh,-1),!y(tt,Ps))return;const{offsetX:s,offsetY:i,pointerId:r}=t;if(y(tt,bd)===r){if(((o=y(tt,vd))==null?void 0:o.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,y(tt,Ps).add(s,i)),z(tt,Nh,t.timeStamp),Rr(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,z(tt,Ps,null),z(tt,Ah,null),z(tt,yd,null),z(tt,Nh,NaN)),y(tt,Ch)&&(y(tt,Ch).abort(),z(tt,Ch,null),z(tt,bd,NaN),z(tt,vd,null))}static _endDraw(t){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),t&&s.drawLayer.updateProperties(this._currentDrawId,y(tt,Ps).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=y(tt,Ps),r=this._currentDrawId,o=i.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(r,i.setLastElement(o))},undo:()=>{s.drawLayer.updateProperties(r,i.removeLastElement())},mustExec:!1,type:$t.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack($t.DRAW_STEP),!y(tt,Ps).isEmpty()){const{pageDimensions:[i,r],scale:o}=s,a=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:y(tt,Ps).getOutlines(i*o,r*o,o,this._INNER_MARGIN),drawingOptions:y(tt,Ah),mustBeCommitted:!t});return this._cleanup(!0),a}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,s,i,r,o,a){xn("Not implemented")}static async deserialize(t,s,i){var p,g;const{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:l}}=s.viewport,u=this.deserializeDraw(a,l,r,o,this._INNER_MARGIN,t),f=await super.deserialize(t,s,i);return f.createDrawingOptions(t),O(p=f,Vt,PT).call(p,{drawOutlines:u}),O(g=f,Vt,g0).call(g),f.onScaleChanging(),f.rotate(),f}serializeDraw(t){const[s,i]=this.pageTranslation,[r,o]=this.pageDimensions;return y(this,Sr).serialize([s,i,r,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Sr=new WeakMap,mm=new WeakMap,Ps=new WeakMap,Ch=new WeakMap,Ah=new WeakMap,bd=new WeakMap,yd=new WeakMap,vd=new WeakMap,Nh=new WeakMap,Vt=new WeakSet,PT=function({drawOutlines:t,drawId:s,drawingOptions:i}){z(this,Sr,t),this._drawingOptions||(this._drawingOptions=i),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)):this._drawId=O(this,Vt,LT).call(this,t,this.parent),O(this,Vt,x0).call(this,t.box)},LT=function(t,s){const{id:i}=s.drawLayer.draw(tt._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},OT=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},g0=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=O(this,Vt,LT).call(this,y(this,Sr),t)}},gH=function([t,s,i,r]){const{parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[s,1-t,i*(a/o),r*(o/a)];case 180:return[1-t,1-s,i,r];case 270:return[1-s,t,i*(a/o),r*(o/a)];default:return[t,s,i,r]}},Tw=function(){const{x:t,y:s,width:i,height:r,parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[1-s,t,i*(o/a),r*(a/o)];case 180:return[1-t,1-s,i,r];case 270:return[s,1-t,i*(o/a),r*(a/o)];default:return[t,s,i,r]}},x0=function(t){if([this.x,this.y,this.width,this.height]=O(this,Vt,gH).call(this,t),this.div){this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)}this._onResized()},ap=function(){const{x:t,y:s,width:i,height:r,rotation:o,parentRotation:a,parentDimensions:[l,u]}=this;switch((o*4+a)/90){case 1:return[1-s-r,t,r,i];case 2:return[1-t-i,1-s-r,i,r];case 3:return[s,1-t-i,r,i];case 4:return[t,s-i*(l/u),r*(u/l),i*(l/u)];case 5:return[1-s,t,i*(l/u),r*(u/l)];case 6:return[1-t-r*(u/l),1-s,r*(u/l),i*(l/u)];case 7:return[s-i*(l/u),1-t-r*(u/l),i*(l/u),r*(u/l)];case 8:return[t-i,s-r,i,r];case 9:return[1-s,t-i,r,i];case 10:return[1-t,1-s,i,r];case 11:return[s-r,1-t,r,i];case 12:return[t-r*(u/l),s,r*(u/l),i*(l/u)];case 13:return[1-s-i*(l/u),t-r*(u/l),i*(l/u),r*(u/l)];case 14:return[1-t,1-s-i*(l/u),r*(u/l),i*(l/u)];case 15:return[s,1-t,i*(l/u),r*(u/l)];default:return[t,s,i,r]}},We(tt,"_currentDrawId",-1),We(tt,"_currentParent",null),L(tt,Ps,null),L(tt,Ch,null),L(tt,Ah,null),L(tt,bd,NaN),L(tt,yd,null),L(tt,vd,null),L(tt,Nh,NaN),We(tt,"_INNER_MARGIN",3);let jT=tt;var ka,Ls,Os,Eh,gm,_i,Zs,Zr,Th,_h,Mh,xm,_w;class Tde{constructor(e,t,s,i,r,o){L(this,xm);L(this,ka,new Float64Array(6));L(this,Ls);L(this,Os);L(this,Eh);L(this,gm);L(this,_i);L(this,Zs,"");L(this,Zr,0);L(this,Th,new Xk);L(this,_h);L(this,Mh);z(this,_h,s),z(this,Mh,i),z(this,Eh,r),z(this,gm,o),[e,t]=O(this,xm,_w).call(this,e,t);const a=z(this,Ls,[NaN,NaN,NaN,NaN,e,t]);z(this,_i,[e,t]),z(this,Os,[{line:a,points:y(this,_i)}]),y(this,ka).set(a,0)}updateProperty(e,t){e==="stroke-width"&&z(this,gm,t)}isEmpty(){return!y(this,Os)||y(this,Os).length===0}isCancellable(){return y(this,_i).length<=10}add(e,t){[e,t]=O(this,xm,_w).call(this,e,t);const[s,i,r,o]=y(this,ka).subarray(2,6),a=e-r,l=t-o;return Math.hypot(y(this,_h)*a,y(this,Mh)*l)<=2?null:(y(this,_i).push(e,t),isNaN(s)?(y(this,ka).set([r,o,e,t],2),y(this,Ls).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(y(this,ka)[0])&&y(this,Ls).splice(6,6),y(this,ka).set([s,i,r,o,e,t],0),y(this,Ls).push(...Ze.createBezierPoints(s,i,r,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(y(this,_i).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,i,r){z(this,_h,s),z(this,Mh,i),z(this,Eh,r),[e,t]=O(this,xm,_w).call(this,e,t);const o=z(this,Ls,[NaN,NaN,NaN,NaN,e,t]);z(this,_i,[e,t]);const a=y(this,Os).at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),y(this,Os).push({line:o,points:y(this,_i)}),y(this,ka).set(o,0),z(this,Zr,0),this.toSVGPath(),null}getLastElement(){return y(this,Os).at(-1)}setLastElement(e){return y(this,Os)?(y(this,Os).push(e),z(this,Ls,e.line),z(this,_i,e.points),z(this,Zr,0),{path:{d:this.toSVGPath()}}):y(this,Th).setLastElement(e)}removeLastElement(){if(!y(this,Os))return y(this,Th).removeLastElement();y(this,Os).pop(),z(this,Zs,"");for(let e=0,t=y(this,Os).length;e<t;e++){const{line:s,points:i}=y(this,Os)[e];z(this,Ls,s),z(this,_i,i),z(this,Zr,0),this.toSVGPath()}return{path:{d:y(this,Zs)}}}toSVGPath(){const e=Ze.svgRound(y(this,Ls)[4]),t=Ze.svgRound(y(this,Ls)[5]);if(y(this,_i).length===2)return z(this,Zs,`${y(this,Zs)} M ${e} ${t} Z`),y(this,Zs);if(y(this,_i).length<=6){const i=y(this,Zs).lastIndexOf("M");z(this,Zs,`${y(this,Zs).slice(0,i)} M ${e} ${t}`),z(this,Zr,6)}if(y(this,_i).length===4){const i=Ze.svgRound(y(this,Ls)[10]),r=Ze.svgRound(y(this,Ls)[11]);return z(this,Zs,`${y(this,Zs)} L ${i} ${r}`),z(this,Zr,12),y(this,Zs)}const s=[];y(this,Zr)===0&&(s.push(`M ${e} ${t}`),z(this,Zr,6));for(let i=y(this,Zr),r=y(this,Ls).length;i<r;i+=6){const[o,a,l,u,f,p]=y(this,Ls).slice(i,i+6).map(Ze.svgRound);s.push(`C${o} ${a} ${l} ${u} ${f} ${p}`)}return z(this,Zs,y(this,Zs)+s.join(" ")),z(this,Zr,y(this,Ls).length),y(this,Zs)}getOutlines(e,t,s,i){const r=y(this,Os).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),y(this,Th).build(y(this,Os),e,t,s,y(this,Eh),y(this,gm),i),z(this,ka,null),z(this,Ls,null),z(this,Os,null),z(this,Zs,null),y(this,Th)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}ka=new WeakMap,Ls=new WeakMap,Os=new WeakMap,Eh=new WeakMap,gm=new WeakMap,_i=new WeakMap,Zs=new WeakMap,Zr=new WeakMap,Th=new WeakMap,_h=new WeakMap,Mh=new WeakMap,xm=new WeakSet,_w=function(e,t){return Ze._normalizePoint(e,t,y(this,_h),y(this,Mh),y(this,Eh))};var Mi,Db,jb,Cr,Sa,Ca,bm,ym,vm,ni,hl,xH,bH,yH;const $2=class $2 extends Ze{constructor(){super(...arguments);L(this,ni);L(this,Mi);L(this,Db,0);L(this,jb);L(this,Cr);L(this,Sa);L(this,Ca);L(this,bm);L(this,ym);L(this,vm)}build(t,s,i,r,o,a,l){z(this,Sa,s),z(this,Ca,i),z(this,bm,r),z(this,ym,o),z(this,vm,a),z(this,jb,l??0),z(this,Cr,t),O(this,ni,bH).call(this)}setLastElement(t){return y(this,Cr).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return y(this,Cr).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:s}of y(this,Cr)){if(t.push(`M${Ze.svgRound(s[4])} ${Ze.svgRound(s[5])}`),s.length===6){t.push("Z");continue}if(s.length===12){t.push(`L${Ze.svgRound(s[10])} ${Ze.svgRound(s[11])}`);continue}for(let i=6,r=s.length;i<r;i+=6){const[o,a,l,u,f,p]=s.subarray(i,i+6).map(Ze.svgRound);t.push(`C${o} ${a} ${l} ${u} ${f} ${p}`)}}return t.join("")}serialize([t,s,i,r],o){const a=[],l=[],[u,f,p,g]=O(this,ni,xH).call(this);let b,w,S,N,C,M,R,_,j;switch(y(this,ym)){case 0:j=Ze._rescale,b=t,w=s+r,S=i,N=-r,C=t+u*i,M=s+(1-f-g)*r,R=t+(u+p)*i,_=s+(1-f)*r;break;case 90:j=Ze._rescaleAndSwap,b=t,w=s,S=i,N=r,C=t+f*i,M=s+u*r,R=t+(f+g)*i,_=s+(u+p)*r;break;case 180:j=Ze._rescale,b=t+i,w=s,S=-i,N=r,C=t+(1-u-p)*i,M=s+f*r,R=t+(1-u)*i,_=s+(f+g)*r;break;case 270:j=Ze._rescaleAndSwap,b=t+i,w=s+r,S=-i,N=-r,C=t+(1-f-g)*i,M=s+(1-u-p)*r,R=t+(1-f)*i,_=s+(1-u)*r;break}for(const{line:P,points:D}of y(this,Cr))a.push(j(P,b,w,S,N,o?new Array(P.length):null)),l.push(j(D,b,w,S,N,o?new Array(D.length):null));return{lines:a,points:l,rect:[C,M,R,_]}}static deserialize(t,s,i,r,o,{paths:{lines:a,points:l},rotation:u,thickness:f}){const p=[];let g,b,w,S,N;switch(u){case 0:N=Ze._rescale,g=-t/i,b=s/r+1,w=1/i,S=-1/r;break;case 90:N=Ze._rescaleAndSwap,g=-s/r,b=-t/i,w=1/r,S=1/i;break;case 180:N=Ze._rescale,g=t/i+1,b=-s/r,w=-1/i,S=1/r;break;case 270:N=Ze._rescaleAndSwap,g=s/r+1,b=t/i+1,w=-1/r,S=-1/i;break}if(!a){a=[];for(const M of l){const R=M.length;if(R===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,M[0],M[1]]));continue}if(R===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,M[0],M[1],NaN,NaN,NaN,NaN,M[2],M[3]]));continue}const _=new Float32Array(3*(R-2));a.push(_);let[j,P,D,U]=M.subarray(0,4);_.set([NaN,NaN,NaN,NaN,j,P],0);for(let V=4;V<R;V+=2){const q=M[V],G=M[V+1];_.set(Ze.createBezierPoints(j,P,D,U,q,G),(V-2)*3),[j,P,D,U]=[D,U,q,G]}}}for(let M=0,R=a.length;M<R;M++)p.push({line:N(a[M].map(_=>_??NaN),g,b,w,S),points:N(l[M].map(_=>_??NaN),g,b,w,S)});const C=new $2;return C.build(p,i,r,1,u,f,o),C}get box(){return y(this,Mi)}updateProperty(t,s){return t==="stroke-width"?O(this,ni,yH).call(this,s):null}updateParentDimensions([t,s],i){const[r,o]=O(this,ni,hl).call(this);z(this,Sa,t),z(this,Ca,s),z(this,bm,i);const[a,l]=O(this,ni,hl).call(this),u=a-r,f=l-o,p=y(this,Mi);return p[0]-=u,p[1]-=f,p[2]+=2*u,p[3]+=2*f,p}updateRotation(t){return z(this,Db,t),{path:{transform:this.rotationTransform}}}get viewBox(){return y(this,Mi).map(Ze.svgRound).join(" ")}get defaultProperties(){const[t,s]=y(this,Mi);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ze.svgRound(t)} ${Ze.svgRound(s)}`}}}get rotationTransform(){const[,,t,s]=y(this,Mi);let i=0,r=0,o=0,a=0,l=0,u=0;switch(y(this,Db)){case 90:r=s/t,o=-t/s,l=t;break;case 180:i=-1,a=-1,l=t,u=s;break;case 270:r=-s/t,o=t/s,u=s;break;default:return""}return`matrix(${i} ${r} ${o} ${a} ${Ze.svgRound(l)} ${Ze.svgRound(u)})`}getPathResizingSVGProperties([t,s,i,r]){const[o,a]=O(this,ni,hl).call(this),[l,u,f,p]=y(this,Mi);if(Math.abs(f-o)<=Ze.PRECISION||Math.abs(p-a)<=Ze.PRECISION){const N=t+i/2-(l+f/2),C=s+r/2-(u+p/2);return{path:{"transform-origin":`${Ze.svgRound(t)} ${Ze.svgRound(s)}`,transform:`${this.rotationTransform} translate(${N} ${C})`}}}const g=(i-2*o)/(f-2*o),b=(r-2*a)/(p-2*a),w=f/i,S=p/r;return{path:{"transform-origin":`${Ze.svgRound(l)} ${Ze.svgRound(u)}`,transform:`${this.rotationTransform} scale(${w} ${S}) translate(${Ze.svgRound(o)} ${Ze.svgRound(a)}) scale(${g} ${b}) translate(${Ze.svgRound(-o)} ${Ze.svgRound(-a)})`}}}getPathResizedSVGProperties([t,s,i,r]){const[o,a]=O(this,ni,hl).call(this),l=y(this,Mi),[u,f,p,g]=l;if(l[0]=t,l[1]=s,l[2]=i,l[3]=r,Math.abs(p-o)<=Ze.PRECISION||Math.abs(g-a)<=Ze.PRECISION){const C=t+i/2-(u+p/2),M=s+r/2-(f+g/2);for(const{line:R,points:_}of y(this,Cr))Ze._translate(R,C,M,R),Ze._translate(_,C,M,_);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ze.svgRound(t)} ${Ze.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const b=(i-2*o)/(p-2*o),w=(r-2*a)/(g-2*a),S=-b*(u+o)+t+o,N=-w*(f+a)+s+a;if(b!==1||w!==1||S!==0||N!==0)for(const{line:C,points:M}of y(this,Cr))Ze._rescale(C,S,N,b,w,C),Ze._rescale(M,S,N,b,w,M);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ze.svgRound(t)} ${Ze.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,s],i){const[r,o]=i,a=y(this,Mi),l=t-a[0],u=s-a[1];if(y(this,Sa)===r&&y(this,Ca)===o)for(const{line:f,points:p}of y(this,Cr))Ze._translate(f,l,u,f),Ze._translate(p,l,u,p);else{const f=y(this,Sa)/r,p=y(this,Ca)/o;z(this,Sa,r),z(this,Ca,o);for(const{line:g,points:b}of y(this,Cr))Ze._rescale(g,l,u,f,p,g),Ze._rescale(b,l,u,f,p,b);a[2]*=f,a[3]*=p}return a[0]=t,a[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Ze.svgRound(t)} ${Ze.svgRound(s)}`}}}get defaultSVGProperties(){const t=y(this,Mi);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Ze.svgRound(t[0])} ${Ze.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};Mi=new WeakMap,Db=new WeakMap,jb=new WeakMap,Cr=new WeakMap,Sa=new WeakMap,Ca=new WeakMap,bm=new WeakMap,ym=new WeakMap,vm=new WeakMap,ni=new WeakSet,hl=function(t=y(this,vm)){const s=y(this,jb)+t/2*y(this,bm);return y(this,ym)%180===0?[s/y(this,Sa),s/y(this,Ca)]:[s/y(this,Ca),s/y(this,Sa)]},xH=function(){const[t,s,i,r]=y(this,Mi),[o,a]=O(this,ni,hl).call(this,0);return[t+o,s+a,i-2*o,r-2*a]},bH=function(){const t=z(this,Mi,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:r}of y(this,Cr)){if(r.length<=12){for(let l=4,u=r.length;l<u;l+=6){const[f,p]=r.subarray(l,l+2);t[0]=Math.min(t[0],f),t[1]=Math.min(t[1],p),t[2]=Math.max(t[2],f),t[3]=Math.max(t[3],p)}continue}let o=r[4],a=r[5];for(let l=6,u=r.length;l<u;l+=6){const[f,p,g,b,w,S]=r.subarray(l,l+6);rt.bezierBoundingBox(o,a,f,p,g,b,w,S,t),o=w,a=S}}const[s,i]=O(this,ni,hl).call(this);t[0]=Math.min(1,Math.max(0,t[0]-s)),t[1]=Math.min(1,Math.max(0,t[1]-i)),t[2]=Math.min(1,Math.max(0,t[2]+s)),t[3]=Math.min(1,Math.max(0,t[3]+i)),t[2]-=t[0],t[3]-=t[1]},yH=function(t){const[s,i]=O(this,ni,hl).call(this);z(this,vm,t);const[r,o]=O(this,ni,hl).call(this),[a,l]=[r-s,o-i],u=y(this,Mi);return u[0]-=a,u[1]-=l,u[2]+=2*a,u[3]+=2*l,u};let Xk=$2;var wm;const G2=class G2 extends Ede{constructor(t){super();L(this,wm);z(this,wm,t),super.updateProperties({fill:"none",stroke:Fn._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,s){t==="stroke-width"&&(s??(s=this["stroke-width"]),s*=y(this,wm).realScale),super.updateSVGProperty(t,s)}clone(){const t=new G2(y(this,wm));return t.updateAll(this),t}};wm=new WeakMap;let BT=G2;var mS,vH;const fp=class fp extends jT{constructor(t){super({...t,name:"inkEditor"});L(this,mS);this._willKeepAspectRatio=!0}static initialize(t,s){Fn.initialize(t,s),this._defaultDrawingOptions=new BT(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return It(this,"typesMap",new Map([[$t.INK_THICKNESS,"stroke-width"],[$t.INK_COLOR,"stroke"],[$t.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,s,i,r,o){return new Tde(t,s,i,r,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,s,i,r,o,a){return Xk.deserialize(t,s,i,r,o,a)}static async deserialize(t,s,i){let r=null;if(t instanceof O2){const{data:{inkLists:a,rect:l,rotation:u,id:f,color:p,opacity:g,borderStyle:{rawWidth:b},popupRef:w},parent:{page:{pageNumber:S}}}=t;r=t={annotationType:Ct.INK,color:Array.from(p),thickness:b,opacity:g,paths:{points:a},boxes:null,pageIndex:S-1,rect:l.slice(0),rotation:u,id:f,deleted:!1,popupRef:w}}const o=await super.deserialize(t,s,i);return o.annotationElementId=t.id||null,o._initialData=r,o}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:s,parent:i}=this;s.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:s,opacity:i}){this._drawingOptions=fp.getDefaultDrawingOptions({stroke:rt.makeHexColor(...t),"stroke-width":s,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:i,rect:r}=this.serializeDraw(t),{_drawingOptions:{stroke:o,"stroke-opacity":a,"stroke-width":l}}=this,u={annotationType:Ct.INK,color:Fn._colorManager.convert(o),opacity:a,thickness:l,paths:{lines:s,points:i},pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?u:this.annotationElementId&&!O(this,mS,vH).call(this,u)?null:(u.id=this.annotationElementId,u)}renderAnnotationElement(t){const{points:s,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:s}),null}};mS=new WeakSet,vH=function(t){const{color:s,thickness:i,opacity:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((a,l)=>a!==s[l])||t.thickness!==i||t.opacity!==r||t.pageIndex!==o},We(fp,"_type","ink"),We(fp,"_editorType",Ct.INK),We(fp,"_defaultDrawingOptions",null);let FT=fp;var On,ei,wd,Ll,kd,km,Aa,Na,Ar,Sm,Yt,b0,y0,Mw,UT,Rw,$T,Iw,wH;const O0=class O0 extends Fn{constructor(t){super({...t,name:"stampEditor"});L(this,Yt);L(this,On,null);L(this,ei,null);L(this,wd,null);L(this,Ll,null);L(this,kd,null);L(this,km,"");L(this,Aa,null);L(this,Na,null);L(this,Ar,!1);L(this,Sm,!1);z(this,Ll,t.bitmapUrl),z(this,kd,t.bitmapFile)}static initialize(t,s){Fn.initialize(t,s)}static get supportedTypes(){return It(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(s=>`image/${s}`))}static get supportedTypesStr(){return It(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,s){s.pasteEditor(Ct.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(t=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:o,height:a}=t||this.copyCanvas(null,null,!0).imageData,l=await i.guess({name:"altText",request:{data:r,width:o,height:a,channels:r.length/(o*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const u=l.output;return await this.setGuessedAltText(u),s&&!this.hasAltTextData()&&(this.altTextData={alt:u,decorative:!1}),u}remove(){var t;y(this,ei)&&(z(this,On,null),this._uiManager.imageManager.deleteId(y(this,ei)),(t=y(this,Aa))==null||t.remove(),z(this,Aa,null),y(this,Na)&&(clearTimeout(y(this,Na)),z(this,Na,null))),super.remove()}rebuild(){if(!this.parent){y(this,ei)&&O(this,Yt,Mw).call(this);return}super.rebuild(),this.div!==null&&(y(this,ei)&&y(this,Aa)===null&&O(this,Yt,Mw).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(y(this,wd)||y(this,On)||y(this,Ll)||y(this,kd)||y(this,ei))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,s;if(this.width&&(t=this.x,s=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),y(this,On)?O(this,Yt,UT).call(this):O(this,Yt,Mw).call(this),this.width&&!this.annotationElementId){const[i,r]=this.parentDimensions;this.setAt(t*i,s*r,this.width*i,this.height*r)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;y(this,Na)!==null&&clearTimeout(y(this,Na)),z(this,Na,setTimeout(()=>{z(this,Na,null),O(this,Yt,$T).call(this)},200))}copyCanvas(t,s,i=!1){var b;t||(t=224);const{width:r,height:o}=y(this,On),a=new BE;let l=y(this,On),u=r,f=o,p=null;if(s){if(r>s||o>s){const U=Math.min(s/r,s/o);u=Math.floor(r*U),f=Math.floor(o*U)}p=document.createElement("canvas");const w=p.width=Math.ceil(u*a.sx),S=p.height=Math.ceil(f*a.sy);y(this,Ar)||(l=O(this,Yt,Rw).call(this,w,S));const N=p.getContext("2d");N.filter=this._uiManager.hcmFilter;let C="white",M="#cfcfd8";this._uiManager.hcmFilter!=="none"?M="black":(b=window.matchMedia)!=null&&b.call(window,"(prefers-color-scheme: dark)").matches&&(C="#8f8f9d",M="#42414d");const R=15,_=R*a.sx,j=R*a.sy,P=new OffscreenCanvas(_*2,j*2),D=P.getContext("2d");D.fillStyle=C,D.fillRect(0,0,_*2,j*2),D.fillStyle=M,D.fillRect(0,0,_,j),D.fillRect(_,j,_,j),N.fillStyle=N.createPattern(P,"repeat"),N.fillRect(0,0,w,S),N.drawImage(l,0,0,l.width,l.height,0,0,w,S)}let g=null;if(i){let w,S;if(a.symmetric&&l.width<t&&l.height<t)w=l.width,S=l.height;else if(l=y(this,On),r>t||o>t){const M=Math.min(t/r,t/o);w=Math.floor(r*M),S=Math.floor(o*M),y(this,Ar)||(l=O(this,Yt,Rw).call(this,w,S))}const C=new OffscreenCanvas(w,S).getContext("2d",{willReadFrequently:!0});C.drawImage(l,0,0,l.width,l.height,0,0,w,S),g={width:w,height:S,data:C.getImageData(0,0,w,S).data}}return{canvas:p,width:u,height:f,imageData:g}}getImageForAltText(){return y(this,Aa)}static async deserialize(t,s,i){var S;let r=null;if(t instanceof U6){const{data:{rect:N,rotation:C,id:M,structParent:R,popupRef:_},container:j,parent:{page:{pageNumber:P}}}=t,D=j.querySelector("canvas"),U=i.imageManager.getFromCanvas(j.id,D);D.remove();const V=((S=await s._structTree.getAriaAttributes(`${M2}${M}`))==null?void 0:S.get("aria-label"))||"";r=t={annotationType:Ct.STAMP,bitmapId:U.id,bitmap:U.bitmap,pageIndex:P-1,rect:N.slice(0),rotation:C,id:M,deleted:!1,accessibilityData:{decorative:!1,altText:V},isSvg:!1,structParent:R,popupRef:_}}const o=await super.deserialize(t,s,i),{rect:a,bitmap:l,bitmapUrl:u,bitmapId:f,isSvg:p,accessibilityData:g}=t;f&&i.imageManager.isValidId(f)?(z(o,ei,f),l&&z(o,On,l)):z(o,Ll,u),z(o,Ar,p);const[b,w]=o.pageDimensions;return o.width=(a[2]-a[0])/b,o.height=(a[3]-a[1])/w,o.annotationElementId=t.id||null,g&&(o.altTextData=g),o._initialData=r,z(o,Sm,!!r),o}serialize(t=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i={annotationType:Ct.STAMP,bitmapId:y(this,ei),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:y(this,Ar),structTreeParentId:this._structTreeParentId};if(t)return i.bitmapUrl=O(this,Yt,Iw).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i;const{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(i.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const l=O(this,Yt,wH).call(this,i);if(l.isSame)return null;l.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,s===null)return i;s.stamps||(s.stamps=new Map);const a=y(this,Ar)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(y(this,ei)))s.stamps.set(y(this,ei),{area:a,serialized:i}),i.bitmap=O(this,Yt,Iw).call(this,!1);else if(y(this,Ar)){const l=s.stamps.get(y(this,ei));a>l.area&&(l.area=a,l.serialized.bitmap.close(),l.serialized.bitmap=O(this,Yt,Iw).call(this,!1))}return i}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};On=new WeakMap,ei=new WeakMap,wd=new WeakMap,Ll=new WeakMap,kd=new WeakMap,km=new WeakMap,Aa=new WeakMap,Na=new WeakMap,Ar=new WeakMap,Sm=new WeakMap,Yt=new WeakSet,b0=function(t,s=!1){if(!t){this.remove();return}z(this,On,t.bitmap),s||(z(this,ei,t.id),z(this,Ar,t.isSvg)),t.file&&z(this,km,t.file.name),O(this,Yt,UT).call(this)},y0=function(){if(z(this,wd,null),this._uiManager.enableWaiting(!1),!!y(this,Aa)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&y(this,On)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&y(this,On)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Mw=function(){if(y(this,ei)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(y(this,ei)).then(i=>O(this,Yt,b0).call(this,i,!0)).finally(()=>O(this,Yt,y0).call(this));return}if(y(this,Ll)){const i=y(this,Ll);z(this,Ll,null),this._uiManager.enableWaiting(!0),z(this,wd,this._uiManager.imageManager.getFromUrl(i).then(r=>O(this,Yt,b0).call(this,r)).finally(()=>O(this,Yt,y0).call(this)));return}if(y(this,kd)){const i=y(this,kd);z(this,kd,null),this._uiManager.enableWaiting(!0),z(this,wd,this._uiManager.imageManager.getFromFile(i).then(r=>O(this,Yt,b0).call(this,r)).finally(()=>O(this,Yt,y0).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=O0.supportedTypesStr;const s=this._uiManager._signal;z(this,wd,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),O(this,Yt,b0).call(this,r)}i()},{signal:s}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>O(this,Yt,y0).call(this))),t.click()},UT=function(){var p;const{div:t}=this;let{width:s,height:i}=y(this,On);const[r,o]=this.pageDimensions,a=.75;if(this.width)s=this.width*r,i=this.height*o;else if(s>a*r||i>a*o){const g=Math.min(a*r/s,a*o/i);s*=g,i*=g}const[l,u]=this.parentDimensions;this.setDims(s*l/r,i*u/o),this._uiManager.enableWaiting(!1);const f=z(this,Aa,document.createElement("canvas"));f.setAttribute("role","img"),this.addContainer(f),this.width=s/r,this.height=i/o,(p=this._initialOptions)!=null&&p.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),O(this,Yt,$T).call(this),y(this,Sm)||(this.parent.addUndoableEditor(this),z(this,Sm,!0)),this._reportTelemetry({action:"inserted_image"}),y(this,km)&&f.setAttribute("aria-label",y(this,km))},Rw=function(t,s){const{width:i,height:r}=y(this,On);let o=i,a=r,l=y(this,On);for(;o>2*t||a>2*s;){const u=o,f=a;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),a>2*s&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));const p=new OffscreenCanvas(o,a);p.getContext("2d").drawImage(l,0,0,u,f,0,0,o,a),l=p.transferToImageBitmap()}return l},$T=function(){const[t,s]=this.parentDimensions,{width:i,height:r}=this,o=new BE,a=Math.ceil(i*t*o.sx),l=Math.ceil(r*s*o.sy),u=y(this,Aa);if(!u||u.width===a&&u.height===l)return;u.width=a,u.height=l;const f=y(this,Ar)?y(this,On):O(this,Yt,Rw).call(this,a,l),p=u.getContext("2d");p.filter=this._uiManager.hcmFilter,p.drawImage(f,0,0,f.width,f.height,0,0,a,l)},Iw=function(t){if(t){if(y(this,Ar)){const r=this._uiManager.imageManager.getSvgUrl(y(this,ei));if(r)return r}const s=document.createElement("canvas");return{width:s.width,height:s.height}=y(this,On),s.getContext("2d").drawImage(y(this,On),0,0),s.toDataURL()}if(y(this,Ar)){const[s,i]=this.pageDimensions,r=Math.round(this.width*s*Bd.PDF_TO_CSS_UNITS),o=Math.round(this.height*i*Bd.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(r,o);return a.getContext("2d").drawImage(y(this,On),0,0,y(this,On).width,y(this,On).height,0,0,r,o),a.transferToImageBitmap()}return structuredClone(y(this,On))},wH=function(t){var a;const{pageIndex:s,accessibilityData:{altText:i}}=this._initialData,r=t.pageIndex===s,o=(((a=t.accessibilityData)==null?void 0:a.alt)||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&r&&o,isSameAltText:o}},We(O0,"_type","stamp"),We(O0,"_editorType",Ct.STAMP);let HT=O0;var Rh,Cm,Ea,Sd,Ol,eo,Cd,Am,Ih,Do,Bl,pi,Fl,it,Ad,jn,kH,aa,VT,qT,zw;const ko=class ko{constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:i,accessibilityManager:r,annotationLayer:o,drawLayer:a,textLayer:l,viewport:u,l10n:f}){L(this,jn);L(this,Rh);L(this,Cm,!1);L(this,Ea,null);L(this,Sd,null);L(this,Ol,null);L(this,eo,new Map);L(this,Cd,!1);L(this,Am,!1);L(this,Ih,!1);L(this,Do,null);L(this,Bl,null);L(this,pi,null);L(this,Fl,null);L(this,it);const p=[...y(ko,Ad).values()];if(!ko._initialized){ko._initialized=!0;for(const g of p)g.initialize(f,e)}e.registerEditorTypes(p),z(this,it,e),this.pageIndex=t,this.div=s,z(this,Rh,r),z(this,Ea,o),this.viewport=u,z(this,pi,l),this.drawLayer=a,this._structTree=i,y(this,it).addLayer(this)}get isEmpty(){return y(this,eo).size===0}get isInvisible(){return this.isEmpty&&y(this,it).getMode()===Ct.NONE}updateToolbar(e){y(this,it).updateToolbar(e)}updateMode(e=y(this,it).getMode()){switch(O(this,jn,zw).call(this),e){case Ct.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Ct.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Ct.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const s of y(ko,Ad).values())t.toggle(`${s._type}Editing`,e===s._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=y(this,pi))==null?void 0:t.div)}setEditingState(e){y(this,it).setEditingState(e)}addCommands(e){y(this,it).addCommands(e)}cleanUndoStack(e){y(this,it).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=y(this,Ea))==null||t.div.classList.toggle("disabled",!e)}async enable(){z(this,Ih,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const s of y(this,eo).values())s.enableEditing(),s.show(!0),s.annotationElementId&&(y(this,it).removeChangedExistingAnnotation(s),e.add(s.annotationElementId));if(!y(this,Ea)){z(this,Ih,!1);return}const t=y(this,Ea).getEditableAnnotations();for(const s of t){if(s.hide(),y(this,it).isDeletedAnnotationElement(s.data.id)||e.has(s.data.id))continue;const i=await this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}z(this,Ih,!1)}disable(){var i;z(this,Am,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const r of y(this,eo).values())if(r.disableEditing(),!!r.annotationElementId){if(r.serialize()!==null){e.set(r.annotationElementId,r);continue}else t.set(r.annotationElementId,r);(i=this.getEditableAnnotation(r.annotationElementId))==null||i.show(),r.remove()}if(y(this,Ea)){const r=y(this,Ea).getEditableAnnotations();for(const o of r){const{id:a}=o.data;if(y(this,it).isDeletedAnnotationElement(a))continue;let l=t.get(a);if(l){l.resetAnnotationElement(o),l.show(!1),o.show();continue}l=e.get(a),l&&(y(this,it).addChangedExistingAnnotation(l),l.renderAnnotationElement(o)&&l.show(!1)),o.show()}}O(this,jn,zw).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const r of y(ko,Ad).values())s.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),z(this,Am,!1)}getEditableAnnotation(e){var t;return((t=y(this,Ea))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){y(this,it).getActive()!==e&&y(this,it).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=y(this,pi))!=null&&e.div&&!y(this,Fl)){z(this,Fl,new AbortController);const t=y(this,it).combinedSignal(y(this,Fl));y(this,pi).div.addEventListener("pointerdown",O(this,jn,kH).bind(this),{signal:t}),y(this,pi).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=y(this,pi))!=null&&e.div&&y(this,Fl)&&(y(this,Fl).abort(),z(this,Fl,null),y(this,pi).div.classList.remove("highlighting"))}enableClick(){if(y(this,Sd))return;z(this,Sd,new AbortController);const e=y(this,it).combinedSignal(y(this,Sd));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=y(this,Sd))==null||e.abort(),z(this,Sd,null)}attach(e){y(this,eo).set(e.id,e);const{annotationElementId:t}=e;t&&y(this,it).isDeletedAnnotationElement(t)&&y(this,it).removeDeletedAnnotationElement(e)}detach(e){var t;y(this,eo).delete(e.id),(t=y(this,Rh))==null||t.removePointerInTextLayer(e.contentDiv),!y(this,Am)&&e.annotationElementId&&y(this,it).addDeletedAnnotationElement(e)}remove(e){this.detach(e),y(this,it).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(y(this,it).addDeletedAnnotationElement(e.annotationElementId),Fn.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),y(this,it).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!y(this,Ih)),y(this,it).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var s;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!y(this,Ol)&&(e._focusEventsAllowed=!1,z(this,Ol,setTimeout(()=>{z(this,Ol,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:y(this,it)._signal}),t.focus())},0))),e._structTreeParentId=(s=y(this,Rh))==null?void 0:s.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getNextId(){return y(this,it).getId()}combinedSignal(e){return y(this,it).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=y(this,jn,aa))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){y(this,it).updateToolbar(e),y(this,it).updateMode(e);const{offsetX:s,offsetY:i}=O(this,jn,qT).call(this),r=this.getNextId(),o=O(this,jn,VT).call(this,{parent:this,id:r,x:s,y:i,uiManager:y(this,it),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){var t;return await((t=y(ko,Ad).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,y(this,it)))||null}createAndAddNewEditor(e,t,s={}){const i=this.getNextId(),r=O(this,jn,VT).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:y(this,it),isCentered:t,...s});return r&&this.add(r),r}addNewEditor(){this.createAndAddNewEditor(O(this,jn,qT).call(this),!0)}setSelected(e){y(this,it).setSelected(e)}toggleSelected(e){y(this,it).toggleSelected(e)}unselect(e){y(this,it).unselect(e)}pointerup(e){var s;const{isMac:t}=zi.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&y(this,Cd)&&(z(this,Cd,!1),!((s=y(this,jn,aa))!=null&&s.isDrawer&&y(this,jn,aa).supportMultipleDrawings))){if(!y(this,Cm)){z(this,Cm,!0);return}if(y(this,it).getMode()===Ct.STAMP){y(this,it).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){var i;if(y(this,it).getMode()===Ct.HIGHLIGHT&&this.enableTextSelection(),y(this,Cd)){z(this,Cd,!1);return}const{isMac:t}=zi.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(z(this,Cd,!0),(i=y(this,jn,aa))!=null&&i.isDrawer){this.startDrawingSession(e);return}const s=y(this,it).getActive();z(this,Cm,!s||s.isEmpty())}startDrawingSession(e){if(this.div.focus(),y(this,Do)){y(this,jn,aa).startDrawing(this,y(this,it),!1,e);return}y(this,it).setCurrentDrawingSession(this),z(this,Do,new AbortController);const t=y(this,it).combinedSignal(y(this,Do));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(z(this,Bl,null),this.commitOrRemove())},{signal:t}),y(this,jn,aa).startDrawing(this,y(this,it),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&z(this,Bl,t);return}y(this,Bl)&&setTimeout(()=>{var t;(t=y(this,Bl))==null||t.focus(),z(this,Bl,null)},0)}endDrawingSession(e=!1){return y(this,Do)?(y(this,it).setCurrentDrawingSession(null),y(this,Do).abort(),z(this,Do,null),z(this,Bl,null),y(this,jn,aa).endDrawing(e)):null}findNewParent(e,t,s){const i=y(this,it).findParent(t,s);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return y(this,Do)?(this.endDrawingSession(),!0):!1}onScaleChanging(){y(this,Do)&&y(this,jn,aa).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=y(this,it).getActive())==null?void 0:e.parent)===this&&(y(this,it).commitOrRemove(),y(this,it).setActiveEditor(null)),y(this,Ol)&&(clearTimeout(y(this,Ol)),z(this,Ol,null));for(const s of y(this,eo).values())(t=y(this,Rh))==null||t.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,y(this,eo).clear(),y(this,it).removeLayer(this)}render({viewport:e}){this.viewport=e,Jh(this.div,e);for(const t of y(this,it).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){y(this,it).commitOrRemove(),O(this,jn,zw).call(this);const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,Jh(this.div,{rotation:s}),t!==s)for(const i of y(this,eo).values())i.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return y(this,it).viewParameters.realScale}};Rh=new WeakMap,Cm=new WeakMap,Ea=new WeakMap,Sd=new WeakMap,Ol=new WeakMap,eo=new WeakMap,Cd=new WeakMap,Am=new WeakMap,Ih=new WeakMap,Do=new WeakMap,Bl=new WeakMap,pi=new WeakMap,Fl=new WeakMap,it=new WeakMap,Ad=new WeakMap,jn=new WeakSet,kH=function(e){y(this,it).unselectAll();const{target:t}=e;if(t===y(this,pi).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&y(this,pi).div.contains(t)){const{isMac:s}=zi.platform;if(e.button!==0||e.ctrlKey&&s)return;y(this,it).showAllEditors("highlight",!0,!0),y(this,pi).div.classList.add("free"),this.toggleDrawing(),Jk.startHighlighting(this,y(this,it).direction==="ltr",{target:y(this,pi).div,x:e.x,y:e.y}),y(this,pi).div.addEventListener("pointerup",()=>{y(this,pi).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:y(this,it)._signal}),e.preventDefault()}},aa=function(){return y(ko,Ad).get(y(this,it).getMode())},VT=function(e){const t=y(this,jn,aa);return t?new t.prototype.constructor(e):null},qT=function(){const{x:e,y:t,width:s,height:i}=this.div.getBoundingClientRect(),r=Math.max(0,e),o=Math.max(0,t),a=Math.min(window.innerWidth,e+s),l=Math.min(window.innerHeight,t+i),u=(r+a)/2-e,f=(o+l)/2-t,[p,g]=this.viewport.rotation%180===0?[u,f]:[f,u];return{offsetX:p,offsetY:g}},zw=function(){for(const e of y(this,eo).values())e.isEmpty()&&e.remove()},We(ko,"_initialized",!1),L(ko,Ad,new Map([AT,FT,HT,Jk].map(e=>[e._editorType,e])));let GT=ko;var jo,Pb,Ri,zh,gS,SH,La,KT,CH,YT;const di=class di{constructor({pageIndex:e}){L(this,La);L(this,jo,null);L(this,Pb,0);L(this,Ri,new Map);L(this,zh,new Map);this.pageIndex=e}setParent(e){if(!y(this,jo)){z(this,jo,e);return}if(y(this,jo)!==e){if(y(this,Ri).size>0)for(const t of y(this,Ri).values())t.remove(),e.append(t);z(this,jo,e)}}static get _svgFactory(){return It(this,"_svgFactory",new L2)}draw(e,t=!1,s=!1){const i=Ni(this,Pb)._++,r=O(this,La,KT).call(this),o=di._svgFactory.createElement("defs");r.append(o);const a=di._svgFactory.createElement("path");o.append(a);const l=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),t&&y(this,zh).set(i,a);const u=s?O(this,La,CH).call(this,o,l):null,f=di._svgFactory.createElement("use");return r.append(f),f.setAttribute("href",`#${l}`),this.updateProperties(r,e),y(this,Ri).set(i,r),{id:i,clipPathId:`url(#${u})`}}drawOutline(e,t){const s=Ni(this,Pb)._++,i=O(this,La,KT).call(this),r=di._svgFactory.createElement("defs");i.append(r);const o=di._svgFactory.createElement("path");r.append(o);const a=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const p=di._svgFactory.createElement("mask");r.append(p),l=`mask_p${this.pageIndex}_${s}`,p.setAttribute("id",l),p.setAttribute("maskUnits","objectBoundingBox");const g=di._svgFactory.createElement("rect");p.append(g),g.setAttribute("width","1"),g.setAttribute("height","1"),g.setAttribute("fill","white");const b=di._svgFactory.createElement("use");p.append(b),b.setAttribute("href",`#${a}`),b.setAttribute("stroke","none"),b.setAttribute("fill","black"),b.setAttribute("fill-rule","nonzero"),b.classList.add("mask")}const u=di._svgFactory.createElement("use");i.append(u),u.setAttribute("href",`#${a}`),l&&u.setAttribute("mask",`url(#${l})`);const f=u.cloneNode();return i.append(f),u.classList.add("mainOutline"),f.classList.add("secondaryOutline"),this.updateProperties(i,e),y(this,Ri).set(s,i),s}finalizeDraw(e,t){y(this,zh).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:s,bbox:i,rootClass:r,path:o}=t,a=typeof e=="number"?y(this,Ri).get(e):e;if(a){if(s&&O(this,La,YT).call(this,a,s),i&&O(l=di,gS,SH).call(l,a,i),r){const{classList:u}=a;for(const[f,p]of Object.entries(r))u.toggle(f,p)}if(o){const f=a.firstChild.firstChild;O(this,La,YT).call(this,f,o)}}}updateParent(e,t){if(t===this)return;const s=y(this,Ri).get(e);s&&(y(t,jo).append(s),y(this,Ri).delete(e),y(t,Ri).set(e,s))}remove(e){y(this,zh).delete(e),y(this,jo)!==null&&(y(this,Ri).get(e).remove(),y(this,Ri).delete(e))}destroy(){z(this,jo,null);for(const e of y(this,Ri).values())e.remove();y(this,Ri).clear(),y(this,zh).clear()}};jo=new WeakMap,Pb=new WeakMap,Ri=new WeakMap,zh=new WeakMap,gS=new WeakSet,SH=function(e,[t,s,i,r]){const{style:o}=e;o.top=`${100*s}%`,o.left=`${100*t}%`,o.width=`${100*i}%`,o.height=`${100*r}%`},La=new WeakSet,KT=function(){const e=di._svgFactory.create(1,1,!0);return y(this,jo).append(e),e.setAttribute("aria-hidden",!0),e},CH=function(e,t){const s=di._svgFactory.createElement("clipPath");e.append(s);const i=`clip_${t}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const r=di._svgFactory.createElement("use");return s.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),i},YT=function(e,t){for(const[s,i]of Object.entries(t))i===null?e.removeAttribute(s):e.setAttribute(s,i)},L(di,gS);let WT=di;globalThis.pdfjsTestingUtils={HighlightOutliner:ET};gt.AbortException;gt.AnnotationEditorLayer;gt.AnnotationEditorParamsType;gt.AnnotationEditorType;gt.AnnotationEditorUIManager;gt.AnnotationLayer;gt.AnnotationMode;gt.ColorPicker;gt.DOMSVGFactory;gt.DrawLayer;gt.FeatureTest;var _de=gt.GlobalWorkerOptions;gt.ImageKind;gt.InvalidPDFException;gt.MissingPDFException;gt.OPS;gt.OutputScale;gt.PDFDataRangeTransport;gt.PDFDateString;gt.PDFWorker;gt.PasswordResponses;gt.PermissionFlag;gt.PixelsPerInch;gt.RenderingCancelledException;gt.TextLayer;gt.TouchManager;gt.UnexpectedResponseException;gt.Util;gt.VerbosityLevel;gt.XfaLayer;gt.build;gt.createValidAbsoluteUrl;gt.fetchData;var Mde=gt.getDocument;gt.getFilenameFromUrl;gt.getPdfFilenameFromUrl;gt.getXfaPageViewport;gt.isDataScheme;gt.isPdfFile;gt.noContextMenu;gt.normalizeUnicode;gt.setLayerDimensions;gt.shadow;gt.stopEvent;gt.version;_de.workerSrc="pdfjs-dist/build/pdf.worker.mjs";const AH=n=>{let e="";return n.split(";").map(s=>s.trim()).filter(s=>s).forEach(s=>{const i=s.split(":");if(i.length<2)return;const r=i[0].trim().toLowerCase(),o=i[1].trim().toLowerCase();r==="font-weight"&&(o==="bold"||o==="700"||parseInt(o)>=700)?e+="font-weight: bold; ":r==="font-style"&&o==="italic"?e+="font-style: italic; ":r==="text-decoration"?(o.includes("underline")&&(e+="text-decoration: underline; "),o.includes("line-through")&&(e+="text-decoration: line-through; ")):r==="text-align"?["center","right","justify"].includes(o)&&(e+=`text-align: ${o}; `):r==="background-color"?o!=="transparent"&&o!=="rgba(0, 0, 0, 0)"&&(e+=`background-color: ${o}; `):r==="color"&&o!=="#000000"&&o!=="black"&&!o.startsWith("rgba(0,0,0")&&(e+=`color: ${o}; `)}),e},NH=n=>{const e=new Map,t=/\.([a-zA-Z0-9_-]+)\s*\{([^}]+)\}/g;let s;for(;(s=t.exec(n))!==null;){const i=s[1],r=s[2];r&&e.set(i,r)}return e},EH=(n,e)=>{if(e.size===0)return;const t=n.querySelectorAll("*");for(let s=0;s<t.length;s++){const i=t[s],r=i.getAttribute("class");if(r){const o=r.split(/\s+/);let a=i.getAttribute("style")||"";if(o.forEach(l=>{if(e.has(l)){const u=e.get(l);u&&(a+=(a.endsWith(";")?" ":"; ")+u)}}),a){const l=AH(a);l&&i.setAttribute("style",l.trim())}}}},Vl=n=>{const e=document.createElement("div");return e.innerHTML=n,e.querySelectorAll("a[href]").forEach(s=>{const i=s.getAttribute("href");if(i&&(i.startsWith("https://www.google.com/url")||i.startsWith("http://www.google.com/url")))try{const o=new URL(i).searchParams.get("q");o&&s.setAttribute("href",o)}catch{}}),e.querySelectorAll("span").forEach(s=>{const i=s.getAttribute("style")||"";let r=s.innerHTML,o=!1;if(/font-weight:\s*(700|bold)/i.test(i)&&(r=`<strong>${r}</strong>`,o=!0),/font-style:\s*italic/i.test(i)&&(r=`<em>${r}</em>`,o=!0),/text-decoration:\s*underline/i.test(i)&&(r=`<u>${r}</u>`,o=!0),o){const a=document.createElement("span");a.innerHTML=r,s.innerHTML=r}}),e.querySelectorAll("*").forEach(s=>{const i=s.getAttribute("colspan"),r=s.getAttribute("rowspan"),o=s.getAttribute("href"),a=s.getAttribute("target"),l=s.getAttribute("start");s.removeAttribute("class"),s.removeAttribute("id"),s.removeAttribute("dir"),s.removeAttribute("align"),i&&s.setAttribute("colspan",i),r&&s.setAttribute("rowspan",r),o&&s.setAttribute("href",o),a&&s.setAttribute("target",a),l&&s.setAttribute("start",l);const u=s.getAttribute("style");if(u){const f=AH(u);f?s.setAttribute("style",f.trim()):s.removeAttribute("style")}if(s.tagName==="SPAN"&&!s.hasAttribute("style")&&!s.attributes.length){const f=s.parentNode;if(f){for(;s.firstChild;)f.insertBefore(s.firstChild,s);f.removeChild(s)}}}),e.querySelectorAll("p").forEach(s=>{!s.innerText.trim()&&!s.querySelector("img")&&!s.querySelector("br")&&!s.querySelector("hr")&&s.remove()}),e.innerHTML},TH=async n=>{var q,G,ee;if(typeof JSZip>"u")throw new Error("JSZip library is not loaded. Please include it in your project.");const e=await new JSZip().loadAsync(n),s=Object.keys(e.files).filter(W=>!e.files[W].dir&&W.toLowerCase().endsWith(".epub"));if(s.length===1&&!e.file("META-INF/container.xml")){const W=e.file(s[0]);if(W){const Q=await W.async("blob"),Z=new File([Q],s[0],{type:"application/epub+zip"});return TH(Z)}}let i=e.file("META-INF/container.xml"),r="";if(!i){const W=e.file(/META-INF\/container\.xml$/);W.length>0&&(i=W[0],r=i.name.substring(0,i.name.indexOf("META-INF/")))}if(!i)throw new Error("Invalid EPUB: META-INF/container.xml not found.");const o=await i.async("string"),a=new DOMParser;let u=(q=a.parseFromString(o,"application/xml").getElementsByTagName("rootfile")[0])==null?void 0:q.getAttribute("full-path");if(!u)throw new Error("Invalid EPUB: content.opf path not found.");u=r+u;const f=e.file(u);if(!f)throw new Error(`Invalid EPUB: ${u} not found.`);const p=await f.async("string"),g=a.parseFromString(p,"application/xml"),b=u.substring(0,u.lastIndexOf("/")),w=Array.from(g.getElementsByTagName("dc:title")),S=w.length>0&&w[0].textContent||n.name.replace(".epub",""),N=w.length>1&&w[1].textContent||"",C=((G=g.getElementsByTagName("dc:creator")[0])==null?void 0:G.textContent)||"Unknown",M=new Map;Array.from(g.getElementsByTagName("item")).forEach(W=>{const Q=W.getAttribute("id"),Z=W.getAttribute("href"),$=W.getAttribute("media-type");Q&&Z&&$&&M.set(Q,{href:`${b}/${Z}`,mediaType:$})});const R=new Map;for(const W of M.values())if(W.mediaType==="text/css"){const Q=e.file(W.href);if(Q)try{const Z=await Q.async("string");NH(Z).forEach((Y,he)=>R.set(he,(R.get(he)||"")+Y))}catch(Z){console.warn("Failed to parse CSS file",W.href,Z)}}let _;const j=Array.from(g.getElementsByTagName("meta")).find(W=>W.getAttribute("name")==="cover"),P=j==null?void 0:j.getAttribute("content");if(P){const W=M.get(P);if(W&&W.href&&W.mediaType.includes("image")){const Q=e.file(W.href);if(Q)try{const Z=await Q.async("base64");_=`data:${W.mediaType};base64,${Z}`}catch{}}}const D=Array.from(g.getElementsByTagName("itemref")).map(W=>W.getAttribute("idref")).filter(Boolean),U=[],V=[];for(const W of D){const Q=M.get(W);if(Q&&Q.mediaType==="application/xhtml+xml"){const Z=e.file(Q.href);if(Z){const $=await Z.async("string"),Y=a.parseFromString($,"application/xhtml+xml");EH(Y.documentElement,R);const he=Array.from(Y.getElementsByTagName("img"));for(const ie of he){const pe=ie.getAttribute("src");if(pe){const ue=new URL(pe,`http://dummy.com/${Q.href}`).pathname.substring(1),ke=e.file(ue);if(ke){const re=await ke.async("base64");let Ge="image/jpeg";for(const Je of M.values()){const Qe=Je.href.split("/").pop(),je=ue.split("/").pop();if(Qe&&je&&Qe.endsWith(je)){Ge=Je.mediaType;break}}ie.src=`data:${Ge};base64,${re}`}}}const Re=Y.getElementsByTagName("body")[0],ze=((ee=Y.getElementsByTagName("title")[0])==null?void 0:ee.textContent)||`Chapter ${U.length+1}`,F=Vl(Re.innerHTML),J=document.createElement("div");J.innerHTML=F,(J.textContent||"").trim().length>100&&(U.push({title:ze,summary:"Imported from EPUB"}),V.push({title:ze,htmlContent:F}))}}}return{topic:S,subtitle:N,author:C,outline:U,content:V,coverImage:_}},Rde=async n=>{const e=await n.arrayBuffer(),t=await Mde(e).promise,i=(await t.getMetadata()).info,r=(i==null?void 0:i.Title)||n.name.replace(/\.pdf$/,""),o=(i==null?void 0:i.Author)||"Unknown",a=[],l=[],u=await t.getOutline();if(u&&u.length>0)for(let f=0;f<u.length;f++){const p=u[f],g=u[f+1],b=await t.getPageIndex(p.dest[0]),w=g?await t.getPageIndex(g.dest[0]):t.numPages;let S="";for(let C=b+1;C<=w;C++){const R=await(await t.getPage(C)).getTextContent();S+=R.items.map(_=>_.str).join(" ")}const N=`<p>${S.replace(/\s+/g," ").replace(/(\r\n|\n|\r)/gm,"</p><p>")}</p>`;a.push({title:p.title,summary:"Imported from PDF"}),l.push({title:p.title,htmlContent:Vl(N)})}else{let f="";for(let g=1;g<=t.numPages;g++){const w=await(await t.getPage(g)).getTextContent();f+=w.items.map(S=>S.str).join(" ")+`

`}f.split(/(?=^ *(Chapter \d+|CHAPTER \w+|Prologue|Epilogue))/m).filter(g=>g.trim()).forEach((g,b)=>{const w=g.trim().split(`
`),S=w[0].trim()||`Chapter ${b+1}`,C=`<p>${w.slice(1).join(`
`).replace(/\s+/g," ").replace(/(\r\n|\n|\r)/gm,"</p><p>")}</p>`;a.push({title:S,summary:"Imported from PDF"}),l.push({title:S,htmlContent:Vl(C)})})}return{topic:r,author:o,outline:a,content:l}},Ide=n=>{const e=/^---\s*[\r\n]+([\s\S]*?)[\r\n]+---\s*([\s\S]*)$/,t=n.match(e);if(!t)return{attributes:{},body:n};const s={},i=t[1],r=t[2];return i.split(`
`).forEach(o=>{const a=o.split(":");if(a.length>=2){const l=a[0].trim().toLowerCase(),u=a.slice(1).join(":").trim().replace(/^['"](.*)['"]$/,"$1");s[l]=u}}),{attributes:s,body:r}},zde=async(n,e)=>{const t=await n.text(),{attributes:s,body:i}=Ide(t),r=Bt.lexer(i),o=e.markdownSplitLevel||1,a=e.partSplitLevel,l=[],u=[],f=r.filter(S=>S.type==="def");let p,g="Introduction",b=[];const w=()=>{if(b.length>0&&b.some(N=>N.type!=="space")){const N=[...b,...f],C=Bt.parser(N);l.push({title:g,summary:"Imported from Markdown",part:p}),u.push({title:g,htmlContent:Vl(C)})}};for(const S of r)S.type==="heading"?a!==void 0&&S.depth===a?(w(),p=S.text,g=`${p} - Intro`,b=[]):S.depth===o?(w(),g=S.text,b=[]):b.push(S):b.push(S);if(w(),l.length===0&&i.trim().length>0){const S=await Bt.parse(i);l.push({title:"Full Content",summary:"Imported from Markdown"}),u.push({title:"Full Content",htmlContent:Vl(S)})}return{topic:s.title||n.name.replace(/\.(md|txt)$/,""),subtitle:s.subtitle||"",author:s.author||"Unknown",description:s.description||"",outline:l,content:u}},Dde=async(n,e,t={})=>{const s=await hJ(n),i=t.markdownSplitLevel||1,r=t.partSplitLevel,a=new DOMParser().parseFromString(s,"text/html");let l=a.body;const u=a.head.getElementsByTagName("style");let f=new Map;for(let R=0;R<u.length;R++){const _=u[R].textContent||"";NH(_).forEach((P,D)=>f.set(D,P))}l&&EH(l,f),l.children.length===1&&l.children[0].tagName==="DIV"&&(l=l.children[0]);const p=[],g=[];let b,w="Introduction",S="";const N=`H${i}`,C=r?`H${r}`:null;Array.from(l.children).forEach(R=>{if(R.nodeType===Node.ELEMENT_NODE)if(C&&R.tagName===C){const _=Vl(S);_.trim()&&(p.push({title:w,summary:"Imported from Google Doc",part:b}),g.push({title:w,htmlContent:_})),b=R.textContent||"Untitled Part",w=`${b} - Intro`,S=""}else if(R.tagName===N){const _=Vl(S);_.trim()&&(p.push({title:w,summary:"Imported from Google Doc",part:b}),g.push({title:w,htmlContent:_})),w=R.textContent||"Untitled Chapter",S=""}else S+=R.outerHTML});const M=Vl(S);return M.trim()&&(p.push({title:w,summary:"Imported from Google Doc",part:b}),g.push({title:w,htmlContent:M})),p.length===0&&l.innerHTML.trim()&&(p.push({title:"Document Content",summary:"Imported from Google Doc"}),g.push({title:"Document Content",htmlContent:Vl(l.innerHTML)})),{topic:e,author:"Unknown",outline:p,content:g}},jde=async(n,e={})=>{try{const t=n.name.toLowerCase();if(t.endsWith(".epub")||t.endsWith(".zip"))return await TH(n);if(t.endsWith(".pdf"))return await Rde(n);if(t.endsWith(".md")||t.endsWith(".txt"))return await zde(n,e);throw new Error(`Unsupported file type: ${n.name}`)}catch(t){throw console.error("Import failed:",t),n.name.toLowerCase().endsWith(".zip")&&t.message.includes("Invalid EPUB")?te.error("Failed to parse ZIP. Please ensure it's a valid EPUB file."):te.error(`Failed to parse file: ${t.message}`),t}};class Pde{constructor(){this.state={currentTask:null,queue:[],progress:null,isProcessing:!1},this.subscribers=new Set}subscribe(e){return this.subscribers.add(e),e(this.state),()=>{this.subscribers.delete(e)}}notify(){this.subscribers.forEach(e=>e(this.state))}setState(e){this.state={...this.state,...e},this.notify()}addTask(e){const t={...e,id:crypto.randomUUID()};this.setState({queue:[...this.state.queue,t]}),this.state.isProcessing||this.processQueue()}async processQueue(){if(this.state.queue.length===0){this.setState({isProcessing:!1,currentTask:null,progress:null});return}this.setState({isProcessing:!0});const e=this.state.queue[0];this.setState({currentTask:e,queue:this.state.queue.slice(1)});try{const t=(i,r,o)=>{this.setState({progress:{message:i,percentage:Math.round(r/o*100)}})},s=await e.execute(t);e.bookId?await Te.books.get(e.bookId)&&te.success(`Finished: ${e.name}`):te.success(`Finished: ${e.name}`),e.onComplete&&e.onComplete(s)}catch(t){const s=t instanceof Error?t.message:"An unknown error occurred";console.error(`Error processing task "${e.name}":`,t),te.error(`Task Failed: ${e.name}. ${s}`)}this.processQueue()}}const _H=new Pde,vO='<svg viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></svg>',MH=({isOpen:n,onClose:e,initialFile:t})=>{const{createNewBook:s}=T.useContext(rs),i=Es(),[r,o]=T.useState("select"),[a,l]=T.useState("file"),[u,f]=T.useState(null),[p,g]=T.useState(!1),[b,w]=T.useState(""),[S,N]=T.useState(null),[C,M]=T.useState(2),[R,_]=T.useState(1),[j,P]=T.useState(!0),[D,U]=T.useState(new Set),[V,q]=T.useState(!1),[G,ee]=T.useState("loading"),[W,Q]=T.useState(""),[Z,$]=T.useState("");if(T.useEffect(()=>{n&&(t?(f(t),Re(t,C,R)):Y())},[n,t]),T.useEffect(()=>{S!=null&&S.outline&&U(new Set(S.outline.map((ye,Fe)=>Fe)))},[S]),T.useEffect(()=>{const ye=k_(Ne=>{q(Ne)}),Fe=Q3(ee);return()=>{ye(),Fe()}},[]),!n)return null;const Y=()=>{o("select"),f(null),l("file"),g(!1),w(""),N(null),P(!0),U(new Set),M(2),_(1)},he=ye=>{ye&&(f(ye),Re(ye,C,R))},Re=async(ye,Fe,Ne)=>{g(!0),w("Analyzing file...");try{const ve=await jde(ye,{markdownSplitLevel:Fe,partSplitLevel:Ne});N(ve),o("preview")}catch{Y()}finally{g(!1)}},ze=async ye=>{if(ye.preventDefault(),!W.trim()||!Z.trim()){te.error("Please enter both Client ID and API Key.");return}g(!0),w("Initializing Google Drive Service...");try{await K3(W.trim(),Z.trim()),te.success("Google Drive configured!")}catch(Fe){te.error("Failed to configure: "+Fe.message)}finally{g(!1)}},F=async()=>{try{await fJ(async(ye,Fe)=>{g(!0),w("Downloading and analyzing Google Doc...");try{const Ne=await Dde(ye,Fe,{markdownSplitLevel:C,partSplitLevel:R});N(Ne),o("preview")}catch(Ne){te.error(Ne.message)}finally{g(!1)}})}catch(ye){te.error(ye.message)}},J=ye=>{M(ye),R&&ye<=R&&_(null),pe(ye,R&&ye>R?R:null)},ie=ye=>{_(ye),ye&&C<=ye?(M(ye+1),pe(ye+1,ye)):pe(C,ye)},pe=(ye,Fe)=>{u?Re(u,ye,Fe):S&&a==="google-docs"&&(te.info("Please re-select the document to apply split level changes."),o("select"))},ue=ye=>{const Fe=new Set(D);Fe.has(ye)?Fe.delete(ye):Fe.add(ye),U(Fe)},ke=()=>{S!=null&&S.outline&&D.size===S.outline.length?U(new Set):S!=null&&S.outline&&U(new Set(S.outline.map((ye,Fe)=>Fe)))},re=async()=>{if(S){g(!0),w("Importing book...");try{const ye={...S};if(ye.outline&&ye.content){const Ne=ye.outline.filter((Pe,ot)=>D.has(ot)),ve=ye.content.filter((Pe,ot)=>D.has(ot));ye.outline=Ne,ye.content=ve}if(ye.outline&&ye.outline.length===0){te.error("Please select at least one chapter to import."),g(!1);return}const Fe=await s(ye);if(j){const Ne=(ye.content||[]).map(ve=>{const Pe=document.createElement("div");return Pe.innerHTML=ve.htmlContent,Pe.textContent||""}).join(`

`);Ne.trim()&&_H.addTask({name:`Building Knowledge Base for "${ye.topic}"`,bookId:Fe,execute:async()=>await f_(ye.topic||"Untitled",Ne),onComplete:async ve=>{const Pe=ve;if(Pe&&Pe.length>0){const ot=await Te.books.get(Fe);ot&&(await Te.books.put({...ot,knowledgeBase:Pe}),te.success(`Knowledge Base for "${ot.topic}" created with ${Pe.length} entries.`))}}})}te.success(`Successfully imported "${ye.topic}"`),i(`/editor/${Fe}`),e(),Y()}catch(ye){te.error(`Import failed: ${ye.message}`)}finally{g(!1)}}},Ge=()=>d.jsxs("div",{className:"flex space-x-4 mb-6 border-b border-zinc-200 dark:border-zinc-700",children:[d.jsx("button",{onClick:()=>l("file"),className:`pb-2 text-sm font-medium transition-colors border-b-2 ${a==="file"?"border-indigo-600 text-indigo-600 dark:text-indigo-400":"border-transparent text-zinc-500 hover:text-zinc-700 dark:text-zinc-400"}`,children:"Upload File"}),d.jsx("button",{onClick:()=>l("google-docs"),className:`pb-2 text-sm font-medium transition-colors border-b-2 ${a==="google-docs"?"border-indigo-600 text-indigo-600 dark:text-indigo-400":"border-transparent text-zinc-500 hover:text-zinc-700 dark:text-zinc-400"}`,children:"Google Docs"})]}),Je=()=>d.jsxs(d.Fragment,{children:[d.jsx("p",{className:"text-sm text-zinc-500 mt-4",children:"Import content from .epub, .zip (for epubs), .pdf, or .md/.txt files."}),d.jsx("div",{className:"mt-4",children:d.jsx("input",{type:"file",onChange:ye=>he(ye.target.files?ye.target.files[0]:null),accept:".epub,.zip,.pdf,.md,.txt",className:"w-full text-sm text-zinc-600 dark:text-zinc-300 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 dark:file:bg-indigo-900/50 dark:file:text-indigo-200 dark:hover:file:bg-indigo-900"})})]}),Qe=()=>G==="unconfigured"||G==="error"?d.jsxs("div",{className:"flex flex-col items-center justify-center py-6 text-center",children:[d.jsx("div",{className:"p-3 bg-zinc-100 dark:bg-zinc-800 rounded-full mb-4",children:d.jsx(H,{name:"SETTINGS",className:"w-8 h-8 text-zinc-400"})}),d.jsx("h3",{className:"text-lg font-semibold text-zinc-800 dark:text-zinc-100",children:"Setup Google Drive"}),d.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-6 max-w-xs",children:"Enter your Google Cloud credentials to access your documents."}),d.jsxs("form",{onSubmit:ze,className:"w-full max-w-sm space-y-3 text-left",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-xs font-bold text-zinc-500 uppercase mb-1",children:"Client ID"}),d.jsx("input",{type:"text",value:W,onChange:ye=>Q(ye.target.value),placeholder:"apps.googleusercontent.com",className:"w-full rounded-md border-zinc-300 dark:border-zinc-600 dark:bg-zinc-800 text-sm"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-xs font-bold text-zinc-500 uppercase mb-1",children:"API Key"}),d.jsx("input",{type:"text",value:Z,onChange:ye=>$(ye.target.value),className:"w-full rounded-md border-zinc-300 dark:border-zinc-600 dark:bg-zinc-800 text-sm"})]}),d.jsx("button",{type:"submit",className:"w-full py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition-colors shadow-sm",children:"Save & Connect"})]}),d.jsxs("p",{className:"text-xs text-zinc-400 mt-4",children:["Don't have these? ",d.jsx("a",{href:"https://console.cloud.google.com/",target:"_blank",rel:"noreferrer",className:"underline",children:"Create a project"})," with Google Drive API enabled."]})]}):G==="loading"?d.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-center",children:[d.jsx("div",{className:"w-8 h-8 border-4 border-t-indigo-500 border-gray-200 rounded-full animate-spin mb-4"}),d.jsx("p",{className:"text-zinc-600 dark:text-zinc-400",children:"Initializing Google Services..."})]}):V?d.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-center",children:[d.jsx("div",{className:"w-16 h-16 bg-indigo-50 dark:bg-indigo-900/20 rounded-full flex items-center justify-center mb-4",children:d.jsx(H,{name:"CLOUD",className:"w-8 h-8 text-indigo-600 dark:text-indigo-400"})}),d.jsx("h3",{className:"text-lg font-semibold text-zinc-800 dark:text-zinc-100 mb-2",children:"Ready to Import"}),d.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-6",children:"Open the Google Picker to select a document from your Drive."}),d.jsxs("button",{onClick:F,className:"bg-indigo-600 text-white px-6 py-3 rounded-lg shadow-md font-semibold hover:bg-indigo-700 transition-colors flex items-center space-x-2",children:[d.jsx(H,{name:"SEARCH",className:"w-5 h-5"}),d.jsx("span",{children:"Browse Google Drive"})]})]}):d.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-center",children:[d.jsx("div",{className:"w-16 h-16 bg-zinc-100 dark:bg-zinc-800 rounded-full flex items-center justify-center mb-4",children:d.jsx("div",{className:"w-8 h-8",dangerouslySetInnerHTML:{__html:vO}})}),d.jsx("h3",{className:"text-lg font-semibold text-zinc-800 dark:text-zinc-100 mb-2",children:"Connect Google Drive"}),d.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-6 max-w-xs",children:"Sign in to browse and import your Google Docs directly."}),d.jsxs("button",{onClick:Yv,className:"flex items-center justify-center space-x-3 bg-white border border-zinc-300 text-zinc-700 px-6 py-3 rounded-lg shadow-sm hover:bg-zinc-50 transition-colors",children:[d.jsx("div",{className:"w-5 h-5",dangerouslySetInnerHTML:{__html:vO}}),d.jsx("span",{className:"font-semibold",children:"Sign in with Google"})]})]}),je=()=>{var ye,Fe,Ne;return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"flex justify-between items-center pb-4 border-b border-zinc-200 dark:border-zinc-700",children:[d.jsx("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100",children:"Preview & Configure Import"}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700",children:d.jsx(H,{name:"CLOSE"})})]}),d.jsxs("div",{className:"space-y-4 mt-4 max-h-[60vh] overflow-y-auto pr-2 -mr-2",children:[d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"text-sm font-medium",children:"Book Title"}),d.jsx("input",{type:"text",value:(S==null?void 0:S.topic)||"",onChange:ve=>N(Pe=>Pe?{...Pe,topic:ve.target.value}:null),className:"w-full mt-1 bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"text-sm font-medium",children:"Author"}),d.jsx("input",{type:"text",value:(S==null?void 0:S.author)||"",onChange:ve=>N(Pe=>Pe?{...Pe,author:ve.target.value}:null),className:"w-full mt-1 bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm"})]})]}),d.jsxs("div",{children:[d.jsxs("label",{className:"text-sm font-medium",children:["Subtitle ",d.jsx("span",{className:"text-zinc-400 font-normal",children:"(Optional)"})]}),d.jsx("input",{type:"text",value:(S==null?void 0:S.subtitle)||"",onChange:ve=>N(Pe=>Pe?{...Pe,subtitle:ve.target.value}:null),className:"w-full mt-1 bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md shadow-sm"})]}),((u==null?void 0:u.name.endsWith(".md"))||a==="google-docs")&&d.jsxs("div",{className:"grid grid-cols-2 gap-4 p-3 bg-zinc-50 dark:bg-zinc-900/50 rounded-lg border border-zinc-200 dark:border-zinc-700",children:[d.jsxs("div",{children:[d.jsx("label",{className:"text-xs font-bold uppercase text-zinc-500 mb-1 block",children:"Split Parts by..."}),d.jsxs("div",{className:"flex space-x-1",children:[d.jsx("button",{onClick:()=>ie(null),className:`px-2 py-1 text-xs rounded-md ${R===null?"bg-zinc-600 text-white":"bg-zinc-200 dark:bg-zinc-600"}`,children:"None"}),d.jsx("button",{onClick:()=>ie(1),className:`px-2 py-1 text-xs rounded-md ${R===1?"bg-indigo-600 text-white":"bg-zinc-200 dark:bg-zinc-600"}`,children:"H1"}),d.jsx("button",{onClick:()=>ie(2),disabled:C<=2,className:`px-2 py-1 text-xs rounded-md ${R===2?"bg-indigo-600 text-white":"bg-zinc-200 dark:bg-zinc-600 disabled:opacity-30"}`,children:"H2"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"text-xs font-bold uppercase text-zinc-500 mb-1 block",children:"Split Chapters by..."}),d.jsx("div",{className:"flex space-x-1",children:["H1","H2","H3"].map((ve,Pe)=>d.jsx("button",{onClick:()=>J(Pe+1),disabled:R!==null&&Pe+1<=R,className:`px-2 py-1 text-xs rounded-md ${C===Pe+1?"bg-indigo-600 text-white":"bg-zinc-200 dark:bg-zinc-600 disabled:opacity-30"}`,children:ve},ve))})]}),d.jsx("div",{className:"col-span-2 text-[10px] text-zinc-500 italic",children:R?`H${R} creates a Part folder. H${C} creates a Chapter inside it.`:`H${C} creates a Chapter.`})]}),d.jsxs("div",{children:[d.jsxs("div",{className:"flex justify-between items-end mb-1",children:[d.jsx("label",{className:"text-sm font-medium",children:"Detected Structure"}),d.jsx("button",{onClick:ke,className:"text-xs text-indigo-600 dark:text-indigo-400 hover:underline",children:D.size===((ye=S==null?void 0:S.outline)==null?void 0:ye.length)?"Deselect All":"Select All"})]}),d.jsxs("div",{className:"h-64 overflow-y-auto border border-zinc-300 dark:border-zinc-600 rounded-md bg-zinc-50 dark:bg-zinc-900/50 divide-y divide-zinc-200 dark:divide-zinc-700",children:[(Fe=S==null?void 0:S.outline)==null?void 0:Fe.map((ve,Pe)=>d.jsxs("label",{className:"flex items-center p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 cursor-pointer transition-colors",children:[d.jsx("input",{type:"checkbox",checked:D.has(Pe),onChange:()=>ue(Pe),className:"h-4 w-4 text-indigo-600 border-zinc-300 rounded focus:ring-indigo-500 flex-shrink-0"}),d.jsxs("div",{className:"ml-3 overflow-hidden",children:[ve.part&&d.jsx("span",{className:"block text-[10px] text-zinc-500 uppercase font-bold tracking-wide",children:ve.part}),d.jsx("span",{className:"text-sm text-zinc-700 dark:text-zinc-300 truncate block select-none",children:ve.title})]})]},Pe)),(!(S!=null&&S.outline)||S.outline.length===0)&&d.jsx("div",{className:"p-4 text-center text-zinc-500 text-sm",children:"No chapters detected."})]}),d.jsxs("p",{className:"text-xs text-zinc-500 mt-1",children:[D.size," of ",((Ne=S==null?void 0:S.outline)==null?void 0:Ne.length)||0," selected"]})]}),d.jsxs("div",{className:"flex items-start p-2 rounded-md bg-indigo-50 dark:bg-indigo-900/30 border border-indigo-200 dark:border-indigo-800",children:[d.jsx("input",{id:"analyzeContent",type:"checkbox",checked:j,onChange:ve=>P(ve.target.checked),className:"h-5 w-5 mt-0.5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),d.jsxs("label",{htmlFor:"analyzeContent",className:"ml-3 text-sm text-gray-700 dark:text-gray-300",children:[d.jsx("span",{className:"font-semibold",children:"Analyze content to build Knowledge Base"}),d.jsx("br",{}),d.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Helps the AI understand your book's characters, plot, and world for better-contexted assistance. (Recommended)"})]})]})]}),d.jsxs("div",{className:"mt-6 flex justify-between items-center",children:[d.jsx("button",{onClick:Y,className:"text-sm font-semibold text-zinc-600 dark:text-zinc-400 hover:underline",children:" Back"}),d.jsx("button",{onClick:re,className:"bg-indigo-600 text-white px-6 py-2 rounded-lg font-semibold",children:"Import Book"})]})]})};return d.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[10001] p-4 animate-fade-in",onClick:e,children:[p&&d.jsx(sr,{message:b}),d.jsx("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl w-full max-w-2xl p-6",onClick:ye=>ye.stopPropagation(),children:r==="select"?d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"flex justify-between items-center pb-4",children:[d.jsx("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100",children:"Import Book"}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700",children:d.jsx(H,{name:"CLOSE"})})]}),Ge(),a==="file"?Je():Qe()]}):je()})]})},RH=async()=>{if(!navigator.storage||!navigator.storage.estimate)return null;try{const n=await navigator.storage.estimate(),e=n.usage||0,t=n.quota||0,s=t>0?e/t*100:0,i=t-e;return{usage:e,quota:t,percentUsed:s,remaining:i}}catch(n){return console.warn("Storage estimate failed",n),null}},Lde=async()=>{if(!navigator.storage||!navigator.storage.persist)return!1;try{const n=await navigator.storage.persist();return console.log(`Storage persistence granted: ${n}`),n}catch(n){return console.warn("Failed to request persistent storage",n),!1}},Ode=async()=>!navigator.storage||!navigator.storage.persisted?!1:await navigator.storage.persisted(),xN=(n,e=2)=>{if(n===0)return"0 Bytes";const t=1024,s=e<0?0:e,i=["Bytes","KB","MB","GB","TB"],r=Math.floor(Math.log(n)/Math.log(t));return parseFloat((n/Math.pow(t,r)).toFixed(s))+" "+i[r]},Bde='<svg viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></svg>',Fde=({onRestoreSuccess:n,onManualRestoreCheck:e})=>{const{theme:t,toggleTheme:s}=W3();Es();const i=T.useRef(null),[r,o]=T.useState("general"),[a,l]=T.useState(!1),[u,f]=T.useState(""),[p,g]=T.useState(!0),[b,w]=T.useState(!1),[S,N]=T.useState(""),[C,M]=T.useState(null),[R,_]=T.useState({total:0,session:0}),[j,P]=T.useState(!1),[D,U]=T.useState(localStorage.getItem("start_page")||"dashboard"),[V,q]=T.useState("google_drive"),[G,ee]=T.useState("loading"),[W,Q]=T.useState(!1),[Z,$]=T.useState(null),[Y,he]=T.useState([]),[Re,ze]=T.useState(!1),[F,J]=T.useState(""),[ie,pe]=T.useState(""),[ue,ke]=T.useState([]),[re,Ge]=T.useState(!1),[Je,Qe]=T.useState(!1);T.useEffect(()=>{const De=Q3(ee),se=k_((me,xe)=>{Q(me),$(xe)}),Oe=async()=>{const me=await Te.settings.get(q0);g((me==null?void 0:me.value)!==!1);const xe=await Te.settings.get(Gw);w((xe==null?void 0:xe.value)===!0);const Le=await Te.settings.get(UN);N((Le==null?void 0:Le.value)||"");const Ue=await Te.settings.get("syncProvider");Ue&&q(Ue.value);const lt=Ww();J(lt.clientId),pe(lt.apiKey)},Ke=async()=>{const me=await RH();M(me);const xe=await Ode();P(xe),_(JY())};return Oe(),Ke(),()=>{De(),se()}},[]);const je=async De=>{const se=De.target.checked;g(se),await Te.settings.put({id:q0,value:se}),se&&S?(te.success("Automatic server backups enabled."),gp()):se&&!S?te.info("Auto-sync enabled, but Backup API Key is missing."):te.info("Automatic server backups disabled.")},ye=async()=>{await Te.settings.put({id:UN,value:S.trim()}),te.success("Backup API Key saved."),p&&S.trim()&&gp()},Fe=async De=>{const se=De.target.checked;w(se),await Te.settings.put({id:Gw,value:se}),te.info(se?"Low Data Mode enabled. Images will not be synced.":"Low Data Mode disabled.")},Ne=async()=>{const De=await Lde();P(De),De?te.success("Persistent storage granted. Your data is less likely to be cleared by the browser."):te.info("Browser denied persistent storage request. It may already be granted or requires more usage.")},ve=async De=>{const se=De.target.value;q(se),await Te.settings.put({id:"syncProvider",value:se}),te.success(`Sync provider changed to ${se.replace("_"," ")}`)},Pe=De=>{const se=De.target.value;U(se),localStorage.setItem("start_page",se),te.success("Start page preference updated.")},ot=async()=>{l(!0),f("Backing up data...");try{const De=await Te.backup(),se=new Blob([De],{type:"application/json"}),Oe=document.createElement("a");Oe.href=URL.createObjectURL(se);const Ke=new Date().toISOString().replace(/:/g,"-").slice(0,19);Oe.download=`ai-book-studio-backup-${Ke}.json`,document.body.appendChild(Oe),Oe.click(),document.body.removeChild(Oe),URL.revokeObjectURL(Oe.href),te.success("Local backup downloaded successfully!")}catch(De){te.error(`Backup failed: ${De.message}`)}finally{l(!1)}},Gt=()=>{var De;(De=i.current)==null||De.click()},bn=async De=>{var Oe;const se=(Oe=De.target.files)==null?void 0:Oe[0];if(se){if(await Mn.confirm({title:"Overwrite Data?",message:"Restoring from this file will overwrite all current data. Are you sure you want to continue?",danger:!0,confirmText:"Overwrite and Restore"})){l(!0),f("Restoring from file...");const me=new FileReader;me.onload=async xe=>{var Le;try{const Ue=(Le=xe.target)==null?void 0:Le.result;await Te.restore(Ue),te.success("Restore successful!"),await n()}catch(Ue){te.error(`Restore failed: ${Ue.message}`)}finally{l(!1)}},me.readAsText(se)}De.target.value=""}},qt=async De=>{if(De.preventDefault(),!F.trim()||!ie.trim()){te.error("Please enter both Client ID and API Key.");return}l(!0),f("Initializing Google Drive Service...");try{await K3(F.trim(),ie.trim()),te.success("Google Drive configured!")}catch(se){te.error("Failed to configure: "+se.message)}finally{l(!1)}},jt=()=>{rJ(),J(""),pe(""),te.info("Google Drive credentials removed.")},yn=async()=>{l(!0),f("Backing up to Google Drive...");try{await lJ(),te.success("Successfully backed up to Google Drive!")}catch(De){console.error(De),De.message.includes("Not signed in")||De.message.includes("401")?(te.info("Session expired. Please sign in again."),Yv()):te.error(`Backup failed: ${De.message}`)}finally{l(!1)}},_t=async()=>{l(!0),f("Fetching backups from Google Drive...");try{const De=await cJ();he(De),ze(!0)}catch(De){console.error(De),De.message.includes("Not signed in")||De.message.includes("401")?(te.info("Session expired. Please sign in again."),Yv()):te.error(`Failed to list files: ${De.message}`)}finally{l(!1)}},Qt=async De=>{ze(!1),l(!0),f("Restoring from Google Drive...");try{const se=await dJ(De);await Te.restore(se),te.success("Restore successful!"),await n()}catch(se){te.error(`Restore failed: ${se.message}`)}finally{l(!1)}},_s=async De=>{try{await uJ(De),he(se=>se.filter(Oe=>Oe.id!==De)),te.success("Backup deleted from Google Drive.")}catch(se){te.error(`Failed to delete file: ${se.message}`)}},Se=async()=>{if(!S){te.error("Please configure your Backup API Key first.");return}l(!0),f("Checking for server backups...");try{const De=await QY();De.length===0?te.info("No server backups found."):(ke(De),Ge(!0))}catch(De){te.error(`Failed to list server backups: ${De.message}`)}finally{l(!1)}},Me=async()=>{if(!S){te.error("Please configure your Backup API Key first.");return}const De=await Mn.prompt({title:"Create Cloud Snapshot",message:"Enter a name for this snapshot. It will be saved permanently on the server.",inputLabel:"Snapshot Name",confirmText:"Create"});if(De){l(!0),f("Uploading snapshot...");try{await XY(De),te.success("Cloud snapshot created!")}catch(se){te.error(`Failed to create snapshot: ${se.message}`)}finally{l(!1)}}},He=async De=>{Ge(!1),l(!0),f("Restoring from server...");try{const se=await Oj(De);if(se)await Te.restore(se),te.success("Restore successful!"),await n();else throw new Error("Empty backup content.")}catch(se){te.error(`Restore failed: ${se.message}`)}finally{l(!1)}},Pt=async De=>{l(!0),f("Downloading backup...");try{const se=await Oj(De);if(se){const Oe=new Blob([se],{type:"application/json"}),Ke=URL.createObjectURL(Oe),me=document.createElement("a");me.href=Ke;let xe=De;xe.endsWith(".gz")&&(xe=xe.slice(0,-3)),xe.endsWith(".json")||(xe+=".json"),me.download=xe,document.body.appendChild(me),me.click(),document.body.removeChild(me),URL.revokeObjectURL(Ke),te.success("Backup downloaded successfully!")}else throw new Error("Empty backup content.")}catch(se){te.error(`Download failed: ${se.message}`)}finally{l(!1)}},Sn=async()=>{if(!S){te.error("Please configure your Backup API Key first.");return}l(!0),f("Force uploading to server...");try{const De=await gp(!0);if(De)throw De;te.success("Force upload successful.")}catch(De){te.error(`Force upload failed: ${De.message}`)}finally{l(!1)}},as=async()=>{if(!S){te.error("Please configure your Backup API Key first.");return}l(!0),f("Checking server for latest backup...");try{const De=await G3(!0);De?await Mn.confirm({title:"Restore from Server?",message:`Found a backup from ${new Date(De.backupTimestamp).toLocaleString()}. Restoring will overwrite your local data.`,danger:!0,confirmText:"Restore"})&&(f("Restoring..."),await Te.restore(De.content),await n(),te.success("Restored successfully.")):te.info("No backup found on server.")}catch(De){te.error(`Force download failed: ${De.message}`)}finally{l(!1)}},Xn=async()=>{if(await Mn.confirm({title:"Reset Application?",message:"This will delete ALL local data (books, settings, history). Ensure you have a backup first. This action cannot be undone.",danger:!0,confirmText:"Reset Everything"}))try{await Te.books.clear(),await Te.instructions.clear(),await Te.styles.clear(),await Te.snapshots.clear(),await Te.macros.clear(),await Te.series.clear(),await Te.readingProgress.clear(),localStorage.clear(),window.location.reload()}catch(se){te.error(`Reset failed: ${se.message}`)}};return d.jsxs("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8",children:[a&&d.jsx(sr,{message:u}),d.jsx(Tle,{isOpen:Re,onClose:()=>ze(!1),files:Y,onRestore:Qt,onDelete:_s}),d.jsx(_le,{isOpen:re,onClose:()=>Ge(!1),backups:ue,onRestore:He,onDownload:Pt}),d.jsx(MH,{isOpen:Je,onClose:()=>Qe(!1)}),d.jsx("h1",{className:"text-3xl font-bold mb-8 text-zinc-800 dark:text-white",children:"Settings"}),d.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[d.jsx("div",{className:"w-full md:w-64 space-y-2",children:[{id:"general",label:"General",icon:"SETTINGS"},{id:"data",label:"Data Management",icon:"SAVE"},{id:"cloud",label:"Cloud Sync",icon:"CLOUD"},{id:"system",label:"System",icon:"INFO"}].map(De=>d.jsxs("button",{onClick:()=>o(De.id),className:`w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${r===De.id?"bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300":"text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800"}`,children:[d.jsx(H,{name:De.icon,className:"w-5 h-5"}),d.jsx("span",{children:De.label})]},De.id))}),d.jsxs("div",{className:"flex-1 bg-white dark:bg-zinc-800 rounded-xl border border-zinc-200 dark:border-zinc-700 p-6 shadow-sm",children:[r==="general"&&d.jsxs("div",{className:"space-y-6",children:[d.jsx("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100",children:"General Settings"}),d.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-zinc-100 dark:border-zinc-700",children:[d.jsxs("div",{children:[d.jsx("p",{className:"font-medium text-zinc-700 dark:text-zinc-200",children:"Start Page"}),d.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Which page to show when the app opens."})]}),d.jsxs("select",{value:D,onChange:Pe,className:"bg-zinc-50 dark:bg-zinc-700 border border-zinc-200 dark:border-zinc-600 rounded-lg px-3 py-2 text-sm text-zinc-700 dark:text-zinc-200",children:[d.jsx("option",{value:"dashboard",children:"Library"}),d.jsx("option",{value:"reading",children:"Reading"}),d.jsx("option",{value:"instructions",children:"Instructions"})]})]}),d.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-zinc-100 dark:border-zinc-700",children:[d.jsxs("div",{children:[d.jsx("p",{className:"font-medium text-zinc-700 dark:text-zinc-200",children:"Appearance"}),d.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Switch between light and dark themes."})]}),d.jsxs("button",{onClick:s,className:"flex items-center space-x-2 px-3 py-2 bg-zinc-100 dark:bg-zinc-700 rounded-lg text-sm font-medium hover:bg-zinc-200 dark:hover:bg-zinc-600 transition-colors text-zinc-700 dark:text-zinc-200",children:[d.jsx(H,{name:t==="light"?"SUN":"MOON",className:"w-4 h-4"}),d.jsx("span",{children:t==="light"?"Light Mode":"Dark Mode"})]})]})]}),r==="data"&&d.jsxs("div",{className:"space-y-6",children:[d.jsx("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100",children:"Data Management"}),d.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-100 dark:border-blue-900/50",children:[d.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[d.jsx(H,{name:"INFO",className:"text-blue-500"}),d.jsx("h3",{className:"font-bold text-blue-700 dark:text-blue-300",children:"Storage Usage"})]}),C?d.jsxs("div",{className:"space-y-2",children:[d.jsx("div",{className:"w-full bg-blue-200 dark:bg-blue-900 rounded-full h-2.5",children:d.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${C.percentUsed}%`}})}),d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:["Using ",xN(C.usage)," of ",xN(C.quota)," available."]}),!j&&d.jsx("button",{onClick:Ne,className:"text-xs font-semibold text-blue-700 dark:text-blue-300 hover:underline",children:"Enable Persistence"})]})]}):d.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Storage estimate unavailable."})]}),d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"p-4 border border-zinc-200 dark:border-zinc-700 rounded-xl hover:bg-zinc-50 dark:hover:bg-zinc-700/30 transition-colors",children:[d.jsx("div",{className:"w-10 h-10 bg-indigo-100 dark:bg-indigo-900/50 rounded-lg flex items-center justify-center text-indigo-600 dark:text-indigo-400 mb-3",children:d.jsx(H,{name:"DOWNLOAD"})}),d.jsx("h3",{className:"font-bold text-zinc-800 dark:text-zinc-100",children:"Backup Data"}),d.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 mt-1 mb-3",children:"Download a local JSON backup of all your books and settings."}),d.jsx("button",{onClick:ot,className:"text-sm font-semibold text-indigo-600 hover:text-indigo-700 dark:text-indigo-400 dark:hover:text-indigo-300",children:"Download Backup "})]}),d.jsxs("div",{className:"p-4 border border-zinc-200 dark:border-zinc-700 rounded-xl hover:bg-zinc-50 dark:hover:bg-zinc-700/30 transition-colors",children:[d.jsx("div",{className:"w-10 h-10 bg-emerald-100 dark:bg-emerald-900/50 rounded-lg flex items-center justify-center text-emerald-600 dark:text-emerald-400 mb-3",children:d.jsx(H,{name:"UPLOAD"})}),d.jsx("h3",{className:"font-bold text-zinc-800 dark:text-zinc-100",children:"Restore Data"}),d.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 mt-1 mb-3",children:"Restore your library from a previously saved backup file."}),d.jsx("input",{type:"file",ref:i,onChange:bn,accept:".json",className:"hidden"}),d.jsx("button",{onClick:Gt,className:"text-sm font-semibold text-emerald-600 hover:text-emerald-700 dark:text-emerald-400 dark:hover:text-emerald-300",children:"Select File "})]})]}),d.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-900 p-4 rounded-xl border border-zinc-200 dark:border-zinc-700 flex justify-between items-center",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-zinc-800 dark:text-zinc-100",children:"Create Cloud Snapshot"}),d.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Save a permanent restore point to the server."})]}),d.jsx("button",{onClick:Me,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-semibold hover:bg-indigo-700 transition-colors",children:"Create Snapshot"})]}),d.jsxs("div",{className:"border-t border-zinc-100 dark:border-zinc-700 pt-6",children:[d.jsx("h3",{className:"font-bold text-zinc-800 dark:text-zinc-100 mb-4",children:"Import Content"}),d.jsxs("button",{onClick:()=>Qe(!0),className:"flex items-center space-x-2 px-4 py-2 bg-zinc-100 dark:bg-zinc-700 rounded-lg text-sm font-medium hover:bg-zinc-200 dark:hover:bg-zinc-600 transition-colors text-zinc-700 dark:text-zinc-200",children:[d.jsx(H,{name:"PLUS",className:"w-4 h-4"}),d.jsx("span",{children:"Import Book / Document"})]})]})]}),r==="cloud"&&d.jsxs("div",{className:"space-y-8",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100 mb-4",children:"Personal Cloud Storage"}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2",children:"Select Provider"}),d.jsxs("select",{value:V,onChange:ve,className:"w-full p-2.5 bg-zinc-50 dark:bg-zinc-900 border border-zinc-300 dark:border-zinc-700 rounded-lg text-sm",children:[d.jsx("option",{value:"google_drive",children:"Google Drive"}),d.jsx("option",{value:"dropbox",disabled:!0,children:"Dropbox (Coming Soon)"}),d.jsx("option",{value:"onedrive",disabled:!0,children:"OneDrive (Coming Soon)"})]})]}),V==="google_drive"&&d.jsx(d.Fragment,{children:G==="unconfigured"?d.jsxs("form",{onSubmit:qt,className:"bg-zinc-50 dark:bg-zinc-900 p-4 rounded-lg border border-zinc-200 dark:border-zinc-700 space-y-4",children:[d.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Configure your Google Cloud credentials to enable Drive sync."}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-xs font-bold text-zinc-500 uppercase mb-1",children:"Client ID"}),d.jsx("input",{type:"text",value:F,onChange:De=>J(De.target.value),className:"w-full rounded-md border-zinc-300 dark:border-zinc-600 dark:bg-zinc-800 text-sm",placeholder:"apps.googleusercontent.com"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-xs font-bold text-zinc-500 uppercase mb-1",children:"API Key"}),d.jsx("input",{type:"text",value:ie,onChange:De=>pe(De.target.value),className:"w-full rounded-md border-zinc-300 dark:border-zinc-600 dark:bg-zinc-800 text-sm"})]}),d.jsx("button",{type:"submit",className:"bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-indigo-700",children:"Save & Connect"})]}):d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between bg-zinc-50 dark:bg-zinc-900 p-4 rounded-lg border border-zinc-200 dark:border-zinc-700",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"w-10 h-10 bg-white dark:bg-zinc-800 rounded-full flex items-center justify-center shadow-sm",dangerouslySetInnerHTML:{__html:Bde}}),d.jsxs("div",{children:[d.jsx("p",{className:"font-bold text-sm text-zinc-800 dark:text-zinc-100",children:"Google Drive"}),d.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:W?`Connected as ${Z==null?void 0:Z.name}`:"Not connected"})]})]}),W?d.jsx("button",{onClick:X3,className:"text-sm font-medium text-red-600 hover:text-red-700 dark:text-red-400",children:"Sign Out"}):d.jsx("button",{onClick:Yv,className:"text-sm font-medium text-indigo-600 hover:text-indigo-700 dark:text-indigo-400",children:"Connect"})]}),W&&d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsxs("button",{onClick:yn,className:"flex items-center justify-center space-x-2 p-3 border border-zinc-200 dark:border-zinc-700 rounded-lg hover:bg-zinc-50 dark:hover:bg-zinc-700/50 transition-colors",children:[d.jsx(H,{name:"CLOUD",className:"w-5 h-5 text-indigo-500"}),d.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200",children:"Backup to Drive"})]}),d.jsxs("button",{onClick:_t,className:"flex items-center justify-center space-x-2 p-3 border border-zinc-200 dark:border-zinc-700 rounded-lg hover:bg-zinc-50 dark:hover:bg-zinc-700/50 transition-colors",children:[d.jsx(H,{name:"RESTORE",className:"w-5 h-5 text-emerald-500"}),d.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200",children:"Restore from Drive"})]})]}),d.jsx("div",{className:"text-right",children:d.jsx("button",{onClick:jt,className:"text-xs text-red-500 hover:underline",children:"Remove Credentials"})})]})}),V==="dropbox"&&d.jsx("div",{className:"p-6 bg-zinc-50 dark:bg-zinc-900 border border-dashed border-zinc-300 dark:border-zinc-700 rounded-lg text-center",children:d.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"Dropbox integration is coming soon."})}),V==="onedrive"&&d.jsx("div",{className:"p-6 bg-zinc-50 dark:bg-zinc-900 border border-dashed border-zinc-300 dark:border-zinc-700 rounded-lg text-center",children:d.jsx("p",{className:"text-zinc-500 dark:text-zinc-400",children:"OneDrive integration is coming soon."})})]}),d.jsxs("div",{className:"border-t border-zinc-100 dark:border-zinc-700 pt-6",children:[d.jsx("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100 mb-4",children:"Automatic App Backup"}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"block text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Backup Service API Key"}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{type:"password",value:S,onChange:De=>N(De.target.value),className:"flex-grow bg-zinc-50 dark:bg-zinc-900 border border-zinc-300 dark:border-zinc-700 rounded-lg p-2.5 text-sm",placeholder:"Enter your security key"}),d.jsx("button",{onClick:ye,className:"bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-indigo-700",children:"Save Key"})]})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"font-medium text-zinc-700 dark:text-zinc-200",children:"Enable Auto-Backup"}),d.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Automatically sync changes to our secure server."})]}),d.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[d.jsx("input",{type:"checkbox",className:"sr-only peer",checked:p,onChange:je}),d.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600"})]})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"font-medium text-zinc-700 dark:text-zinc-200",children:"Low Data Mode"}),d.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Exclude large images from backups to save data."})]}),d.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[d.jsx("input",{type:"checkbox",className:"sr-only peer",checked:b,onChange:Fe}),d.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600"})]})]}),d.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-900 p-3 rounded-lg border border-zinc-200 dark:border-zinc-700 flex justify-between items-center text-sm",children:[d.jsx("span",{className:"text-zinc-600 dark:text-zinc-400",children:"Network Usage (Session)"}),d.jsx("span",{className:"font-bold text-zinc-800 dark:text-zinc-200",children:xN(R.session)})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"font-medium text-zinc-700 dark:text-zinc-200",children:"Manual Server Checks"}),d.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Check for updates or restore from server."})]}),d.jsxs("div",{className:"space-x-2",children:[d.jsx("button",{onClick:e,className:"text-sm text-indigo-600 dark:text-indigo-400 hover:underline px-2",children:"Check Updates"}),d.jsx("button",{onClick:Se,className:"text-sm text-indigo-600 dark:text-indigo-400 hover:underline px-2",children:"View Backups"})]})]}),d.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-zinc-100 dark:border-zinc-700/50",children:[d.jsxs("div",{children:[d.jsx("p",{className:"font-medium text-zinc-700 dark:text-zinc-200",children:"Advanced Sync"}),d.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Force synchronization with the server."})]}),d.jsxs("div",{className:"flex space-x-2",children:[d.jsx("button",{onClick:Sn,disabled:a,className:"px-3 py-1.5 bg-zinc-100 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-200 text-sm font-semibold rounded-md hover:bg-zinc-200 dark:hover:bg-zinc-600 transition-colors disabled:opacity-50",children:"Force Upload"}),d.jsx("button",{onClick:as,disabled:a,className:"px-3 py-1.5 bg-zinc-100 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-200 text-sm font-semibold rounded-md hover:bg-zinc-200 dark:hover:bg-zinc-600 transition-colors disabled:opacity-50",children:"Force Download"})]})]})]})]})]}),r==="system"&&d.jsxs("div",{className:"space-y-6",children:[d.jsx("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100",children:"System"}),d.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-700",children:[d.jsxs("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:[d.jsx("strong",{children:"Version:"})," 1.3.2"]}),d.jsxs("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:[d.jsx("strong",{children:"Environment:"})," Production"]})]}),d.jsxs("div",{className:"pt-4 border-t border-zinc-100 dark:border-zinc-700",children:[d.jsx("h3",{className:"font-bold text-red-600 dark:text-red-400 mb-2",children:"Danger Zone"}),d.jsx("button",{onClick:Xn,className:"px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors shadow-sm",children:"Reset Application Data"}),d.jsx("p",{className:"text-xs text-zinc-500 mt-2",children:"This will wipe all local data. Use with caution."})]})]})]})]})]})},Hde=()=>{const[n,e]=T.useState([]),[t,s]=T.useState(null),[i,r]=T.useState(!1),[o,a]=T.useState(!1),[l,u]=T.useState(null),{isAiEnabled:f}=T.useContext(rs),p=T.useCallback(async()=>{const _=await Te.instructions.getAll();e(_)},[]);T.useEffect(()=>{p()},[p]);const g=_=>{s({..._}),r(!1),u(null)},b=()=>{s({id:crypto.randomUUID(),name:"",prompt:""}),r(!0),u(null)},w=()=>{s(null),r(!1),u(null)},S=async _=>{await Mn.confirm({title:"Delete Template?",message:"Are you sure you want to delete this instruction template?",danger:!0,confirmText:"Delete"})&&(await Te.instructions.delete(_),p())},N=async()=>{t&&t.name&&t.prompt?(await Te.instructions.put(t),p(),s(null),r(!1),u(null)):te.error("Please fill in both name and prompt.")},C=_=>{t&&s({...t,[_.target.name]:_.target.value})},M=async()=>{if(!(!t||!t.prompt.trim()||!t.name.trim())){a(!0),u(null);try{const _=await _3(t.prompt,t.name);u(_)}catch(_){console.error(_),te.error("Could not generate a suggestion. Please try again.")}finally{a(!1)}}},R=()=>{t&&l&&(s({...t,prompt:l}),u(null))};return d.jsxs("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8",children:[d.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8",children:[d.jsx("h1",{className:"text-4xl font-bold tracking-tight text-gray-900 dark:text-white",children:"Instruction Templates"}),!t&&d.jsxs("button",{onClick:b,className:"w-full sm:w-auto flex items-center justify-center space-x-2 bg-indigo-600 text-white px-5 py-2.5 rounded-lg shadow-md hover:bg-indigo-700 transition-all duration-200 transform hover:scale-105",children:[d.jsx(H,{name:"PLUS",className:"w-5 h-5"}),d.jsx("span",{className:"font-semibold",children:"Create New"})]})]}),t?d.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 animate-fade-in",children:[d.jsx("h2",{className:"text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100",children:i?"Create New Template":"Edit Template"}),d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Template Name"}),d.jsx("input",{type:"text",name:"name",value:t.name,onChange:C,className:"mt-1 block w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"prompt",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Instruction Prompt"}),d.jsx("textarea",{name:"prompt",rows:5,value:t.prompt,onChange:C,className:"mt-1 block w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"}),f&&d.jsx("div",{className:"mt-2 flex justify-end",children:d.jsxs("button",{onClick:M,disabled:o||!t.prompt.trim()||!t.name.trim(),className:"flex items-center space-x-2 text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:t.name.trim()?"Get an AI-powered suggestion":"Please enter a template name first",children:[d.jsx(H,{name:"WAND",className:`w-4 h-4 ${o?"animate-spin":""}`}),d.jsx("span",{children:o?"Generating...":"Suggest Improvement"})]})})]}),l&&d.jsxs("div",{className:"p-4 bg-indigo-50 dark:bg-gray-700/50 border border-indigo-200 dark:border-gray-600 rounded-lg animate-fade-in",children:[d.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Suggestion:"}),d.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:l}),d.jsxs("div",{className:"mt-3 flex justify-end space-x-2",children:[d.jsx("button",{onClick:()=>u(null),className:"px-3 py-1 text-xs font-semibold rounded-md bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-300 dark:hover:bg-gray-500",children:"Dismiss"}),d.jsx("button",{onClick:R,className:"px-3 py-1 text-xs font-semibold rounded-md bg-indigo-600 text-white hover:bg-indigo-700",children:"Use this suggestion"})]})]})]}),d.jsxs("div",{className:"mt-8 flex justify-end space-x-3",children:[d.jsx("button",{onClick:w,className:"bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",children:"Cancel"}),d.jsx("button",{onClick:N,className:"bg-green-600 text-white px-6 py-2 rounded-lg shadow font-semibold hover:bg-green-700 transition-colors",children:"Save Template"})]})]}):d.jsx(d.Fragment,{children:n.length>0?d.jsx("div",{className:"space-y-4",children:n.map(_=>d.jsxs("div",{className:"bg-white dark:bg-gray-800 p-5 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex justify-between items-start",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"font-bold text-lg text-gray-800 dark:text-gray-100",children:_.name}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1 text-sm",children:_.prompt})]}),d.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-4",children:[d.jsx("button",{onClick:()=>g(_),className:"p-2 rounded-full text-gray-400 hover:text-indigo-500 hover:bg-indigo-100 dark:hover:bg-gray-700 transition-colors",children:d.jsx(H,{name:"EDIT",className:"w-5 h-5"})}),d.jsx("button",{onClick:()=>S(_.id),className:"p-2 rounded-full text-gray-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-gray-700 transition-colors",children:d.jsx(H,{name:"TRASH",className:"w-5 h-5"})})]})]},_.id))}):d.jsxs("div",{className:"text-center py-20 bg-white dark:bg-zinc-800 rounded-lg shadow-sm border border-zinc-200 dark:border-zinc-700 empty-state-bg",children:[d.jsx(H,{name:"EDIT",className:"w-20 h-20 mx-auto text-zinc-300 dark:text-zinc-600"}),d.jsx("h2",{className:"mt-4 text-2xl font-semibold text-zinc-800 dark:text-zinc-100",children:"No Instruction Templates"}),d.jsx("p",{className:"mt-2 text-zinc-500 dark:text-zinc-400",children:'Click "Create New" to save a reusable writing style.'})]})})]})},Ude=()=>{const[n,e]=T.useState([]),[t,s]=T.useState(null),[i,r]=T.useState(!1),o=T.useCallback(async()=>{const M=await Te.macros.getAll();e(M)},[]);T.useEffect(()=>{o()},[o]);const a=M=>{s({...M}),r(!1)},l=()=>{s({id:crypto.randomUUID(),name:"",actions:[]}),r(!0)},u=()=>{s(null),r(!1)},f=async M=>{await Mn.confirm({title:"Delete Macro?",message:"Are you sure you want to delete this workflow macro?",danger:!0,confirmText:"Delete"})&&(await Te.macros.delete(M),o())},p=async()=>{t&&t.name?(await Te.macros.put(t),o(),s(null),r(!1)):te.error("Please provide a name for the macro.")},g=M=>{t&&s({...t,name:M.target.value})},b=M=>{if(!t)return;const R={...M,id:crypto.randomUUID()};s({...t,actions:[...t.actions,R]})},w=M=>{t&&s({...t,actions:t.actions.filter(R=>R.id!==M)})},S=(M,R)=>{if(!t)return;const _=[...t.actions],j=R==="up"?M-1:M+1;j<0||j>=_.length||([_[M],_[j]]=[_[j],_[M]],s({...t,actions:_}))},N=(M,R,_)=>{if(!t)return;const j=t.actions.map(P=>P.id===M?{...P,params:{...P.params,[R]:_}}:P);s({...t,actions:j})},C=()=>t?d.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 animate-fade-in col-span-2",children:[d.jsx("h2",{className:"text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100",children:i?"Create New Macro":"Edit Macro"}),d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Macro Name"}),d.jsx("input",{type:"text",name:"name",value:t.name,onChange:g,className:"mt-1 block w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"})]}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-100 mb-2",children:"Actions"}),d.jsxs("div",{className:"space-y-3 p-3 border border-dashed border-gray-300 dark:border-gray-600 rounded-md min-h-[10rem]",children:[t.actions.map((M,R)=>d.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded-md flex items-start gap-2 group",children:[d.jsxs("div",{className:"flex-grow",children:[d.jsx("p",{className:"font-semibold text-gray-800 dark:text-gray-200",children:M.name}),M.params&&M.type==="rewrite_with_prompt"&&d.jsx("textarea",{value:M.params.prompt||"",onChange:_=>N(M.id,"prompt",_.target.value),placeholder:"Enter rewrite prompt...",rows:2,className:"mt-2 block w-full bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm"})]}),d.jsxs("div",{className:"flex flex-col items-center opacity-0 group-hover:opacity-100 transition-opacity",children:[d.jsx("button",{onClick:()=>S(R,"up"),disabled:R===0,className:"p-1 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-30",children:""}),d.jsx("button",{onClick:()=>S(R,"down"),disabled:R===t.actions.length-1,className:"p-1 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-30",children:""})]}),d.jsx("button",{onClick:()=>w(M.id),className:"p-1 rounded-full text-gray-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-gray-600 opacity-0 group-hover:opacity-100 transition-opacity",children:d.jsx(H,{name:"TRASH",className:"w-4 h-4"})})]},M.id)),t.actions.length===0&&d.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-4",children:"Add actions from the list on the right."})]})]})]}),d.jsxs("div",{className:"mt-8 flex justify-end space-x-3",children:[d.jsx("button",{onClick:u,className:"bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",children:"Cancel"}),d.jsx("button",{onClick:p,className:"bg-green-600 text-white px-6 py-2 rounded-lg shadow font-semibold hover:bg-green-700 transition-colors",children:"Save Macro"})]})]}):null;return d.jsxs("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8",children:[d.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8",children:[d.jsx("h1",{className:"text-4xl font-bold tracking-tight text-gray-900 dark:text-white",children:"Workflow Macros"}),!t&&d.jsxs("button",{onClick:l,className:"w-full sm:w-auto flex items-center justify-center space-x-2 bg-indigo-600 text-white px-5 py-2.5 rounded-lg shadow-md hover:bg-indigo-700 transition-all duration-200 transform hover:scale-105",children:[d.jsx(H,{name:"PLUS",className:"w-5 h-5"}),d.jsx("span",{className:"font-semibold",children:"Create New Macro"})]})]}),d.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:t?d.jsxs(d.Fragment,{children:[C(),d.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md border border-gray-200 dark:border-gray-700",children:[d.jsx("h3",{className:"text-xl font-bold mb-4",children:"Available Actions"}),d.jsx("div",{className:"space-y-2",children:bJ.map(M=>d.jsxs("button",{onClick:()=>b(M),className:"w-full flex items-center space-x-2 text-left p-3 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600",children:[d.jsx(H,{name:"PLUS",className:"w-4 h-4"}),d.jsx("span",{children:M.name})]},M.type))})]})]}):d.jsx("div",{className:"lg:col-span-3",children:n.length>0?d.jsx("div",{className:"space-y-4",children:n.map(M=>d.jsxs("div",{className:"bg-white dark:bg-gray-800 p-5 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex justify-between items-start",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"font-bold text-lg text-gray-800 dark:text-gray-100",children:M.name}),d.jsx("ol",{className:"list-decimal list-inside mt-2 text-sm text-gray-600 dark:text-gray-400 space-y-1",children:M.actions.map(R=>d.jsx("li",{children:R.name},R.id))})]}),d.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-4",children:[d.jsx("button",{onClick:()=>a(M),className:"p-2 rounded-full text-gray-400 hover:text-indigo-500 hover:bg-indigo-100 dark:hover:bg-gray-700 transition-colors",children:d.jsx(H,{name:"EDIT",className:"w-5 h-5"})}),d.jsx("button",{onClick:()=>f(M.id),className:"p-2 rounded-full text-gray-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-gray-700 transition-colors",children:d.jsx(H,{name:"TRASH",className:"w-5 h-5"})})]})]},M.id))}):d.jsxs("div",{className:"text-center py-20 bg-white dark:bg-zinc-800 rounded-lg shadow-sm border border-zinc-200 dark:border-zinc-700 empty-state-bg",children:[d.jsx(H,{name:"WORKFLOW",className:"w-20 h-20 mx-auto text-zinc-300 dark:text-zinc-600"}),d.jsx("h2",{className:"mt-4 text-2xl font-semibold text-zinc-800 dark:text-zinc-100",children:"No Macros Created"}),d.jsx("p",{className:"mt-2 text-zinc-500 dark:text-zinc-400",children:'Click "Create New Macro" to build a reusable workflow.'})]})})})]})},$de=({isOpen:n,onClose:e,book:t,onNavigate:s,query:i,setQuery:r,results:o,setResults:a})=>{const[l,u]=T.useState(!1),[f,p]=T.useState(!1),g=Kn.useRef(null);T.useEffect(()=>{n&&setTimeout(()=>{var N,C;(N=g.current)==null||N.focus(),(C=g.current)==null||C.select()},100)},[n]),T.useEffect(()=>{if(!i.trim()){a([]);return}const N=setTimeout(()=>{b()},300);return()=>clearTimeout(N)},[i,l,t]);const b=()=>{p(!0);const N=[],C=l?i:i.toLowerCase();t.content.forEach((M,R)=>{if(!M||!M.htmlContent)return;const _=document.createElement("div");_.innerHTML=M.htmlContent,_.querySelectorAll(Dw).forEach((P,D)=>{const U=P.textContent||"";let q=(l?U:U.toLowerCase()).indexOf(C);if(q!==-1){const G=Math.max(0,q-40),ee=Math.min(U.length,q+C.length+40);let W=U.substring(G,ee);G>0&&(W="..."+W),ee<U.length&&(W=W+"..."),N.push({chapterIndex:R,chapterTitle:M.title,snippet:W,matchIndex:q,elementIndex:D})}})}),a(N),p(!1)},w=(N,C)=>{s(N,C,"auto"),e()},S=({text:N,highlight:C})=>{if(!C.trim())return d.jsx("span",{children:N});const M=new RegExp(`(${C.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,l?"g":"gi"),R=N.split(M);return d.jsx("span",{children:R.map((_,j)=>M.test(_)?d.jsx("span",{className:"bg-yellow-200 dark:bg-yellow-900/50 text-yellow-900 dark:text-yellow-100 font-semibold rounded-sm px-0.5",children:_},j):d.jsx("span",{children:_},j))})};return n?d.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-[10vh] px-4",children:[d.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity",onClick:e}),d.jsxs("div",{className:"relative w-full max-w-2xl bg-white dark:bg-zinc-900 rounded-xl shadow-2xl border border-zinc-200 dark:border-zinc-700 flex flex-col max-h-[80vh] animate-fade-in-up",children:[d.jsxs("div",{className:"p-4 border-b border-zinc-200 dark:border-zinc-800 flex items-center gap-3",children:[d.jsx(H,{name:"SEARCH",className:"w-5 h-5 text-zinc-400"}),d.jsx("input",{ref:g,type:"text",value:i,onChange:N=>r(N.target.value),placeholder:"Search in book...",className:"flex-1 bg-transparent border-none focus:ring-0 text-lg text-zinc-800 dark:text-zinc-100 placeholder-zinc-400"}),d.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-zinc-500 dark:text-zinc-400 border-l border-zinc-200 dark:border-zinc-800 pl-3",children:[d.jsx("input",{type:"checkbox",id:"caseSensitive",checked:l,onChange:N=>u(N.target.checked),className:"rounded border-zinc-300 text-indigo-600 focus:ring-indigo-500 w-4 h-4"}),d.jsx("label",{htmlFor:"caseSensitive",className:"cursor-pointer select-none whitespace-nowrap",children:"Match Case"})]}),d.jsx("button",{onClick:e,className:"p-1 rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 transition-colors",children:d.jsx("kbd",{className:"font-sans text-xs px-1.5 py-0.5 border border-zinc-300 dark:border-zinc-600 rounded bg-zinc-50 dark:bg-zinc-800",children:"ESC"})})]}),d.jsx("div",{className:"flex-1 overflow-y-auto p-2 min-h-[300px]",children:f?d.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-zinc-500",children:[d.jsx(H,{name:"ROTATE_CW",className:"w-6 h-6 animate-spin mb-2"}),d.jsx("p",{children:"Searching..."})]}):i.trim()===""?d.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-400 pb-10",children:[d.jsx(H,{name:"SEARCH",className:"w-12 h-12 mb-2 opacity-50"}),d.jsx("p",{children:"Type to search content across all chapters."})]}):o.length===0?d.jsx("div",{className:"flex flex-col items-center justify-center h-full text-zinc-500 pb-10",children:d.jsxs("p",{children:['No results found for "',i,'"']})}):d.jsxs("div",{className:"space-y-1",children:[d.jsxs("div",{className:"px-3 py-2 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:["Found ",o.length," matches"]}),o.map((N,C)=>d.jsxs("button",{onClick:()=>w(N.chapterIndex,N.elementIndex),className:"w-full text-left p-3 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors group",children:[d.jsxs("div",{className:"flex items-center justify-between mb-1",children:[d.jsxs("span",{className:"text-xs font-bold text-indigo-600 dark:text-indigo-400",children:["Chapter ",N.chapterIndex+1,": ",N.chapterTitle]}),d.jsx(H,{name:"CHEVRON_RIGHT",className:"w-4 h-4 text-zinc-300 dark:text-zinc-600 opacity-0 group-hover:opacity-100 transition-opacity"})]}),d.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed font-serif",children:d.jsx(S,{text:N.snippet,highlight:i})})]},`${N.chapterIndex}-${N.matchIndex}-${C}`))]})}),d.jsx("div",{className:"p-2 border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50 rounded-b-xl text-center",children:d.jsx("p",{className:"text-[10px] text-zinc-400",children:"Search looks through text content only. Formatting is ignored."})})]})]}):null},Gde=({isOpen:n,onClose:e,bookmarks:t,onGoTo:s,onDelete:i,onAdd:r,currentLocationText:o})=>{const[a,l]=T.useState("");if(!n)return null;const u=()=>{r(a),l("")},f=async g=>{await Mn.confirm({title:"Delete Bookmark?",message:"Are you sure you want to remove this bookmark?",confirmText:"Delete",danger:!0})&&i(g)},p=[...t].sort((g,b)=>b.timestamp-g.timestamp);return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:e,children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl w-full max-w-lg flex flex-col border border-zinc-200 dark:border-zinc-700 max-h-[80vh]",onClick:g=>g.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-zinc-200 dark:border-zinc-700 flex-shrink-0",children:[d.jsxs("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100 flex items-center gap-2",children:[d.jsx(H,{name:"HIGHLIGHT",className:"w-5 h-5 text-indigo-500"}),"Bookmarks"]}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700","aria-label":"Close",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsxs("div",{className:"p-4 border-b border-zinc-200 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-900/50 flex-shrink-0",children:[d.jsx("label",{className:"block text-xs font-bold text-zinc-500 uppercase mb-1",children:"Current Location"}),d.jsxs("p",{className:"text-sm text-zinc-800 dark:text-zinc-200 italic mb-3 line-clamp-2",children:['"',o||"Unknown location",'"']}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{type:"text",value:a,onChange:g=>l(g.target.value),placeholder:"Optional note...",className:"flex-grow bg-white dark:bg-zinc-700 border-zinc-300 dark:border-zinc-600 rounded-md text-sm"}),d.jsx("button",{onClick:u,className:"bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-indigo-700 transition-colors",children:"Add Bookmark"})]})]}),d.jsx("div",{className:"flex-grow overflow-y-auto p-4 space-y-3",children:p.length===0?d.jsxs("div",{className:"text-center py-8 text-zinc-500",children:[d.jsx(H,{name:"BOOK",className:"w-12 h-12 mx-auto mb-2 opacity-30"}),d.jsx("p",{children:"No bookmarks saved yet."})]}):p.map(g=>d.jsxs("div",{className:"bg-white dark:bg-zinc-700/30 border border-zinc-200 dark:border-zinc-700 rounded-lg p-3 hover:shadow-md transition-shadow",children:[d.jsxs("div",{className:"flex justify-between items-start mb-1",children:[d.jsx("h3",{className:"font-bold text-sm text-zinc-800 dark:text-zinc-100",children:g.title}),d.jsx("span",{className:"text-[10px] text-zinc-400",children:new Date(g.timestamp).toLocaleDateString()})]}),d.jsxs("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 italic mb-2 line-clamp-2",children:['"',g.previewText,'"']}),g.note&&d.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-2 rounded text-xs text-zinc-700 dark:text-zinc-300 mb-2 border border-yellow-100 dark:border-yellow-800/30",children:["Note: ",g.note]}),d.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[d.jsx("button",{onClick:()=>f(g),className:"p-1.5 rounded-md text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 transition-colors",title:"Delete",children:d.jsx(H,{name:"TRASH",className:"w-4 h-4"})}),d.jsxs("button",{onClick:()=>{s(g),e()},className:"px-3 py-1.5 bg-zinc-100 dark:bg-zinc-600 hover:bg-zinc-200 dark:hover:bg-zinc-500 text-zinc-800 dark:text-zinc-100 text-xs font-semibold rounded-md transition-colors flex items-center gap-1",children:[d.jsx("span",{children:"Jump to"}),d.jsx(H,{name:"CHEVRON_RIGHT",className:"w-3 h-3"})]})]})]},g.id))})]})})},qv={theme:"light",fontFamily:"literata",fontSize:18,lineHeight:1.6,paragraphSpacing:1.5,textIndent:1.5,viewMode:"scroll",maxWidth:"700px",textAlign:"justify",paddingX:2},Dw="p, h1, h2, h3, h4, h5, h6, li, blockquote, pre, img",Vde=({bookId:n})=>{var Ke;const e=Es(),s=((Ke=Oa().state)==null?void 0:Ke.from)||"/",{audiobookState:i,playAudiobook:r}=T.useContext(rs),[o,a]=T.useState(null),[l,u]=T.useState(qv),[f,p]=T.useState(!0),[g,b]=T.useState(!0),[w,S]=T.useState(!1),[N,C]=T.useState(!1),[M,R]=T.useState(!1),[_,j]=T.useState(!1),[P,D]=T.useState(!0),[U,V]=T.useState(0),q=T.useRef(0),[G,ee]=T.useState(0),[W,Q]=T.useState(""),[Z,$]=T.useState(""),[Y,he]=T.useState(0),[Re,ze]=T.useState([]),[F,J]=T.useState(null),[ie,pe]=T.useState(""),[ue,ke]=T.useState([]),re=T.useRef(null),Ge=T.useRef(null),Je=T.useRef(0),Qe=T.useRef(null),je=T.useRef(!1),ye=T.useRef(new Map),Fe=T.useRef(null);T.useEffect(()=>{(async()=>{p(!0);try{const[xe,Le,Ue]=await Promise.all([Te.books.get(n),Te.settings.get("readerSettings"),Te.readingProgress.get(n)]);if(xe)if(a(xe),Le&&u({...qv,...Le.value}),Ue){if(Qe.current=Ue,Ue.scroll!==void 0&&(Je.current=Ue.scroll),Ue.paginate!==void 0&&V(Ue.paginate),Ue.percentage!==void 0&&ee(Ue.percentage),Ue.chapterIndex!==void 0&&he(Ue.chapterIndex),Ue.bookmarks)ze(Ue.bookmarks);else if(Ue.bookmark){const lt=Ue.bookmark,Mt={id:crypto.randomUUID(),chapterIndex:lt.chapterIndex,elementIndex:lt.elementIndex,title:`Chapter ${lt.chapterIndex+1}`,previewText:lt.previewText||"Bookmarked location",timestamp:lt.timestamp};ze([Mt])}}else b(!1);else e("/")}catch(xe){console.error("Failed to load reader data",xe)}finally{p(!1)}})()},[n,e]),T.useEffect(()=>{const me=()=>{$(new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))};me();const xe=setInterval(me,6e4);return()=>clearInterval(xe)},[]);const Ne=me=>{const Le=me.trim().split(/\s+/).length;return Math.ceil(Le/250)},ve=T.useCallback(()=>{var Le;if(l.viewMode!=="scroll"||ye.current.size===0)return;const me=60,xe=window.innerHeight;for(const[Ue,lt]of ye.current.entries()){const Mt=lt.getBoundingClientRect();if(Mt.bottom>me&&Mt.top<xe){const Ht=lt.querySelector(".chapter-body");if(!Ht)continue;const Cn=Ht.querySelectorAll(Dw);for(let Zt=0;Zt<Cn.length;Zt++){const Pn=Cn[Zt],Hn=Pn.getBoundingClientRect();if(Hn.bottom>=me){const Bi=Hn.top-me;Fe.current={chapterIndex:Ue,elementIndex:Zt,offset:Bi},J({chapterIndex:Ue,elementIndex:Zt,text:((Le=Pn.textContent)==null?void 0:Le.substring(0,80))||`Chapter ${Ue+1}`});return}}Cn.length>0&&(Fe.current={chapterIndex:Ue,elementIndex:0,offset:0})}}},[l.viewMode]),Pe=T.useCallback(()=>{if(!Fe.current||l.viewMode!=="scroll"||!re.current)return;const{chapterIndex:me,elementIndex:xe,offset:Le}=Fe.current,Ue=ye.current.get(me);if(Ue){const lt=Ue.querySelector(".chapter-body");if(lt){const Ht=lt.querySelectorAll(Dw)[xe];if(Ht){const Cn=Ht.getBoundingClientRect(),Pn=60+Le,Hn=Cn.top-Pn;Math.abs(Hn)>1&&(re.current.scrollTop+=Hn)}}}},[l.viewMode]),ot=T.useCallback(()=>{let me=0;if(l.viewMode==="scroll"){if(!re.current)return;const{scrollTop:xe,scrollHeight:Le,clientHeight:Ue}=re.current;Le>Ue?me=Math.min(100,Math.round(xe/(Le-Ue)*100)):me=Le>0?100:0}else me=Math.min(100,Math.round((U+1)/Math.max(1,q.current)*100));if(ee(me),l.viewMode==="scroll"){let xe=Y;ye.current.forEach((Le,Ue)=>{const lt=Le.getBoundingClientRect();lt.top<window.innerHeight/2&&lt.bottom>0&&(xe=Ue)}),xe!==Y&&he(xe)}if(o){const Le=o.content.reduce((lt,Mt)=>lt+Mt.htmlContent.length/6,0)*((100-me)/100),Ue=Math.ceil(Le/250);Ue>60?Q(`${Math.floor(Ue/60)}h ${Ue%60}m left`):Q(`${Ue} min left`)}},[l.viewMode,U,o,Y]),Gt=T.useCallback((me,xe)=>{if(!n)return;const Le=Qe.current||{bookId:n,updatedAt:Date.now(),percentage:0,bookmarks:[]},Ue={...Le,bookId:n,updatedAt:Date.now(),bookmarks:Re};let lt=Le.percentage||0;if(l.viewMode==="scroll"){const Mt=me??(re.current?re.current.scrollTop:Le.scroll||0);if(Ue.scroll=Mt,Fe.current&&(Ue.chapterIndex=Fe.current.chapterIndex,Ue.elementIndex=Fe.current.elementIndex),re.current&&re.current.clientHeight>0){const{scrollHeight:Ht,clientHeight:Cn}=re.current;Ht>Cn?lt=Math.min(100,Math.round(Mt/(Ht-Cn)*100)):lt=100}}else{const Mt=xe??U;Ue.paginate=Mt,q.current>0&&(lt=Math.min(100,Math.round((Mt+1)/Math.max(1,q.current)*100)))}Ue.percentage=isNaN(lt)?0:lt,Qe.current=Ue,Te.readingProgress.put(Ue).catch(console.warn),me===void 0&&ee(Ue.percentage)},[n,l.viewMode,U,Re]),bn=me=>{var Ht,Cn,Zt;const xe=((Ht=Fe.current)==null?void 0:Ht.chapterIndex)??Y,Le=((Cn=Fe.current)==null?void 0:Cn.elementIndex)??0,Ue=(F==null?void 0:F.text)||`Chapter ${xe+1}`,lt={id:crypto.randomUUID(),chapterIndex:xe,elementIndex:Le,title:((Zt=o==null?void 0:o.content[xe])==null?void 0:Zt.title)||`Chapter ${xe+1}`,previewText:Ue,timestamp:Date.now(),note:me},Mt=[...Re,lt];if(ze(Mt),Qe.current){const Pn={...Qe.current,bookmarks:Mt};Qe.current=Pn,Te.readingProgress.put(Pn)}te.success("Bookmark added")},qt=me=>{const xe=Re.filter(Le=>Le.id!==me.id);if(ze(xe),Qe.current){const Le={...Qe.current,bookmarks:xe};Qe.current=Le,Te.readingProgress.put(Le)}te.info("Bookmark removed")},jt=me=>{yn(me.chapterIndex,me.elementIndex,"auto"),te.info("Jumped to bookmark")},yn=(me,xe,Le="smooth",Ue=!0)=>{const lt=ye.current.get(me);if(lt){const Ht=lt.querySelector(".chapter-body");if(!Ht)return!1;const Zt=Ht.querySelectorAll(Dw)[xe];if(Zt)return Zt.scrollIntoView({block:"center",behavior:Le}),Fe.current={chapterIndex:me,elementIndex:xe,offset:0},Ue&&(Zt.classList.add("bg-yellow-100","dark:bg-yellow-900/50","transition-colors","duration-1000"),setTimeout(()=>{Zt.classList.remove("bg-yellow-100","dark:bg-yellow-900/50")},2e3)),D(!0),!0}const Mt=ye.current.get(me);return Mt?(Mt.scrollIntoView({behavior:Le,block:"start"}),D(!0),!0):!1};T.useLayoutEffect(()=>{if(f||!o)return;if(je.current){g&&b(!1);return}if(!Qe.current){b(!1);return}(()=>{const xe=Qe.current;if(l.viewMode==="scroll"&&re.current){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");let Le=!1;typeof xe.chapterIndex=="number"&&typeof xe.elementIndex=="number"&&(Le=yn(xe.chapterIndex,xe.elementIndex,"auto",!1),Le&&ve()),!Le&&typeof xe.scroll=="number"&&xe.scroll>0&&(re.current.scrollTop=xe.scroll,Je.current=xe.scroll,ve())}else if(l.viewMode==="paginate"&&Ge.current&&typeof xe.paginate=="number"){const Le=xe.paginate;V(Le),Ge.current&&(Ge.current.scrollLeft=Le*Ge.current.clientWidth)}ot(),requestAnimationFrame(()=>{b(!1),je.current=!0})})()},[f,o,l.viewMode,ot,g,ve]),T.useEffect(()=>{const me=re.current;if(!me||l.viewMode!=="scroll")return;let xe;const Le=()=>{if(g)return;const Ue=me.scrollTop,lt=parseFloat(me.dataset.lastControlScroll||"0"),Mt=Ue-lt;Math.abs(Mt)>400&&(Ue>50&&Mt>0?D(!1):Mt<0&&D(!0),me.dataset.lastControlScroll=Ue.toString()),Je.current=Ue,ve(),clearTimeout(xe),xe=setTimeout(()=>Gt(Ue),1e3),ot()};return me.addEventListener("scroll",Le),()=>{me.removeEventListener("scroll",Le),clearTimeout(xe),g||Gt(Je.current)}},[l.viewMode,Gt,ot,g,ve]),T.useLayoutEffect(()=>{l.viewMode==="scroll"&&!g&&Pe()},[l.fontSize,l.lineHeight,l.fontFamily,l.maxWidth,l.paddingX,l.paragraphSpacing,l.viewMode,Pe,g]),T.useEffect(()=>{if(!re.current)return;const me=new ResizeObserver(()=>{if(l.viewMode==="scroll"&&!g)Pe();else if(l.viewMode==="paginate"&&Ge.current){const xe=Ge.current,Le=Math.ceil(xe.scrollWidth/xe.clientWidth);q.current=Le,U>=Le&&V(Le-1),xe.scrollTo({left:U*xe.clientWidth})}});return me.observe(re.current),()=>me.disconnect()},[l.viewMode,Pe,g,U]);const _t=(me,xe)=>{l.viewMode==="scroll"&&ve(),me==="viewMode"&&(Gt(Je.current),je.current=!1);const Le={...l,[me]:xe};u(Le),Te.settings.put({id:"readerSettings",value:Le})},Qt=()=>{u(qv),Te.settings.put({id:"readerSettings",value:qv})},_s=me=>{if(!Ge.current)return;const xe=Ge.current,Le=me==="next"?Math.min(U+1,q.current-1):Math.max(U-1,0);V(Le),Gt(void 0,Le),xe.scrollTo({left:Le*xe.clientWidth,behavior:"smooth"})},Se=me=>{if(!re.current)return;const xe=window.innerHeight*.8;re.current.scrollBy({top:me==="down"?xe:-xe,behavior:"smooth"})},Me=(me,xe,Le="smooth")=>{C(!1),l.viewMode==="paginate"?(_t("viewMode","scroll"),setTimeout(()=>{yn(me,xe??0,Le)},100)):yn(me,xe??0,Le)},He=me=>{const xe=window.innerWidth,Le=me.clientX;Le>xe*.25&&Le<xe*.75?D(!P):Le<=xe*.25?l.viewMode==="paginate"?_s("prev"):Se("up"):l.viewMode==="paginate"?_s("next"):Se("down")},Pt=()=>{switch(l.theme){case"dark":return"bg-zinc-900 text-zinc-300";case"sepia":return"bg-[#f4ecd8] text-[#5b4636]";case"high-contrast":return"bg-black text-white";default:return"bg-white text-zinc-800"}},Sn=()=>{switch(l.theme){case"dark":return"bg-zinc-900";case"sepia":return"bg-[#f4ecd8]";case"high-contrast":return"bg-black";default:return"bg-white"}},Xn={fontFamily:(()=>{switch(l.fontFamily){case"merriweather":return'"Merriweather", serif';case"inter":return'"Inter", sans-serif';case"roboto-mono":return'"Roboto Mono", monospace';case"literata":default:return'"Literata", serif'}})(),fontSize:`${l.fontSize}px`,lineHeight:l.lineHeight,maxWidth:l.maxWidth,margin:"0 auto",paddingLeft:`${l.paddingX}rem`,paddingRight:`${l.paddingX}rem`,paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},De=`
        .reader-content p {
            margin-bottom: ${l.paragraphSpacing}em;
            text-indent: ${l.textIndent}em;
            text-align: ${l.textAlign||"justify"};
        }
        .reader-content h1, .reader-content h2, .reader-content h3 {
            text-indent: 0;
            margin-top: 2em;
            margin-bottom: 1em;
            font-family: "Inter", sans-serif;
            font-weight: 700;
            text-align: left;
        }
        .reader-content img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
            margin: 1.5rem auto;
            display: block;
        }
        .reader-content code {
            white-space: pre-wrap;
            word-break: break-word;
        }
        .reader-theme-high-contrast .reader-content a {
            color: #ffff00; text-decoration: underline;
        }
    `,se=me=>{if(!o||!o.content[me])return null;const xe=o.content[me].htmlContent.replace(/<[^>]*>/g,"");return`${Ne(xe)} min`};if(f)return d.jsx(sr,{message:"Opening book..."});if(!o)return null;const Oe=()=>{let me="";return o.content.map((xe,Le)=>{if(!xe)return null;const Ue=o.outline[Le],lt=(Ue==null?void 0:Ue.part)&&Ue.part!==me;return lt&&(me=Ue.part),d.jsxs("div",{ref:Mt=>{Mt&&ye.current.set(Le,Mt)},className:"chapter-container mb-20",children:[lt&&d.jsxs("div",{className:"part-header text-center my-20",children:[d.jsx("h1",{className:"text-3xl font-bold opacity-60 mb-4",children:Ue.part}),Ue.partContent&&d.jsx("p",{className:"italic opacity-80 max-w-md mx-auto",children:Ue.partContent})]}),d.jsx("div",{className:"chapter-title mb-8",children:d.jsx("h2",{className:"text-2xl font-bold",children:xe.title})}),d.jsx("div",{className:"chapter-body",dangerouslySetInnerHTML:{__html:xe.htmlContent}})]},Le)})};return d.jsxs(d.Fragment,{children:[d.jsx("style",{children:De}),M&&d.jsx($de,{isOpen:M,onClose:()=>R(!1),book:o,onNavigate:Me,query:ie,setQuery:pe,results:ue,setResults:ke}),d.jsx(Gde,{isOpen:_,onClose:()=>j(!1),bookmarks:Re,onGoTo:jt,onDelete:qt,onAdd:bn,currentLocationText:F==null?void 0:F.text}),d.jsxs("div",{className:`fixed inset-0 h-full w-full overflow-hidden flex flex-col transition-colors duration-300 ${Pt()} ${P?"":"cursor-none"}`,children:[d.jsx("div",{className:`fixed top-0 left-0 right-0 h-[env(safe-area-inset-top)] z-40 ${Sn()}`}),d.jsx("div",{className:`fixed bottom-0 left-0 right-0 h-[env(safe-area-inset-bottom)] z-40 ${Sn()}`}),d.jsx("header",{className:`fixed top-0 left-0 right-0 z-50 transition-transform duration-300 ${P?"translate-y-0":"-translate-y-full"}`,children:d.jsxs("div",{className:`backdrop-blur-md border-b shadow-sm px-4 h-14 flex items-center justify-between mt-[env(safe-area-inset-top)] ${l.theme==="dark"||l.theme==="high-contrast"?"bg-zinc-900/90 border-zinc-800":l.theme==="sepia"?"bg-[#f4ecd8]/90 border-[#e3dcc8]":"bg-white/90 border-zinc-200"}`,children:[d.jsxs("div",{className:"flex items-center space-x-1",children:[d.jsx("button",{onClick:()=>e(s),className:"p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 transition-colors",children:d.jsx(H,{name:"CHEVRON_LEFT",className:"w-5 h-5"})}),d.jsx("button",{onClick:()=>C(!0),className:"p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 transition-colors",title:"Table of Contents",children:d.jsx(H,{name:"MENU",className:"w-5 h-5"})})]}),d.jsx("div",{className:"flex-1 text-center mx-4 truncate opacity-90 font-medium text-sm",children:o.topic}),d.jsxs("div",{className:"flex items-center space-x-1",children:[d.jsx("button",{onClick:()=>j(!0),className:"p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 transition-colors",title:"Bookmarks",children:d.jsx(H,{name:"HIGHLIGHT",className:"w-5 h-5"})}),d.jsx("button",{onClick:()=>R(!0),className:"p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 transition-colors",title:"Search",children:d.jsx(H,{name:"SEARCH",className:"w-5 h-5"})}),d.jsx("button",{onClick:()=>r(n,0),className:"p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 transition-colors hidden sm:block",title:"Play Audiobook",children:d.jsx(H,{name:"HEADPHONES",className:"w-5 h-5"})}),d.jsx("button",{onClick:()=>S(!0),className:"p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 transition-colors",title:"Reader Settings",children:d.jsx(H,{name:"SETTINGS",className:"w-5 h-5"})})]})]})}),d.jsx("main",{className:`flex-grow relative h-full w-full overflow-hidden ${g?"opacity-0":"opacity-100"}`,onClick:He,children:l.viewMode==="scroll"?d.jsx("div",{ref:re,className:`h-full w-full overflow-y-auto px-4 pt-20 pb-20 ${g?"":"scroll-smooth"}`,children:d.jsxs("div",{className:"reader-content transition-all duration-300",style:Xn,children:[Oe(),d.jsxs("div",{className:"text-center py-20 opacity-50",children:[d.jsx(H,{name:"BOOK",className:"w-8 h-8 mx-auto mb-2"}),d.jsx("p",{children:"End of Book"})]})]})}):d.jsx("div",{ref:Ge,className:"h-full w-full overflow-x-hidden",children:d.jsx("div",{className:"h-full flex transition-transform duration-300 ease-out",style:{width:`${Math.max(100,q.current*100)}%`,transform:`translateX(-${U/Math.max(1,q.current)*100}%)`},children:d.jsx("div",{className:"reader-content h-full w-full px-8 py-16 pt-20",style:{...Xn,columnWidth:"calc(100vw - 4rem)",columnGap:"4rem",height:"100vh",width:"auto",maxWidth:"none"},children:Oe()})})})}),d.jsxs("footer",{className:`fixed bottom-0 left-0 right-0 z-50 transition-transform duration-300 pointer-events-none pb-[env(safe-area-inset-bottom)] ${P?"translate-y-0":"translate-y-full"}`,children:[d.jsxs("div",{className:`backdrop-blur-md border-t px-6 py-3 flex justify-between items-center text-xs font-medium opacity-90 ${l.theme==="dark"||l.theme==="high-contrast"?"bg-zinc-900/90 border-zinc-800":l.theme==="sepia"?"bg-[#f4ecd8]/90 border-[#e3dcc8]":"bg-white/90 border-zinc-200"}`,children:[d.jsxs("div",{className:"flex items-center space-x-4",children:[d.jsxs("span",{children:[G,"% Completed"]}),d.jsx("span",{className:"opacity-60",children:"|"}),d.jsx("span",{className:"font-bold opacity-80",children:Z})]}),d.jsx("span",{children:W})]}),d.jsx("div",{className:"h-1 w-full bg-black/10 dark:bg-white/10",children:d.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${G}%`}})})]}),N&&d.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[d.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>C(!1)}),d.jsxs("div",{className:`relative w-80 max-w-[80vw] shadow-2xl flex flex-col animate-slide-in-left ${l.theme==="dark"?"bg-zinc-900 text-zinc-200":"bg-white text-zinc-800"}`,children:[d.jsxs("div",{className:"p-4 border-b border-zinc-200 dark:border-zinc-800 flex justify-between items-center pt-[calc(1rem+env(safe-area-inset-top))]",children:[d.jsx("h2",{className:"font-bold text-lg",children:"Contents"}),d.jsx("button",{onClick:()=>C(!1),children:d.jsx(H,{name:"CLOSE",className:"w-5 h-5"})})]}),d.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:o.outline.map((me,xe)=>d.jsxs("button",{onClick:()=>Me(xe),className:`w-full text-left p-3 rounded-lg transition-colors text-sm flex items-center justify-between group ${Y===xe?"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 font-semibold":"hover:bg-black/5 dark:hover:bg-white/10"}`,children:[d.jsxs("div",{className:"flex items-center overflow-hidden",children:[d.jsx("span",{className:"opacity-50 w-8 font-mono text-xs flex-shrink-0",children:xe+1}),d.jsx("span",{className:"font-medium truncate",children:me.title})]}),d.jsx("span",{className:"text-xs opacity-50 flex-shrink-0 ml-2 whitespace-nowrap",children:se(xe)})]},xe))})]})]}),w&&d.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none",children:[d.jsx("div",{className:"absolute inset-0 bg-black/20 backdrop-blur-sm pointer-events-auto",onClick:()=>S(!1)}),d.jsxs("div",{className:`pointer-events-auto w-full sm:w-[480px] max-h-[85vh] overflow-y-auto rounded-t-2xl sm:rounded-2xl shadow-2xl p-6 animate-slide-in-up ${l.theme==="dark"?"bg-zinc-900 text-zinc-200":"bg-white text-zinc-800"}`,children:[d.jsxs("div",{className:"flex justify-between items-center mb-6",children:[d.jsx("h2",{className:"text-xl font-bold",children:"Display Settings"}),d.jsx("button",{onClick:()=>S(!1),className:"p-1 bg-black/5 dark:bg-white/10 rounded-full",children:d.jsx(H,{name:"CLOSE",className:"w-5 h-5"})})]}),d.jsxs("div",{className:"space-y-3 mb-6",children:[d.jsx("label",{className:"text-xs font-bold uppercase opacity-60 tracking-wider",children:"Theme"}),d.jsx("div",{className:"grid grid-cols-4 gap-3",children:[{id:"light",label:"Light",bg:"bg-white",border:"border-zinc-200"},{id:"sepia",label:"Sepia",bg:"bg-[#f4ecd8]",border:"border-[#e3dcc8]"},{id:"dark",label:"Dark",bg:"bg-zinc-900",border:"border-zinc-700"},{id:"high-contrast",label:"OLED",bg:"bg-black",border:"border-zinc-800"}].map(me=>d.jsxs("button",{onClick:()=>_t("theme",me.id),className:`h-16 rounded-xl border-2 flex flex-col items-center justify-center space-y-1 transition-all ${me.bg} ${me.border} ${l.theme===me.id?"ring-2 ring-indigo-500 border-transparent":""}`,children:[d.jsx("span",{className:`text-xs font-medium ${me.id==="light"||me.id==="sepia"?"text-zinc-900":"text-white"}`,children:"Aa"}),d.jsx("span",{className:`text-[10px] ${me.id==="light"||me.id==="sepia"?"text-zinc-500":"text-zinc-400"}`,children:me.label})]},me.id))})]}),d.jsxs("div",{className:"space-y-3 mb-6",children:[d.jsx("label",{className:"text-xs font-bold uppercase opacity-60 tracking-wider",children:"Font"}),d.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{id:"literata",label:"Literata",font:"font-serif"},{id:"merriweather",label:"Merriweather",font:"font-serif"},{id:"inter",label:"Inter",font:"font-sans"},{id:"roboto-mono",label:"Mono",font:"font-mono"}].map(me=>d.jsx("button",{onClick:()=>_t("fontFamily",me.id),className:`p-3 rounded-lg border text-left transition-all ${me.font} ${l.fontFamily===me.id?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400":"border-zinc-200 dark:border-zinc-700 hover:bg-black/5 dark:hover:bg-white/5"}`,children:me.label},me.id))})]}),d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{children:"Font Size"}),d.jsxs("span",{className:"opacity-60",children:[l.fontSize,"px"]})]}),d.jsx("input",{type:"range",min:"14",max:"32",step:"1",value:l.fontSize,onChange:me=>_t("fontSize",parseInt(me.target.value)),className:"w-full accent-indigo-600"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{children:"Line Height"}),d.jsx("span",{className:"opacity-60",children:l.lineHeight})]}),d.jsx("input",{type:"range",min:"1.2",max:"2.2",step:"0.1",value:l.lineHeight,onChange:me=>_t("lineHeight",parseFloat(me.target.value)),className:"w-full accent-indigo-600"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{children:"Paragraph Spacing"}),d.jsxs("span",{className:"opacity-60",children:[l.paragraphSpacing,"em"]})]}),d.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.1",value:l.paragraphSpacing,onChange:me=>_t("paragraphSpacing",parseFloat(me.target.value)),className:"w-full accent-indigo-600"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{children:"Text Indent"}),d.jsxs("span",{className:"opacity-60",children:[l.textIndent,"em"]})]}),d.jsx("input",{type:"range",min:"0",max:"4",step:"0.5",value:l.textIndent,onChange:me=>_t("textIndent",parseFloat(me.target.value)),className:"w-full accent-indigo-600"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{children:"Side Padding"}),d.jsxs("span",{className:"opacity-60",children:[l.paddingX,"rem"]})]}),d.jsx("input",{type:"range",min:"0",max:"10",step:"0.5",value:l.paddingX,onChange:me=>_t("paddingX",parseFloat(me.target.value)),className:"w-full accent-indigo-600"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("div",{className:"flex justify-between text-sm",children:d.jsx("span",{children:"Alignment"})}),d.jsxs("div",{className:"flex bg-zinc-100 dark:bg-zinc-800 rounded-lg p-1 border border-zinc-200 dark:border-zinc-700",children:[d.jsx("button",{onClick:()=>_t("textAlign","left"),className:`flex-1 py-1.5 text-xs rounded-md transition-all ${l.textAlign==="left"?"bg-white dark:bg-zinc-700 shadow text-indigo-600 dark:text-indigo-300 font-semibold":"text-zinc-500"}`,children:"Left Align"}),d.jsx("button",{onClick:()=>_t("textAlign","justify"),className:`flex-1 py-1.5 text-xs rounded-md transition-all ${l.textAlign==="justify"?"bg-white dark:bg-zinc-700 shadow text-indigo-600 dark:text-indigo-300 font-semibold":"text-zinc-500"}`,children:"Justified"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{children:"Max Width"}),d.jsx("span",{className:"opacity-60",children:l.maxWidth})]}),d.jsxs("select",{value:l.maxWidth,onChange:me=>_t("maxWidth",me.target.value),className:"w-full p-2 rounded-lg bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-sm",children:[d.jsx("option",{value:"600px",children:"Narrow (600px)"}),d.jsx("option",{value:"700px",children:"Standard (700px)"}),d.jsx("option",{value:"900px",children:"Wide (900px)"}),d.jsx("option",{value:"100%",children:"Full Width"})]})]})]}),d.jsxs("div",{className:"mt-8 pt-6 border-t border-zinc-200 dark:border-zinc-700 space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"font-medium",children:"Paginated View"}),d.jsx("p",{className:"text-xs opacity-60",children:"Read page by page instead of scrolling"})]}),d.jsx("button",{onClick:()=>_t("viewMode",l.viewMode==="scroll"?"paginate":"scroll"),className:`w-12 h-6 rounded-full transition-colors relative ${l.viewMode==="paginate"?"bg-indigo-600":"bg-zinc-300 dark:bg-zinc-600"}`,children:d.jsx("div",{className:`absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform ${l.viewMode==="paginate"?"translate-x-6":"translate-x-0"}`})})]}),d.jsx("button",{onClick:Qt,className:"w-full py-2 text-sm text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:"Reset to Defaults"})]})]})]})]})]})},qde=()=>{const{id:n}=_O(),e=Es(),{series:t,books:s,updateSeries:i,isAiEnabled:r}=T.useContext(rs),[o,a]=T.useState(null),[l,u]=T.useState([]),[f,p]=T.useState(!0),[g,b]=T.useState(!1),[w,S]=T.useState([]),[N,C]=T.useState(null),[M,R]=T.useState(!1);T.useEffect(()=>{if(n){const G=t.find(ee=>ee.id===n);if(G){a(G),S(G.sharedKnowledgeBase||[]),(G.sharedKnowledgeBase||[]).length>0&&C(G.sharedKnowledgeBase[0].id);const ee=s.filter(W=>W.seriesId===n);u(ee)}}p(!1)},[n,t,s]);const _=(G,ee)=>{o&&a({...o,[G]:ee})},j=(G,ee,W)=>{const Q=w.map(Z=>Z.id===G?{...Z,[ee]:W}:Z);S(Q)},P=()=>{const G={id:crypto.randomUUID(),name:"New Sheet",content:""};S([...w,G]),C(G.id)},D=G=>{const ee=w.filter(W=>W.id!==G);S(ee),N===G&&C(ee.length>0?ee[0].id:null)},U=async()=>{var G;if(o){b(!0);try{const ee={...o,sharedKnowledgeBase:w};if(await i(ee),o.title!==((G=l[0])==null?void 0:G.seriesName))for(const W of l)W.seriesName,o.title;te.success("Series saved successfully!")}catch(ee){te.error(`Failed to save: ${ee.message}`)}finally{b(!1)}}},V=async()=>{if(o){R(!0);try{const G=l.map(Z=>(Z.content||[]).filter($=>$).map($=>$.htmlContent).join(`

`)).join(`


`);if(!G.trim()){te.info("There is no content in any of the books to analyze."),R(!1);return}const ee=await f_(o.title,G),W=new Set(w.map(Z=>Z.name.toLowerCase())),Q=ee.filter(Z=>!W.has(Z.name.toLowerCase()));S(Z=>[...Z,...Q]),te.success(`Added ${Q.length} new knowledge sheets.`)}catch(G){te.error(`Auto-fill failed: ${G.message}`)}finally{R(!1)}}},q=w.find(G=>G.id===N);return f?d.jsx(sr,{message:"Loading series..."}):o?d.jsxs("div",{className:"flex flex-col h-screen bg-zinc-100 dark:bg-zinc-900",children:[d.jsx("header",{className:"flex-shrink-0 bg-white/80 dark:bg-zinc-800/80 backdrop-blur-sm border-b border-zinc-200 dark:border-zinc-700 pt-[env(safe-area-inset-top)]",children:d.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:d.jsxs("div",{className:"flex items-center justify-between h-16",children:[d.jsxs("div",{className:"flex items-center",children:[d.jsx("button",{onClick:()=>e("/"),"aria-label":"Back to dashboard",className:"p-3 mr-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700",children:d.jsx(H,{name:"CHEVRON_LEFT",className:"w-6 h-6"})}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx(H,{name:"LINK",className:"w-8 h-8 text-zinc-400"}),d.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight text-gray-900 dark:text-white truncate",children:o.title})]})]}),d.jsx("button",{onClick:U,disabled:g,className:"bg-indigo-600 text-white px-5 py-2.5 rounded-lg shadow-md hover:bg-indigo-700 disabled:bg-indigo-400",children:g?"Saving...":"Save Changes"})]})})}),d.jsx("main",{className:"flex-1 overflow-hidden p-4 sm:p-6 lg:p-8",children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-lg border border-zinc-200 dark:border-zinc-700 h-full flex flex-col",children:[d.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4 border-b border-zinc-200 dark:border-zinc-700",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"series-title-input",className:"text-sm font-medium text-zinc-600 dark:text-zinc-400",children:"Series Title"}),d.jsx("input",{id:"series-title-input",value:o.title,onChange:G=>_("title",G.target.value),className:"w-full text-lg font-bold bg-transparent focus:outline-none focus:ring-1 focus:ring-indigo-500 rounded-sm p-1 -ml-1"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"series-desc-input",className:"text-sm font-medium text-zinc-600 dark:text-zinc-400",children:"Series Description"}),d.jsx("textarea",{id:"series-desc-input",value:o.description||"",onChange:G=>_("description",G.target.value),rows:2,className:"w-full text-sm bg-transparent focus:outline-none focus:ring-1 focus:ring-indigo-500 rounded-sm p-1 -ml-1 resize-none",placeholder:"A brief synopsis of the series..."})]})]}),d.jsxs("div",{className:"flex-grow flex overflow-hidden",children:[d.jsxs("div",{className:"w-1/4 flex flex-col border-r border-zinc-200 dark:border-zinc-700",children:[d.jsx("div",{className:"p-2 flex-shrink-0",children:d.jsx("button",{onClick:P,className:"w-full text-sm font-semibold p-2 rounded-md bg-indigo-100 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-200 hover:bg-indigo-200 dark:hover:bg-indigo-900",children:"Add New Sheet"})}),d.jsx("ul",{className:"overflow-y-auto flex-grow p-2",children:w.map(G=>d.jsx("li",{children:d.jsx("button",{onClick:()=>C(G.id),className:`w-full text-left p-2 rounded-md text-sm truncate ${N===G.id?"bg-indigo-500 text-white":"hover:bg-zinc-100 dark:hover:bg-zinc-700"}`,children:G.name})},G.id))}),d.jsx("div",{className:"p-2 border-t border-zinc-200 dark:border-zinc-700",children:r&&d.jsxs("button",{onClick:V,disabled:M,className:"w-full flex items-center justify-center space-x-2 text-sm font-semibold py-2 px-3 rounded-md bg-indigo-100 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-200 hover:bg-indigo-200 dark:hover:bg-indigo-900 disabled:opacity-50",children:[d.jsx(H,{name:M?"ROTATE_CW":"WAND",className:`w-4 h-4 ${M?"animate-spin":""}`}),d.jsx("span",{children:M?"Analyzing...":"Auto-fill from Books"})]})})]}),d.jsx("div",{className:"w-1/2 flex flex-col",children:q?d.jsxs("div",{className:"flex-grow flex flex-col p-4",children:[d.jsx("input",{value:q.name,onChange:G=>j(q.id,"name",G.target.value),className:"text-lg font-bold bg-transparent focus:outline-none focus:ring-1 focus:ring-indigo-500 rounded-sm -ml-1 p-1 w-full"}),d.jsx("textarea",{value:q.content,onChange:G=>j(q.id,"content",G.target.value),placeholder:"Enter details for this knowledge sheet...",className:"text-sm text-zinc-600 dark:text-zinc-400 mt-2 flex-grow resize-none bg-transparent focus:outline-none focus:ring-1 focus:ring-indigo-500 rounded-sm -ml-1 p-1 w-full"}),d.jsx("button",{onClick:()=>D(q.id),className:"mt-2 text-red-500 text-xs self-start hover:underline",children:"Delete Sheet"})]}):d.jsx("div",{className:"flex items-center justify-center h-full text-zinc-500",children:d.jsx("p",{children:"Select or create a sheet to get started."})})}),d.jsx("div",{className:"w-1/4 border-l border-zinc-200 dark:border-zinc-700 flex flex-col",children:d.jsx(NF,{sheets:w,onNodeClick:C})})]})]})})]}):d.jsx("div",{className:"p-8 text-center",children:"Series not found."})},Wde=({book:n,progress:e,onOpen:t})=>{const s=Es(),i=Oa(),r=e.percentage||0,o=T.useMemo(()=>{const l=Math.floor((Date.now()-e.updatedAt)/1e3);if(l<60)return"Just now";const u=Math.floor(l/60);if(u<60)return`${u}m ago`;const f=Math.floor(u/60);return f<24?`${f}h ago`:`${Math.floor(f/24)}d ago`},[e.updatedAt]),a=()=>{t?t():s(`/reader/${n.id}`,{state:{from:i.pathname}})};return d.jsxs("div",{onClick:a,className:"group relative flex flex-col sm:flex-row bg-white dark:bg-zinc-800 rounded-2xl shadow-sm border border-zinc-200 dark:border-zinc-700 overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer h-full",children:[d.jsxs("div",{className:"sm:w-32 h-48 sm:h-auto flex-shrink-0 relative overflow-hidden bg-zinc-100 dark:bg-zinc-900",children:[n.coverImage?d.jsx("img",{src:n.coverImage,alt:n.topic,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}):d.jsx("div",{className:"w-full h-full flex items-center justify-center",children:d.jsx(H,{name:"BOOK",className:"w-10 h-10 text-zinc-300 dark:text-zinc-600"})}),d.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent sm:hidden"})]}),d.jsxs("div",{className:"flex-1 p-5 flex flex-col justify-between",children:[d.jsxs("div",{children:[d.jsx("div",{className:"flex justify-between items-start mb-2",children:d.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-indigo-600 dark:text-indigo-400 bg-indigo-50 dark:bg-indigo-900/30 px-2 py-1 rounded-full",children:o})}),d.jsx("h3",{className:"font-bold text-xl text-zinc-900 dark:text-zinc-100 mb-1 line-clamp-2 leading-tight group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors",children:n.topic}),n.author&&d.jsxs("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 mb-4 line-clamp-1",children:["by ",n.author]})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{children:[d.jsxs("div",{className:"flex justify-between text-xs font-medium text-zinc-500 dark:text-zinc-400 mb-1.5",children:[d.jsx("span",{children:"Progress"}),d.jsxs("span",{className:"text-zinc-900 dark:text-zinc-200",children:[r,"%"]})]}),d.jsx("div",{className:"h-2 w-full bg-zinc-100 dark:bg-zinc-700 rounded-full overflow-hidden",children:d.jsx("div",{className:"h-full bg-indigo-600 rounded-full transition-all duration-500 group-hover:bg-indigo-500",style:{width:`${r}%`}})})]}),d.jsxs("button",{className:"w-full py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-lg font-semibold text-sm opacity-0 group-hover:opacity-100 transform translate-y-2 group-hover:translate-y-0 transition-all duration-300 shadow-lg flex items-center justify-center space-x-2",children:[d.jsx(H,{name:"BOOK",className:"w-4 h-4"}),d.jsx("span",{children:"Continue Reading"})]})]})]})]})},Kde=()=>{const{books:n}=T.useContext(rs),e=Es(),t=Oa(),[s,i]=T.useState([]),[r,o]=T.useState(!0);T.useEffect(()=>{(async()=>{try{o(!0);const p=await Te.readingProgress.getAll(),g=new Map;n.forEach(w=>g.set(w.id,w));const b=[];p.forEach(w=>{if(g.has(w.bookId)){const S=g.get(w.bookId);b.push({book:S,progress:w})}}),b.sort((w,S)=>S.progress.updatedAt-w.progress.updatedAt),i(b)}catch(p){console.error("Failed to fetch reading progress",p)}finally{o(!1)}})()},[n]);const a=s.length>0?s[0]:null,l=s.length>1?s.slice(1):[],u=()=>{a&&e(`/reader/${a.book.id}`,{state:{from:t.pathname}})};return r?d.jsx(sr,{message:"Loading your library..."}):d.jsxs("div",{className:"min-h-screen pb-12 bg-zinc-50 dark:bg-zinc-900",children:[d.jsx("div",{className:"bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800 pt-8 pb-6 px-4 sm:px-6 lg:px-8 mb-8",children:d.jsxs("div",{className:"max-w-7xl mx-auto",children:[d.jsxs("h1",{className:"text-3xl font-bold tracking-tight text-zinc-900 dark:text-white flex items-center gap-3",children:[d.jsx(H,{name:"BOOK",className:"text-indigo-600 dark:text-indigo-400"}),"Currently Reading"]}),d.jsx("p",{className:"mt-2 text-zinc-500 dark:text-zinc-400",children:"Jump back into your stories."})]})}),d.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-12",children:[a?d.jsx("section",{className:"animate-fade-in-up",children:d.jsxs("div",{className:"relative rounded-3xl overflow-hidden bg-zinc-900 shadow-2xl group cursor-pointer",onClick:u,children:[d.jsx("div",{className:"absolute inset-0 opacity-40 dark:opacity-30 transition-opacity duration-700 group-hover:opacity-50",children:a.book.coverImage?d.jsx("img",{src:a.book.coverImage,alt:"",className:"w-full h-full object-cover blur-xl scale-110 transform transition-transform duration-[20s] group-hover:scale-125"}):d.jsx("div",{className:"w-full h-full bg-gradient-to-br from-indigo-900 to-purple-900"})}),d.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/80 via-black/50 to-transparent"}),d.jsxs("div",{className:"relative z-10 p-6 sm:p-10 md:p-12 flex flex-col md:flex-row items-start md:items-center gap-8",children:[d.jsx("div",{className:"flex-shrink-0 relative shadow-2xl rounded-lg overflow-hidden border border-white/10 w-32 sm:w-40 md:w-48 group-hover:-translate-y-2 transition-transform duration-500",children:a.book.coverImage?d.jsx("img",{src:a.book.coverImage,alt:a.book.topic,className:"w-full h-auto object-cover aspect-[2/3]"}):d.jsx("div",{className:"w-full aspect-[2/3] bg-white/10 flex items-center justify-center backdrop-blur-sm",children:d.jsx(H,{name:"BOOK",className:"w-12 h-12 text-white/50"})})}),d.jsxs("div",{className:"flex-1 text-white space-y-4",children:[d.jsxs("div",{className:"inline-flex items-center space-x-2 bg-indigo-600/80 backdrop-blur-md px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide border border-indigo-400/30",children:[d.jsx("span",{className:"w-2 h-2 rounded-full bg-white animate-pulse"}),d.jsx("span",{children:"Pick up where you left off"})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold leading-tight mb-2",children:a.book.topic}),a.book.author&&d.jsx("p",{className:"text-lg text-zinc-300 font-medium",children:a.book.author})]}),d.jsxs("div",{className:"max-w-md",children:[d.jsxs("div",{className:"flex justify-between text-sm font-medium text-zinc-300 mb-2",children:[d.jsxs("span",{children:[a.progress.percentage||0,"% Complete"]}),d.jsx("span",{children:"Last read recently"})]}),d.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden backdrop-blur-sm",children:d.jsx("div",{className:"h-full bg-indigo-500 shadow-[0_0_10px_rgba(99,102,241,0.6)]",style:{width:`${a.progress.percentage||0}%`}})})]}),d.jsx("div",{className:"pt-4",children:d.jsxs("button",{className:"bg-white text-zinc-900 px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-indigo-50 transition-colors flex items-center space-x-2 transform active:scale-95",children:[d.jsx(H,{name:"BOOK",className:"w-5 h-5"}),d.jsx("span",{children:"Continue Reading"})]})})]})]})]})}):d.jsxs("div",{className:"text-center py-24 bg-white dark:bg-zinc-800 rounded-3xl border border-dashed border-zinc-300 dark:border-zinc-700",children:[d.jsx("div",{className:"w-20 h-20 bg-zinc-100 dark:bg-zinc-700/50 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(H,{name:"BOOK",className:"w-10 h-10 text-zinc-400 dark:text-zinc-500"})}),d.jsx("h2",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100 mb-2",children:"No active reads"}),d.jsx("p",{className:"text-zinc-500 dark:text-zinc-400 max-w-md mx-auto mb-8",children:"Looks like you haven't started reading any books yet. Head over to your library to begin your next adventure."}),d.jsxs("button",{onClick:()=>e("/"),className:"bg-indigo-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-indigo-700 transition-colors shadow-md inline-flex items-center space-x-2",children:[d.jsx("span",{children:"Go to Library"}),d.jsx(H,{name:"CHEVRON_RIGHT",className:"w-4 h-4"})]})]}),l.length>0&&d.jsxs("section",{className:"animate-fade-in",style:{animationDelay:"0.2s"},children:[d.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[d.jsx("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100",children:"More in Progress"}),d.jsx("div",{className:"h-px flex-1 bg-zinc-200 dark:bg-zinc-800"})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:l.map(({book:f,progress:p})=>d.jsx(Wde,{book:f,progress:p,onOpen:()=>e(`/reader/${f.id}`,{state:{from:t.pathname}})},f.id))})]})]})]})},Yde=()=>{const{books:n,deleteBook:e,updateBook:t}=T.useContext(rs),[s,i]=T.useState(null),[r,o]=T.useState(null),[a,l]=T.useState(null),u=T.useMemo(()=>n.filter(g=>!g.deletedAt&&g.status==="archived"),[n]),f=(g,b)=>{const w=n.find(S=>S.id===g);w&&t({...w,coverImage:b}),i(null)},p=async g=>{await Mn.confirm({title:"Move to Trash?",message:"Are you sure you want to move this book to the trash?",danger:!0,confirmText:"Move to Trash"})&&await e(g)};return d.jsxs("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8",children:[s&&d.jsx(Z3,{book:s,allBooks:n,onClose:()=>i(null),onCoverGenerated:f}),r&&d.jsx(e4,{book:r,onClose:()=>o(null)}),a&&d.jsx(f4,{parentBook:a.parentBook,relationType:a.relationType,onClose:()=>l(null)}),d.jsxs("div",{className:"mb-8",children:[d.jsxs("h1",{className:"text-3xl font-bold tracking-tight text-gray-900 dark:text-white flex items-center gap-3",children:[d.jsx(H,{name:"ARCHIVE",className:"text-zinc-500 dark:text-zinc-400"}),"Archived Books"]}),d.jsx("p",{className:"mt-2 text-zinc-500 dark:text-zinc-400",children:"Books that you've set aside. They are safe here and can be unarchived anytime."})]}),u.length===0?d.jsxs("div",{className:"text-center py-20 bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-zinc-200 dark:border-zinc-700 empty-state-bg",children:[d.jsx(H,{name:"ARCHIVE",className:"w-20 h-20 mx-auto text-zinc-300 dark:text-zinc-600"}),d.jsx("h2",{className:"mt-4 text-2xl font-semibold text-zinc-800 dark:text-zinc-100",children:"No archived books"}),d.jsx("p",{className:"mt-2 text-zinc-500 dark:text-zinc-400",children:"Archive books from your library to declutter your workspace."})]}):d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8",children:u.map(g=>d.jsx(Zw,{book:g,onDelete:()=>p(g.id),onManageSnapshots:()=>o(g),onGenerateCover:()=>i(g),onCreateRelated:b=>l({parentBook:g,relationType:b})},g.id))})]})},Jde=()=>{const{books:n,deleteBook:e}=T.useContext(rs),t=T.useMemo(()=>n.filter(i=>!!i.deletedAt),[n]),s=async i=>{await Mn.confirm({title:"Delete Forever?",message:"This action cannot be undone. The book and all its history will be permanently removed.",danger:!0,confirmText:"Delete Forever"})&&await e(i)};return d.jsxs("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8",children:[d.jsxs("div",{className:"mb-8",children:[d.jsxs("h1",{className:"text-3xl font-bold tracking-tight text-gray-900 dark:text-white flex items-center gap-3",children:[d.jsx(H,{name:"TRASH",className:"text-red-500 dark:text-red-400"}),"Trash"]}),d.jsx("p",{className:"mt-2 text-zinc-500 dark:text-zinc-400",children:"Books in the trash can be restored or permanently deleted."})]}),t.length===0?d.jsxs("div",{className:"text-center py-20 bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-zinc-200 dark:border-zinc-700 empty-state-bg",children:[d.jsx(H,{name:"TRASH",className:"w-20 h-20 mx-auto text-zinc-300 dark:text-zinc-600"}),d.jsx("h2",{className:"mt-4 text-2xl font-semibold text-zinc-800 dark:text-zinc-100",children:"Trash is empty"}),d.jsx("p",{className:"mt-2 text-zinc-500 dark:text-zinc-400",children:"Deleted books will appear here."})]}):d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8",children:t.map(i=>d.jsx(Zw,{book:i,onDelete:()=>s(i.id),onManageSnapshots:()=>{},onGenerateCover:()=>{},onCreateRelated:()=>{},isDraggable:!1},i.id))})]})},Xde=({toast:n})=>{const[e,t]=T.useState(!1);T.useEffect(()=>{t(!0);const o=setTimeout(()=>{t(!1)},n.duration-500);return()=>clearTimeout(o)},[n]);const s="flex items-center w-full max-w-xs p-4 space-x-4 text-gray-500 bg-white rounded-lg shadow-lg dark:text-gray-400 dark:bg-gray-800 ring-1 ring-black ring-opacity-5 transition-all duration-300 ease-in-out",i=e?"translate-x-0 opacity-100":"translate-x-full opacity-0",r={success:"text-green-500 bg-green-100 dark:bg-green-800 dark:text-green-200",error:"text-red-500 bg-red-100 dark:bg-red-800 dark:text-red-200",info:"text-blue-500 bg-blue-100 dark:bg-blue-800 dark:text-blue-200"};return d.jsxs("div",{role:"alert",className:`${s} ${i}`,children:[d.jsx("div",{className:`inline-flex items-center justify-center flex-shrink-0 w-8 h-8 rounded-lg ${r[n.type]}`,children:d.jsx(H,{name:n.icon,className:"w-5 h-5"})}),d.jsx("div",{className:"text-sm font-normal flex-1",children:n.message}),d.jsxs("button",{type:"button",className:"ml-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700","aria-label":"Close",onClick:()=>te.removeToast(n.id),children:[d.jsx("span",{className:"sr-only",children:"Close"}),d.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:d.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]})},Qde=()=>{const[n,e]=T.useState([]);return T.useEffect(()=>{const t=te.subscribe(e);return()=>t()},[]),d.jsx("div",{className:"fixed top-4 right-4 z-[10001] w-full max-w-xs space-y-3",children:n.map(t=>d.jsx(Xde,{toast:t},t.id))})},Zde=({title:n,message:e,confirmText:t="Confirm",cancelText:s="Cancel",danger:i=!1,onConfirm:r,onCancel:o})=>{const a=i?"bg-red-600 hover:bg-red-700":"bg-indigo-600 hover:bg-indigo-700";return d.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[10001] p-4",onClick:o,children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl p-6 w-full max-w-md border border-zinc-300 dark:border-zinc-700 animate-slide-in-up",onClick:l=>l.stopPropagation(),children:[d.jsx("h2",{className:"text-xl font-bold text-zinc-800 dark:text-zinc-100",children:n}),d.jsx("div",{className:"text-zinc-600 dark:text-zinc-400 mt-4 space-y-3",children:e}),d.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[d.jsx("button",{onClick:o,className:"bg-zinc-200 dark:bg-zinc-600 text-zinc-800 dark:text-zinc-100 px-4 py-2 rounded-lg font-semibold hover:bg-zinc-300 dark:hover:bg-zinc-500 transition-colors",children:s}),d.jsx("button",{onClick:r,className:`text-white px-4 py-2 rounded-lg shadow font-semibold transition-colors ${a}`,children:t})]})]})})},eue=({title:n,message:e,inputLabel:t,initialValue:s="",confirmText:i="Save",cancelText:r="Cancel",danger:o=!1,onConfirm:a,onCancel:l})=>{const[u,f]=T.useState(s),p=T.useRef(null);T.useEffect(()=>{setTimeout(()=>{var S,N;(S=p.current)==null||S.focus(),(N=p.current)==null||N.select()},100)},[]);const g=()=>{a(u)},b=S=>{S.key==="Enter"&&g()},w=o?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700";return d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[10001] p-4 animate-fade-in",onClick:l,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-md border border-gray-300 dark:border-gray-700",onClick:S=>S.stopPropagation(),children:[d.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100",children:n}),e&&d.jsx("div",{className:"text-gray-600 dark:text-gray-400 mt-4 space-y-3",children:e}),d.jsxs("div",{className:"mt-4",children:[d.jsx("label",{htmlFor:"prompt-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t}),d.jsx("input",{ref:p,type:"text",id:"prompt-input",value:u,onChange:S=>f(S.target.value),onKeyDown:b,className:"mt-1 block w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"})]}),d.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[d.jsx("button",{onClick:l,className:"bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",children:r}),d.jsx("button",{onClick:g,className:`${w} text-white px-4 py-2 rounded-lg shadow font-semibold transition-colors`,children:i})]})]})})},tue=({title:n,message:e,closeText:t="OK",onClose:s})=>d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[10001] p-4 animate-fade-in",onClick:s,children:d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-md border border-gray-300 dark:border-gray-700",onClick:i=>i.stopPropagation(),children:[d.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100",children:n}),d.jsx("div",{className:"text-gray-600 dark:text-gray-400 mt-4 space-y-3",children:e}),d.jsx("div",{className:"mt-6 flex justify-end space-x-3",children:d.jsx("button",{onClick:s,className:"bg-blue-600 text-white px-4 py-2 rounded-lg shadow font-semibold hover:bg-blue-700 transition-colors",children:t})})]})}),nue=({modalState:n})=>{if(!n)return null;const{type:e,options:t}=n,s=()=>{Mn.handleCancel()},i=r=>{Mn.handleConfirm(r)};switch(e){case"confirm":return d.jsx(Zde,{...t,onConfirm:i,onCancel:s});case"prompt":return d.jsx(eue,{...t,onConfirm:i,onCancel:s});case"alert":return d.jsx(tue,{...t,onClose:i});default:return null}},sue=({onUndo:n,onRedo:e})=>{const[t,s]=T.useState(!1),[i,r]=T.useState(!1);T.useEffect(()=>Fc.subscribe(l=>{s(l.canUndo),r(l.canRedo)}),[]);const o=a=>`p-3 rounded-full text-zinc-600 dark:text-zinc-300 transition-all duration-200
        ${a?"bg-zinc-100 dark:bg-zinc-800 cursor-not-allowed opacity-40":"bg-white dark:bg-zinc-700 hover:bg-zinc-200 dark:hover:bg-zinc-600 shadow-lg hover:shadow-xl transform hover:-translate-y-1"}`;return d.jsxs("div",{className:"fixed bottom-6 right-6 z-50 flex items-center space-x-3",children:[d.jsx("button",{onClick:n,disabled:!t,className:o(!t),"aria-label":"Undo",title:"Undo (Ctrl+Z)",children:d.jsx(H,{name:"UNDO",className:"w-6 h-6"})}),d.jsx("button",{onClick:e,disabled:!i,className:o(!i),"aria-label":"Redo",title:"Redo (Ctrl+Y)",children:d.jsx(H,{name:"REDO",className:"w-6 h-6"})})]})},iue=({backupTimestamp:n,localTimestamp:e,onRestore:t,onDecline:s})=>{const[i,r]=T.useState(!1),o=async()=>{r(!0),await t()},a=new Date(n).toLocaleString(),l=new Date(e).toLocaleString(),u=e===0,f=u?"Welcome Back!":"Remote Backup Found",p=u?`We found a backup from ${a}. Would you like to restore it to pick up where you left off?`:`A server backup from ${a} is available. Your local data was last saved on ${l}.`,g=u?"":"Restoring will overwrite your current local data. This action cannot be undone.";return d.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center z-[10000] p-4 animate-fade-in",onClick:s,children:[i&&d.jsx(sr,{message:"Restoring from server..."}),d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-lg border border-gray-300 dark:border-gray-700",onClick:b=>b.stopPropagation(),children:[d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"mx-auto w-16 h-16 text-blue-500 flex items-center justify-center",children:d.jsx(H,{name:"UPLOAD",className:"w-10 h-10"})}),d.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 mt-4",children:f})]}),d.jsxs("div",{className:"text-gray-600 dark:text-gray-400 mt-4 text-center space-y-3",children:[d.jsx("p",{children:p}),g&&d.jsx("p",{className:"font-bold text-yellow-600 dark:text-yellow-400",children:g})]}),d.jsxs("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsx("button",{onClick:s,className:"w-full bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",children:u?"Start Fresh":"Keep Local Version"}),d.jsx("button",{onClick:o,className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg shadow font-semibold hover:bg-blue-700 transition-colors",children:"Restore Backup"})]})]})]})},rue=({fileContent:n,onClose:e,onRestoreSuccess:t})=>{const[s,i]=T.useState(!1),[r,o]=T.useState("initial"),[a,l]=T.useState([]),[u,f]=T.useState({}),[p,g]=T.useState(!1),[b,w]=T.useState(!0);T.useEffect(()=>{(async()=>{try{const j=JSON.parse(n);if(!j.books||!Array.isArray(j.books)){te.error("This does not appear to be a valid AI Book Studio backup file."),w(!1),e();return}const P=await Te.books.getAll(),D=new Set(P.map(q=>q.id)),U=j.books.map(q=>({book:q,isNew:!D.has(q.id)}));l(U);const V={};U.forEach(q=>{q.isNew&&(V[q.book.id]=!0)}),f(V)}catch{te.error("Invalid backup file. Could not parse JSON."),e()}finally{w(!1)}})()},[n,e]);const S=async()=>{i(!0);try{await Te.restore(n),await t()}catch(_){console.error("Full overwrite restore failed:",_);const j=_ instanceof Error?_.message:"An unknown error occurred.";te.error(`Restore failed. ${j}`)}finally{i(!1)}},N=async()=>{i(!0);try{const _=a.filter(j=>j.isNew&&u[j.book.id]).map(j=>j.book.id);if(_.length===0&&!p){te.info("No new books were selected to import, and overwrite is off."),i(!1);return}await Te.merge(n,{selectedNewBooks:_,overwriteExisting:p}),await t()}catch(_){console.error("Merge failed:",_);const j=_ instanceof Error?_.message:"An unknown error occurred.";te.error(`Merge failed. ${j}`)}finally{i(!1)}},C=(_,j)=>{f(P=>({...P,[_]:j}))},M=()=>d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"text-center",children:[d.jsx(H,{name:"UPLOAD",className:"mx-auto w-16 h-16 text-blue-500"}),d.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 mt-4",children:"Backup Detected"})]}),d.jsx("div",{className:"text-gray-600 dark:text-gray-400 mt-4 text-center",children:d.jsx("p",{children:"How would you like to restore from this backup file?"})}),d.jsxs("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsx("button",{onClick:()=>o("merge"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg shadow font-semibold hover:bg-blue-700 transition-colors",children:"Merge with Data"}),d.jsx("button",{onClick:S,className:"w-full bg-red-600 text-white px-6 py-3 rounded-lg shadow font-semibold hover:bg-red-700 transition-colors",children:"Full Overwrite"})]}),d.jsx("div",{className:"mt-4 flex justify-center",children:d.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 font-semibold py-2 px-4",children:"Cancel"})})]}),R=()=>d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Merge Backup"}),d.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Close modal",children:d.jsx(H,{name:"CLOSE",className:"w-6 h-6"})})]}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Select which new books to import. Existing books will not be changed unless you select the overwrite option below."}),d.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 border-y border-gray-200 dark:border-gray-700 py-3 my-3 pr-2 -mr-2",children:a.length>0?a.map(({book:_,isNew:j})=>d.jsxs("div",{className:"flex items-center p-2 rounded-md bg-gray-50 dark:bg-gray-700/50",children:[d.jsx("input",{type:"checkbox",id:`book-${_.id}`,checked:!!u[_.id],onChange:P=>C(_.id,P.target.checked),disabled:!j,className:"h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50"}),d.jsx("label",{htmlFor:`book-${_.id}`,className:`ml-3 flex-grow text-gray-800 dark:text-gray-200 truncate ${j?"cursor-pointer":"cursor-not-allowed"}`,children:_.topic}),j?d.jsx("span",{className:"flex-shrink-0 ml-2 text-xs font-semibold px-2 py-1 bg-green-200 text-green-800 rounded-full",children:"New"}):d.jsx("span",{className:"flex-shrink-0 ml-2 text-xs font-semibold px-2 py-1 bg-yellow-200 text-yellow-800 rounded-full",children:"Existing"})]},_.id)):d.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-4",children:"No books found in this backup file."})}),d.jsxs("div",{className:"flex items-start p-2",children:[d.jsx("input",{type:"checkbox",id:"overwrite-existing",checked:p,onChange:_=>g(_.target.checked),className:"h-5 w-5 mt-0.5 rounded border-gray-300 text-red-600 focus:ring-red-500"}),d.jsxs("label",{htmlFor:"overwrite-existing",className:"ml-3 text-sm text-gray-700 dark:text-gray-300",children:[d.jsx("span",{className:"font-semibold text-red-600 dark:text-red-400",children:"Overwrite existing books"}),d.jsx("br",{}),d.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"If a book in the backup has the same ID as a local book, the local version will be replaced."})]})]}),d.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[d.jsx("button",{onClick:()=>o("initial"),className:"bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",children:"Back"}),d.jsx("button",{onClick:N,className:"bg-blue-600 text-white px-6 py-2 rounded-lg shadow font-semibold hover:bg-blue-700 transition-colors",children:"Merge Selected"})]})]});return d.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 animate-fade-in",onClick:e,children:[s&&d.jsx(sr,{message:"Restoring..."}),d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-lg border border-gray-200 dark:border-gray-700",onClick:_=>_.stopPropagation(),children:b?d.jsxs("div",{className:"flex items-center justify-center p-8",children:[d.jsx("div",{className:"w-8 h-8 border-4 border-t-blue-500 border-gray-200 rounded-full animate-spin"}),d.jsx("p",{className:"ml-4 text-gray-600 dark:text-gray-300",children:"Analyzing backup file..."})]}):r==="initial"?M():R()})]})},oue=()=>{const[n,e]=T.useState({currentTask:null,queue:[],progress:null,isProcessing:!1}),[t,s]=T.useState(!1),[i,r]=T.useState(!1);if(T.useEffect(()=>_H.subscribe(e),[]),T.useEffect(()=>{const p=n.isProcessing||n.queue.length>0;if(p)s(!0),r(!1);else if(t&&!p){r(!0);const g=setTimeout(()=>{s(!1),r(!1)},4e3);return()=>clearTimeout(g)}},[n,t]),!t)return null;const{currentTask:o,queue:a,progress:l,isProcessing:u}=n,f=()=>i?d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-emerald-100 dark:bg-emerald-900 flex items-center justify-center text-emerald-600 dark:text-emerald-300",children:d.jsx(H,{name:"CLOUD_CHECK",className:"w-5 h-5"})}),d.jsxs("div",{children:[d.jsx("p",{className:"font-bold text-sm text-gray-800 dark:text-gray-100",children:"Queue complete"}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"All background tasks are finished."})]})]}):!o&&!u?null:d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-indigo-100 dark:bg-indigo-900 flex items-center justify-center text-indigo-600 dark:text-indigo-300",children:d.jsx(H,{name:"ROTATE_CW",className:"w-5 h-5 animate-spin"})}),d.jsxs("div",{className:"flex-1 overflow-hidden",children:[d.jsx("p",{className:"font-bold text-sm text-gray-800 dark:text-gray-100 truncate",title:o==null?void 0:o.name,children:(o==null?void 0:o.name)||"Processing..."}),d.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",title:(l==null?void 0:l.message)||"",children:(l==null?void 0:l.message)||"Starting task..."})]})]}),d.jsxs("div",{className:"mt-2.5",children:[d.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:"bg-indigo-600 h-2 rounded-full",style:{width:`${(l==null?void 0:l.percentage)||0}%`,transition:"width 0.3s ease-in-out"}})}),d.jsxs("div",{className:"flex justify-between items-center mt-1",children:[d.jsxs("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:[a.length," task(s) in queue"]}),d.jsxs("span",{className:"text-xs font-bold text-indigo-600 dark:text-indigo-400",children:[(l==null?void 0:l.percentage)||0,"%"]})]})]})]});return d.jsx("div",{className:`fixed bottom-5 left-5 z-[10000] w-80 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 p-4 transition-all duration-300 ease-in-out ${t?"translate-y-0 opacity-100":"translate-y-10 opacity-0"}`,children:f()})},aue=()=>{const{isOpen:n,commands:e}=BY(),{closePalette:t}=O3(),[s,i]=T.useState(""),[r,o]=T.useState(0),a=T.useRef(null),l=T.useRef(null);T.useEffect(()=>{n&&(i(""),o(0),setTimeout(()=>{var b;return(b=a.current)==null?void 0:b.focus()},100))},[n]);const u=T.useMemo(()=>{if(!s)return e;const b=s.toLowerCase();return e.filter(w=>{var S;return w.name.toLowerCase().includes(b)||((S=w.keywords)==null?void 0:S.toLowerCase().includes(b))||w.section.toLowerCase().includes(b)})},[s,e]),f=T.useMemo(()=>u.reduce((b,w)=>{const S=w.section||"General";return b[S]||(b[S]=[]),b[S].push(w),b},{}),[u]),p=T.useCallback(b=>{b.action(),t()},[t]),g=T.useCallback(b=>{if(b.key==="ArrowUp")b.preventDefault(),o(w=>w>0?w-1:u.length-1);else if(b.key==="ArrowDown")b.preventDefault(),o(w=>w<u.length-1?w+1:0);else if(b.key==="Enter"){const w=u[r];w&&(b.preventDefault(),p(w))}else b.key==="Escape"&&t()},[r,u,p,t]);return T.useEffect(()=>{var w;const b=(w=l.current)==null?void 0:w.querySelector(`[data-index="${r}"]`);b==null||b.scrollIntoView({block:"nearest"})},[r]),n?d.jsx("div",{className:"fixed inset-0 z-[10002] bg-black/60 backdrop-blur-sm p-4 pt-[20vh]",onClick:t,children:d.jsxs("div",{onClick:b=>b.stopPropagation(),className:"w-full max-w-xl mx-auto bg-white dark:bg-zinc-800 rounded-lg shadow-2xl overflow-hidden ring-1 ring-zinc-300 dark:ring-zinc-700 animate-slide-in-up",children:[d.jsxs("div",{className:"flex items-center p-3 border-b border-zinc-200 dark:border-zinc-700",children:[d.jsx(H,{name:"SEARCH",className:"w-5 h-5 text-zinc-400 mr-3"}),d.jsx("input",{ref:a,value:s,onChange:b=>{i(b.target.value),o(0)},onKeyDown:g,placeholder:"Type a command or search...",className:"w-full bg-transparent focus:outline-none text-zinc-800 dark:text-zinc-100"}),d.jsx("kbd",{className:"ml-4 px-2 py-1 text-xs font-semibold text-zinc-500 bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-md",children:"ESC"})]}),d.jsx("div",{className:"max-h-80 overflow-y-auto",children:u.length>0?d.jsx("ul",{ref:l,children:Object.entries(f).map(([b,w])=>d.jsxs("li",{children:[d.jsx("h3",{className:"px-4 pt-3 pb-1 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider",children:b}),d.jsx("ul",{children:w.map(S=>{const N=u.findIndex(C=>C.id===S.id);return d.jsx("li",{"data-index":N,onMouseEnter:()=>o(N),onClick:()=>p(S),className:`flex items-center justify-between px-4 py-2 mx-2 my-1 rounded-md cursor-pointer transition-colors ${N===r?"bg-indigo-600 text-white":"text-zinc-700 dark:text-zinc-200 hover:bg-zinc-100 dark:hover:bg-zinc-700"}`,children:d.jsxs("div",{className:"flex items-center space-x-3",children:[S.icon&&d.jsx(H,{name:S.icon,className:"w-5 h-5"}),d.jsx("span",{children:S.name})]})},S.id)})})]},b))}):d.jsxs("p",{className:"p-6 text-center text-zinc-500",children:['No results found for "',s,'".']})}),d.jsxs("div",{className:"p-2 bg-zinc-50 dark:bg-zinc-900 border-t border-zinc-200 dark:border-zinc-700 text-xs text-zinc-500 dark:text-zinc-400 flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsxs("span",{children:["Navigate: ",d.jsx("kbd",{className:"font-sans",children:""})," ",d.jsx("kbd",{className:"font-sans",children:""})]}),d.jsxs("span",{children:["Select: ",d.jsx("kbd",{className:"font-sans",children:""})]})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx(H,{name:"COMMAND",className:"w-5 h-5"}),d.jsx("span",{children:"Command Palette"})]})]})]})}):null},lue=()=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-8 h-8 text-red-600 dark:text-red-300",children:[d.jsx("path",{d:"M22.61 16.95A5 5 0 0 0 18 10h-1.26a8 8 0 0 0-7.05-6M5 5a8 8 0 0 0 4 15h9a5 5 0 0 0 1.7-.3"}),d.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]});class cue extends T.Component{constructor(){super(...arguments),this.state={hasError:!1,error:void 0,errorInfo:void 0}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Uncaught error:",e,t),this.setState({error:e,errorInfo:t})}render(){var e;return this.state.hasError?d.jsx("div",{className:"flex h-screen w-screen items-center justify-center bg-zinc-100 dark:bg-zinc-900 fixed inset-0 z-[99999]",children:d.jsxs("div",{className:"max-w-xl rounded-lg bg-white dark:bg-zinc-800 p-8 text-center shadow-2xl border border-red-200 dark:border-red-900",children:[d.jsx("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-red-100 dark:bg-red-900",children:d.jsx(lue,{})}),d.jsx("h1",{className:"mt-4 text-2xl font-bold tracking-tight text-zinc-900 dark:text-white",children:"Something went wrong"}),d.jsx("p",{className:"mt-2 text-zinc-600 dark:text-zinc-400",children:"An unexpected error occurred. Please try refreshing the page."}),this.state.error&&d.jsxs("details",{className:"mt-4 text-left text-xs bg-zinc-50 dark:bg-zinc-900/50 p-3 rounded-md border border-zinc-200 dark:border-zinc-700",children:[d.jsx("summary",{className:"cursor-pointer font-semibold text-zinc-500",children:"Error Details"}),d.jsxs("pre",{className:"mt-2 whitespace-pre-wrap font-mono text-zinc-600 dark:text-zinc-400 overflow-auto max-h-40",children:[this.state.error.toString(),(e=this.state.errorInfo)==null?void 0:e.componentStack]})]}),d.jsx("div",{className:"mt-6",children:d.jsx("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center rounded-md bg-indigo-600 px-5 py-2.5 text-center text-sm font-semibold text-white shadow-sm hover:bg-indigo-700",children:"Reload Page"})})]})}):this.props.children}}const bN=[.75,1,1.25,1.5,2],wO=({isPlaying:n})=>d.jsxs("div",{className:"flex items-end space-x-0.5 h-4 w-5 justify-center overflow-hidden",children:[d.jsx("div",{className:`w-1 bg-indigo-500 rounded-t ${n?"animate-music-bar-1":"h-1"}`}),d.jsx("div",{className:`w-1 bg-indigo-500 rounded-t ${n?"animate-music-bar-2":"h-2"}`}),d.jsx("div",{className:`w-1 bg-indigo-500 rounded-t ${n?"animate-music-bar-3":"h-1.5"}`})]}),due=()=>{const{audiobookState:n,books:e,pauseAudiobook:t,resumeAudiobook:s,stopAudiobook:i,skipAudiobookChapter:r,setPlaybackRate:o,setAudiobookVolume:a,jumpToParagraph:l,skipParagraph:u}=T.useContext(rs),[f,p]=T.useState({x:0,y:0}),[g,b]=T.useState(!1),[w,S]=T.useState(!1),[N,C]=T.useState(1),[M,R]=T.useState(!1),_=T.useRef({x:0,y:0}),j=T.useRef(null),P=T.useRef(null),{playbackState:D,bookTitle:U,currentChapterTitle:V,chapterProgress:q,playbackRate:G,totalParagraphsInChapter:ee,bookId:W}=n,Q=T.useMemo(()=>e.find(F=>F.id===W),[e,W]),Z=D==="playing",$=F=>{F.target.closest("button")||F.target.closest("input")||(b(!0),_.current={x:F.clientX-f.x,y:F.clientY-f.y})};T.useEffect(()=>{const F=ie=>{if(!g||!j.current)return;const pe=ie.clientX-_.current.x,ue=ie.clientY-_.current.y;p({x:pe,y:ue})},J=()=>{if(g&&j.current){const ie=j.current.getBoundingClientRect(),pe=window.innerWidth;if(pe-(ie.left+ie.width),ie.left+ie.width/2<pe/2){const ue=-(pe-ie.width-48);p(ke=>({...ke,x:ue}))}else p(ue=>({...ue,x:0}))}b(!1)};return g&&(window.addEventListener("mousemove",F),window.addEventListener("mouseup",J)),()=>{window.removeEventListener("mousemove",F),window.removeEventListener("mouseup",J)}},[g]);const Y=F=>{if(!P.current||ee===0)return;const J=P.current.getBoundingClientRect(),ie=F.clientX-J.left,pe=Math.max(0,Math.min(1,ie/J.width)),ue=Math.floor(ee*pe);l(ue)},he=()=>{const J=(bN.indexOf(G)+1)%bN.length;o(bN[J])},Re=F=>{const J=parseFloat(F.target.value);C(J),a(J)};if(D==="stopped")return null;const ze=Q==null?void 0:Q.coverImage;return w?d.jsxs("div",{ref:j,className:"fixed bottom-24 right-6 z-[1000] bg-white/90 dark:bg-zinc-800/90 backdrop-blur-md rounded-full shadow-xl border border-zinc-200 dark:border-zinc-700 p-2 flex items-center space-x-3 cursor-grab active:cursor-grabbing select-none transition-transform hover:scale-105 hover:shadow-2xl",style:{transform:`translate(${f.x}px, ${f.y}px)`},onMouseDown:$,children:[d.jsxs("div",{className:"relative",children:[ze?d.jsx("img",{src:ze,alt:"Cover",className:`w-10 h-10 rounded-full object-cover border border-zinc-200 dark:border-zinc-600 ${Z?"animate-spin-slow":""}`,style:{animationDuration:"8s"}}):d.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center text-indigo-600 dark:text-indigo-400",children:d.jsx(H,{name:"HEADPHONES",className:"w-5 h-5"})}),Z&&d.jsx("div",{className:"absolute -bottom-1 -right-1 bg-white dark:bg-zinc-800 rounded-full p-0.5 border border-zinc-100 dark:border-zinc-700",children:d.jsx(wO,{isPlaying:!0})})]}),d.jsxs("div",{className:"flex items-center pr-2 space-x-2",children:[d.jsx("button",{onClick:Z?t:s,className:"p-2 rounded-full bg-indigo-600 text-white hover:bg-indigo-700 transition-colors shadow-sm",children:d.jsx(H,{name:Z?"PAUSE":"PLAY",className:"w-4 h-4 fill-current"})}),d.jsx("button",{onClick:()=>S(!1),className:"p-1.5 text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-200 transition-colors",children:d.jsx(H,{name:"EXPAND",className:"w-4 h-4"})})]})]}):d.jsxs("div",{ref:j,className:"fixed bottom-24 right-6 z-[1000] w-80 bg-white/95 dark:bg-zinc-800/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-zinc-200/50 dark:border-zinc-700/50 overflow-hidden flex flex-col transition-all duration-200 group",style:{transform:`translate(${f.x}px, ${f.y}px)`},onMouseDown:$,children:[d.jsxs("div",{className:"flex items-start p-4 pb-0 cursor-grab active:cursor-grabbing relative",children:[d.jsxs("div",{className:"flex-shrink-0 mr-4 relative",children:[ze?d.jsx("img",{src:ze,alt:"Cover",className:"w-16 h-24 object-cover rounded-md shadow-md"}):d.jsx("div",{className:"w-16 h-24 bg-zinc-100 dark:bg-zinc-700 rounded-md flex items-center justify-center shadow-inner",children:d.jsx(H,{name:"IMAGE",className:"w-8 h-8 text-zinc-300 dark:text-zinc-500"})}),d.jsx("div",{className:"absolute bottom-1 left-1 right-1 flex justify-center opacity-80",children:d.jsx(wO,{isPlaying:Z})})]}),d.jsxs("div",{className:"flex-grow min-w-0 pt-1",children:[d.jsx("h4",{className:"font-bold text-zinc-800 dark:text-zinc-100 text-sm leading-tight line-clamp-2 mb-1",children:U||"Unknown Book"}),d.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 font-medium truncate",children:V||"Loading Chapter..."}),d.jsxs("div",{className:"mt-3 flex items-center space-x-2",children:[d.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium ${Z?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bg-zinc-100 text-zinc-600 dark:bg-zinc-700 dark:text-zinc-400"}`,children:D==="loading"?"Buffering...":Z?"Playing":"Paused"}),d.jsxs("button",{onClick:he,className:"text-[10px] font-bold bg-zinc-100 dark:bg-zinc-700 hover:bg-zinc-200 dark:hover:bg-zinc-600 px-2 py-0.5 rounded transition-colors",children:[G,"x"]})]})]}),d.jsx("button",{onClick:()=>S(!0),className:"absolute top-2 right-2 p-2 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200 transition-colors rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-700/50",children:d.jsx(H,{name:"CLOSE",className:"w-4 h-4",style:{transform:"rotate(45deg)"}})})]}),d.jsxs("div",{className:"px-4 mt-4",children:[d.jsx("div",{ref:P,onClick:Y,className:"w-full h-1.5 bg-zinc-200 dark:bg-zinc-700 rounded-full cursor-pointer group/scrubber relative",children:d.jsx("div",{className:"absolute top-0 left-0 h-full bg-indigo-500 rounded-full transition-all duration-100 ease-linear",style:{width:`${q}%`},children:d.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white border-2 border-indigo-600 rounded-full opacity-0 group-hover/scrubber:opacity-100 transition-opacity shadow-sm transform scale-125"})})}),d.jsxs("div",{className:"flex justify-between mt-1",children:[d.jsx("span",{className:"text-[10px] text-zinc-400 font-mono",children:"0:00"}),d.jsx("span",{className:"text-[10px] text-zinc-400 font-mono",children:"--:--"})]})]}),d.jsxs("div",{className:"flex items-center justify-between px-4 pb-4 mt-2",children:[d.jsx("button",{onClick:()=>r("prev"),className:"p-2 text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200 transition-colors rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-700/30",title:"Previous Chapter",children:d.jsx(H,{name:"SKIP_BACK",className:"w-5 h-5"})}),d.jsx("button",{onClick:()=>u("prev"),className:"p-2 text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-100 transition-colors rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-700/30",title:"Rewind Sentence",children:d.jsx(H,{name:"UNDO",className:"w-5 h-5"})}),d.jsx("button",{onClick:Z?t:s,className:"w-12 h-12 flex items-center justify-center bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 hover:scale-105 active:scale-95 transition-all",children:d.jsx(H,{name:Z?"PAUSE":"PLAY",className:"w-6 h-6 fill-current"})}),d.jsx("button",{onClick:()=>u("next"),className:"p-2 text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-100 transition-colors rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-700/30",title:"Fast Forward Sentence",children:d.jsx(H,{name:"REDO",className:"w-5 h-5"})}),d.jsx("button",{onClick:()=>r("next"),className:"p-2 text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200 transition-colors rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-700/30",title:"Next Chapter",children:d.jsx(H,{name:"SKIP_FORWARD",className:"w-5 h-5"})})]}),d.jsxs("div",{className:"px-4 pb-3 flex justify-between items-center gap-3",children:[d.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>R(!0),onMouseLeave:()=>R(!1),children:[d.jsx("button",{className:"p-1.5 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300",children:N===0?d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),d.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),d.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}):d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),d.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"}),d.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})]})}),d.jsx("div",{className:`absolute bottom-full left-0 mb-1 bg-white dark:bg-zinc-800 p-2 rounded-lg shadow-lg border border-zinc-200 dark:border-zinc-700 transition-all duration-200 origin-bottom ${M?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,children:d.jsx("div",{className:"h-24 w-6 flex justify-center",children:d.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:N,onChange:Re,className:"w-1 h-20 bg-zinc-200 dark:bg-zinc-600 rounded-lg appearance-none cursor-pointer accent-indigo-600",style:{writingMode:"vertical-lr",WebkitAppearance:"slider-vertical"}})})})]}),d.jsx("button",{onClick:i,className:"flex-grow py-1.5 px-3 text-xs font-medium text-red-500 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/40 rounded-md transition-colors text-center",children:"Stop Playback"})]})]})},uue=()=>{const[n,e]=T.useState({status:"idle",progress:0,message:"",error:null,bookTitle:"",totalFiles:0,completedFiles:0}),[t,s]=T.useState({x:20,y:20}),[i,r]=T.useState(!1),[o,a]=T.useState(!1),l=T.useRef({x:0,y:0}),u=T.useRef(null);T.useEffect(()=>ep.subscribe(e),[]);const f=b=>{b.target.closest("button")||(r(!0),l.current={x:b.clientX-t.x,y:b.clientY-t.y})};if(T.useEffect(()=>{const b=S=>{i&&s({x:S.clientX-l.current.x,y:S.clientY-l.current.y})},w=()=>r(!1);return i&&(window.addEventListener("mousemove",b),window.addEventListener("mouseup",w)),()=>{window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",w)}},[i]),n.status==="idle"||n.status==="cancelled")return null;const p=n.status==="error",g=n.status==="completed";return d.jsx("div",{ref:u,className:`fixed bottom-6 left-6 z-[9999] bg-white dark:bg-zinc-800 rounded-xl shadow-2xl border border-zinc-200 dark:border-zinc-700 overflow-hidden transition-all duration-200 ${i?"cursor-grabbing":"cursor-grab"}`,style:{transform:`translate(${t.x-20}px, ${t.y-20}px)`,width:o?"auto":"320px"},onMouseDown:f,children:o?d.jsxs("div",{className:"p-3 flex items-center space-x-3",children:[p?d.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}):g?d.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}):d.jsx("div",{className:"w-3 h-3 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin"}),d.jsx("span",{className:"font-bold text-sm text-zinc-800 dark:text-zinc-100",children:"Audiobook"}),d.jsx("button",{onClick:()=>a(!1),className:"ml-2 text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-200",children:d.jsx(H,{name:"EXPAND",className:"w-4 h-4"})})]}):d.jsxs("div",{className:"p-4",children:[d.jsxs("div",{className:"flex justify-between items-start mb-3",children:[d.jsxs("div",{children:[d.jsxs("h4",{className:"font-bold text-sm text-zinc-800 dark:text-zinc-100 flex items-center gap-2",children:[p?d.jsx(H,{name:"CLOUD_OFF",className:"w-4 h-4 text-red-500"}):g?d.jsx(H,{name:"CLOUD_CHECK",className:"w-4 h-4 text-green-500"}):d.jsx(H,{name:"HEADPHONES",className:"w-4 h-4 text-indigo-500"}),d.jsx("span",{children:"Audiobook Download"})]}),d.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 truncate max-w-[200px]",children:n.bookTitle})]}),d.jsx("button",{onClick:()=>a(!0),className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:d.jsx(H,{name:"CLOSE",className:"w-4 h-4",style:{transform:"rotate(45deg)"}})})]}),!p&&!g&&d.jsxs("div",{className:"mb-3",children:[d.jsx("div",{className:"w-full bg-zinc-200 dark:bg-zinc-700 rounded-full h-2 mb-1",children:d.jsx("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${n.progress}%`}})}),d.jsxs("div",{className:"flex justify-between text-[10px] text-zinc-500 dark:text-zinc-400",children:[d.jsxs("span",{children:[n.completedFiles," / ",n.totalFiles," files"]}),d.jsxs("span",{children:[Math.round(n.progress),"%"]})]})]}),d.jsx("p",{className:`text-xs mb-4 ${p?"text-red-600 dark:text-red-400 font-medium":"text-zinc-600 dark:text-zinc-300"}`,children:n.message}),d.jsx("div",{className:"flex gap-2",children:p?d.jsxs(d.Fragment,{children:[d.jsx("button",{onClick:()=>ep.cancel(),className:"flex-1 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-200 text-xs font-semibold rounded-lg hover:bg-zinc-200 dark:hover:bg-zinc-600 transition-colors",children:"Discard"}),d.jsx("button",{onClick:()=>ep.downloadPartial(),className:"flex-1 px-3 py-1.5 bg-indigo-600 text-white text-xs font-semibold rounded-lg hover:bg-indigo-700 transition-colors",children:"Download Partial"})]}):g?d.jsx("button",{onClick:()=>ep.reset(),className:"w-full px-3 py-1.5 bg-green-600 text-white text-xs font-semibold rounded-lg hover:bg-green-700 transition-colors",children:"Close"}):d.jsx("button",{onClick:()=>ep.cancel(),className:"w-full px-3 py-1.5 border border-red-200 dark:border-red-900/50 text-red-600 dark:text-red-400 text-xs font-semibold rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:"Cancel Download"})})]})})},hue=()=>{const[n,e]=T.useState(!1),[t,s]=T.useState(null),[i,r]=T.useState(null),[o,a]=T.useState(null);T.useEffect(()=>v0.subscribe(f=>{e(f.isConflict),f.isConflict&&(s(v0.getDiffSummary()),r(new Date(f.remoteTimestamp)),a(new Date(f.localTimestamp)))}),[]);const l=u=>{v0.resolve(u)};return!n||!t?null:d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[10005] p-4 animate-fade-in",children:d.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-2xl shadow-2xl w-full max-w-4xl border border-red-200 dark:border-red-900 overflow-hidden flex flex-col max-h-[90vh]",children:[d.jsxs("div",{className:"p-6 bg-red-50 dark:bg-red-900/20 border-b border-red-100 dark:border-red-800 flex items-center gap-4",children:[d.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-800/50 rounded-full text-red-600 dark:text-red-200",children:d.jsx(H,{name:"ALERT_TRIANGLE",className:"w-8 h-8"})}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:"Sync Conflict Detected"}),d.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm mt-1",children:"The server has a newer version of your data than the last time you synced."})]})]}),d.jsxs("div",{className:"flex-grow overflow-y-auto p-6 grid grid-cols-1 md:grid-cols-2 gap-8 relative",children:[d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"bg-zinc-100 dark:bg-zinc-700/50 p-4 rounded-xl border border-zinc-200 dark:border-zinc-600",children:[d.jsxs("h3",{className:"font-bold text-lg text-zinc-800 dark:text-zinc-100 flex items-center gap-2",children:[d.jsx(H,{name:"EDIT",className:"w-5 h-5 text-indigo-500"}),"On This Device (Local)"]}),d.jsxs("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mt-1",children:["Last Active: ",o==null?void 0:o.toLocaleString()]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between text-sm p-2 bg-zinc-50 dark:bg-zinc-800 rounded border border-zinc-200 dark:border-zinc-700",children:[d.jsx("span",{children:"Total Books:"}),d.jsx("span",{className:"font-bold",children:t.localCount})]}),t.newerInLocal.length>0&&d.jsxs("div",{className:"p-3 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-lg",children:[d.jsxs("p",{className:"text-xs font-bold text-emerald-700 dark:text-emerald-400 uppercase mb-2",children:["Newer Locally (",t.newerInLocal.length,")"]}),d.jsx("ul",{className:"text-sm space-y-1 list-disc list-inside",children:t.newerInLocal.map(u=>d.jsx("li",{className:"truncate",children:u.topic},u.id))})]}),t.booksOnlyInLocal.length>0&&d.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[d.jsxs("p",{className:"text-xs font-bold text-blue-700 dark:text-blue-400 uppercase mb-2",children:["Only on this device (",t.booksOnlyInLocal.length,")"]}),d.jsx("ul",{className:"text-sm space-y-1 list-disc list-inside",children:t.booksOnlyInLocal.map(u=>d.jsx("li",{className:"truncate",children:u.topic},u.id))})]})]})]}),d.jsx("div",{className:"hidden md:block absolute left-1/2 top-6 bottom-6 w-px bg-zinc-200 dark:bg-zinc-700"}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"bg-zinc-100 dark:bg-zinc-700/50 p-4 rounded-xl border border-zinc-200 dark:border-zinc-600",children:[d.jsxs("h3",{className:"font-bold text-lg text-zinc-800 dark:text-zinc-100 flex items-center gap-2",children:[d.jsx(H,{name:"CLOUD",className:"w-5 h-5 text-sky-500"}),"In The Cloud (Remote)"]}),d.jsxs("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mt-1",children:["Last Active: ",i==null?void 0:i.toLocaleString()]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between text-sm p-2 bg-zinc-50 dark:bg-zinc-800 rounded border border-zinc-200 dark:border-zinc-700",children:[d.jsx("span",{children:"Total Books:"}),d.jsx("span",{className:"font-bold",children:t.remoteCount})]}),t.newerInRemote.length>0&&d.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:[d.jsxs("p",{className:"text-xs font-bold text-amber-700 dark:text-amber-400 uppercase mb-2",children:["Newer on Server (",t.newerInRemote.length,")"]}),d.jsx("ul",{className:"text-sm space-y-1 list-disc list-inside",children:t.newerInRemote.map(u=>d.jsx("li",{className:"truncate",children:u.topic},u.id))})]}),t.booksOnlyInRemote.length>0&&d.jsxs("div",{className:"p-3 bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800 rounded-lg",children:[d.jsxs("p",{className:"text-xs font-bold text-indigo-700 dark:text-indigo-400 uppercase mb-2",children:["Only on Server (",t.booksOnlyInRemote.length,")"]}),d.jsx("ul",{className:"text-sm space-y-1 list-disc list-inside",children:t.booksOnlyInRemote.map(u=>d.jsx("li",{className:"truncate",children:u.topic},u.id))})]})]})]})]}),d.jsxs("div",{className:"p-6 bg-zinc-50 dark:bg-zinc-900/50 border-t border-zinc-200 dark:border-zinc-800 flex flex-col sm:flex-row gap-4 justify-between items-center",children:[d.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 italic",children:"Tip: Smart Merge combines books from both sides, keeping the latest version of each book."}),d.jsxs("div",{className:"flex gap-3 w-full sm:w-auto",children:[d.jsx("button",{onClick:()=>l("use_local"),className:"flex-1 sm:flex-none px-4 py-2 rounded-lg border border-red-300 dark:border-red-800 text-red-700 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 text-sm font-semibold transition-colors",children:"Overwrite Server"}),d.jsx("button",{onClick:()=>l("use_remote"),className:"flex-1 sm:flex-none px-4 py-2 rounded-lg border border-zinc-300 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300 hover:bg-zinc-100 dark:hover:bg-zinc-800 text-sm font-semibold transition-colors",children:"Overwrite Local"}),d.jsxs("button",{onClick:()=>l("smart_merge"),className:"flex-1 sm:flex-none px-6 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-bold shadow-md transition-colors flex items-center justify-center gap-2",children:[d.jsx(H,{name:"SYNTHESIZE",className:"w-4 h-4"}),"Smart Merge"]})]})]})]})})},fue=()=>{const n=Es(),[e,t]=T.useState(null),[s,i]=T.useState(!1),[r,o]=T.useState(!1),a=80,l=90;if(T.useEffect(()=>{const w=async()=>{if(r)return;const N=await RH();N&&N.percentUsed>a?(t(N),i(!0)):i(!1)};w();const S=setInterval(w,6e4);return()=>clearInterval(S)},[r]),!s||!e)return null;const u=e.percentUsed>l,f=u?"bg-red-50 dark:bg-red-900/30":"bg-amber-50 dark:bg-amber-900/30",p=u?"border-red-200 dark:border-red-800":"border-amber-200 dark:border-amber-800",g=u?"text-red-500":"text-amber-500",b=u?"text-red-800 dark:text-red-200":"text-amber-800 dark:text-amber-200";return d.jsx("div",{className:`fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-[9998] p-4 rounded-xl border shadow-lg backdrop-blur-md animate-slide-in-up ${f} ${p}`,children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("div",{className:`p-2 rounded-full bg-white/50 dark:bg-black/20 ${g}`,children:d.jsx(H,{name:"ALERT_TRIANGLE",className:"w-6 h-6"})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:`font-bold text-sm ${b}`,children:u?"Storage Critical":"Storage Running Low"}),d.jsxs("p",{className:`text-xs mt-1 ${b} opacity-90`,children:["You have used ",e.percentUsed.toFixed(1),"% of your available browser storage.",u?" Please backup and delete old data immediately to prevent data loss.":" Consider backing up and clearing unused data."]}),d.jsxs("div",{className:"mt-3 flex gap-2",children:[d.jsx("button",{onClick:()=>{o(!0),n("/settings")},className:`px-3 py-1.5 text-xs font-semibold rounded-md shadow-sm bg-white dark:bg-zinc-800 hover:bg-gray-50 dark:hover:bg-zinc-700 transition-colors ${g}`,children:"Manage Data"}),d.jsx("button",{onClick:()=>o(!0),className:`px-3 py-1.5 text-xs font-semibold rounded-md transition-colors hover:bg-black/5 dark:hover:bg-white/5 ${b}`,children:"Dismiss"})]})]})]})})},pue=()=>{const[n,e]=T.useState(null),[t,s]=T.useState(!1);T.useEffect(()=>{const r=o=>{o.preventDefault(),e(o),s(!0)};return window.addEventListener("beforeinstallprompt",r),()=>window.removeEventListener("beforeinstallprompt",r)},[]);const i=async()=>{if(!n)return;n.prompt();const{outcome:r}=await n.userChoice;console.log(r==="accepted"?"User accepted the install prompt":"User dismissed the install prompt"),e(null),s(!1)};return t?d.jsx("div",{className:"fixed bottom-4 left-4 right-4 z-[9999] animate-fade-in-up",children:d.jsxs("div",{className:"bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 p-4 rounded-xl shadow-2xl flex items-center justify-between border border-zinc-700 dark:border-zinc-200",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("div",{className:"p-2 bg-indigo-600 rounded-lg text-white",children:d.jsx(H,{name:"DOWNLOAD",className:"w-5 h-5"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-sm",children:"Install App"}),d.jsx("p",{className:"text-xs opacity-80",children:"Add to Home Screen for offline access"})]})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("button",{onClick:()=>s(!1),className:"p-2 hover:bg-zinc-800 dark:hover:bg-zinc-100 rounded-lg transition-colors","aria-label":"Dismiss",children:d.jsx(H,{name:"CLOSE",className:"w-4 h-4"})}),d.jsx("button",{onClick:i,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-bold rounded-lg transition-colors",children:"Install"})]})]})}):null},mue=({onRefresh:n,children:e,className:t="",scrollRef:s})=>{const[i,r]=T.useState(0),[o,a]=T.useState(!1),l=T.useRef(null),u=s||l,f=T.useRef(0),p=80,g=S=>{u.current&&u.current.scrollTop<=1?f.current=S.touches[0].clientY:f.current=0},b=S=>{if(!f.current||o||u.current&&u.current.scrollTop>1)return;const C=S.touches[0].clientY-f.current;if(C>0){const M=Math.pow(C,.8)*1.5;r(Math.min(M,p*2)),S.cancelable&&C<200}else r(0)},w=async()=>{if(!(!f.current||o)){if(i>p){a(!0),r(p);try{await n()}finally{a(!1)}}r(0),f.current=0}};return d.jsxs("div",{className:`relative flex flex-col h-full overflow-hidden ${t}`,children:[d.jsx("div",{className:"absolute top-0 left-0 right-0 flex justify-center items-start pointer-events-none z-20",style:{height:`${Math.max(i,o?p:0)}px`,transition:o?"height 0.2s":"height 0.2s cubic-bezier(0,0,0.2,1)"},children:d.jsx("div",{className:"bg-white dark:bg-zinc-800 rounded-full p-2 shadow-md border border-zinc-200 dark:border-zinc-700 mt-4 flex items-center justify-center transform transition-all",style:{transform:`scale(${Math.min(i/p,1)}) rotate(${i*2}deg)`,opacity:Math.min(i/(p*.5),1)},children:d.jsx(H,{name:o?"ROTATE_CW":"CLOUD_CHECK",className:`w-5 h-5 text-indigo-600 ${o?"animate-spin":""}`})})}),d.jsx("div",{ref:u,className:"flex-1 overflow-y-auto overscroll-y-contain relative z-10",onTouchStart:g,onTouchMove:b,onTouchEnd:w,style:{transform:`translateY(${i}px)`,transition:o?"transform 0.2s":"transform 0.2s cubic-bezier(0,0,0.2,1)"},children:e})]})},gue=()=>d.jsx(cue,{children:d.jsx(eJ,{children:d.jsx(PY,{children:d.jsx(LY,{children:d.jsx(y8,{children:d.jsx(xue,{})})})})})}),xue=()=>{const n=Oa(),e=Es(),{createNewBook:t,createNewDocument:s}=T.useContext(rs),{openPalette:i,registerCommands:r,unregisterCommands:o}=O3(),[a,l]=T.useState(!1),[u,f]=T.useState("dashboard"),[p,g]=T.useState(null),[b,w]=T.useState(null),[S,N]=T.useState(null),[C,M]=T.useState(!navigator.onLine),[R,_]=T.useState(!1),[j,P]=T.useState(null),[D,U]=T.useState(!1),[V,q]=T.useState(""),[G,ee]=T.useState(0),[W,Q]=T.useState(0),[Z,$]=T.useState(null),[Y,he]=T.useState(null),[Re,ze]=T.useState(!1),F=T.useRef(null),J=T.useRef(null),ie=T.useCallback(()=>{e("/dashboard")},[e]);T.useEffect(()=>{(async()=>{try{if(await Te.init(),await Fc.init(),await WY(),await w_(),J3(),"caches"in window)try{const Pe=await caches.open("share-target-cache"),ot=await Pe.match("/shared-content");if(ot){const Gt=await ot.json();if(await Pe.delete("/shared-content"),Gt.text||Gt.url){const bn=`${Gt.text}

${Gt.url}`,qt=await s(Gt.title||"Shared Content"),jt=await Te.documents.get(qt);jt&&(await Te.documents.put({...jt,content:`<p>${bn.replace(/\n/g,"<br/>")}</p>`}),te.success("Created document from shared content"),e(`/documents/${qt}`))}}}catch(Pe){console.warn("Error checking for shared content",Pe)}}catch(Pe){console.error("Initialization failed:",Pe),P(Pe.message||"Unknown database error")}finally{_(!0)}})();const ve=Mn.subscribe(N);return()=>ve()},[]),T.useEffect(()=>{const Ne=Pe=>{console.error("Global error caught in App effect:",Pe.error)},ve=Pe=>{Pe.preventDefault(),console.error("Global unhandled promise rejection:",Pe.reason),Pe.reason&&typeof Pe.reason.message=="string"&&(Pe.reason.message.includes("user-cancelled")||Pe.reason.message.includes("The user canceled the request"))};return window.addEventListener("error",Ne),window.addEventListener("unhandledrejection",ve),()=>{window.removeEventListener("error",Ne),window.removeEventListener("unhandledrejection",ve)}},[]),T.useEffect(()=>{const Ne=()=>{M(!navigator.onLine),navigator.onLine?te.success("You are back online."):te.info("You are offline. AI features are unavailable.")};return window.addEventListener("online",Ne),window.addEventListener("offline",Ne),()=>{window.removeEventListener("online",Ne),window.removeEventListener("offline",Ne)}},[]);const pe=T.useCallback(async()=>{if(!(!R||j))try{const Ne=await G3();if(Ne){const ve=await Te.getLatestUpdateTimestamp();Ne.contentTimestamp>ve&&(q(Ne.content),ee(Ne.backupTimestamp),Q(ve),U(!0))}}catch(Ne){console.warn("Failed to check server backup",Ne)}},[R,j]);T.useEffect(()=>{const Ne=n.pathname.split("/"),ve=Ne[1]||"dashboard";ve==="editor"&&Ne[2]?(g(Ne[2]),f("editor")):ve==="reader"&&Ne[2]?(w(Ne[2]),f("reader")):ve==="series"&&Ne[2]?f("series"):ve==="documents"&&Ne[2]?f("editor"):(g(null),w(null),f(ve)),ve==="dashboard"&&R&&!j&&pe()},[n.pathname,pe,R,j]),T.useLayoutEffect(()=>{const Ne=F.current;if(!Ne)return;const ve=`scroll_pos_${n.pathname}`,Pe=sessionStorage.getItem(ve);Pe?Ne.scrollTop=parseInt(Pe,10):Ne.scrollTop=0;const ot=()=>{sessionStorage.setItem(ve,Ne.scrollTop.toString())};return Ne.addEventListener("scroll",ot),()=>Ne.removeEventListener("scroll",ot)},[n.pathname]),T.useEffect(()=>{const Ne=ve=>{(ve.ctrlKey||ve.metaKey)&&ve.key==="k"&&(ve.preventDefault(),i())};return window.addEventListener("keydown",Ne),()=>window.removeEventListener("keydown",Ne)},[i]),T.useEffect(()=>{const Ne=ot=>{ot.touches[0].clientX<25?J.current=ot.touches[0].clientX:J.current=null},ve=ot=>{J.current!==null&&ot.touches[0].clientX-J.current>50&&(l(!0),J.current=null)},Pe=()=>{J.current=null};return document.addEventListener("touchstart",Ne,{passive:!0}),document.addEventListener("touchmove",ve,{passive:!0}),document.addEventListener("touchend",Pe),()=>{document.removeEventListener("touchstart",Ne),document.removeEventListener("touchmove",ve),document.removeEventListener("touchend",Pe)}},[]),T.useEffect(()=>{if(j)return;const Ne=[{id:"nav-dashboard",name:"Go to Dashboard",section:"Navigation",icon:Tn.GRID,action:()=>e("/dashboard")},{id:"nav-docs",name:"Go to Documents",section:"Navigation",icon:Tn.FILE_TEXT,action:()=>e("/documents")},{id:"nav-reading",name:"Go to Reading List",section:"Navigation",icon:Tn.BOOK,action:()=>e("/reading")},{id:"nav-instructions",name:"Go to Instructions",section:"Navigation",icon:Tn.EDIT,action:()=>e("/instructions")},{id:"nav-macros",name:"Go to Macros",section:"Navigation",icon:Tn.WORKFLOW,action:()=>e("/macros")},{id:"nav-settings",name:"Go to Settings",section:"Navigation",icon:Tn.SETTINGS,action:()=>e("/settings")},{id:"create-book",name:"Create New Book",section:"Actions",icon:Tn.PLUS,action:async()=>{const ve=await t();e(`/editor/${ve}`)}},{id:"create-doc",name:"Create New Document",section:"Actions",icon:Tn.PLUS,action:async()=>{const ve=await s();e(`/documents/${ve}`)}}];return r(Ne),()=>o(Ne.map(ve=>ve.id))},[r,o,e,t,s,j]);const ue=async()=>{try{await Te.restore(V),te.success("Restore from server successful!"),window.location.reload()}catch(Ne){te.error(`Restore failed: ${Ne.message}`)}finally{U(!1)}},ke=T.useCallback(async()=>{Fc.isRestoring=!0;try{const Ne=await Te.backup(),ve=await Fc.undo(Ne);ve&&(await Te.restore(ve),window.location.reload())}catch(Ne){console.error("Undo failed:",Ne)}finally{Fc.isRestoring=!1}},[]),re=T.useCallback(async()=>{Fc.isRestoring=!0;try{const Ne=await Te.backup(),ve=await Fc.redo(Ne);ve&&(await Te.restore(ve),window.location.reload())}catch(Ne){console.error("Redo failed:",Ne)}finally{Fc.isRestoring=!1}},[]);T.useEffect(()=>{const Ne=ve=>{(ve.ctrlKey||ve.metaKey)&&(ve.key==="z"&&!ve.shiftKey?(ve.preventDefault(),ke()):(ve.key==="y"||ve.key==="z"&&ve.shiftKey)&&(ve.preventDefault(),re()))};return window.addEventListener("keydown",Ne),()=>window.removeEventListener("keydown",Ne)},[ke,re]),T.useEffect(()=>{const Ne=Pe=>Pe.preventDefault(),ve=Pe=>{var bn;Pe.preventDefault();const ot=(bn=Pe.dataTransfer)==null?void 0:bn.files[0];if(!ot)return;const Gt=ot.name.toLowerCase();if(Gt.endsWith(".json")){const qt=new FileReader;qt.onload=jt=>{var _t;const yn=(_t=jt.target)==null?void 0:_t.result;$(yn)},qt.readAsText(ot)}else/\.(epub|pdf|md|txt|zip)$/.test(Gt)&&he(ot)};return window.addEventListener("dragover",Ne),window.addEventListener("drop",ve),()=>{window.removeEventListener("dragover",Ne),window.removeEventListener("drop",ve)}},[]);const Ge=async()=>{ze(!0),await pe(),ze(!1),D||te.info("Your local data is already up-to-date with the server.")},Je=async()=>{if(confirm("Are you SURE? This will wipe all local data and attempt to fix the database corruption. You will lose any unsaved work."))try{await Te.deleteDatabase(),window.location.reload()}catch{alert("Failed to reset database. Please clear browser data manually.")}},Qe=async()=>{try{await gp(!0),te.success("Synced with server.")}catch{}};if(j)return d.jsx("div",{className:"flex h-screen w-screen items-center justify-center bg-zinc-100 dark:bg-zinc-900 fixed inset-0 z-[99999]",children:d.jsxs("div",{className:"max-w-xl rounded-lg bg-white dark:bg-zinc-800 p-8 text-center shadow-2xl border border-red-200 dark:border-red-900",children:[d.jsx("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-red-100 dark:bg-red-900",children:d.jsx(H,{name:"ALERT_TRIANGLE",className:"w-8 h-8 text-red-600 dark:text-red-300"})}),d.jsx("h1",{className:"mt-4 text-2xl font-bold tracking-tight text-zinc-900 dark:text-white",children:"Critical Database Error"}),d.jsx("p",{className:"mt-2 text-zinc-600 dark:text-zinc-400",children:"The application could not initialize the local database. This usually happens due to browser storage corruption or a version mismatch."}),d.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md text-left text-xs font-mono overflow-auto max-h-32",children:j}),d.jsxs("div",{className:"mt-6 flex flex-col gap-3",children:[d.jsx("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center justify-center rounded-md bg-zinc-600 px-5 py-2.5 text-center text-sm font-semibold text-white shadow-sm hover:bg-zinc-700",children:"Try Reloading"}),d.jsx("button",{onClick:Je,className:"inline-flex items-center justify-center rounded-md bg-red-600 px-5 py-2.5 text-center text-sm font-semibold text-white shadow-sm hover:bg-red-700",children:"Factory Reset (Wipe Data)"})]})]})});if(!R)return d.jsx("div",{className:"flex h-screen items-center justify-center bg-zinc-100 dark:bg-zinc-900",children:d.jsx(sr,{message:"Initializing Studio..."})});const je=u==="editor"||u==="reader"||u==="series",ye=u==="reader",Fe=n.pathname.startsWith("/documents/");return d.jsxs("div",{className:"flex h-screen bg-zinc-100 dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100",children:[C&&d.jsx("div",{className:"fixed top-0 left-0 right-0 bg-amber-500 text-white text-xs font-bold text-center py-1 z-[10000]",children:"OFFLINE MODE - Changes saved locally"}),!je&&!Fe&&d.jsx(TJ,{currentPage:u,isOpen:a,setIsOpen:l}),d.jsxs("div",{className:`flex-1 flex flex-col transition-all duration-300 ease-in-out ${!je&&!Fe&&"lg:ml-64"}`,children:[!je&&!Fe&&d.jsx(_J,{onMenuClick:()=>l(!0)}),d.jsx(mue,{onRefresh:Qe,scrollRef:F,className:C?"pt-6":"",children:d.jsx("main",{ref:F,className:"flex-1 min-h-full",children:d.jsxs(h8,{children:[d.jsx(qi,{path:"/",element:d.jsx(d8,{to:`/${localStorage.getItem("start_page")||"dashboard"}`,replace:!0})}),d.jsx(qi,{path:"/dashboard",element:d.jsx(mX,{})}),d.jsx(qi,{path:"/documents",element:d.jsx(gX,{})}),d.jsx(qi,{path:"/documents/:id",element:d.jsx(Foe,{})}),d.jsx(qi,{path:"/reading",element:d.jsx(Kde,{})}),d.jsx(qi,{path:"/instructions",element:d.jsx(Hde,{})}),d.jsx(qi,{path:"/macros",element:d.jsx(Ude,{})}),d.jsx(qi,{path:"/settings",element:d.jsx(Fde,{onRestoreSuccess:async()=>ie(),onManualRestoreCheck:Ge})}),d.jsx(qi,{path:"/archived",element:d.jsx(Yde,{})}),d.jsx(qi,{path:"/trash",element:d.jsx(Jde,{})}),d.jsx(qi,{path:"/series/:id",element:d.jsx(qde,{})}),p&&d.jsx(qi,{path:"/editor/:id",element:d.jsx(ZY,{bookId:p,onBack:ie,children:d.jsx(Ele,{onSave:ie,onBack:ie})})}),b&&d.jsx(qi,{path:"/reader/:id",element:d.jsx(Vde,{bookId:b})})]})})})]}),d.jsx(Qde,{}),d.jsx(nue,{modalState:S}),d.jsx(hue,{}),d.jsx(fue,{}),!ye&&d.jsx(sue,{onUndo:ke,onRedo:re}),d.jsx(aue,{}),d.jsx(due,{}),d.jsx(uue,{}),d.jsx(pue,{}),D&&d.jsx(iue,{backupTimestamp:G,localTimestamp:W,onRestore:ue,onDecline:()=>U(!1)}),Z&&d.jsx(rue,{fileContent:Z,onClose:()=>$(null),onRestoreSuccess:async()=>{$(null),window.location.reload()}}),Y&&d.jsx(MH,{isOpen:!0,onClose:()=>he(null),initialFile:Y}),Re&&d.jsx(sr,{message:"Checking for server backup..."}),d.jsx(oue,{})]})},IH=document.getElementById("root");if(!IH)throw new Error("Could not find root element to mount to");const bue=x$.createRoot(IH);bue.render(d.jsx(Kn.StrictMode,{children:d.jsx(gue,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(n=>{console.log("ServiceWorker registration successful with scope: ",n.scope)}).catch(n=>{console.log("ServiceWorker registration failed: ",n)})});
